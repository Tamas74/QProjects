Imports System.IO
Imports System.Threading
Imports C1.Win.C1FlexGrid
Imports gloEMR.gloEMRWord
Imports gloEMRGeneralLibrary.gloEMRDatabase
Imports System.Data.SqlClient
Imports gloBilling
Imports gloSettings
Imports System.Runtime.InteropServices
Imports gloDateMaster
Imports gloRxHub
Imports System.Management
Imports gloReports
Imports gloEmdeonInterface.Forms
Imports gloReports.ReportService2005
Imports gloSSRSApplication
Imports encrypt
Imports gloEMR.Help
Imports gloPMGeneral
Imports gloDirectAbility
Imports System.Runtime.ExceptionServices
Imports gloSurescriptSecureMessage
Imports gloCCDSchema
Imports gloGallery
Imports gloPatientPortalCommon
Imports gloICDAnalysis
Imports gloUIControlLibrary
Imports Wd = Microsoft.Office.Interop.Word
Imports System.Text
Imports gloEMRGeneralLibrary.gloEMRLab
Imports System.Drawing.Printing
Imports gloEDocumentV3
Imports QSurvey.Models
Imports System.Security.Principal
Imports System.Security.Permissions

Public Class MainMenu

    Private blnPatientStatusOnMessageFired As Boolean = False
    Private blnCompatibilityModulesSet As Boolean = False
    Dim GridSelect_RowCount As Integer = 0

    'Private blnLoad As Boolean
    'use this variable throughout the RxForm to add validation to confirm whether there is internet connection available 
    Private ExportPath As String = String.Empty
    Dim _isInternetAvailable As Boolean = False
    Private Shared _isTSPrinterSelectionOpen As Boolean = False

    'This variable will help to determine whether the 270 file was sent using DEA number 1 time. if counter > 1 don't again resend the 270 file
    Dim Send270UsingDEA_counter As Integer = 0

    'Public Event UnhandledException As UnhandledExceptionEventHandler
    Dim blnIsInvalidHL7FilePath As Boolean
    Dim WithEvents oGeneralInterface As clsGeneralInterface
    'Dim ofrmEDIGeneration As gloRxHub.frmRxhub270EDIGeneration

    Dim listDirectUserProviderAssociation As List(Of gloSurescriptSecureMessage.DirectUserProviderAssociation) = Nothing
    Dim nShowTaskRowCount As Int64 = 100
    Dim _isTasksFullyLoaded As Boolean = False
    Public _IsHasRighttoCompleteTaskforallUsers As Boolean = False
    Dim nRowCount As Int64 = 100
    Dim _isMessageFullyLoaded As Boolean = False
    Dim _TempTime As Long
    Dim nTaskId As Long = 0
    Dim precisionTime As Int32
    Dim Toolitems As ToolStripMenuItem = Nothing
    Dim _sReportType As String = "gloEMR"
    Public Shared gnPatientID As Long
    Public gnVisitID As Long
    Dim _IsFromAppointmentforTemplatePrint = False

    Dim _YesLab As Boolean = False
    Public PnlFlag As Boolean = False
    Private isMessageTimerCallForPanelSelection As Boolean = False
    Private strPreviousSelectedPanel As String = ""
    Private gstrPatientCode As String
    Private gstrPatientFirstName As String
    Private gstrPatientMiddleName As String
    Private gstrPatientLastName As String
    Private gstrPatientDOB As String
    Private gstrPatientAge As String
    Private gstrPatientGender As String
    Private gstrPatientMaritalStatus As String

    Dim mdiClient As MdiClient = Nothing
    Private Const SB_BOTH As Integer = 3

    ' Private _nLabPatientId As Long = 0

    Dim _IsFromAppointment = False
    Dim dtPatient As DataTable
    Dim isDisplayed As Boolean = False
    Public _isShowDialogueForm As Boolean = False
    Public _isFromLockScreen As Boolean = False
    ''Block of variables declaration for Newly implemented Dashboard refresh logic 
    Dim DirectMessaging_OldUpdateDateTime As DateTime
    Dim dtDashboardUpdateMst As DataTable
    Dim Mesages_OldUpdateDateTime As DateTime
    Dim Tasks_OldUpdateDateTime As DateTime
    Dim UnfinishedExams_OldUpdateDateTime As DateTime
    Dim Triage_Exams_OldUpdateDateTime As DateTime
    Dim Appointment_OldUpdateDateTime As DateTime
    Dim bIsLockChart As Boolean = False
    Private Shared gstrPatientStatus As String = String.Empty
    Private Const col_roleprovider = 8

    Private _RegAppUsingTemplateOnly As Boolean = False
    Private _databaseconnectionstring As String = ""
    Private _ClinicID As Int64 = 0
    Private _UserID As Int64 = 0

    'Intuit variables
    'Used To Get Selected Intuit Message Id on Patient Details
    Dim IntuitCommDetailId As Long
    Dim IntuitMsgreadUnread As Boolean
    Dim IntuitMessageStatus As String
    Dim IntuitMessageFrom As String
    Dim IntuitMessageTo As String
    Dim IntuitMessageSubject As String
    Dim IntuitMessageDate As String
    Dim IntuitMessageType As String
    Dim IntuitMessageBody As String
    Dim IntuitAttachmentcount As Long
    Dim IntuitMessageStaffId As Long
    Dim IntuitMessageContainerId As Long
    Dim IntuitServiceType As String
    Dim PatientDetailsRowClickIndex As Integer
    Dim isPatientDetailsGridSorted As Boolean = False
    ''Added for Black Ice issuie on windows8 as on 20121203 
    Dim blnWindows8 As Boolean = False

    ''End
    'Dim clstrace As New clsTrace
    Dim _isAppointmentGridColumnResize As Boolean = False  ' Flag to check c1Appointment Resize or not

    Dim _CDAOrderID As Long = 0
    Dim _CDAOrderDetails As String = ""
    '26-Apr-13 Aniket: Resolving Bug #49616:
    Private blnLoad As Boolean
    ''Added for MU2 Patient Portal on 20130827
    Dim PortalType As String
    ''End

    ''Added a Variable to handle the locksreen on while voice dictation
    Dim globalLastInputInfo As DateTime
    Dim dtTask As DataTable  ''slr new not needed
    Dim subItemSSRS As ToolStripMenuItem
    Dim strClinicalChartErrorNotes As StringBuilder    
    Private bIsShowAllUnfinishedexams As Boolean = False
    Public Property SingleSignON As Boolean
    Private blnIsHighPriorityMessagePresent As Boolean
    Private TimerSSO As Windows.Forms.Timer
    Private TimerWritting As Windows.Forms.Timer
    Private TimerpnlUtteranceProgress As Windows.Forms.Timer
    Dim txtlockscrusername As TextBox ''added for setting focus to lockscreen username textbox
    ''Close Message Box after lock screen if screens are auto closed
    
    <DllImport("User32.dll")> _
    Private Shared Function ShowScrollBar(ByVal hWnd As IntPtr, ByVal wBar As Integer, ByVal bShow As Integer) As Integer
    End Function

    <DllImport("user32.dll", SetLastError:=True)> _
    Private Shared Function GetWindowThreadProcessId(ByVal hWnd As IntPtr, <Out()> ByRef lpdwProcessId As UInt32) As UInt32
    End Function

    <DllImport("USER32.DLL")> _
    Private Shared Function GetWindowTextLength(ByVal hWnd As IntPtr) As Integer
    End Function

    <DllImport("USER32.DLL")> _
    Private Shared Function GetWindowText(ByVal hWnd As IntPtr, ByVal lpString As System.Text.StringBuilder, ByVal nMaxCount As Integer) As Integer
    End Function

    <DllImport("advapi32.DLL", SetLastError:=True)> _
    Public Shared Function LogonUser(ByVal lpszUsername As String, ByVal lpszDomain As String, _
        ByVal lpszPassword As String, ByVal dwLogonType As Integer, ByVal dwLogonProvider As Integer, _
        ByRef phToken As IntPtr) As Integer
    End Function

    Dim IsFormLoading = False
    Dim IsPatientHasAccess = True
    Dim IsDrawTask = True
    Dim imgsetcount As UInt64 = 1
    ''Added for check is user map to gloCommunity on 20120904
    Dim _blnCheckUser As Boolean = False
    ''End
    Dim intTotalTaskCnt As Int64 = 0
    Private dvAllSettings As DataView
    Dim blnsetGroupOnLoad As Boolean = False
    Dim TaskGroupBeforeRightClick As Boolean = False

    Private _patientInfo As DataRow = Nothing
    Public Property PatientInfo() As DataRow
        Get
            Return _patientInfo
        End Get
        Set(ByVal value As DataRow)
            _patientInfo = value
        End Set
    End Property

    Public Sub New()
        MyBase.New()
        IsFormLoading = True
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Initialize, " DASHBOARD NEW START  ", gloAuditTrail.ActivityOutCome.Success)
        m_hotKeys = New HotKeyCollection(Me)
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.General, " CleanUpVoiceComponents START", gloAuditTrail.ActivityOutCome.Success)
        Call CleanUpVoiceComponents()
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.General, " CleanUpVoiceComponents END", gloAuditTrail.ActivityOutCome.Success)

        'This call is required by the Windows Form Designer.
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Initialize, " InitializeComponent START", gloAuditTrail.ActivityOutCome.Success)

        InitializeComponent()
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Initialize, " InitializeComponent END", gloAuditTrail.ActivityOutCome.Success)

        'Add any initialization after the InitializeComponent() call
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Initialize, " DASHBOARD NEW END  ", gloAuditTrail.ActivityOutCome.Success)

        IsFormLoading = False
        AddHandler SearchFilterChanged, AddressOf SearchFilter_Changed
    End Sub

    'Dim CloseWindowTimer As System.Windows.Forms.Timer

    'Sub CloseWindow(WindowTitle As String)
    '    Dim handle As Integer = FindWindowEx(0, 0, Nothing, WindowTitle)
    '    PostMessage(handle, WM_CLOSE, 0, 0)
    'End Sub


    Friend WithEvents GloUC_TransactionHistory1 As gloUserControlLibrary.gloUC_TransactionHistory

    Public blnIsDictationOn As Boolean = False
    Private IExam As IHotKey
    Public IsActivated As Boolean = False
    Dim mynode As myTreeNode
    Public blnFormLoad As Boolean
    Dim _SelectedPatientDetail As PatientDetails

    Public Property AllSettings As DataView
        Get
            Return dvAllSettings
        End Get
        Set(ByVal value As DataView)
            dvAllSettings = value
        End Set
    End Property


    Property SelectedPatientDetail() As PatientDetails
        Get
            Return _SelectedPatientDetail
        End Get
        Set(ByVal value As PatientDetails)
            _SelectedPatientDetail = value
            Call SetPatientDetailsHeader(_SelectedPatientDetail)
        End Set
    End Property

    Dim strAdministratorMessage As String = ""
    'Speaker name
    Dim strSpeakerName As String
    Dim SpeakerStatus As Int16
    Dim SpeakerCount As Int64
    Private intstatus As Int16
    ' Dim voiceprocess As System.Diagnostics.Process
    Dim _arrTopics As New ArrayList

    Private _TemplateName As String = ""
    Private _TemplateID As Int64
    Private blnIsload As Boolean = True
    Dim nDBUpdateTime As Int16 = 300

    'DM
    Dim _FindCriteriaName As String = ""
    'Public WithEvents oDMProcess As New gloStream.DiseaseManagement.DiseaseManagement
    Dim _oPatients As New Collection
    Private _FindCriteriaID As Long

    'Taken For Advanced Search
    Dim Phone_AS As String
    Dim DOB_AS As Date
    Dim ISDOB_AS As Boolean
    Dim dvPatient As DataView
    '' 
    Dim nBirthDayWishTemplateID As Long = -1
    Private m_hotKeys As HotKeyCollection

    Public Event HotKeyPressed As HotKeyPressedEventHandler
    Public Event PrintWindowPressed As PrintWindowPressedEventHandler
    Public Event PrintDesktopPressed As PrintDesktopPressedEventHandler
    Public Event SearchFired()
    Const WM_PARENTNOTIFY = 528
    Const WM_LBUTTONDOWN = 513

    Dim _dtAppontmentDate As Date = Now
    Dim dtWord As DataTable
    Dim objWord As clsWordDocument
    Friend myRefCaller As mdlgloVoice.gloVoice
    Private _SeachFlag As Boolean = False
    Private _ResetFlag As Boolean = False


    'SureScript Alert
    Private strSelectsurescriptDate As String = ""
    Private IsRefileRequestfrmOpen As Boolean = False
    Private IsErrorRequestfrmOpen As Boolean = False
    Private strRefillMessage As System.Text.StringBuilder
    Private strErrorMessage As System.Text.StringBuilder
    Private IsRecordPresent As String = ""

    Dim strMessageAlerInterval() As String

    Dim objUserRights As clsLoginUserRights ''Slr new not needed 
    Dim blnLeftPnl As Boolean = True

    Dim oPatientCards As New gloPatient.PatientCards()

    'Reminder
    Public ogloReminder As gloReminder.gloReminder
    Public WithEvents oEDocumentV3 As gloEDocumentV3.gloEDocV3Management
    Public WithEvents ofrm As frm_LM_Orders

    'Patient confidential
    Dim _nConfidentialID As Int64 = 0
    Dim _nConfidentialStatus As Int16 = 0
    'Reconciliation Alert'
    Private _IsImportedFilePresent As Boolean = False
    Private _IsReadyListPresent As Boolean = False
    Private _ListType As String = ""
    'For Patient Advance Directive
    Private _blnHasAdvDirective As Boolean = False

    Private PatientRegistration As ClsPatientRegistrationDBLayer

    'TO STORE DEFAULT TOOLSTRIP BUTTONS ARRAY
    Private arrDashBoardToolStrip As ArrayList
    Private arrPatientDetailToolStrip As ArrayList

    Private arrMainStripButtonsToHide As ArrayList
    Private arrPatDetailsButtonsToHide As ArrayList

    Dim ofrmTask As gloTaskMail.frmTask

    Dim ofrmSSRS As gloReports.frmEMRSSRSViewer

    Dim dtPatientDetails As DataTable
    ''added for reducing database trips for optimizing past exam data
    Dim dt_ExamID As DataTable = Nothing
    Dim dt_TemplateSpeciality As DataTable = Nothing
    Dim dt_ProviderCombo As DataTable = Nothing
    Dim dt_CasesCombo As DataTable = Nothing
    Dim _IsPastExam As Boolean = False

    Private _ChildFormsStack As New Stack
    Dim tempRow As Int32 = 0
    Dim tempInsId As Int64 = 0
    Dim tempInsName As String = ""
    Dim copayAmount As Decimal = 0
    Dim coveragePercent As Decimal = 0
    Dim appSettings As System.Collections.Specialized.NameValueCollection = System.Configuration.ConfigurationManager.AppSettings
    Private _OverFlowToolStripPainted As Boolean = False
    Public ShowSplashScreen As Boolean = False
    Dim dtPatientOnDate As Date = Now.Date
    Dim LoadLeftPanelThreadEntry As ThreadStart = New ThreadStart(AddressOf LoadLeftPanel)

    Dim c1dgPatientDetailSize As Object = Nothing

    Private Delegate Sub LoadLeftPanelDelegate()
    Private Delegate Sub ShowMessagesDelegate()
    Private Delegate Sub InitiliseFaxSettingDelegate()
    Private Delegate Sub LoadSelectedPatientInfoDelegate(ByVal PatientID As Long)

    Dim oCalendar As New gloAppointmentScheduling.gloAppointment(GetConnectionString)



    Enum enumFilterCriteria
        DateFilterEnable
        Status
        FromDate
        ToDate
        User
        Year
        Month
        Provider
    End Enum

    Public Delegate Sub SearchFilterChangedHandler(ByVal UpdatedFilter As enumFilterCriteria)
    Public Event SearchFilterChanged As SearchFilterChangedHandler

#Region " Navigation Panel Name Constants "
    Dim _DefaultNavigation As String = ""
    Private Const NAV_TRIAGE = "TRIAGE"
    Private Const NAV_UNFINISHED_EXAM = "UNFINISHED EXAM"
    Private Const NAV_APPOINTMENT = "APPOINTMENT"
    Private Const NAV_ALERTS = "ALERTS"
#End Region


#Region " C1 Constants "

    Private Const COL_D_CAT_ID = 0 ' ID
    Private Const COL_D_CAT_NAME = 1 ' Name
    Private Const COL_D_CAT_NOTEFLAG = 2 ' Note Flag
    Private Const COL_D_CAT_EXTRAFLAG = 3 ' Extra Col
    Private Const COL_D_CAT_SOURCEMACHINE = 4 ' Source Machine
    Private Const COL_D_CAT_SYSTEMFOLDER = 5 ' System Folder
    Private Const COL_D_CAT_CONTAINER = 6 ' Container
    Private Const COL_D_CAT_CATEGORY = 7 ' Category
    Private Const COL_D_CAT_PATIENTID = 8 ' Patient ID
    Private Const COL_D_CAT_YEAR = 9 ' Year
    Private Const COL_D_CAT_MONTH = 10 ' Month
    Private Const COL_D_CAT_SOURCEBIN = 11 ' Source Bin
    Private Const COL_D_CAT_INUSED = 12 ' In Used
    Private Const COL_D_CAT_USEDMACHINE = 13 ' Used Machine
    Private Const COL_D_CAT_USEDTYPE = 14 ' Used Type
    Private Const COL_D_CAT_PATH = 15 ' Path
    Private Const COL_D_CAT_COLTYPE = 16
    Private Const COL_D_CAT_FILENAME = 17 ' File Name
    Private Const COL_D_CAT_MACHINEID = 18 ' File Name
    Private Const COL_D_CAT_VERSIONNO = 19 ' Version No
    Private Const COL_D_CAT_ISREVIWED = 20 ' Reviewed
    Private Const COL_D_CAT_REVIWEDFLAG = 21 ' Reviwed
    Private Const COL_View_CategoryHidden = 22
    Private Const COL_View_Category = 23
    Private Const COL_View_Month = 24
    Private Const COL_View_DocumentName = 25

    Private Const COL_View_NOTEFLAG = 27
    Private Const COL_View_REVIWEDFLAG = 26
    Private Const Col_view_Count = 28

    Private COL_Alt_MessageID As Integer = 0
    Private COL_ALT_PrescriberID As Integer = 1
    Private COL_Alt_MessageDate As Integer = 2
    Private COL_Alt_MessageType As Integer = 3
    Private COL_Alt_MessageTo As Integer = 4
    Private COL_Alt_Select As Integer = 5
    Private COL_Alt_Count As Integer = 6



    Private Const Col_Task_DueDate = 1
    Private Const Col_Task_Subject = 2
    Private Const Col_Task_Status = 5
    Private Const Col_Task_Priority = 7
    'Private Const Col_Task_TaskID = 9
    'Private Const Col_Task_No = 10
    'Private Const Col_Task_Completed = 11
    'Private Const Col_Task_TaskDate = 12
    'Private Const Col_Task_PatientID = 13
    'Private Const Col_Task_Assigned = 14
    'Private Const Col_Task_ColCount = 19  ''19
    'Private Const Col_Task_GroupID = 20   ''20
    'Private Const Col_Task_TAKEID = 21
    'Private Const Col_Task_OwnerAssigned = 22

    Private Const Col_Task_TaskID = 9
    Private Const Col_Task_No = 10
    Private Const Col_Task_Completed = 11
    Private Const Col_Task_TaskDate = 12
    Private Const Col_Task_PatientID = 13
    Private Const Col_Task_Assigned = 14
    Private Const Col_Task_ColCount = 19  ''19
    Private Const Col_Task_GroupID = 20  ''20
    Private Const Col_Task_TAKEID = 21
    Private Const Col_Task_OwnerAssigned = 22
    Private Const Col_Task_Resp = 23  ''added new column for responsibility
    Private Const col_TriageNo = 0
    Private Const col_TriageID = 1
    Private Const col_TriagePatientName = 2
    Private Const col_TriageDate = 3
    Private Const col_TriagePatientID = 4
    Private Const col_TriageTemplateID = 5
    Private Const col_TriageCount = 6

    Const col_color0 = 0
    Const col_color1 = 1
    Const col_color2 = 2
    Const col_color3 = 3
    Const col_color4 = 4
    Const col_color5 = 5
    Const col_No = 6
    Const col_AppId = 7
    Const col_AppDtlId = 8
    Const col_AppointmentType = 9
    Const col_AppDate = 10
    Const col_AppPatientID = 11
    Const col_AppTime = 12
    Const col_PatientName = 13
    ''appointemnt type-9
    Const col_AppLocation = 14
    ''startdate=11



    ''Const col_AppEndTime = 14
    ''end time=15
    Const col_ProviderID = 15
    Const col_ProviderName = 16
    Const col_BannerHeaderColor = 17

    Const col_Count = 19

    ''Added to display Messages

    'Private Const col_MessageNo = 0
    'Private Const col_MessageID = 1
    'Private Const col_MsgPatientTemplateName = 3
    'Private Const col_MessageDate = 2
    'Private Const col_MessagePriority = 4
    'Private Const col_PatientID = 5

    'Private Const col_PatientCode = 6
    'Private Const col_msgPatientName = 7
    'Private Const col_msgFinished = 8
    'Private Const col_TemplateName = 9
    'Private Const col_MDate = 10
    'Private Const col_MessageTotal = 11
    Private Const col_MessageDate = 0
    Private Const col_MessageNo = 1
    Private Const col_MessageID = 2
    Private Const col_MsgPatientTemplateName = 3
    Private Const col_MessagePriority = 4
    Private Const col_PatientID = 5

    Private Const col_PatientCode = 6
    Private Const col_msgPatientName = 7
    Private Const col_msgFinished = 8
    Private Const col_TemplateName = 9
    Private Const col_MDate = 10
    Private Const col_MessageTotal = 11



    ''To Show patient check in check out status
    Private Const COL_PATSTATUSPATIENTID As Integer = 0
    Private Const COL_PATSTATUSPATIENTNAME As Integer = 1
    Private Const COL_PATSTATUSSTARTTIME As Integer = 2
    Private Const COL_PATSTATUS_APPIDMST As Integer = 3
    Private Const COL_PATSTATUS_APPIDDTL As Integer = 4
    Private Const COL_PATSTATUS_APPSTARTTIME As Integer = 5
    Private Const COL_PATSTATUSTEXT As Integer = 6
    Private Const COL_PATSTATUSAPPTTYPE As Integer = 7
    Private Const COL_PATSTATUS_FORMATTED_TEXT As Integer = 8
    Private Const COL_PATSTATUSCOUNT As Integer = 9

    Dim _MessageBoxCaption As String = "gloEMR"

    'Added to show appointments
    Private Const Col_AppointmentNo = 0
    Private Const Col_AppointmentMSTID = 1
    Private Const Col_AppointmentDTLID = 2
    Private Const Col_AppointmentStartDate = 3
    Private Const Col_AppointmentEndDate = 4
    Private Const Col_AppointmentLocation = 5
    Private Const Col_AppointmentPatientID = 6
    Private Const Col_Appointment_ColCount = 7

    'Added  to display UnfinishedExams
    Private Const col_UnfinishedExamVisitID = 0
    Private Const col_UnfinishedExamID = 1
    Private Const col_UnfinishedExamPatientName = 2
    Private Const col_UnfinishedExamDate = 3
    Private Const col_UnfinishedExamPatientID = 4
    Private Const col_UnfinishedExamPatientCode = 5
    Private Const col_UnfinishedExamName = 6
    Private Const col_UnfinishedTemplateName = 7
    Private Const col_UnfinishedExamCount = 8

    Private Const col_CheckInStatus_CheckInDetail = 0
    Private Const col_CheckInStatus_PatientID = 1
    Private Const col_CheckInStatus_AppointmentID_MST = 2
    Private Const col_CheckInStatus_AppointmentID_DTL = 3
    Private Const col_CheckInStatus_StartTime = 4
    Private Const col_CheckInStatus_Type = 5
    Private Const col_CheckInStatus_TotalColumns = 6

    ''added for patient task in patient detail panel
    Private Const Col_View_taskID = 0
    Private Const Col_View_FollowUpID = 1
    Private Const Col_View_PriorityID = 2
    Private Const Col_View_Priority = 3
    Private Const Col_View_Subject = 4
    Private Const Col_View_Owner = 5
    Private Const Col_View_Status = 6
    Private Const Col_View_DueDate = 7
    Private Const Col_View_startdate = 8
    Private Const Col_View_ProviderName = 9
    Private Const Col_View_Description = 10
    Private Const Col_View_Followup = 11
    Private Const Col_View_UserID = 12
    Private Const Col_View_OwnerID = 13
    Private Const Col_View_TaskGroupID = 14
    Private Const Col_ViewTask_TAKEID = 15
    Private Const Col_ViewTask_OwnerAssigned = 16
    Private Const Col_ViewTask_Resp = 17  ''new column added to show Resp column for task ownership

#End Region

    Enum enumTaskAssignStatus
        Accepted = 1
        Rejected = 2
        Hold = 3
    End Enum

#Region " Appointment Grid Column Constants"
    Dim COLA_ENV1 As Int16 = 0
    Dim COLA_ENV2 As Int16 = 1
    Dim COLA_ENV3 As Int16 = 2
    Dim COLA_ENV4 As Int16 = 3
    Dim COLA_ENV5 As Int16 = 4
    Dim COLA_ENV6 As Int16 = 5

    Dim COLA_APPID As Int16 = 6
    Dim COLA_PatientID As Int16 = 7
    Dim COLA_AppDateTime As Int16 = 8
    Dim COLA_AppTime As Int16 = 9
    Dim COLA_PatientCode As Int16 = 10
    Dim COLA_PatientName As Int16 = 11

    Dim COLA_COUNT As Int16 = 12
#End Region

#Region " Location Status Grid Column Constants"
    Const COLT_TODOID As Int16 = 0
    Const COLT_PatientID As Int16 = 1
    Const COLT_LocationDateTime As Int16 = 2
    Const COLT_LocationTime As Int16 = 3
    Const COLT_PatientCode As Int16 = 4
    Const COLT_PatientName As Int16 = 5
    Const COLT_Location As Int16 = 6
    Const COLT_Status As Int16 = 7
    Const COLT_COUNT As Int16 = 8
#End Region

    'By Mahesh On 20070509 
#Region " Enum for Display Settings "
    'For Display Settings of gloEMR depending on User & M/C 
    Enum Panel
        pnlAppointment = 0
        pnlUnFinishedExams = 1
        pnlTasks = 2
        pnlPatients = 3
        pnlPatientDetails = 4
        pnlLeft = 5
    End Enum

#End Region

#Region " User Rights For Context Menus "

    Dim _blnShowSetAlert As Boolean = True
    Dim _blnDMHealthPlansForPatient As Boolean
    Dim _blnDMHealthPlansForCriteria As Boolean
    Dim _blnShowSurgicalAlert As Boolean

#End Region

#Region " BlackIce Fax variables "

    Shared bsuccess As Boolean

    Shared pBlackIceDEVMODE As Integer 'pointer to the devmode
    Shared AxBlackIceDEVMODE1 As AxBLACKICEDEVMODELib.AxBlackIceDEVMODE
    Shared DITHER_NONE As Short = 0
    Shared DITHER_FS4 As Short = 1
    Shared DITHER_JJN As Short = 2
    Shared DITHER_SMOOTH As Short = 3
    Shared DITHER_SHARP As Short = 4
    Shared DITHER_STUCKI As Short = 5
    Shared DITHER_DEFAULT As Short = DITHER_FS4

    Shared BITS_1 As Short = 0
    Shared BITS_8GRAY As Short = 1
    Shared BITS_8 As Short = 2
    Shared BITS_24 As Short = 3

#End Region


    'Variable added to send hl7 messages
    Dim _bIsPatientModify As Boolean = False

    'Constant for displaying appointment for patient in patient detail grid
    Const COL_MSTAPTID As Integer = 0
    Const COL_APTDTL As Integer = 1
    Const COL_DATE As Integer = 2
    Const COL_DATE1 As Integer = 3
    Const COL_STARTTIME As Integer = 4

    Const COL_ENDTIME As Integer = 5
    Const COL_LOCATION As Integer = 6
    Const COL_DEPARTMENT As Integer = 7
    Const COL_ASBASEID As Integer = 8
    Const COL_APPTYPE As Integer = 9
    Const COL_NOTES As Integer = 10
    Const COL_PROVIDER As Integer = 11
    Const COL_USEDSTATUS As Integer = 12
    Const COL_MASTERAPPMETHOD As Integer = 13
    Const COL_APPMETHOD As Integer = 14
    Const COL_LINENUMBER As Integer = 15
    Const COL_CLINICID As Integer = 18
    Const COL_ASBASEFlag As Integer = 16
    Const COL_Status As Integer = 17

    'GLO2011-0011959 - Multiple days appointment
    'Added new column EndDate for multiple day's appointment
    Const COL_EndDate As Integer = 18


    Public Enum PatientDetails
        None = 0
        History = 1
        Medication = 2
        Prescription = 3
        ProblemList = 4
        ViewDocs = 5
        OrderTemplates = 6
        Messages = 7
        PastExams = 8
        NewExam = 9
        FAX_Pending = 10
        FAX_Sent = 11
        AuditTrail = 12
        Vitals = 13
        Insurance = 14
        Billing = 15
        NurseNotes = 16
        PatientLetters = 17
        PatientConsent = 18
        DisclosureManagement = 19
        HealthPlan = 20
        Orders = 21
        EligibilityInformation = 22
        PatientAppointments = 23
        Balance = 24
        Referrals = 25
        Triage = 26
        PatientEducation = 27
        PriorAuthorization = 28
        PatientTasks = 29
        patientCases = 30

        IntuitCommunication = 31
        PatientCommunication = 32
        Order = 33
        NYWorkerCompForms = 34
        OBVitals = 35 ''Added Code Changes for View OBVitals
        SBPData = 36
    End Enum

    Public Enum enmExamStatus
        WorkersComp = 6
    End Enum

    Public Enum Type
        Appointment = 1
        Messages = 2
        Tasks = 3
        UnfinishedExams = 4
    End Enum

    Public ReadOnly Property HotKeys() As HotKeyCollection
        Get
            HotKeys = m_hotKeys
        End Get
    End Property



#Region " Form Events "

    Private Sub RemoveHandlers()
        RemoveHandler chkenbdate.CheckedChanged, AddressOf chkenbdate_CheckedChanged
        RemoveHandler dtpFromDate.TextChanged, AddressOf dtpFromDate_TextChanged
        RemoveHandler dtpToDate.TextChanged, AddressOf dtpToDate_TextChanged
        RemoveHandler cmbStatus.SelectionChangeCommitted, AddressOf cmbExamStatus_SelectionChangeCommitted
        RemoveHandler cmbProvider.SelectionChangeCommitted, AddressOf cmbExamProvider_SelectionChangeCommitted
        RemoveHandler btnReset.Click, AddressOf btnReset_Click
        RemoveHandler btnReset.MouseHover, AddressOf btnReset_MouseHover
        RemoveHandler btnReset.MouseLeave, AddressOf btnReset_MouseLeave
    End Sub

    Private Sub AddHandlers()
        AddHandler chkenbdate.CheckedChanged, AddressOf chkenbdate_CheckedChanged
        AddHandler dtpFromDate.TextChanged, AddressOf dtpFromDate_TextChanged
        AddHandler dtpToDate.TextChanged, AddressOf dtpToDate_TextChanged
        AddHandler cmbStatus.SelectionChangeCommitted, AddressOf cmbExamStatus_SelectionChangeCommitted
        AddHandler cmbProvider.SelectionChangeCommitted, AddressOf cmbExamProvider_SelectionChangeCommitted
        AddHandler btnReset.Click, AddressOf btnReset_Click
        AddHandler btnReset.MouseHover, AddressOf btnReset_MouseHover
        AddHandler btnReset.MouseLeave, AddressOf btnReset_MouseLeave
    End Sub

    Dim myDialogCloser As gloWord.WordDialogBoxBackgroundCloser = Nothing

    


    Private Sub MainMenu_KeyDown(sender As Object, e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyDown
        If (gloWord.WordDialogBoxBackgroundCloser.IsMyApplicationOnTop()) Then
            If e.KeyCode = Keys.F4 Then

                LockScreen()
            End If
        End If

    End Sub

    Private Sub MainMenu_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        pnlRightFill.BackColor = Color.Transparent  ''added for setting demographics color according to medical category
        pnlLeft.BackColor = Color.Transparent
        pnlLeft.BackgroundImage = Nothing
        Me.QualityMeasureDashboardToolStripMenuItem.Visible = False
        Dim myExclusionStrings As New ArrayList

        If (gloGlobal.gloTSPrint.TerminalServer = "RDP") Then
            mnuTools_RefreshDevicesPrinters.Enabled = True
        Else
            mnuTools_RefreshDevicesPrinters.Enabled = False
        End If

        AddGotFocusListener(Me)
        If IsNothing(dvAllSettings) = False Then

            dvAllSettings.RowFilter = "sName = 'WordExclusion'"

            For bytCount As Byte = 0 To dvAllSettings.Count - 1
                'myExclusionStrings.Insert(bytCount, dvAllSettings(bytCount)("sValue"))
                myExclusionStrings.Add(dvAllSettings(bytCount)("sValue").ToString().ToLower())
            Next

            myDialogCloser = New gloWord.WordDialogBoxBackgroundCloser(myExclusionStrings)

        End If

        dvAllSettings.RowFilter = "sName = 'IsVitalRequired'"

        If dvAllSettings.Count = 0 Then
            gblnIsVitalRequired = False
        Else
            gblnIsVitalRequired = dvAllSettings(0)("sValue")
        End If

        'Aniket: Show Dragon Wait Process
        dvAllSettings.RowFilter = "sName = 'ShowDragonWaitProcess'"

        If dvAllSettings.Count = 0 Then
            gblnShowDragonWaitProcess = False
        Else
            gblnShowDragonWaitProcess = dvAllSettings(0)("sValue")
        End If


        dvAllSettings.RowFilter = "sName = 'IsICD9CPTRequired'"
        If dvAllSettings.Count = 0 Then
            gblnIsICD9CPTRequired = False
        Else
            gblnIsICD9CPTRequired = dvAllSettings(0)("sValue")
        End If

        c1dgPatientDetailSize = C1dgPatientDetails.Width



        'Code added by Rohit not to show Message queue & GeneralMessage Queue on dashboard on 20110929
        mnuVwHL7MessageQueue.Visible = False
        mnuGeneralMessageQueue.Visible = False

        If timerLockScreen.Enabled = True Then
            Exit Sub
        End If

        'Find the MdiClient in the MdiWindow
        For Each c As Control In Me.Controls
            If TypeOf c Is MdiClient Then
                mdiClient = TryCast(c, MdiClient)
            End If
        Next

        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "DashBoard Load Event Started", gloAuditTrail.ActivityOutCome.Success)

        Dim f As New frmLoadDashBoard
        f.StartPosition = FormStartPosition.CenterScreen
        f.Activate()

        Try

            Me.Hide()
            f.Show()
            Dim frm As frmSplash = frmSplash.GetInstance()
            'frm.SetOpacity(0.0)
            frm.Hide()
            'frm.Dispose()

            CheckSettingForSmokingColumn()

            Me.Cursor = Cursors.WaitCursor

            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "Dash Board Load Start", gloAuditTrail.ActivityOutCome.Success)
            Me.Cursor = Cursors.WaitCursor
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "gloEMR Load Started", gloAuditTrail.ActivityOutCome.Success)
            timerLockScreen.Enabled = False
            'f.SetOpacity(255)
            f.lblDescription.Text = " Initializing FAX Driver ..."
            'f.SetOpacity(230)
            'bag round worker used for black ice initilse...

            'Added for check fax seetings for Black Ice issuie on windows8 as on 20121203 
            Dim oclsSettings As clsSettings = Nothing
            Try
                If gblnInternetFax = False Then
                    oclsSettings = New clsSettings()
                    Dim strOsName As String = oclsSettings.GetOSName()
                    If strOsName.Trim() <> String.Empty AndAlso strOsName.ToLower().Contains("windows 8") Then
                        blnWindows8 = True
                        MessageBox.Show("Legacy fax is not supported under Windows 8.  Please contact gloSupport for additional assistance.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        System.Windows.Forms.Application.Exit()
                    Else
                        If (BackgroundWorker_InitiliseFaxSetting.IsBusy = False) Then
                            BackgroundWorker_InitiliseFaxSetting.RunWorkerAsync()
                        End If
                    End If
                End If
            Catch ex As Exception
            Finally
                If Not IsNothing(oclsSettings) Then
                    oclsSettings.Dispose() : oclsSettings = Nothing
                End If
            End Try
            'End

            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Open, " GetDefaultsettings Start", gloAuditTrail.ActivityOutCome.Success)

            f.lblDescription.Text = " Loading Default Settings ..."
            'f.SetOpacity(205)
            System.Windows.Forms.Application.DoEvents()
            gloRegistrySetting.OpenSubKey(gloRegistrySetting.gstrSoftEMR, True)

            If IsNothing(gloRegistrySetting.GetRegistryValue("DefaultPatientCode")) = True Then
                gloRegistrySetting.SetRegistryValue("DefaultPatientCode", "")
            Else
                gstrPatientCode = gloRegistrySetting.GetRegistryValue("DefaultPatientCode")
            End If
            ' gloRegistrySetting.CloseRegistryKey()

            If gstrHelpProvider = "Client" Then
                Me.HelpComponent1.Mode = HelpComponent.ProviderMode.Client
            Else
                Me.HelpComponent1.Mode = HelpComponent.ProviderMode.Builder
            End If

            Call GetDefaultsettings()
            Call getICD10TransitionSettings()
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Open, " GetDefaultsettings END", gloAuditTrail.ActivityOutCome.Success)

            'gloCommunity Region
            'Show or Hide gloCommunity as per gblngloCommunity value as on 20120103
            mnuSharepoint.Visible = gblngloCommunity


            pnlBirthDayReminder.Left = Me.Width - pnlBirthDayReminder.Width
            pnlBirthDayReminder.Top = Me.Height

            mnuToolsVoiceCenter.Visible = False
            mnuDoctorSpeakerConfiguration.Visible = False
            sep18.Visible = False

            'Assign Context Menu
            gnSelectedProviderID = gnLoginProviderID '' MAYURI 20100206 on form load to load appointments of login provider'' 

            'Assign User Rights
            Call AssignUserRights()

            bClearDashboardSearch = GetClearDashboardSearchSetting()

            'Retrieve Registry settings for DI
            If gblnClinicDISetting Then
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.DrugInteraction, gloAuditTrail.ActivityType.Initialize, "Initializing ClsDrugInteraction Start", gloAuditTrail.ActivityOutCome.Success)
                Try
                    Using objSettings As New clsSettings
                        objSettings.InitializeDISettings()
                    End Using
                Catch ex As Exception
                    MsgBox(ex.Message, MsgBoxStyle.ApplicationModal + MsgBoxStyle.OkOnly, gstrMessageBoxCaption)
                Finally

                End Try
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.DrugInteraction, gloAuditTrail.ActivityType.Initialize, "Initializing ClsDrugInteraction END", gloAuditTrail.ActivityOutCome.Success)
            End If

            'To Load the Display Settings Of User On the client Machine
            f.lblDescription.Text = " Loading Display Setting ..."
            'f.SetOpacity(180)
            System.Windows.Forms.Application.DoEvents()
            IsFormLoading = True
            Call LoadDisplaySettings()
            'LoadFlexGroupDisplaySettings()
            IsFormLoading = False
            Call GetCheckedOutAppointmentSetting()

            ''Get Demographics settings
            Call GetPatientDemographicsSettings()
            Call GetAgeInDaysSettings()
            Call SetNavigationDefaultSetting()

            Me.CheckEPAUserIsInRole(gnLoginID)

            'Patient details
            f.lblDescription.Text = " Loading Patients information ..."
            'f.SetOpacity(155)
            'Provider & Patient details
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "Invoke Fill_ProvidersAndPatients Start", gloAuditTrail.ActivityOutCome.Success)
            System.Windows.Forms.Application.DoEvents()

            Call Fill_ProvidersAndPatients()
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "Invoke Fill_ProvidersAndPatients END", gloAuditTrail.ActivityOutCome.Success)

            gloC1FlexStyle.Style_Small(_flexGroup.Grid, 1)
            AddHandler _flexGroup.Grid.DoubleClick, AddressOf _flexGroupGrid_DoubleClick
            AddHandler _flexGroup.Grid.MouseDown, AddressOf _flexGroupGrid_MouseDown
            AddHandler _flexGroup.Grid.MouseMove, AddressOf _flexGroupGrid_MouseMove
            AddHandler _flexGroup._flexMouseUp, AddressOf _flexGroupGrid_MouseUp
            AddHandler _flexGroup.Grid.AfterScroll, AddressOf _flexGroupGrid_AfterScroll

            'lblLinkViewMoreTask.Parent.Visible = False
            _flexGroup.Grid.ScrollBars = ScrollBars.Both
            '_flexGroup.Grid.BorderStyle = BorderStyle.None
            _flexGroup.BorderStyle = BorderStyle.None

            'Tasks & messages
            Dim LoadLeftPanelThread As Thread = New Thread(LoadLeftPanelThreadEntry)
            LoadLeftPanelThread.IsBackground = True
            LoadLeftPanelThread.Start()



            'Call LoadMainPanel()
            ShowCheckInStatus()
            f.lblDescription.Text = " Loading Users Settings ..."
            'f.SetOpacity(130)
            System.Windows.Forms.Application.DoEvents()

            'Aniket: Change to resolve the voice-non voice login logout issue
            gblnSpeakerExists = False

            If gblnVoiceEnabled = True Then
                f.lblDescription.Text = " Loading Voice ..."
                'f.SetOpacity(105)
                System.Windows.Forms.Application.DoEvents()
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "gloEMR log for Voice Started", gloAuditTrail.ActivityOutCome.Success)

                '21-Feb-17 Aniket: Do not load natspeak.exe for non voice users
                'SetCompatibilityModules()
                If gblnVoiceEnabled = True Then
                    f.lblDescription.Text = " Loading Voice Engine ..."
                    'f.SetOpacity(80)
                    System.Windows.Forms.Application.DoEvents()
                    Call Load_VoiceEngine(1)
                Else
                    MessageBox.Show("Voice Facility will not be available", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Error)
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "gloEMR log for Voice Ended", gloAuditTrail.ActivityOutCome.Success)
                    sslbl_VoiceInfo.Text = "No Voice Facility"
                End If
            Else
                sslbl_VoiceInfo.Text = "No Voice Facility"
            End If

            blnIsload = False

            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.WINWORD, gloAuditTrail.ActivityType.Initialize, "Initializing WINWORD Start", gloAuditTrail.ActivityOutCome.Success)

            'To Initialize the gloEMR Word Instance for Word user Control and Voice
            f.lblDescription.Text = " Loading Templates ..."
            'f.SetOpacity(55)
            System.Windows.Forms.Application.DoEvents()

            Try
                InitWord()
            Catch ex As Exception
                'gloAuditTrail.gloAuditTrail.ExceptionLog("MainMenu_Load Error" & vbCrLf & vbCrLf & ex.Message, False)
                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            End Try


            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.WINWORD, gloAuditTrail.ActivityType.Initialize, "Initializing WINWORD End", gloAuditTrail.ActivityOutCome.Success)
            If gblnCheckNewVersion = True Then
                If Directory.Exists(gstrgloEMRAutoUpdatesPath) = True Then
                    With FileSystemWatcher1
                        .IncludeSubdirectories = False
                        .Path = gstrgloEMRAutoUpdatesPath
                        .Filter = "gloEMRDBUpdatesMessage.INI"
                        .EnableRaisingEvents = True
                    End With
                End If
            End If


            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Initialize, "SetFAXPrinterDefaultSettings Start", gloAuditTrail.ActivityOutCome.Success)

            f.lblDescription.Text = " Loading Fax Settings ..."
            'f.SetOpacity(30)
            System.Windows.Forms.Application.DoEvents()

            fsw_RecieveFAX.Path = gstrFAXReceivedDirectory
            fsw_RecieveFAX.EnableRaisingEvents = True

            'pnlFaxRecieved.Left = Me.Width - pnlFaxRecieved.Width - 10
            'pnlFaxRecieved.Top = Me.Height

            ''
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Initialize, "SetFAXPrinterDefaultSettings END", gloAuditTrail.ActivityOutCome.Success)


            Me.Cursor = Cursors.Default

            Try

                timerLockScreen.Enabled = True
                timerLockScreen.Interval = 15000 * gLockTime
                'TimeGetTime or GetTickcount is not returning exact milliseconds, but incrementing after x millisconds. We need to //calculate the x and add x to the time.

                'GLO2011-0015904 : Hourglass is appearing constantly
                'It throws Arithmatic overflow error so datatype was change from Int32 to long
                Dim firstTime As Long
                Dim secondTime As Long
                firstTime = timeGetTime()
                Do
                    secondTime = timeGetTime()
                Loop Until firstTime <> secondTime
                firstTime = secondTime
                Do
                    secondTime = timeGetTime()
                Loop Until firstTime <> secondTime
                precisionTime = ((secondTime - firstTime) * 2) And Int32.MaxValue
                If (precisionTime < 20) Then
                    precisionTime = 20
                End If

                firstTime = Nothing
                secondTime = Nothing

                'For Auto Updates of Messages & Tasks
                tmrMessages.Interval = gMessageUpdateTime * 60000
                tmrMessages.Start()

            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(" MainMenu_Load Error : " & ex.Message, False)
            End Try

            'Make the SureScript Panel Visible False
            pnlSurescriptAlert.Visible = False

            'if clinic is sure script enabled only then show popup

            If gblnSurescriptEnabled Then
                If gblnSurescriptAlert = True Then
                    FillMessage()
                End If
                tmrsurescriptAlert.Enabled = False
                tmrshowsurepnl.Enabled = False
                pnlSurescriptAlert.Left = Me.Width - (pnlSurescriptAlert.Width + 10)
                pnlSurescriptAlert.Top = Me.Height

                If gblnSurescriptAlert = True Then
                    strMessageAlerInterval = Split(gStrSurescriptAlertmin, " ")
                    If strMessageAlerInterval.GetValue(1) = "Sec" Then
                        tmrsurescriptAlert.Enabled = True
                        tmrsurescriptAlert.Interval = ((Convert.ToDouble(strMessageAlerInterval.GetValue(0))) * 1000)
                        tmrshowsurepnl.Enabled = True
                    Else
                        tmrsurescriptAlert.Enabled = True
                        tmrsurescriptAlert.Interval = (((Convert.ToDouble(strMessageAlerInterval.GetValue(0))) * 60) * 1000)
                        tmrshowsurepnl.Enabled = True
                    End If
                Else
                    tmrsurescriptAlert.Enabled = False
                    tmrshowsurepnl.Enabled = False
                End If
                mnuRefillRequest.Visible = True
                mnuVwErrorMessages.Visible = True
            Else
                mnuRefillRequest.Visible = False
                mnuVwErrorMessages.Visible = False
            End If

            If gblnIsSecureMsgEnable Then

                Dim DirectDBLayer As New DirectUserProvider_DBLayer
                Dim dtAssociation As DataTable
                dtAssociation = DirectDBLayer.GetProvidersByUserID(mdlGeneral.gnLoginID)
                If (IsNothing(dtAssociation) = False) Then


                    If dtAssociation.Rows.Count > 0 Then
                        If listDirectUserProviderAssociation Is Nothing Then
                            listDirectUserProviderAssociation = New List(Of gloSurescriptSecureMessage.DirectUserProviderAssociation)
                        End If

                        For Each DataRow As DataRow In dtAssociation.Rows
                            listDirectUserProviderAssociation.Add(New gloSurescriptSecureMessage.DirectUserProviderAssociation(DataRow))
                        Next
                    Else
                        If listDirectUserProviderAssociation IsNot Nothing Then
                            listDirectUserProviderAssociation.Clear()
                            listDirectUserProviderAssociation = Nothing
                        End If
                    End If
                    dtAssociation.Clear()
                    dtAssociation.Dispose()
                    dtAssociation = Nothing

                Else
                    If listDirectUserProviderAssociation IsNot Nothing Then
                        listDirectUserProviderAssociation.Clear()
                        listDirectUserProviderAssociation = Nothing
                    End If
                End If

                DirectDBLayer = Nothing
                If listDirectUserProviderAssociation IsNot Nothing Then
                    gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation = listDirectUserProviderAssociation
                Else
                    If gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation IsNot Nothing Then
                        gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation.Clear()
                        gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation = Nothing
                    End If
                End If
                gloSurescriptSecureMessage.SecureMessageProperties.DatabaseConnectionString = GetConnectionString()
                gloSurescriptSecureMessage.SecureMessageProperties.UserID = Convert.ToInt64(appSettings("UserID"))
                gloSurescriptSecureMessage.SecureMessageProperties.UserName = appSettings("UserName")
                gloSurescriptSecureMessage.SecureMessageProperties.ProviderID = appSettings("ProviderID")
                gloSurescriptSecureMessage.SecureMessageProperties.SiteID = gstrSiteID
                gloSurescriptSecureMessage.SecureMessageProperties.Location = gstrLocation
                gloSurescriptSecureMessage.SecureMessageProperties.AUSID = gstrAUSID
                gloSurescriptSecureMessage.SecureMessageProperties.ClinicName = gstrClinicName
                gloSurescriptSecureMessage.SecureMessageProperties.MessageBoxCaption = gstrMessageBoxCaption
                gloSurescriptSecureMessage.SecureMessageProperties.ClinicID = gnClinicID
                gloSurescriptSecureMessage.SecureMessageProperties.bIsPatientSavingEnabled = gblnIsPatientSavingEnabled
                gloSurescriptSecureMessage.SecureMessageProperties.bEnablePatientSavingsInbox = gblnEnablePatientSavingsInbox
                gloSurescriptSecureMessage.SecureMessageProperties.HasPatientSavingRights = gblnIsPatientSavingRights
                'As per discussion the View CCDA File on Save As should not get deleted
                'Added to get IsAutoDeleteCCDA value over NewMail form in Surescripts Secure Message
                'gloSurescriptSecureMessage.SecureMessageProperties.IsAutoDeleteCCDA = _isAutoDeleteCCDAFiles

                If gblnIsPatientSavingEnabled AndAlso gblnEnablePatientSavingsInbox AndAlso gblnIsPatientSavingRights Then
                    gloSurescriptSecureMessage.SecureMessageProperties.DisplayPatientSavingsInbox = True
                Else
                    gloSurescriptSecureMessage.SecureMessageProperties.DisplayPatientSavingsInbox = False
                End If

                Dim clsDb As New clsSecureMessageDB()

                '30-Apr-13 Aniket: Resolving Memory Leaks
                Dim dtProviderDetails As DataTable
                dtProviderDetails = clsDb.GetProviderDetails(appSettings("ProviderID"))

                If Not IsNothing(dtProviderDetails) Then
                    If dtProviderDetails.Rows.Count > 0 Then
                        gloSurescriptSecureMessage.SecureMessageProperties.ProviderDirectAddress = Convert.ToString(dtProviderDetails.Rows(0)("sDirectAddress"))
                        strProviderDirectAddress = Convert.ToString(dtProviderDetails.Rows(0)("sDirectAddress"))
                        gloSurescriptSecureMessage.SecureMessageProperties.ProviderName = Convert.ToString(dtProviderDetails.Rows(0)("sProviderName"))
                        gloSurescriptSecureMessage.SecureMessageProperties.SPID = Convert.ToString(dtProviderDetails.Rows(0)("sSPID"))

                        If listDirectUserProviderAssociation IsNot Nothing AndAlso strProviderDirectAddress.Length > 0 Then
                            Dim random As New Random
                            listDirectUserProviderAssociation.Add(New gloSurescriptSecureMessage.DirectUserProviderAssociation(random.Next(999999999) + random.Next(999999999), gloSurescriptSecureMessage.SecureMessageProperties.UserID, appSettings("ProviderID"), gloSurescriptSecureMessage.SecureMessageProperties.ProviderName, gloSurescriptSecureMessage.SecureMessageProperties.ProviderDirectAddress, gloSurescriptSecureMessage.SecureMessageProperties.SPID, True))
                            random = Nothing
                        End If
                    End If
                End If

                gloSurescriptSecureMessage.SecureMessageProperties.IsStagingServerEnable = gblnIsSecureStagingsever
                gloSurescriptSecureMessage.SecureMessageProperties.StagingServerUrl = gstrSecureStagingUrl
                gloSurescriptSecureMessage.SecureMessageProperties.ProductionServerUrl = gstrSecureProductionUrl

                gloSurescriptSecureMessage.SecureMessageProperties.objPatientExam = New clsPatientExams
                gloSurescriptSecureMessage.SecureMessageProperties.objPatientMessages = New clsMessage
                gloSurescriptSecureMessage.SecureMessageProperties.objPatientLetters = New clsPatientLetters
                gloSurescriptSecureMessage.SecureMessageProperties.objNurseNotes = New clsNurseNotes
                gloSurescriptSecureMessage.SecureMessageProperties.objHistory = New clsPatientHistory
                gloSurescriptSecureMessage.SecureMessageProperties.objLabs = New clsLabs
                gloSurescriptSecureMessage.SecureMessageProperties.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                gloSurescriptSecureMessage.SecureMessageProperties.objRxmed = New clsPatientDetails
                gloSurescriptSecureMessage.SecureMessageProperties.objOrders = New clsPatientDetails
                gloSurescriptSecureMessage.SecureMessageProperties.objProblemList = New clsPatientProblemList
                gloSurescriptSecureMessage.SecureMessageProperties.objCriteria = New DocCriteria
                gloSurescriptSecureMessage.SecureMessageProperties.objWord = New clsWordDocument

                '30-Apr-13 Aniket: Resolving Memory Leaks
                If IsNothing(dtProviderDetails) = False Then
                    dtProviderDetails.Dispose()
                    dtProviderDetails = Nothing
                End If

                If Not IsNothing(clsDb) Then
                    clsDb.Dispose()
                End If

            End If

            'Enable Show Task Reminder
            'slr free gloreminder if allocated previously and remove handler
            If Not IsNothing(ogloReminder) Then
                RemoveHandler ogloReminder.On_OpenItemClick, AddressOf On_ReminderOpenItemClick
                ogloReminder.Dispose()
                ogloReminder = Nothing
            End If

            ogloReminder = New gloReminder.gloReminder()

            'dhruv calling the open item under frmRemainder
            AddHandler ogloReminder.On_OpenItemClick, AddressOf On_ReminderOpenItemClick
            ogloReminder.Start()

            'pnlFaxRecieved.Visible = False


            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.DrugInteraction, gloAuditTrail.ActivityType.Load, "gloEMR Load Completed", gloAuditTrail.ActivityOutCome.Success)
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "Dash Board Load End", gloAuditTrail.ActivityOutCome.Success)

            'For changing the DMS Connection String.
            gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV2TempPath, Convert.ToInt64(gnLoginID), gClinicID, System.Windows.Forms.Application.StartupPath)

            gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory = gstrFAXOutputDirectory

            'CR00000126 : FAX for Terminal Server
            'New setting added for ReceivedFaxFolder useful only for Terminal Server 
            gloEDocumentV3.gloEDocV3Admin.gstrFaxReceivedDirectoryTS = gstrFAXReceivedDirectoryTS

            gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = gblnInternetFax
            gloUserControlLibrary.ClsUserControlGeneral.Connectionstring = GetConnectionString()

            'For Changing the DMS Hybrid database connection string
            gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV3TempPath, Convert.ToInt64(gnLoginID), gClinicID, System.Windows.Forms.Application.StartupPath)
            'End

            'internet fax
            gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory = gstrFAXOutputDirectory
            gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = gblnInternetFax
            'internet fax

            'For Max & Min Size for Splitting of Files
            gloEDocumentV3.gloEDocV3Admin.SetFileSize(gnDMSFileSizeMax, gnDMSFileSizeMin)

            'setting global Variables for CCD
            gloCCDLibrary.gloLibCCDGeneral.CCDFileGenerationPath = gstrCCDFilePath
            Dim objCDAWriterParameters As New gloCCDSchema.gloCDAWriterParameters
            gloCDAWriterParameters.CDAStyleSheetPath = gstrStyleSheetPath
            If Not IsNothing(objCDAWriterParameters) Then
                objCDAWriterParameters.Dispose()
                objCDAWriterParameters = Nothing
            End If

            gloCCDLibrary.gloLibCCDGeneral.Connectionstring = GetConnectionString()
            ScreeningResults.IsDefaultPrinterSet = gblnUseDefaultPrinter

            'Used for Setting the Default Location ''ApplicationSettings 
            SetSettingUsingAppSetting()


            'Check the subscriber validation
            gloRxHub.ClsgloRxHubGeneral.ConnectionString = GetConnectionString()
            gloRxHub.ClsgloRxHubGeneral.gnstrApplicationFilePath = gloSettings.FolderSettings.AppTempFolderPath

            'Load 270 EDI schema file
            'ofrmEDIGeneration = New gloRxHub.frmRxhub270EDIGeneration()
            'ofrmEDIGeneration.LoadEDIObject()

            If gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYAUTHENTICATION = "1" Then '''''SQL authentication is used
                Dim objEncryptDecrypt As New clsencryption
                gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYPASSWORD = objEncryptDecrypt.DecryptFromBase64String(gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYPASSWORD, constEncryptDecryptKey)
                gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYCONNECTIONSTRING = "Password=" & gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYPASSWORD & ";Persist Security Info=True;User ID=" & gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYUSERID & ";Initial Catalog=" & gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYDATABASENAME & ";Data Source=" & gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYSERVERNAME & ""
                '30-Apr-13 Aniket: Resolving Memory Leaks
                ''added for problem 00000512 memory leak
                objEncryptDecrypt.Dispose()
                objEncryptDecrypt = Nothing
            Else
                gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYCONNECTIONSTRING = "Integrated Security=SSPI;Persist Security Info=False;User ID=" & gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYUSERID & ";Initial Catalog=" & gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYDATABASENAME & ";Data Source=" & gloEMRGeneralLibrary.gloGeneral.clsgeneral.sFORMULARYSERVERNAME & ""
            End If

            ''Added for which portal is enabled IntuitPortal or gloStreamPatientPortal on 20130827
            If gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
                PortalType = "gloPatientPortal"
            End If

            'Load 270 EDI schema file
            MyMDIParent = Me

            'SSRS Menu Loading
            Load_SSRSMenu()

            'SSRS SERVICE INTIALISATION CODE
            Dim oThread As Thread
            oThread = New Thread(New ThreadStart(AddressOf UpdateSSRSDataSource))
            oThread.Start()

            'For Customized Reports
            Dim ocThread As Thread
            ocThread = New Thread(New ThreadStart(AddressOf UpdateCustomizedReportsDs))
            ocThread.Start()

            '26-Apr-13 Aniket: Resolving Bug #49616:
            blnLoad = True

            'timerEmail.Start()

            'Added by manoj jadhav on 20140526 for show/Hide intuit patient screen menu in respect of setting  
            mnuTools_IntuitPatient.Visible = mdlGeneral.gblnUSEINTUITINTERFACE

            checkActiveOBCases()

        Catch ex As Exception
            Me.Cursor = Cursors.Default
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

            Me.Show()
            Me.Activate()

            Call UpdateStatusBar()
            'ShowPatientDetails()

            'if user is security user 
            SecurityUserSettings()

            Dim m As New Message
            m.WParam = 1
            m.Msg = UnmanagedMethods.WM_ACTIVATEAPP
            WndProc(m)
            '     RegisterMyHotKey()
        End Try

        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Load, "Dash Board Load Event Ended", gloAuditTrail.ActivityOutCome.Success)

        AddpnlRightFillMouseHandler(pnlRightFill)
        AddpnlLeftMouseHandler(pnlLeft)


        Call LoadMainPanel()

        Me.Opacity = 100


        f.Hide()
        f.Dispose()
        f = Nothing

        blnsetGroupOnLoad = True
        cmbFilters_SelectedIndexChanged(Nothing, Nothing)
        blnsetGroupOnLoad = False
        LoadFlexGroupColumnDisplaySettings()

        gloPrintDialog.clsPrinterSettings.LoadPrinters(GetConnectionString(), gnLoginID)

        blnLoad = True

        Me.Cursor = Cursors.Default

        If gblIsNewInstallation OrElse Not gblIsDrugDBMigrated Then
            Me.mnuReports_DrugMigrationReport.Visible = False
        End If
    End Sub

    

    'code added for setting demographics color according to medical category
    Private Sub GetMedicalCategoryImage(Optional ByVal dtMedCat As DataTable = Nothing)

        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oPara As gloDatabaseLayer.DBParameters = Nothing
        Dim dtMedColor As DataTable = Nothing
        Dim strcolor As String = ""
        Dim strheaderColor As String = String.Empty
        Dim strbottompanelcolr As String = String.Empty
        Try

            With oDB
                oDB.Connect(False)

                oPara = New gloDatabaseLayer.DBParameters
                oPara.Add("@tvpMedicalCategory", dtMedCat, ParameterDirection.Input, SqlDbType.Structured)

                oPara.Add("@PatientId", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)





            End With

            oDB.Retrive("gsp_GetPatientMedicalCategoryColor", oPara, dtMedColor)
            oDB.Disconnect()

            If Not IsNothing(dtMedColor) Then
                If (dtMedColor.Rows.Count > 0) Then
                    strcolor = Convert.ToString(dtMedColor.Rows(0)("ImageColor"))
                    strheaderColor = Convert.ToString(dtMedColor.Rows(0)("DashboardDemoHeaderColor"))
                    strbottompanelcolr = Convert.ToString(dtMedColor.Rows(0)("DashboardDemoBottomColor"))

                End If
            End If
            If (strheaderColor.Trim() <> "") Then
                ''added for setting demographics color according to medical category

                pnlPatientDemographics.InnerContainerFormatStyle.BackColor = System.Drawing.ColorTranslator.FromHtml(strheaderColor)
                pnlPatientDemographics.InnerContainerFormatStyle.BackColorGradient = System.Drawing.ColorTranslator.FromHtml(strbottompanelcolr)

            Else

                pnlPatientDemographics.InnerContainerFormatStyle.BackColor = Color.FromArgb(255, 255, 255)
                pnlPatientDemographics.InnerContainerFormatStyle.BackColorGradient = Color.FromArgb(227, 241, 255)

            End If

            If strcolor.Contains("Dark") Then
                SetLabelColorForDarkBlue(True)
            Else
                SetLabelColorForDarkBlue(False)
            End If
        Catch ex As Exception
        Finally
            If Not IsNothing(oDB) Then
                oDB.Dispose()
                oDB = Nothing
            End If
            If Not IsNothing(dtMedColor) Then
                dtMedColor.Dispose()
                dtMedColor = Nothing
            End If
            If Not IsNothing(dtMedCat) Then
                dtMedCat.Dispose()
                dtMedCat = Nothing
            End If
            If oPara IsNot Nothing Then
                oPara.Clear()
                oPara.Dispose()
                oPara = Nothing
            End If
        End Try


    End Sub


    Private Sub SetLabelColorForDarkBlue(ByVal blndrkblue As Boolean)
        If blndrkblue = True Then
            lblMedicalCategory.ForeColor = Color.White
            Label69.ForeColor = Color.White
            lblLanguage.ForeColor = Color.White
            Label66.ForeColor = Color.White
            lblEthinicity.ForeColor = Color.White
            Label68.ForeColor = Color.White
            lblRace.ForeColor = Color.White
            Label67.ForeColor = Color.White
            lblRace.ForeColor = Color.White
            lbl_ShowLabStatus.ForeColor = Color.White
            lbl_LabStatus.ForeColor = Color.White
            lb_PatPhone.ForeColor = Color.White
            Label56.ForeColor = Color.White
            lbl_ShowPCPCpmPhone.ForeColor = Color.White
            lbl_PCPPracPhone.ForeColor = Color.White
            lbl_PCPComPhone.ForeColor = Color.White
            lbl_ShowPCPPracPhone.ForeColor = Color.White
            lbl_PCPPracPhone.ForeColor = Color.White
            lbl_ShowPCPbusPhone.ForeColor = Color.White
            lbl_PCPbusPhone.ForeColor = Color.White
            lbl_ShowStatus.ForeColor = Color.White
            lbl_Patientstatus.ForeColor = Color.White
            lblPD_PriCarePhysician.ForeColor = Color.White
            Label60.ForeColor = Color.White
            lblPD_Pharmacy.ForeColor = Color.White
            Label39.ForeColor = Color.White
            lblPD_PharmacyPhone.ForeColor = Color.White
            Label61.ForeColor = Color.White
            lbl_EmMobile.ForeColor = Color.White
            Label57.ForeColor = Color.White
            lbl_EmPhone.ForeColor = Color.White
            Label47.ForeColor = Color.White
            lbl_Emcontact.ForeColor = Color.White
            Label40.ForeColor = Color.White
            lblPD_Email.ForeColor = Color.White
            Label7.ForeColor = Color.White
            lblPD_Fax.ForeColor = Color.White
            label23.ForeColor = Color.White
            lblPD_HomePhone.ForeColor = Color.White
            Label9.ForeColor = Color.White
            lblPD_Mobile.ForeColor = Color.White
            Label8.ForeColor = Color.White
            lblPD_Gender.ForeColor = Color.White
            Label46.ForeColor = Color.White
            lblPD_Address.ForeColor = Color.White
            Label5.ForeColor = Color.White
            lblPD_Age.ForeColor = Color.White
            lblPD_DateOfBirth.ForeColor = Color.White
            lblPD_Name.ForeColor = Color.White
            lblPD_Code.ForeColor = Color.White
            '' added for 8070 prd workphone,occupation,business center
            lblworkphone.ForeColor = Color.White
            Label89.ForeColor = Color.White
            lblbusinesscenter.ForeColor = Color.White
            Label88.ForeColor = Color.White
            lbloccupation.ForeColor = Color.White
            Label87.ForeColor = Color.White
            lblPD_PharmacyAddress.ForeColor = Color.White
            lblPD_PharmacyAddr.ForeColor = Color.White
            lblPD_Provider.ForeColor = Color.White
            lblPrimaryInsurance.ForeColor = Color.White
            lblSecondaryInsurance.ForeColor = Color.White
            lbl_TertiaryInsurance.ForeColor = Color.White
            Label93.ForeColor = Color.White
            Label92.ForeColor = Color.White
            Label91.ForeColor = Color.White
            Label90.ForeColor = Color.White

        Else
            lblMedicalCategory.ForeColor = Color.Black
            Label69.ForeColor = Color.Black
            lblLanguage.ForeColor = Color.Black
            Label66.ForeColor = Color.Black
            lblEthinicity.ForeColor = Color.Black
            Label68.ForeColor = Color.Black
            lblRace.ForeColor = Color.Black
            Label67.ForeColor = Color.Black
            lblRace.ForeColor = Color.Black
            lbl_ShowLabStatus.ForeColor = Color.Black
            lbl_LabStatus.ForeColor = Color.Black
            lb_PatPhone.ForeColor = Color.Black
            Label56.ForeColor = Color.Black
            lbl_ShowPCPCpmPhone.ForeColor = Color.Black
            lbl_PCPPracPhone.ForeColor = Color.Black
            lbl_PCPComPhone.ForeColor = Color.Black
            lbl_ShowPCPPracPhone.ForeColor = Color.Black
            lbl_PCPPracPhone.ForeColor = Color.Black
            lbl_ShowPCPbusPhone.ForeColor = Color.Black
            lbl_PCPbusPhone.ForeColor = Color.Black
            lbl_ShowStatus.ForeColor = Color.Black
            lbl_Patientstatus.ForeColor = Color.Black
            lblPD_PriCarePhysician.ForeColor = Color.Black
            Label60.ForeColor = Color.Black
            lblPD_Pharmacy.ForeColor = Color.Black
            Label39.ForeColor = Color.Black
            lblPD_PharmacyPhone.ForeColor = Color.Black
            Label61.ForeColor = Color.Black
            lbl_EmMobile.ForeColor = Color.Black
            Label57.ForeColor = Color.Black
            lbl_EmPhone.ForeColor = Color.Black
            Label47.ForeColor = Color.Black
            lbl_Emcontact.ForeColor = Color.Black
            Label40.ForeColor = Color.Black
            lblPD_Email.ForeColor = Color.Black
            Label7.ForeColor = Color.Black
            lblPD_Fax.ForeColor = Color.Black
            label23.ForeColor = Color.Black
            lblPD_HomePhone.ForeColor = Color.Black
            Label9.ForeColor = Color.Black
            lblPD_Mobile.ForeColor = Color.Black
            Label8.ForeColor = Color.Black
            lblPD_Gender.ForeColor = Color.Black
            Label46.ForeColor = Color.Black
            lblPD_Address.ForeColor = Color.Black
            Label5.ForeColor = Color.Black
            lblPD_Age.ForeColor = Color.Black
            lblPD_DateOfBirth.ForeColor = Color.Black
            lblPD_Name.ForeColor = Color.Black
            lblPD_Code.ForeColor = Color.Black
            '' added for 8070 prd workphone,occupation,business center
            lblworkphone.ForeColor = Color.Black
            Label89.ForeColor = Color.Black
            lblbusinesscenter.ForeColor = Color.Black
            Label88.ForeColor = Color.Black
            lbloccupation.ForeColor = Color.Black
            Label87.ForeColor = Color.Black
            lblPD_PharmacyAddress.ForeColor = Color.Black
            lblPD_PharmacyAddr.ForeColor = Color.Black
            lblPD_Provider.ForeColor = Color.Black
            lblPrimaryInsurance.ForeColor = Color.Black
            lblSecondaryInsurance.ForeColor = Color.Black
            lbl_TertiaryInsurance.ForeColor = Color.Black
            Label93.ForeColor = Color.Black
            Label92.ForeColor = Color.Black
            Label91.ForeColor = Color.Black
            Label90.ForeColor = Color.Black
        End If


    End Sub


    Private Sub SetNavigationDefaultSetting()
        _DefaultNavigation = "Appointment"
        Try
            If gloRegistrySetting.OpenSubKey(gloRegistrySetting.gstrSoftEMR) = False Then
                Exit Sub
            End If
            gloRegistrySetting.OpenSubKey(gloRegistrySetting.gstrSoftEMR, True)
            If IsNothing(gloRegistrySetting.GetRegistryValue("DefaultNavigation")) = True Then
                gloRegistrySetting.SetRegistryValue("DefaultNavigation", "Appointment")
            Else
                _DefaultNavigation = gloRegistrySetting.GetRegistryValue("DefaultNavigation")
            End If
            Select Case _DefaultNavigation
                Case "Appointment"
                    _DefaultNavigation = NAV_APPOINTMENT
                Case "Triage"
                    _DefaultNavigation = NAV_TRIAGE
                Case Else
                    _DefaultNavigation = NAV_APPOINTMENT
                    gloRegistrySetting.SetRegistryValue("DefaultNavigation", "Appointment")
            End Select
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ''slr close registry
            gloRegistrySetting.CloseRegistryKey()
        End Try
    End Sub

    Private Sub LoadLeftPanel()


        If InvokeRequired Then
            Try
                Invoke(New LoadLeftPanelDelegate(AddressOf LoadLeftPanel))
            Catch ex As Exception

            End Try
        Else
            Try

                _isShowDialogueForm = True
                RegisterMyHotKey()

                dtDashboardUpdateMst = GetDashboardUpdateMst()
                If ((IsNothing(dtDashboardUpdateMst) = False) AndAlso (dtDashboardUpdateMst.Rows.Count > 0)) Then
                    Dim NewUpdateDateTime As DateTime
                    For Each ORow As DataRow In dtDashboardUpdateMst.Rows
                        Select Case ORow("UpdateType").ToString.ToUpper
                            Case "MESSAGES"
                                NewUpdateDateTime = ORow("UpdateDateTime")
                                If (NewUpdateDateTime <> Mesages_OldUpdateDateTime) Then
                                    ShowMessages_New()
                                End If
                                Mesages_OldUpdateDateTime = NewUpdateDateTime
                            Case "TASK"
                                NewUpdateDateTime = ORow("UpdateDateTime")
                                If (NewUpdateDateTime <> Tasks_OldUpdateDateTime) Then
                                    ShowTasks()
                                End If
                                Tasks_OldUpdateDateTime = NewUpdateDateTime
                            Case "UNFINISHEDEXAMS"
                                NewUpdateDateTime = ORow("UpdateDateTime")
                                If (NewUpdateDateTime <> UnfinishedExams_OldUpdateDateTime) Then
                                    ShowUnfinishedExams()
                                End If
                                UnfinishedExams_OldUpdateDateTime = NewUpdateDateTime
                            Case "APPOINTMENT"
                                NewUpdateDateTime = ORow("UpdateDateTime")
                                If (NewUpdateDateTime <> Appointment_OldUpdateDateTime) Then
                                    If IsNothing(_DefaultNavigation) = False Then
                                        If _DefaultNavigation.ToUpper.Contains(NAV_APPOINTMENT.ToUpper()) Then
                                            LoadLeftNavigationPanel()
                                        End If
                                    End If
                                End If
                                Appointment_OldUpdateDateTime = NewUpdateDateTime
                            Case "TRIAGE"
                                NewUpdateDateTime = ORow("UpdateDateTime")
                                If (NewUpdateDateTime <> Triage_Exams_OldUpdateDateTime) Then
                                    If IsNothing(_DefaultNavigation) = False Then
                                        If _DefaultNavigation.ToUpper.Contains(NAV_TRIAGE.ToUpper()) Then
                                            LoadLeftNavigationPanel()
                                        End If
                                    End If
                                End If
                                Triage_Exams_OldUpdateDateTime = NewUpdateDateTime
                            Case "DIRECTMESSAGING"                                
                                If gblnIsSecureMsgEnable Then
                                    If Not String.IsNullOrWhiteSpace(gloSurescriptSecureMessage.SecureMessageProperties.ProviderDirectAddress) OrElse gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation IsNot Nothing Then
                                        NewUpdateDateTime = ORow("UpdateDateTime")
                                        If (NewUpdateDateTime <> DirectMessaging_OldUpdateDateTime) Then
                                            ShowDirectMessagesCount()
                                        End If
                                        DirectMessaging_OldUpdateDateTime = NewUpdateDateTime
                                    End If
                                End If
                            Case Else
                        End Select
                    Next

                    If (IsNothing(_DefaultNavigation) = False) AndAlso (IsNothing(pnlNavigator) = False) Then
                        If _DefaultNavigation.ToUpper.Contains(NAV_APPOINTMENT.ToUpper()) Then

                            If (pnlNavigator.SelectedPanel.Name.ToUpper.Trim().Contains(NAV_APPOINTMENT.ToUpper()) = False) AndAlso (IsNothing(pnlNav_Appointments) = False) Then
                                isMessageTimerCallForPanelSelection = True
                                pnlNavigator.SelectedPanel = pnlNav_Appointments
                                isMessageTimerCallForPanelSelection = False
                            End If
                        Else
                            If (pnlNavigator.SelectedPanel.Name.ToUpper.Trim().Contains(NAV_TRIAGE.ToUpper()) = False) AndAlso (IsNothing(pnlNav_Triage) = False) Then
                                isMessageTimerCallForPanelSelection = True
                                pnlNavigator.SelectedPanel = pnlNav_Triage
                                isMessageTimerCallForPanelSelection = False
                            End If
                        End If
                    End If
                Else
                    If (IsNothing(dtDashboardUpdateMst) = False) Then
                        If (dtDashboardUpdateMst.Rows.Count = 0) Then
                            InsertRecordsIntoDashboardUpdateMst()
                        End If
                    End If
                    ShowMessages_New()
                    ShowTasks()
                    ShowUnfinishedExams()
                    LoadLeftNavigationPanel()

                    If gblnIsSecureMsgEnable Then
                        If Not String.IsNullOrWhiteSpace(gloSurescriptSecureMessage.SecureMessageProperties.ProviderDirectAddress) OrElse gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation IsNot Nothing Then
                            ShowDirectMessagesCount()
                        End If
                    End If
                End If
            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.None, ex, gloAuditTrail.ActivityOutCome.Failure)
            Finally
                If (IsNothing(dtDashboardUpdateMst) = False) Then
                    dtDashboardUpdateMst.Dispose()
                    dtDashboardUpdateMst = Nothing
                End If
                _isShowDialogueForm = False

            End Try
        End If
    End Sub

    Private Sub LoadMainPanel()
        'tsbtn_History.BackgroundImage = tsbtn_Selected.BackgroundImage
        '  SelectedPatientDetail = PatientDetails.History

        ''Bug #67150 ( Modified): 00000555 : Patient Lock Chart Issue
        'To hide Patient alerts if locked patient is selected while log in
        Dim oclsPatReg As New ClsPatientRegistrationDBLayer
        ''Bug #75677: gloEMR - Dashboard - Application is showing different patient information in demographics panel and patient list and patient details panel.
        Call Load_PatientControl()
        gstrPatientStatus = oclsPatReg.PatientStatus(gnPatientID, "").ToString()
        Call LoadSelectedPatientInfo(gnPatientID)
        LoadSelectedPatientInfo_Part2(gnPatientID)
        If Not IsNothing(oclsPatReg) Then
            oclsPatReg.Dispose()
            oclsPatReg = Nothing
        End If
        SetLicenseModule()
    End Sub

    Private Function Load_PatientControl(Optional ByVal _IsPatientProviderChanged As Boolean = False) As Boolean
        oPatientListControl.DatabaseConnection = GetConnectionString()
        oPatientListControl.SelectedPatientID = gnPatientID
        oPatientListControl.FillPatients()
        oPatientListControl.IsSecurityUser = gblnSecurityUser
        ''condition Added on 20110301-to check whether patient provider is changed if it is then don't change npatientid as it is in different provider's list
        If _IsPatientProviderChanged = False Then
            gnPatientID = oPatientListControl.PatientID
            gstrPatientCode = oPatientListControl.PatientCode
        End If
        Return Nothing
    End Function

    Private Sub LoadSelectedPatientInfo(ByVal SelectedPatientID As Int64)

        'clstrace.WriteInfo("Entering Pranit")
        If InvokeRequired Then
            Try
                Dim AddressOfLoadSelectedPatientInfo As LoadSelectedPatientInfoDelegate = New LoadSelectedPatientInfoDelegate(AddressOf LoadSelectedPatientInfo)
                Invoke(AddressOfLoadSelectedPatientInfo, New Object() {SelectedPatientID})
            Catch ex As Exception

            End Try
        Else
            Me.Cursor = Cursors.WaitCursor
            'Bug #86857: 00000956 : Resolving patient context lock screen issue
            'oPatientListControl.SelectedPatientID = 0
            gnPatientID = SelectedPatientID
            gblnProviderDisable = IsPatientProviderDisabled(gnPatientID)
            appSettings("PatientID") = gnPatientID.ToString
            appSettings("DefaultPrinter") = gblnUseDefaultPrinter

            '26-Apr-13 Aniket: Resolving Bug #49616:
            If blnLoad = False Then
                Dim oclsPatReg As New ClsPatientRegistrationDBLayer
                gstrPatientStatus = oclsPatReg.PatientStatus(oPatientListControl.PatientID, "").ToString()
                oclsPatReg.Dispose()
                oclsPatReg = Nothing
            End If

            Call SetButtonsOnOff()

            C1dgPatientDetails.DataSource = Nothing
            'C1dgPatientDetails.Clear(ClearFlags.All)
            gloC1FlexStyle.Style(C1dgPatientDetails)
            C1dgPatientDetails.AllowEditing = False
            C1dgPatientDetails.AllowSorting = AllowSortingEnum.SingleColumn
            C1dgPatientDetails.ScrollBars = ScrollBars.None
            C1dgPatientDetails.Rows.Count = 1
            If gbAllowEmergencyAccess = False Then
                '  If CheckPatientStatus(gnPatientID, , , True) = False Then
                If CheckPatientStatus_new(gstrPatientStatus, True) = False Then
                    Call FillDemographicInformation()
                    oPatientCards.Clear()
                    picPC_Cards.Image = Nothing
                    picPC_Cards.Tag = Nothing
                    c1PatientStatus.Rows.Count = 1
                    Call ResetSearchControls()
                    Me.Cursor = Cursors.Default
                    Exit Sub
                End If
            End If
            Call FillDemographicInformation()
            Call ShowPatientDetails(True)
            Call SetYesLab()
            Dim ActivePanel As String = Convert.ToString(pnlPatientCard.Tag)
            If ActivePanel = "CARDS" Then
                Call FillCardInformation()
            End If
            Me.Cursor = Cursors.Default
        End If
    End Sub

    Private Sub LoadSelectedPatientInfo_Part2(ByVal SelectedPatientID As Int64)
        Try
            UpdateLog("ShowPatientAlerts : START")
            Call ShowPatientAlerts()
            UpdateLog("ShowPatientAlerts : END")
            Call Get_ClinicEnvironment()
            'Call Get_PatientLocationStatus()
            Call GetPatientConfidentialInfo()
            Call ShowPatientStatus()
            SetICD10TransitionFlag(SelectedPatientID)
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Load, "Error while Fill Selected Patient Info  " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub
    Private Sub SetICD10TransitionFlag(ByVal SelectedPatientID As Int64)

        UpdateLog("START - SetICD10TransitionFlag")
        Dim dtICDTransition As New DataTable()
        Dim oParam As New gloDatabaseLayer.DBParameters
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())

        Try

            If IsAccess(True) = False Then
                Exit Sub
            End If

            oDB.Connect(False)
            oParam.Add("@nPatientID", SelectedPatientID, ParameterDirection.Input, SqlDbType.BigInt)
            oDB.Retrive("gsp_GetPatientTransitionSetting", oParam, dtICDTransition)
            oDB.Disconnect()
            If dtICDTransition.Rows.Count > 0 Then
                gblnIcd10Transition = Convert.ToBoolean(dtICDTransition.Rows(0)("ISTransitionDone"))
                If (gblnIcd10Transition) Then
                    gdtIcd10Transition = Convert.ToDateTime(dtICDTransition.Rows(0)("TransitionDate"))
                End If
                gloEMRGeneralLibrary.gloGeneral.clsgeneral.gblnIcd10Transition = gblnIcd10Transition
                gloCCDLibrary.gloLibCCDGeneral.gblnCCDAICD10Transition = gblnIcd10Transition
            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Load, "Error while Setting ICD10TransitionFlag" & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
        Finally

            If Not IsNothing(oParam) Then
                oParam.Dispose()
                oParam = Nothing
            End If

            If Not IsNothing(oDB) Then
                oDB.Dispose()
                oDB = Nothing
            End If
            If Not IsNothing(dtICDTransition) Then
                dtICDTransition.Dispose()
                dtICDTransition = Nothing
            End If
        End Try
        UpdateLog("END - SetICD10TransitionFlag")
    End Sub

    Private Sub LoadLeftNavigationPanel()
        If IsNothing(_DefaultNavigation) = False Then
            If _DefaultNavigation.ToUpper.Contains(NAV_APPOINTMENT.ToUpper()) Then
                If pnlNavigator.SelectedPanel.Equals(pnlNav_Appointments) Then
                    Call ShowAppointments()
                Else
                    'pnlNavigator.
                    If (pnlNavigator.Contains(pnlNav_Appointments) = True) Then
                        isMessageTimerCallForPanelSelection = True
                        pnlNavigator.SelectedPanel = pnlNav_Appointments
                        isMessageTimerCallForPanelSelection = False
                    End If
                End If
                Call SetTriageCounter()
            ElseIf _DefaultNavigation.ToUpper.Contains(NAV_TRIAGE.ToUpper()) Then
                If pnlNavigator.SelectedPanel.Equals(pnlNav_Triage) Then
                    Call ShowTriage()
                Else
                    If (pnlNavigator.Contains(pnlNav_Triage) = True) Then
                        isMessageTimerCallForPanelSelection = True
                        pnlNavigator.SelectedPanel = pnlNav_Triage
                        isMessageTimerCallForPanelSelection = False
                    End If
                End If
                Call SetAppointmentCounter()
            End If
        End If
    End Sub




    Private Sub SetAppointmentCounter()

        '30-Apr-13 Aniket: Resolving Memory Leaks
        Dim dt As DataTable = Nothing

        Try
            'To set the Appointment Counter.
            dt = GetAppointments()
            If IsNothing(dt) = False Then
                Me.pnlNav_Appointments.Text = "Appointments" & " [" & dt.Rows.Count.ToString & "]"
            End If

        Catch ex As Exception

        Finally
            If Not IsNothing(dt) Then
                dt.Dispose()
                dt = Nothing
            End If
        End Try

    End Sub

    Private Sub SetTriageCounter()
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParam As gloDatabaseLayer.DBParameters = Nothing
        Dim dtTriage As New DataTable()
        Try
            oDB.Connect(False)
            oParam = New gloDatabaseLayer.DBParameters
            oParam.Add("@UserID", gnLoginID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@blnfinished ", 0, ParameterDirection.Input, SqlDbType.Int)
            oDB.Retrive("TRI_ShowUserTriage", oParam, dtTriage)
            oDB.Disconnect()
            If IsNothing(dtTriage) = False Then
                pnlNav_Triage.Text = "Triage [" & dtTriage.Rows.Count & "]"
            End If
        Catch ex As Exception
        Finally
            If Not IsNothing(dtTriage) Then
                dtTriage.Dispose()
                dtTriage = Nothing
            End If

            If Not IsNothing(oParam) Then
                oParam.Dispose()
                oParam = Nothing
            End If
            If Not IsNothing(oDB) Then
                oDB.Dispose()
                oDB = Nothing
            End If
        End Try
    End Sub


    Private Sub SelectPatientOnDashboard(ByVal SelectedPatientID As Long)
        Dim isPatientInList As Boolean = False
        isPatientInList = oPatientListControl.IsPatientInList(SelectedPatientID)
        If (isPatientInList) Then
            oPatientListControl.SelectPatient(SelectedPatientID)
        Else
            If bClearDashboardSearch AndAlso Not String.IsNullOrEmpty(oPatientListControl.txtSearch.Text) Then
                Try
                    RemoveHandler oPatientListControl.txtSearch.TextChanged, AddressOf oPatientListControl.txtSearch_TextChanged
                Catch ex As Exception
                    ex = Nothing
                End Try

                oPatientListControl.txtSearch.Clear()
                AddHandler oPatientListControl.txtSearch.TextChanged, AddressOf oPatientListControl.txtSearch_TextChanged
            End If
            'Bug #104880: gloEMR : Patient Search : Patient list panel not loading all patient associated to selected provider 

            oPatientListControl.FillPatients()
            oPatientListControl.AddPatientInList(SelectedPatientID)
            ' If (isPatientInList) Then
            LoadSelectedPatientInfo(SelectedPatientID)
            LoadSelectedPatientInfo_Part2(SelectedPatientID)
            'End If
            If bClearDashboardSearch AndAlso SelectedPatientID <> oPatientListControl.SelectedPatientID Then
                oPatientListControl.RemovePatientFocusInGrid()
            End If

        End If
    End Sub

    Private Sub UpdateSSRSDataSource()
        Try
            Dim blnSqlAuthentication As String = appSettings("WindowAuthentication")
            If blnSqlAuthentication = True Then
                blnSqlAuthentication = False
            Else
                blnSqlAuthentication = True
            End If
            gloSSRS.Create_Datasource("dsEMR", "gloEMR", GetConnectionString(), gstrSQLServerName, gstrDatabaseName, blnSqlAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR, True)

            blnSqlAuthentication = Nothing

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

    Private Sub UpdateCustomizedReportsDs()
        Try
            Dim blnSqlAuthentication As String = appSettings("WindowAuthentication")
            If blnSqlAuthentication = True Then
                blnSqlAuthentication = False
            Else
                blnSqlAuthentication = True
            End If
            gloSSRS.Create_Datasource("CCHIT Working", "gloCustomizedSSRS", GetConnectionString(), gstrSQLServerName, gstrDatabaseName, blnSqlAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR, True)

            blnSqlAuthentication = Nothing

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

#Region "Function For SSRS Menu"
    'For SSRS Report Menu Load 
    Function PDataset(ByVal select_statement As String) As DataSet

        Dim _con As New SqlConnection(GetConnectionString())
        Dim ad As New SqlDataAdapter(select_statement, _con)
        Dim ds As New DataSet()

        ad.Fill(ds)

        '30-Apr-13 Aniket: Resolving Memory Leaks
        If IsNothing(ad) = False Then
            ad.Dispose()
            ad = Nothing
        End If

        _con.Close()
        _con.Dispose()
        _con = Nothing

        Return ds

    End Function

    Public Sub Load_SSRSMenu()
        Dim PrSet As DataSet = PDataset("SELECT ReportsID,ReportsParentID,ReportName,ReportFileName FROM SSRSReports_MST where ReportType = '" & _sReportType & "'  Order By Reportsortorder")
        Try
            For Each dr As DataRow In PrSet.Tables(0).Rows
                If CInt(dr("ReportsParentID")) <> 0 AndAlso CInt(dr("ReportsParentID")) = 2 Then
                    Toolitems = New ToolStripMenuItem()
                    Toolitems.Text = dr("ReportName").ToString()
                    Toolitems.Tag = dr("ReportFileName").ToString()
                    Toolitems.ForeColor = System.Drawing.Color.FromArgb(CInt(CByte(31)), CInt(CByte(73)), CInt(CByte(125)))
                    If Convert.ToString(dr("ReportFileName")) = "" Then
                        Toolitems.Image = Global.gloEMR.My.Resources.SSRS_Report
                    Else
                        Toolitems.Image = Global.gloEMR.My.Resources.New_Report
                    End If
                    Toolitems.ImageAlign = ContentAlignment.MiddleCenter
                    Toolitems.TextImageRelation = TextImageRelation.ImageBeforeText
                    AddHandler Toolitems.Click, AddressOf MenuItemClickHandler
                    mnuReports.DropDownItems.Add(Toolitems)
                    FillChildMenu(Toolitems, dr("ReportsID").ToString())
                End If
            Next
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
        Finally
            If Not IsNothing(PrSet) Then
                PrSet.Dispose()
                PrSet = Nothing
            End If
        End Try
    End Sub


    Public Function FillChildMenu(ByVal parent As ToolStripMenuItem, ByVal IID As String) As Integer

        Dim child As ToolStripMenuItem = Nothing
        Dim ds As DataSet = Nothing

        Try

            ds = PDataset("SELECT ReportsID,ReportName,ReportFileName FROM SSRSReports_MST WHERE ReportsParentID =" & IID & " And ReportType = '" & _sReportType & "' Order By Reportsortorder  ")
            If (IsNothing(ds) = False) Then


                If ds.Tables(0).Rows.Count > 0 Then

                    For Each dr As DataRow In ds.Tables(0).Rows
                        child = New ToolStripMenuItem()
                        child.Text = dr("ReportName").ToString().Trim()
                        If Convert.ToString(dr("ReportFileName")) = "" Then
                            child.Image = Global.gloEMR.My.Resources.SSRS_Report
                        Else
                            child.Image = Global.gloEMR.My.Resources.New_Report
                        End If
                        child.ImageAlign = ContentAlignment.MiddleCenter
                        child.TextImageRelation = TextImageRelation.ImageBeforeText
                        child.Tag = dr("ReportFileName").ToString().Trim()
                        Dim temp As String = dr("ReportsID").ToString()
                        child.ForeColor = System.Drawing.Color.FromArgb(CInt(CByte(31)), CInt(CByte(73)), CInt(CByte(125)))
                        AddHandler child.Click, AddressOf MenuItemClickHandler
                        parent.DropDownItems.Add(child)
                        FillChildMenu(child, temp)
                    Next
                    Return 0
                Else
                    Return 0
                End If
            Else
                Return 0
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            Return 0

        Finally

            '30-Apr-13 Aniket: Resolving Memory Leaks
            If IsNothing(ds) = False Then
                ds.Dispose()
                ds = Nothing
            End If

        End Try

    End Function

#Region "Menu Item Click Event"

    Private Sub MenuItemClickHandler(ByVal sender As Object, ByVal e As EventArgs)

        Dim clickedItem As ToolStripMenuItem = DirectCast(sender, ToolStripMenuItem)

        '30-Jan-15 Aniket: Resolving Bug #77784: gloEMR > Reports >Add on Reports> Try to generate report showing message 'The item /foaOl_gloSuiteReports/Appointment Template List cannot be found. (rsltemNotFound) '
        If gloSSRS.CheckReportExists(clickedItem.Text, GetConnectionString()) = True Then

            If Convert.ToString(clickedItem.Tag) <> "" Then
                Try
                    ofrmSSRS = New gloReports.frmEMRSSRSViewer
                    ofrmSSRS.reportName = clickedItem.Text
                    ofrmSSRS.reportTitle = clickedItem.Text
                    ofrmSSRS.Conn = GetConnectionString()
                    ofrmSSRS.IsgloStreamReport = False
                    ofrmSSRS.MdiParent = Me
                    ofrmSSRS.WindowState = FormWindowState.Maximized
                    ofrmSSRS.Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                Catch ex As Exception
                    pnlMainToolBar.Visible = True
                    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If

        Else
            MessageBox.Show("'" & clickedItem.Text & "' report is not available on the report server.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
        End If



    End Sub

#End Region

#End Region
    'dhruv calling the open item under Remainder
    Private Sub On_ReminderOpenItemClick(ByVal sender As Object, ByVal e As EventArgs, ByVal e2 As gloReminder.gloReminder.OpenItemClickArgs)
        Try
            ofrmTask = New gloTaskMail.frmTask(GetConnectionString, e2.TaskID)
            AddHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange ''added for taskincident to autoclose task window or not depend on setting 
            ofrmTask.IsEMREnable = True
            ofrmTask._ReminderTask = True '//Developer:Pradeep/Date:01/09/2012/Bug ID:18512/Reason:from textbox was showing blank
            ofrmTask.ShowDialog(IIf(IsNothing(ofrmTask.Parent), Me, ofrmTask.Parent))
            'Bug #82464: 00000909: Task screen not opening respective screen
            RemoveHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange     'SLR: remove handler

            HandlesTaskChange(Nothing, Nothing, ofrmTask.e2Task)
            '//Developer:Pradeep/Date:02/22/2011/Bug ID/PRD Name/Salesforce Case: 21248/Reason:creating multiple task 
            If ofrmTask._IsAcceptClick = True Then
                Dim ofrm As gloReminder.frmReminder = gloReminder.frmReminder.GetInstance()
                If Not IsNothing(ofrm) Then
                    ofrm.UpdateReminderListView()
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(ofrmTask) Then
                'RemoveHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange
                ofrmTask.Dispose()
                ofrmTask = Nothing
                _objfrmtask = Nothing
            End If
        End Try
    End Sub

    Private Sub DashBoard_MdiChildActivate(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.MdiChildActivate

        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "DashBoard MdiChildActivate Event Started", gloAuditTrail.ActivityOutCome.Success)
        'Dim MainItem As gloEMR.MainMenu = Nothing
        'Try
        '    MainItem = DirectCast(sender, gloEMR.MainMenu)
        'Catch ex As Exception

        'End Try
        'If (IsNothing(MainItem) = False) Then
        '    If (MainItem.Text = "gloEMR") Then
        '        UnRegisterMyHotKey()
        '    Else
        '        RegisterMyHotKey()
        '    End If

        'Else
        '    RegisterMyHotKey()
        'End If
        'TO MAINTAIN MDI CHILD FORMS STACK
        Dim _FormName As String
        If Not Me.ActiveMdiChild Is Nothing Then
            _FormName = Me.ActiveMdiChild.Name
            If Not _ChildFormsStack.Contains(_FormName) Then
                _ChildFormsStack.Push(_FormName)
            End If
        End If
        'END

        Try
            IExam = Nothing
            If IsNothing(Me.ActiveMdiChild) = True Then
                'Make Lock Screen button visible
                ShowHideMainMenu(True, True)
                picLockScreen.Visible = True
                Me.pnlMainMenu.Visible = True
                If mnuToolsToolbar.Checked = True Then
                    pnlMainToolBar.Visible = True
                    tlbStripMain.Visible = True
                Else
                    pnlMainToolBar.Visible = False
                End If
                If mnuToolsStatusbar.Checked = True Then
                    pnlMainStatusBar.Visible = True
                Else
                    pnlMainStatusBar.Visible = False
                End If

                If pnlSurescriptAlert.Visible = True Then
                    pnlSurescriptAlert.BringToFront()
                End If

                ''Resolved issue #88517-(getDate)gloEMR(gloTerminal): Application gives exception on calendar
                '24-Mar-16 Aniket: Reverting the above change as it causes screen flickering issue
                System.Windows.Forms.Application.DoEvents()

                If gblnVoiceEnabled = True AndAlso gblnSpeakerExists = True Then
                    Try
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "Voicemenu cleanup started on MDI Child activate", gloAuditTrail.ActivityOutCome.Success)

                        If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                            DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                        End If

                        If Not IsNothing(vVoiceMenu) Then
                            vVoiceMenu.Remove(1)
                            vVoiceMenu.Remove(2)
                            vVoiceMenu.Active = False
                            System.Runtime.InteropServices.Marshal.ReleaseComObject(vVoiceMenu)
                            vVoiceMenu = Nothing
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Error at MainMenu_MdiChildActivate - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
                    End Try
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Voicemenu cleanup finished on MDI Child activate", gloAuditTrail.ActivityOutCome.Success)
                End If

                If gblnPatientAdded = True Then
                    Call oPatientListControl.FillPatients()
                    If gstrPatientCode.Trim <> "" Then
                        gnPatientID = GetPatientID(gstrPatientCode)
                    End If
                    gblnPatientAdded = False
                End If

                'Dim nCount As Integer
                'Incident 00005646 : System Hangs-up in exam opens from Dashboard PatientDetails Panel.
                Try
                    Call ShowPatientAllDetails(gnPatientID)
                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.None, "Error at MainMenu_MdiChildActivate - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
                    

                End Try
            Else
                'If Mdi Child is Active 
                Me.ActiveMdiChild.WindowState = FormWindowState.Maximized

                If gblnVoiceEnabled = True AndAlso gblnSpeakerExists = True Then

                    If Me.ActiveMdiChild.Name = "frmTemplateGallery" Or Me.ActiveMdiChild.Name = "frmPatientExam" Or Me.ActiveMdiChild.Name = "frmMessages" Or Me.ActiveMdiChild.Name = "frmPatientLetter" Or Me.ActiveMdiChild.Name = "frm_LM_Orders" Or Me.ActiveMdiChild.Name = "frmPTProtocols" Or Me.ActiveMdiChild.Name = "frmNurseNotes" Or Me.ActiveMdiChild.Name = "frmPatientConsent" Or Me.ActiveMdiChild.Name = "frmPatientEducation" Or Me.ActiveMdiChild.Name = "frmDisclosureMgmt" Or Me.ActiveMdiChild.Name = "frmTriage" Or Me.ActiveMdiChild.Name = "frmCPTTemplate" Or Me.ActiveMdiChild.Name = "frmDM_Template" Or Me.ActiveMdiChild.Name = "frmMSTTemplateGallery" Then
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "Voicemenu cleanup started on MDI Child activate", gloAuditTrail.ActivityOutCome.Success)

                        'check if microphone is on,if so turn off the microphone
                        If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                            DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                        End If
                        If Not IsNothing(vVoiceMenu) Then
                            vVoiceMenu.Remove(1)
                            vVoiceMenu.Remove(2)
                            vVoiceMenu.Active = False
                            System.Runtime.InteropServices.Marshal.ReleaseComObject(vVoiceMenu)
                            vVoiceMenu = Nothing
                        End If
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "Voicemenu cleanup finshed on MDI Child activate", gloAuditTrail.ActivityOutCome.Success)

                        Dim strMenuName As String
                        strMenuName = "gloEMRVoice" & CType(System.DateTime.Now.Year, String) & CType(System.DateTime.Now.Month, String) & CType(System.DateTime.Now.Day, String) & CType(System.DateTime.Now.Hour, String) & CType(System.DateTime.Now.Minute, String) & CType(System.DateTime.Now.Second, String)
                        vVoiceMenu = Vcmd.MenuCreate(strMenuName, strMenuName & "1", DNSTools.DgnLanguageConstants.dgnlangUSEnglish, "", DNSTools.CREATEFLAGS.vcmdmc_CREATE_TEMP)
                        vVoiceMenu.hWndMenu = Me.Handle.ToInt32

                        vVoiceMenu.Active = True
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "Voicemenu initialised on MDI Child activate", gloAuditTrail.ActivityOutCome.Success)

                        If Not IsNothing(vVoiceMenu) Then
                            Dim I As gloVoice
                            Try
                                I = CType(Me.ActiveMdiChild, gloVoice)
                                I.AddVoiceCommands()
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "ActiveMdiChild.AddVoiceCommands done on MDI Child activate", gloAuditTrail.ActivityOutCome.Success)
                            Catch ex As Exception
                                gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "Error at MainMenu_MdiChildActivate - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
                            End Try
                        End If
                    End If
                    ShowHideMainMenu(False, False)
                End If

                pnlBirthDayReminder.Visible = False

                If Me.ActiveMdiChild.Name = "frmTemplateGallery" Or Me.ActiveMdiChild.Name = "frmPatientExam" Or Me.ActiveMdiChild.Name = "frmMessages" Or Me.ActiveMdiChild.Name = "frmPatientLetter" Or Me.ActiveMdiChild.Name = "frm_LM_Orders" Or Me.ActiveMdiChild.Name = "frmPTProtocols" Or Me.ActiveMdiChild.Name = "frmNurseNotes" Or Me.ActiveMdiChild.Name = "frmPatientConsent" Or Me.ActiveMdiChild.Name = "frmPatientEducation" Or Me.ActiveMdiChild.Name = "frmDisclosureMgmt" Or Me.ActiveMdiChild.Name = "frmTriage" Or Me.ActiveMdiChild.Name = "frmCPTTemplate" Or Me.ActiveMdiChild.Name = "frmDM_Template" Or Me.ActiveMdiChild.Name = "frmMSTTemplateGallery" Then
                    IExam = CType(Me.ActiveMdiChild, IHotKey)
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "ActiveMdiChild.IHotKey done on MDI Child activate", gloAuditTrail.ActivityOutCome.Success)
                End If

            End If





        Catch objErr As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Open, "Error at MainMenu_MdiChildActivate - " & objErr.ToString, gloAuditTrail.ActivityOutCome.Failure)
            UpdateVoiceLog("Error at MainMenu_MdiChildActivate - " & objErr.ToString)
            'MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            
        End Try

        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "DashBoard MdiChildActivate Event Ended", gloAuditTrail.ActivityOutCome.Success)

    End Sub
    ''added for BatchPrinting if going from Backend before exiting application asking to continue batch printing or not
    'Private Function CheckBatchPrintProcessRunning() As Boolean
    '    Try


    '        For Each oFrm As Form In System.Windows.Forms.Application.OpenForms

    '            If oFrm.Name = "frmgloPrintWordReminderProgressController" Then

    '                Dim dg As DialogResult = MessageBox.Show("Background printing is in progress. Do you want to cancel the printing?", "gloEMR", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
    '                If (dg = DialogResult.Yes) Then
    '                    oFrm.Close()
    '                    Return False
    '                    Exit For
    '                Else
    '                    oFrm.Visible = True
    '                    Return True
    '                    Exit For
    '                End If
    '            End If
    '        Next
    '        Return False
    '    Catch ex As Exception
    '        ex = Nothing
    '        Return False
    '    End Try
    'End Function

    'Private Function CheckBatchPrintProcessRunning() As Boolean

    '    Try
    '        Dim flag As Boolean = True
    '        ''  Dim lstForm As New List(Of Form)()
    '        For Each oFrm As Form In System.Windows.Forms.Application.OpenForms

    '            If (oFrm.Name = "frmgloPrintWordProgressController") OrElse (oFrm.Name = "frmgloPrintWordReminderProgressController") Then

    '                If flag = True Then
    '                    Dim dg As DialogResult = MessageBox.Show("Background printing is in progress. Do you want to cancel the printing?", "gloEMR", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
    '                    If (dg = DialogResult.Yes) Then
    '                        oFrm.Close()
    '                        ' break; // TODO: might not be correct. Was : Exit For
    '                        flag = False
    '                    Else
    '                        oFrm.Visible = True

    '                        '    lstForm.Clear()
    '                        ' lstForm = Nothing
    '                        Return True
    '                        ' TODO: might not be correct. Was : Exit For

    '                        Exit For
    '                    End If
    '                Else
    '                    oFrm.Close()
    '                    flag = False
    '                End If
    '            End If
    '        Next
    '        'If (lstForm.Count > 0) Then
    '        '    While lstForm.Count > 0
    '        '        Dim frm As Form = lstForm(0)
    '        '        frm.Close()
    '        '    End While
    '        '    lstForm.Clear()

    '        'End If
    '        '  lstForm = Nothing
    '        Return False
    '    Catch ex As Exception
    '        ex = Nothing
    '        Return False
    '    End Try
    'End Function
    Private Function CheckBatchPrintProcessRunning() As Boolean

        Try
            Dim flag As Boolean = True
            Dim lstForm As New List(Of String)()
            For Each oFrm As Form In System.Windows.Forms.Application.OpenForms

                If (Not IsNothing(oFrm.Name)) Then
                    If (oFrm.Name = "frmgloPrintWordProgressController") OrElse (oFrm.Name = "frmgloPrintWordReminderProgressController") Then

                        If flag = True Then
                            Dim dg As DialogResult = MessageBox.Show("Background printing is in progress. Do you want to cancel the printing?", "gloEMR", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                            If (dg = DialogResult.Yes) Then
                                lstForm.Add(oFrm.Name)
                                ' break; // TODO: might not be correct. Was : Exit For
                                flag = False
                            Else
                                oFrm.Visible = True
                                lstForm.Clear()
                                lstForm = Nothing


                                Return True
                                ' TODO: might not be correct. Was : Exit For

                                Exit For
                            End If
                        Else
                            ''oFrm.Close()
                            lstForm.Add(oFrm.Name)
                            flag = False
                        End If
                    End If
                End If
            Next




            If (lstForm.Count > 0) Then
                Dim cnt As Integer = 0
                While cnt < lstForm.Count
                    Dim frm As Form = Application.OpenForms(Convert.ToString(lstForm(cnt)))
                    frm.Close()
                    cnt += 1
                End While
                lstForm.Clear()

            End If
            lstForm = Nothing




                Return False
        Catch ex As Exception
            ex = Nothing
            Return False
        End Try
    End Function


    Private Function CheckMenuItemPresent(name As String) As Boolean
        Return Me.mnuFile.DropDownItems.ContainsKey(name)
    End Function

    Public Sub PrintMenuEventclick(Optional blnAddMenu As Boolean = True, Optional formname As String = "")
        If (blnAddMenu = True) Then
            Dim oBatchPrintMenu As New ToolStripMenuItem()

            Dim itemexists As Boolean = False
            oBatchPrintMenu.ForeColor = Color.FromArgb(31, 73, 125)
            ' Dim fnt As New Font("Tahoma", 8.25)
            oBatchPrintMenu.Font = gloGlobal.clsgloFont.gFont_SMALL
            oBatchPrintMenu.Tag = ""
            oBatchPrintMenu.Image = My.Resources.BackgroundPrinting.ToBitmap()

            If formname = "frmgloPrintWordProgressController" Then
                AddHandler oBatchPrintMenu.Click, AddressOf oBatchPrintMenuProgressControllerClick
                oBatchPrintMenu.Text = "Appointment Batch Print"
                itemexists = CheckMenuItemPresent("Appointment Batch Print")
            End If
            If formname = "frmgloPrintWordReminderProgressController" Then

                oBatchPrintMenu.Text = "Reminder Batch Print"
                AddHandler oBatchPrintMenu.Click, AddressOf oBatchPrintReminderMenuProgressControllerClick
                itemexists = CheckMenuItemPresent("Reminder Batch Print")
            End If

            If itemexists = False Then
                Me.mnuFile.DropDownItems.Insert(Me.mnuFile.DropDownItems.Count - 1, oBatchPrintMenu)
            End If
        Else
            Dim iCount As Integer = Me.mnuFile.DropDownItems.Count - 1
            While iCount >= 0
                Dim oBatchPrintMenu As ToolStripMenuItem = DirectCast(Me.mnuFile.DropDownItems(iCount), ToolStripMenuItem)

                If ((oBatchPrintMenu Is Nothing) = False) Then

                    If ((oBatchPrintMenu.Text IsNot Nothing)) Then

                        If (oBatchPrintMenu.Text = "Appointment Batch Print") Then
                            Try


                                RemoveHandler oBatchPrintMenu.Click, AddressOf oBatchPrintMenuProgressControllerClick
                            Catch ex As Exception
                            End Try
                            Try


                                Me.mnuFile.DropDownItems.Remove(oBatchPrintMenu)
                            Catch ex As Exception
                            End Try
                            Try
                                oBatchPrintMenu.Dispose()

                                oBatchPrintMenu = Nothing
                            Catch ex As Exception
                            End Try
                            Return
                        End If


                        If (oBatchPrintMenu.Text = "Reminder Batch Print") Then
                            Try


                                RemoveHandler oBatchPrintMenu.Click, AddressOf oBatchPrintReminderMenuProgressControllerClick
                            Catch ex As Exception
                            End Try
                            Try


                                Me.mnuFile.DropDownItems.Remove(oBatchPrintMenu)
                            Catch ex As Exception
                            End Try
                            Try
                                oBatchPrintMenu.Dispose()

                                oBatchPrintMenu = Nothing
                            Catch ex As Exception
                            End Try
                            Return
                        End If



                    End If
                End If
                iCount += -1
            End While
        End If

    End Sub


    Private Sub oBatchPrintMenuProgressControllerClick(obj As Object, eventArgs As EventArgs)
        Try
            Dim x As Integer = 0
            Dim y As Integer = 0
            Dim r As Rectangle = Nothing

            For Each oFrm As Form In System.Windows.Forms.Application.OpenForms
                If oFrm.Name = "frmgloPrintWordProgressController" Then
                    oFrm.WindowState = FormWindowState.Normal
                    oFrm.TopMost = True
                    r = Screen.PrimaryScreen.WorkingArea
                    x = r.Width - oFrm.Width
                    y = r.Height - oFrm.Height
                    x = Convert.ToInt32(x / 2)
                    y = Convert.ToInt32(y / 2)
                    oFrm.Location = New Point(x, y)
                    'r = null;
                    ' TODO: might not be correct. Was : Exit For
                    Exit For
                End If

            Next
        Catch ex As Exception

            ex = Nothing
        End Try
    End Sub
    Private Sub oBatchPrintReminderMenuProgressControllerClick(obj As Object, eventArgs As EventArgs)
        Try
            Dim x As Integer = 0
            Dim y As Integer = 0
            Dim r As Rectangle = Nothing

            For Each oFrm As Form In System.Windows.Forms.Application.OpenForms
                If oFrm.Name = "frmgloPrintWordReminderProgressController" Then
                    oFrm.WindowState = FormWindowState.Normal
                    oFrm.TopMost = True
                    r = Screen.PrimaryScreen.WorkingArea
                    x = r.Width - oFrm.Width
                    y = r.Height - oFrm.Height
                    x = Convert.ToInt32(x / 2)
                    y = Convert.ToInt32(y / 2)
                    oFrm.Location = New Point(x, y)
                    'r = null;
                    ' TODO: might not be correct. Was : Exit For
                    Exit For
                End If

            Next
        Catch ex As Exception

            ex = Nothing
        End Try
    End Sub



    Private Function CheckDMSPrinting() As Boolean
        Try
            For Each oFrm As Form In System.Windows.Forms.Application.OpenForms

                If oFrm.Name = "gloPrintProgressController" Then

                    Dim dg As DialogResult = MessageBox.Show("Printing is in progress. Do you want to cancel the printing?", "gloEMR", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                    If (dg = DialogResult.Yes) Then
                        oFrm.Close()
                        Return False
                        Exit For
                    Else
                        ''  oFrm.Visible = True
                        Return True
                        Exit For
                    End If
                End If
            Next
            Return False
        Catch ex As Exception
            ex = Nothing
            Return False
        End Try
    End Function
    Private Sub MainMenu_FormClosed(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosedEventArgs) Handles Me.FormClosed
        If IsNothing(TimerSSO) = False Then
            TimerSSO.Dispose()
            TimerSSO = Nothing
        End If

        If IsNothing(dvAllSettings) = False Then
            dvAllSettings.Dispose()
            dvAllSettings = Nothing
        End If
        ''added against problem 00000512 for memory leak issue
        'SLR: Changed from ctype to directcast to avoid another creation of memory.
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objProblemList) = False Then
            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objProblemList, clsPatientProblemList).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objCriteria) = False Then
            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objCriteria, DocCriteria).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objPatientMessages) = False Then
            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objPatientMessages, clsMessage).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objPatientLetters) = False Then
            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objPatientLetters, clsPatientLetters).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objNurseNotes) = False Then

            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objNurseNotes, clsNurseNotes).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objHistory) = False Then

            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objHistory, clsPatientHistory).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objLabs) = False Then

            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objLabs, clsLabs).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objDMS) = False Then

            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objRxmed) = False Then

            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objRxmed, clsPatientDetails).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objOrders) = False Then

            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objOrders, clsPatientDetails).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objCriteria) = False Then

            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objCriteria, DocCriteria).Dispose()
        End If
        If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objPatientExam) = False Then

            DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objPatientExam, clsPatientExams).Dispose()
        End If
        gloSurescriptSecureMessage.SecureMessageProperties.objPatientMessages = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objPatientLetters = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objNurseNotes = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objHistory = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objLabs = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objDMS = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objRxmed = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objOrders = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objCriteria = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objWord = Nothing
        gloSurescriptSecureMessage.SecureMessageProperties.objPatientExam = Nothing

        If (IsNothing(myDialogCloser) = False) Then
            myDialogCloser.Dispose()
            myDialogCloser = Nothing
        End If
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Close, "Dash Board Closed Event Started", gloAuditTrail.ActivityOutCome.Success)
        Try
            EmptyGloEMRTemp()
            UnRegisterMyHotKey()

            'Mahesh <Save User Display Settings
            Call SaveDisplaySettings()
            SaveFlexGroupDisplaySettings()
            'Code Added to save c1Appointment Display settings
            If _isAppointmentGridColumnResize = True Then
                SaveAppointmentColumnWidth()
            End If

            oPatientListControl.SaveColumnWidth()  'To save Width of dgPatientView columns

            '12-Feb-16 Aniket: Resolving Bug #93431 ( Modified): gloEMR > Some times application shows exception when user click on logout button
            Try
                ExitWord()
            Catch ex As Exception

            End Try


            Dim objLogin As New clsLogin
            'objLogin.DeleteLoginStatus(gstrLoginName)
            '22-Mar-17 Aniket: Resolving issue where login entry was not getting deleted from LoginUsers table
            objLogin.UpdateLoginStatus(gstrLoginName, False, gstrClientMachineName, gintLoginSessionID)
            objLogin.Dispose()  ''slr free objLogin
            objLogin = Nothing

            If Trim(gstrPatientCode) <> "" Then
                If gloRegistrySetting.OpenSubKey(gloRegistrySetting.gstrSoftEMR) = False Then
                    Exit Sub
                End If
                gloRegistrySetting.OpenSubKey(gloRegistrySetting.gstrSoftEMR, True)
                gloRegistrySetting.SetRegistryValue(gloRegistrySetting.gstrDefPatCode, gstrPatientCode)
                gloRegistrySetting.CloseRegistryKey()
            End If

            'Added LogOut button
            If (ShowSplashScreen = True) Then

                For Each oFrm As Form In System.Windows.Forms.Application.OpenForms
                    If oFrm.Name = "frmEDocumentViewer" Then
                        oFrm.Close()
                        System.Windows.Forms.Application.DoEvents()
                        Exit For
                    End If
                Next
                '''' Close Secure Message inbox
                Dim oInbox As gloSurescriptSecureMessage_InBox.Inbox
                Dim oNewMail As InBox.NewMail
                oNewMail = InBox.NewMail.CheckFormOpen()
                If Not IsNothing(oNewMail) Then
                    oNewMail.Close()
                End If
                oInbox = gloSurescriptSecureMessage_InBox.Inbox.CheckFormOpen()
                If Not IsNothing(oInbox) Then
                    oInbox.Close()
                End If

                oInbox = Nothing
                oNewMail = Nothing
                Me.Hide()
                'SLR: Corrected the memory leak on 5/19/2015;
                Dim frm As frmSplash = frmSplash.GetInstance()
                'frm.SetOpacity(1.0)
                frm.LogOffFired = True
                frm.Visible = True
                frm.Show()

                ''SLR free all global variables ,events,threads,event handlers,timers,menuItems etc
                Try


                    If Not IsNothing(oGeneralInterface) Then
                        oGeneralInterface.Dispose()
                        oGeneralInterface = Nothing
                    End If
                    If Not IsNothing(listDirectUserProviderAssociation) Then
                        listDirectUserProviderAssociation.Clear()
                        listDirectUserProviderAssociation = Nothing
                    End If
                    If Not IsNothing(Toolitems) Then
                        Toolitems.Dispose()
                        Toolitems = Nothing
                    End If
                    _sReportType = Nothing
                    strPreviousSelectedPanel = Nothing
                    gstrPatientCode = Nothing
                    gstrPatientFirstName = Nothing
                    gstrPatientMiddleName = Nothing
                    gstrPatientLastName = Nothing
                    gstrPatientDOB = Nothing
                    gstrPatientAge = Nothing
                    gstrPatientGender = Nothing
                    gstrPatientMaritalStatus = Nothing
                    If Not IsNothing(mdiClient) Then
                        mdiClient.Dispose()
                        mdiClient = Nothing
                    End If
                    If Not IsNothing(dtDashboardUpdateMst) Then
                        dtDashboardUpdateMst.Dispose()
                        dtDashboardUpdateMst = Nothing
                    End If
                    gstrPatientStatus = Nothing
                    _databaseconnectionstring = Nothing

                    IntuitMessageStatus = Nothing
                    IntuitMessageFrom = Nothing
                    IntuitMessageTo = Nothing
                    IntuitMessageSubject = Nothing
                    IntuitMessageDate = Nothing
                    IntuitMessageType = Nothing
                    IntuitMessageBody = Nothing
                    IntuitServiceType = Nothing
                    _CDAOrderDetails = Nothing
                    PortalType = Nothing
                    If Not IsNothing(GloUC_TransactionHistory1) Then
                        RemoveHandler GloUC_TransactionHistory1.gUC_ViewDocument, AddressOf gloLabUC_Transaction1_gUC_ViewDocument
                        GloUC_TransactionHistory1.Dispose()
                        GloUC_TransactionHistory1 = Nothing

                    End If
                    strAdministratorMessage = Nothing
                    strSpeakerName = Nothing
                    ' CleanUpMyVoiceComponents()
                    'If Not IsNothing(voiceprocess) Then
                    '    voiceprocess.Dispose()
                    '    voiceprocess = Nothing
                    'End If
                    _arrTopics.Clear()
                    _arrTopics = Nothing
                    _TemplateName = Nothing
                    _FindCriteriaName = Nothing
                    'If Not IsNothing(oDMProcess) Then
                    '    oDMProcess.Dispose()
                    '    oDMProcess = Nothing
                    'End If
                    _oPatients.Clear()
                    _oPatients = Nothing
                    Phone_AS = Nothing
                    If Not IsNothing(dvPatient) Then
                        dvPatient.Dispose()
                        dvPatient = Nothing
                    End If
                    If Not IsNothing(m_hotKeys) Then
                        m_hotKeys.Clear()
                        m_hotKeys = Nothing
                    End If

                    Try

                        RemoveHandler Me.HotKeyPressed, AddressOf hotKey_Pressed

                    Catch ex As Exception
                        ''As Error which cannot be handled, so try catch.
                    End Try
                    If Not IsNothing(dtWord) Then
                        dtWord.Dispose()
                        dtWord = Nothing
                    End If
                    If Not IsNothing(objWord) Then
                        objWord = Nothing
                    End If

                    If Not IsNothing(strRefillMessage) Then
                        strRefillMessage.Clear()
                        strRefillMessage = Nothing
                    End If
                    If Not IsNothing(strErrorMessage) Then
                        strErrorMessage.Clear()
                        strErrorMessage = Nothing
                    End If

                    IsRecordPresent = Nothing
                    strMessageAlerInterval = Nothing

                    objUserRights = Nothing
                    If Not IsNothing(oPatientCards) Then
                        ClearAllCardInformation()
                        oPatientCards.Clear()
                        oPatientCards.Dispose()
                        oPatientCards = Nothing
                    End If
                    If Not IsNothing(ogloReminder) Then
                        ogloReminder.Dispose()
                        ogloReminder = Nothing
                    End If

                    If Not IsNothing(oEDocumentV3) Then
                        oEDocumentV3.Dispose()
                        oEDocumentV3 = Nothing
                    End If
                    If Not IsNothing(ofrm) Then
                        ofrm.Close()
                        ofrm.Dispose()
                        ofrm = Nothing
                    End If
                    If Not IsNothing(_ListType) Then
                        _ListType = Nothing
                    End If
                    If Not IsNothing(PatientRegistration) Then
                        PatientRegistration.Dispose()
                        PatientRegistration = Nothing
                    End If

                    If Not IsNothing(arrDashBoardToolStrip) Then
                        arrDashBoardToolStrip.Clear()
                        arrDashBoardToolStrip = Nothing
                    End If
                    If Not IsNothing(arrPatientDetailToolStrip) Then
                        arrPatientDetailToolStrip.Clear()
                        arrPatientDetailToolStrip = Nothing
                    End If

                    If Not IsNothing(arrMainStripButtonsToHide) Then
                        arrMainStripButtonsToHide.Clear()
                        arrMainStripButtonsToHide = Nothing
                    End If
                    If Not IsNothing(arrPatDetailsButtonsToHide) Then
                        arrPatDetailsButtonsToHide.Clear()
                        arrPatDetailsButtonsToHide = Nothing
                    End If
                    If Not IsNothing(ofrmTask) Then
                        ofrmTask.Close()
                        ofrmTask.Dispose()
                        ofrmTask = Nothing
                        _objfrmtask = Nothing
                    End If
                    If Not IsNothing(ofrmSSRS) Then
                        ofrmSSRS.Close()
                        ofrmSSRS.Dispose()
                        ofrmSSRS = Nothing
                    End If

                    If Not IsNothing(dtPatientDetails) Then
                        dtPatientDetails.Dispose()
                        dtPatientDetails = Nothing
                    End If
                    If Not IsNothing(_ChildFormsStack) Then
                        _ChildFormsStack = Nothing
                    End If
                    If Not IsNothing(dt_ExamID) Then
                        dt_ExamID.Dispose()
                        dt_ExamID = Nothing
                    End If
                    If Not IsNothing(dt_TemplateSpeciality) Then
                        dt_TemplateSpeciality.Dispose()
                        dt_TemplateSpeciality = Nothing
                    End If

                    If Not IsNothing(dt_ProviderCombo) Then
                        dt_ProviderCombo.Dispose()
                        dt_ProviderCombo = Nothing
                    End If
                    If Not IsNothing(oEDocumentV3) Then
                        oEDocumentV3.oPatientExam = Nothing

                        oEDocumentV3.oPatientMessages = Nothing
                        oEDocumentV3.oPatientLetters = Nothing
                        oEDocumentV3.oNurseNotes = Nothing
                        oEDocumentV3.oHistory = Nothing
                        oEDocumentV3.oLabs = Nothing
                        oEDocumentV3.oDMS = Nothing
                        oEDocumentV3.oRxmed = Nothing
                        oEDocumentV3.oOrders = Nothing
                        oEDocumentV3.oProblemList = Nothing

                        oEDocumentV3.oCriteria = Nothing
                        oEDocumentV3.oWord = Nothing
                    End If


                    If Not IsNothing(myRefCaller) Then

                        Marshal.ReleaseComObject(myRefCaller)
                    End If


                    If Not IsNothing(subItemSSRS) Then
                        subItemSSRS.Dispose()
                        subItemSSRS = Nothing
                    End If
                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Close, "Dash Board Closed EventEnd", gloAuditTrail.ActivityOutCome.Failure)

                End Try
            Else
                End
            End If



            txtlockscrusername = Nothing


        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Close, "Dash Board Closed Event End", gloAuditTrail.ActivityOutCome.Success)
    End Sub

    Private Sub MainMenu_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Close, "Dash Board Closing Event Started", gloAuditTrail.ActivityOutCome.Success)
        Try
            If (ShowSplashScreen = True) Then
                '' If pressed on Logout button then don't ask user whether to close application
                Dashboard_Closingevent()
            Else
                ''Added for Black Ice issuie on windows8 as on 20121129 
                If blnWindows8 = True Then
                    Dashboard_Closingevent()
                Else
                    If MessageBox.Show("Are you sure you want to close the application?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then

                        Dashboard_Closingevent()

                    Else
                        e.Cancel = True
                    End If
                End If
                ''End
            End If
        Catch objErr As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Close, "Error doing Voice Cleanup at Main menu closing event" & objErr.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show("Error Unloading Voice Components", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Close, "Dash Board Closing Event End", gloAuditTrail.ActivityOutCome.Success)
    End Sub

    Private Sub Dashboard_Closingevent()
        'THIS WILL MAINTAIN REVERSE SEQUENCE OF CLOSING FORMS, AS THEY WERE OPENED.
        Cursor = Cursors.WaitCursor
        System.Windows.Forms.Application.DoEvents()
        Dim _FormName As String
        While _ChildFormsStack.Count > 0 AndAlso Me.MdiChildren.Length > 0
            _FormName = _ChildFormsStack.Pop  '' GET LAST OPENED FORM FROM STACK ''
            For Each oFrm As Form In Me.MdiChildren '' SEACH THAT FORM IN MDI CHILD COLLECTION ''
                If oFrm.Name = _FormName Then '' CLOSE IF FOUND ''
                    Try
                        oFrm.Close()
                    Catch ex As Exception

                    End Try
                    System.Windows.Forms.Application.DoEvents()
                End If
            Next
        End While

        ''Added by madan on 20100624--- For unlock all records based upon particular system.
        'For resolving case no :GLO2011-0011178 i.e group Messaging
        UnLock_ALLTransactions(gstrClientMachineName, gstrLoginName)
        ''End madan on 20100624

        If gblnVoiceEnabled = True Then
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Close, "Voice Cleanup Started at Main menu closing event", gloAuditTrail.ActivityOutCome.Success)
            Unload_VoiceEngine()
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Close, "Voice Cleanup Completed at Main menu closing event", gloAuditTrail.ActivityOutCome.Success)
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Close, "gloEMR log for Voice Ended", gloAuditTrail.ActivityOutCome.Success)
        End If

        If Not IsNothing(AxBlackIceDEVMODE1) Then
            AxBlackIceDEVMODE1.Dispose()
            AxBlackIceDEVMODE1 = Nothing
        End If
    End Sub

#End Region

#Region " User Rights "

    'Added Code Changes for View OBVitals
    Private Sub AssignOBVitalsUserRights()

        'Dim objSettings As New clsSettings
        'objSettings.GetSettings()

        'Dim SelectedVitals() As String = Nothing
        Dim strSelectedVitals As String = Nothing

        Try

            If IsNothing(dvAllSettings) = False Then
                dvAllSettings.RowFilter = "sName = 'VITALSCUSTOMIZATION'"
                If dvAllSettings.Count > 0 Then
                    'SelectedVitals = dvAllSettings(0)("sValue").Trim.Split(",")
                    strSelectedVitals = dvAllSettings(0)("sValue").Trim
                Else
                    'SelectedVitals = "0.1-Height (ft & in),0.2-Height (in),0.3-Height (cm),1.1-Weight (lbsoz),1.2-Weight (lbs),1.3-Weight (kg),2.0-Weight Change,3.0-BMI,4.0-Respiratory Rate,5.0-Pulse Per Min,6.0-Pulse OX,6.1-Pulse Ox w/Supplemental Oxygen,7.1-BP Sitting,7.2-BP Standing,8.1-Temperature (F),8.2-Temperature (C),9.0-PEFR,10.0-Last Menstrual Period,11.1-Head Circumference (in),11.2-Head Circumference (cm),12.1-Neck Circumference (in),12.2-Neck Circumference (cm),13.1-Stature (in),13.2-Stature (cm),14.0-Left Eye Pressure Over Time,15.0-Right Eye Pressure Over Time,16.0-Heart Rate,17.1-Pain Level : Current,17.2-Pain Level : With Medication,17.3-Pain Level : Without Medication,17.4-Pain Level : Worst,18.0-OB Vitals,19.0-ODI,20.0-Comments,21.0-DAS 28,22.1-Total Pregnancies,22.2-Living,22.3-Full Term,22.4-Multiple Births,22.5-Premature,22.6-Aborted (Spontaneous),22.7-Aborted (Induced),22.8-Ectopic".Trim.Split(",")
                    strSelectedVitals = "0.1-Height (ft & in),0.2-Height (in),0.3-Height (cm),1.1-Weight (lbsoz),1.2-Weight (lbs),1.3-Weight (kg),2.0-Weight Change,3.0-BMI,4.0-Respiratory Rate,5.0-Pulse Per Min,6.0-Pulse OX,6.1-Pulse Ox w/Supplemental Oxygen,7.1-BP Sitting,7.2-BP Standing,8.1-Temperature (F),8.2-Temperature (C),9.0-PEFR,10.0-Last Menstrual Period,11.1-Head Circumference (in),11.2-Head Circumference (cm),12.1-Neck Circumference (in),12.2-Neck Circumference (cm),13.1-Stature (in),13.2-Stature (cm),14.0-Left Eye Pressure Over Time,15.0-Right Eye Pressure Over Time,16.0-Heart Rate,17.1-Pain Level : Current,17.2-Pain Level : With Medication,17.3-Pain Level : Without Medication,17.4-Pain Level : Worst,18.0-OB Vitals,19.0-ODI,20.0-Comments,21.0-DAS 28,22.1-Total Pregnancies,22.2-Living,22.3-Full Term,22.4-Multiple Births,22.5-Premature,22.6-Aborted (Spontaneous),22.7-Aborted (Induced),22.8-Ectopic"
                End If

            End If

            'If objSettings.VitalSettingsValue = "" Then
            '    objSettings.VitalSettingsValue = "0.1-Height (ft & in),0.2-Height (in),0.3-Height (cm),1.1-Weight (lbsoz),1.2-Weight (lbs),1.3-Weight (kg),2.0-Weight Change,3.0-BMI,4.0-Respiratory Rate,5.0-Pulse Per Min,6.0-Pulse OX,6.1-Pulse Ox w/Supplemental Oxygen,7.1-BP Sitting,7.2-BP Standing,8.1-Temperature (F),8.2-Temperature (C),9.0-PEFR,10.0-Last Menstrual Period,11.1-Head Circumference (in),11.2-Head Circumference (cm),12.1-Neck Circumference (in),12.2-Neck Circumference (cm),13.1-Stature (in),13.2-Stature (cm),14.0-Left Eye Pressure Over Time,15.0-Right Eye Pressure Over Time,16.0-Heart Rate,17.1-Pain Level : Current,17.2-Pain Level : With Medication,17.3-Pain Level : Without Medication,17.4-Pain Level : Worst,18.0-OB Vitals,19.0-ODI,20.0-Comments,21.0-DAS 28,22.1-Total Pregnancies,22.2-Living,22.3-Full Term,22.4-Multiple Births,22.5-Premature,22.6-Aborted (Spontaneous),22.7-Aborted (Induced),22.8-Ectopic"
            'End If

            'SelectedVitals = objSettings.VitalSettingsValue.Trim.Split(",")

            'Dim str1 As String = ""
            'Dim k As Int16
            'Dim Vitals() As String

            'For k = 0 To SelectedVitals.Length - 1
            '    Vitals = SelectedVitals.GetValue(k).ToString().Split("-")
            '    If str1 = "" Then
            '        str1 = Vitals.GetValue(1)
            '    Else
            '        str1 = str1 & "," & Vitals.GetValue(1)
            '    End If
            'Next

            'SelectedVitals = str1.Split(",")

            If strSelectedVitals.Contains("OB Vitals") = True Then
                mnuView_OBVitals.Enabled = True
                mnuView_OBVitals.Visible = objUserRights.ViewOBVitals
            Else
                mnuView_OBVitals.Visible = False
            End If

        Catch ex As Exception
            MsgBox(ex.ToString)
        Finally
            'If Not IsNothing(objSettings) Then
            '    objSettings.Dispose()
            '    objSettings = Nothing
            'End If

        End Try

    End Sub
    Private Sub SetLicenseModule()
        Try
            '' License Check
            Dim _ToolStrip As New List(Of Object)()
            _ToolStrip.Add(Me.tlbbtn_NewExam)
            _ToolStrip.Add(Me.tlbbtn_NewPatient)
            _ToolStrip.Add(Me.tlbbtn_ModifyPatient)
            _ToolStrip.Add(Me.tlbbtn_Prescription)
            _ToolStrip.Add(Me.tlbbtn_Sechedule)
            _ToolStrip.Add(Me.mnuPatientRegistration)
            _ToolStrip.Add(Me.mnuModifyPatient)
            _ToolStrip.Add(Me.mnuPatientPrescription)
            _ToolStrip.Add(Me.mnu_Appointment)
            MyBase.FormControls = Nothing
            MyBase.FormControls = _ToolStrip.ToArray()
            MyBase.SetChildFormControls()
            _ToolStrip = Nothing
            '' end License Check
            'tlbbtn_NewExam.Enabled = bEnableModule ' gblnIsValidLicense
            'tlbbtn_NewPatient.Enabled = bEnableModule
            'tlbbtn_ModifyPatient.Enabled = bEnableModule
            'tlbbtn_Prescription.Enabled = bEnableModule
            'tlbbtn_Sechedule.Enabled = bEnableModule
            'mnuPatientRegistration.Enabled = bEnableModule
            'mnuModifyPatient.Enabled = bEnableModule
            'mnuPatientPrescription.Enabled = bEnableModule
            'mnu_Appointment.Enabled = bEnableModule
            'tlbbtn_Calender.Enabled = bEnableModule
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub AssignUserRights()

        objUserRights = Nothing  ''slr free previous memory

        objUserRights = New clsLoginUserRights

        Dim ogloUserRights As New gloUserRights.ClsgloUserRights(GetConnectionString)


        Try

            objUserRights.RetrieveUserRights(gstrLoginName)
            ogloUserRights.CheckForUserRights(gstrLoginName)

            mnuTools_PrescriptionProviderAssociation.Visible = objUserRights.PrescriptionProviderAssociation            

            '20-Feb-2014 Ashish for Merge Order User Rights
            gloEmdeonCommon.mdlGeneral.IsMergeOrderEnabled = objUserRights.MergeOrder
            '  gloEmdeonCommon.mdlGeneral.IsMergeOrderEnabled = objUserRights.viewCompleteOtherUsersTasks

            gblnAssociatedProviderSignature = objUserRights.AssociatedProviderSignature
            gloEDocumentV3.gloEDocV3Admin.gblnAssociatedProvider = gblnAssociatedProviderSignature

            gblnCDSRights = objUserRights.CDS
            gblnAllowUserDISetting = objUserRights.DrugInteraction
            gloEDocumentV3.gloEDocV3Admin.gblnAssociatedProvider = gblnAssociatedProviderSignature
            mnuEducationMapping.Visible = gblnEducationMaterialMappingEnabled
            ''changes done for user rights 
            mnuPatientEducation.Visible = gblnEducationMaterialEnabled
            mnuView_Triage1.Visible = objUserRights.Triage
            mnu_Appointment.Visible = objUserRights.GoAppointment
            mnu_Schedule.Visible = objUserRights.GoNewSchedule
            mnuProblemList.Visible = objUserRights.GoProblem
            mnu_ClinicalChartPrintQueue.Visible = objUserRights.GoClinicalChartPrintQueue

            mnu_SocPsycBehobs.Visible = objUserRights.GoSocialPsychologicalBehavioralObservations
            ''changes done for user rights 

            mnu_ImplantableDevice_Setup.Visible = objUserRights.EditImplantableDevices
            mnu_ImplantableDevices.Visible = objUserRights.GoPatientImplantableDevices

            '02-May-13 Aniket: Resolving Bug 50030
            mnuMastersFamilyMember.Visible = objUserRights.FamilyMember
            ZipToolStripMenuItem.Visible = objUserRights.Zip
            mnuVital.Visible = objUserRights.VitalSettings
            mnuMaster_ClinicalInstructions.Visible = objUserRights.ClinicalInstructions
            mnuMaster_CarePlan.Visible = objUserRights.CarePlan

            mnuTools_CCDASchedule.Visible = objUserRights.CCDASchedule
            mnuTools_ExportSummary.Visible = objUserRights.ExportSummary

            ''To Assign user Rights on Prescription (Bug #81223 )
            gblnAllowAddDrugs = objUserRights.Drugs
            gblnviewCompleteOtherUsersTasks = objUserRights.viewCompleteOtherUsersTasks

            mnuMastersDrugs.Visible = objUserRights.Drugs
            mnuMastersSIG.Visible = objUserRights.SIG
            gblnAllowDrugConfig = objUserRights.DrugsConfig
            mnuMaster_DrugProviderAssociation.Visible = objUserRights.DrugsConfig
            mnuChangePass.Visible = objUserRights.ChangePassword
            mnu_TemplateAssociation.Visible = ogloUserRights.TemplateAssociation '' added for problem 00000368
            mnuMastersTemplates.Visible = objUserRights.TemplateGallery
            mnuMastersCategory.Visible = objUserRights.Category

            mnuMedicalCategory.Visible = objUserRights.MedicalCategory

            mnuMastersDMSCategory.Visible = objUserRights.DMSCategory

            mnuMasterROS.Visible = objUserRights.ROS
            mnuMastersHistory.Visible = objUserRights.History

            mnuMastersContacts.Visible = objUserRights.Contacts

            mnuMastersRadiology.Visible = objUserRights.Radiology

            '22-Oct-2013 Aniket: Updated Orders caption to 'Orders and Results'
            mnuMastersLabSetup.Visible = objUserRights.OrdersAndResultsSetup
            tsbtn_Labs.Visible = objUserRights.OrdersAndResults '' changes made for user rights problem 00000255
            tsbtn_Order.Visible = objUserRights.OrdersAndResults  '' changes made for user rights problem 00000255

            mnuMastersFlowsheet.Visible = objUserRights.Flowsheet
            mnuMastersSpeciality.Visible = objUserRights.Speciality

            mnu_DM_Setup.Visible = objUserRights.DMSetup
            mnu_IM_Setup.Visible = objUserRights.IMSetup
            mnu_ViewRecommendation.Visible = objUserRights.ViewRecommendation

            mnuMaster_SmartDiagnosis.Visible = objUserRights.SmartDiagnosis
            mnuMaster_SmartTreatment.Visible = objUserRights.SmartTreatment
            mnuMaster_SmartOrder.Visible = objUserRights.SmartOrder
            mnuMaster_FormGallery.Visible = objUserRights.EditFormGallery

            mnuMaster_StatusUsers.Visible = objUserRights.StatusUsers

            mnuMaster_ICDCPTGallery.Visible = objUserRights.ICD9CPTGallery
            mnuMastersDisclosuerSet.Visible = objUserRights.DisclosureSet
            mnuMaster_PatientSummaryScreen.Visible = objUserRights.PatientSummary
            mnuMaster_AppointmentBook.Visible = objUserRights.AppointmentBook
            mnu_CV_Setup.Visible = objUserRights.CVSetup
            mnu_TaxID_Setup.Visible = objUserRights.TaxIDSetup
            mnu_BillingConfiguration.Visible = objUserRights.BillingConfiguration


            mnu_BillingCharges.Visible = False


            mnuLiquidData.Visible = objUserRights.LiquidData
            ''End of Edit menu

            ''Start of Go menu
            mnuPatientRegistration.Visible = objUserRights.PatientRegistration
            tlbbtn_NewPatient.Visible = objUserRights.PatientRegistration

            mnuModifyPatient.Visible = objUserRights.ModifyPatient
            tlbbtn_ModifyPatient.Visible = objUserRights.ModifyPatient

            '' For Patient Insurance or Driving License Cards
            tlbbtn_ScanCard.Visible = objUserRights.PatientCards
            btnPC_DeleteCard.Enabled = objUserRights.PatientCards
            btnPC_PrintCards.Enabled = objUserRights.PatientCards

            mnuPatientROS.Visible = objUserRights.PatientROS

            mnuPatientHistory.Visible = objUserRights.PatientHistory
            tlbbtn_History.Visible = objUserRights.PatientHistory

            mnuPatientVitals.Visible = objUserRights.PatientVitals
            tlbbtn_Vitals.Visible = objUserRights.PatientVitals
            tsbtn_Vital.Visible = objUserRights.PatientVitals
            tlbbtn_Sechedule.Visible = objUserRights.ViewSchedule



            mnuPatientMessages.Visible = objUserRights.Messages

            mnuPatientPrescription.Visible = objUserRights.PatientPrescription
            tlbbtn_Prescription.Visible = objUserRights.PatientPrescription

            '06-May-13 Aniket: Resolving Bug 50030
            gblnEligibilityUserRights = objUserRights.EligibilityInfo

            tlbbtn_NewExam.Visible = objUserRights.PatientNewExam
            tlbbtn_PastExam.Visible = objUserRights.PatientPastExam
            gblnPastExam = objUserRights.PatientPastExam
            tlbbtn_UnFinishedExams.Visible = objUserRights.Unfinished

            If objUserRights.PatientNewExam = False AndAlso objUserRights.PatientPastExam = False AndAlso objUserRights.Unfinished = False Then
                tlsExamSep.Visible = False
            Else
                tlsExamSep.Visible = True
            End If

            tlbbtn_Orders.Visible = objUserRights.RadiologyOrders
            '22-Oct-2013 Aniket: Updated Orders caption to 'Orders and Results'
            tlbbtn_LabOrders.Visible = objUserRights.OrdersAndResults

            '02-May-13 Aniket: Resolving Bug 50030
            '22-Oct-2013 Aniket: Updated Orders caption to 'Orders and Results'
            tlbbtn_gloLabOrders.Visible = objUserRights.OrdersAndResults
            tlbbtn_Timeline.Visible = objUserRights.OrdersAndResults

            mnuPatient_RadiologyOrders.Visible = objUserRights.RadiologyOrders
            '22-Oct-2013 Aniket: Updated Orders caption to 'Orders and Results'
            mnuPatient_LabOrder.Visible = objUserRights.OrdersAndResults

            mnuPatientConcent.Visible = objUserRights.PatientConcent
            tsbtn_PatientConsent.Visible = objUserRights.PatientConcent

            mnuPatientLetters.Visible = objUserRights.PatientLetters
            tsbtn_PatientLetters.Visible = objUserRights.PatientLetters

            mnuPatientPTProtocols.Visible = objUserRights.PatientPTProtocols

            mnuDisclosureMgmt.Visible = objUserRights.DislocureMgmt
            tsbtn_DisclosureMgt.Visible = objUserRights.DislocureMgmt

            mnuNurseNotes.Visible = objUserRights.NurseNotes
            tsbtn_NurseNotes.Visible = objUserRights.NurseNotes


            mnuPatientFlowSheet.Visible = objUserRights.PatientFlowsheet
            tlbbtn_FormGallery.Visible = objUserRights.FormGallery
            mnuPatient_FormGallery.Visible = objUserRights.FormGallery
            tlsFormGalerySep.Visible = objUserRights.FormGallery
            mnuPatient_Tasks.Visible = objUserRights.Tasks
            cmnuTask_Add.Visible = objUserRights.Tasks


            If objUserRights.PatientFlowsheet = False AndAlso objUserRights.FormGallery = False AndAlso objUserRights.Tasks = False Then
                sep15.Visible = False
            Else
                sep15.Visible = True
            End If

            mnu_IM_Transaction.Visible = objUserRights.Immunization

            '19-Mar-13 Aniket: Show the Health Plan menu only if the setting is true
            If GetHealthPlanSetting() = False Then
                mnuPatient_FindHealthPlan.Visible = False
            Else
                mnuPatient_FindHealthPlan.Visible = objUserRights.PatientHealthPlan
            End If


            mnu_UploadVideo.Visible = objUserRights.UploadVideo

            tlbbtn_Calender.Visible = objUserRights.Calendar
            tlsCalenderSep.Visible = objUserRights.Calendar

            If objUserRights.DocMgmt = True Then
                tlbbtn_ScanDocs.Visible = True ' scan
                mnu_ScanDocs.Visible = True
            Else
                tlbbtn_ScanDocs.Visible = False ' scan
                mnu_ScanDocs.Visible = False
            End If
            mnuMastersRCMCategory.Visible = objUserRights.RCMCategory
            tlbbtn_RCMDocs.Visible = objUserRights.RCMDocumentManagement

            'Ability to disable the clear patients documents
            mnu_ClearPatientDocuments.Visible = objUserRights.ClearPatientDocs

            tlsDOCmgntSep.Visible = objUserRights.DocMgmt

            _blnShowSetAlert = objUserRights.SetAlert
            _blnShowSurgicalAlert = objUserRights.SetSurgicalAlert

            mnu_BillingBalance.Visible = False
            mnu_BillingBatch.Visible = False
            mnu_BillingPayment.Visible = False
            mnu_BillingRemittance.Visible = False
            mnu_BillingLedger.Visible = False
            mnu_BillingAdvPayment.Visible = False

            mnuView_Tasks.Visible = objUserRights.ViewTasks
            mnuView_PatientVitals.Visible = objUserRights.PatientViewVitals
            'Added Code for Viewing OB Vitals Screen
            AssignOBVitalsUserRights()

            mnuView_Messages.Visible = objUserRights.ViewMessages

            'Changed by Ashish on 6-June-2014 to prevent View->Patient Education
            'from appearing. Functionality shifted to Go->Patient Education
            mnuView_PatientEducation.Visible = False

            mnuView_FormGallery.Visible = objUserRights.ViewFormGallery
            mnuView_Referrals.Visible = objUserRights.ViewReferrals
            mnuView_PatientLetters.Visible = objUserRights.ViewPatientLetters
            mnuView_PatientConcent.Visible = objUserRights.ViewPatientConcent
            mnuConsentTracking.Visible = objUserRights.ViewPatientConcentTracking
            mnuView_PTProtocol.Visible = objUserRights.ViewPTProtocols
            mnuView_DisclosureMgmt.Visible = objUserRights.ViewDiscloures
            mnuView_PatientVideo.Visible = objUserRights.ViewPatientVideo
            mnuViewReceivedFaxes.Visible = objUserRights.ViewReceivedFaxes
            mnuOutStandingOrders.Visible = objUserRights.ViewOutstandingOrders
            mnuRefillRequest.Visible = objUserRights.ViewPendingRefillRequest
            mnuVwErrorMessages.Visible = objUserRights.ViewErrorMessages
            mnuView_NurseNotes.Visible = objUserRights.ViewNurseNotes
            mnuViewPatientSummaryScreen.Visible = objUserRights.ViewPatientSummary
            mnuVwSummaryCareRecord.Visible = objUserRights.ViewSummaryCareRecord


            'view pending lab orders made hidden 
            mnu_ViewPendingLabOrders.Visible = objUserRights.ViewPendingLabOrders
            mnu_ViewPendingLabOrders.Visible = False
            If mnu_ViewPendingLabOrders.Visible = False Then
                mnuView.DropDownItems.Remove(mnu_ViewPendingLabOrders)
            End If


            mnuView_Mails.Visible = False
            If mnuView_Mails.Visible = False Then
                mnuView.DropDownItems.Remove(mnuView_Mails)
            End If
            mnuDicomViewer.Visible = objUserRights.DICOM
            mnu_ViewPatientSynopsis.Visible = objUserRights.PatientSynopsis
            mnuView_PatientConfidential.Visible = objUserRights.PatientConfidential

            'Always show patient confidential if the user is an administrator user
            If (gblnIsAdmin = True) Then
                mnuView_PatientConfidential.Visible = True
            End If
            mnuView_PatientChiefComplaints.Visible = objUserRights.PatientChiefComplaints
            _IsHasRighttoCompleteTaskforallUsers = objUserRights.ViewCompleteTaskforallUsers

            mnuTools_Customization.Visible = objUserRights.PatientControl
            sep17.Visible = objUserRights.PatientControl

            mnuExportTemplates.Visible = objUserRights.ExportTemplates
            mnuImportTemplates.Visible = objUserRights.ImportTemplates
            mnuUpdateExistingTemplates.Visible = objUserRights.UpdateExisting

            mnuTool_UpdateOtherTemplates.Visible = False
            mnuTool_UpgradeTemplates.Visible = False
            mnuMergePatRecords.Visible = objUserRights.MergePatient

            'for Recover exam Module.
            mnuTools_RecoverExam.Visible = objUserRights.ViewRecoverExam

            If objUserRights.Messages = False AndAlso objUserRights.PatientPrescription = False Then
                sep12.Visible = False
            Else
                sep12.Visible = True
            End If


            If objUserRights.MergePatient = False AndAlso objUserRights.MigrateDiagnosis = False Then
                sep20.Visible = False
            Else
                sep20.Visible = True
            End If

            mnuUnlockExams.Visible = objUserRights.UnlockRecords
            mnuReportUnfinishedExam.Visible = objUserRights.UnfinishedExams
            mnuSep_UnfinishedExam.Visible = objUserRights.UnfinishedExams

            mnuFAXReports.Visible = objUserRights.FAXReports
            mnuReportExamPrintFAX.Visible = objUserRights.RptExamsPrintFax
            mnuBatchReferrals.Visible = objUserRights.BatchReferrals
            If mnuReviewExams.Visible = False Then
                mnuReports.DropDownItems.Remove(mnuReviewExams)
            End If

            mnuPatientDemographics.Visible = objUserRights.RptPatientDemographics
            mnurptHCFAReport.Visible = objUserRights.RptHCFAReport
            mnuRpt_HealthPlan.Visible = objUserRights.HealthPlansForCriteria


            mnuRptIMDueReport.Visible = objUserRights.ImmunizationDueRpt
            mnuRpt_LabGraph.Visible = False
            If mnuRpt_LabGraph.Visible = False Then
                mnuReports.DropDownItems.Remove(mnuRpt_LabGraph)
            End If



            tsbtn_History.Visible = objUserRights.HistoryDetails

            tlsHistorySep.Visible = objUserRights.HistoryDetails

            tsbtn_Medication.Visible = objUserRights.Medications
            tlsMedSep.Visible = objUserRights.Medications

            tsbtn_Prescription.Visible = objUserRights.Prescriptions
            tlsRxSep.Visible = objUserRights.Prescriptions

            tsbtn_ProblemList.Visible = objUserRights.PatientProblemList
            tlsProblemSep.Visible = objUserRights.PatientProblemList

            tsbtn_ViewDocs.Visible = objUserRights.ViewDocs
            tlsViewDocsSep.Visible = objUserRights.ViewDocs

            tsbtn_Messages.Visible = objUserRights.PatientMessages
            tlsMessageSep.Visible = objUserRights.PatientMessages

            tsbtn_Orders.Visible = objUserRights.PatientOrders

            '' tsbtn_Order.Visible = objUserRights.OrdersAndResultsSetup
            tlsOrdersSep.Visible = objUserRights.PatientOrders

            tsbtn_PastExam.Visible = objUserRights.PastExams
            tlsPastExamSep.Visible = objUserRights.PastExams

            tlbbtn_NewExam.Visible = objUserRights.NewExams
            tlsNewExamSep.Visible = objUserRights.NewExams

            tsbtn_PendingFax.Visible = objUserRights.PendingFaxes
            tlsPendingFaxSep.Visible = objUserRights.PendingFaxes

            tsbtn_Sentfax.Visible = objUserRights.SentFaxes


            tlsSentFaxSep.Visible = objUserRights.AuditTrail
            tsbtn_AuditTrail.Visible = objUserRights.AuditTrail
            tsbtn_Balance.Visible = objUserRights.Balance
            tsbtn_Triage.Visible = objUserRights.Triage
            tsbtn_NYWCForms.Visible = IsEnableWorkersCompForms()
            tsbtn_Referrals.Visible = objUserRights.ViewReferrals

            tsbtn_SPB.Visible = objUserRights.GoSocialPsychologicalBehavioralObservations

            'Changed by Ashish on 6-June-2014
            'Functionality shifted from View->Patient Education to Go->Patient Education
            tsbtn_PatientEducation.Visible = True
            tsbtn_Insurance.Visible = objUserRights.Insurance
            tsbtn_Billing.Visible = objUserRights.Billing
            tsbtn_PatientTasks.Visible = objUserRights.PatientTasks
            ''''''the Rxelig btn will only be seen in foll scenarios
            ''''1. Admin Rights for eligibility = true  and Advance Erx = true Then RxElig Btn is Shown
            ''''2. Admin Rights for eligibility = False and Advance Erx = true Then RxElig Btn is Not Shown
            ''''3. Admin Rights for eligibility = true and Advance Erx = False Then RxElig Btn is Not Shown
            ''''4. Admin Rights for eligibility = False and Advance Erx = False Then RxElig Btn is Not Shown
            If gblnAdvErxEnabled = True Then ''''fixed bug 5797
                tsbtn_EligbilityInfo.Visible = objUserRights.EligibilityInfo
                tlbbtn_RxHub.Visible = objUserRights.EligibilityInfo
                gblnIsRxEligUserRight = objUserRights.EligibilityInfo '''''assign the user right var.
            Else
                tsbtn_EligbilityInfo.Visible = False
                tlbbtn_RxHub.Visible = False
                gblnIsRxEligUserRight = False
            End If


            tlbbtn_PatientSynopsis.Visible = objUserRights.PatientSynopsis


            tsbtn_NewExam.Visible = objUserRights.NewExams
            mnuRptDignosisLabResult.Visible = False
            If mnuRptDignosisLabResult.Visible = False Then
                mnuReports.DropDownItems.Remove(mnuRptDignosisLabResult)
            End If
            ''
            mnuView_CardioVascularRisk.Visible = objUserRights.CardioVascularRisk

            mnuSettings.Visible = objUserRights.Settings
            mnuTools_DefaultDisplaySettings.Visible = objUserRights.LoadDefaultDisplaySettings

            mnuImportVitalGraphData.Visible = False
            ''
            mnu_TimeSynchronization.Visible = objUserRights.TimeSynchronizationwithServer

            mnuImportCCD.Visible = objUserRights.ImportCCD
            mnuGenerateCCD.Visible = objUserRights.GenerateCCD

            '02-May-13 Aniket: Resolving Bug 50030
            tlbbtn_GenerateCCD.Visible = objUserRights.GenerateCCD

            mnu_DM_Rpt_DueGuideline.Visible = False
            If mnu_DM_Rpt_DueGuideline.Visible = False Then
                mnuReports.DropDownItems.Remove(mnu_DM_Rpt_DueGuideline)
            End If
            '' 
            mnuTools_SecureMsg.Visible = objUserRights.SecureMessages
            tlbbtn_Inbox.Visible = objUserRights.SecureMessages
            gblnSecureUserrights = objUserRights.SecureMessages
            If gblnSecureUserrights Then
                gblnIsPatientSavingRights = objUserRights.PatientSaving
            Else
                gblnIsPatientSavingRights = False
            End If


            If gblnIsSecureMsgEnable = False Then
                mnuTools_SecureMsg.Visible = gblnIsSecureMsgEnable
                tlbbtn_Inbox.Visible = gblnIsSecureMsgEnable
                gblnIsPatientSavingRights = False
            End If


            mnuRpt_PatientReminderLetters.Visible = objUserRights.PatientReminderLetters

            mnuViewCCDFiles.Visible = objUserRights.ViewCCDFiles
            mnuPlanOfTreatment.Visible = objUserRights.PlanOfTreatment
            If objUserRights.SentFaxes = False AndAlso objUserRights.PendingFaxes = False AndAlso objUserRights.NewExams = False AndAlso objUserRights.PastExams = False AndAlso objUserRights.PatientOrders = False AndAlso objUserRights.PatientMessages = False AndAlso objUserRights.ViewDocs = False AndAlso objUserRights.PatientProblemList = False AndAlso objUserRights.Prescriptions = False AndAlso objUserRights.Medications = False AndAlso objUserRights.HistoryDetails = False AndAlso objUserRights.AuditTrail = False Then
                pnlPatientDetails.Visible = False
            Else
                pnlPatientDetails.Visible = True
            End If
            If gblnSecurityUser Then
                pnlGrPatientDemoCardsStatus.Visible = False

                mnuTools.Visible = True
                mnuSettings.Visible = True
                mnuTools_CardScanner.Visible = False
                mnuTools_PrescriptionProviderAssociation.Visible = False

                'For CCHIT - If Security User, then should not show the DOCMngt(View Document) or ScanDOCs
                'As View Document Button deleted.
                tlbbtn_ScanDocs.Visible = False ' scan
                mnu_ScanDocs.Visible = False
                tlbbtn_Timeline.Visible = False
                tlbbtn_GenerateCCD.Visible = False
                tlbbtn_gloLabOrders.Visible = False
                tsbtn_PriorAuthorization.Visible = False
                'End
            End If


            If (objUserRights.DMSetup = False) AndAlso (objUserRights.IMSetup = False) AndAlso objUserRights.CVSetup = False Then
                sep8.Visible = False
            Else
                sep8.Visible = True
            End If

            If objUserRights.SmartTreatment = False AndAlso objUserRights.SmartDiagnosis = False AndAlso objUserRights.SmartOrder = False Then
                sep9.Visible = False
            Else
                sep9.Visible = True
            End If

            If objUserRights.RadiologyOrders = False AndAlso objUserRights.PatientPrescription = False AndAlso objUserRights.OrdersAndResults = False AndAlso objUserRights.PatientHistory = False AndAlso objUserRights.PatientMedication = False Then
                tlsMainSep.Visible = False
            Else
                tlsMainSep.Visible = True
            End If

            If objUserRights.PatientRegistration = False AndAlso objUserRights.ModifyPatient = False Then
                sep10.Visible = False
                If objUserRights.PatientCards = False Then
                    tlsPatRegSep.Visible = False
                Else
                    tlsPatRegSep.Visible = True
                End If
            Else
                sep10.Visible = True
                tlsPatRegSep.Visible = True
            End If

            If objUserRights.History = False AndAlso objUserRights.Prescriptions = False AndAlso objUserRights.Medications = False AndAlso objUserRights.OrdersAndResults = False AndAlso objUserRights.PatientOrders = False Then
                tlsMainSep.Visible = False
            Else
                tlsMainSep.Visible = True
            End If

            If (objUserRights.TemplateGallery = False) AndAlso (objUserRights.Category = False) AndAlso (objUserRights.DMSCategory = False) Then
                sep3.Visible = False
            Else
                sep3.Visible = True
            End If

            If (objUserRights.ROS = False) AndAlso (objUserRights.History = False) Then
                sep4.Visible = False
            Else
                sep4.Visible = True
            End If

            sep5.Visible = objUserRights.Contacts

            If (objUserRights.Radiology = False) AndAlso (objUserRights.OrdersAndResultsSetup = False) Then
                sep6.Visible = False
            Else
                sep6.Visible = True
            End If

            If objUserRights.NewExams = False AndAlso objUserRights.PastExams = False AndAlso objUserRights.UnfinishedExams = False Then
                tlsExamSep.Visible = False
            Else
                tlsExamSep.Visible = True
            End If

            If (objUserRights.CDS = True) Then
                tlbbtnSaveCDS.Visible = True
                mnuViewCDSFiles.Visible = True
            Else
                tlbbtnSaveCDS.Visible = False
                mnuViewCDSFiles.Visible = False
            End If
            If (objUserRights.Flowsheet = False) AndAlso (objUserRights.Speciality = False) Then 'And (objUserRights.AppointmentSchedularType = False) Then
                sep7.Visible = False
            Else
                sep7.Visible = True
            End If

            If objUserRights.Calendar = False Then
                tlsCalenderSep.Visible = False
            Else
                tlsCalenderSep.Visible = True
            End If



            If objUserRights.FormGallery = False Then
                tlsFormGalerySep.Visible = False
            Else
                tlsFormGalerySep.Visible = True
            End If

            If objUserRights.ROS = False AndAlso objUserRights.History = False AndAlso objUserRights.PatientMedication = False AndAlso objUserRights.PatientVitals = False Then
                sep11.Visible = False
            Else
                sep11.Visible = True
            End If

            If objUserRights.Messages = False AndAlso objUserRights.PatientPrescription = False Then
                sep12.Visible = False
            Else
                sep12.Visible = True
            End If

            If objUserRights.RadiologyOrders = False AndAlso objUserRights.OrdersAndResults = False Then
                sep13.Visible = False
            Else
                sep13.Visible = True
            End If

            If objUserRights.PatientLetters = False AndAlso objUserRights.PatientPTProtocols = False AndAlso objUserRights.PatientConcent = False AndAlso objUserRights.NurseNotes = False AndAlso objUserRights.DislocureMgmt Then
                sep14.Visible = False
            Else
                sep14.Visible = True
            End If

            If objUserRights.PatientFlowsheet = False AndAlso objUserRights.FormGallery = False AndAlso objUserRights.Tasks = False Then
                sep15.Visible = False
            Else
                sep15.Visible = True
            End If

            If objUserRights.RadiologyOrders = False AndAlso objUserRights.OrdersAndResults = False Then
                sep13.Visible = False
            Else
                sep13.Visible = True
            End If

            If objUserRights.Immunization = False AndAlso objUserRights.PatientHealthPlan = False AndAlso objUserRights.UploadVideo = False Then
                ToolStripSeparator1.Visible = False
            Else
                ToolStripSeparator1.Visible = True
            End If

            If objUserRights.Settings = False AndAlso objUserRights.LoadDefaultDisplaySettings = False Then
                sep16.Visible = False
            Else
                sep16.Visible = True
            End If

            If objUserRights.ExportTemplates = False AndAlso objUserRights.ImportTemplates = False AndAlso objUserRights.UpdateExisting = False AndAlso objUserRights.UpdateOther = False AndAlso objUserRights.UpgradeTemplates = False Then
                sep19.Visible = False
            Else
                sep19.Visible = True
            End If

            If objUserRights.MergePatient = False Then
                sep20.Visible = False
            Else
                sep20.Visible = True
            End If

            If objUserRights.UnlockRecords = False AndAlso objUserRights.ImportVitalGraphData = False AndAlso objUserRights.TimeSynchronizationwithServer = False Then
                sep21.Visible = False
            Else
                sep21.Visible = True
            End If

            If objUserRights.ImportCCD = False AndAlso objUserRights.GenerateCCD = False AndAlso objUserRights.ViewCCDFiles = False Then
                ToolStripSeparator9.Visible = False
            Else
                ToolStripSeparator9.Visible = True
            End If

            If (objUserRights.FAXReports = False) AndAlso (objUserRights.RptExamsPrintFax = False) AndAlso (objUserRights.BatchReferrals = False) Then
                sep23.Visible = False
            Else
                sep23.Visible = True
            End If

            If (objUserRights.RptPatientDemographics = False) AndAlso (objUserRights.RptHCFAReport = False) AndAlso (objUserRights.RptDiagnosisLabResult = False) AndAlso objUserRights.HealthPlansForCriteria = False Then
                sep24.Visible = False
            Else
                sep24.Visible = True
            End If

            If objUserRights.Drugs = False AndAlso objUserRights.SIG = False AndAlso objUserRights.DrugsConfig = False Then
                sep2.Visible = False
            Else
                sep2.Visible = True
            End If

            If gblnSecurityUser = True Then
                pnlPatientDemographics.Visible = False
                pnlPatientStatus.Visible = False

                pnlLeft_Nav.Visible = False
                pnlNav_Appointments.Visible = False
            Else
            End If

            pnlPatientCards.Visible = objUserRights.PatientCards

            If objUserRights.Drugs = False AndAlso objUserRights.SIG = False AndAlso objUserRights.DrugsConfig = False AndAlso objUserRights.TemplateGallery = False AndAlso objUserRights.Category = False AndAlso objUserRights.DMSCategory = False AndAlso objUserRights.ROS = False AndAlso objUserRights.History = False AndAlso objUserRights.Contacts = False AndAlso objUserRights.Radiology = False AndAlso objUserRights.OrdersAndResultsSetup = False AndAlso objUserRights.Flowsheet = False AndAlso objUserRights.Speciality = False AndAlso objUserRights.DMSetup = False AndAlso objUserRights.IMSetup = False AndAlso objUserRights.CVSetup = False AndAlso objUserRights.SmartDiagnosis = False AndAlso objUserRights.SmartTreatment = False AndAlso objUserRights.SmartOrder = False AndAlso objUserRights.EditFormGallery = False AndAlso objUserRights.StatusUsers = False AndAlso objUserRights.ICD9CPTGallery = False AndAlso objUserRights.DisclosureSet = False AndAlso objUserRights.PatientSummary = False AndAlso objUserRights.AppointmentBook = False AndAlso objUserRights.BillingConfiguration = False AndAlso objUserRights.LiquidData = False Then
                mnuMasters.Visible = False
            Else
                mnuMasters.Visible = True
            End If

            If objUserRights.PatientRegistration = False AndAlso objUserRights.ModifyPatient = False AndAlso objUserRights.PatientROS = False AndAlso objUserRights.PatientHistory = False AndAlso objUserRights.PatientMedication = False AndAlso objUserRights.PatientVitals = False AndAlso objUserRights.Messages = False AndAlso objUserRights.PatientPrescription = False AndAlso objUserRights.PatientNewExam = False AndAlso objUserRights.PatientPastExam = False AndAlso objUserRights.Unfinished = False AndAlso objUserRights.RadiologyOrders = False AndAlso objUserRights.OrdersAndResults = False AndAlso objUserRights.PatientConcent = False AndAlso objUserRights.PatientLetters = False AndAlso objUserRights.PatientPTProtocols = False AndAlso objUserRights.DislocureMgmt = False AndAlso objUserRights.NurseNotes = False AndAlso objUserRights.PatientFlowsheet = False AndAlso objUserRights.FormGallery = False AndAlso objUserRights.Tasks = False AndAlso objUserRights.Immunization = False AndAlso objUserRights.PatientHealthPlan = False AndAlso objUserRights.UploadVideo = False AndAlso objUserRights.Charges = False AndAlso objUserRights.Batch = False AndAlso objUserRights.Payment = False AndAlso objUserRights.Remittance = False AndAlso objUserRights.Balance = False AndAlso objUserRights.Ledger = False AndAlso gblnEducationMaterialEnabled = False AndAlso objUserRights.Triage = False AndAlso objUserRights.GoAppointment = False AndAlso objUserRights.GoNewSchedule = False AndAlso objUserRights.GoProblem = False AndAlso objUserRights.GoClinicalChartPrintQueue = False Then
                mnuPatient.Visible = False
            Else
                mnuPatient.Visible = True
            End If
            'tools
            If objUserRights.Settings = False AndAlso objUserRights.LoadDefaultDisplaySettings = False AndAlso objUserRights.ExportTemplates = False AndAlso objUserRights.ImportTemplates = False AndAlso objUserRights.UpdateExisting = False AndAlso objUserRights.UpdateOther = False AndAlso objUserRights.UpgradeTemplates = False AndAlso objUserRights.MergePatient = False AndAlso objUserRights.UnlockRecords = False AndAlso objUserRights.ImportVitalGraphData = False AndAlso objUserRights.TimeSynchronizationwithServer = False AndAlso objUserRights.PatientControl = False AndAlso objUserRights.ImportCCD = False AndAlso objUserRights.GenerateCCD = False AndAlso objUserRights.ViewCCDFiles = False AndAlso objUserRights.Toolbar = False AndAlso objUserRights.Statusbar = False Then
                If gblnIsAdmin Then
                    If gblnVoiceEnabled Then
                        mnuToolsVoiceCenter.Visible = True
                        mnuDoctorSpeakerConfiguration.Visible = True
                        sep18.Visible = True
                        mnuTools.Visible = True
                    Else
                        mnuToolsVoiceCenter.Visible = False
                        mnuDoctorSpeakerConfiguration.Visible = False
                        sep18.Visible = False
                        If gblnSecurityUser = False Then
                            mnuTools.Visible = False
                        Else
                            mnuTools.Visible = True
                            pnlPatientCheckInStatus.DockState = Janus.Windows.UI.Dock.PanelDockState.Docked
                            pnlPatientCheckInStatus.Visible = False
                        End If
                    End If
                Else
                    mnuToolsVoiceCenter.Visible = False
                    mnuDoctorSpeakerConfiguration.Visible = False
                    sep18.Visible = False
                    mnuTools.Visible = True
                End If

            Else
                mnuTools.Visible = True
            End If

            'MSI Reports
            mnu_MISReports_ProductionByMonth.Visible = ogloUserRights.ProdByMonth
            mnu_MISReports_ProductionByMonth.Visible = ogloUserRights.ProdByMonth


            If objUserRights.UnfinishedExams = False AndAlso objUserRights.FAXReports = False AndAlso objUserRights.RptExamsPrintFax = False AndAlso objUserRights.ReviewExams = False AndAlso (objUserRights.BatchReferrals = False) AndAlso objUserRights.RptPatientDemographics = False AndAlso objUserRights.RptHCFAReport = False AndAlso objUserRights.HealthPlansForCriteria = False AndAlso mnuRptIMDueReport.Visible = False AndAlso objUserRights.ImmunizationDueRpt = False AndAlso objUserRights.PatientReminderLetters = False AndAlso objUserRights.RptDiagnosisLabResult = False Then
                mnuReports.Visible = False
            Else
                mnuReports.Visible = True
            End If

            'View
            'Added Code Changes for View OBVitals
            If objUserRights.ViewTasks = False AndAlso objUserRights.PatientViewVitals = False AndAlso objUserRights.ViewOBVitals = False AndAlso objUserRights.ViewMessages = False AndAlso objUserRights.ViewFormGallery = False AndAlso objUserRights.ViewReferrals = False AndAlso objUserRights.ViewPatientLetters = False AndAlso objUserRights.ViewPatientConcent = False AndAlso objUserRights.ViewPatientConcentTracking AndAlso objUserRights.ViewPTProtocols = False AndAlso objUserRights.ViewDiscloures = False AndAlso objUserRights.ViewPatientVideo = False AndAlso objUserRights.ViewReceivedFaxes = False AndAlso objUserRights.ViewOutstandingOrders = False AndAlso objUserRights.ViewPendingRefillRequest = False AndAlso objUserRights.ViewErrorMessages = False AndAlso objUserRights.ViewNurseNotes = False AndAlso objUserRights.ViewPatientSummary = False AndAlso objUserRights.ViewPendingLabOrders = False AndAlso objUserRights.Mails = False AndAlso objUserRights.DICOM = False AndAlso objUserRights.PatientSynopsis = False AndAlso objUserRights.PatientConfidential = False AndAlso objUserRights.PatientChiefComplaints = False AndAlso objUserRights.CardioVascularRisk = False Then
                mnuView.Visible = False
            Else
                mnuView.Visible = True
            End If

          
            'MIS REPORTS USER RIGHTS ''
            mnu_MISReports.Visible = False
            If mnu_MISReports.Visible = False Then
                mnuReports.DropDownItems.Remove(mnu_MISReports)
            End If
            mnu_MISReports_AgingAnalysis.Visible = ogloUserRights.ASumary
            mnu_MISReports_AgingSummaryByInsuranceCarrier.Visible = ogloUserRights.ASumaryByInsCarrier
            mnu_MISReports_AgingSummaryByPatient.Visible = ogloUserRights.ASumaryByPat
            mnu_MISReports_PatientPaymentHistory.Visible = ogloUserRights.PatPayHistory
            mnu_MISReports_Patientstatement.Visible = ogloUserRights.PatStatement
            mnu_MISReports_PatientTransactionHistory.Visible = ogloUserRights.PatTransHistory
            mnu_MISReports_ProductionAnalysisandTrendsByMonth.Visible = ogloUserRights.ProdAnalysisByTrendsByMonth
            mnu_MISReports_ProductionAnalysisByFacility.Visible = ogloUserRights.ProdAnalysisByFacility
            mnu_MISReports_ProductionAnalysisByprocedureGroup.Visible = ogloUserRights.ProdAnalysisByPG
            mnu_MISReports_ProductionByDate.Visible = ogloUserRights.ProdByDate
            mnu_MISReports_ProductionByDoctor.Visible = ogloUserRights.ProdByDoctor
            mnu_MISReports_ProductionByFacility.Visible = ogloUserRights.ProdByFacility
            mnu_MISReports_ProductionByFacilityByPatient.Visible = ogloUserRights.ProdByFacilityByPatSummary
            mnu_MISReports_ProductionByFacilityByPatientDetail.Visible = ogloUserRights.ProdByFacilityByPatDetail
            mnu_MISReports_ProductionByInsuranceCarrier.Visible = ogloUserRights.ProdByInsCarrier
            mnu_MISReports_ProductionByMonth.Visible = ogloUserRights.ProdByMonth
            mnu_MISReports_ProductionByPhysicianGroup.Visible = ogloUserRights.ProdByPhysicianGroup
            mnu_MISReports_ProductionByProcedureCode.Visible = ogloUserRights.ProdByProcCode
            mnu_MISReports_ProductionByProcedureGroup.Visible = ogloUserRights.ProdByProcGroup
            mnu_MISReports_ProductionTrendsByProcedureGrop.Visible = ogloUserRights.ProdTrendsByProcGroup
            mnu_MISReports_ReimbursementByCPTByInsurance.Visible = ogloUserRights.ReimbByCPTByInsCarrier
            mnu_MISReports_ReimbursementByDoctorByInsurance.Visible = ogloUserRights.ReimbByDocByInsCarrier
            mnu_MISReports_ReimbursementByInsuranceByCPT.Visible = ogloUserRights.ReimbByInsCarrierByCPT
            mnu_MISReports_ReimbursementByInsuranceCarrier.Visible = ogloUserRights.ReimbByInsCarrier
            mnu_MISReports_ReimbursementByInsuranceForCPT.Visible = ogloUserRights.ReimbByInsCarrierForCPT
            mnu_MISReports_ReimbursementByMonth.Visible = ogloUserRights.ReimbByMonth
            mnu_MISReports_ReimbursementByMonthDetail.Visible = ogloUserRights.ReimbByMonthByAcc
            mnu_MISReports_ReimbursementDetailsByAccount.Visible = ogloUserRights.ReimbDetailsByAcc

            'Start :: Customizable Reports
            CustomizableReportsToolStripMenuItem.Visible = ogloUserRights.CustomizableReports

            If objUserRights.Appointment = False Then
                tsbtn_Appointments.Visible = False
                ToolStripSeparator11.Visible = False
            Else
                tsbtn_Appointments.Visible = True
                ToolStripSeparator11.Visible = True
            End If

            mnu_ClosedJournals.Visible = False
            mnuTools_CardImage.Visible = False

            ToolStripMenuItem3.Visible = ogloUserRights.ClinicalExchange

            'code added to check intuit user and application rights


            If gblnIntuitCommunication Then
                tsbtn_IntuitCommunication.Visible = True
                If objUserRights.Intuit = True Then
                    tsbtn_IntuitCommunication.Visible = True
                    mnuTools_SendSecureMessage.Visible = True
                    btnIntuitMsg.Visible = True
                Else
                    'tsbtn_IntuitCommunication.Visible = False
                    mnuTools_SendSecureMessage.Visible = False
                    btnIntuitMsg.Visible = False
                End If
            Else
                tsbtn_IntuitCommunication.Visible = False
                mnuTools_SendSecureMessage.Visible = False
                btnIntuitMsg.Visible = False
            End If

            ''Task #68533: gloEMR Admin - User Management - User Rights - Change "Intuit" to "Patient Portal"
            ''added to show activation report menu.
            If gblnPatientPortalEnabled Then
                PatientActivationReportsToolStripMenuItem.Visible = True
                mnuReports_PortalPHIReview.Visible = True
                mnu_PortalPHI.Visible = True
            Else
                PatientActivationReportsToolStripMenuItem.Visible = False
                mnuReports_PortalPHIReview.Visible = False
                mnu_PortalPHI.Visible = False
            End If


            ''gloCommunity - Added User rights settings on 20120727
            If gblngloCommunity = True Then
                ''As per Piyush sir suggestion hide My Community tab on 20121019
                MyCommunityToolStripMenuItem.Visible = False
                ''End

                gblnIsShareUserRights = objUserRights.Share
                If objUserRights.CommunityConnect = False AndAlso objUserRights.MyCommunity = False AndAlso objUserRights.Share = False Then
                    mnuSharepoint.Visible = False
                Else
                    ConnectCommunityToolStripMenuItem.Visible = objUserRights.CommunityConnect
                    ShareToolStripMenuItem.Visible = objUserRights.Share
                End If
                If gstrgloCommunityAuthentication.ToLower() = "windows" Then
                    ShareToolStripMenuItem.Visible = False
                    mnuChangePwd.Visible = False
                End If
                If gstrgloCommunityAuthentication.ToLower() = "claim" Then
                    mnuChangePwd.Visible = False
                End If
            End If
            ''End


            'Code added by pranit on 27 july 2012 to solve bug #31936 version 7007
            If gblnSecurityUser = True Then
                mnuSharepoint.Visible = False
                ToolStripMenuItem3.Visible = False
                mnuCustomLink.Visible = False
                mnuTools_DirectInbox.Visible = False
                tlbbtn_RxHub.Visible = False
                tsbtn_PatientCases.Visible = False
                tsbtn_IntuitCommunication.Visible = False
                tlbbtn_Inbox.Visible = False
            End If
            'End code by pranit
            If gblnIsOBSpecialityEnabled = True Then
                mnuOBReport.Visible = True
            Else
                mnuOBReport.Visible = False
            End If
            If gblnEnableCQMCypressTesting = True Then
                mnuTools_QRDAImport.Visible = True
            Else
                mnuTools_QRDAImport.Visible = False
            End If
            gloCCDLibrary.gloLibCCDGeneral.bViewCDAErrors = objUserRights.ViewCDAErrros

            gloCCDLibrary.gloLibCCDGeneral.bImportRestrictedCCD = objUserRights.ImportRestrictedCCDA

        Catch ex As Exception
            MsgBox(ex.ToString)
        Finally
            If Not IsNothing(ogloUserRights) Then
                ogloUserRights.Dispose()
                ogloUserRights = Nothing
            End If


        End Try
    End Sub

    ''' <summary>
    ''' To Hide the gloPM functionality in gloEMR 
    ''' </summary>
    ''' <remarks></remarks>


#End Region

#Region " Dash Board Load Functionality "

    Private Sub GetDefaultsettings()

        Dim objSettings As New clsSettings
        objSettings.GetSettings()

        'if DIB database URL is not set through admin
        If gloEMRGeneralLibrary.gloGeneral.clsgeneral.sDIBServiceURL.Trim() = "" Then ''''bug fixed 7750
            MessageBox.Show("Drug database URL not set. Set it from gloEMR Admin ->Settings -> Surescript Settings -> DIB Service URL ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End
        End If

        'if mmw database setting is not set through admin
        If gloEMRGeneralLibrary.gloGeneral.clsgeneral.sDmsServerName.Trim() = "" Or gloEMRGeneralLibrary.gloGeneral.clsgeneral.sDmsDatabaseName.Trim() = "" Then
            MessageBox.Show("DMS database is not set. Set it from gloEMR Admin ->Settings -> Server Settings -> DMS Database settings", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End
        End If


        'Validation on HL7 Database setting
        If gloEMRGeneralLibrary.gloGeneral.clsgeneral.gstrHL7ServerName.Trim() = "" Or gloEMRGeneralLibrary.gloGeneral.clsgeneral.gstrHL7DatabaseName.Trim() = "" Then
            MessageBox.Show("HL7 database is not set. Set it from gloEMR Admin ->Settings -> Server Settings -> HL7 Database settings", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End
        End If

        If Not IsNothing(objSettings.IsEnableRecoverExam) Then
            gBlnEnableRecoverExam = Convert.ToBoolean(objSettings.IsEnableRecoverExam())
        End If
        'End

        If IsNothing(objSettings.AppointmentStartTime) = False Then
            gClinicStartTime = objSettings.AppointmentStartTime
        End If
        If IsNothing(objSettings.AppointmentEndTime) = False Then
            gClinicEndTime = objSettings.AppointmentEndTime
        End If
        If IsNothing(objSettings.AppointmentInterval) = False Then
            gnAppointmentInterval = objSettings.AppointmentInterval
        Else
            gnAppointmentInterval = 15
        End If
        If IsNothing(objSettings.PULLCHARTSInterval) = False Then
            gnPULLCHARTSInterval = objSettings.PULLCHARTSInterval
        Else
            gnPULLCHARTSInterval = 15
        End If
        If IsNothing(objSettings.FAXNoOfAttempts) = False Then
            gnNoOfAttempts = objSettings.FAXNoOfAttempts
        Else
            gnNoOfAttempts = 15
        End If
        If IsNothing(objSettings.FAXCompression) = False Then
            gstrFAXCompression = objSettings.FAXCompression
        Else
            gstrFAXCompression = "CCITT G3"
        End If

        'Rx setting
        If IsNothing(objSettings.RxDeclarationText) = False Then
            RxDeclaration = objSettings.RxDeclarationText
        Else
            RxDeclaration = ""
        End If

        'RxHub - Disclaimer
        If IsNothing(objSettings.RxHubDisclaimer) = False Then
            gstrRxHubDisclaimer = objSettings.RxHubDisclaimer
        Else
            gstrRxHubDisclaimer = ""
        End If
        'RxHub - Disclaimer

        If IsNothing(objSettings.RxFooterNote) = False Then
            RxFooterNote = objSettings.RxFooterNote
        Else
            RxFooterNote = ""
        End If

        blnHPIEnabled = objSettings.HPIEnabled
        blnLocationAddress = objSettings.LocationAddress

        If IsNothing(objSettings.OMRCategory_History) = False Then
            gOMRCategory_History = objSettings.OMRCategory_History
        End If
        If IsNothing(objSettings.OMRCategory_ROS) = False Then
            gOMRCategory_ROS = objSettings.OMRCategory_ROS
        End If
        If IsNothing(objSettings.OMRCategory_PatientRegistration) = False Then
            gOMRCategory_PatientRegistration = objSettings.OMRCategory_PatientRegistration
        End If

        If IsNothing(objSettings.DMSCategory_PatientDirective) = False Then
            gDMSCategory_PatientDirective = objSettings.DMSCategory_PatientDirective
        End If
        If IsNothing(objSettings.ClinicDISettings) = False Then
            If objSettings.ClinicDISettings = "0" Then
                gblnClinicDISetting = False

            Else
                gblnClinicDISetting = True

            End If

        End If

        'setting for clinic level formulary alert
        If IsNothing(objSettings.ClinicFormularySettings) = False Then
            If objSettings.ClinicFormularySettings = "0" Then
                gblnClinicFormularyAlert = False
                gblnLoadFormularyDrugs = False
            Else
                gblnClinicFormularyAlert = True
                gblnLoadFormularyDrugs = True
            End If
        End If

        If IsNothing(objSettings.RecordLevelLocking) = False Then
            gblnRecordLocking = objSettings.RecordLevelLocking
        Else
            gblnRecordLocking = True
        End If

        gnPatientID = GetPatientID(gstrPatientCode)

        'internet fax
        If IsNothing(objSettings.InternetFax) = False Then
            gblnInternetFax = objSettings.InternetFax
        Else
            gblnInternetFax = False
        End If
        'eFax Login Key
        If Not IsNothing(objSettings.eFaxUserID) = True Then
            gstrEFaxUserID = objSettings.eFaxUserID
        Else
            gstrEFaxUserID = ""
        End If

        Dim objEncryptDecrypt As New clsencryption

        If Not IsNothing(objSettings.eFaxUserPassword) = True Then
            gstrEFaxUserPassword = objEncryptDecrypt.DecryptFromBase64String(objSettings.eFaxUserPassword, constEncryptDecryptKey)
        Else
            gstrEFaxUserPassword = ""
        End If

        If Not IsNothing(objSettings.RxHubPassword) = True Then
            gstrRxHubPassword = objEncryptDecrypt.DecryptFromBase64String(objSettings.RxHubPassword, constEncryptDecryptKey)
        Else
            gstrRxHubPassword = ""
        End If
        ''added for problem 00000512 memory leak 
        If Not IsNothing(objEncryptDecrypt) Then
            objEncryptDecrypt.Dispose()
            objEncryptDecrypt = Nothing
        End If
        If Not IsNothing(objSettings.RxHubParticipantId) = True Then
            gstrRxHubParticipantId = objSettings.RxHubParticipantId
        Else
            gstrRxHubParticipantId = ""
        End If


        gblnSurescriptEnabled = objSettings.IsSurescriptEnabled
        gblnStagingServer = objSettings.IsStagingServer

        'Advance eRx settings
        gblnAdvErxEnabled = objSettings.IsAdvErxEnabled
        gblnRxhubStagingServer = objSettings.IsRxHubStagingServer

        'Retrieve the CCD file path
        gstrCCDFilePath = objSettings.CCDFilePath
        ''Style Sheet Path
        gstrStyleSheetPath = objSettings.StyleSheetPath
        gblnGenerateMicReport = objSettings.getMic

        'retrieve the MCIR report path
        gstrMCIRReportPath = objSettings.MCIRReportPath

        'Retrieve Advanced Growth Chart Setting
        gblnAdvancedGrowthChart = objSettings.ShowAdvancedGrowthChart

        gstrSignatureText = objSettings.SignatureText
        gstrCoSignatureText = objSettings.CoSignatureText

        If IsNothing(objSettings.RXELIGIBILITYEMR) = False Then
            gRXELIGIBILITYEMR = objSettings.RXELIGIBILITYEMR
        End If
        If IsNothing(objSettings.EDISERVICEPATH) = False Then
            gEDISERVICEPATH = objSettings.EDISERVICEPATH ''''this will contain the url to which the EDI rxeligibility request will be sent
        End If
        If IsNothing(objSettings.AutoEligibility) = False Then
            gblnAutoEligibility = objSettings.AutoEligibility ''''Set setting for Auto Eligibility is ON/OFF
        End If
        If IsNothing(objSettings.AutoPDMPEligiblity) = False Then
            gblnAutoPDMPEligiblity = objSettings.AutoPDMPEligiblity ''''Set setting for Auto Eligibility is ON/OFF
        End If
        If IsNothing(objSettings.PDMPSendToDMS) = False Then
            gblPDMPSaveToDMS = objSettings.PDMPSendToDMS ''''Set setting for save  pdmp to dms
        End If
        If IsNothing(objSettings) = False Then
            objSettings.Dispose() : objSettings = Nothing
        End If

    End Sub

    Private Function GetHealthPlanSetting() As Boolean

        Dim sqlconn As New SqlConnection(GetConnectionString)
        Dim sqlcmd As SqlCommand = Nothing
        Dim _strQuery As String
        Dim blnShowHealthPlan As Boolean


        Try
            _strQuery = "SELECT sSettingsValue FROM Settings WHERE sSettingsName = 'ShowHealthPlan'"
            sqlconn.Open()
            sqlcmd = New SqlCommand(_strQuery, sqlconn)
            blnShowHealthPlan = sqlcmd.ExecuteScalar
            sqlconn.Close()

            gblnShowHealthPlan = blnShowHealthPlan

            Return blnShowHealthPlan


        Catch ex As Exception
            sqlconn.Close()
            sqlcmd.Dispose()
            MessageBox.Show(ex.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        Finally

            _strQuery = Nothing

            If Not IsNothing(sqlcmd) Then
                sqlcmd.Parameters.Clear()
                sqlcmd.Dispose()
                sqlcmd = Nothing
            End If

            If Not IsNothing(sqlconn) Then
                sqlconn.Dispose()
                sqlconn = Nothing
            End If
        End Try
        Return Nothing
    End Function

    Private Sub GetCheckedOutAppointmentSetting()
        Dim sqlconn As New SqlConnection(GetConnectionString)
        Dim sqlcmd As SqlCommand = Nothing
        Dim _strQuery As String = ""
        Try
            _strQuery = "SELECT sSettingsValue FROM Settings WHERE sSettingsName = 'CheckedOutAppointment' AND  nClinicID = " & gnClinicID & "  AND nUserID = " & gnLoginID & " "
            sqlconn.Open()
            sqlcmd = New SqlCommand(_strQuery, sqlconn)
            _strQuery = sqlcmd.ExecuteScalar & ""

            If IsNothing(_strQuery) = True Then
                _strQuery = ""
            End If

            If _strQuery.Trim() = "False" Or _strQuery.Trim() = "" Then
                gblnShowCheckedOutAppointment = False
            Else
                gblnShowCheckedOutAppointment = True
            End If

            sqlconn.Close()
        Catch ex As Exception
            sqlconn.Close()
            sqlcmd.Dispose()
            MessageBox.Show(ex.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            'sqlconn.Close()
            'sqlcmd.Dispose()
            'Code opti
            If Not IsNothing(sqlcmd) Then
                sqlcmd.Parameters.Clear()
                sqlcmd.Dispose()
                sqlcmd = Nothing
            End If
            If Not IsNothing(sqlconn) Then
                sqlconn.Dispose()
                sqlconn = Nothing
            End If
        End Try
    End Sub

    'Read DefaulNavigation setting 
    Private Sub SetNavigationPnl()
        _DefaultNavigation = "Appointment"
        _isShowDialogueForm = True
        RegisterMyHotKey()
        Try
            If gloRegistrySetting.OpenSubKey(gloRegistrySetting.gstrSoftEMR) = False Then
                Exit Sub
            End If

            gloRegistrySetting.OpenSubKey(gloRegistrySetting.gstrSoftEMR, True)

            If IsNothing(gloRegistrySetting.GetRegistryValue("DefaultNavigation")) = True Then
                gloRegistrySetting.SetRegistryValue("DefaultNavigation", "Appointment")
            Else
                _DefaultNavigation = gloRegistrySetting.GetRegistryValue("DefaultNavigation")
            End If
            'gloRegistrySetting.CloseRegistryKey()

            Select Case _DefaultNavigation
                Case "Appointment"
                    pnlLeft_Nav.SelectedPanel = pnlNav_Appointments
                    pnlNav_Appointments_Click(Nothing, Nothing)
                Case "Calender"
                    pnlLeft_Nav.SelectedPanel = pnlNav_Calendar
                    pnlNav_Calendar_Click(Nothing, Nothing)
                Case "Triage"
                    pnlLeft_Nav.SelectedPanel = pnlNav_Triage
                    ShowTriage()
                    pnlNav_Triage_Click(Nothing, Nothing)
                Case "MyDay"
                    pnlLeft_Nav.SelectedPanel = pnlNav_Myday
                    pnlNav_Myday_Click(Nothing, Nothing)
            End Select
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            _isShowDialogueForm = False
        End Try

    End Sub

    Private Sub Fill_ProvidersAndPatients()
        Try
            If gblnYesNoLab = False Then
                pnlYESLAB.Visible = False
            End If
            Dim objLogin As New clsLogin
            gstrLoginProviderName = objLogin.DefaultLoginProvider(gstrLoginName, gnLoginProviderID)
            objLogin.Dispose()  ''slr free objLogin
            objLogin = Nothing
            'Fill the Setting for the Login Provider
            Call Fill_ProviderSettings()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    ''' <summary>
    ''' To Show All Information of the Selected Patient 
    ''' like Patient DemoGraphics, Patient Cards, Patient Status,Alerts, Patient Details etc
    ''' </summary>
    ''' <remarks>
    ''' 
    ''' </remarks>
    ''' 
    Public Sub ShowPatientAllDetails(ByVal patientID As Int64, Optional ByVal blnFromModify As Boolean = False, Optional ByVal blnrefreshall As Boolean = False, Optional ByVal _IsFormClosing As Boolean = False)

        oPatientListControl.SelectedPatientID = 0
        gnPatientID = patientID
        appSettings("PatientID") = gnPatientID.ToString
        appSettings("DefaultPrinter") = gblnUseDefaultPrinter
        oPatientListControl.SelectedPatientID = gnPatientID
        gblnProviderDisable = IsPatientProviderDisabled(gnPatientID)

        'Implement 'lock status'
        'Check Patient Status
        If gbAllowEmergencyAccess = False Then
            'If CheckPatientStatus(gnPatientID, , , True) = False Then
            If CheckPatientStatus_new(gstrPatientStatus, True) = False Then
                'set left navigation panel
                SetNavigationPnl()
                'set left navigation panel

                C1dgPatientDetails.DataSource = Nothing
                C1dgPatientDetails.Clear(ClearFlags.All)
                gloC1FlexStyle.Style(C1dgPatientDetails)
                C1dgPatientDetails.AllowEditing = False
                C1dgPatientDetails.AllowSorting = AllowSortingEnum.SingleColumn
                C1dgPatientDetails.ScrollBars = ScrollBars.None
                C1dgPatientDetails.Rows.Count = 1
                '''''''''' Set Panel Title
                Select Case SelectedPatientDetail
                    Case PatientDetails.AuditTrail
                        pnlPatientDetail.Text = "Audit Log"
                    Case PatientDetails.NewExam
                    Case PatientDetails.PastExams
                        pnlPatientDetail.Text = "Past Exams"
                    Case PatientDetails.Medication
                        pnlPatientDetail.Text = "Medication"
                    Case PatientDetails.Prescription
                        pnlPatientDetail.Text = "Prescription"
                    Case PatientDetails.Messages
                        pnlPatientDetail.Text = "Messages"
                    Case PatientDetails.OrderTemplates
                        pnlPatientDetail.Text = "Order Templates"
                    Case PatientDetails.FAX_Sent
                        pnlPatientDetail.Text = "Sent Fax"
                    Case PatientDetails.FAX_Pending
                        pnlPatientDetail.Text = "Pending Fax"
                    Case PatientDetails.ProblemList
                        pnlPatientDetail.Text = "Problem List"
                    Case PatientDetails.History
                        pnlPatientDetail.Text = "History"
                    Case PatientDetails.Triage
                        pnlPatientDetail.Text = "Triage"
                    Case PatientDetails.Vitals
                        pnlPatientDetail.Text = "Vitals"

                        'Added Code Changes for View OBVitals
                    Case PatientDetails.OBVitals
                        pnlPatientDetail.Text = "OB Vitals"

                    Case PatientDetails.ViewDocs
                        pnlPatientDetail.Text = "View Documents"
                    Case PatientDetails.Insurance
                        pnlPatientDetail.Text = "Insurance"
                    Case PatientDetails.Billing
                        pnlPatientDetail.Text = "Billing"
                    Case PatientDetails.NYWorkerCompForms
                        pnlPatientDetail.Text = "NY WC Forms"
                    Case PatientDetails.NurseNotes
                        pnlPatientDetail.Text = "Nurse Notes"
                    Case PatientDetails.DisclosureManagement
                        pnlPatientDetail.Text = "Disclosure Management"
                    Case PatientDetails.PatientConsent
                        pnlPatientDetail.Text = "Patient Consent"
                    Case PatientDetails.PatientLetters
                        pnlPatientDetail.Text = "Patient Letters"
                    Case PatientDetails.HealthPlan
                        pnlPatientDetail.Text = "Health Plan"
                    Case PatientDetails.Orders
                        pnlPatientDetail.Text = "Orders"
                    Case PatientDetails.EligibilityInformation
                        pnlPatientDetail.Text = "Eligibility Information"
                    Case PatientDetails.PatientAppointments
                        pnlPatientDetail.Text = "Appointments"
                    Case PatientDetails.Balance
                        pnlPatientDetail.Text = "Balance"
                    Case PatientDetails.Referrals
                        pnlPatientDetail.Text = "Referrals"
                    Case PatientDetails.None
                        pnlPatientDetail.Text = ""
                    Case PatientDetails.PatientEducation
                        pnlPatientDetail.Text = "Patient Education"
                End Select
                'Set Panel Title

                'Set Demographics
                FillDemographicInformation()
                'Set Demographics
                'clear image
                oPatientCards.Clear()
                picPC_Cards.Image = Nothing
                picPC_Cards.Tag = Nothing
                'clear image
                'clear check in/checkout message
                c1PatientStatus.Rows.Count = 1
                'clear check in/checkout message
                Exit Sub
            End If
        Else
            If SelectedPatientDetail = PatientDetails.None Then
                SelectedPatientDetail = PatientDetails.History
            End If
        End If

        ShowPatientDetails(, True)
        ShowPatientAlerts()
        'The below function call is required to set gnvisitid as it was working previously
        gnVisitID = GetVisitID(Date.Now, gnPatientID)
        If blnFromModify = True Or blnrefreshall = True Then
            FillDemographicInformation()
            FillCardInformation()
            SetYesLab()
            GetPatientConfidentialInfo()
        End If
        If blnrefreshall = True Then
            Get_ClinicEnvironment()
            ShowPatientStatus()
        End If


        'Get_PatientLocationStatus()
        tmrCopayAlert.Stop()

        If Not IsNothing(pnlLeft_Nav.SelectedPanel) Then
            If pnlLeft_Nav.SelectedPanel.Text.ToUpper = NAV_ALERTS Then
                ShowCopayAlert()
                ShowUnappliedCopayAlert()
            End If
        End If

    End Sub

    Private Sub SecurityUserSettings()
        Try
            If gblnSecurityUser Then
                pnlLeft_Nav.Visible = False
                pnlPatientDemographics.Parent.Visible = False
                pnlPatientStatus.Parent.Visible = False
                pnlPatientCard.Parent.Visible = False
                mnuWindow.Visible = False
                mnu_DashBoard.Visible = False

                pnlPatientCheckInStatus.DockState = Janus.Windows.UI.Dock.PanelDockState.Docked
                pnlPatientCheckInStatus.Visible = False

                'Hide Separators in Patient details
                'If user is security user then system displays only Audit Trail

                For Each oSeparator As ToolStripItem In ts_PatientDetails.Items
                    If TypeOf oSeparator Is ToolStripSeparator Then
                        oSeparator.Visible = False
                    End If
                Next
                'Hide Separators in main toolstrip
                For Each omnuSeparator As ToolStripItem In tlbStripMain.Items
                    If TypeOf omnuSeparator Is ToolStripSeparator Then
                        omnuSeparator.Visible = False
                    End If
                Next
            Else
                mnuWindow.Visible = True
                mnu_DashBoard.Visible = True

            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ShowPatientDetailsOnUserRights()
    End Sub

    Private Sub SetToolTip()
    End Sub

    Public Function ButtonsToHide(ByVal moduleName As frmToolButtonSelection.enumModuleName) As ArrayList
        Dim _Buttons As New ArrayList
        objUserRights = Nothing  ''slr free previous memory
        objUserRights = New clsLoginUserRights

        objUserRights.RetrieveUserRights(gstrLoginName)

        If moduleName = frmToolButtonSelection.enumModuleName.Dashboard Then

            If objUserRights.PatientRegistration = False Then
                _Buttons.Add(tlbbtn_NewPatient.Tag.Trim)
            End If
            If objUserRights.ModifyPatient = False Then
                _Buttons.Add(tlbbtn_ModifyPatient.Tag.Trim)
            End If
            If objUserRights.PatientCards = False Then
                _Buttons.Add(tlbbtn_ScanCard.Tag.Trim)
            End If
            If objUserRights.PatientHistory = False Then
                _Buttons.Add(tlbbtn_History.Tag.Trim)
            End If
            If objUserRights.RadiologyOrders = False Then
                _Buttons.Add(tlbbtn_Orders.Tag.Trim)
            End If

            '02-May-13 Aniket: Resolving Bug 50030
            If objUserRights.OrdersAndResults = False Then
                _Buttons.Add(tlbbtn_LabOrders.Tag.Trim)
                _Buttons.Add(tlbbtn_gloLabOrders.Tag.Trim)
                _Buttons.Add(tlbbtn_Timeline.Tag.Trim)
            End If

            '02-May-13 Aniket: Resolving Bug 50030
            If objUserRights.ViewSchedule = False Then
                _Buttons.Add(tlbbtn_Sechedule.Tag.Trim)
            End If

            '02-May-13 Aniket: Resolving Bug 50030
            If objUserRights.GenerateCCD = False Then
                _Buttons.Add(tlbbtn_GenerateCCD.Tag.Trim)
            End If

            If objUserRights.PatientVitals = False Then
                _Buttons.Add(tlbbtn_Vitals.Tag.Trim)
            End If

            If objUserRights.PatientMedication = False Then
            End If

            ''06-May-13 Aniket: Resolving Bug 50030
            'If objUserRights.EligibilityInfo = False Or gblnClinicFormularyAlert = False Or gblnMachineFormularyAlert = False Then
            '    '_Buttons.Add(tsbtn_EligbilityInfo.Tag.Trim)
            '    _Buttons.Add(tlbbtn_RxHub.Tag.Trim)
            'End If

            If objUserRights.PatientPrescription = False Then
                _Buttons.Add(tlbbtn_Prescription.Tag.Trim)
            End If


            If objUserRights.PatientNewExam = False Then
                _Buttons.Add(tlbbtn_NewExam.Tag.Trim)
            End If
            If objUserRights.PatientPastExam = False Then
                _Buttons.Add(tlbbtn_PastExam.Tag.Trim)
            End If
            If objUserRights.Unfinished = False Then
                _Buttons.Add(tlbbtn_UnFinishedExams.Tag.Trim)
            End If
            ' tlbbtn_Sechedule
            If objUserRights.Calendar = False Then
                _Buttons.Add(tlbbtn_Calender.Tag.Trim)
            End If

            If objUserRights.DocMgmt = False Then
                _Buttons.Add(tlbbtn_ScanDocs.Tag.Trim)
            End If
            If objUserRights.RCMDocumentManagement = False Then
                _Buttons.Add(tlbbtn_RCMDocs.Tag.Trim)
            End If


            If objUserRights.PatientSynopsis = False Then
                _Buttons.Add(tlbbtn_PatientSynopsis.Tag.Trim)
            End If
            If objUserRights.FormGallery = False Then
                _Buttons.Add(tlbbtn_FormGallery.Tag.Trim)
            End If

            If objUserRights.CDS = False Then
                _Buttons.Add(tlbbtnSaveCDS.Tag.Trim)
            End If

            'TO HIDE LAB BUTTON  .
            _Buttons.Add(tlbbtn_LabOrders.Tag.Trim())
            'End

        ElseIf moduleName = frmToolButtonSelection.enumModuleName.PatientDetails Then '' ELSE BY SUDHIR 20091212 ''

            If Not IsEnableWorkersCompForms() Then
                _Buttons.Add(tsbtn_NYWCForms.Tag)
            End If

            If objUserRights.GoSocialPsychologicalBehavioralObservations = False Then
                _Buttons.Add(tsbtn_SPB.Tag)
            End If

            If objUserRights.HistoryDetails = False Then
                _Buttons.Add(tsbtn_History.Tag)
            End If
            If objUserRights.PastExams = False Then
                _Buttons.Add(tsbtn_PastExam.Tag)
            End If
            If objUserRights.Medications = False Then
                _Buttons.Add(tsbtn_Medication.Tag)
            End If
            If objUserRights.Prescriptions = False Then
                _Buttons.Add(tsbtn_Prescription.Tag)
            End If
            If objUserRights.AuditTrail = False Then
                _Buttons.Add(tsbtn_AuditTrail.Tag)
            End If
            If objUserRights.PatientOrders = False Then
                _Buttons.Add(tsbtn_Orders.Tag)

            End If

            If objUserRights.PatientMessages = False Then
                _Buttons.Add(tsbtn_Messages.Tag)
            End If
            If objUserRights.PendingFaxes = False Then
                _Buttons.Add(tsbtn_PendingFax.Tag)
            End If
            If objUserRights.PatientProblemList = False Then
                _Buttons.Add(tsbtn_ProblemList.Tag)
            End If
            If objUserRights.SentFaxes = False Then
                _Buttons.Add(tsbtn_Sentfax.Tag)
            End If
            If objUserRights.Insurance = False Then
                _Buttons.Add(tsbtn_Insurance.Tag)
            End If
            If objUserRights.Billing = False Then
                _Buttons.Add(tsbtn_Billing.Tag)
            End If
            If objUserRights.ViewDocs = False Then
                _Buttons.Add(tsbtn_ViewDocs.Tag)
            End If
            If objUserRights.Appointment = False Then
                _Buttons.Add(tsbtn_Appointments.Tag)
            End If
            If objUserRights.PatientTasks = False Then
                _Buttons.Add(tsbtn_PatientTasks.Tag)
            End If
            If objUserRights.OrdersAndResults = False Then ''changes made for problem 00000255
                _Buttons.Add(tsbtn_Labs.Tag.ToString().Trim())
                _Buttons.Add(tsbtn_Order.Tag.ToString().Trim())
            End If
            If gblnIntuitCommunication = False Then
                '    If objUserRights.Intuit = False Then
                '        _Buttons.Add(tsbtn_IntuitCommunication.Tag)
                '    End If
                'Else
                _Buttons.Add(tsbtn_IntuitCommunication.Tag)
            End If

        End If

        Return _Buttons
    End Function

    Private Sub UpdateStatusBar()
        'For Customized ToolStrip
        arrMainStripButtonsToHide = ButtonsToHide(frmToolButtonSelection.enumModuleName.Dashboard)
        Dim frm As New frmToolButtonSelection(tlbStripMain, frmToolButtonSelection.enumModuleName.Dashboard, Nothing, arrMainStripButtonsToHide)
        If IsNothing(arrDashBoardToolStrip) Then
            arrDashBoardToolStrip = frm.GetDefaultToolStripSetting() ''To store default setting of toolstrip
        End If
        '20090819 bug:2200 Moved before AssignUserRignts so as to reflecting the user rights on ToolStrip
        frm.ShowButtonSelection()


        frm = Nothing
        arrPatDetailsButtonsToHide = ButtonsToHide(frmToolButtonSelection.enumModuleName.PatientDetails)
        frm = New frmToolButtonSelection(ts_PatientDetails, frmToolButtonSelection.enumModuleName.PatientDetails, Nothing, arrPatDetailsButtonsToHide)
        If IsNothing(arrPatientDetailToolStrip) Then
            arrPatientDetailToolStrip = frm.GetDefaultToolStripSetting() ''To store default setting of toolstrip
        End If
        frm.ShowButtonSelection()

        'TO SHOW PATIENT DETAILS OF FIRST BUTTON IN TOOLSTRIP ''

        tsbtn_Hover.Visible = False
        tsbtn_Normal.Visible = False
        tsbtn_Selected.Visible = False
        'code opti
        If Not IsNothing(frm) Then
            frm.Dispose()
            frm = Nothing
        End If

        txtPatientAlert.ReadOnly = True
        txtPatientAlert.ForeColor = Color.FromArgb(21, 66, 139)
        sslbl_Login.Text = gstrLoginName & Space(5) & gstrLoginTime
        If gblnVoiceEnabled = True Then
            sslbl_VoiceInfo.Text = "Voice Available"
        Else
            sslbl_VoiceInfo.Text = "No Voice Facility"
        End If

        'Change to resolve incorrect voice speaker name on status bar issue
        If gstrCurrentSpeaker = strSpeakerName Then
            sslbl_CurrentSpeaker.Text = gstrCurrentSpeaker
        End If

        sslbl_Version.Text = gstrVersion
        sslbl_LastModifiedDate.Text = "Last Modified Date " & File.GetLastWriteTime(System.Windows.Forms.Application.StartupPath & "\" & Diagnostics.Process.GetCurrentProcess.MainModule.ModuleName)

        'which server and the database they have login
        sslbl_SQLServerDatabase.Text = " " & gstrSQLServerName & "   " & gstrDatabaseName

        Dim oMessage As New clsMessage

        If SingleSignON = True Then

            sslbl_SingleSignOn.Visible = True

            '30-Aug-16 Aniket: Resolving Bug #99887: gloEMR : Single Sign ON : application display incorrect message for single sign ON logged in user . 

            'sslbl_SingleSignOn.Text = "The user has been auto logged in with Single sign-on"
            'sslbl_MessagePriority.IsLink = False

            If IsNothing(TimerSSO) = True Then
                TimerSSO = New Windows.Forms.Timer
                AddHandler TimerSSO.Tick, AddressOf SSoTimerClick
                TimerSSO.Interval = 60000
                TimerSSO.Start()
            End If

        End If

        If oMessage.IsContainHighPriorityMessage(gnLoginID) Then
            blnIsHighPriorityMessagePresent = True

            If SingleSignON = True Then
                sslbl_MessagePriority.Visible = False
            Else
                sslbl_MessagePriority.Visible = True
            End If
        Else
            sslbl_MessagePriority.Visible = False
        End If

        If Not IsNothing(oMessage) Then
            oMessage.Dispose()
            oMessage = Nothing
        End If

    End Sub

    Private Sub SSoTimerClick(ByVal sender As Object, ByVal e As System.EventArgs)

        Try

            If IsNothing(TimerSSO) = False Then
                TimerSSO.Stop()
                TimerSSO.Dispose()
                TimerSSO = Nothing
            End If


            If blnIsHighPriorityMessagePresent = True Then
                sslbl_MessagePriority.Visible = True
                sslbl_SingleSignOn.Visible = False
            Else
                sslbl_SingleSignOn.Visible = False
            End If

        Catch ex As Exception

        End Try
    End Sub
    Private Sub Fill_ProviderSettings()
        Try
            'Voice has been enabled for this system
            If gblnVoiceEnabled = True Then
                'if user is admin irrespective of provider the voice center form is
                'visible
                If gblnIsAdmin Then
                    mnuDoctorSpeakerConfiguration.Visible = True
                    mnuToolsVoiceCenter.Visible = True
                    sep18.Visible = True
                Else
                    'if user is not an admin then initially the voicecenter form is invisible
                    'but if there is a valid speaker loaded against new provider
                    'voice center form is visible.
                    mnuDoctorSpeakerConfiguration.Visible = False
                    mnuToolsVoiceCenter.Visible = False
                    sep18.Visible = False
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
#End Region

#Region " Patient Control from Dash Board "

    ''Open patient to modify 
    Private Sub oPatientListControl_Grid_DoubleClick(ByVal sender As Object, ByVal e As System.Windows.Forms.DataGridViewCellEventArgs) Handles oPatientListControl.Grid_DoubleClick
        _isShowDialogueForm = True
        RegisterMyHotKey()
        If (e.RowIndex >= 0) AndAlso gblnSecurityUser = False Then
            If objUserRights.ModifyPatient = True Then
                mnuModifyPatient_Click(sender, e)
            End If
        End If
        _isShowDialogueForm = False
    End Sub

    'Private Function oPatientListControl_Check_IsAccess(ByVal sender As Object, ByVal e As System.Windows.Forms.DataGridViewCellEventArgs, ByVal _nPID As gloPatient.PatientListControl.PatientArgs) Handles oPatientListControl.Check_IsAccess
    '    'Lock Chart' Patients
    '    If IsAccess(False, oPatientListControl.SelectedPatientID) = False Then
    '        Return False
    '    End If
    '    Return True
    'End Function

    'event fired to show the appointments of selected provider
    Public Sub ProvideChanged(ByVal ProviderID As Int64) Handles oPatientListControl.OnProvideChangedEvent
        gnSelectedProviderID = ProviderID
        ShowAppointments()
        ShowUnfinishedExams()
        oPatientListControl.HighlightPatient(gnPatientID)
    End Sub
    Public Sub SelectRecentVisitedPatient(ByVal SelectedPatientID As Int64) Handles oPatientListControl.onRecpatientEventclick
        SelectPatientOnDashboard(SelectedPatientID)
    End Sub
    Private Sub oPatientListControl_OnDatechanged(ByVal dt As Date) Handles oPatientListControl.OnDatechanged
        dtPatientOnDate = dt
        ShowAppointments()
    End Sub

    Private Sub oPatientListControl_OnCheckchanged(ByVal checkState As Boolean, ByVal dt As Date) Handles oPatientListControl.OnCheckchanged
        If (checkState = False) Then
            dtPatientOnDate = Now.Date
            ShowAppointments()
        Else
            dtPatientOnDate = dt
            ShowAppointments()
        End If
    End Sub

    Private Sub oPatientListControl_GridRowSelect_Click(ByVal sender As Object, ByVal e As DataGridViewCellEventArgs) Handles oPatientListControl.GridRowSelect_Click

        Dim oclsPatReg As New ClsPatientRegistrationDBLayer

        '21-Mar-17 Aniket: Remove audit from patient click and put on patient search
        'If oPatientListControl.txtSearch.Text <> "" Then
        '    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Query, gloAuditTrail.ActivityType.Search, "Patient Query " & """" & oPatientListControl.txtSearch.Text & """", 0, 0, 0, gloAuditTrail.ActivityOutCome.Success)
        'End If
        blnPatientStatusOnMessageFired = True

        gstrPatientStatus = oclsPatReg.PatientStatus(oPatientListControl.PatientID, "").ToString()

        LoadSelectedPatientInfo(oPatientListControl.PatientID)
        LoadSelectedPatientInfo_Part2(oPatientListControl.PatientID)

        oclsPatReg.Dispose()
        oclsPatReg = Nothing

    End Sub

#Region "DateTime + Hours Calculation "
    Dim years As Integer = 0
    Dim months As Integer = 0
    Dim days As Integer = 0
    ''Called from the FillDemographic function
    Public Function GetAgeInHrs(ByVal _DateOfBirth As Date, ByVal _BirthTime As String) As TimeSpan
        Dim AgeDiff As TimeSpan = Nothing
        Dim sDateTime As String = ""
        Dim Bdate As Date
        Try
            Bdate = _DateOfBirth.Date
            sDateTime = Bdate.ToShortDateString() & " " & _BirthTime
            AgeDiff = DateTime.Now.Subtract(Convert.ToDateTime(sDateTime))
        Catch ex As Exception

        End Try
        Return AgeDiff
    End Function

    ''Called from the FillDemographic function
    Public Function FormatAge(ByVal BirthDate As DateTime) As String
        'Compute the difference between BirthDate 'CODE FROM gloPM
        'year and end year. 
        Dim _bdt As DateTime = BirthDate
        Dim IsBirthDateLeap As Boolean = False
        years = Now.Year - BirthDate.Year
        months = 0
        days = 0
        'Test if BirthDay for LeapYear.
        If BirthDate.Day = 29 AndAlso BirthDate.Month = 2 Then
            IsBirthDateLeap = True
        End If
        ' Check if the last year was a full year. 
        If Now < BirthDate.AddYears(years) AndAlso years <> 0 Then
            years -= 1
        End If
        BirthDate = BirthDate.AddYears(years)
        ' Now we know BirthDate <= end and the diff between them 
        ' is < 1 year. 
        If BirthDate.Year = Now.Year Then
            months = Now.Month - BirthDate.Month
        Else
            months = (12 - BirthDate.Month) + Now.Month
        End If
        ' Check if the last month was a full month. 
        If Now < BirthDate.AddMonths(months) AndAlso months <> 0 Then
            months -= 1
        End If
        BirthDate = BirthDate.AddMonths(months)
        ' Now we know that BirthDate < end and is within 1 month 
        ' of each other. 
        days = (Now - BirthDate).Days

        'To Adjust Age if BirthDate is 29th Feb in leap year
        If IsBirthDateLeap = True Then   ''Sequence of following IF code is too important.. DON'T MODIFY
            days -= 1
            If Now.Day = 29 AndAlso Now.Month = 2 Then
                days += 1
            ElseIf Now.Year Mod 4 = 0 Then
                days += 1
            End If
            If days < 0 AndAlso Now.Year Mod 4 <> 0 Then
                days = 30
                months = months - 1
                If months < 0 Then
                    months = 11
                    years = years - 1
                End If
            End If
            If months = 12 Then
                days = 30
                months = 11
            End If
        End If

        'Return years & " years " & months & " months " & days & " days"
        'Following code to display age in Numeric and Text
        'Dim age As New AgeDetail
        'age.Age = years & " Years " & months & " Months " & days & " Days"
        'Cases

        'Following Code to Store ExactAge in String
        Dim _AgeStr As String = ""

        If gblnShowAgeInDays = True AndAlso gintAgeLimit >= DateDiff(DateInterval.Day, CType(_bdt, Date), Date.Now.Date) Then
            If years = 0 Then
                If months = 0 Then

                    If days <= 1 Then
                        _AgeStr = days & " Day"
                    Else
                        _AgeStr = days & " Days"
                    End If
                ElseIf months = 1 Then
                    If days = 0 Then
                        _AgeStr = months & " Month"
                    ElseIf days = 1 Then
                        _AgeStr = months & " Month " & days & " Day"
                    Else
                        _AgeStr = months & " Month " & days & " Days"
                    End If
                ElseIf months > 1 Then
                    If days = 0 Then
                        _AgeStr = months & " Months"
                    ElseIf days = 1 Then
                        _AgeStr = months & " Months " & days & " Day"
                    Else
                        _AgeStr = months & " Months " & days & " Days"
                    End If
                End If
            ElseIf years = 1 Then
                If months = 0 Then
                    If days = 0 Then
                        _AgeStr = years & " Year "
                    ElseIf days = 1 Then
                        _AgeStr = years & " Year " & days & " Day"
                    Else
                        _AgeStr = years & " Year " & days & " Days"
                    End If
                ElseIf months = 1 Then
                    If days = 0 Then
                        _AgeStr = years & " Year " & months & " Month "
                    ElseIf days = 1 Then
                        _AgeStr = years & " Year " & months & " Month " & days & " Day"
                    Else
                        _AgeStr = years & " Year " & months & " Month " & days & " Days"
                    End If
                ElseIf months > 1 Then
                    If days = 0 Then
                        _AgeStr = years & " Year " & months & " Months "
                    ElseIf days = 1 Then
                        _AgeStr = years & " Year " & months & " Months " & days & " Day"
                    Else
                        _AgeStr = years & " Year " & months & " Months " & days & " Days"
                    End If
                End If
            ElseIf years > 1 Then
                If months = 0 Then
                    If days = 0 Then
                        _AgeStr = years & " Years "
                    ElseIf days = 1 Then
                        _AgeStr = years & " Years " & days & " Day"
                    Else
                        _AgeStr = years & " Years " & days & " Days"
                    End If
                ElseIf months = 1 Then
                    If days = 0 Then
                        _AgeStr = years & " Years " & months & " Month"
                    ElseIf days = 1 Then
                        _AgeStr = years & " Years " & months & " Month " & days & " Day"
                    Else
                        _AgeStr = years & " Years " & months & " Month " & days & " Days"
                    End If
                ElseIf months > 1 Then
                    If days = 0 Then
                        _AgeStr = years & " Years " & months & " Months"
                    ElseIf days = 1 Then
                        _AgeStr = years & " Years " & months & " Months " & days & " Day"
                    Else
                        _AgeStr = years & " Years " & months & " Months " & days & " Days"
                    End If
                End If
            End If
        Else 'ShowAgeInDay is False OR AgeLimit less than Settings.
            If years = 0 Then
                If months = 1 Then
                    _AgeStr = months & " Month"
                ElseIf months > 1 Then
                    _AgeStr = months & " Months"
                End If
            ElseIf years = 1 Then
                If months = 0 Then
                    _AgeStr = years & " Year "
                ElseIf months = 1 Then
                    _AgeStr = years & " Year " & months & " Month "
                ElseIf months > 1 Then
                    _AgeStr = years & " Year " & months & " Months "
                End If
            ElseIf years > 1 Then
                If months = 0 Then
                    _AgeStr = years & " Years "
                ElseIf months = 1 Then
                    _AgeStr = years & " Years " & months & " Month "
                ElseIf months > 1 Then
                    _AgeStr = years & " Years " & months & " Months "
                End If
            End If
            If years = 0 AndAlso months = 0 Then
                If days <= 1 Then
                    _AgeStr = days & " Day"
                Else
                    _AgeStr = days & " Days"
                End If
            End If
        End If

        Return _AgeStr
    End Function
#End Region
    Private Function FillDemoInformation(nPatientID As Int64, nClinicId As Int64, VisitDate As DateTime) As DataSet
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParameters As New gloDatabaseLayer.DBParameters()
        Dim dsDemoInfo As DataSet = Nothing
        Try
            oDB.Connect(False)
            oParameters.Add("@nPatientId", nPatientID, ParameterDirection.Input, SqlDbType.BigInt)
            oParameters.Add("@nClinicID", nClinicId, ParameterDirection.Input, SqlDbType.BigInt)
            oParameters.Add("@VisitDate", VisitDate, ParameterDirection.Input, SqlDbType.DateTime)
            oDB.Retrive("gsp_GetPatientDemographics", oParameters, dsDemoInfo)
            If dsDemoInfo.Tables.Count > 0 Then
                dsDemoInfo.Tables(0).TableName = "Patient Demographics"
                dsDemoInfo.Tables(1).TableName = "Patient Visit"
                dsDemoInfo.Tables(2).TableName = "Patient Status"
                dsDemoInfo.Tables(3).TableName = "Patient BadDebt"
                Return dsDemoInfo
            Else
                Return Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            Return Nothing
        Finally
            If oDB IsNot Nothing Then
                oDB.Disconnect()
                oDB.Dispose()
                oDB = Nothing
            End If
            If oParameters IsNot Nothing Then
                oParameters.Dispose()
                oParameters = Nothing
            End If
        End Try
    End Function

    Private Sub FillDemographicInformation()
        gblnPatRegIntuitorPortal = False
        Dim dtPatient As DataTable = Nothing
        Dim dsDemoinfo As DataSet = Nothing
        ''7022Items: Home Billing
        ''Bug #47238: EMR - When Zip code Setting is off for 9 digit then 9 digit displayed on Patient Demographics
        ''Create object used to get setting from database
        Dim oSettings As New gloSettings.GeneralSettings(GetConnectionString())
        Dim oUseAreaCode As New Object()

        Dim clsIntuit As New gloPatientPortalCommon.ClsIntuitSecureMessage(GetConnectionString(), gnPatientID, gnClientMachineID, gstrClientMachineName, gstrLoginName)
        Dim dtIntuitPatientRegister As DataTable = Nothing
        Dim clsPatientPortal As New clsgloPatientPortalEmail(GetConnectionString())

        Try
            With oPatientListControl

                '30-Apr-13 Aniket: Resolving Memory Leaks
                'dtPatient = New DataTable()
                'Dim oPatient As New gloPatient.gloPatient(GetConnectionString)
                appSettings("CurrentPatientStatus") = ""
                dsDemoinfo = FillDemoInformation(gnPatientID, gnClinicID, Date.Now)
                If Not IsNothing(dsDemoinfo) Then
                    If Not IsNothing(dsDemoinfo.Tables("Patient Demographics")) AndAlso dsDemoinfo.Tables("Patient Demographics").Rows.Count > 0 Then
                        dtPatient = dsDemoinfo.Tables("Patient Demographics")
                    Else
                        dtPatient = Nothing
                    End If
                    If Not IsNothing(dsDemoinfo.Tables("Patient Visit")) AndAlso dsDemoinfo.Tables("Patient Visit").Rows.Count > 0 Then
                        If IsDBNull(dsDemoinfo.Tables("Patient Visit").Rows(0)(0)) = False Then
                            gnVisitID = dsDemoinfo.Tables("Patient Visit").Rows(0)(0)
                        Else
                            gnVisitID = 0
                        End If
                    Else
                        gnVisitID = 0
                    End If
                    If Not IsNothing(dsDemoinfo.Tables("Patient Status")) AndAlso dsDemoinfo.Tables("Patient Status").Rows.Count > 0 Then
                        lbl_ShowStatus.Text = dsDemoinfo.Tables("Patient Status").Rows(0)(0)
                    Else
                        lbl_ShowStatus.Text = ""
                    End If
                    If Not IsNothing(dsDemoinfo.Tables("Patient BadDebt")) AndAlso dsDemoinfo.Tables("Patient BadDebt").Rows.Count > 0 Then
                        If dsDemoinfo.Tables("Patient BadDebt").Rows(0)(0) = "True" Then
                            lblBadDebt.Visible = True
                            appSettings("CurrentPatientStatus") = "Bad Debt"
                        Else
                            lblBadDebt.Visible = False
                        End If
                    Else
                        lblBadDebt.Visible = False
                    End If
                Else
                    gnVisitID = 0
                    lbl_ShowStatus.Text = ""
                    lblBadDebt.Visible = False
                End If
                'dtPatient = oPatient.GetPatientDemographics(gnPatientID)
                'oPatient.Dispose()
                'oPatient = Nothing
                If IsNothing(dtPatient) = True OrElse dtPatient.Rows.Count < 1 Then
                    Exit Sub
                End If
                gstrPatientCode = Convert.ToString(dtPatient.Rows(0)("sPatientCode"))
                gstrPatientFirstName = Convert.ToString(dtPatient.Rows(0)("sFirstName"))
                gstrPatientLastName = Convert.ToString(dtPatient.Rows(0)("sLastName"))
                gstrPatientMiddleName = Convert.ToString(dtPatient.Rows(0)("sMiddleName"))
                gstrPatientGender = Convert.ToString(dtPatient.Rows(0)("sGender"))
                gstrPatientMaritalStatus = Convert.ToString(dtPatient.Rows(0)("sMaritalStatus"))
                gstrPatientDOB = Convert.ToString(dtPatient.Rows(0)("dtDOB"))
                gstrPatientAge = GetAge(Convert.ToDateTime(dtPatient.Rows(0)("dtDOB")))
                gblnExtemptFromReport = Convert.ToBoolean(dtPatient.Rows(0)("nExemptFromReport"))

                gnPatientProviderID = Convert.ToString(dtPatient.Rows(0)("nProviderID"))
                gstrPatientProviderName = Convert.ToString(dtPatient.Rows(0)("sProviderName"))

                If Convert.ToString(dtPatient.Rows(0)("sPatientCode")) = "" Then
                    gnPatientID = 0
                End If

                'gnVisitID = GetVisitID(Date.Now, gnPatientID)
                lblPD_Code.Tag = gnPatientID
                lblPD_Code.Text = Convert.ToString(dtPatient.Rows(0)("sPatientCode"))
                lblPD_Name.Text = (Convert.ToString(dtPatient.Rows(0)("sFirstName")) & " " & Convert.ToString(dtPatient.Rows(0)("sMiddleName")) & " " & Convert.ToString(dtPatient.Rows(0)("sLastName"))).Replace(Chr(0), Chr(32))

                Dim strSZ As String = Convert.ToString(dtPatient.Rows(0)("sState")) & " " & Convert.ToString(dtPatient.Rows(0)("sZip"))
                Dim MyString As String = Convert.ToString(dtPatient.Rows(0)("sAddressLine1")) & " " & Convert.ToString(dtPatient.Rows(0)("sAddressLine2")) & " " & Convert.ToString(dtPatient.Rows(0)("sCity"))

                ''7022Items: Home Billing
                ''Bug #47238: EMR - When Zip code Setting is off for 9 digit then 9 digit displayed on Patient Demographics
                ''Get setting from database and accordingly shows area code in patient demographics on dashboard.
                If IsNothing(dvAllSettings) = False Then
                    '01-Dec-14 Aniket: Reduce database trip for gettings settings
                    dvAllSettings.RowFilter = "sName = 'USEAREACODEFORPATIENT'"

                    If dvAllSettings.Count > 0 Then
                        oUseAreaCode = dvAllSettings(0)("sValue")
                    End If

                    dvAllSettings.RowFilter = Nothing

                    'oSettings.GetSetting("USEAREACODEFORPATIENT", oUseAreaCode)
                    If Convert.ToBoolean(Convert.ToInt16(oUseAreaCode)) = True Then
                        ''7022Items: Home Billing If codition is added to show area code alongwith zip if patient country is US.
                        If Convert.ToString(dtPatient.Rows(0)("sCountry")) = "US" Then
                            ''7022Items: Home Billing Area code appended with zip code
                            If Convert.ToString(dtPatient.Rows(0)("sZip")) <> "" Then
                                If Convert.ToString(dtPatient.Rows(0)("sAreaCode")) <> "" Then
                                    strSZ = strSZ + "-" + Convert.ToString(dtPatient.Rows(0)("sAreaCode"))
                                End If
                            End If
                        End If
                    End If
                End If




                If strSZ.Trim = "" Then                                                                                                                         'vbcrlf' - to bring to new line(\n)                                                   
                    lblPD_Address.Text = MyString
                Else
                    'Validating the
                    If MyString.Trim <> String.Empty Then
                        lblPD_Address.Text = MyString & ", " & strSZ.Trim
                    Else
                        lblPD_Address.Text = strSZ.Trim
                    End If
                End If

                lblPD_Gender.Text = Convert.ToString(dtPatient.Rows(0)("sGender"))

                lblRace.Text = Convert.ToString(dtPatient.Rows(0)("sRace"))
                lblEthinicity.Text = Convert.ToString(dtPatient.Rows(0)("sEthn"))
                lblLanguage.Text = Convert.ToString(dtPatient.Rows(0)("SLang"))
                lblMedicalCategory.Text = Convert.ToString(dtPatient.Rows(0)("MedicalCategory"))
                '' added for 8070 prd workphone,occupation,business center
                lbloccupation.Text = Convert.ToString(dtPatient.Rows(0)("sOccupation"))
                lblworkphone.Text = Convert.ToString(dtPatient.Rows(0)("sWorkPhone"))
                lblbusinesscenter.Text = Convert.ToString(dtPatient.Rows(0)("BusinessCenter"))

                '04-Mar-16 Aniket:Handling Bug #93996: gloEMR->Application throws an exception.
                If IsNothing(dtPatient.Columns("PharmacyAddr")) = False Then
                    lblPD_PharmacyAddress.Text = Convert.ToString(dtPatient.Rows(0)("PharmacyAddr"))
                Else
                    lblPD_PharmacyAddress.Text = ""
                End If


                If gnPatientID = 0 Then
                    lblPD_DateOfBirth.Text = ""
                    lblPD_Age.Text = ""
                Else
                    lblPD_DateOfBirth.Text = Convert.ToString(dtPatient.Rows(0)("dtDOB"))
                    lblPD_Age.Text = GetAge(Convert.ToDateTime(dtPatient.Rows(0)("dtDOB")))
                End If

                lblPD_HomePhone.Text = Convert.ToString(dtPatient.Rows(0)("sPhone"))
                lblPD_Mobile.Text = Convert.ToString(dtPatient.Rows(0)("sMobile"))
                lblPD_Fax.Text = Convert.ToString(dtPatient.Rows(0)("sFAX"))
                lblPD_Email.Text = Convert.ToString(dtPatient.Rows(0)("sEmail"))
                lblPD_PriCarePhysician.Text = Convert.ToString(dtPatient.Rows(0)("sPCPName"))
                lblPD_Provider.Text = Convert.ToString(dtPatient.Rows(0)("sProviderName"))
                lbl_ShowPCPbusPhone.Text = Convert.ToString(dtPatient.Rows(0)("sPCPPhone"))

                lblPD_Pharmacy.Text = Convert.ToString(dtPatient.Rows(0)("sPharmacy"))
                lblPD_PharmacyPhone.Text = Convert.ToString(dtPatient.Rows(0)("sPharmaPhone"))

                lblPrimaryInsurance.Text = Convert.ToString(dtPatient.Rows(0)("PrimaryIns"))
                lblSecondaryInsurance.Text = Convert.ToString(dtPatient.Rows(0)("SecondaryIns"))
                lbl_TertiaryInsurance.Text = Convert.ToString(dtPatient.Rows(0)("TertiaryIns"))

                picPD_Photo.Image = Nothing
                picPD_Photo.BackgroundImage = Nothing

                If TypeOf (dtPatient.Rows(0)("iPhoto")) Is System.DBNull Then
                    '17-Jul-14 Aniket: Resolving Bug #70972
                    'PatientPhoto = Nothing
                    'MyPictureBoxControl = Nothing
                    If lblPD_Gender.Text.ToUpper() = "Male".ToUpper() Then
                        picPD_Photo.BackgroundImage = gloEMR.My.Resources.Resources.MalePatient
                    ElseIf lblPD_Gender.Text.ToUpper() = "Female".ToUpper() Then
                        picPD_Photo.BackgroundImage = gloEMR.My.Resources.Resources.FemalePatient
                    End If
                    picPD_Photo.BackgroundImageLayout = ImageLayout.Stretch
                    picPD_Photo.SizeMode = PictureBoxSizeMode.StretchImage
                Else

                    'SLR: Created a new static function to avoid mem handles at one place.
                    '17-Jul-14 Aniket: Resolving Bug #70972
                    'Dim myPixBx As New gloPictureBox.gloPictureBox()


                    ''MyPictureBoxControl = CType(dtPatient.Rows(0)("iPhoto"), Byte())

                    'myPixBx.byteImage = CType(dtPatient.Rows(0)("iPhoto"), Byte())
                    ''myPixBx.byteImage = MyPictureBoxControl
                    ''PatientPhoto = myPixBx.copyFrame(New Rectangle(0, 0, picPD_Photo.Width, picPD_Photo.Height), True)
                    'Dim myImage As System.Drawing.Image = myPixBx.copyFrame(New Rectangle(0, 0, picPD_Photo.Width, picPD_Photo.Height), True)
                    'myPixBx.Dispose()
                    'myPixBx = Nothing
                    picPD_Photo.BackgroundImageLayout = ImageLayout.Stretch
                    picPD_Photo.SizeMode = PictureBoxSizeMode.CenterImage
                    'picPD_Photo.Image = PatientPhoto
                    '   picPD_Photo.Image = myImage
                    picPD_Photo.Image = gloPictureBox.gloImage.GetImage(CType(dtPatient.Rows(0)("iPhoto"), Byte()), picPD_Photo.Width, picPD_Photo.Height)
                End If

                'show patient status
                'lbl_ShowStatus.Text = GetPatientStaus(gnPatientID)
                If lbl_ShowStatus.Text.Trim.ToUpper = "Deceased".ToUpper Then
                    lbl_ShowStatus.ForeColor = Color.Red
                Else
                    lbl_ShowStatus.ForeColor = Color.FromArgb(21, 66, 139)
                End If
                'show emergency info
                lbl_Emcontact.Text = Convert.ToString(dtPatient.Rows(0)("sEmergencyContact"))
                lbl_EmMobile.Text = Convert.ToString(dtPatient.Rows(0)("sEmergencyMobile"))
                lbl_EmPhone.Text = Convert.ToString(dtPatient.Rows(0)("sEmergencyPhone"))
                lb_PatPhone.Text = Convert.ToString(dtPatient.Rows(0)("sPhone"))

                'Birthday Reminder
                Dim nMonths As Int16
                nMonths = DateDiff(DateInterval.Month, dtPatient.Rows(0)("dtDOB"), Date.Now.Date)


                Dim blnLeapDate As Boolean
                Dim dtPatientDOB As DateTime

                If Convert.ToDateTime(dtPatient.Rows(0)("dtDOB")).Month = 2 AndAlso Convert.ToDateTime(dtPatient.Rows(0)("dtDOB")).Day = 29 Then
                    dtPatientDOB = New DateTime(System.DateTime.Now.Year, 2, 28)
                    blnLeapDate = True
                Else
                    dtPatientDOB = New DateTime(System.DateTime.Now.Year, CType(Convert.ToString(dtPatient.Rows(0)("dtDOB")), Date).Month, CType(Convert.ToString(dtPatient.Rows(0)("dtDOB")), Date).Day)
                    blnLeapDate = False
                End If

                'By Default Keep the Patient Confidential Information Icon Visible False
                picConfidentialInfo.Visible = False
                pnlReconciliationAlert.Visible = False
                If gblnBdayReminder = True Then
                    If dtPatientDOB >= System.DateTime.Now.AddDays(-gnBDayReminderDays) AndAlso dtPatientDOB <= System.DateTime.Now.AddDays(gnBDayReminderDays) Then
                        'For BirthDay Alert
                        If blnLeapDate = False Then
                            If dtPatientDOB > System.DateTime.Now.Date Then
                                lblBirthDayMessage.Text = Convert.ToString(dtPatient.Rows(0)("sFirstName")) & " " & Convert.ToString(dtPatient.Rows(0)("sLastName")) & "'s birthday is on " & dtPatientDOB
                            ElseIf dtPatientDOB < System.DateTime.Now.Date Then
                                lblBirthDayMessage.Text = Convert.ToString(dtPatient.Rows(0)("sFirstName")) & " " & Convert.ToString(dtPatient.Rows(0)("sLastName")) & "'s birthday was on " & dtPatientDOB
                            Else
                                lblBirthDayMessage.Text = "Today is " & gstrPatientFirstName & " " & gstrPatientLastName & "'s birthday!"
                            End If
                            pnlBirthDayReminder.Top = Me.Height
                            pnlBirthDayReminder.Visible = True
                            tmrBirthDayReminder.Enabled = True
                        Else
                            If System.DateTime.IsLeapYear(System.DateTime.Now.Year) Then
                                dtPatientDOB = dtPatientDOB.AddDays(1)
                                If dtPatientDOB > System.DateTime.Now.Date Then
                                    lblBirthDayMessage.Text = Convert.ToString(dtPatient.Rows(0)("sFirstName")) & " " & Convert.ToString(dtPatient.Rows(0)("sLastName")) & "'s birthday is on " & dtPatientDOB
                                ElseIf dtPatientDOB < System.DateTime.Now.Date Then
                                    lblBirthDayMessage.Text = Convert.ToString(dtPatient.Rows(0)("sFirstName")) & " " & Convert.ToString(dtPatient.Rows(0)("sLastName")) & "'s birthday was on " & dtPatientDOB
                                Else
                                    lblBirthDayMessage.Text = "Today is " & Convert.ToString(dtPatient.Rows(0)("sFirstName")) & " " & Convert.ToString(dtPatient.Rows(0)("sLastName")) & "'s birthday!"
                                End If
                                pnlBirthDayReminder.Top = Me.Height
                                pnlBirthDayReminder.Visible = True
                                tmrBirthDayReminder.Enabled = True
                            End If
                        End If
                    Else
                        pnlBirthDayReminder.Visible = False
                        tmrBirthDayReminder.Enabled = False
                    End If
                Else
                    pnlBirthDayReminder.Visible = False
                    tmrBirthDayReminder.Enabled = False
                End If
                'Birthday Reminder               
            End With


            ''28-Mar-13 Aniket: Change the Intuit Icon based on Patient Registered on Portal or Not
            ''Added for MU2 Patient Portal - If Intuit setting is turn on then check patient register on Intuit Portal else gloStream Patient Portal on 20130823
            If gblnUSEINTUITINTERFACE = True AndAlso gblnIntuitCommunication = True Then
                dtIntuitPatientRegister = clsIntuit.ToCheckPatientRegisterOrNot(gnPatientID)
                If (IsNothing(dtIntuitPatientRegister) = False) Then
                    If dtIntuitPatientRegister.Rows.Count > 0 Then
                        If dtIntuitPatientRegister.Rows(0)("MemberID") <> 0 Then 'Registered on Portal
                            btnIntuitMsg.Image = gloEMR.My.Resources.Resources.IntuitSecureMessagingDashboard
                            gblnPatRegIntuitorPortal = True  '''' added to turn on if patient portal or intuit setting is on and patient is registered 
                        Else 'Not Registered on Portal
                            btnIntuitMsg.Image = gloEMR.My.Resources.Resources.NONEIntuitSecureMessagingDashboard

                        End If

                    Else 'Not registered on Portal
                        btnIntuitMsg.Image = gloEMR.My.Resources.Resources.NONEIntuitSecureMessagingDashboard

                    End If
                Else
                    btnIntuitMsg.Image = gloEMR.My.Resources.Resources.NONEIntuitSecureMessagingDashboard

                End If
            ElseIf gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
                dtIntuitPatientRegister = clsPatientPortal.ToCheckPatientRegisterOrNotOnPortal(gnPatientID)
                If dtIntuitPatientRegister IsNot Nothing AndAlso dtIntuitPatientRegister.Rows.Count > 0 Then
                    btnIntuitMsg.Image = gloEMR.My.Resources.Resources.IntuitSecureMessagingDashboard
                    gblnPatRegIntuitorPortal = True '''' added to turn on if patient portal or intuit setting is on and patient is registered 
                Else 'Not registered on MU2 PatientPortal
                    btnIntuitMsg.Image = gloEMR.My.Resources.Resources.NONEIntuitSecureMessagingDashboard

                End If

            End If
            ''Show Bad debt Alert for Bad debt Patient
            'Dim oSecurity As New gloSecurity.gloSecurity(GetConnectionString())
            'If oSecurity.isBadDebtPatient(gnPatientID) Then
            '    lblBadDebt.Visible = True
            'Else
            '    lblBadDebt.Visible = False
            'End If
        


            ''End MU2 Patient Portal
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        Finally

            'Code opti
            If Not IsNothing(dtPatient) Then
                dtPatient.Dispose()
                dtPatient = Nothing
            End If
            ''7022Items: Home Billing
            ''Bug #47238: EMR - When Zip code Setting is off for 9 digit then 9 digit displayed on Patient Demographics
            ''Dispose object used to get setting from database
            oSettings.Dispose()
            oSettings = Nothing
            oUseAreaCode = Nothing ''slr dispose 
            If Not IsNothing(clsIntuit) Then
                clsIntuit.Dispose()
            End If
            clsIntuit = Nothing
            clsPatientPortal = Nothing
            If Not IsNothing(dtIntuitPatientRegister) Then
                dtIntuitPatientRegister.Dispose()
                dtIntuitPatientRegister = Nothing
            End If


        End Try
        GetMedicalCategoryImage()
        If lbl_ShowStatus.Text.Trim.ToUpper = "Deceased".ToUpper Then
            lbl_ShowStatus.ForeColor = Color.Red
        End If
    End Sub

    'Private Sub FillDemographicInformation_old()
    '    Try
    '        With oPatientListControl
    '            Dim oPatient As New gloPatient.gloPatient(GetConnectionString)
    '            Dim oPatientDemographics As New gloPatient.Patient()
    '            oPatientDemographics = oPatient.GetPatientDemo(gnPatientID)
    '            gstrPatientCode = oPatientDemographics.DemographicsDetail.PatientCode
    '            gstrPatientFirstName = oPatientDemographics.DemographicsDetail.PatientFirstName
    '            gstrPatientLastName = oPatientDemographics.DemographicsDetail.PatientLastName
    '            gstrPatientMiddleName = oPatientDemographics.DemographicsDetail.PatientMiddleName
    '            gstrPatientGender = oPatientDemographics.DemographicsDetail.PatientGender
    '            gstrPatientMaritalStatus = oPatientDemographics.DemographicsDetail.PatientMaritalStatus
    '            gstrPatientDOB = oPatientDemographics.DemographicsDetail.PatientDOB
    '            gstrPatientAge = GetAge(oPatientDemographics.DemographicsDetail.PatientDOB)

    '            gnVisitID = GetVisitID(Date.Now, gnPatientID)

    '            'Start : Validate the BirthTime
    '            'SLR: Corrected on 5/19/2015
    '            Dim objfrmsp As frmSplash = frmSplash.GetInstance()
    '            If Not IsNothing(objfrmsp) Then
    '                objfrmsp.GetPediatricSetting()
    '                objfrmsp.GetSetting()

    '                If glbIsPediatric Then
    '                    Dim _tmptimespan As TimeSpan = GetAgeInHrs(oPatientDemographics.DemographicsDetail.PatientDOB, oPatientDemographics.DemographicsDetail.BirthTime)
    '                    Dim _hour As Integer
    '                    Dim _age As String
    '                    'Dim _yrs As Integer
    '                    'Dim _mon As Integer
    '                    If Not IsNothing(_tmptimespan) Then
    '                        If _tmptimespan.TotalDays < 4 Then
    '                            _hour = _tmptimespan.TotalHours
    '                            _age = _tmptimespan.TotalHours.ToString("0") & " Hours"
    '                            ''''Hours
    '                        ElseIf _tmptimespan.TotalDays > 4 AndAlso (_tmptimespan.TotalDays <= 28 OrElse _tmptimespan.Hours = 0) Then
    '                            gblnShowAgeInDays = True
    '                            _age = FormatAge(oPatientDemographics.DemographicsDetail.PatientDOB)
    '                            gblnShowAgeInDays = False
    '                            ''''days
    '                        ElseIf _tmptimespan.TotalDays > 28 AndAlso _tmptimespan.TotalDays <= 90 Then
    '                            _age = (_tmptimespan.Days / 7).ToString("0") & " Weeks"
    '                            '''' weeks
    '                        Else
    '                            _age = FormatAge(oPatientDemographics.DemographicsDetail.PatientDOB)
    '                            If years < 2 AndAlso months >= 0 Then
    '                                _age = (years * 12) + months & " Months"
    '                            End If
    '                        End If
    '                        gstrPatientAge = _age
    '                    End If
    '                Else
    '                    gstrPatientAge = GetAge(oPatientDemographics.DemographicsDetail.PatientDOB)
    '                End If
    '            End If
    '            'Validate the BirthTime


    '            gnPatientProviderID = oPatientDemographics.DemographicsDetail.PatientProviderID
    '            gstrPatientProviderName = oPatientDemographics.DemographicsDetail.ProvideName

    '            If gstrPatientCode = "" Then
    '                gnPatientID = 0
    '            End If

    '            lblPD_Code.Tag = gnPatientID
    '            lblPD_Code.Text = gstrPatientCode
    '            lblPD_Name.Text = (gstrPatientFirstName & " " & gstrPatientMiddleName & " " & gstrPatientLastName).Replace(Chr(0), Chr(32))

    '            Dim strSZ As String = oPatientDemographics.DemographicsDetail.PatientState & " " & oPatientDemographics.DemographicsDetail.PatientZip
    '            Dim MyString As String = oPatientDemographics.DemographicsDetail.PatientAddress1 & " " & oPatientDemographics.DemographicsDetail.PatientAddress2 & " " & oPatientDemographics.DemographicsDetail.PatientCity
    '            If strSZ.Trim = "" Then                                                                                                                         'vbcrlf' - to bring to new line(\n)                                                   
    '                lblPD_Address.Text = MyString
    '            Else
    '                'Validating the ", "
    '                If MyString.Trim <> String.Empty Then
    '                    lblPD_Address.Text = MyString & ", " & strSZ.Trim
    '                Else
    '                    lblPD_Address.Text = strSZ.Trim
    '                End If
    '            End If

    '            lblPD_Gender.Text = oPatientDemographics.DemographicsDetail.PatientGender
    '            If gnPatientID = 0 Then
    '                lblPD_DateOfBirth.Text = ""
    '                lblPD_Age.Text = ""
    '            Else
    '                lblPD_DateOfBirth.Text = oPatientDemographics.DemographicsDetail.PatientDOB.ToString("MM/dd/yyyy")
    '                lblPD_Age.Text = gstrPatientAge
    '            End If

    '            lblPD_HomePhone.Text = oPatientDemographics.DemographicsDetail.PatientPhone
    '            lblPD_Mobile.Text = oPatientDemographics.DemographicsDetail.PatientMobile
    '            lblPD_Fax.Text = oPatientDemographics.DemographicsDetail.PatientFax
    '            lblPD_Email.Text = oPatientDemographics.DemographicsDetail.PatientEmail
    '            lblPD_PriCarePhysician.Text = oPatientDemographics.DemographicsDetail.PrimaryCarePhysicianName

    '            If Not IsNothing(oPatientDemographics.PrimaryCarePhysicians) AndAlso (oPatientDemographics.PrimaryCarePhysicians.Count > 0) Then

    '                lbl_ShowPCPbusPhone.Text = oPatientDemographics.PrimaryCarePhysicians(0).Phone
    '            Else
    '                lbl_ShowPCPbusPhone.Text = ""
    '            End If
    '            If Not IsNothing(oPatientDemographics.PatientPharmacies) AndAlso (oPatientDemographics.PatientPharmacies.Count > 0) Then
    '                'DISPLAY THE DEFAULT PHARMACY OF THE PATIENT
    '                For i As Integer = 0 To oPatientDemographics.PatientPharmacies.Count - 1
    '                    If (oPatientDemographics.PatientPharmacies(i).Phone <> "" AndAlso oPatientDemographics.PatientPharmacies(i).ContactStatus = 1) Then
    '                        lblPD_PharmacyPhone.Text = oPatientDemographics.PatientPharmacies(i).Phone
    '                    End If
    '                Next
    '            Else
    '                lblPD_PharmacyPhone.Text = ""
    '            End If

    '            lblPD_Pharmacy.Text = oPatientDemographics.DemographicsDetail.PharmacyName

    '            picPD_Photo.Image = Nothing
    '            picPD_Photo.BackgroundImage = Nothing
    '            If oPatientDemographics.DemographicsDetail.PatientPhoto Is Nothing Then
    '                If oPatientDemographics.DemographicsDetail.PatientGender.ToUpper() = "Male".ToUpper() Then
    '                    picPD_Photo.BackgroundImage = gloEMR.My.Resources.Resources.MalePatient
    '                ElseIf oPatientDemographics.DemographicsDetail.PatientGender.ToUpper() = "Female".ToUpper() Then
    '                    picPD_Photo.BackgroundImage = gloEMR.My.Resources.Resources.FemalePatient
    '                End If
    '                picPD_Photo.BackgroundImageLayout = ImageLayout.Stretch
    '                picPD_Photo.SizeMode = PictureBoxSizeMode.StretchImage
    '            Else
    '                picPD_Photo.BackgroundImageLayout = ImageLayout.Stretch
    '                picPD_Photo.SizeMode = PictureBoxSizeMode.CenterImage
    '            End If

    '            'show patient status
    '            lbl_ShowStatus.Text = GetPatientStaus(gnPatientID)
    '            If lbl_ShowStatus.Text.Trim.ToUpper = "Deceased".ToUpper Then
    '                lbl_ShowStatus.ForeColor = Color.Red
    '            Else
    '                lbl_ShowStatus.ForeColor = Color.FromArgb(21, 66, 139)
    '            End If

    '            lbl_Emcontact.Text = oPatientDemographics.DemographicsDetail.EmergencyContact
    '            lbl_EmMobile.Text = oPatientDemographics.DemographicsDetail.EmergencyMobile
    '            lbl_EmPhone.Text = oPatientDemographics.DemographicsDetail.EmergencyPhone
    '            lb_PatPhone.Text = oPatientDemographics.DemographicsDetail.PatientPhone

    '            'Birthday Reminder

    '            Dim nMonths As Int16
    '            nMonths = DateDiff(DateInterval.Month, oPatientDemographics.DemographicsDetail.PatientDOB, Date.Now.Date)
    '            Dim blnLeapDate As Boolean
    '            Dim dtPatientDOB As DateTime

    '            If oPatientDemographics.DemographicsDetail.PatientDOB.Month = 2 AndAlso oPatientDemographics.DemographicsDetail.PatientDOB.Day = 29 Then
    '                dtPatientDOB = New DateTime(System.DateTime.Now.Year, 2, 28)
    '                blnLeapDate = True
    '            Else
    '                dtPatientDOB = New DateTime(System.DateTime.Now.Year, CType(gstrPatientDOB, Date).Month, CType(gstrPatientDOB, Date).Day)
    '                blnLeapDate = False
    '            End If

    '            'By Default Keep the Patient Confidential Information Icon Visible False
    '            picConfidentialInfo.Visible = False
    '            pnlReconciliationAlert.Visible = False
    '            If gblnBdayReminder = True Then
    '                If dtPatientDOB >= System.DateTime.Now.AddDays(-gnBDayReminderDays) AndAlso dtPatientDOB <= System.DateTime.Now.AddDays(gnBDayReminderDays) Then
    '                    'For BirthDay Alert
    '                    If blnLeapDate = False Then
    '                        If dtPatientDOB > System.DateTime.Now.Date Then
    '                            lblBirthDayMessage.Text = gstrPatientFirstName & " " & gstrPatientLastName & "'s birthday is on " & dtPatientDOB
    '                        ElseIf dtPatientDOB < System.DateTime.Now.Date Then
    '                            lblBirthDayMessage.Text = gstrPatientFirstName & " " & gstrPatientLastName & "'s birthday was on " & dtPatientDOB
    '                        Else
    '                            lblBirthDayMessage.Text = "Today is " & gstrPatientFirstName & " " & gstrPatientLastName & "'s birthday!"
    '                        End If
    '                        pnlBirthDayReminder.Top = Me.Height
    '                        pnlBirthDayReminder.Visible = True
    '                        tmrBirthDayReminder.Enabled = True
    '                    Else
    '                        If System.DateTime.IsLeapYear(System.DateTime.Now.Year) Then
    '                            dtPatientDOB = dtPatientDOB.AddDays(1)
    '                            If dtPatientDOB > System.DateTime.Now.Date Then
    '                                lblBirthDayMessage.Text = gstrPatientFirstName & " " & gstrPatientLastName & "'s birthday is on " & dtPatientDOB
    '                            ElseIf dtPatientDOB < System.DateTime.Now.Date Then
    '                                lblBirthDayMessage.Text = gstrPatientFirstName & " " & gstrPatientLastName & "'s birthday was on " & dtPatientDOB
    '                            Else
    '                                lblBirthDayMessage.Text = "Today is " & gstrPatientFirstName & " " & gstrPatientLastName & "'s birthday!"
    '                            End If
    '                            pnlBirthDayReminder.Top = Me.Height
    '                            pnlBirthDayReminder.Visible = True
    '                            tmrBirthDayReminder.Enabled = True
    '                        End If
    '                    End If
    '                Else
    '                    pnlBirthDayReminder.Visible = False
    '                    tmrBirthDayReminder.Enabled = False
    '                End If
    '            Else
    '                pnlBirthDayReminder.Visible = False
    '                tmrBirthDayReminder.Enabled = False
    '            End If
    '            'Birthday Reminder


    '            'lock status
    '            If IsAccess(True) = False Then
    '                lblPD_Name.Text = ""
    '                lblPD_Address.Text = ""
    '                lblPD_Gender.Text = ""
    '                lblPD_HomePhone.Text = ""
    '                lblPD_Mobile.Text = ""
    '                lblPD_Fax.Text = ""
    '                lblPD_Email.Text = ""
    '                lblPD_PriCarePhysician.Text = ""
    '                lbl_ShowPCPbusPhone.Text = ""
    '                lblPD_Pharmacy.Text = ""
    '                lbl_Emcontact.Text = ""
    '                lbl_EmMobile.Text = ""
    '                lbl_EmPhone.Text = ""
    '                lblPD_Age.Text = ""
    '                lblPD_DateOfBirth.Text = ""
    '                lbl_ShowLabStatus.Text = ""
    '                lblPD_PharmacyPhone.Text = ""
    '                lb_PatPhone.Text = ""
    '                Exit Sub
    '            End If
    '        End With
    '    Catch ex As Exception
    '        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
    '    Finally

    '    End Try
    'End Sub

    Private Function GetPatientStaus(ByVal PatientID As Int64) As String
        'Dim oDB As New gloStream.gloDataBase.gloDataBase
        'Dim strSQL As String
        'Dim Status As String
        'strSQL = "SELECT ISNULL(sPatientStatus,'') AS sPatientStatus FROM Patient WHERE  nPatientID = " & PatientID & ""
        'oDB.Connect(GetConnectionString)
        'Status = oDB.ExecuteQueryScaler(strSQL)

        'oDB.Disconnect()
        'oDB.Dispose()
        'oDB = Nothing
        'If Status = "" Then
        '    Return ""
        'Else
        '    Return Status
        'End If
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParameters As New gloDatabaseLayer.DBParameters()

        'DataTable dtstatus =  null;
        Dim strStatus As String = ""

        Try
            oDB.Connect(False)
            oParameters.Add("@PatientID", PatientID, ParameterDirection.Input, SqlDbType.BigInt)
            strStatus = Convert.ToString(oDB.ExecuteScalar("gsp_GetPatientStatus", oParameters))
        Catch ex As Exception
            MessageBox.Show(ex.Message, _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
        Finally
            If oDB IsNot Nothing Then
                oDB.Disconnect()
                oDB.Dispose()
                oDB = Nothing
            End If
            If oParameters IsNot Nothing Then
                oParameters.Dispose()
                oParameters = Nothing
            End If
        End Try

        If (String.IsNullOrEmpty(strStatus)) Then
            Return ""
        Else
            Return strStatus
        End If
    End Function

    Private Sub FillCardInformation()

        Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)


        Try
            'Aniket: Added code to check null reference exception which was coming sometimes
            'If oPatientCards Is Nothing Then
            '    oPatientCards = New gloPatient.PatientCards()
            'End If

            'oPatientCards.Clear()
            ClearAllCardInformation()
            If (Not IsNothing(picPC_Cards.Image)) Then
                picPC_Cards.Image.Dispose()
            End If
            picPC_Cards.Image = Nothing
            picPC_Cards.Tag = Nothing

            ' oPatientCards = ogloPatient.GetPatientCards(gnPatientID)
            If (IsNothing(oPatientCards) = False) Then
                oPatientCards.Clear()
                oPatientCards.Dispose()
                oPatientCards = Nothing
            End If
            oPatientCards = ogloPatient.GetSinglePatientCard(gnPatientID)
            If (IsNothing(oPatientCards) = False) Then
                If oPatientCards.Count > 0 Then
                    picPC_Cards.Image = oPatientCards(0).CardImage
                    lblScandate.Text = "Scanned : " & Format(oPatientCards(0).ScannedDateTime, "MM/dd/yyyy")
                    picPC_Cards.Tag = 0
                Else
                    lblScandate.Text = String.Empty
                End If
            Else
                'Aniket: Added code to check null reference exception which was coming sometimes

                oPatientCards = New gloPatient.PatientCards()


                oPatientCards.Clear()
                lblScandate.Text = String.Empty
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ''code opti
            If Not IsNothing(ogloPatient) Then
                ogloPatient.Dispose()
                ogloPatient = Nothing
            End If
        End Try
    End Sub

    'Scan PAtient Cards
    Private Sub btnPC_ScanCard_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPC_ScanCard.Click
        Try
            If gnPatientID <= 0 Then
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If

            'lock status
            If IsAccess(False, , True) = False Then
                Exit Sub
            End If
            'End

            Dim sc_activeWindow = gloWord.WordDialogBoxBackgroundCloser.GetForegroundWindow()
            Dim oCardImage As New gloCardScanning.frmCardImage(GetConnectionString(), gnPatientID, sc_activeWindow)
            oCardImage.StartPosition = FormStartPosition.CenterParent
            oCardImage.ShowDialog(IIf(IsNothing(oCardImage.Parent), Me, oCardImage.Parent))

            'code opti
            If Not IsNothing(oCardImage) Then
                oCardImage.Dispose()
                oCardImage = Nothing
            End If
            sc_activeWindow = IntPtr.Zero
            FillCardInformation()
            FillDemographicInformation()

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Delete Card
    Private Sub btnPC_DeleteCard_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPC_DeleteCard.Click
        Try
            'lock status
            If IsAccess(False, , True) = False Then
                Exit Sub
            End If
            'End

            If picPC_Cards.Tag IsNot Nothing Then
                If picPC_Cards.Tag.ToString <> "" Then
                    If MessageBox.Show("Are you sure you want to delete this card ?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2) = Windows.Forms.DialogResult.Yes Then
                        Dim oCardScanning As New gloCardScanning.gloCardScanning(GetConnectionString)
                        ''Bug : 00000775: Patient Demographics 
                        'gnPatientID = oPatientListControl.PatientID
                        If oCardScanning.DeleteCard(False, gnPatientID, oPatientCards(CType(picPC_Cards.Tag, Int16)).CardNumber) = True Then
                            oPatientCards.RemoveAt(CType(picPC_Cards.Tag, Int16))
                        End If
                        '' FillCardInformation()
                        'code opti
                        If (oPatientCards.Count = 0) Then
                            FillCardInformation()
                        Else
                            If (Not IsNothing(picPC_Cards.Image)) Then
                                picPC_Cards.Image.Dispose()
                            End If
                            picPC_Cards.Image = Nothing
                            ''  picPC_Cards.Tag = Nothing
                            If (CType(picPC_Cards.Tag, Int16) >= oPatientCards.Count) Then

                                picPC_Cards.Image = oPatientCards(CType(picPC_Cards.Tag, Int16) - 1).CardImage
                                picPC_Cards.Tag = CType(picPC_Cards.Tag, Int16) - 1
                            Else
                                picPC_Cards.Image = oPatientCards(CType(picPC_Cards.Tag, Int16)).CardImage
                            End If
                        End If

                        If Not IsNothing(oCardScanning) Then
                            oCardScanning.Dispose()
                            oCardScanning = Nothing
                        End If

                    End If
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Next card
    Private Sub btnPC_MoveNext_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPC_MoveNext.Click
        Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)
        Try
            'lock status
            If IsAccess(False, , True) = False Then
                Exit Sub
            End If
            'If (IsNothing(oPatientCards) = False) Then
            '    oPatientCards.Dispose()
            '    oPatientCards = Nothing
            'End If
            'oPatientCards = ogloPatient.GetPatientCards(gnPatientID)
            If (IsNothing(oPatientCards)) Then
                LoadPatientCards(ogloPatient)
            ElseIf oPatientCards.Count <= 1 Then

                LoadPatientCards(ogloPatient)
            End If


            If (IsNothing(oPatientCards) = False) Then
                If oPatientCards.Count > 0 Then
                    'If oPatientCards.Count = 1 Then
                    '    oPatientCards.Clear()
                    '    oPatientCards = ogloPatient.GetPatientCards(gnPatientID)
                    'End If

                    If (CType(picPC_Cards.Tag.ToString(), Int16) + 1) <= (oPatientCards.Count - 1) Then
                        picPC_Cards.Image = oPatientCards(CType(picPC_Cards.Tag.ToString(), Int16) + 1).CardImage

                        'to display scanned date & username
                        lblScandate.Text = "Scanned : " & Format(oPatientCards(CType(picPC_Cards.Tag.ToString(), Int16) + 1).ScannedDateTime, "MM/dd/yyyy")
                        picPC_Cards.Tag = CType(picPC_Cards.Tag.ToString(), Int16) + 1
                    End If
                End If
            Else
                oPatientCards = New gloPatient.PatientCards()




                oPatientCards.Clear()



            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            'Object Disposed By Mitesh
            If Not IsNothing(ogloPatient) Then
                ogloPatient.Dispose()
                ogloPatient = Nothing
            End If
        End Try
    End Sub

    'Previous  Card
    Private Sub btnPC_MovePrevious_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPC_MovePrevious.Click
        Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)
        Try
            'lock status
            If IsAccess(False, , True) = False Then
                Exit Sub
            End If

            'If (IsNothing(oPatientCards) = False) Then
            '    oPatientCards.Dispose()
            '    oPatientCards = Nothing
            'End If
            ' oPatientCards = ogloPatient.GetPatientCards(gnPatientID)

            If (IsNothing(oPatientCards)) Then
                LoadPatientCards(ogloPatient)
            ElseIf oPatientCards.Count <= 1 Then

                LoadPatientCards(ogloPatient)
            End If
            If (IsNothing(oPatientCards) = False) Then

                'If oPatientCards.Count = 1 Then
                '    oPatientCards.Clear()
                '    oPatientCards = ogloPatient.GetPatientCards(gnPatientID)
                'End If
                If oPatientCards.Count > 0 Then ''Slr if count >0
                    If (CType(picPC_Cards.Tag.ToString(), Int16) - 1) >= 0 Then
                        picPC_Cards.Image = oPatientCards(CType(picPC_Cards.Tag.ToString(), Int16) - 1).CardImage

                        'to display scanned date & username                   
                        lblScandate.Text = "Scanned : " & Format(oPatientCards(CType(picPC_Cards.Tag.ToString(), Int16) - 1).ScannedDateTime, "MM/dd/yyyy")
                        picPC_Cards.Tag = CType(picPC_Cards.Tag.ToString(), Int16) - 1
                    End If
                End If

            Else
                oPatientCards = New gloPatient.PatientCards()


                oPatientCards.Clear()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            'Object Disposed By Mitesh
            If Not IsNothing(ogloPatient) Then
                ogloPatient.Dispose()
                ogloPatient = Nothing
            End If
        End Try
    End Sub

    'Last Card
    Private Sub btnPC_MoveLast_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPC_MoveLast.Click
        Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)
        Try
            'If (IsNothing(oPatientCards) = False) Then
            '    oPatientCards.Dispose()
            '    oPatientCards = Nothing
            'End If
            'oPatientCards = ogloPatient.GetPatientCards(gnPatientID)

            If (IsNothing(oPatientCards)) Then
                LoadPatientCards(ogloPatient)
            ElseIf oPatientCards.Count <= 1 Then

                LoadPatientCards(ogloPatient)
            End If
            If (IsNothing(oPatientCards) = False) Then
                If oPatientCards.Count > 0 Then ''Slr if count >0
                    picPC_Cards.Image = oPatientCards(oPatientCards.Count - 1).CardImage
                    'to display scanned date & username                
                    lblScandate.Text = "Scanned : " & Format(oPatientCards(oPatientCards.Count - 1).ScannedDateTime, "MM/dd/yyyy")
                    picPC_Cards.Tag = oPatientCards.Count - 1
                End If
            Else
                oPatientCards = New gloPatient.PatientCards()


                oPatientCards.Clear()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            'Object Disposed By Mitesh
            If Not IsNothing(ogloPatient) Then
                ogloPatient.Dispose()
                ogloPatient = Nothing
            End If
        End Try
    End Sub

    'First Card
    Private Sub btnPC_MoveFirst_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPC_MoveFirst.Click
        Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)
        Try
            'lock status
            If IsAccess(False, , True) = False Then
                Exit Sub
            End If

            'If (IsNothing(oPatientCards) = False) Then
            '    oPatientCards.Dispose()
            '    oPatientCards = Nothing
            'End If
            'oPatientCards = ogloPatient.GetPatientCards(gnPatientID)

            If (IsNothing(oPatientCards)) Then
                LoadPatientCards(ogloPatient)
            ElseIf oPatientCards.Count <= 1 Then

                LoadPatientCards(ogloPatient)
            End If

            If (IsNothing(oPatientCards) = False) Then
                If oPatientCards.Count > 0 Then ''Slr if count >0
                    picPC_Cards.Image = oPatientCards(0).CardImage
                    'to display scanned date & username               
                    lblScandate.Text = "Scanned : " & Format(oPatientCards(0).ScannedDateTime, "MM/dd/yyyy")
                    picPC_Cards.Tag = 0
                End If
            Else
                oPatientCards = New gloPatient.PatientCards()


                oPatientCards.Clear()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            'Object Disposed By Mitesh
            If Not IsNothing(ogloPatient) Then
                ogloPatient.Dispose()
                ogloPatient = Nothing
            End If
        End Try
    End Sub


    Private Sub oPatientListControl_Grid_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles oPatientListControl.Grid_MouseDown
        Try
            ''Added Rahul for IsSecurityUser CCHIT requirement on 20101117
            If gblnSecurityUser = False Then
                _IsFromAppointment = False
                Call FillMenus()
                'Try
                '    If (IsNothing(oPatientListControl.ContextMenuStrip) = False) Then
                '        oPatientListControl.ContextMenuStrip.Dispose()
                '        oPatientListControl.ContextMenuStrip = Nothing
                '    End If
                'Catch ex As Exception

                'End Try

                oPatientListControl.ContextMenuStrip = cMnuPatient

                'To fill check in check out menu
                FillCheckInCheckOutMenu()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString)
        End Try
    End Sub


    'Function to ExemptFromReport Status
    Private Function GetIsExemptedFromReport() As Boolean
        Dim oDB As New gloStream.gloDataBase.gloDataBase
        Dim _Result As Int16 = 0
        Dim _Return As Boolean = False

        oDB.Connect(GetConnectionString)
        Dim strResult As String = ""
        strResult = oDB.ExecuteQueryScaler("SELECT ISNULL(nExemptFromReport,0) FROM Patient WHERE nPatientID = " & gnPatientID & "")

        If strResult.Trim = "" Then
            _Result = 0
        Else
            _Result = strResult.Trim
        End If

        If Val(_Result) = 1 Then
            _Return = True
        End If
        oDB.Disconnect()
        If Not IsNothing(oDB) Then
            oDB.Dispose()
            oDB = Nothing
        End If
        Return _Return
    End Function
    ''
    Private Sub ClearContextMenuStrip(ByRef cmnuStrip As ContextMenuStrip)
        Try
            If (IsNothing(cmnuStrip) = False) Then
                Dim CmpControls() As System.Windows.Forms.ContextMenuStrip = {cmnuStrip}

                If (IsNothing(CmpControls) = False) Then
                    If CmpControls.Length > 0 Then
                        gloGlobal.cEventHelper.RemoveAllEventHandlers(CmpControls)
                    End If
                End If

                If (IsNothing(CmpControls) = False) Then
                    If CmpControls.Length > 0 Then
                        gloGlobal.cEventHelper.ClearContextMenuStrip(CmpControls)
                    End If
                End If
            End If

        Catch ex As Exception

        End Try
    End Sub

    Private Sub AssignContextMenuStrip(ByRef cmnuStrip As ContextMenuStrip, ByVal cSrcStrip As ContextMenuStrip)
        Try
            If (IsNothing(cmnuStrip) = False) Then
                cmnuStrip = Nothing
            End If

            cmnuStrip = cSrcStrip

        Catch ex As Exception

        End Try
    End Sub

    Private Sub FillMenus()

        Dim oMenuItem As ToolStripMenuItem = Nothing
        Dim oChildItem As ToolStripMenuItem = Nothing
        Dim oAllMenuItem As ToolStripMenuItem = Nothing
        Dim oNextChildItem As ToolStripMenuItem = Nothing
        Dim oAllNextChildItem As ToolStripMenuItem = Nothing

        Try

            If IsNothing(cMnuPatient) = False Then ''Slr dispose all child items and items and then dispose cMnuPatient

                ClearContextMenuStrip(oPatientListControl.ContextMenuStrip)

                ClearContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip)

                ClearContextMenuStrip(C1Appointments.ContextMenuStrip)

                ClearContextMenuStrip(pnlRightFill.ContextMenuStrip)

                ClearContextMenuStrip(pnlLeft.ContextMenuStrip)

                ClearContextMenuStrip(cMnuPatient)

            End If


        Catch ex As Exception

        End Try
        If (IsNothing(cMnuPatient)) Then
            cMnuPatient = New ContextMenuStrip
        End If

        Dim clsPatDet As New clsPatientDetails
        Dim dtProviders_Templates As DataTable = Nothing
        Dim oDB As New gloStream.gloDataBase.gloDataBase
        Try
            'Condition Added
            'To hide New Exam context menu only if user doesn't have New Exam 
            'Rights though user hides New Exam button from main toolbar
            If objUserRights.PatientNewExam = True Then

                'oMenuItem = New ToolStripMenuItem
                dtProviders_Templates = clsPatDet.Fill_Templates_ForFillMenu()
                If Not IsNothing(dtProviders_Templates) Then
                    Dim dvAllTEmplates As New DataView(dtProviders_Templates)
                    dvAllTEmplates.Sort = "sTemplateName ASC"

                    'Exam Main Menu

                    oMenuItem = New ToolStripMenuItem
                    With oMenuItem
                        .Text = "New Exam"
                        .Text = "New Exam"
                        .Image = imgList_Common.Images(9)
                    End With

                    Dim _PreviousProviderID As Int64
                    Dim _CurrentProviderID As Int64

                    oAllMenuItem = New ToolStripMenuItem
                    With oAllMenuItem
                        .Text = "All"
                        .Tag = 0
                    End With

                    For p As Integer = 0 To dtProviders_Templates.Rows.Count - 1
                        _PreviousProviderID = _CurrentProviderID
                        _CurrentProviderID = Convert.ToInt64(dtProviders_Templates.Rows(p).Item("nProviderID"))
                        If ((_PreviousProviderID <> _CurrentProviderID) AndAlso (_CurrentProviderID <> 0)) Then
                            If IsNothing(oChildItem) = False Then
                                If (oChildItem.Text.Trim() <> "") Then
                                    oMenuItem.DropDownItems.Add(oChildItem)
                                    oChildItem = Nothing
                                End If

                            End If
                            oChildItem = New ToolStripMenuItem
                            With oChildItem
                                .Text = Trim(dtProviders_Templates.Rows(p).Item("ProviderName")) ' Name
                                .Tag = Trim(dtProviders_Templates.Rows(p).Item("nProviderID")) 'ID' enmContextMenu.ProviderExam
                            End With
                        End If
                        If (_CurrentProviderID <> 0) Then
                            oNextChildItem = New ToolStripMenuItem
                            With oNextChildItem
                                .Text = Trim(dtProviders_Templates.Rows(p).Item("sTemplateName"))
                                .Tag = "New Exam" & "-" & Trim(dtProviders_Templates.Rows(p).Item("nTemplateID"))
                            End With

                            AddHandler oNextChildItem.Click, AddressOf SetMenus
                            oChildItem.DropDownItems.Add(oNextChildItem)
                            oNextChildItem = Nothing
                        End If

                        oAllNextChildItem = New ToolStripMenuItem
                        With oAllNextChildItem
                            .Text = Trim(dvAllTEmplates.Item(p)("sTemplateName").ToString())
                            .Tag = "New Exam" & "-" & Trim(dvAllTEmplates.Item(p)("nTemplateID"))
                        End With
                        AddHandler oAllNextChildItem.Click, AddressOf SetMenus
                        oAllMenuItem.DropDownItems.Add(oAllNextChildItem)
                        oAllNextChildItem = Nothing
                    Next

                    If IsNothing(oChildItem) = False Then

                        If (oChildItem.Text.Trim() <> "") Then
                            oMenuItem.DropDownItems.Add(oChildItem)
                            oChildItem = Nothing
                        End If
                    End If
                    If IsNothing(oAllMenuItem) = False Then
                        oMenuItem.DropDownItems.Add(oAllMenuItem)
                        oAllMenuItem = Nothing
                    End If
                    cMnuPatient.Items.Add(oMenuItem)
                    dvAllTEmplates.Dispose()
                End If ' If Not IsNothing(dtProviders) Then
            End If


            If IsNothing(dtProviders_Templates) = False Then
                dtProviders_Templates.Dispose()
            End If

            'Provider specific exam templates
            If (_IsFromAppointment = False) Then
                'Pull Charts
                'Added Userrights setting for Pull Chart Bug #75745: 00000798: Pull Charts not showing in context menu
                If objUserRights.PullCharts Then
                    'Chart Pull Menu
                    oMenuItem = New ToolStripMenuItem
                    With oMenuItem
                        .Text = "Pull Charts"
                        .Tag = "Pull Charts"
                        .Image = imgList_Common.Images(10)
                    End With


                    'Chart Pull Sub Menus
                    'Today
                    oChildItem = New ToolStripMenuItem
                    With oChildItem
                        .Text = "Today"
                        .Tag = "Pull Charts"
                    End With
                    oMenuItem.DropDownItems.Add(oChildItem)
                    AddHandler oChildItem.Click, AddressOf SetMenus

                    'Tomorrow
                    oChildItem = New ToolStripMenuItem
                    With oChildItem
                        .Text = "Tomorrow"
                        .Tag = "Pull Charts"
                    End With
                    oMenuItem.DropDownItems.Add(oChildItem)
                    AddHandler oChildItem.Click, AddressOf SetMenus

                    'Separator
                    oMenuItem.DropDownItems.Add(New ToolStripSeparator)

                    'Customize
                    oChildItem = New ToolStripMenuItem
                    With oChildItem
                        .Text = "Customize"
                        .Tag = "Pull Charts"
                    End With
                    oMenuItem.DropDownItems.Add(oChildItem)
                    AddHandler oChildItem.Click, AddressOf SetMenus

                    cMnuPatient.Items.Add(oMenuItem)
                End If
            End If

            'dhruv - to see more data into context menu if the modify patient is customizable disable
            'Chief Complaints
            oMenuItem = New ToolStripMenuItem
            With oMenuItem
                .Text = "Chief Complaints/Injury/Surgery Dates"
                .Tag = "Chief Complaints"
                .Image = imgList_Common.Images(7)
            End With
            cMnuPatient.Items.Add(oMenuItem)
            AddHandler oMenuItem.Click, AddressOf SetMenus

            'dhruv End - to see more data into context menu if the modify patient is customizable disable



            oMenuItem = New ToolStripMenuItem
            With oMenuItem
                .Text = "Clinical Instruction"
                .Tag = "Clinical Instruction"
                .Image = imgList_Common.Images(32)
            End With
            cMnuPatient.Items.Add(oMenuItem)
            AddHandler oMenuItem.Click, AddressOf SetMenus


            oMenuItem = New ToolStripMenuItem
            With oMenuItem
                .Text = "Care Plan"
                .Tag = "Care Plan"
                .Image = imgList_Common.Images(33)
            End With
            cMnuPatient.Items.Add(oMenuItem)
            AddHandler oMenuItem.Click, AddressOf SetMenus


            'Exempt Form Report
            If objUserRights.PatientRegistration = True Then
                oMenuItem = New ToolStripMenuItem
                With oMenuItem
                    .Text = "Exempt From Report"
                    .Tag = "Exempt Form Report"
                    .Checked = GetIsExemptedFromReport()
                    If .Checked = False Then
                        .Image = imgList_Common.Images(8)
                    End If
                End With

                cMnuPatient.Items.Add(oMenuItem)
                AddHandler oMenuItem.Click, AddressOf SetMenus
            End If


            If objUserRights.PatientRegistration = True Then
                'Set Patient Alert
                If _blnShowSetAlert = True Then
                    'General Patient Alert
                    oMenuItem = New ToolStripMenuItem
                    With oMenuItem
                        .Text = "Set Patient Alert"
                        .Tag = "Set Patient Alert"
                        .Image = imgList_Common.Images(11)
                    End With

                    cMnuPatient.Items.Add(oMenuItem)
                    AddHandler oMenuItem.Click, AddressOf SetMenus
                End If
            End If

            'Set Surgical Alert
            If objUserRights.PatientRegistration = True Then
                oMenuItem = New ToolStripMenuItem
                With oMenuItem
                    .Text = "Set Surgical Alert"
                    .Tag = "Set Surgical Alert"
                    .Image = imgList_Common.Images(12)
                End With
                cMnuPatient.Items.Add(oMenuItem)
                AddHandler oMenuItem.Click, AddressOf SetMenus
            End If


            'Dhruv - to see more data into context menu if the modify patient is customizable disable
            'Change Provider Menu
            oMenuItem = New ToolStripMenuItem
            With oMenuItem
                .Text = "Change Provider"
                .Tag = "Change Doctor"
                .Image = imgList_Common.Images(6)
            End With

            Dim clProviders As Collection
            Dim objProvider As New clsProvider
            clProviders = objProvider.Fill_Providers
            Dim j As Int32
            For j = 1 To clProviders.Count
                oChildItem = New ToolStripMenuItem
                With oChildItem
                    .Text = clProviders.Item(j).ToString().Trim()
                    .Tag = "Change Doctor"
                End With
                AddHandler oChildItem.Click, AddressOf SetMenus
                oMenuItem.DropDownItems.Add(oChildItem)
            Next
            If IsNothing(clProviders) = False Then
                clProviders = Nothing
            End If
            If IsNothing(objProvider) = False Then
                objProvider.Dispose()
                objProvider = Nothing
            End If
            cMnuPatient.Items.Add(oMenuItem)
            'Dhruv End - to see more data into context menu if the modify patient is customizable disable

            'if clinic formulary setting is ON and Machine formulary setting is OFF then don't show the View eligibility context menu
            'if clinic formulary setting is OFF then there is no need to check the setting for machine formulary setting, directly don't show the View eligibility context menu
            If gblnAdvErxEnabled = True Then
                'show the View eligibility context menu
                oMenuItem = New ToolStripMenuItem
                With oMenuItem
                    .Text = "View Rx Eligibility"
                    .Tag = "View Rx Eligibility"
                    .Image = imgList_Common.Images(14)
                End With

                cMnuPatient.Items.Add(oMenuItem)
                AddHandler oMenuItem.Click, AddressOf SetMenus
            Else
                'Don't show the View eligibility context menu
            End If

            'Add menu item for advanced directive 

            Dim _HasDirective As Int16 = 0
            oDB.Connect(GetConnectionString)
            _HasDirective = Val(oDB.ExecuteQueryScaler("SELECT nPatientDirective FROM patient WHERE npatientid = " & gnPatientID & " "))
            oDB.Disconnect()
            'oDB = Nothing
            If _HasDirective > 0 Then
                oMenuItem = New ToolStripMenuItem
                With oMenuItem
                    .Text = "Advance Directive"
                    .Tag = "Advance Directive"
                    .Image = imgList_Common.Images(17)
                End With

                cMnuPatient.Items.Add(oMenuItem)
                AddHandler oMenuItem.Click, AddressOf SetMenus
            End If

            ''Added by Mayuri:20101004-Added patient save as copy functionality
            Dim ogloSettings As New gloSettings.GeneralSettings(GetConnectionString())

            Dim oResultAllowEditablePatientCode As Object = Nothing

            ogloSettings.GetSetting("Allow-Editable Patient Code", oResultAllowEditablePatientCode)
            Dim _AllowEditablePatientCode As Int32 = 0

            If oResultAllowEditablePatientCode <> Nothing AndAlso oResultAllowEditablePatientCode.ToString() <> "" Then
                _AllowEditablePatientCode = Convert.ToInt32(oResultAllowEditablePatientCode)
            End If
            If _AllowEditablePatientCode <> 0 Then
                oMenuItem = New ToolStripMenuItem
                With oMenuItem
                    .Text = "Copy Patient"
                    .Tag = "Save As Copy"
                    .Image = imgList_Common.Images(24)
                End With
                cMnuPatient.Items.Add(oMenuItem)
                AddHandler oMenuItem.Click, AddressOf SetMenus
            End If

            'is password entered once already ?
            If gbAllowEmergencyAccess = False Then
                'is status=lock chart ?
                ' If CheckPatientStatus(gnPatientID, , , True, True) = False Then
                If CheckPatientStatus_new(gstrPatientStatus, True, True) = False Then
                    Dim _EmergencyAccess As Boolean = False
                    Try
                        oDB.Connect(GetConnectionString)
                        'Added Valid up to Date for Emergency Access Password as on 12032010
                        Dim sQry As String = "select IsPatientChartAccess from user_mst where nuserid= " & gnLoginID.ToString() & " and dtValidupto>= '" & DateValue(Now.Date.ToString()) & "'"
                        'Added Valid up to Date for Emergency Access Password as on 12032010
                        Dim sAccess As String = oDB.ExecuteQueryScaler(sQry)
                        _EmergencyAccess = CBool(If(sAccess = "", "false", sAccess))
                        oDB.Disconnect()
                    Catch ex As Exception
                    End Try
                    'Emergency Access of Patient Chart
                    If _EmergencyAccess = True Then
                        oMenuItem = New ToolStripMenuItem
                        With oMenuItem
                            .Text = "Allow Emergency Access of Patient Chart"
                            .Tag = "Emergency Access"
                            .Image = imgList_Common.Images(20)
                        End With
                        cMnuPatient.Items.Add(oMenuItem)
                        AddHandler oMenuItem.Click, AddressOf SetMenus
                    End If
                End If
            End If

            'Chetan integrated for  YesLab functionality on 26 oct
            If gblnYesNoLab = True Then
                oMenuItem = New ToolStripMenuItem
                With oMenuItem
                    .Tag = "YesLab"
                    If _YesLab = True Then
                        .Text = "NoLab"
                        .Image = imgList_Common.Images(26)
                    Else
                        .Text = "YesLab"
                        .Image = imgList_Common.Images(25)
                    End If
                End With
                cMnuPatient.Items.Add(oMenuItem)
                AddHandler oMenuItem.Click, AddressOf SetMenus
            Else
                pnlYESLAB.Visible = False
            End If
            oMenuItem = New ToolStripMenuItem
            With oMenuItem
                .Text = "Cases"
                .Tag = "Cases"
                .Image = imgList_Common.Images(30)
            End With
            cMnuPatient.Items.Add(oMenuItem)
            AddHandler oMenuItem.Click, AddressOf SetMenus

            oMenuItem = New ToolStripMenuItem
            With oMenuItem
                .Text = "Health Record Amendment Requests"
                .Tag = "Amendments"
                .Image = imgList_Common.Images(35)
            End With
            cMnuPatient.Items.Add(oMenuItem)
            AddHandler oMenuItem.Click, AddressOf SetMenus

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If IsNothing(oAllMenuItem) = False Then
                oAllMenuItem.Dispose()
                oAllMenuItem = Nothing
            End If
            If IsNothing(oAllNextChildItem) = False Then
                oAllNextChildItem.Dispose()
                oAllNextChildItem = Nothing
            End If
            If IsNothing(oNextChildItem) = False Then
                oNextChildItem.Dispose()
                oNextChildItem = Nothing
            End If
            If IsNothing(clsPatDet) = False Then
                clsPatDet.Dispose()
                clsPatDet = Nothing
            End If
            If IsNothing(oDB) = False Then
                oDB.Dispose()
                oDB = Nothing
            End If

        End Try
        AssignContextMenuStrip(oPatientListControl.ContextMenuStrip, cMnuPatient)

        AssignContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip, cMnuPatient)

        AssignContextMenuStrip(C1Appointments.ContextMenuStrip, cMnuPatient)

        AssignContextMenuStrip(pnlRightFill.ContextMenuStrip, cMnuPatient)

        AssignContextMenuStrip(pnlLeft.ContextMenuStrip, cMnuPatient)




    End Sub


    '''''''' code added for yesno lab on oct 26 2010
    Public Sub SetYesLab(Optional ByVal SetYlab As Boolean = False)
        If gblnYesNoLab = True Then

            Dim oDB As New gloStream.gloDataBase.gloDataBase
            oDB.Connect(GetConnectionString)
            Dim sYesLab As String
            'Set YesLab
            If SetYlab = True Then
                sYesLab = oDB.ExecuteQueryScaler("select isnull(bIsYesLab,'') from patient where nPatientID= " & gnPatientID & " ")

                If sYesLab.ToLower() = "false" Then
                    _YesLab = oDB.ExecuteNonSQLQuery(" update patient set bIsYesLab=1 where nPatientID= " & gnPatientID & " ")
                Else
                    _YesLab = oDB.ExecuteNonSQLQuery(" update patient set bIsYesLab=0 where nPatientID= " & gnPatientID & " ")
                End If
            End If

            sYesLab = (oDB.ExecuteQueryScaler("select isnull(bIsYesLab,'') from patient where nPatientID= " & gnPatientID & " "))
            _YesLab = CBool(If(sYesLab = "", "false", sYesLab))

            sYesLab = Nothing

            oDB.Disconnect()
            oDB.Dispose()
            'code opti
            oDB = Nothing

            If _YesLab = True Then
                pnlMainPatientCardButton.SendToBack()
                pnlYESLAB.BringToFront()
                pnlPatientCard.Text = "Labs"
                pnlPatientCard.Tag = "LABS"
                PictureBox3.BackgroundImage = Global.gloEMR.My.Resources.Resources.Green_YES_Lab
                lbl_ShowLabStatus.Text = "Yes Lab"
            Else
                pnlMainPatientCardButton.SendToBack()
                pnlYESLAB.BringToFront()
                pnlPatientCard.Text = "Labs"
                pnlPatientCard.Tag = "LABS"
                PictureBox3.BackgroundImage = Global.gloEMR.My.Resources.Resources.Red_NO_Lab
                lbl_ShowLabStatus.Text = "No Lab"
            End If

            'lock status
            If IsAccess(True) = False Then
                lbl_ShowLabStatus.Text = ""
                pnlMainPatientCardButton.BringToFront()
                pnlYESLAB.SendToBack()
                pnlPatientCard.Text = "Patient Cards"
                pnlPatientCard.Tag = "CARDS"
            End If
        Else
            lbl_ShowLabStatus.Text = ""
            pnlMainPatientCardButton.BringToFront()
            pnlYESLAB.SendToBack()
            pnlPatientCard.Text = "Patient Cards"
            pnlPatientCard.Tag = "CARDS"
        End If
    End Sub

    Private Sub FillAppointmentMenus(ByVal _IsFromAppointmentGrid)


        FillMenus()

        Dim oMenuItem As ToolStripMenuItem = Nothing
        Dim oChildMenuItem As ToolStripMenuItem = Nothing
        Dim dtTemplates As DataTable = Nothing
        Dim oglotemplate As New gloOffice.gloTemplate(GetConnectionString())
        Try




            If _IsFromAppointmentGrid = False Then
                oMenuItem = New ToolStripMenuItem
                oMenuItem.Text = "Add Appointment"
                oMenuItem.Tag = "Add Appointment"
                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                oMenuItem.Image = imgList_Common.Images(16)
                cmnuPatientDetails.Items.Add(oMenuItem)
                AddHandler oMenuItem.Click, AddressOf AddPatientDetails
            End If

            oMenuItem = New ToolStripMenuItem
            oMenuItem.Text = "Check In Templates"

            '30-Apr-13 Aniket: Resolving Memory Leaks
            'dtTemplates = New DataTable
            dtTemplates = oglotemplate.GetAssociation(gloOffice.AssociationCategories.CheckIn)
            If Not IsNothing(dtTemplates) AndAlso dtTemplates.Rows.Count > 0 Then
                For i As Integer = 0 To dtTemplates.Rows.Count - 1
                    ' oChildMenuItem = New ToolStripMenuItem  ''slr 2 times oChildMenuItem
                    oChildMenuItem = New ToolStripMenuItem()
                    oChildMenuItem.Text = dtTemplates.Rows(i)("sTemplatename").ToString()
                    oChildMenuItem.Tag = dtTemplates.Rows(i)("nTemplateID").ToString()
                    If _IsFromAppointmentGrid = False Then
                        oChildMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                    End If
                    oMenuItem.DropDownItems.Add(oChildMenuItem)
                    AddHandler oChildMenuItem.Click, AddressOf cmnuAppointmentTemplateItem_Click
                    oChildMenuItem = Nothing
                Next
            End If
            oMenuItem.Image = Imgts_PatientDetails.Images(36)

            If _IsFromAppointmentGrid = True Then
                cMnuPatient.Items.Add(oMenuItem)
            Else
                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                cmnuPatientDetails.Items.Add(oMenuItem)
            End If

            oMenuItem = New ToolStripMenuItem
            oMenuItem.Text = "Appointment Letters Templates"
            oMenuItem.Image = Imgts_PatientDetails.Images(37)

            '30-Apr-13 Aniket: Resolving Memory Leaks
            If IsNothing(dtTemplates) = False Then
                dtTemplates.Dispose()
                dtTemplates = Nothing
            End If

            'dtTemplates = New DataTable

            dtTemplates = oglotemplate.GetAssociation(gloOffice.AssociationCategories.AppointmentLetters)

            If Not IsNothing(dtTemplates) AndAlso dtTemplates.Rows.Count > 0 Then



                For i As Integer = 0 To dtTemplates.Rows.Count - 1
                    oChildMenuItem = New ToolStripMenuItem()
                    oChildMenuItem.Text = dtTemplates.Rows(i)("sTemplatename").ToString()
                    oChildMenuItem.Tag = dtTemplates.Rows(i)("nTemplateID").ToString()
                    If _IsFromAppointmentGrid = False Then
                        oChildMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                    End If
                    AddHandler oChildMenuItem.Click, AddressOf cmnuAppointmentTemplateItem_Click
                    oMenuItem.DropDownItems.Add(oChildMenuItem)
                    oChildMenuItem = Nothing
                Next
            End If
            If _IsFromAppointmentGrid = True Then
                cMnuPatient.Items.Add(oMenuItem)
            Else
                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                cmnuPatientDetails.Items.Add(oMenuItem)
            End If

            'Added View Appointment History
            If _IsFromAppointmentGrid = False Then
                If C1dgPatientDetails.Rows.Count > 1 Then
                    oMenuItem = New ToolStripMenuItem
                    oMenuItem.Text = "View History"
                    oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                    oMenuItem.Image = Imgts_PatientDetails.Images(71)
                    cmnuPatientDetails.Items.Add(oMenuItem)
                    AddHandler oMenuItem.Click, AddressOf cmnuAppointmentHistoryItem_Click
                End If
            End If

        Catch ex As Exception
        Finally
            If Not IsNothing(dtTemplates) Then
                dtTemplates.Dispose()
                dtTemplates = Nothing
            End If
            If Not IsNothing(oglotemplate) Then ''slr  oglotemplate
                oglotemplate.Dispose()
                oglotemplate = Nothing
            End If

        End Try
  
    End Sub

    Private Sub cmnuAppointmentHistoryItem_Click(ByVal sender As Object, ByVal e As EventArgs)
        'To get nMstAppointmentID
        Dim ofrmViewAppointmentHistory As New gloAppointmentScheduling.frmViewApptHistory(GetConnectionString())
        If (C1dgPatientDetails.Row > 0) Then
            ofrmViewAppointmentHistory.AppointmentID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_MSTAPTID).ToString)
            ofrmViewAppointmentHistory.ShowDialog(IIf(IsNothing(ofrmViewAppointmentHistory.Parent), Me, ofrmViewAppointmentHistory.Parent))
        End If
        ofrmViewAppointmentHistory.Dispose()
    End Sub

    Private Sub cmnuAppointmentTemplateItem_Click(ByVal sender As Object, ByVal e As EventArgs)
        Try
            GetControlSelection()


            'To check exception related to word
            'If CheckWordForException() = False Then
            '    Exit Sub
            'End If
            If IsAccess(False) = False Then
                Exit Sub
            End If
            GetControlSelection()
            GridSelect_RowCount = C1dgPatientDetails.Rows.Count
            If sender IsNot Nothing Then

                '30-Apr-13 Aniket: Resolving Memory Leaks
                Dim cmnuTemplateItem As ToolStripMenuItem
                cmnuTemplateItem = DirectCast(sender, ToolStripMenuItem)
                Dim ogloTemplate As New gloOffice.gloTemplate(GetConnectionString())
                ogloTemplate.CategoryID = Convert.ToInt64(cmnuTemplateItem.OwnerItem.Tag)
                ogloTemplate.CategoryName = cmnuTemplateItem.OwnerItem.Text
                ogloTemplate.TemplateID = Convert.ToInt64(cmnuTemplateItem.Tag)

                If C1Appointments.Cols.Count <> col_Count Then
                    Exit Sub
                End If

                If _IsFromAppointmentforTemplatePrint = True Then

                    ogloTemplate.PrimeryID = Convert.ToInt64(C1Appointments.GetData(C1Appointments.Row, col_AppDtlId).ToString)
                    ogloTemplate.FromDate = gloDate.DateAsNumber(C1Appointments.GetData(C1Appointments.Row, col_AppDate).ToString)
                    ogloTemplate.isFromDashboradAppt = True
                Else
                    If C1dgPatientDetails.Rows.Count > 1 Then

                        If C1dgPatientDetails.RowSel > 0 Then
                            ogloTemplate.PrimeryID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_APTDTL).ToString)
                            ogloTemplate.FromDate = gloDate.DateAsNumber(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_DATE1).ToString)
                            'Bug #92723: 00001067: Appointment 
                            ogloTemplate.ToDate = gloDate.DateAsNumber(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_DATE1).ToString)

                        End If
                    End If
                End If

                ogloTemplate.TemplateName = cmnuTemplateItem.Text
                ogloTemplate.PatientID = Convert.ToInt64(gnPatientID)
                ogloTemplate.ClinicID = gnClinicID

                '' GLO2010-0010515 : check in template patient information sheet not filling out history items once history is checked (Bug #4427)
                '' We were not sending Visit Id, so history liquid links was not populating in check-in template
                ogloTemplate.VisitID = gnVisitID

                Dim frm As New gloOffice.frmWd_PatientTemplate(GetConnectionString(), True, ogloTemplate)
                frm.Text = cmnuTemplateItem.Text
                frm.WindowState = FormWindowState.Maximized
                frm.MdiParent = Me
                frm.Show()

                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        Finally
            SetControlSelection()

        End Try

    End Sub

    Public Sub SetMenus(ByVal sender As Object, ByVal e As EventArgs)
        Dim oCurrentMenu As ToolStripMenuItem = CType(sender, ToolStripMenuItem)
        Dim TemplateID As Int64 = 0
        _isShowDialogueForm = True
        RegisterMyHotKey()
        Try
            Dim a As Array = Nothing
            If (oCurrentMenu.Tag.ToString().Contains("New Exam")) Then
                a = oCurrentMenu.Tag.ToString.Split("-")
                oCurrentMenu.Tag = "New Exam"
            End If
            Select Case oCurrentMenu.Tag.ToString()
                Case "New Exam"

                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                    If (a.Length >= 2) Then
                        _TemplateID = a(1)
                    End If
                    _TemplateName = oCurrentMenu.Text
                    Call NewExam(True)
                    _TemplateName = ""
                    TemplateID = 0
                Case "Pull Charts"
                    If gnPatientID > 0 Then

                        If MyBase.SetChildFormModules("SetMenus", "Create pull chart", gnPatientProviderID.ToString()) <> True Then

                            If oCurrentMenu.Text = "Today" Then
                                'Check Patient Status
                                'Break the Glass
                                If IsAccess(False) = False Then
                                    Exit Sub
                                End If

                                'Break the Glass
                                Fill_PullCharts(enmPullChartsCriteria.Today)

                                'Check Patient Status

                            ElseIf oCurrentMenu.Text = "Tomorrow" Then
                                'Check Patient Status
                                'Break the Glass
                                If IsAccess(False) = False Then
                                    Exit Sub
                                End If
                                'Break the Glass
                                Fill_PullCharts(enmPullChartsCriteria.Tomorrow)
                                'Check Patient Status
                            ElseIf oCurrentMenu.Text = "Customize" Then
                                'Check Patient Status
                                'Break the Glass
                                If IsAccess(False) = False Then
                                    Exit Sub
                                End If
                                'Break the Glass
                                Fill_PullCharts(enmPullChartsCriteria.Customize)
                                'Check Patient Status
                            End If
                        End If
                    Else
                        MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    End If

                Case "Chief Complaints"
                    If gnPatientID > 0 Then


                        'Break the Glass
                        If IsAccess(False) = False Then
                            Exit Sub
                        End If
                        'Break the Glass
                        Dim frm As New frmPatientInjuryDate(gnPatientID)

                        frm.Text = "Chief Complaints for " '& gstrPatientFirstName & " " & gstrPatientLastName
                        frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
                        'code added by dipak 20091005 to refresh problem list after Adding/modify chief complaints 
                        'as chief complaint is updated to problem list.
                        If (SelectedPatientDetail = PatientDetails.ProblemList) Then
                            ShowPatientDetails()
                        End If
                        'code opti
                        If Not IsNothing(frm) Then
                            frm.Dispose()
                            frm = Nothing
                        End If
                    Else
                        MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    End If
                Case "Clinical Instruction"
                    If gnPatientID > 0 Then
                        If IsAccess(False) = False Then
                            Exit Sub
                        End If

                        'Dashboard Clinical Instruction context menu option to call the patient view clinical instructions form

                        Dim ofrm As New frmViewClinicalInstruction(gnPatientID)

                        ofrm.MdiParent = Me
                        ofrm.ShowInTaskbar = False
                        ofrm.WindowState = FormWindowState.Maximized
                        ofrm.Show()

                        pnlMainToolBar.Visible = False
                        ShowHideMainMenu(False, False)
                        ofrm.OpenAddWindow = True

                    Else
                        MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    End If
                    'end

                Case "Care Plan"
                    If gnPatientID > 0 Then

                        If IsAccess(False) = False Then
                            Exit Sub
                        End If

                        'Dashboard Care Plan context menu option to call the patient view clinical instructions form

                        'Dim frm As New frmViewCarePlan(gnPatientID)
                        Dim frm As New frmViewCarePlan_V2(gnPatientID)

                        frm.MdiParent = Me
                        frm.ShowInTaskbar = False
                        frm.WindowState = FormWindowState.Maximized
                        frm.Show()

                        pnlMainToolBar.Visible = False
                        ShowHideMainMenu(False, False)
                        frm.OpenAddWindow = True

                    Else
                        MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    End If
                    'end

                Case "Exempt Form Report"
                    'Break the Glass
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If

                    'Break the Glass
                    Dim _CurrentStatus As Boolean = oCurrentMenu.Checked
                    Dim oDB As gloStream.gloDataBase.gloDataBase
                    If _CurrentStatus = True Then
                        If MessageBox.Show("Are you sure, you want to include this patient in report selection?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                            oDB = New gloStream.gloDataBase.gloDataBase
                            oDB.Connect(GetConnectionString)
                            oDB.ExecuteNonSQLQuery("UPDATE Patient SET nExemptFromReport = 0 WHERE nPatientID = " & gnPatientID & "")
                            oDB.Disconnect()
                            oDB.Dispose()
                            oDB = Nothing
                        End If

                    Else
                        If MessageBox.Show("Are you sure, you want to exempt this patient from report selection?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                            oDB = New gloStream.gloDataBase.gloDataBase
                            oDB.Connect(GetConnectionString)
                            oDB.ExecuteNonSQLQuery("UPDATE Patient SET nExemptFromReport = 1 WHERE nPatientID = " & gnPatientID & "")
                            oDB.Disconnect()
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                    End If
                    oDB = Nothing
                Case "Set Patient Alert"
                    If gnPatientID > 0 Then
                        Call SetPatientAlerts()
                    Else
                        MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    End If


                Case "Set Surgical Alert"
                    If gnPatientID > 0 Then
                        'Break the Glass
                        If IsAccess(False) = False Then
                            Exit Sub
                        End If
                        'Break the Glass

                        SetSurgicalAlerts()
                        Fill_Tasks()
                        ShowTasks()
                    Else
                        MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    End If
                Case "Change Doctor"
                    'Break the Glass
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                    'Break the Glass
                    ''Check  if provider is registered for that particular visit
                    Dim objProvider As New clsProvider

                    gnVisitID = GetVisitID(Now, gnPatientID) ' GenerateVisitID()

                    '' Incident #00017037 : Patient Context Issue resolved
                    Dim nNewProviderID As Long = 0
                    nNewProviderID = objProvider.RetrieveProviderID(oCurrentMenu.Text)

                    If objProvider.CheckProviderStatus(gnVisitID, gnPatientID, oCurrentMenu.Text) Then
                        ''if yes prompt the user still he want to continue
                        Dim Result As DialogResult
                        Result = MessageBox.Show("A provider is already associated with the visit. Do you still want to change the provider?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2)
                        If Result = DialogResult.Yes Then
                            '' Incident #00017037 : Patient Context Issue resolved
                            If objProvider.ChangePatientProvider(gnPatientID, nNewProviderID) = True Then
                                '' Incident #00017037 : Patient Context Issue resolved
                                ''Refresh ProviderList on dashboard 
                                oPatientListControl.SelectProvider(nNewProviderID)
                            End If

                        Else
                            If Not IsNothing(objProvider) Then ''slr dispose objprovider 
                                objProvider.Dispose()
                                objProvider = Nothing
                            End If
                            Exit Sub
                        End If
                    Else
                        '' Incident #00017037 : Patient Context Issue resolved
                        If objProvider.ChangePatientProvider(gnPatientID, nNewProviderID) = True Then
                            ''Refresh ProviderList on dashboard 
                            '' Incident #00017037 : Patient Context Issue resolved
                            oPatientListControl.SelectProvider(nNewProviderID)
                        End If

                    End If
                    objProvider.Dispose()
                    objProvider = Nothing
                Case "Workers Comp"

                Case "Advance Directive"
                    'Break the Glass
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                    'Break the Glass
                    ShowEScanner(gnPatientID)

                    'Integrated by Chetan - to implement 'Emergency Access of Patient Chart' as on 05 Oct 2010            
                Case "Emergency Access"
                    Dim frm As New FrmAllowAccess(gnPatientID)
                    frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
                    'code opti
                    If Not IsNothing(frm) Then
                        frm.Dispose()
                        frm = Nothing
                    End If
                    ''''''''''''''''''''
                    ''Bug #67150 ( Modified): 00000555 : Patient Lock Chart Issue
                    'Show emergency access patient details
                    If gbAllowEmergencyAccess Then
                        ShowPatientAllDetails(gnPatientID, , True)
                    End If

                    SetButtonsOnOff()
                    ShowPatientDetails()
                    'Integrated by Chetan - to implement 'Emergency Access of Patient Chart' as on  05 Oct 2010


                Case "Save As Copy"
                    If gnPatientID > 0 Then
                        Dim _CurrentPatientID As Int64
                        Dim _result As Boolean = False
                        _CurrentPatientID = gnPatientID

                        If _CurrentPatientID > 0 Then
                            'Break the Glass
                            If IsAccess(False) = False Then
                                Exit Sub
                            End If
                            'Break the Glass
                            gnPatientID = _CurrentPatientID
                            oPatientListControl.PatientID = gnPatientID
                            oPatientListControl.SelectedPatientID = gnPatientID
                        End If


                        Dim frm As New gloPatient.frmSetupPatient(gnPatientID, GetConnectionString(), True)
                        frm.Text = "New Patient : copy of" & " " & oPatientListControl.FirstName & " " & oPatientListControl.LastName
                        ''Patient Portal
                        'frm.gblnPatientPortalEnabled = gblnPatientPortalEnabled
                        ''Patient Portal
                        frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))

                        _CurrentPatientID = frm.ReturnPatientID
                        If _CurrentPatientID > 0 Then

                            'Patient Portal
                            mdlGeneral.gblnPatientPortalSendActivationEmail = frm.gblnPatientPortalSendActivationEmail
                            mdlGeneral.gblnPatientPortalActivationEmailAlreadySent = frm.gblnPatientPortalActivationEmailAlreadySent
                            'SendPatientPortalEmails(_CurrentPatientID)
                            'Patient Portal

                            gnPatientID = _CurrentPatientID
                            oPatientListControl.PatientID = gnPatientID
                            oPatientListControl.SelectedPatientID = gnPatientID
                        End If

                        'code opti
                        If Not IsNothing(frm) Then
                            frm.Dispose()
                            frm = Nothing
                        End If

                        Dim isAdvanceDirectiveAllowed As Boolean = True
                        Dim PatientRegistrationTemp As New ClsPatientRegistrationDBLayer
                        If PatientRegistrationTemp.PatientStatus(_CurrentPatientID) = "Deceased" Then
                            If (objUserRights.DeceasedPatient = True) Then
                                isAdvanceDirectiveAllowed = True
                            Else
                                isAdvanceDirectiveAllowed = False
                            End If
                        End If
                        If Not IsNothing(PatientRegistrationTemp) Then
                            PatientRegistrationTemp.Dispose()
                            PatientRegistrationTemp = Nothing
                        End If
                        If isAdvanceDirectiveAllowed Then

                            'for Patient Advance Directive
                            Dim oDB As New gloStream.gloDataBase.gloDataBase
                            Dim _HasDirective As Int16 = 0
                            oDB.Connect(GetConnectionString)
                            _HasDirective = Val(oDB.ExecuteQueryScaler("SELECT ISnull(nPatientDirective,0) As nPatientDirective FROM patient WHERE npatientid = " & _CurrentPatientID & " "))
                            oDB.Disconnect()
                            oDB.Dispose()
                            oDB = Nothing
                            ''----
                            _blnHasAdvDirective = _HasDirective
                            ''---

                            If _blnHasAdvDirective = True Then
                                If gloEDocumentV3.eDocManager.eDocValidator.IsCategoryExists(0, gDMSCategory_PatientDirective, gClinicID) = False Then
                                    MessageBox.Show("DMS category for advance directive has not been set, Set the category", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    _blnHasAdvDirective = False
                                End If
                            End If

                            If _blnHasAdvDirective = True Then
                                If _CurrentPatientID = 0 Then
                                    _result = ShowEScanner(_CurrentPatientID)
                                Else
                                    If _blnHasAdvDirective = True Then
                                        If MessageBox.Show("Do you want to add more documents against patient directive?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                                            _result = ShowEScanner(_CurrentPatientID)
                                        End If
                                    Else
                                        _result = ShowEScanner(_CurrentPatientID)
                                    End If
                                End If
                            Else
                                _result = False
                                '-----------
                            End If
                        End If
                        PatientRegistration = New ClsPatientRegistrationDBLayer
                        'for Patient Reg Advance Directive
                        If (oPatientListControl.PatientID = 0) Then
                            If (_result = False) Then
                                'update advanced directive flag to false
                                PatientRegistration.UpdateAdvDirective(_CurrentPatientID)
                            End If
                        Else
                            If _blnHasAdvDirective = True Then
                            Else
                                If (_result = False) Then
                                    'update advanced directive flag to false
                                    PatientRegistration.UpdateAdvDirective(_CurrentPatientID)
                                End If
                            End If
                        End If
                        ''
                        If Not IsNothing(PatientRegistration) Then
                            PatientRegistration.Dispose()
                            PatientRegistration = Nothing
                        End If
                        oPatientListControl.FillPatients()
                        Call ShowPatientAllDetails(gnPatientID, , True)
                    Else
                        MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    End If


                Case "View Rx Eligibility"
                    'Break the Glass
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                    'Break the Glass
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Eligibility, gloAuditTrail.ActivityType.Load, "View Eligibility Clicked", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                    Dim oClsRxHubInterface As New ClsRxHubInterface()
                    'Dim oEligibilityCheck As New clsEligibilityCheckDBLayer()

                    '30-Apr-13 Aniket: Resolving Memory Leaks
                    Dim dt As DataTable = Nothing
                    Try
                        dt = oClsRxHubInterface.Get271EligibilityResponseInformation(gnPatientID)
                        ' oEligibilityCheck.GetEligiblityInformation(gnPatientID)
                        If Not IsNothing(dt) Then
                            If dt.Rows.Count > 0 Then
                                Dim ofrm As New frmViewEligiblityInformation(dt, False)
                                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Eligibility, gloAuditTrail.ActivityType.View, "View Eligibility Responce", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                                ofrm.ShowInTaskbar = False
                                ofrm.StartPosition = FormStartPosition.CenterParent
                                ofrm.ShowDialog(IIf(IsNothing(ofrm.Parent), Me, ofrm.Parent))
                                'code opti
                                If Not IsNothing(ofrm) Then
                                    ofrm.Dispose()
                                    ofrm = Nothing
                                End If
                            Else
                                If Not IsNothing(oClsRxHubInterface) Then
                                    oClsRxHubInterface.Dispose()
                                    oClsRxHubInterface = Nothing
                                End If
                                'If Not IsNothing(oEligibilityCheck) Then
                                '    oEligibilityCheck.Dispose()
                                '    oEligibilityCheck = Nothing
                                'End If
                                If Not IsNothing(dt) Then
                                    dt.Dispose()
                                    dt = Nothing
                                End If
                                Exit Sub
                            End If
                        Else
                            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Eligibility, gloAuditTrail.ActivityType.View, "Eligibility request valid only for 24 hours", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                            MessageBox.Show("The Eligibility request for this patient cannot be shown since request is valid only for 72 hours", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                            If Not IsNothing(oClsRxHubInterface) Then
                                oClsRxHubInterface.Dispose()
                                oClsRxHubInterface = Nothing
                            End If
                            'If Not IsNothing(oEligibilityCheck) Then
                            '    oEligibilityCheck.Dispose()
                            '    oEligibilityCheck = Nothing
                            'End If
                            If Not IsNothing(dt) Then
                                dt.Dispose()
                                dt = Nothing
                            End If
                            Exit Sub
                        End If
                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Eligibility, gloAuditTrail.ActivityType.Load, "View Eligibility clicked get error", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Failure, gloAuditTrail.SoftwareComponent.gloEMR)
                    Finally
                        If Not IsNothing(oClsRxHubInterface) Then
                            oClsRxHubInterface.Dispose()
                            oClsRxHubInterface = Nothing
                        End If
                        'If Not IsNothing(oEligibilityCheck) Then
                        '    oEligibilityCheck.Dispose()
                        '    oEligibilityCheck = Nothing
                        'End If
                        If Not IsNothing(dt) Then
                            dt.Dispose()
                            dt = Nothing
                        End If
                    End Try

                Case "YesLab"
                    'Break the Glass
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                    'Break the Glass

                    'Chetan integrated for  YesLab functionality  on 26 oct 2010
                    SetYesLab(True)
                Case "Cases"
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                    'If _CurrentPatientID = 0 Then

                    '    MessageBox.Show(Program.gRestrictedPatientMessage, _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    '    Return
                    'End If

                    Dim ofrmSetupCases As New frmSetupCases(gnPatientID)
                    ofrmSetupCases.ShowDialog(IIf(IsNothing(ofrmSetupCases.Parent), Me, ofrmSetupCases.Parent))
                    ''SLR Free ofrmSetupCases
                    ofrmSetupCases.Close()
                    ofrmSetupCases.Dispose()
                    ofrmSetupCases = Nothing
                    If SelectedPatientDetail = PatientDetails.patientCases Then
                        FillCases(gnPatientID)
                    End If
                Case "Amendments"
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                    Dim ofrmAmendmentsSetup As New frmAmendmentsSetup(gnPatientID, 0)
                    ofrmAmendmentsSetup.ShowDialog(IIf(IsNothing(ofrmAmendmentsSetup.Parent), Me, ofrmAmendmentsSetup.Parent))
                    ''SLR Free ofrmAmendmentsSetup
                    ofrmAmendmentsSetup.Close()
                    ofrmAmendmentsSetup.Dispose()
                    ofrmAmendmentsSetup = Nothing
                    ShowPendingAmedmentsAlert(gnPatientID)
            End Select
            If Not IsNothing(cMnuPatient) Then
                cMnuPatient.Dispose()
                cMnuPatient = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString)
        Finally
            _isShowDialogueForm = False
        End Try

    End Sub


    Public Sub SetButtonsOnOff()
        'Integrated by Chetan - to implement 'lock status' functionality as on 05 Oct 2010
        If IsAccess(True, , True) = False Then

            tlbbtn_Calender.Enabled = False
            tlbbtn_FormGallery.Enabled = False
            tlbbtn_History.Enabled = False
            tlbbtn_LabOrders.Enabled = False
            tlbbtn_Microphone.Enabled = False
            tlbbtn_ModifyPatient.Enabled = False
            tlbbtn_NewExam.Enabled = False
            tlbbtn_Orders.Enabled = False
            tlbbtn_PastExam.Enabled = False
            tlbbtn_PatientSynopsis.Enabled = False
            tlbbtn_Prescription.Enabled = False
            tlbbtn_RxHub.Enabled = False
            tlbbtn_ScanCard.Enabled = False
            tlbbtn_ScanDocs.Enabled = False
            tlbbtn_UnFinishedExams.Enabled = False
            tlbbtn_Vitals.Enabled = False
            tlbbtn_gloLabOrders.Enabled = False
            tlbbtn_GenerateCCD.Enabled = False
            tlbbtn_Timeline.Enabled = False
            tlbbtnSaveCDS.Enabled = False
            bIsLockChart = True
            tlbbtn_Inbox.Enabled = False

        Else
            bIsLockChart = False

            tlbbtn_Calender.Enabled = True
            tlbbtn_FormGallery.Enabled = True
            tlbbtn_History.Enabled = True
            tlbbtn_LabOrders.Enabled = True
            tlbbtn_Microphone.Enabled = True
            tlbbtn_ModifyPatient.Enabled = True
            tlbbtn_NewExam.Enabled = True
            tlbbtn_Orders.Enabled = True
            tlbbtn_PastExam.Enabled = True
            tlbbtn_PatientSynopsis.Enabled = True
            tlbbtn_Prescription.Enabled = True
            tlbbtn_ScanCard.Enabled = True
            tlbbtn_ScanDocs.Enabled = True
            tlbbtn_Sechedule.Enabled = True
            tlbbtn_UnFinishedExams.Enabled = True
            tlbbtn_Vitals.Enabled = True
            tlbbtn_gloLabOrders.Enabled = True
            tlbbtn_GenerateCCD.Enabled = True
            tlbbtn_Timeline.Enabled = True
            tlbbtnSaveCDS.Enabled = True
            'Developer:  Pradeep()
            'Date:12/22/2011
            'Bug ID/PRD Name/Salesforce Case: 17379
            'Reason:the eligiblity was remaining disabled 
            tlbbtn_RxHub.Enabled = True
            tlbbtn_Inbox.Enabled = True
            ''Show the "RxElig" button enabled since we are going to use patient info instead of insurance subscriber info
            'Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)
            'Dim dt_ins As DataTable = Nothing
            'Try
            '    dt_ins = ogloPatient.getPatientInsurances(gnPatientID)

            '    If Not IsNothing(dt_ins) Then
            '        If dt_ins.Rows.Count > 0 Then
            '            If dt_ins.Rows(0)("SubFName") = "" Or dt_ins.Rows(0)("SubLName") = "" Or dt_ins.Rows(0)("sSubscriberGender") = "" Or dt_ins.Rows(0)("SubscriberZip") = "" Or dt_ins.Rows(0)("dtDOB").ToString = "" Then
            '                Me.Cursor = Cursors.Default
            '                tlbbtn_RxHub.Enabled = False
            '            Else
            '                tlbbtn_RxHub.Enabled = True
            '            End If

            '        Else
            '            tlbbtn_RxHub.Enabled = False
            '        End If
            '    Else
            '        Me.Cursor = Cursors.Default
            '        tlbbtn_RxHub.Enabled = False
            '    End If
            'Catch ex As Exception
            '    'code opti
            '    If Not IsNothing(dt_ins) Then
            '        dt_ins.Dispose()
            '        dt_ins = Nothing
            '    End If
            '    If Not IsNothing(ogloPatient) Then
            '        ogloPatient.Dispose()
            '        ogloPatient = Nothing
            '    End If
            'End Try
            SetCDSButtonOnOff()
        End If
        SetLicenseModule()
    End Sub

    Public Sub SetCDSButtonOnOff()
        'Dim objSettings As New clsSettings
        'Dim Is_CDS_On As Boolean = objSettings.IsCDSEnabledForSelectedPatient(gnPatientID)

        'objSettings.Dispose() : objSettings = Nothing
        '15-Dec-15 Aniket: Resolving Bug #91814: gloEMR > Past Exam - Application takes time to open Past exam from dashboard
        tlbbtnSaveCDS.Enabled = False 'Is_CDS_On
        mnuViewCDSFiles.Enabled = False 'Is_CDS_On
    End Sub

    'Voice break resolved by making function shared. 20110120
    'Public Shared Function IsAccess(Optional ByVal bSkpMsg As Boolean = False, Optional ByVal nPatientID As Long = 0, Optional ByVal AllowScreenAccess As Boolean = False) As Boolean
    '    'Integrated by Chetan - to show message when menu items clicked as on 05 Oct 2010
    '    'Check Patient Status
    '    'To Pass nPatientID from Synopsis form
    '    If nPatientID = 0 Then
    '        nPatientID = gnPatientID
    '    End If
    '    IsAccess = True
    '    If gbAllowEmergencyAccess = False Then
    '        IsAccess = CheckPatientStatus(nPatientID, , , bSkpMsg, AllowScreenAccess)
    '    End If
    '    Return IsAccess
    'End Function
    Public Shared Function IsAccess(Optional ByVal bSkpMsg As Boolean = False, Optional ByVal nPatientID As Long = 0, Optional ByVal AllowScreenAccess As Boolean = False, Optional ByVal bGetLatestStatus As Boolean = False) As Boolean
        'Integrated by Chetan - to show message when menu items clicked as on 05 Oct 2010
        'Check Patient Status
        'To Pass nPatientID from Synopsis form

        If nPatientID = 0 AndAlso gnPatientID = 0 Then  ''added for bugid 71304
            Return False
        End If

        If nPatientID = 0 Then
            nPatientID = gnPatientID
        End If
        IsAccess = True
        If gbAllowEmergencyAccess = False Then
            ' IsAccess = CheckPatientStatus(nPatientID, , , bSkpMsg, AllowScreenAccess)
            If bGetLatestStatus = False Then   'if Flag is true than it will take selected patient status
                IsAccess = CheckPatientStatus_new(gstrPatientStatus, bSkpMsg, AllowScreenAccess)
            Else
                Dim oclsPatReg As New ClsPatientRegistrationDBLayer
                Dim _sPatientStatus As String = oclsPatReg.PatientStatus(nPatientID, "").ToString()
                IsAccess = CheckPatientStatus_new(_sPatientStatus, bSkpMsg, AllowScreenAccess)
                oclsPatReg.Dispose()
                oclsPatReg = Nothing
            End If

        End If

        Return IsAccess
    End Function
    ''' <summary>
    ''' To Open the Patient Alert Form 
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub SetPatientAlerts()
        If IsAccess(False) = False Then
            Exit Sub
        End If
        Dim frm As New frmPatientAlerts(gnPatientID)
        frm.ShowInTaskbar = False
        frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
        'code opti By mitesh
        If Not IsNothing(frm) Then
            frm.Dispose()
            frm = Nothing
        End If
        Call ShowPatientAlerts()
    End Sub

    Private Sub SetSurgicalAlerts(Optional ByVal strAlert As String = "", Optional ByVal strIMAlert As String = "")
        Try
            Dim oDB As New gloStream.gloDataBase.gloDataBase
            Dim _HasDirective As Int16 = 0
            Dim dtUser As DataTable
            Dim strSQL As String
            oDB.Connect(GetConnectionString)
            strSQL = " SELECT Settings.sSettingsValue As UserID, User_MST.sLoginName As UserName " _
                    & " FROM  Settings INNER JOIN User_MST ON Settings.sSettingsValue = User_MST.nUserID " _
                    & " WHERE     (Settings.sSettingsName = 'Surgical User') "
            dtUser = oDB.ReadQueryDataTable(strSQL)
            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing
            If IsNothing(dtUser) = True Then
                MessageBox.Show("No Surgical Users have been associated, please configure using gloEMR Admin", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                Exit Sub
            ElseIf dtUser.Rows.Count <= 0 Then
                MessageBox.Show("No Surgical Users have been associated, please configure using gloEMR Admin", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                If Not IsNothing(dtUser) Then
                    dtUser.Dispose()
                    dtUser = Nothing
                End If
                Exit Sub
            ElseIf dtUser.Rows.Count > 0 Then
                'Send the Task to The Users
                Dim strSubject As String = "Surgical Alert"
                Dim strNote As String = "Surgical Alert"
                Dim strUser As String = gstrLoginName
                Dim dtDueDate As DateTime = Now
                Dim dtTaskDate As DateTime = Now
                Dim sPriority As String = "High"
                dtDueDate = Format(dtDueDate, "MM/dd/yyyy") & " " & Format(dtDueDate, "Short Time")

                dtTaskDate = Format(dtTaskDate, "MM/dd/yyyy") & " " & Format(dtTaskDate, "Short Time")

                Dim oTask As New gloTaskMail.Task
                Dim ogloTask As New gloTaskMail.gloTask(GetConnectionString())
                ' Dim oTaskAssign As gloTaskMail.TaskAssign()   'SLR: new is not needed hre since it is allocated inside for

                oTask.TaskID = 0
                oTask.UserID = gnLoginID
                oTask.DateCreated = gloDateMaster.gloDate.DateAsNumber(Convert.ToString(dtTaskDate))
                oTask.StartDate = gloDateMaster.gloDate.DateAsNumber(Convert.ToString(dtTaskDate))
                oTask.DueDate = gloDateMaster.gloDate.DateAsNumber(Convert.ToString(dtDueDate))
                oTask.Subject = strSubject
                oTask.PriorityID = 3 ''High
                oTask.Notes = strNote
                oTask.PatientID = gnPatientID
                Dim cnstr As String = GetConnectionString()
                For i As Int16 = 0 To dtUser.Rows.Count - 1
                    Dim oTaskAssign = New gloTaskMail.TaskAssign(cnstr)

                    oTaskAssign.AssignFromID = gnLoginID
                    oTaskAssign.AssignFromName = gstrLoginName
                    oTaskAssign.AssignToID = dtUser.Rows(i)("UserID")
                    If oTaskAssign.AssignFromID = oTaskAssign.AssignToID Then
                        oTaskAssign.SelfAssigned = gloTasksMails.Common.SelfAssigned.Self
                        oTaskAssign.AcceptRejectHold = gloTasksMails.Common.AcceptRejectHold.Accept
                    Else
                        oTaskAssign.SelfAssigned = gloTasksMails.Common.SelfAssigned.Assigned
                        oTaskAssign.AcceptRejectHold = gloTasksMails.Common.AcceptRejectHold.Hold
                    End If
                    oTaskAssign.AssignToName = dtUser.Rows(i)("UserName")
                    oTask.Assignment.Add(oTaskAssign)
                    'Code opti
                    If Not IsNothing(oTaskAssign) Then
                        oTaskAssign.Dispose()
                        oTaskAssign = Nothing
                    End If
                Next

                'Task Assign Properties
                'Task Progress Values
                oTask.Progress.TaskID = 0
                oTask.Progress.Complete = 0
                oTask.Progress.StatusID = 1 ''Not Started
                oTask.Progress.DateTime = Now.Date
                oTask.Progress.ClinicID = gnClinicID
                ogloTask.Add(oTask)
                'Code opti
                If Not IsNothing(dtUser) Then
                    dtUser.Dispose()
                    dtUser = Nothing
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ShowPatientAlerts(Optional ByVal strAlert As String = "", Optional ByVal strIMAlert As String = "")

        Dim oPatReg As New ClsPatientRegistrationDBLayer()
        Dim oclsAlert As New gloStream.gloAlert.Alert

        '30-Apr-13 Aniket: Resolving Memory Leaks
        Dim _oCriterias As Collection = Nothing
        
        Try
            If IsAccess(True) = False Then
                txtPatientAlert.Text = ""
                Exit Sub
            End If

            '31-Mar-17 Aniket: Resolving Bug #104847: gloEMR: Patient Dashboard: The application giving exception on patient switching while Loging out the application
            If IsNothing(dvAllSettings) = True Then
                Exit Sub
            End If

            Dim _Status As String = oPatReg.PatientStatus(gnPatientID, gstrPatientCode)
            Dim _AlertCounter As Int16 = 0
            Dim _showDMAlert As Boolean = False
            Dim strDMAlert As String = ""

            pnlPatientAlert.Visible = False
            txtPatientAlert.BackColor = Color.White
            txtPatientAlert.ForeColor = Color.FromArgb(21, 66, 139)


            '01-Dec-14 Aniket: Reduce database trip for gettings settings
            dvAllSettings.RowFilter = "sName = 'ShowDMAlert'"

            If dvAllSettings.Count > 0 Then

                If dvAllSettings(0)("sValue") <> "" Then
                    _showDMAlert = dvAllSettings(0)("sValue") 'dt.Rows(0)("sSettingsValue")
                Else
                    _showDMAlert = False
                End If

            End If

            dvAllSettings.RowFilter = Nothing

            If strAlert = "" Then
                '30-Apr-13 Aniket: Resolving Memory Leaks
                ''patientid added for incident CAS-09269-N7F7S6
                Dim ColAlert As Collection
                ColAlert = oclsAlert.GetAlert(gstrPatientCode, gloStream.gloAlert.Alert.Alert_Type.General, gloStream.gloAlert.Alert.Alert_Status.Active, gnPatientID)
                If ColAlert.Count < 1 Then
                    pnlPatientAlert.Visible = False
                End If

                If ColAlert.Count > 0 Then
                    If ColAlert.Item(2) = 1 Then
                        strAlert = "" & ColAlert.Item(1).ToString
                        _AlertCounter = _AlertCounter + 1
                    End If
                End If
            End If

            If _Status <> "Deceased" Then
                Dim oDMSingleProcess As New gloStream.DiseaseManagement.DiseaseManagement
                strIMAlert = oclsAlert.PatientIMAlerts(gnPatientID)
                _oCriterias = oDMSingleProcess.FindDMCriteriaOFPatient(gnPatientID, gnClinicID)
                If (IsNothing(_oCriterias) = False) Then


                    If _showDMAlert = True AndAlso objUserRights.ShowDMAlert Then

                        Dim _strNewDmAlert As String = ""

                        _strNewDmAlert = GetDMAlert(gnPatientID)
                        ' _oCriterias = oDMSingleProcess.FindGuidelinesForSinglePatient(gnPatientID)
                        Dim oPatTriggers As DataTable
                        oPatTriggers = oDMSingleProcess.FindPatientSpecificTriggers(gnPatientID)
                        If Not oPatTriggers Is Nothing Then
                            If _oCriterias.Count > 0 Then
                                For _cnt As Int32 = 0 To oPatTriggers.Rows.Count - 1
                                    Dim oPatientCriterias As DataTable
                                    oPatientCriterias = oDMSingleProcess.FindPatientSpecificDueTriggers(gnPatientID, oPatTriggers.Rows(_cnt)("DM_nCriteriaID"))
                                    If Not oPatientCriterias Is Nothing Then
                                        ''to remove the guidelines from the Collectiont that are not due based on the due values
                                        Dim nDueValue As Int32 = 0
                                        For _row As Int32 = 0 To oPatientCriterias.Rows.Count - 1
                                            Dim TransId As Int64
                                            Dim bIsRecurring As Boolean = False
                                            TransId = oPatientCriterias.Rows(_row)("DM_TransId")
                                            bIsRecurring = oPatientCriterias.Rows(_row)("DM_bIsRecurring")

                                            If Not oDMSingleProcess.CheckDueGuidelines(TransId, bIsRecurring, gnPatientID) Then
                                                nDueValue += 1
                                            End If
                                        Next
                                        If nDueValue = oPatientCriterias.Rows.Count Then
                                            For _myindex As Int32 = _oCriterias.Count To 1 Step -1
                                                If _oCriterias(_myindex) = oPatTriggers.Rows(_cnt)("DM_nCriteriaID") Then
                                                    _oCriterias.Remove(_myindex)
                                                End If
                                            Next
                                        End If
                                        oPatientCriterias.Dispose()
                                        oPatientCriterias = Nothing
                                    End If

                                Next
                            Else
                                For _cnt As Int32 = 0 To oPatTriggers.Rows.Count - 1
                                    Dim oPatientCriterias As DataTable
                                    oPatientCriterias = oDMSingleProcess.FindPatientSpecificDueTriggers(gnPatientID, oPatTriggers.Rows(_cnt)("DM_nCriteriaID"))
                                    If Not oPatientCriterias Is Nothing Then
                                        ''to remove the guidelines from the Collectiont that are not due based on the due values
                                        Dim nDueValue As Int32 = 0
                                        For _row As Int32 = 0 To oPatientCriterias.Rows.Count - 1
                                            Dim TransId As Int64
                                            Dim bIsRecurring As Boolean = False
                                            TransId = oPatientCriterias.Rows(_row)("DM_TransId")
                                            bIsRecurring = oPatientCriterias.Rows(_row)("DM_bIsRecurring")

                                            If oDMSingleProcess.CheckDueGuidelines(TransId, bIsRecurring, gnPatientID) Then
                                                nDueValue += 1
                                            End If

                                        Next
                                        If nDueValue = oPatientCriterias.Rows.Count AndAlso nDueValue <> 0 Then
                                            _oCriterias.Add(CType(oPatTriggers.Rows(_cnt)("DM_nCriteriaID"), Int64))
                                        End If
                                        oPatientCriterias.Dispose()
                                        oPatientCriterias = Nothing
                                    End If

                                Next
                            End If
                            oPatTriggers.Dispose()
                            oPatTriggers = Nothing
                        End If
                        If IsNothing(_oCriterias) = False Then
                            Dim strCatId As String = String.Empty
                            For i As Integer = 1 To _oCriterias.Count
                                If i = 1 Then
                                    'Added by Mayuri:20100212-Case NO:GLO2009-0004064-DM - DM msg in patient alert not correct
                                    strCatId = _oCriterias(i)
                                Else
                                    strCatId = strCatId & ", " & _oCriterias(i)
                                End If
                            Next
                            ''added for patient switching optimization  
                            If strCatId <> String.Empty Then
                                Dim dtdmalert As DataTable = oDMSingleProcess.GetCriteriaMessages(strCatId)
                                strCatId = Nothing
                                If Not IsNothing(dtdmalert) Then
                                    For Each dr As DataRow In dtdmalert.Rows
                                        strDMAlert &= Convert.ToString(dr(0)) & ","
                                    Next
                                    dtdmalert.Dispose()
                                    dtdmalert = Nothing
                                End If
                                If (strDMAlert.Length > 0) Then
                                    strDMAlert = strDMAlert.Substring(0, strDMAlert.Length - 1)
                                End If
                            End If

                        End If

                        If strDMAlert.Length > 0 Then
                            isOldDmAlertPresent = True
                        Else
                            isOldDmAlertPresent = False
                        End If

                        If _strNewDmAlert.Length > 0 AndAlso strDMAlert.Length > 0 Then
                            strDMAlert = strDMAlert & "," & _strNewDmAlert
                        Else
                            If _strNewDmAlert.Length > 0 Then
                                strDMAlert = _strNewDmAlert
                            End If
                        End If

                        If strDMAlert.Length > 0 Then
                            strDMAlert = "DM Alert: " + strDMAlert
                            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.DM_RuleSetup, gloAuditTrail.ActivityCategory.DMAlert, gloAuditTrail.ActivityType.DMAlertTriggered, "Trigger " + strDMAlert, gnPatientID, 0, gnPatientProviderID, gloAuditTrail.ActivityOutCome.Success)
                        End If

                    End If
                End If
                If IsNothing(oDMSingleProcess) = False Then
                    oDMSingleProcess.Dispose()
                    oDMSingleProcess = Nothing
                End If

            End If '' END VALIDATION PATIENT STATUS ''

            If _oCriterias IsNot Nothing Then ''change condition for bugid 75117 
                If _oCriterias.Count > 0 Then
                    isOldDmAlertPresent = True
                Else
                    isOldDmAlertPresent = False
                End If
            Else
                isOldDmAlertPresent = False



            End If
            If strAlert = "" Then
                If strIMAlert <> "" Then
                    strAlert = "" & strIMAlert
                    _AlertCounter = _AlertCounter + 1
                    If strDMAlert <> "" Then
                        strAlert = strAlert & vbCrLf & "" & strDMAlert
                        _AlertCounter = _AlertCounter + 1
                    End If
                ElseIf strDMAlert <> "" Then
                    strAlert = "" & strDMAlert
                    _AlertCounter = _AlertCounter + 1
                Else
                    strAlert = ""
                End If
            Else
                If strIMAlert = "" AndAlso strDMAlert <> "" Then
                    strAlert = strAlert & vbCrLf & "" & strDMAlert
                    _AlertCounter = _AlertCounter + 1
                ElseIf strIMAlert <> "" AndAlso strDMAlert = "" Then
                    strAlert = strAlert & vbCrLf & "" & strIMAlert
                    _AlertCounter = _AlertCounter + 1
                ElseIf strIMAlert <> "" AndAlso strDMAlert <> "" Then
                    strAlert = strAlert & vbCrLf & "" & strIMAlert & vbCrLf & "" & strDMAlert
                    _AlertCounter = _AlertCounter + 1
                End If
            End If

            Dim oDB As New gloStream.gloDataBase.gloDataBase
            Dim _HasDirective As Int16 = 0
            oDB.Connect(GetConnectionString)
            _HasDirective = Val(oDB.ExecuteQueryScaler("SELECT nPatientDirective FROM patient WHERE npatientid = " & gnPatientID & " "))
            oDB.Disconnect()
            'Code opti By mitesh
            oDB.Dispose()
            oDB = Nothing

            If _HasDirective > 0 Then
                If _AlertCounter > 0 Then
                    strAlert = strAlert & vbCrLf & "This Patient has Advance directive."
                ElseIf _AlertCounter = 0 Then
                    strAlert = strAlert & "This Patient has Advance directive."
                End If

            End If

            '' Workers Comp
            oDB = New gloStream.gloDataBase.gloDataBase

            '30-Apr-13 Aniket: Resolving Memory Leaks
            Dim dtWorkersComp As DataTable

            oDB.Connect(GetConnectionString)
            dtWorkersComp = oDB.ReadQueryDataTable("SELECT ISNULL(bIsWorkersComp,0) AS bIsWorkersComp, ISNULL(sWorkersCompClaimNo,'') AS sWorkersCompClaimNo  FROM patient WHERE npatientid = " & gnPatientID & " ")
            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing
            If IsNothing(dtWorkersComp) = False Then
                If dtWorkersComp.Rows.Count > 0 Then
                    If dtWorkersComp.Rows(0)("bIsWorkersComp") <> 0 Then
                        '' Workers Comp Claim No is Avilable
                        If _AlertCounter > 0 Then
                            strAlert = strAlert & vbCrLf & "This Patient has Workers Comp with the Claim No- '" & dtWorkersComp.Rows(0)("sWorkersCompClaimNo") & "'"
                        ElseIf _AlertCounter = 0 Then
                            strAlert = strAlert & "This Patient has Workers Comp with the Claim No- '" & dtWorkersComp.Rows(0)("sWorkersCompClaimNo") & "'"
                        End If

                        txtPatientAlert.BackColor = Color.White
                        txtPatientAlert.ForeColor = Color.FromArgb(21, 66, 139)
                    End If
                End If
            End If
            'code opti
            If Not IsNothing(dtWorkersComp) Then
                dtWorkersComp.Dispose()
                dtWorkersComp = Nothing
            End If

            If strAlert <> "" Then
                txtPatientAlert.Text = strAlert
                pnlPatientAlert.Visible = True
            Else
                pnlPatientAlert.Visible = False
                txtPatientAlert.Text = ""
            End If

            If Not IsNothing(oPatReg) Then
                oPatReg.Dispose()
                oPatReg = Nothing
            End If
            oclsAlert = Nothing ''slr free oclsAlert 

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub btnClosePatientAlert_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnClosePatientAlert.Click
        pnlPatientAlert.Visible = False
    End Sub

    Private Sub btnModifyPatientAlert_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnModifyPatientAlert.Click
        Try
            Call SetPatientAlerts()
        Catch ex As Exception

        End Try
    End Sub

#End Region

#Region " Exam "

    Private Sub NewExam(Optional ByVal SwitchOffSavingFlags As Boolean = False)
        'SwitchOffSavingFlags argument Added by Ashish Tamhane on 29-10-2014
        'to autosave newly created Exam from Right Click -> New Exam

        Dim strMessage As String = ""
        Dim Result As DialogResult


        Try
            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                'To check exeception related to word
                If CheckWordForException() = False Then
                    Exit Sub
                End If

                If gnLoginProviderID <> 0 Then
                    Dim objProvider As New clsProvider
                    Dim nPatientProvider As Int64
                    Dim strPatientProviderName As String

                    nPatientProvider = objProvider.GetPatientProvider(gnPatientID)

                    If nPatientProvider <> 0 Then
                        Dim objExam2 As New clsPatientExams
                        strPatientProviderName = objExam2.GetProvidernameforExam(nPatientProvider)
                        objExam2.Dispose()
                        objExam2 = Nothing
                    Else
                        strPatientProviderName = ""
                    End If

                    strMessage = GetPatientExamProviderMismatchMessage(strPatientProviderName) ' "This patient belongs to '" & Trim(strPatientProviderName) & "'." & vbCrLf & vbCrLf & "Do you want to change the Patients default Provider?" & vbCrLf & vbCrLf & "[This can also be done from the Patient Demographics screen]."

                    If gnLoginProviderID <> nPatientProvider Then
                        Result = MessageBox.Show(strMessage, gstrMessageBoxCaption, MessageBoxButtons.YesNoCancel, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2)
                        If Result = Windows.Forms.DialogResult.Yes Then

                            If objProvider.ChangePatientProvider(gnPatientID, gnLoginProviderID) = True Then

                                '' Incident #00017037 : Patient Context Issue resolved
                                ''Refresh ProviderList on dashboard 
                                oPatientListControl.SelectProvider(gnLoginProviderID)




                            End If

                        ElseIf Result = Windows.Forms.DialogResult.No Then

                            '15-06-2011'Start'GLO2010-0007965 ''WLO - doctors voice tags arent availible if the provider on the exam changes
                            'gnSelectedProviderID = nPatientProvider
                            'End'GLO2010-0007965 ''WLO - doctors voice tags arent availible if the provider on the exam changes

                        ElseIf Result = Windows.Forms.DialogResult.Cancel Then
                            If Not IsNothing(objProvider) Then ''Slr free objprovider
                                objProvider.Dispose()
                                objProvider = Nothing
                            End If
                            Exit Sub
                        End If
                    End If

                    'Added by Amit to clear objects
                    objProvider.Dispose()
                    objProvider = Nothing
                    nPatientProvider = Nothing
                    strPatientProviderName = Nothing

                End If

                'Check Patient Status
                '30-Apr-13 Aniket: Resolving Memory Leaks
                Dim objResultExam As DataTable
                Dim objExam1 As New clsPatientExams

                objResultExam = objExam1.GetUnfinshedExams(gnPatientID)
                objExam1.Dispose()
                objExam1 = Nothing

                If Not objResultExam Is Nothing Then

                    strMessage = "Unfinished Exam(s) exists for the selected patient. Do you still want to open a New Exam?" & vbNewLine & vbNewLine & vbTab & "YES - To Open New Exam " & vbNewLine & vbNewLine & vbTab & "NO  - To Open the latest Unfinished Exam"

                    Result = MessageBox.Show(strMessage, gstrMessageBoxCaption, MessageBoxButtons.YesNoCancel, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2)
                    If Result = Windows.Forms.DialogResult.Yes Then
                        OpenNewExam(SwitchOffSavingFlags)
                    ElseIf Result = Windows.Forms.DialogResult.No Then

                        Dim nPastExamID As Long
                        Dim nVisitID As Long
                        Dim dtDOS As DateTime
                        Dim strExamName As String = ""
                        Dim strTemplateName As String = ""

                        If Not IsDBNull(objResultExam.Rows(0)("nExamID")) Then
                            nPastExamID = CType(objResultExam.Rows(0)("nExamID"), Int64)
                        End If
                        If Not IsDBNull(objResultExam.Rows(0)("nVisitID")) Then
                            nVisitID = CType(objResultExam.Rows(0)("nVisitID"), Int64)
                        End If
                        If Not IsDBNull(objResultExam.Rows(0)("dtDOS")) Then
                            dtDOS = CType(objResultExam.Rows(0)("dtDOS"), Date)
                        End If
                        If Not IsDBNull(objResultExam.Rows(0)("sExamName")) Then
                            strExamName = objResultExam.Rows(0)("sExamName").ToString
                        End If
                        If Not IsDBNull(objResultExam.Rows(0)("sTemplateName")) Then
                            strTemplateName = objResultExam.Rows(0)("sTemplateName")
                        End If
                        ShowPastExam(nPastExamID, gnPatientID, nVisitID, dtDOS.ToString(), strExamName, strTemplateName, False)

                        'Added by Amit to clear objects
                        nPastExamID = Nothing
                        nVisitID = Nothing
                        dtDOS = Nothing
                        strExamName = Nothing
                        strTemplateName = Nothing

                    End If
                Else
                    OpenNewExam(SwitchOffSavingFlags)
                End If
                'code opti
                If Not IsNothing(objResultExam) Then
                    objResultExam.Dispose()
                    objResultExam = Nothing
                End If
            Else
                'This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                'This IF statement is added by dipak on 20091109,This message will appear if patients are there in the grid i.e., if grid is not blank and no patient selected.
                If oPatientListControl.PatientCount > 0 Then
                    Me.Cursor = Cursors.Default
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If

            Me.Cursor = Cursors.Default

        Catch ex As Exception
            'Show Tool Bar Mahesh 20070424
            Me.pnlMainMenu.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        Finally

            'Added by Amit to clear objects
            strMessage = Nothing
            Result = Nothing

            'If Not IsNothing(objExam) Then
            '    objExam.Dispose()
            '    objExam = Nothing
            'End If

        End Try

        Me.Cursor = Cursors.Default
    End Sub

    Private Sub OpenNewExam(Optional ByVal SaveNewlyCreatedExam As Boolean = False)
        Windows.Forms.Cursor.Current = Cursors.WaitCursor

        Dim frm As New frmPatientExam(gnPatientID, gnVisitID)

        AddHandler frm.EntOpenMessage, AddressOf OpenMessage
        AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
        AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
        'AddHandler frm.EvntGenerateCDAFromPatientExam, AddressOf openCDA
        With frm
            .Hide()
            .IsNewExam = True
            'Added by Ashish Tamhane on 29-10-2014            
            .SwitchOffSavingFlags = SaveNewlyCreatedExam
            .TemplateName = _TemplateName
            .TemplateID = _TemplateID
            .blnModify = False
            .Text = "New Exam"
            .PatientID = gnPatientID
            .OpenExam()
            .Splitter2.Visible = True
            .MdiParent = Me
            .Show()
            'Added by Ashish Tamhane on 29-10-2014            
            If SaveNewlyCreatedExam Then
                .SaveExam(0, True)
            End If
            'Added by Ashish Tamhane on 29-10-2014            
            Me.pnlMainToolBar.Visible = False
            ShowHideMainMenu(False, False)

            If frm._blnOpenHistory = True Then
                .SendToBack()
            End If
        End With

        Windows.Forms.Cursor.Current = Cursors.Default
    End Sub

    Private Sub PastExam()
        Try


            If Trim(gstrPatientFirstName) <> "" Then

                'Break the Glass
                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If CheckWordForException() = False Then
                    Exit Sub
                End If

                Me.Cursor = Cursors.WaitCursor



                Dim frm As New frmPatientExam(gnPatientID, gnVisitID)

                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters

                With frm
                    .Hide()
                    .blnModify = True
                    .Text = "Past Exams"

                    Dim sender As Object = Nothing
                    Dim e As System.EventArgs = Nothing

                    .IsPastExam = True
                    .cmdPastExam_Click(sender, e)

                    .PatientID = gnPatientID

                    .pnlPastExam.Visible = True
                    '.chkShowPreview.Visible = True
                    .MdiParent = Me
                    .Show()

                    ShowHideMainMenu(False, False)
                    Me.pnlMainToolBar.Visible = False

                End With

                Me.Cursor = Cursors.Default
            Else
                'This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    Me.Cursor = Cursors.Default
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch ex As Exception
            Me.pnlMainToolBar.Visible = True
            MsgBox(ex.Message)

        End Try
        Me.Cursor = Cursors.Default
    End Sub

#End Region

#Region " Main ToolStrip Events"
    ''function added to view the last ten patients viewed by user
    Private Sub AddrecentPatient(ByVal PatID As Int64, ByVal UserID As Int64, ByRef hashtbl As Hashtable)
        Dim oDB As New gloEMRGeneralLibrary.gloEMRDatabase.DataBaseLayer
        Dim deletedpatid As Int64 = -1
        Dim _ProcName As String

        Try

            ''Retrieve the Image for Patient
            '_strSQL = "select iphoto,sGender from patient where npatientid=" & PatientID
            _ProcName = "gsp_InsertRecentPatientUserwise"
            With oDB
                .DBParametersCol.Clear()
                Dim oPara As gloEMRGeneralLibrary.gloEMRDatabase.DBParameter
                oPara = New gloEMRGeneralLibrary.gloEMRDatabase.DBParameter
                oPara.DataType = SqlDbType.BigInt
                oPara.Direction = ParameterDirection.Input
                oPara.Value = Convert.ToInt64(UserID)
                oPara.Name = "@UserID"
                .DBParametersCol.Add(oPara)
                oPara = Nothing


                oPara = New gloEMRGeneralLibrary.gloEMRDatabase.DBParameter
                oPara.DataType = SqlDbType.BigInt
                oPara.Direction = ParameterDirection.Input
                oPara.Value = PatID
                oPara.Name = "@PatientID"
                .DBParametersCol.Add(oPara)
                oPara = Nothing




            End With
            deletedpatid = oDB.GetDataValue(_ProcName)

            If (deletedpatid <> -1) Then
                If (hashtbl.Contains(deletedpatid)) Then
                    hashtbl.Remove(deletedpatid)
                End If
            End If


        Catch
        Finally
            If Not IsNothing(oDB) Then
                oDB.DBParametersCol.Clear()
                oDB.Dispose()
                oDB = Nothing
            End If
        End Try


    End Sub
    Private Sub tlbStripMain_ItemClicked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ToolStripItemClickedEventArgs) Handles tlbStripMain.ItemClicked

        Try
            _isShowDialogueForm = True

            RegisterMyHotKey()
            If ((e.ClickedItem.Tag = "Scan Card") OrElse (e.ClickedItem.Tag = "CDA") OrElse (e.ClickedItem.Tag = "Patient Synopsis") OrElse (e.ClickedItem.Tag = "RxElig")) Then
                If (gloUserControlLibrary.gloUC_PatientStrip.hshPatData Is Nothing) Then
                    gloUserControlLibrary.gloUC_PatientStrip.hshPatData = New Hashtable
                End If
                Dim obj As Object = gloUserControlLibrary.gloUC_PatientStrip.hshPatData(gnPatientID)
                If obj Is Nothing Then
                    gloUserControlLibrary.gloUC_PatientStrip.hshPatData.Add(gnPatientID, gloGlobal.gloPMGlobal.UserID)
                    AddrecentPatient(gnPatientID, gloGlobal.gloPMGlobal.UserID, gloUserControlLibrary.gloUC_PatientStrip.hshPatData)
                End If

            End If

            Select Case Trim(e.ClickedItem.Tag)
                Case "Microphone"
                    Me.Cursor = Cursors.WaitCursor
                    'code commented as the logic for mic on/off has changed
                    Try
                        If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff Then
                            DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn
                        Else
                            DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                        End If
                        Me.Cursor = Cursors.Default
                    Catch ex As Exception
                        MessageBox.Show("Error Changing Microphone State", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                        Me.Cursor = Cursors.Default
                        Exit Sub
                    End Try
                Case "LockScreen"
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen By Button Press", gloAuditTrail.ActivityOutCome.Success)
                    Call LockScreen()
                Case "New Patient"
                    mnuPatientRegistration_Click(sender, e)
                    SetButtonsOnOff()
                    SetYesLab()
                Case "Modify Patient"
                    Call mnuModifyPatient_Click(sender, e)
                    SetButtonsOnOff()
                    SetYesLab()
                Case "Vitals"
                    mnuPatientVitals_Click(sender, e)
                Case "History"
                    mnuPatientHistory_Click(sender, e)
                Case "Prescription & Medication"
                    mnuPatientPrescription_Click(sender, e)
                Case "Medication"
                    mnuPatientMedication_Click(sender, e)
                Case "Order Templates"
                    mnuPatient_RadiologyOrders_Click(sender, e)
                    '''' call the function to connect with  gloLab interface 
                Case "Orders & Results" 'Added by madan on 20100625-- modified from lab orders to labs
                    CallgloLab()
                    '''' End of changes by Abhijeet
                    '' end of code By Abhijeet on date 20100423 for changing Tag name of buttons
                Case "New Exam"
                    Call NewExam()
                Case "Past Exams"
                    Call PastExam()
                Case "Referrals"
                    mnuView_Referrals_Click(sender, e)
                Case "ICD9 Association"
                    mnuView_FormGallery_Click(sender, e)
                Case "Calendar"
                    If IsAccess(False, , True) = False Then
                        Exit Sub
                    End If
                    pnlNav_Calendar_Click(sender, e)

                Case "Schedule"
                    '' IsAccess() Check commented, as Schedule is not related to Patient.
                    '' Form should be displayed regardless of patient status. 
                    '' GLO2010-0009966 : Can't access schedule when deceased patient is selected

                    Dim oSchedule As New gloAppointmentScheduling.gloSchedule(GetConnectionString())
                    oSchedule.ShowScheduleView(Me)

                    pnlMainToolBar.Visible = False
                    ShowHideMainMenu(False, False)

                    If Not IsNothing(oSchedule) Then
                        oSchedule.Dispose()
                        oSchedule = Nothing
                    End If

                Case "Tasks"
                    mnuView_Tasks_Click(sender, e)
                    'Added Code Changes for View OBVitals
                Case "OB Vitals"
                    mnuView_OBVitals_Click(sender, e)
                Case "Messages"
                    mnuView_Messages_Click(sender, e)
                Case "Scan Documents"
                    Call Scan_Documents()
                Case "RCM Documents"
                    Call RCM_Documents()
                Case "Documents"
                    Call DMS_ChartPull()
                Case "Settings"
                    mnuSettings_Click(sender, e)
                Case "Voice Center"
                    Try
                        mnuToolsVoiceCenter_Click(sender, e)
                    Catch ex As Exception

                    End Try
                Case "Doctor Speaker Configuration"
                    Try
                        mnuDoctorSpeakerConfiguration_Click(sender, e)
                    Catch ex As Exception
                    End Try
                Case "Unfinished Exams"
                    If IsAccess(False, , True) = False Then
                        Exit Sub
                    End If
                    mnuReportUnfinishedExam_Click(sender, e)

                Case "Form Gallery"
                    If IsAccess(False, , True) = False Then
                        Exit Sub
                    End If

                    'Bug No-415,"Add New Form" window should open on click at "Form Gallery" on DashBoard.
                    'View Form Gallery should not open.
                    'mnuView_FormGallery_Click(sender, e)

                    mnuPatient_FormGallery_Click(sender, e)

                Case "Scan Card"        ''Scan Card For New Patient

                    If gnPatientID <= 0 Then
                        If oPatientListControl.PatientCount > 0 Then
                            MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                            Exit Sub
                        Else
                            Exit Sub
                        End If
                    End If

                    If IsAccess(False, , True) = False Then
                        Exit Sub
                    End If

                    If gblnProviderDisable = True Then
                        If ShowAssociateProvider(gnPatientID, Me) = False Then
                            Exit Sub
                        Else
                            oPatientListControl.FillPatients()
                        End If
                    End If

                    Dim _CardRootPath As String = ""
                    _CardRootPath = System.Windows.Forms.Application.StartupPath

                    Dim sc_activeWindow As IntPtr = gloWord.WordDialogBoxBackgroundCloser.GetForegroundWindow()
                    Dim oCardImage As New gloCardScanning.frmCardImage(GetConnectionString(), gnPatientID, sc_activeWindow)
                    oCardImage.StartPosition = FormStartPosition.CenterParent
                    oCardImage.ShowDialog(IIf(IsNothing(oCardImage.Parent), Me, oCardImage.Parent))
                    If Not IsNothing(oCardImage) Then
                        oCardImage.Dispose()
                        oCardImage = Nothing
                    End If
                    FillCardInformation()
                    FillDemographicInformation()


                Case "RxElig" 'RxHub

                    ProcessRxEligibility(gnPatientID)

                    Me.Cursor = Cursors.Default
                Case "CCD"
                    Try
                        If gnPatientID <= 0 Then
                            If oPatientListControl.PatientCount > 0 Then
                                MessageBox.Show("Select patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Exit Sub
                            Else
                                Exit Sub
                            End If
                        End If
                        Dim objfrm As New frmCCDGenerateList(gnPatientID)
                        With objfrm
                            .WindowState = FormWindowState.Normal
                            ''Added on 20100727 by sanjog for Select all module
                            .ChkAll.Checked = True
                            ''Added on 20100727 by sanjog for Select all module
                            .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
                        End With
                        'Code opti by Mitesh 
                        If Not IsNothing(objfrm) Then
                            objfrm.Dispose()
                            objfrm = Nothing
                        End If
                    Catch ex As gloCCDLibrary.gloCCDException
                        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                    Catch ex As Exception
                        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

                    End Try
                    '''''Added on 20100707 by sanjog for CCD
                Case "Clinical Decision Support"
                    'If IsAccess(False) = False Then
                    '    Exit Sub
                    'End If
                    If gnPatientID <= 0 Then
                        If oPatientListControl.PatientCount > 0 Then
                            MessageBox.Show("Select patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                            Exit Sub
                        Else
                            Exit Sub
                        End If
                    End If

                    If gloCCDLibrary.gloLibCCDGeneral.CCDFileGenerationPath = "" Then
                        MessageBox.Show("Set the CCD file generation path from gloEMR Admin.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Exit Sub
                    End If
                    Me.Cursor = Cursors.WaitCursor
                    lblFormularyTransactionMessage.AutoSize = True

                    pnlFormularyTransactionMessage.Visible = True ''''
                    lblFormularyTransactionMessage.Text = "Checking internet connection..."
                    System.Windows.Forms.Application.DoEvents()
                    'first chek if internet is available and then only send the eRx, if not then exit from the function
                    '''''http://www.developerfusion.com/code/3903/is-an-internet-connection-available/
                    _isInternetAvailable = IsInternetConnectionAvailable()
                    If _isInternetAvailable = False Then
                        MessageBox.Show("You are not connected to the internet.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Exit Sub
                    End If

                    lblFormularyTransactionMessage.Text = "Internet connection available..."
                    ' Application.DoEvents()
                    Dim objfrmCCDGenerateList As New frmCCDGenerateList(gnPatientID)
                    lblFormularyTransactionMessage.Text = "Sending CDS information..."
                    objfrmCCDGenerateList.MdiParent = Me
                    'RemoveHandler objfrmCCDGenerateList.CDS_Closed, AddressOf HandleCDSClosed
                    'AddHandler objfrmCCDGenerateList.CDS_Closed, AddressOf HandleCDSClosed

                    '' pnlFormularyTransactionMessage.Visible = False
                    'RemoveHandler objfrmCCDGenerateList.CDS_Closed, AddressOf HandleCDSClosed
                    AddHandler objfrmCCDGenerateList.CDS_Closed, AddressOf HandleCDSClosed
                    objfrmCCDGenerateList.SendRequestToDiagnosisOne()
                    'pnlFormularyTransactionMessage.Visible = False
                    ''slr remove handler then dispose
                    RemoveHandler objfrmCCDGenerateList.CDS_Closed, AddressOf HandleCDSClosed

                    objfrmCCDGenerateList.Dispose()
                    objfrmCCDGenerateList = Nothing
                    ' pnlFormularyTransactionMessage.Visible = False
                    Me.Cursor = Cursors.Default
                Case "Close"
                    ''added condition for batch printing
                    Try
                        If (PendingMessageQueue()) Then
                            Return
                        End If
                    Catch ex As Exception

                    End Try
                    If CheckBatchPrintProcessRunning() = False AndAlso CheckDMSPrinting() = False Then
                        Me.Close()
                    End If

                Case "Patient Synopsis"
                    mnu_ViewPatientSynopsis_Click(Nothing, Nothing)

                Case "LogOut"
                    ''added condition for batch printing
                    If CheckBatchPrintProcessRunning() = False AndAlso CheckDMSPrinting() = False Then
                        LogOut()
                    End If
                Case "Timeline"
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                    Dim objfrm As New frm_Graph(gnPatientID)

                    With objfrm

                        .MdiParent = Me


                        .WindowState = FormWindowState.Maximized

                        .Show()

                        Me.ShowHideMainMenu(False, False)
                        Me.pnlMainToolBar.Visible = False
                    End With
                Case "Inbox"
                    If gblnIsSecureMsgEnable = False Then

                        'Dim _sEmail As String = String.Empty
                        'Dim _sPassword As String = String.Empty

                        'If IsvalidCredentials(gnLoginID, _sEmail, _sPassword) = True Then
                        '    Dim ofrmability As New frmAbilitylogin(GetConnectionString(), _sEmail, _sPassword)
                        '    ofrmability.StartPosition = FormStartPosition.CenterScreen
                        '    ofrmability.ShowDialog(Me)
                        '    ofrmability.Dispose()
                        'Else
                        '    Dim ofrmUsermgmt As New frmAbilityUserMgmt(GetConnectionString(), gnLoginID)
                        '    ofrmUsermgmt.EmailAddress = _sEmail
                        '    ofrmUsermgmt.Password = _sPassword
                        '    ofrmUsermgmt.ShowDialog(Me)
                        '    If ofrmUsermgmt.DialgoResult = False Then
                        '        ofrmUsermgmt.Dispose()
                        '        ofrmUsermgmt = Nothing
                        '        'Me.Close()
                        '    Else
                        '        Dim ofrmability As New frmAbilitylogin(GetConnectionString(), ofrmUsermgmt.EmailAddress, ofrmUsermgmt.Password)
                        '        ofrmability.StartPosition = FormStartPosition.CenterScreen
                        '        ofrmability.ShowDialog(Me)
                        '        ofrmability.Dispose()
                        '        ofrmability = Nothing
                        '    End If
                        '    If Not IsNothing(ofrmUsermgmt) Then
                        '        ofrmUsermgmt.Dispose()
                        '        ofrmUsermgmt = Nothing
                        '    End If

                        'End If
                        MessageBox.Show("Please enable secure message from gloEMR Admin.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Else

                        ''Read Secure Messages settings and call Inbox form
                        ShowSecureMessage()

                    End If
            End Select
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Me.Cursor = Cursors.Default
            _isShowDialogueForm = False

        End Try

    End Sub

    Private Sub ShowSecureMessage()
        If strProviderDirectAddress <> "" OrElse (listDirectUserProviderAssociation IsNot Nothing AndAlso listDirectUserProviderAssociation.Count > 0) Then
            Dim ofrmInbox As gloSurescriptSecureMessage_InBox.Inbox
            ofrmInbox = gloSurescriptSecureMessage_InBox.Inbox.GetInstance()
            If IsNothing(ofrmInbox) = False Then
                Try
                    RemoveHandler ofrmInbox.tlbCDAImport, AddressOf ShowCDAImportForm
                    RemoveHandler ofrmInbox.tlbDMSImport, AddressOf ShowDMSImportForm
                Catch ex As Exception

                End Try

                AddHandler ofrmInbox.tlbCDAImport, AddressOf ShowCDAImportForm
                AddHandler ofrmInbox.tlbDMSImport, AddressOf ShowDMSImportForm
                Try
                    RemoveHandler ofrmInbox.EvntGenerateCDAFromInbox, AddressOf mdlGeneral.OpenCDA
                Catch ex As Exception

                End Try

                If notifyInbox IsNot Nothing AndAlso notifyInbox.Visible Then
                    notifyInbox.Visible = False
                End If

                AddHandler ofrmInbox.EvntGenerateCDAFromInbox, AddressOf mdlGeneral.OpenCDA
                System.Windows.Forms.Integration.ElementHost.EnableModelessKeyboardInterop(ofrmInbox)
                ofrmInbox.Show()
                ofrmInbox.Activate()
            End If
        Else
            MessageBox.Show(gstrDirectWarningMessage, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End If
    End Sub

    Private Sub ProcessRxEligibility(ByVal PatientID As Long)

        'Using oRxHubInterface As New ClsRxHubInterface(gnPatientID)
        '    If oRxHubInterface.IsValidPatientInfo_270(gnPatientID, gnLoginProviderID) = False Then
        '        Exit Sub
        '    End If
        'End Using

        Me.Cursor = Cursors.WaitCursor

        gloRxHub.ClsgloRxHubGeneral.gblnIsRxhubStagingServer = gblnRxhubStagingServer

        Try
            tlbbtn_RxHub.Enabled = False

            If gstrRxEligThresholdvalue = "" Then
                Dim objSettings As New clsSettings
                Dim stRxEligThresholdvalue As String = ""
                stRxEligThresholdvalue = objSettings.GetSettingValue("RX ELIGIBILITY THRESHOLD VALUE")
                gstrRxEligThresholdvalue = (Val(stRxEligThresholdvalue) / 24).ToString
                If Not IsNothing(objSettings) Then
                    objSettings.Dispose() : objSettings = Nothing
                End If
            End If

            Dim oClsRxHubInterface As New ClsRxHubInterface(gnPatientID)
            If oClsRxHubInterface.IsEligibilitygGenerated_validation(gnPatientID, gstrRxEligThresholdvalue) = True Then

                If oClsRxHubInterface.FillPatientInfo_270(gnPatientID, gnLoginProviderID, True) = False Then
                    If Not IsNothing(oClsRxHubInterface) Then ''slr free oClsRxHubInterface
                        oClsRxHubInterface.Dispose()
                        oClsRxHubInterface = Nothing
                    End If
                    Exit Sub
                End If

                lblFormularyTransactionMessage.Text = "Checking internet connection....."
                pnlFormularyTransactionMessage.Visible = True ''''
                pnlFormularyTransactionMessage.BringToFront()
                System.Windows.Forms.Application.DoEvents()

                _isInternetAvailable = IsInternetConnectionAvailable() 'True
                If _isInternetAvailable = False Then
                    MessageBox.Show("You are not connected to the internet.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    pnlFormularyTransactionMessage.Visible = False ''''
                    If Not IsNothing(oClsRxHubInterface) Then ''slr free oClsRxHubInterface
                        oClsRxHubInterface.Dispose()
                        oClsRxHubInterface = Nothing
                    End If
                    Exit Sub
                Else
                    lblFormularyTransactionMessage.Text = "Internet connection available....."
                    Application.DoEvents()
                End If

                Dim strFileName As String = ""
                If oClsRxHubInterface.CheckOutboxFolder(ClsgloRxHubGeneral.gnstrApplicationFilePath) Then
                    Try
                        lblFormularyTransactionMessage.Text = "Sending eligibility information ...."
                        Application.DoEvents()

                        strFileName = oClsRxHubInterface.Generate270_5010(gstrRxHubParticipantId, gstrRxHubPassword)
                    Catch ex As Exception
                        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                        gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Prescription, gloAuditTrail.ActivityCategory.eRx, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
                        ex = Nothing
                        If Not IsNothing(oClsRxHubInterface) Then ''slr free oClsRxHubInterface
                            oClsRxHubInterface.Dispose()
                            oClsRxHubInterface = Nothing
                        End If
                        Exit Sub
                    End Try

                    Try
                        'lblFormularyTransactionMessage.Text = "Sending eligibility information....."
                        'System.Windows.Forms.Application.DoEvents()

                        If strFileName <> "" Then
                            Dim gnInsuranceId As Long = 0

                            Dim EDI271FilePath As String = strFileName

                            For postCnt As Integer = 0 To 4
                                lblFormularyTransactionMessage.Text = "Waiting For eligibility response ....." & vbCrLf & "Attempt Number " & (postCnt + 1)
                                Application.DoEvents()

                                EDI271FilePath = oClsRxHubInterface.PostEDIFile_5010(strFileName, "EDI270")
                                If EDI271FilePath <> "" Then
                                    Exit For
                                Else
                                    Continue For
                                End If
                            Next

                            If EDI271FilePath <> "" Then
                                lblFormularyTransactionMessage.Text = "Eligibility response received, Reading response....."
                                Application.DoEvents()

                                Try
                                    If oClsRxHubInterface.LoadEDIObject_271_5010(EDI271FilePath) = False Then
                                        MessageBox.Show("NAK : TRANSACTION CANNOT BE IDENTIFIED NOR PROCESSED", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                        If Not IsNothing(oClsRxHubInterface) Then ''slr free oClsRxHubInterface
                                            oClsRxHubInterface.Dispose()
                                            oClsRxHubInterface = Nothing
                                        End If
                                        Exit Sub
                                    Else
                                        '//file is valid edi file and has got loaded in the ediDOC object
                                    End If

                                    lblFormularyTransactionMessage.Text = "Reading eligibility response....."
                                    System.Windows.Forms.Application.DoEvents()

                                    oClsRxHubInterface.Read271Response_5010()

                                    pnlFormularyTransactionMessage.Visible = False

                                    Dim dt271RespDetails As DataTable = Nothing 'slr new not needed 

                                    Try
                                        dt271RespDetails = oClsRxHubInterface.Get271EligibilityResponseInformation(gnPatientID)

                                        If Not IsNothing(dt271RespDetails) Then
                                            If dt271RespDetails.Rows.Count > 0 Then
                                                Dim ofrm As New frmViewEligiblityInformation(dt271RespDetails, False)
                                                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Eligibility, gloAuditTrail.ActivityType.View, "View Eligibility Responce", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                                                ofrm.ShowInTaskbar = False
                                                ofrm.StartPosition = FormStartPosition.CenterParent
                                                ofrm.BringToFront()
                                                ofrm.ShowDialog(IIf(IsNothing(ofrm.Parent), Me, ofrm.Parent))
                                                If Not IsNothing(ofrm) Then
                                                    ofrm.Dispose()
                                                    ofrm = Nothing
                                                End If

                                                If Not IsNothing(oClsRxHubInterface) Then
                                                    oClsRxHubInterface.Dispose()
                                                    oClsRxHubInterface = Nothing
                                                End If

                                                If Not IsNothing(dt271RespDetails) Then
                                                    dt271RespDetails.Dispose()
                                                    dt271RespDetails = Nothing
                                                End If
                                            Else
                                                If Not IsNothing(oClsRxHubInterface) Then ''slr free oClsRxHubInterface
                                                    oClsRxHubInterface.Dispose()
                                                    oClsRxHubInterface = Nothing
                                                End If
                                                Exit Sub
                                            End If
                                        Else
                                            MessageBox.Show("The Eligibility request for this patient cannot be shown since request is valid only for 72 hours", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                            If Not IsNothing(oClsRxHubInterface) Then ''slr free oClsRxHubInterface
                                                oClsRxHubInterface.Dispose()
                                                oClsRxHubInterface = Nothing
                                            End If
                                            Exit Sub
                                        End If
                                    Catch ex As Exception
                                        gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Prescription, gloAuditTrail.ActivityCategory.eRx, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
                                    Finally
                                        If Not IsNothing(oClsRxHubInterface) Then
                                            oClsRxHubInterface.Dispose()
                                            oClsRxHubInterface = Nothing
                                        End If
                                        If Not IsNothing(dt271RespDetails) Then
                                            dt271RespDetails.Dispose()
                                            dt271RespDetails = Nothing
                                        End If
                                    End Try
                                Catch ex As Exception
                                    Me.Cursor = Cursors.Default
                                End Try
                            Else
                                MessageBox.Show("No eligibility response file received from surescript, resend the eligibility request again.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Dim oClsgloRxHubDBLayer As New gloRxHub.clsgloRxHubDBLayer
                                oClsgloRxHubDBLayer.DeleteRxH_Table("gsp_DeleteRxHTables", gnPatientID)
                                oClsgloRxHubDBLayer.Dispose()
                            End If
                        End If
                    Catch ex As Exception
                        Me.Cursor = Cursors.Default
                    End Try
                Else
                    MessageBox.Show("The 270 EDI Request cannot be generated since there is no Outbox folder.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            Else
                pnlFormularyTransactionMessage.Visible = False
                Dim dt271RespDetails As DataTable = Nothing  ''Slr new not needed 
                Try
                    dt271RespDetails = oClsRxHubInterface.Get271EligibilityResponseInformation(gnPatientID)
                    If Not IsNothing(dt271RespDetails) Then
                        If dt271RespDetails.Rows.Count > 0 Then
                            Dim ofrm As New frmViewEligiblityInformation(dt271RespDetails, True)
                            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Eligibility, gloAuditTrail.ActivityType.View, "View Eligibility Responce", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                            ofrm.ShowInTaskbar = False
                            ofrm.StartPosition = FormStartPosition.CenterParent
                            ofrm.ShowDialog(IIf(IsNothing(ofrm.Parent), Me, ofrm.Parent))
                            If Not IsNothing(ofrm) Then
                                ofrm.Dispose()
                                ofrm = Nothing
                            End If
                            If Not IsNothing(oClsRxHubInterface) Then
                                oClsRxHubInterface.Dispose()
                                oClsRxHubInterface = Nothing
                            End If
                            If Not IsNothing(dt271RespDetails) Then
                                dt271RespDetails.Dispose()
                                dt271RespDetails = Nothing
                            End If
                        Else
                            If Not IsNothing(oClsRxHubInterface) Then ''slr free oClsRxHubInterface
                                oClsRxHubInterface.Dispose()
                                oClsRxHubInterface = Nothing
                            End If
                            Exit Sub
                        End If
                    Else
                        MessageBox.Show("The Eligibility request for this patient cannot be shown since request is valid only for 72 hours", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        If Not IsNothing(oClsRxHubInterface) Then ''slr free oClsRxHubInterface
                            oClsRxHubInterface.Dispose()
                            oClsRxHubInterface = Nothing
                        End If
                        Exit Sub
                    End If
                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Prescription, gloAuditTrail.ActivityCategory.eRx, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
                Finally
                    If Not IsNothing(oClsRxHubInterface) Then
                        oClsRxHubInterface.Dispose()
                        oClsRxHubInterface = Nothing
                    End If
                    If Not IsNothing(dt271RespDetails) Then
                        dt271RespDetails.Dispose()
                        dt271RespDetails = Nothing
                    End If
                End Try
            End If
            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Prescription, gloAuditTrail.ActivityCategory.Eligibility, gloAuditTrail.ActivityType.Send, "Eligibility check performed", PatientID, 0, gnLoginProviderID, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception
            tlbbtn_RxHub.Enabled = True
            Me.Cursor = Cursors.Default
            MessageBox.Show(ex.ToString)
        Finally
            tlbbtn_RxHub.Enabled = True
            Me.Cursor = Cursors.Default
            pnlFormularyTransactionMessage.Visible = False ''''
            Using objEligibility As New ClsRxHubInterface
                If objEligibility.GetEligibilityStatus(gnPatientID, gstrRxEligThresholdvalue) = gloEMRGeneralLibrary.gloEMRPrescription.RxBusinesslayer.EligibilityStatus.Failed Then
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Prescription, gloAuditTrail.ActivityCategory.Eligibility, gloAuditTrail.ActivityType.EligibilityCheck, "Rx eligibility is checked", gnPatientID, 0, gnPatientProviderID, gloAuditTrail.ActivityOutCome.Failure, gloAuditTrail.SoftwareComponent.gloEMR)
                End If
            End Using
        End Try
    End Sub

    ''Event Added on 20120420
    ''Developer :Mayuri
    ''To close panel after opening CDS Window
    Private Sub HandleCDSClosed(ByVal sender As Object, ByVal e As System.EventArgs)
        '   AddHandler objfrmCCDGenerateList.form_closed, AddressOf HandleformClosed
        pnlFormularyTransactionMessage.Visible = False
    End Sub
    Private Function IsvalidCredentials(ByVal nLogineID As Long, ByRef sAbilityEmail As String, ByRef sAbilityPassword As String) As Boolean

        Dim oClsEncryption As New gloSecurity.ClsEncryption()

        '30-Apr-13 Aniket: Resolving Memory Leaks
        Dim dt As DataTable = Nothing
        ' Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())  Slr not used
        Dim oAbility As New clsAbility(GetConnectionString())

        Try

            dt = oAbility.GetAbilityCreadential(nLogineID.ToString())
            If (IsNothing(dt) = False) Then



                If dt.Rows.Count > 0 Then
                    Dim sPassword As String = ""

                    Dim _encryptionKey As String = "12345678"
                    If dt.Rows(0)("sAbilityPassword") IsNot Nothing AndAlso Convert.ToString(dt.Rows(0)("sAbilityPassword")).Trim() <> "" Then
                        sPassword = oClsEncryption.DecryptFromBase64String(dt.Rows(0)("sAbilityPassword").ToString(), _encryptionKey)
                    Else
                        sPassword = ""
                    End If
                    If Convert.ToString(dt.Rows(0)("sAbilityEmail")) <> "" Then
                        sAbilityEmail = dt.Rows(0)("sAbilityEmail").ToString()
                        sAbilityPassword = sPassword

                        Return oAbility.getAuthentication(sAbilityEmail, sAbilityPassword)
                    Else
                        sAbilityEmail = ""
                        sAbilityPassword = ""
                        Return False
                    End If
                    Return True
                Else
                    Return False
                End If
            Else
                Return False
            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            Return Nothing
        Finally
            If oAbility IsNot Nothing Then
                oAbility.Dispose()
                oAbility = Nothing
            End If
            If dt IsNot Nothing Then
                dt.Dispose()
                dt = Nothing
            End If
            If oClsEncryption IsNot Nothing Then
                oClsEncryption.Dispose()
                oClsEncryption = Nothing
            End If
        End Try

    End Function

    ''Added by Mayuri:20100216-Case No:GLO2009-0003210-Added LogOut button
    Private Sub LogOut()
        Try
            '  freemedimages()
            gloGlobal.gloTSPrint._OldSharedPrinterName = "" ''changes mede for incident 67769
            If Not IsNothing(gloUserControlLibrary.gloUC_PatientStrip.hshPatData) Then
                gloUserControlLibrary.gloUC_PatientStrip.hshPatData.Clear()
            End If
            If (PendingMessageQueue()) Then
                Return
            End If
            If tlbbtn_LockScreen.Tag = "LogOut" Then


                ShowSplashScreen = True
                tmrMessages.Stop()
                tmrBirthDayReminder.Stop()
                tmrCopayAlert.Stop()
                timerLockScreen.Stop()


                ''''''''''''' Added by Ujwala Atre - to implement 'Allow Emergency Access of Patient Chart' as on 14042010
                gbAllowEmergencyAccess = False 'Reset Flag
                ''''''''''''''''''''
                SetButtonsOnOff()
                'ShowPatientDetails()
                ''''''''''''''''''''
                ''''''''''''' Added by Ujwala Atre - to implement 'Allow Emergency Access of Patient Chart' as on 14042010

                If Not IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.OpenedFormsCollection) Then
                    If gloSurescriptSecureMessage.SecureMessageProperties.OpenedFormsCollection.Count > 0 Then
                        Dim oViewMessage As gloSurescriptSecureMessage.ViewMessage
                        Dim _OpenedFormscollections As Hashtable
                        _OpenedFormscollections = DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.OpenedFormsCollection.Clone(), Hashtable)
                        For Each Item As DictionaryEntry In _OpenedFormscollections
                            oViewMessage = DirectCast(Item.Value, ViewMessage)
                            If Not IsNothing(oViewMessage) Then
                                oViewMessage.Close()
                            End If
                        Next
                        _OpenedFormscollections.Clear()
                        _OpenedFormscollections = Nothing
                        oViewMessage = Nothing
                    End If
                End If

                strProviderDirectAddress = ""

                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LoginScreen, gloAuditTrail.ActivityType.Logoff, "'" & gstrLoginName & "' successfully Logged out", 0, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                ''Added on 20111010 : to clear cache on logout 
                gloGlobal.gloPMMasters.ClearCache(gloGlobal.gloPMMasters.MasterType.Provider)

                For Each _frm As Form In My.Application.OpenForms
                    If _frm.Name = "frmReminder" AndAlso _frm.IsMdiChild = False Then
                        _frm.Close()
                        If (Not IsNothing(_frm)) Then
                            _frm.Dispose()
                            _frm = Nothing
                        End If
                        Exit For
                    End If
                Next

                Dim frmCodeGuide As gloUIControlLibrary.WPFForms.frmCodeGuide = gloUIControlLibrary.WPFForms.frmCodeGuide.CheckInstance()

                If frmCodeGuide IsNot Nothing Then
                    frmCodeGuide.btnClose_Click(Me, New System.Windows.RoutedEventArgs())
                    frmCodeGuide = Nothing
                End If


                ''Added on 20111010 : to clear cache on logout 
                Me.Close()
            Else
                ShowSplashScreen = False
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        RemoveGotFocusListener(Me)
    End Sub

    Private Sub mnuRefillRequest_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuRefillRequest.Click
        Try
            Dim obj As frmRxRequest
            obj = frmRxRequest.GetInstance(gnPatientID)

            obj.ShowInTaskbar = False
            obj.MdiParent = Me
            obj.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

            obj.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuVwErrorMessages_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuVwErrorMessages.Click
        Try
            Dim obj As frmVWErrorMessage

            obj = frmVWErrorMessage.GetInstance()
            obj.ShowInTaskbar = False
            obj.MdiParent = Me
            obj.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            obj.WindowState = FormWindowState.Maximized

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#End Region

#Region " M e n u "

    Private Sub mnuFileExit_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuFileExit.Click

        Try
            If (PendingMessageQueue()) Then
                Return
            End If
        Catch ex As Exception

        End Try

        Try
            If CheckBatchPrintProcessRunning() = False AndAlso CheckDMSPrinting() = False Then
                Me.Close()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersContacts_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersContacts.Click
        Try

            Dim ofrmContacts As New gloContacts.frmViewContacts(GetConnectionString())
            ofrmContacts.MdiParent = Me
            ofrmContacts.WindowState = FormWindowState.Maximized
            ofrmContacts.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersCategory_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersCategory.Click
        Try

            Dim frmCategory As New frmVWCategory
            frmCategory.MdiParent = Me
            frmCategory.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersHistory_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersHistory.Click
        Try

            Dim frmHistory As New frmVWHistory
            frmHistory.MdiParent = Me
            frmHistory.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersOBPlan_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersOBPlan.Click
        Try

            Dim frmMastersOBPlan As New frmVWOBPlan
            frmMastersOBPlan.MdiParent = Me
            frmMastersOBPlan.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Added Configure Family Member Form::20130207
    Private Sub mnuMastersFamilyMember_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersFamilyMember.Click
        Try
            Dim frmCategory As New frmVWFamilyMember()
            frmCategory.MdiParent = Me
            frmCategory.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMasterROS_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMasterROS.Click
        Try

            Dim frm As New frmVWROS
            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersSpeciality_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersSpeciality.Click
        Try

            Dim frmSpecialty As New frmVWSpecialty
            frmSpecialty.MdiParent = Me
            frmSpecialty.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersICD9_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim frmICD9 As New frmVWICD9
            frmICD9.MdiParent = Me
            frmICD9.WindowState = FormWindowState.Maximized
            frmICD9.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersCPT_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim frmCPT As New frmVWCPT
            frmCPT.MdiParent = Me
            frmCPT.WindowState = FormWindowState.Maximized
            frmCPT.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersDrugs_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersDrugs.Click
        Try

            Dim frmDrugs As New frmVWDrugs
            frmDrugs.MdiParent = Me
            frmDrugs.WindowState = FormWindowState.Maximized
            frmDrugs.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersSIG_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersSIG.Click
        Try

            Dim frmSIG As New frmVwsig
            frmSIG.MdiParent = Me
            frmSIG.WindowState = FormWindowState.Maximized
            frmSIG.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersTemplates_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersTemplates.Click
        Try

            Dim frmTemplateGallary As New frmVWTemplateGallary
            With frmTemplateGallary
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .mycaller = Me
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersModifier_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim frmModifier As New frmVWModifier
            With frmModifier
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersRadiology_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersRadiology.Click
        Try

            Dim ofrm_LM_TestSetup As New frm_LM_TestSetup
            With ofrm_LM_TestSetup
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersFlowsheet_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersFlowsheet.Click
        Try

            Dim frmFlow As New frmViewFlowSheet
            With frmFlow
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuLabResult_MST_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub
    Private Sub mnuMastersRCMCategory_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersRCMCategory.Click
        Dim _DMSRunning As Boolean = False
        For Each f As Form In Me.MdiChildren
            If f.Name = "frmEDocumentViewer" Then
                _DMSRunning = True
            End If
        Next
        If _DMSRunning = False Then
            Dim oDocCat As New gloEDocumentV3.gloEDocV3Management()
            Try
                oDocCat.ShowEDocumentCategory(gloEDocumentV3.Enumeration.enum_OpenExternalSource.RCM)
            Catch oError As Exception
                MessageBox.Show(oError.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            Finally
                oDocCat.Dispose()
            End Try
        Else
            MessageBox.Show("You can not add,modify and delete category while scan/view document is open.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
        End If
    End Sub

    Private Sub mnuMastersDMSCategory_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersDMSCategory.Click
        Dim _DMSRunning As Boolean = False
        For Each f As Form In Me.MdiChildren
            If f.Name = "frmEDocumentViewer" Then
                _DMSRunning = True
            End If
        Next
        If _DMSRunning = False Then
            Dim oDocCat As New gloEDocumentV3.gloEDocV3Management()
            Try
                oDocCat.ShowEDocumentCategory()
            Catch oError As Exception
                MessageBox.Show(oError.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            Finally
                oDocCat.Dispose()
            End Try
        Else
            MessageBox.Show("You can not add,modify and delete category while scan/view document is open.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
        End If
    End Sub

    Private Sub mnuMaster_SmartOrder_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuMaster_SmartOrder.Click
        Try
            Dim frm As New frmOrderAssociation
            frm = frmOrderAssociation.GetInstance()
            If IsNothing(frm) = True Then
                Exit Sub
            End If

            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
            End With
        Catch objErr As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMaster_ICDCPTGallery_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMaster_ICDCPTGallery.Click
        'Try
        '    'Me.Cursor = Cursors.WaitCursor
        '    'Dim frm As New frmICD9CPTGallery
        '    'frm.ShowDialog(Me)
        '    'frm.Dispose()
        '    'frm = Nothing

        '    Me.Cursor = Cursors.WaitCursor
        '    Dim frm As New gloGallery.frmICD9CPTGallery(GetConnectionString())
        '    frm.ShowDialog(Me)
        '    frm.Dispose()
        '    frm = Nothing
        'Catch objErr As Exception
        '    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'Finally
        '    Me.Cursor = Cursors.Default
        'End Try
    End Sub

    Private Sub mnuMastersDisclosuerSet_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersDisclosuerSet.Click
        Try
            Dim frm As New frmVWDisclosureSet
            frm.MdiParent = Me
            frm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMaster_AppointmentBook_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMaster_AppointmentBook.Click
        Dim oAppointmentBook As New gloAppointmentBook.gloAppointmentBook(GetConnectionString())
        ''added Handler by kanchan on 20120102 for calling gloCommunityViewDataform for AppConfig Download form.
        'Dim myEventHandler As New gloAppointmentBook.gloAppointmentBook.gloAptHandler(AddressOf ViewAppConfig)

        AddHandler oAppointmentBook.EvntAptHandler, AddressOf ViewAppConfig 'myEventHandler
        ''end
        oAppointmentBook.ShowAppointmentView(Me)
        ''Slr remove handler
        RemoveHandler oAppointmentBook.EvntAptHandler, AddressOf ViewAppConfig 'myEventHandler
        'myEventHandler = Nothing
        oAppointmentBook.Dispose()
        ShowHideMainMenu(False, False)

    End Sub

    Private Sub mnuMaster_PatientSummaryScreen_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMaster_PatientSummaryScreen.Click
        Try
            Dim frm As New frmPatientSummeryScreen(gnPatientID)
            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                Me.pnlMainToolBar.Visible = False
            End With

        Catch objErr As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ' '' Patient Menu Start '''
    Private Sub mnuPatientRegistration_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientRegistration.Click
        Try

            '-----------Patient Registration New gloPM
            Dim _result As Boolean = False
            Dim oPatient As gloPatient.gloPatient = New gloPatient.gloPatient(GetConnectionString)
            Dim _CurrentPatientID As Int64
            _CurrentPatientID = gnPatientID

            _bIsPatientModify = False
            Dim frmPatientReg As New gloPatient.frmSetupPatient(0, GetConnectionString())
            AddHandler frmPatientReg.EvntSaveandClose, AddressOf PatientRegSaveClose
            frmPatientReg.GBlnYesNoLab = gblnYesNoLab
            ''Patient Portal
            'frmPatientReg.gblnPatientPortalEnabled = gblnPatientPortalEnabled
            ''Patient Portal
            frmPatientReg.ShowDialog(IIf(IsNothing(frmPatientReg.Parent), Me, frmPatientReg.Parent))
            _CurrentPatientID = frmPatientReg.ReturnPatientID

            'Patient Portal
            mdlGeneral.gblnPatientPortalSendActivationEmail = frmPatientReg.gblnPatientPortalSendActivationEmail
            mdlGeneral.gblnPatientPortalActivationEmailAlreadySent = frmPatientReg.gblnPatientPortalActivationEmailAlreadySent
            'SendPatientPortalEmails(_CurrentPatientID)
            'Patient Portal

            ''Slr remove handler and the dispose 
            RemoveHandler frmPatientReg.EvntSaveandClose, AddressOf PatientRegSaveClose

            If Not IsNothing(frmPatientReg) Then
                frmPatientReg.Close()
                frmPatientReg.Dispose()
                frmPatientReg = Nothing
            End If

            If (pnlPatientList.Visible) Then
                If _CurrentPatientID > 0 Then
                    gnPatientID = _CurrentPatientID
                    oPatientListControl.PatientID = gnPatientID
                    oPatientListControl.SelectedPatientID = gnPatientID
                End If
            End If

            Dim isAdvanceDirectiveAllowed As Boolean = True
            Dim PatientRegistrationTemp As New ClsPatientRegistrationDBLayer
            If PatientRegistrationTemp.PatientStatus(_CurrentPatientID) = "Deceased" Then
                If (objUserRights.DeceasedPatient = True) Then
                    isAdvanceDirectiveAllowed = True
                Else
                    isAdvanceDirectiveAllowed = False
                End If
            End If
            If Not IsNothing(PatientRegistrationTemp) Then
                PatientRegistrationTemp.Dispose()
                PatientRegistrationTemp = Nothing
            End If
            If isAdvanceDirectiveAllowed Then
                Dim oDB As New gloStream.gloDataBase.gloDataBase
                Dim _HasDirective As Int16 = 0
                oDB.Connect(GetConnectionString)
                _HasDirective = Val(oDB.ExecuteQueryScaler("SELECT ISnull(nPatientDirective,0) As nPatientDirective FROM patient WHERE npatientid = " & _CurrentPatientID & " "))
                oDB.Disconnect()
                oDB.Dispose()
                oDB = Nothing
                _blnHasAdvDirective = _HasDirective

                If _blnHasAdvDirective = True Then
                    If gloEDocumentV3.eDocManager.eDocValidator.IsCategoryExists(0, gDMSCategory_PatientDirective, gClinicID) = False Then
                        MessageBox.Show("DMS category for advance directive has not been set, Set the category", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        _blnHasAdvDirective = False
                    End If
                End If

                If _blnHasAdvDirective = True Then
                    If _CurrentPatientID = 0 Then
                        _result = ShowEScanner(_CurrentPatientID)
                    Else
                        If _blnHasAdvDirective = True Then
                            If MessageBox.Show("Do you want to add more documents against patient directive?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                                _result = ShowEScanner(_CurrentPatientID)
                            End If
                        Else
                            _result = ShowEScanner(_CurrentPatientID)
                        End If
                    End If
                Else
                    _result = False
                End If
            End If
            PatientRegistration = New ClsPatientRegistrationDBLayer
            'for Patient Reg Advance Directive
            If (oPatientListControl.PatientID = 0) Then
                If (_result = False) Then
                    'update advanced directive flag to false
                    PatientRegistration.UpdateAdvDirective(_CurrentPatientID)
                End If
            Else
                If _blnHasAdvDirective = True Then
                Else
                    If (_result = False) Then
                        'update advanced directive flag to false
                        PatientRegistration.UpdateAdvDirective(_CurrentPatientID)
                    End If
                End If
            End If
            If Not IsNothing(PatientRegistration) Then
                PatientRegistration.Dispose()
                PatientRegistration = Nothing
            End If
            oPatientListControl.FillPatients()
            If (pnlPatientList.Visible) Then
                Call ShowPatientAllDetails(gnPatientID, , True)
            End If
            '--------------------------------------
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'for Patient Advance Directive
    Private Function ShowEScanner(ByVal _lPatientDirectiveID As Long) As Boolean

        Dim _result As Boolean = False
        '  Dim oFiles As New ArrayList()  slr Not Used 
        Dim oEDocument As New gloEDocumentV3.gloEDocV3Management

        Try
            gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV3TempPath, Convert.ToInt64(gnLoginID), gClinicID, System.Windows.Forms.Application.StartupPath)

            Dim _OutContID As Long = 0
            Dim _OutDocID As Long = 0
            oEDocument.ShowEScanner(_lPatientDirectiveID, gDMSCategory_PatientDirective, DateTime.Now.Year.ToString(), DateTime.Now.Month.ToString(), gClinicID, gloEDocumentV3.Enumeration.enum_DocumentEventType.ScanDocument, _OutContID, _OutDocID)
            oEDocument.Dispose()
            If _OutContID > 0 AndAlso _OutDocID > 0 Then
                _result = True
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, "PatientRegistration", MessageBoxButtons.OK, MessageBoxIcon.Error)
            _result = False
        Finally
            oEDocument = Nothing
        End Try

        Return _result
    End Function

    Private Sub mnuModifyPatient_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuModifyPatient.Click
        Try
            If oPatientListControl.PatientCount >= 0 Then
                If gnPatientID <> 0 Then

                    If bIsLockChart = False Then   'Check for Lock Chart
                        If gblnIsAdmin = False Then
                            If IsAccess(False) = False Then
                                Exit Sub
                            End If
                        End If
                    Else
                        MessageBox.Show("The status of the patient is 'Lock Charts'." & vbCrLf & "You can not perform any activity on this Patient.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Warning)
                        Exit Sub
                    End If



                    'Patient Registration New gloPM
                    ' Dim oPatient As gloPatient.gloPatient = New gloPatient.gloPatient(GetConnectionString)  Slr not used
                    Dim _CurrentPatientID As Int64
                    _CurrentPatientID = gnPatientID

                    _bIsPatientModify = True
                    Dim frmPatientReg As New gloPatient.frmSetupPatient(gnPatientID, GetConnectionString())
                    frmPatientReg.ShowSaveAsCopyButton = True
                    AddHandler frmPatientReg.EvntSaveandClose, AddressOf PatientRegSaveClose
                    frmPatientReg.GBlnYesNoLab = gblnYesNoLab
                    ''Patient Portal
                    'frmPatientReg.gblnPatientPortalEnabled = gblnPatientPortalEnabled
                    ''Patient Portal
                    frmPatientReg.ShowDialog(IIf(IsNothing(frmPatientReg.Parent), Me, frmPatientReg.Parent))
                    _CurrentPatientID = frmPatientReg.ReturnPatientID

                    'Patient Portal
                    mdlGeneral.gblnPatientPortalSendActivationEmail = frmPatientReg.gblnPatientPortalSendActivationEmail
                    mdlGeneral.gblnPatientPortalActivationEmailAlreadySent = frmPatientReg.gblnPatientPortalActivationEmailAlreadySent
                    'SendPatientPortalEmails(_CurrentPatientID)
                    'Patient Portal

                    If (pnlPatientList.Visible) Then
                        If _CurrentPatientID > 0 Then
                            gnPatientID = _CurrentPatientID
                            oPatientListControl.PatientID = gnPatientID
                            oPatientListControl.SelectedPatientID = gnPatientID
                        End If
                    End If
                    'check For Patient Status
                    Dim oclsPatReg As New ClsPatientRegistrationDBLayer
                    gstrPatientStatus = oclsPatReg.PatientStatus(oPatientListControl.PatientID, "").ToString()

                    'Disposed by Mitesh 
                    If Not IsNothing(oclsPatReg) Then
                        oclsPatReg.Dispose()
                        oclsPatReg = Nothing
                    End If
                    If Not IsNothing(frmPatientReg) Then
                        RemoveHandler frmPatientReg.EvntSaveandClose, AddressOf PatientRegSaveClose ''Slr remove handler
                        frmPatientReg.Dispose()
                        frmPatientReg = Nothing
                    End If

                    Dim oDB As New gloStream.gloDataBase.gloDataBase
                    Dim _HasDirective As Int16 = 0
                    oDB.Connect(GetConnectionString)
                    _HasDirective = Val(oDB.ExecuteQueryScaler("SELECT ISnull(nPatientDirective,0) As nPatientDirective FROM patient WHERE npatientid = " & gnPatientID & " "))
                    oDB.Disconnect()
                    oDB.Dispose()
                    oDB = Nothing
                    'for Patient Advance Directive
                    Dim isAdvanceDirectiveAllowed As Boolean = True
                    Dim PatientRegistrationTemp As New ClsPatientRegistrationDBLayer
                    If PatientRegistrationTemp.PatientStatus(gnPatientID) = "Deceased" Then
                        If (objUserRights.DeceasedPatient = True) Then
                            isAdvanceDirectiveAllowed = True
                        Else
                            isAdvanceDirectiveAllowed = False
                        End If
                    End If
                    If Not IsNothing(PatientRegistrationTemp) Then
                        PatientRegistrationTemp.Dispose()
                        PatientRegistrationTemp = Nothing
                    End If


                    'for Patient Advance Directive

                    Dim _result As Boolean = False

                    _blnHasAdvDirective = _HasDirective

                    If isAdvanceDirectiveAllowed Then
                        If _blnHasAdvDirective = True Then
                            If gloEDocumentV3.eDocManager.eDocValidator.IsCategoryExists(0, gDMSCategory_PatientDirective, gClinicID) = False Then
                                MessageBox.Show("DMS category for advance directive has not been set, Set the category", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                _blnHasAdvDirective = False
                            End If
                        End If

                        If _blnHasAdvDirective = True Then
                            If _CurrentPatientID = 0 Then
                                _result = ShowEScanner(_CurrentPatientID)
                            Else
                                If _blnHasAdvDirective = True Then
                                    If MessageBox.Show("Do you want to add more documents against patient directive?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                                        _result = ShowEScanner(_CurrentPatientID)
                                    End If
                                Else
                                    _result = ShowEScanner(_CurrentPatientID)
                                End If
                            End If
                        Else
                            _result = False
                        End If
                        PatientRegistration = New ClsPatientRegistrationDBLayer()
                        If (oPatientListControl.PatientID = 0) Then
                            If (_result = False) Then
                                PatientRegistration.UpdateAdvDirective(_CurrentPatientID)
                            End If
                        Else
                            If _blnHasAdvDirective = True Then
                            Else
                                If (_result = False) Then
                                    PatientRegistration.UpdateAdvDirective(_CurrentPatientID)
                                End If
                            End If
                        End If
                        If Not IsNothing(PatientRegistration) Then
                            PatientRegistration.Dispose()
                            PatientRegistration = Nothing
                        End If
                    End If

                    oPatientListControl.FillPatients()
                    If (pnlPatientList.Visible) Then
                        Call ShowPatientAllDetails(gnPatientID, True)
                    End If
                    Call ShowAppointments()
                Else
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                End If
            End If

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ''Method called on save and close button click event of patient registration form 
    ''to send HL7 patient details
    Private Sub PatientRegSaveClose(ByVal PatientID As Int64)

        '  oGeneralInterface.ScanClientInterface("gloEMR", gstrClientMachineName)

        If gblnHL7SENDOUTBOUNDGLOEMR = True AndAlso gblnAddModPatient = True Then
            SendHL7PatientDetails(PatientID, _bIsPatientModify)
        End If
        'Patient Portal
        If gblnUSEINTUITINTERFACE Then
            ''Added by madan for Insert message in general message queue
            ''This can be fired for every new or modify patient registration.
            If Not IsNothing(oGeneralInterface) Then  ''slr  Free oGneralInterface
                oGeneralInterface.Dispose()
                oGeneralInterface = Nothing
            End If
            oGeneralInterface = New clsGeneralInterface()
            oGeneralInterface.InsertInMessageQueue(PatientID, gnLoginID)
        End If
        'Patient Portal
    End Sub
    ''Patient Portal
    'Private Sub SendPatientPortalEmails(ByVal PatientID As Int64)
    '    If gblnPatientPortalEnabled And mdlGeneral.gblnPatientPortalSendActivationEmail Then
    '        If Not IsNothing(oGeneralInterface) Then  ''slr  Free oGneralInterface
    '            oGeneralInterface.Dispose()
    '            oGeneralInterface = Nothing
    '        End If
    '        oGeneralInterface = New clsGeneralInterface()
    '        oGeneralInterface.InsertInMessageQueue(PatientID, gnLoginID)
    '        'GetMessageQueue(PatientID)
    '    End If
    'End Sub
    ''Patient Portal
    Private Sub mnuPatientHistory_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientHistory.Click
        ShowHistory(gnPatientID)
    End Sub
    Private Sub ShowReviewPHI(ByVal gstrPatientFirstName As String, ByVal gblnProviderDisable As Boolean, ByVal gnPatientID As Int64, Optional ByVal bCallForLatestStatus As Boolean = False, Optional ByVal ReferencePHIID As Long = 0, Optional ByVal bIsReviewMode As Boolean = False)

        Try
            If gnPatientID > 0 Then
                If IsAccess(False, bGetLatestStatus:=bCallForLatestStatus) = False Then
                    Exit Sub
                End If
                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        '    oPatientListControl.FillPatients()
                    End If
                End If
                gnVisitID = GetVisitID(Now, gnPatientID)
                'Record Level Locking
                Dim frm As frmPHIReview
                frm = frmPHIReview.GetInstance(gnVisitID, Now.Date, gnPatientID, bIsReviewMode)
                frm.TaskID = nTaskId
                frm.SelectedPHIID = ReferencePHIID
                If IsNothing(frm) = True Then
                    Exit Sub
                End If
                With frm
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                End With
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub ShowHistory(ByVal nPatientID As Int64)
        Try

            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(nPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                gnVisitID = GetVisitID(Now, nPatientID)

                'Record Level Locking
                Dim blnRecordLock As Boolean = False
                'If gblnRecordLocking = True Then
                '    Dim mydt As New mytable
                '    mydt = Scan_n_Lock_Transaction(TrnType.PatientHistory, nPatientID, gnVisitID, Now)
                '    If mydt.Description <> gstrClientMachineName Then
                '        If MessageBox.Show("This Patient History is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                '            blnRecordLock = True
                '        Else
                '            Exit Sub
                '        End If
                '    End If
                'End If
                'Record Level Locking

                Dim frmPatHis As frmHistory
                frmPatHis = frmHistory.GetInstance(gnVisitID, Now.Date, nPatientID, blnRecordLock)


                If IsNothing(frmPatHis) = True Then
                    Exit Sub
                End If
                If Not IsNothing(frmPatHis.uiPanSplitScreen_History) Then
                    If Not IsNothing(frmPatHis.uiPanSplitScreen_History.Parent) Then
                        If frmPatHis.uiPanSplitScreen_History.Parent.Text = "Split Screen" Then
                            frmPatHis.uiPanSplitScreen_History.Parent.Visible = True
                        ElseIf frmPatHis.uiPanSplitScreen_History.Text = "Split Screen" Then
                            frmPatHis.uiPanSplitScreen_History.Visible = True
                        End If

                    End If

                End If
                If (frmHistory.IsOpen = False) Then
                    frmPatHis.blnShowMessageBox = False
                    frmPatHis.PopulatePatientHistory_Final()

                End If
                If frmPatHis.blncancel Then
                    frmPatHis.MdiParent = Me
                    frmPatHis.WindowState = FormWindowState.Maximized

                    frmPatHis.Show()
                    ShowHideMainMenu(False, False)
                Else
                    frmPatHis.Dispose()
                    frmPatHis = Nothing
                End If
            Else
                'Patient's List is Not Blank then only Show the Messages
                If oPatientListControl.PatientCount > 0 Then
                    Me.pnlMainToolBar.Visible = True
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub ShowROS(ByVal gstrPatientFirstName As String, ByVal gblnProviderDisable As Boolean, ByVal gnPatientID As Int64, Optional ByVal bCallForLatestStatus As Boolean = False)
        Try
            If gnPatientID > 0 Then
                If IsAccess(False, bGetLatestStatus:=bCallForLatestStatus) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                gnVisitID = GetVisitID(Now, gnPatientID)

                'Record Level Locking Mahesh - 20070718 
                Dim blnRecordLock As Boolean = False
                If gblnRecordLocking = True Then
                    Dim mydt As mytable  ''Slr new not needed
                    mydt = Scan_n_Lock_Transaction(TrnType.PatientROS, gnPatientID, gnVisitID, Now)
                    If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                        If MessageBox.Show("This Patient ROS is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                            blnRecordLock = True
                        Else
                            If Not IsNothing(mydt) Then  ''slr free mydt
                                mydt.Dispose()
                                mydt = Nothing
                            End If

                            Exit Sub
                        End If
                    End If
                    If Not IsNothing(mydt) Then    ''slr free mydt
                        mydt.Dispose()
                        mydt = Nothing
                    End If

                End If
                'Record Level Locking

                Dim frm As frmPatientROS
                frm = frmPatientROS.GetInstance(gnVisitID, Now.Date, gnPatientID, blnRecordLock)
                If IsNothing(frm) = True Then
                    Exit Sub
                End If



                With frm
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                End With
            Else
                If oPatientListControl.PatientCount > 0 Then
                    ''
                    Me.pnlMainToolBar.Visible = True
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub
    Private Sub mnuPatientROS_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuPatientROS.Click
        ShowROS(gstrPatientFirstName, gblnProviderDisable, gnPatientID)
    End Sub

    Private Sub mnuPatientPrescription_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientPrescription.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                Dim frmRxMeds As frmPrescription
                frmRxMeds = frmPrescription.GetInstance(gnPatientID, True)
                If IsNothing(frmRxMeds) = True Then
                    Exit Sub
                End If
                If Not IsNothing(frmRxMeds.uiPanSplitScreen_PatientPrescription) Then
                    If Not IsNothing(frmRxMeds.uiPanSplitScreen_PatientPrescription.Parent) Then
                        If frmRxMeds.uiPanSplitScreen_PatientPrescription.Parent.Text = "Split Screen" Then
                            frmRxMeds.uiPanSplitScreen_PatientPrescription.Parent.Visible = True
                        ElseIf frmRxMeds.uiPanSplitScreen_PatientPrescription.Text = "Split Screen" Then
                            frmRxMeds.uiPanSplitScreen_PatientPrescription.Visible = True
                        End If

                    End If

                End If
                If frmPrescription.IsOpen = False Then
                    frmRxMeds.ShowMedication()
                End If
                If frmRxMeds.blncancel Then
                    With frmRxMeds
                        .WindowState = FormWindowState.Maximized
                        .MdiParent = Me
                        .Show()
                    End With
                    ShowHideMainMenu(False, False)
                    Me.pnlMainToolBar.Visible = False
                End If

            Else
                If oPatientListControl.PatientCount > 0 Then
                    Me.pnlMainToolBar.Visible = True
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch ex As gloEMRGeneralLibrary.gloGeneral.FormularyServiceException
            Me.pnlMainToolBar.Visible = True
            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Prescription, gloAuditTrail.ActivityType.View, ex.ToString(), gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Failure, gloAuditTrail.SoftwareComponent.gloEMR)
            MessageBox.Show(ex.Message.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Catch objErr As Exception
            Me.pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuPatientMedication_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try

            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                Dim frmRxMeds As frmPrescription
                frmRxMeds = frmPrescription.GetInstance(gnPatientID)
                If IsNothing(frmRxMeds) = True Then
                    Exit Sub
                End If
                If frmPrescription.IsOpen = False Then
                    frmRxMeds.ShowMedication()
                End If

                If frmRxMeds.blncancel Then
                    With frmRxMeds
                        .WindowState = FormWindowState.Maximized
                        .MdiParent = Me
                        .Show()
                    End With
                    ShowHideMainMenu(False, False)
                    Me.pnlMainToolBar.Visible = False
                End If
            Else
                'Patient's List is Not Blank then only Show the Messages
                If oPatientListControl.PatientCount > 0 Then
                    ''
                    Me.pnlMainToolBar.Visible = True
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            Me.pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPatientVitals_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientVitals.Click
        Try

            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                Dim frmPatientVitals As New frmPatientVitals(0, gnPatientID)
                With frmPatientVitals
                    .ShowInTaskbar = False
                    .StartPosition = FormStartPosition.CenterParent
                    .ShowDialog(IIf(IsNothing(frmPatientVitals.Parent), Me, frmPatientVitals.Parent))

                    If IsNothing(Me.MdiChildren) = False Then
                        If Me.MdiChildren.Count = 0 Then
                            mnu_DashBoard_Click(Nothing, Nothing)
                        End If
                    End If

                    'Added on 20100617 by sanjog Start for refresh the grid for vital record
                    ShowPatientDetails()
                    'Added on 20100617 by sanjog End for refresh the grid for vital record 
                End With
                frmPatientVitals.Dispose()
                frmPatientVitals = Nothing

            Else
                'Patient's List is Not Blank then only Show the Messages
                If oPatientListControl.PatientCount > 0 Then
                    Me.pnlMainToolBar.Visible = True
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    'Added Code Changes for View OBVitals
    Private Sub mnuView_OBVitals_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_OBVitals.Click
        Try
            If gnPatientID <> 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If

                Dim frm As frmVWPatientOBVitals
                frm = frmVWPatientOBVitals.GetInstance(gnPatientID)
                If IsNothing(frm) = True Then
                    Exit Sub
                End If

                With frm
                    .MdiParent = Me
                    .ShowInTaskbar = False
                    .StartPosition = FormStartPosition.CenterParent
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False

                End With
            Else

                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub mnu_UploadVideo_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_UploadVideo.Click
        Try

            If IsAccess(False) = False Then
                Exit Sub
            End If

            If VMSRootPath & "" = "" Then
                MessageBox.Show("Video management system path is not set.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Dim oVideo As New frmDVD_MaintainVideo(gnPatientID)
            With oVideo

                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With

        Catch ex As Exception
            MessageBox.Show("The required components for playing video are missing. Please install.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_PatientVitals_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_PatientVitals.Click

        Try
            If gnPatientID <> 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If

                Dim frm As frmVWPatientVitals
                frm = frmVWPatientVitals.GetInstance(gnPatientID)
                If IsNothing(frm) = True Then
                    Exit Sub
                End If

                With frm
                    .MdiParent = Me
                    .ShowInTaskbar = False
                    .StartPosition = FormStartPosition.CenterParent
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False

                End With
            Else
                'This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_Messages_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_Messages.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            '' Form View- > Meesages We have to show 'Sent Messages by login user'
            mnuView_PatientMessages(True)

        Catch objErr As Exception
            'Hide Tool Bar Mahesh 20070613
            Me.pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub mnuView_PatientMessages(ByVal ShowSentMessages As Boolean)
        If gnPatientID <= 0 Then
            '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
            If oPatientListControl.PatientCount > 0 Then
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                Exit Sub
            Else
                Exit Sub
            End If
        End If

        If IsAccess(False) = False Then
            Exit Sub
        End If

        Dim frm As frmVWMessages
        frm = frmVWMessages.GetInstance(ShowSentMessages, gnPatientID)

        If IsNothing(frm) = True Then
            Exit Sub
        End If
        With frm
            .MdiParent = Me

            .WindowState = FormWindowState.Maximized
            .StartPosition = FormStartPosition.CenterParent
            .BringToFront()
            .Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        End With
    End Sub

    Private Sub mnuView_PatientForms_Click(ByVal sender As Object, ByVal e As System.EventArgs)
        Try
            If gnPatientID <= 0 Then
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                Else
                    Exit Sub
                End If

            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim ofrm As New gloOffice.frmWd_ViewPatientTemplates(gnPatientID, GetConnectionString)
            ShowHideMainMenu(False, False)
            ofrm.MdiParent = Me
            ofrm.ShowInTaskbar = False
            ofrm.StartPosition = FormStartPosition.CenterParent
            ofrm.WindowState = FormWindowState.Maximized
            ofrm.Show()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMastersLabSetup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMastersLabSetup.Click
        Try
            Dim oLabTest As New frmLab_View
            oLabTest.MdiParent = Me
            oLabTest.WindowState = FormWindowState.Maximized
            oLabTest.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'By Abhijeet Farkande on date 20100218 Written this callglolab() function to call glolab interface

    Private Sub CallgloLab()
        Try
      

            If gnPatientID <= 0 Then
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If

            'If IsAccess(False, , True) = False Then

            '09-Dec-13 Aniket: Resolving Bug #59178 
            If IsAccess(False) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            'Record Level Locking
            Dim blnRecordLock As Boolean = False
            If gblnRecordLocking = True Then
                Dim mydt As mytable ''Slr new not needed 
                mydt = Scan_n_Lock_Transaction(TrnType.Labs, gnPatientID, gnVisitID, Now)
                If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                    If MessageBox.Show("This Patient Lab is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                        blnRecordLock = True
                    Else
                        If Not IsNothing(mydt) Then  'slr free mydt
                            mydt.Dispose()
                            mydt = Nothing
                        End If
                        Exit Sub
                    End If
                    If Not IsNothing(mydt) Then   'slr free mydt
                        mydt.Dispose()
                        mydt = Nothing
                    End If
                End If
            End If
            'Record Level Locking

            Dim ofrmViewgloLab As New gloEmdeonInterface.Forms.frmViewgloLab(gnPatientID)

            'Code added for Already lab order Is open
            If (ofrmViewgloLab.CheckInstance() = True) Then
                MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                ofrmViewgloLab.Close()
                If (IsNothing(ofrmViewgloLab) = False) Then
                    ofrmViewgloLab.Dispose()
                    ofrmViewgloLab = Nothing
                End If
                Exit Sub
            End If

            AddHandler ofrmViewgloLab.EventCDA, AddressOf mdlGeneral.OpenCDA

            'Developer:Sanjog Dhamke
            'Date: 20 Dec 2011 (6060)
            'Bug ID/PRD Name/Sales force Case: PRD Lab Usability - To show Add,Modify & Deletion functionality for ACkw.
            'Reason: to add handler to open patient Message from Acknowledgemnt form.
            AddHandler ofrmViewgloLab.EntOpenMessage, AddressOf OpenMessage
            AddHandler ofrmViewgloLab.EvntOpenPatientLetter, AddressOf OpenPatientLetter
            AddHandler ofrmViewgloLab.EvntOpenReferralLetter, AddressOf OpenReferralLetters
            AddHandler ofrmViewgloLab.EvntOpenClinicalChart, AddressOf OpenClinicalChart
            AddHandler ofrmViewgloLab.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
            'Sanjog - Commented bcoz this functionality is not complete yet (lab PRD)
            AddHandler ofrmViewgloLab.EvntGenerateCCDHandler, AddressOf openCCD
            ''pradeep 20100809 - To refresh TaskList on close of frmViewgloLab
            AddHandler ofrmViewgloLab.FormClosed, AddressOf ofrmViewgloLab_FormClosed 'ShowTasks
            '' Returns the Existance of Form if any    
            AddHandler ofrmViewgloLab.Activated, AddressOf frmViewgloLab_Activated
            'AddHandler ofrmViewgloLab.Deactivate, AddressOf frmViewgloLab_Deactivate

            ''Incident #55971: 00017037:Patient Context issue
            ''Change patient from Lab not refresh provider combo box if open Dashboard as File>>Dashboard without closing lab main form.
            AddHandler ofrmViewgloLab.OnProviderChanged, AddressOf OnProviderChanged

            AddHandler ofrmViewgloLab.EntOpenEducation, AddressOf OpenEducation
            ''(nTemplateID,nPatientID As Int64, ByVal sTemplateName As String, ByVal oType As gloEMRGeneralLibrary.clsInfobutton.enumSource, ByVal OpenFor As String)

            AddHandler ofrmViewgloLab.EvntGenerateCDAHandler, AddressOf openCDA

            ofrmViewgloLab.objgloLabPatientExam = New clsPatientExams

            ofrmViewgloLab.objgloLabPatientMessages = New clsMessage
            ofrmViewgloLab.objgloLabPatientLetters = New clsPatientLetters
            ofrmViewgloLab.objgloLabNurseNotes = New clsNurseNotes
            ofrmViewgloLab.objgloLabHistory = New clsPatientHistory
            ofrmViewgloLab.objgloLabLabs = New clsLabs
            ofrmViewgloLab.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
            ofrmViewgloLab.objgloLabRxmed = New clsPatientDetails
            ofrmViewgloLab.objgloLabOrders = New clsPatientDetails
            ofrmViewgloLab.objgloLabProblemList = New clsPatientProblemList
            ofrmViewgloLab.DirectAddress = strProviderDirectAddress
            ofrmViewgloLab.objgloLabCriteria = New DocCriteria
            ofrmViewgloLab.objgloLabWord = New clsWordDocument
            ofrmViewgloLab.SecureMsgEnable = gblnIsSecureMsgEnable
            ofrmViewgloLab.SecureMsgUserright = gblnSecureUserrights
            ofrmViewgloLab.LoginProviderID = gnLoginProviderID
            ''changes added for split control functionality in orders&results
            Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
            objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn

            ' ofrmViewgloLab.objCriteria = New DocCriteria
            ' ofrmViewgloLab.objWord = New clsWordDocument
            ofrmViewgloLab.VisitID = gnVisitID
            ofrmViewgloLab.clsSplit_Laborder = objclsSplit_Laborder
            If IsNothing(ofrmViewgloLab) = True Then
                Exit Sub
            End If

            With ofrmViewgloLab.LabOrderParameter
                .IsEditMode = False
                .OrderID = 0
                .OrderNumberID = 0
                .OrderNumberPrefix = "ORD"
                .PatientID = gnPatientID
                'PArameter pass to GenerateVisitID() as we replace gnPatientID and gnvisitId by local variables 
                .VisitID = GenerateVisitID(gnPatientID)
                .TransactionDate = Now

                .CloseAfterSave = True
            End With
            ofrmViewgloLab.WindowState = FormWindowState.Maximized
            ofrmViewgloLab.MdiParent = Me
            ofrmViewgloLab.ShowInTaskbar = False
            ofrmViewgloLab.Show()


            'Hide Tool Bar Mahesh 20070530
            Me.pnlMainToolBar.Visible = False
            ShowHideMainMenu(False, False)


        Catch ex As Exception
            Me.pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'End of changes by Abhijeet Farkande

    ''Incident #55971: 00017037:Patient Context issue
    ''Change patient from Lab not refresh provider combo box if open Dashboard as File>>Dashboard without closing lab main form.
    Public Sub OnProviderChanged(ByVal _newProviderID As Long)
        ''this event get _newProviderID value from frmViewgloLab.
        ''Pass changed patient provider (_newProviderID) to SelectProvider function of oPatientListControl to change the provider combo.
        oPatientListControl.SelectProvider(_newProviderID)
    End Sub


    Public Sub frmViewgloLab_Activated(ByVal sender As Object, ByVal e As System.EventArgs)
        'Developer:Mitesh Patel
        'Date:31 May 2012 
        'Bug # 26421 
        Try
            'SetGnPatientID = sender.GetCurrentPatientID
            Dim frmlab As frmViewgloLab
            frmlab = frmViewgloLab.GetInstance()
            If IsNothing(frmlab) = False Then
                If IsNothing(frmlab.LabPatientID) = False Then
                    If frmlab.LabPatientID <> 0 Then
                        SelectPatientOnDashboard(frmlab.LabPatientID)
                    End If
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Labs, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub
    'Public Sub frmViewgloLab_Deactivate(ByVal sender As Object, ByVal e As System.EventArgs)
    '    Try
    '        ' SetGnPatientID = sender.GetCurrentPatientID
    '        Dim frmlab As frmViewgloLab
    '        frmlab = frmViewgloLab.GetInstance()
    '        If IsNothing(frmlab) = False Then
    '            If IsNothing(frmlab.LabPatientID) = False Then
    '                If frmlab.LabPatientID <> 0 Then
    '                    frmlab.LabPatientID = 0
    '                End If
    '            End If
    '        End If
    '    Catch ex As Exception
    '        gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Labs, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.General, ex.ToString(), gloAuditTrail.ActivityOutCome.Failure)
    '    End Try
    'End Sub

    Private Sub mnuPatient_LabOrder_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatient_LabOrder.Click
        Try
            CallgloLab()
        Catch ex As Exception
            Me.pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_PatientLetters_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_PatientLetters.Click
        Try
            If Trim(gstrPatientCode) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If


                Dim frmPatLetters As New frmVWPatientLetters(gnPatientID)
                With frmPatLetters
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                End With
            Else
                '' This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuViewPatientSummaryScreen_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuViewPatientSummaryScreen.Click
        Try
            If Trim(gstrPatientCode) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If


                Dim frm As New frmViewPatientSummary(gnPatientID)
                With frm
                    .MdiParent = Me
                    .Show()

                    .WindowState = FormWindowState.Maximized
                    ShowHideMainMenu(False, False)
                    Me.pnlMainToolBar.Visible = False
                End With
            Else
                '' This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPatientPTProtocols_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientPTProtocols.Click
        Dim objfrmPTProtocols As New frmPTProtocols(gnPatientID)
        'AddHandler objfrmPTProtocols.EvntGenerateCDAFromPTProtocols, AddressOf openCDA
        Try
            If gnPatientID <= 0 Then
                'This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank

                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If

            If IsAccess(False, gnPatientID) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If


            'To check exeception related to word
            If CheckWordForException() = False Then
                Exit Sub
            End If

            '  dtWord = New DataTable  Slr new not needed 
            objWord = New clsWordDocument
            dtWord = objWord.FillTemplates(enumTemplateFlag.PTProtocol)
            objWord = Nothing
            If (IsNothing(dtWord) = False) Then


                If dtWord.Rows.Count = 0 Then
                    ''''If not present then exit from sub
                    MessageBox.Show("No Template is associated for PTProtocol. Associate any template first", "Patient Exam", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    With objfrmPTProtocols
                        .MdiParent = Me

                        .Show()
                        .WindowState = FormWindowState.Maximized
                        .BringToFront()
                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False

                    End With
                End If
            Else
                MessageBox.Show("No Template is associated for PTProtocol. Associate any template first", "Patient Exam", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub

            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            pnlMainToolBar.Visible = True
            ShowHideMainMenu(True, True)
        Finally
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
            objfrmPTProtocols = Nothing
        End Try
    End Sub

    Private Sub mnuPatientFlowsheet_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientFlowSheet.Click
        Try
            If gnPatientID <= 0 Then

                'This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If


            Dim frmFlowT As New frmPatientFlowSheet(gnPatientID, "")
            If frmFlowT.FormLevelLock() Then
                With frmFlowT
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                End With
            Else
                frmFlowT.Dispose()
                frmFlowT = Nothing
            End If


        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            ShowHideMainMenu(True, True)
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuPatient_RadiologyOrders_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatient_RadiologyOrders.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                Dim frm As frm_LM_Orders
                '' Returns the Existance of Form if any  

                gnVisitID = GetVisitID(Now, gnPatientID)
                frm = frm_LM_Orders.GetInstance(gnVisitID, Now, gnPatientID, 0, False)

                ''Sudhir 20090207 - To refresh TaskList on closing of frm_LM_Order
                Try
                    RemoveHandler frm.On_OrderClose, AddressOf ShowTasksHanlder  ''slr remove handler 
                Catch ex As Exception

                End Try

                'AddHandler frm.EvntGenerateCDAFromLMOrders, AddressOf openCDA
                AddHandler frm.On_OrderClose, AddressOf ShowTasksHanlder
                '' 
                If IsNothing(frm) = True Then
                    Exit Sub
                End If

                With frm
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)

                    '''' Hide Tool Bar Mahesh 20070530
                    Me.pnlMainToolBar.Visible = False
                End With
            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    Me.pnlMainToolBar.Visible = True
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            Me.pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuMaster_SmartDiagnosis_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMaster_SmartDiagnosis.Click
        Try
            Dim oDMModule As New frmSmartDxMaster
            oDMModule.oMainForm = Me
            oDMModule.MdiParent = Me
            oDMModule.ShowInTaskbar = False
            oDMModule.WindowState = FormWindowState.Maximized
            oDMModule.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMaster_SmartTreatment_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMaster_SmartTreatment.Click
        Try
            Dim frm As New frmCPTICD9Association
            frm = frmCPTICD9Association.GetInstance()
            If IsNothing(frm) = True Then
                Exit Sub
            End If

            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMaster_FormGallery_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMaster_FormGallery.Click
        Try

            Dim frm As New frmCPTAssociation
            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
            End With
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuView_Referrals_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_Referrals.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If
            'Developer:Mitesh Patel
            'Date:24 May 2012 
            'Bug # 26421 
            'Dim frmlab As frmViewgloLab
            'frmlab = frmViewgloLab.GetInstance()
            'If IsNothing(frmlab) = False Then
            '    If IsNothing(frmlab.LabPatientID) = False Then
            '        If frmlab.LabPatientID <> 0 Then
            '            SelectPatientOnDashboard(frmlab.LabPatientID)
            '        End If
            '    End If
            'End If


            Dim frm As New frmVWReferrals(gnPatientID)
            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub mnuReportPatientsAlerts_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuReportPatientsAlerts.Click
        'by Ujwala Atre as on 25022010 - To implement Patients Alerts Report
        Try
            Dim ofrmShowReport As New gloEMRReports.frmReports(GetConnectionString(), "alerts")

            ofrmShowReport.MdiParent = Me
            ofrmShowReport.WindowState = FormWindowState.Maximized
            ofrmShowReport.ShowInTaskbar = False
            ofrmShowReport.StartPosition = FormStartPosition.CenterParent
            ofrmShowReport.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_Tasks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_Tasks.Click
        Try
            If gnPatientID > 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If
                Dim oViewTask As New gloTaskMail.gloTask(GetConnectionString)
                AddHandler oViewTask.OnGloTask_Change, AddressOf HandlesTaskChange
                oViewTask.ShowTask(Me, True, gnPatientID, gblnviewCompleteOtherUsersTasks)
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_Mails_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_Mails.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim oViewUserMail As gloTaskMail.frmViewUserMail = gloTaskMail.frmViewUserMail.GetInstance()
            oViewUserMail.MdiParent = Me


            oViewUserMail.WindowState = FormWindowState.Maximized
            oViewUserMail.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_FormGallery_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_FormGallery.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If


                Dim frm As New frmVWFormGallery(gnPatientID)
                'AddHandler frm.EvntGenerateCDAFromVWFormGallery, AddressOf openCDA
                With frm
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                End With

            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuView_PatientEducation_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_PatientEducation.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If

                Dim frmPVW As New frmVWPatientEducation(gnPatientID)
                With frmPVW
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                End With
            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuView_PatientVideo_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_PatientVideo.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim oVideo As New frmVMS_VWPatientVideo(gnPatientID)
            With oVideo


                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            MessageBox.Show(ex.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_DisclosureMgmt_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_DisclosureMgmt.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If


                Dim frmDisclosure As New frmVWDisclosureMgmt(gnPatientID)
                'AddHandler frmDisclosure.EvntGenerateCDAFromVWDisclosureManagement, AddressOf openCDA
                With frmDisclosure
                    .MdiParent = Me
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                    .WindowState = FormWindowState.Maximized
                End With
            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.VisiblePatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_CardioVascularRisk_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuView_CardioVascularRisk.Click

        If IsAccess(False) = False Then
            Exit Sub
        End If

        Dim oCVRisk As New frmCV_PatientRisk(gnPatientID)
        If oCVRisk.RiskFound Then
            oCVRisk.ShowDialog(IIf(IsNothing(oCVRisk.Parent), Me, oCVRisk.Parent))
            oCVRisk.Dispose()
            oCVRisk = Nothing
        Else
            ''Slr dispose oCVRisk
            If Not IsNothing(oCVRisk) Then
                oCVRisk.Dispose()
                oCVRisk = Nothing
            End If
            MessageBox.Show("No risk found for patient.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End If
    End Sub

    Private Sub mnuView_Triage_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuView_Triage.Click
        Try
            If gnPatientID > 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If
                Dim oVWTriage As New frmVWTriage(gnPatientID)
                'AddHandler oVWTriage.EvntGenerateCDAFromViewTriage, AddressOf openCDA

                oVWTriage.MdiParent = Me
                oVWTriage.WindowState = FormWindowState.Maximized
                oVWTriage.Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_ViewPendingLabOrders_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_ViewPendingLabOrders.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If
            Dim frm As New frmViewPendingLabOrder

            frm.WindowState = FormWindowState.Maximized
            frm.MdiParent = Me
            frm.Show()
            ShowHideMainMenu(False, False)
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuOutStandingOrders_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuOutStandingOrders.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            'Dim frm As New frmOutstandingOrders(gnPatientID)
            'frm.WindowState = FormWindowState.Maximized
            'frm.MdiParent = Me
            'frm.Show()


            Dim frm1 As New frmOutstandingOrdersAndResult(gnPatientID)
            frm1.WindowState = FormWindowState.Maximized
            frm1.MdiParent = Me
            frm1.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPatientConcent_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuPatientConcent.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                'To check exeception related to word
                If CheckWordForException() = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                '  dtWord = New DataTable  Slr new not needed 
                objWord = New clsWordDocument
                dtWord = objWord.FillTemplates(enumTemplateFlag.PatientConsent)
                objWord = Nothing
                If Not IsNothing(dtWord) Then
                    If dtWord.Rows.Count = 0 Then
                        ''''If not present then exit from sub
                        MessageBox.Show("No template is associated for patient consent. Associate any template first", "Patient exam", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Exit Sub
                    Else
                        Dim objfrmPatientConsent As New frmPatientConsent(gnPatientID)

                        With objfrmPatientConsent
                            .MdiParent = Me


                            .Show()
                            .WindowState = FormWindowState.Maximized
                            .BringToFront()
                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False
                        End With
                    End If
                Else
                    MessageBox.Show("No template is associated for patient consent. Associate any template first", "Patient exam", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub

                End If

            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
        End Try
    End Sub

    Private Sub mnuUpdateExistingTemplates_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuUpdateExistingTemplates.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If
            Dim frm As New frmUpdateTemplates
            With frm
                .ShowInTaskbar = False
                .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            End With
            If Not IsNothing(frm) Then  ''slr dispose frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnuTools_DefaultDisplaySettings_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuTools_DefaultDisplaySettings.Click
        On Error Resume Next
        Me.SuspendLayout()
        Call ResetDisplaySettings()
        GetMedicalCategoryImage() ''added for bugid 79952
        Me.ResumeLayout()
    End Sub

    Private Sub mnuPatient_Tasks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatient_Tasks.Click
        Try
            If gnPatientID > 0 Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If
                cmnuItem_NewTask_Click(Nothing, Nothing)
            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPatient_FormGallery_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatient_FormGallery.Click
        Dim objfrm As frmCPTTemplate  'SLR: Let the new be before "with objfrm" else at every exit you need to free this.
        Try
            If gnPatientID <= 0 Then
                'This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                End If
                Exit Sub
            End If
            If IsAccess(False) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            'To check exeception related to word
            If CheckWordForException() = False Then
                Exit Sub
            End If
            objfrm = New frmCPTTemplate(gnPatientID)  'SLR: Let the new be before "with objfrm" else at every exit you need to free this.            
            'AddHandler objfrm.EvntGenerateCDAFromCPTTemplate, AddressOf openCDA
            With objfrm
                .pnl_Left.Visible = True
                .Text = "New Form Gallery"
                .MdiParent = Me


                .WindowState = FormWindowState.Maximized
                .Show()
                .BringToFront()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            Me.pnlMainToolBar.Visible = True
            ShowHideMainMenu(True, True)
        Finally
            objfrm = Nothing
        End Try
    End Sub

    Private Sub mnuNurseNotes_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuNurseNotes.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If
                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                'To check exeception related to word
                If CheckWordForException() = False Then
                    Exit Sub
                End If

                ' dtWord = New DataTable ''slr new not needed
                objWord = New clsWordDocument
                dtWord = objWord.FillTemplates(enumTemplateFlag.NurseNotes)
                objWord = Nothing
                If Not IsNothing(dtWord) Then
                    If dtWord.Rows.Count = 0 Then
                        ''''If not present then exit from sub
                        MessageBox.Show("No template is associated for nurses notes. Associate any template first.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Exit Sub
                    Else
                        Dim objfrmNotes As New frmNurseNotes(gnPatientID)

                        With objfrmNotes
                            .MdiParent = Me
                            .NurseNoteTemplates = dtWord.Copy
                            .Show()
                            .WindowState = FormWindowState.Maximized
                            .BringToFront()
                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False
                        End With
                    End If
                Else
                    MessageBox.Show("No template is associated for nurses notes. Associate any template first.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub


                End If


            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.VisiblePatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
        End Try
    End Sub

    Private Sub mnuDisclosureMgmt_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuDisclosureMgmt.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                'To check exeception related to word
                If CheckWordForException() = False Then
                    Exit Sub
                End If
                'End

                '  dtWord = New DataTable  slr new not needed 
                objWord = New clsWordDocument
                dtWord = objWord.FillTemplates(enumTemplateFlag.DisclosureMangement)
                objWord = Nothing
                If Not IsNothing(dtWord) Then
                    If dtWord.Rows.Count = 0 Then
                        ''''If not present then exit from sub
                        ''resolved bug# 8544 reported in 6040
                        MessageBox.Show("No template is associated for disclosure management. Associate any template first", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Exit Sub
                    Else
                        Dim objdisclosure As New frmDisclosureMgmt(gnPatientID)
                        'AddHandler objdisclosure.EvntGenerateCDAFromDisclosureManagement, AddressOf openCDA
                        With objdisclosure

                            .MdiParent = Me
                            .Show()
                            .WindowState = FormWindowState.Maximized
                            .BringToFront()
                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False
                        End With
                    End If
                Else
                    MessageBox.Show("No template is associated for disclosure management. Associate any template first", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub

                End If

            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.VisiblePatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
        End Try
    End Sub

    Private Sub mnuPatientMessages_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientMessages.Click
        Try
            'If IsAccess(False) = False Then
            '    Exit Sub
            'End If
            'If (_nLabPatientId <> 0) Then
            '    If (gnPatientID <> _nLabPatientId) Then
            '        SelectPatientOnDashboard(_nLabPatientId)
            '    End If
            'End If


            Call AddNewMessage(sender, e)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPatientLetters_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientLetters.Click
        Try
            If gnPatientID <= 0 Then
                '' This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                End If
                Exit Sub

            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If
            'Developer:Mitesh Patel
            'Date:24 May 2012 
            'Bug # 26421 
            'Dim frmlab As frmViewgloLab
            'frmlab = frmViewgloLab.GetInstance()
            'If IsNothing(frmlab) = False Then
            '    If IsNothing(frmlab.LabPatientID) = False Then
            '        If frmlab.LabPatientID <> 0 Then
            '            SelectPatientOnDashboard(frmlab.LabPatientID)
            '        End If
            '    End If
            'End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            'To check exeception related to word
            If CheckWordForException() = False Then
                Exit Sub
            End If

            '  dtWord = New DataTable  Slr new not needed 
            objWord = New clsWordDocument
            dtWord = objWord.FillTemplates(enumTemplateFlag.PatientLetters)
            objWord = Nothing
            If Not IsNothing(dtWord) Then
                If dtWord.Rows.Count = 0 Then
                    ''''If not present then exit from sub
                    MessageBox.Show("No template is associated for patient letter. Associate any template first", "patient exam", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    Dim objfrmPatientLetter As New frmPatientLetter(gnPatientID)
                    With objfrmPatientLetter
                        .MdiParent = Me
                        .myCallerMain = Me

                        .WindowState = FormWindowState.Maximized
                        .BringToFront()
                        .Show()
                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False
                    End With
                End If
            Else
                MessageBox.Show("No template is associated for patient letter. Associate any template first", "patient exam", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub

            End If
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            ShowHideMainMenu(True, True)
            MessageBox.Show(ex.ToString, "Patient Letters", MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
        End Try
    End Sub

    Private Sub mnuView_PTProtocol_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_PTProtocol.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If


                Dim frm As New frmVWPTProtocols(gnPatientID)
                'AddHandler frm.EvntGenerateCDAFromVWPTProtocols, AddressOf openCDA
                With frm
                    .MdiParent = Me
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                    .WindowState = FormWindowState.Maximized
                End With
            Else
                'This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_PatientConcent_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuView_PatientConcent.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If


                Dim frmPatConsents As New frmVWPatientConsent(gnPatientID)
                With frmPatConsents
                    .MdiParent = Me
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                    .WindowState = FormWindowState.Maximized
                End With
            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_NurseNotes_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_NurseNotes.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If

                Dim frm As New frmVWNurseNotes(gnPatientID)
                With frm
                    .MdiParent = Me
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                    .WindowState = FormWindowState.Maximized
                End With
            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'REPORTS
    Private Sub mnuReportUnfinishedExam_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuReportUnfinishedExam.Click
        Try
            frmOpenFinishExam = frmFinishExam.GetInstance(gnPatientID)
            frmOpenFinishExam.MdiParent = Me

            frmOpenFinishExam.WindowState = FormWindowState.Maximized
            frmOpenFinishExam.Show()
            ShowHideMainMenu(False, False)
            Me.pnlMainToolBar.Visible = False
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuBatchReferrals_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuBatchReferrals.Click
        Try
            'Added by Mayuri:20101110-to fix issue:#6080-multiple instance
            Dim frm As frmBatchReferrals
            frm = frmBatchReferrals.GetInstance(gnPatientID)
            If IsNothing(frm) = True Then
                Exit Sub
            End If



            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .ShowInTaskbar = False
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPendingFAXesWithMaxAttempts_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPendingFAXesWithMaxAttempts.Click
        Try

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim frm As New frmPendingFAXes(gnPatientID)
            frm.MdiParent = Me
            frm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            Me.Cursor = Cursors.Default
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPendingFAXesWithoutTIFF_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPendingFAXesWithoutTIFF.Click
        Try

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim frm As New frmPendingFAXWithOutTIFF
            frm.MdiParent = Me
            frm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            Me.Cursor = Cursors.Default
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuFAXReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuFAXReport.Click
        Try
            Dim frmReport As New frmFAXReport
            frmReport.MdiParent = Me
            frmReport.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuReportExamPrintFAX_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuReportExamPrintFAX.Click
        Try
            If Trim(gstrPatientFirstName) <> "" Then
                Dim ofrm As New frmPrintFAXExam(gnPatientID)
                With ofrm
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .ShowInTaskbar = False
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                End With
            Else
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPatientDemographics_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientDemographics.Click
        Try
            Dim frm As New frmPatient_RptViewer(gnPatientID)
            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            If Not IsNothing(frm) Then ''slr dispose  frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show("Cannot load Patient demographics", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnurptHCFAReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnurptHCFAReport.Click
        Try
            If gnPatientID > 0 Then
                Dim frm As New frmHCFAReport(gnPatientID)
                With frm
                    .ShowInTaskbar = False
                    .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
                End With
                If Not IsNothing(frm) Then ''slr dispose  frm
                    frm.Close()
                    frm.Dispose()
                    frm = Nothing
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuRptDignosisLabResult_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuRptDignosisLabResult.Click
        Try
            Dim frm As New ReportDiagnosis.frmPatientDiagnosis
            With frm
                .ShowInTaskbar = False
                .StartPosition = FormStartPosition.CenterParent
                .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            End With
            If Not IsNothing(frm) Then ''slr dispose  frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
        End Try
    End Sub

    Private Sub mnuRptIMDueReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuRptIMDueReport.Click
        Try
            ''Added by Mayuri:20101110-to fix issue:#6080-multiple instance
            Dim frm As New frmIm_DueReport(gnPatientID, "RptImmunizationDue")
            'frm = frm.GetInstance(gnPatientID, "RptImmunizationDue")
            If IsNothing(frm) = True Then
                Exit Sub
            End If

            With frm
                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
        End Try
    End Sub
    'Developer:Pradeep Godse
    'Date: 03/03/2012
    'PRD Name: Immunization Reports
    'Reason: Added new Vaccine Inventory Report
    Private Sub mnuRpt_VaccineInventoryReport_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuRpt_VaccineInventoryReport.Click
        Try
            Dim frm As New frmIm_DueReport(gnPatientID, "RptVaccineInventory")
            'frm = frm.GetInstance(gnPatientID, "RptVaccineInventory")
            If IsNothing(frm) = True Then
                Exit Sub
            End If

            With frm
                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMaster_StatusUsers_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMaster_StatusUsers.Click
        Try
            Dim frm As New frmStatusUsers
            With frm
                .ShowInTaskbar = False
                .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            End With
            If Not IsNothing(frm) Then ''slr dispose  frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuSettings_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuSettings.Click
        Try
            Dim frm As New frmSettings_New
            With frm
                .oMainFormRef = Me
                .WindowState = FormWindowState.Normal
                .StartPosition = FormStartPosition.CenterParent
                .ShowInTaskbar = False
                .tc_Settings.SelectedTab = .tc_Settings.TabPages(0)
            End With

            Dim nMsgRefeshtime As Decimal = gMessageUpdateTime
            If frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent)) = DialogResult.OK Then

                If gLockTime <= 4 Then
                    timerLockScreen.Interval = 2000
                Else
                    timerLockScreen.Interval = (gLockTime / 2 - 1) * 60000
                End If

                tmrMessages.Interval = gMessageUpdateTime * 60000

                If (gMessageUpdateTime <> nMsgRefeshtime) Then
                    tmrMessages_Tick(Nothing, Nothing)
                End If

                'Added by Shweta 20091127 
                'Against salesForce case No: GLO2009 0003137
                'To refresh the pending message alert popup after changing the setting related to it 

                If gblnSurescriptAlert = True Then
                    strMessageAlerInterval = Split(gStrSurescriptAlertmin, " ")
                    If strMessageAlerInterval.GetValue(1) = "Sec" Then
                        tmrsurescriptAlert.Interval = ((Convert.ToDouble(strMessageAlerInterval.GetValue(0))) * 1000) '  60000
                    Else
                        tmrsurescriptAlert.Interval = (((Convert.ToDouble(strMessageAlerInterval.GetValue(0))) * 60) * 1000) '  60000
                    End If
                    FillMessage()
                Else
                    FillMessage()
                End If
                'End Shweta

                'Saket 20080602
                'To Apply Setting Changes to Patient List Control
                oPatientListControl.FillPatients()
                oPatientListControl.PatientID = gnPatientID
                oPatientListControl.PatientCode = gstrPatientCode
                Call ShowPatientAllDetails(gnPatientID, , True)
                GetPatientDemographicsSettings()
                ShowAppointments()
                gloRegistrySetting.OpenSubKey(gloRegistrySetting.gstrSoftEMR, True)
                _DefaultNavigation = gloRegistrySetting.GetRegistryValue("DefaultNavigation")
                gloRegistrySetting.CloseRegistryKey()
                'gloRegistrySetting.GetRegistryValue("DefaultNavigation")
            End If
            frm.Dispose()

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuTools_CardScanner_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuTools_CardScanner.Click
        Try
            Dim ofrmScanSettings As New gloCardScanning.frmSetupScannerSettings(GetConnectionString)
            ofrmScanSettings.ShowDialog(IIf(IsNothing(ofrmScanSettings.Parent), Me, ofrmScanSettings.Parent))
            ofrmScanSettings.Dispose()
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub mnuTools_CardImage_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuTools_CardImage.Click
        Try
            Dim sc_activeWindow As IntPtr = gloWord.WordDialogBoxBackgroundCloser.GetForegroundWindow()
            Dim ofrmCardImage As New gloCardScanning.frmCardImage(GetConnectionString(), gnPatientID, sc_activeWindow)
            ofrmCardImage.StartPosition = FormStartPosition.CenterScreen
            ofrmCardImage.ShowDialog(IIf(IsNothing(ofrmCardImage.Parent), Me, ofrmCardImage.Parent))
            ofrmCardImage.Dispose()
            FillCardInformation()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuToolsDMSSettings_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub
    Private Sub mnuTools_DirectInbox_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuTools_DirectInbox.Click
        Dim _sEmail As String = String.Empty
        Dim _sPassword As String = String.Empty

        If IsvalidCredentials(gnLoginID, _sEmail, _sPassword) = True Then
            Dim ofrmability As New frmAbilitylogin(GetConnectionString(), _sEmail, _sPassword)
            ofrmability.StartPosition = FormStartPosition.CenterScreen
            ofrmability.ShowDialog(IIf(IsNothing(ofrmability.Parent), Me, ofrmability.Parent))
            ofrmability.Dispose()
        Else
            Dim ofrmUsermgmt As New frmAbilityUserMgmt(GetConnectionString(), gnLoginID)
            ofrmUsermgmt.EmailAddress = _sEmail
            ofrmUsermgmt.Password = _sPassword
            ofrmUsermgmt.ShowDialog(IIf(IsNothing(ofrmUsermgmt.Parent), Me, ofrmUsermgmt.Parent))
            If ofrmUsermgmt.DialgoResult = False Then
                ofrmUsermgmt.Dispose()
                ofrmUsermgmt = Nothing
                'Me.Close()
            Else
                Dim ofrmability As New frmAbilitylogin(GetConnectionString(), ofrmUsermgmt.EmailAddress, ofrmUsermgmt.Password)
                ofrmability.StartPosition = FormStartPosition.CenterScreen
                ofrmability.ShowDialog(IIf(IsNothing(ofrmability.Parent), Me, ofrmability.Parent))
                ofrmability.Dispose()
                ofrmability = Nothing
            End If
            If Not IsNothing(ofrmUsermgmt) Then
                ofrmUsermgmt.Dispose()
                ofrmUsermgmt = Nothing
            End If

        End If

    End Sub
    Private Sub mnuExportTemplates_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuExportTemplates.Click
        Try
            If CheckWordForException() = False Then
                Exit Sub
            End If

            Dim frmExport As New frmExportTemplates
            frmExport.MdiParent = Me
            frmExport.Show()
            ShowHideMainMenu(False, False)
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuImportTemplates_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuImportTemplates.Click
        Try

            'To check exeception related to word
            If CheckWordForException() = False Then
                Exit Sub
            End If

            Dim frmImport As New frmImportTemplates
            frmImport.MdiParent = Me
            frmImport.Show()
            ShowHideMainMenu(False, False)
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMergePatRecords_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMergePatRecords.Click
        'To Merge Patient Utility
        Dim frm As New frmMergePatientRecords
        Try
            Me.Cursor = Cursors.WaitCursor

            With frm
                .ShowInTaskbar = False
                .StartPosition = FormStartPosition.CenterParent
                .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))

                oPatientListControl.FillPatients()

                'Start :: PAtient Merge according to MU
                If frmMergePatientRecords._LPatientMergeIn <> 0 Then  '' shared in the merge patient
                    gnPatientID = frmMergePatientRecords._LPatientMergeIn
                    frmMergePatientRecords._LPatientMergeIn = 0
                End If
                'End :PAtient Merge according to MU
                oPatientListControl_GridRowSelect_Click(Nothing, Nothing)
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Me.Cursor = Cursors.Default
            If Not IsNothing(frm) Then  ''slr dispose frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If
        End Try
    End Sub

    Private Sub mnuUnlockExams_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuUnlockExams.Click
        Try
            Dim frm As New frmUnLockExams(gnPatientID)
            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_TimeSynchronization_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_TimeSynchronization.Click
        Try
            Dim frm As New frmSyncTime
            With frm
                .StartPosition = FormStartPosition.CenterParent
                .ShowInTaskbar = False
                frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            End With
            If Not IsNothing(frm) Then  ''slr dispose frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuToolsToolbar_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuToolsToolbar.Click
        Try
            mnuToolsToolbar.Checked = Not mnuToolsToolbar.Checked
            pnlMainToolBar.Visible = mnuToolsToolbar.Checked 'Not pnlMainToolBar.Visible
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuToolsStatusbar_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuToolsStatusbar.Click
        Try
            mnuToolsStatusbar.Checked = Not mnuToolsStatusbar.Checked
            pnlMainStatusBar.Visible = Not pnlMainStatusBar.Visible
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuTools_Customization_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuTools_Customization.Click
        Try
            Dim frm As New frmPatientControl_DTL
            With frm
                .ShowInTaskbar = False
                .StartPosition = FormStartPosition.CenterParent
                .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            End With
            If Not IsNothing(frm) Then  ''slr dispose frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuImportVitalGraphData_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuImportVitalGraphData.Click
        Try
            Dim oImportVitalGraphs As New frmImportVitalGraphData
            oImportVitalGraphs.ShowDialog(IIf(IsNothing(oImportVitalGraphs.Parent), Me, oImportVitalGraphs.Parent))

            If Not IsNothing(oImportVitalGraphs) Then  ''slr dispose oImportVitalGraphs
                oImportVitalGraphs.Close()
                oImportVitalGraphs.Dispose()
                oImportVitalGraphs = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ' '' Help ''''
    Private Sub mnuAboutUs_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuAboutUs.Click
        Try
            '' Dim frm As New gloTransparentScreen.gloAboutBox(gloTransparentScreen.Properties.Resources.gloEMRLOGO)
            ''   pictureBoxProgram.Image = programPicture;
            Dim frm As New frmAboutUs
            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            If Not IsNothing(frm) Then  ''slr dispose frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#End Region
    'Private Sub freemedimages()
    '    Try


    '    If Not IsNothing(frmPrescription.bmphide) Then
    '        frmPrescription.bmphide.Dispose()
    '        frmPrescription.bmphide = Nothing
    '    End If

    '    If Not IsNothing(frmPrescription.bmpshow) Then
    '        frmPrescription.bmpshow.Dispose()
    '        frmPrescription.bmpshow = Nothing
    '    End If
    '    If Not IsNothing(frmPrescription.bmplongbtn) Then
    '        frmPrescription.bmplongbtn.Dispose()
    '        frmPrescription.bmplongbtn = Nothing
    '    End If
    '    If Not IsNothing(frmPrescription.bmplongor) Then
    '        frmPrescription.bmplongor.Dispose()
    '        frmPrescription.bmplongor = Nothing
    '    End If

    '    If Not IsNothing(frmPrescription.bmpImg_Button) Then
    '        frmPrescription.bmpImg_Button.Dispose()
    '        frmPrescription.bmpImg_Button = Nothing
    '    End If
    '    If Not IsNothing(frmPrescription.bmp_Img_Toolstrip) Then
    '        frmPrescription.bmp_Img_Toolstrip.Dispose()
    '        frmPrescription.bmp_Img_Toolstrip = Nothing
    '    End If

    '    If Not IsNothing(frmPrescription.bmp_img_gradient) Then
    '        frmPrescription.bmp_img_gradient.Dispose()
    '        frmPrescription.bmp_img_gradient = Nothing
    '    End If


    '    If Not IsNothing(frmPrescription.bmpimg_rx_green) Then
    '        frmPrescription.bmpimg_rx_green.Dispose()
    '        frmPrescription.bmpimg_rx_green = Nothing
    '    End If
    '        If Not IsNothing(gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitinfo) Then
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitinfo.Dispose()
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitinfo = Nothing
    '        End If


    '        If Not IsNothing(gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitNot_Reimbursable) Then
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitNot_Reimbursable.Dispose()
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitNot_Reimbursable = Nothing
    '        End If

    '        If Not IsNothing(gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitOn_Formulary) Then
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitOn_Formulary.Dispose()
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitOn_Formulary = Nothing
    '        End If

    '        If Not IsNothing(gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitOff_Formulary) Then
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitOff_Formulary.Dispose()
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitOff_Formulary = Nothing
    '        End If

    '        If Not IsNothing(gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitU) Then
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitU.Dispose()
    '            gloUserControlLibrary.gloRxC1FlexGrdPrescriptionUserCtrl.bitU = Nothing
    '        End If

    '        If Not IsNothing(gloUserControlLibrary.gloMedicationC1FlexGrdUserCtrl.bmpinfo) Then
    '            gloUserControlLibrary.gloMedicationC1FlexGrdUserCtrl.bmpinfo.Dispose()
    '            gloUserControlLibrary.gloMedicationC1FlexGrdUserCtrl.bmpinfo = Nothing
    '        End If
    '    Catch ex As Exception

    '    End Try
    'End Sub
    '''' Integrated Support''''
    Private Sub mnuSupport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuSupport.Click
        Try
            Dim frm As New gloGlobal.Support.frmSupport(mdlGeneral.gstrAUSID, mdlGeneral.gstrVersion, mdlGeneral.gstrDatabaseName, mdlGeneral.gstrLoginName)
            frm.Show()
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#Region " V o i c e "

    Private Sub mnuDoctorSpeakerConfiguration_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuDoctorSpeakerConfiguration.Click
        Try
            Dim frm As New frmDoctorSpeakerConfiguration
            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            If Not IsNothing(frm) Then  ''slr free frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuToolsVoiceCenter_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuToolsVoiceCenter.Click
        Try
            ' ''DB

            Dim frmVoice As New frmVoiceCenter(DgnEngineControl1)
            ' Dim clSpeakers As New Collection  Slr not used

            frmVoice.MdiParent = Me
            frmVoice.WindowState = FormWindowState.Maximized

            frmVoice.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False


        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Function GetProcessOwnerName(ByVal ProcessName As String) As String

        Try
            Dim ProcessOwner As String = ""
            Dim x As New ObjectQuery("Select * From Win32_Process where Name ='" & ProcessName & "'")
            Using mos As New ManagementObjectSearcher(x)

                For Each mo As ManagementObject In mos.[Get]()
                    Dim s As String() = New String(1) {}
                    mo.InvokeMethod("GetOwner", DirectCast(s, Object()))
                    ProcessOwner = s(0).ToString()
                    s = Nothing
                    Exit For
                Next
                Return ProcessOwner
            End Using
            x = Nothing
        Catch ex As Exception
            'MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            'Return Nothing
            '11-Nov-14 Aniket: Bug #75482: gloEMR > Showing exception while first time login to gloEMR application
            Return ""
        End Try
    End Function

    'Ensure that all the voice components have been unregistered before 
    Private Sub CleanUpVoiceComponents()
        ''DB
        Dim myProcesses() As Process = Process.GetProcessesByName("natspeak")
        If Not IsNothing(myProcesses) Then
            For Each tempvoiceprocess As Process In myProcesses
                'If tempvoiceprocess.ProcessName = "natspeak" Then
                If (GetProcessOwnerName(tempvoiceprocess.MainModule.ModuleName).Equals(Environment.UserName)) Then
                    If Not tempvoiceprocess.HasExited Then
                        tempvoiceprocess.Kill()
                    End If
                    tempvoiceprocess.Close()
                    Exit For
                End If
                'End If
            Next
            myProcesses = Nothing
        End If

    End Sub
    Private Sub CleanUpMyVoiceComponents()
        ''DB
        'Dim session As Integer = Process.GetCurrentProcess().SessionId
        Dim myProcesses() As Process = Process.GetProcessesByName("natspeak")
        If Not IsNothing(myProcesses) Then
            For Each voiceprocessHere As Process In myProcesses
                If (voiceprocessHere.SessionId = gloWord.LoadAndCloseWord.CurrentSessionID) Then

                    If Not voiceprocessHere.HasExited Then
                        voiceprocessHere.Kill()
                    End If
                    voiceprocessHere.Close()
                    Exit For
                End If

            Next
            myProcesses = Nothing
        End If

    End Sub
    Private Sub DgnEngineControl1_RecognitionStarting(ByVal sender As Object, ByVal e As System.EventArgs)
        blnIsDictationOn = True
    End Sub

    Private Sub DgnEngineControl1_RecognitionStarting1(ByVal sender As Object, ByVal e As System.EventArgs) Handles DgnEngineControl1.RecognitionStarting

    End Sub

    Private Sub DgnEngineControl1_SpeakerChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles DgnEngineControl1.SpeakerChanged
        Try
            ''DB
            'the speaker close event is invoked when unloading the application
            If intstatus = 1 Then
                DgnEngineControl1.UnRegister(False)
                CleanUpVoiceComponents() 'SLR: changed to intialize voiceprocess.
                'If (GetProcessOwnerName(voiceprocess.MainModule.ModuleName).Equals(Environment.UserName)) Then
                '    If Not voiceprocess.HasExited Then
                '        voiceprocess.Kill()
                '    End If
                '    voiceprocess.Close()
                'End If

                intstatus = 0
            End If
        Catch ex As Exception
            MessageBox.Show("Error Saving Voice Files", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Friend Sub InitialiseVoiceinExam()
        Try
            If gblnSpeakerExists = True AndAlso Not IsNothing(DgnEngineControl1.Speaker) Then
                Dim strMenuName As String

                'Recreate new instance of the voice menu.
                strMenuName = "gloEMRVoice" & CType(System.DateTime.Now.Year, String) & CType(System.DateTime.Now.Month, String) & CType(System.DateTime.Now.Day, String) & CType(System.DateTime.Now.Hour, String) & CType(System.DateTime.Now.Minute, String) & CType(System.DateTime.Now.Second, String)
                vVoiceMenu = Vcmd.MenuCreate(strMenuName, strMenuName & "1", DNSTools.DgnLanguageConstants.dgnlangUSEnglish, "", DNSTools.CREATEFLAGS.vcmdmc_CREATE_TEMP)
                vVoiceMenu.hWndMenu = Me.Handle.ToInt32
                vVoiceMenu.Active = True

                'Add voice commands to the voice menu.
                If Not IsNothing(vVoiceMenu) Then
                    Dim I As gloVoice
                    Try
                        I = CType(Me.ActiveMdiChild, gloVoice)
                        I.AddVoiceCommands()
                    Catch ex As Exception

                    End Try
                End If
            End If
        Catch ex As Exception
            MsgBox("Error Initializing Exam")
        End Try
    End Sub

    Private Sub Unload_VoiceEngine()

        Try

            If blnCompatibilityModulesSet = True Then

                For Each voiceprocesstemp As System.Diagnostics.Process In Process.GetProcessesByName("natspeak")

                    If strSpeakerName <> "" AndAlso gblnSpeakerExists = True Then

                        'code commented as logic to switch microphone has changed
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Siwtch off Mic Started at Main menu Unload_VoiceEngine", gloAuditTrail.ActivityOutCome.Success)

                        If Not IsNothing(DgnMicBtn1.MicState) Then
                            If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                                DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                            End If
                        End If
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Siwtch off Mic Completed at Main menu Unload_VoiceEngine", gloAuditTrail.ActivityOutCome.Success)

                        If Not IsNothing(vVoiceMenu) Then
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "VoiceMenu Destruction Started at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)
                            vVoiceMenu.Remove(1)
                            vVoiceMenu.Remove(2)
                            vVoiceMenu.Active = False
                            System.Runtime.InteropServices.Marshal.ReleaseComObject(vVoiceMenu)
                            vVoiceMenu = Nothing
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "VoiceMenu Destruction Completed at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)
                        End If

                        'code commented from 20/05/2006 (meeting with oscar--Mphone Registered at form load and unregistered at form unload)
                        'DgnMicBtn1.UnRegister()
                        'code commented from 20/05/2006 (meeting with oscar--Mphone Registered at form load and unregistered at form unload)

                        If Not IsNothing(DgnEngineControl1.Speaker) Then
                            If DgnEngineControl1.Speakers.Count > 0 Then
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Voice Command UnRegistration Started at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)

                                If Not IsNothing(Vcmd) Then
                                    Vcmd.UnRegister()
                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Voice Command UnRegistration Completed at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)
                                End If

                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Voice Command UnRegistration Completed at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)
                                DgnEngineControl1.SpeakerSave()
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Speaker Save Completed at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic UnRegistration Started at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)

                                If Not IsNothing(DgnMicBtn1) Then
                                    DgnMicBtn1.UnRegister()
                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic UnRegistration Completed at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)
                                End If

                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Engine UnRegistration Started at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)
                                DgnEngineControl1.UnRegister(False)
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Engine UnRegistration Completed at Main menu Unload_VoiceEngine(speaker loaded)", gloAuditTrail.ActivityOutCome.Success)
                            End If
                        End If
                    ElseIf gblnIsAdmin = True AndAlso gstrLoginProviderName = "" Then
                        If Not IsNothing(DgnEngineControl1.Speaker) Then
                            If DgnEngineControl1.Speaker <> "" Then

                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Speaker Save Started at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                                DgnEngineControl1.SpeakerSave()
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Speaker Save Completed at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                            End If

                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic UnReg Started at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                            DgnMicBtn1.UnRegister()
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic UnReg Completed at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)

                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Engine UnReg Started at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                            DgnEngineControl1.UnRegister(False)
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Engine UnReg Completed at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                        Else
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic UnReg Started at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                            DgnMicBtn1.UnRegister()
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic UnReg Started at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Engine UnReg Started at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                            DgnEngineControl1.UnRegister(False)
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Engine UnReg Started at Main menu Unload_VoiceEngine(User is admin and provider is empty)", gloAuditTrail.ActivityOutCome.Success)
                        End If
                        'user is having valid provider (but no speaker)
                    Else
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic UnReg Started at Main menu Unload_VoiceEngine(user is having valid provider (but no speaker))", gloAuditTrail.ActivityOutCome.Success)
                        DgnMicBtn1.UnRegister()
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic UnReg Started at Main menu Unload_VoiceEngine(user is having valid provider (but no speaker))", gloAuditTrail.ActivityOutCome.Success)
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Engine UnReg Started at Main menu Unload_VoiceEngine(user is having valid provider (but no speaker))", gloAuditTrail.ActivityOutCome.Success)
                        DgnEngineControl1.UnRegister(False)
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Engine UnReg Completed at Main menu Unload_VoiceEngine(user is having valid provider (but no speaker))", gloAuditTrail.ActivityOutCome.Success)
                    End If

                    Exit For
                    'End If
                Next
            End If

        Catch ex As Exception
            MsgBox("Error unloading voice components")
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Error Doing Voice Cleanup at Main menu Unload_VoiceEngine. Error Message - " & ex.Message, gloAuditTrail.ActivityOutCome.Failure)
        Finally
            System.Threading.Thread.Sleep(2500)
        End Try
    End Sub

    Private Sub Load_VoiceEngine(ByVal _speakerRow As Int64)

        Try

            ''DB
            'check if user is admin if so then make doctorspekaer configuration available
            'also make voice center form visible.
            'if user is not admin then hide doctor speaker form ,voice center is visible
            If gblnIsAdmin Then
                mnuDoctorSpeakerConfiguration.Visible = True
                mnuToolsVoiceCenter.Visible = True
                sep18.Visible = True
            End If
            'check if provider has been mapped to the user i.e user is a provider
            If Trim(gstrLoginProviderName) <> "" Then
                'check if logged in user is an admin if the user is an admin then
                'doctorspeaker is visible else it is not visible
                'Also 
                sslbl_VoiceInfo.Text = ""
                'if voice file successfully loaded and engine successfully registered
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill Speakers Started at form load ", gloAuditTrail.ActivityOutCome.Success)
                Fill_Speakers(_speakerRow)
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill Speakers Completed at form load ", gloAuditTrail.ActivityOutCome.Success)

                If SpeakerStatus = 1 Then
                    ''Start'GLO2010-0006508 :: No voice user error message :: Need to change message
                    'MessageBox.Show("There are No Speakers on this System that Match Current Provider/Speaker Configuration", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    MessageBox.Show("There are no voice profiles currently set up that match current provider/speaker configuration.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    ''End'Start'GLO2010-0006508 :: No voice user error message :: Need to change message
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill Speakers Exited at form load SpeakerStatus=1", gloAuditTrail.ActivityOutCome.Success)
                    Exit Sub
                ElseIf SpeakerStatus = 2 Then
                    MessageBox.Show("There are no speakers configured against the current provider.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill Speakers Exited at form load SpeakerStatus=2", gloAuditTrail.ActivityOutCome.Success)
                    Exit Sub
                ElseIf SpeakerStatus = 3 Then
                    MessageBox.Show("There are no speakers created on this machine.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill Speakers Exited at form load SpeakerStatus=3", gloAuditTrail.ActivityOutCome.Success)
                    Exit Sub
                End If

                If _arrTopics.Count > 0 Then
                    Try
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Load Speaker at form load started", gloAuditTrail.ActivityOutCome.Success)
                        DgnEngineControl1.SpeakerTopicSelect(strSpeakerName, _arrTopics.Item(0).ToString)
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Load Speaker at form load completed", gloAuditTrail.ActivityOutCome.Success)
                        gstrCurrentSpeaker = strSpeakerName

                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Voice Component registration started at form load started", gloAuditTrail.ActivityOutCome.Success)
                        Call RegisterVoice()
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Voice Component registration completed at form load completed", gloAuditTrail.ActivityOutCome.Success)

                        sslbl_CurrentSpeaker.Text = "Current Speaker :- " & Trim(strSpeakerName)
                        mnuToolsVoiceCenter.Visible = True
                        sep18.Visible = True
                        Exit Sub
                    Catch ex As Exception
                        _speakerRow = _speakerRow + 1
                        If _speakerRow > SpeakerCount Then
                            If ex.Message.Contains("Access is denied") Then
                                MessageBox.Show("The voice profile for this user is locked on another machine/session. Please release that voice profile to continue." & vbCrLf & vbCrLf & "If you are seeing this message regularly then you can create multiple voice profiles for this user.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Warning)
                            Else
                                MessageBox.Show("Could not load Speaker. The following exception occured:" & vbCrLf & ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                            End If
                            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Speaker could not be loaded at form load " & ex.Message, gloAuditTrail.ActivityOutCome.Failure)
                            strSpeakerName = ""
                            gblnSpeakerExists = False
                            SpeakerCount = 0
                            Exit Sub
                        Else
                            Load_VoiceEngine(_speakerRow)
                        End If
                    End Try
                Else
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Provider is empty at form load", gloAuditTrail.ActivityOutCome.Success)
                    strSpeakerName = ""
                    gblnSpeakerExists = False
                    MessageBox.Show("There are No Topics found against the current speaker", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                End If
            End If

        Catch ex As Exception

            '21-Nov-14 Aniket: Resolving Bug #76246: gloEMR-While logged in to gloEMR getting an exception
            If ex.ToString.Contains("System.ArgumentException: Invalid argument passed to method.") Then
                MessageBox.Show("Speaker directory not found. Please check if speaker directory exists.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            Else
                Throw ex
            End If


        End Try

    End Sub

    Private Sub Fill_Speakers(ByVal _speakerRow As Int64)

        Dim objConfig As New clsDoctorSpeakerConfiguration
        Dim ds As DataSet

        ds = objConfig.RetrieveSpeaker(gstrClientMachineName, gstrLoginProviderName, _speakerRow)

        If ds.Tables("SpeakerName").Rows.Count > 0 AndAlso DgnEngineControl1.Speakers.Count >= 1 Then
            gblnSpeakerExists = True

            If blnCompatibilityModulesSet = False Then
                SetCompatibilityModules()
            End If

            'Fill_speakers has been called while switching to a new speaker.
            Try

                'if function called when logging in as a new user then fill speaker for defaul 'provider
                If Not IsNothing(ds) Then
                    If ds.Tables.Count > 0 Then
                        If ds.Tables("SpeakerName").Rows.Count > 0 Then
                            strSpeakerName = ds.Tables("SpeakerName").Rows(0)(0)
                        End If
                        If ds.Tables("SpeakerCount").Rows.Count > 0 Then
                            SpeakerCount = ds.Tables("SpeakerCount").Rows(0)(0)
                        End If

                    End If
                End If

            Catch ex As Exception
                gblnSpeakerExists = False
                strSpeakerName = ""
                gstrCurrentSpeaker = ""
                SpeakerStatus = 3
                SpeakerCount = 0
                Exit Sub
            End Try

            objConfig = Nothing
            'check if speaker exists
            If Not IsNothing(strSpeakerName) Then
                'check if speaker is present on machine
                If ValidateSpeaker() Then
                    Fill_Topics()
                    SpeakerStatus = 0
                    gblnSpeakerExists = True
                Else
                    'Speaker does not coincide with Provider/Speaker configuration
                    SpeakerStatus = 1
                    gblnSpeakerExists = False
                    gstrCurrentSpeaker = ""
                End If
            Else
                'No Speakers configured against the current provider
                SpeakerStatus = 2
                gblnSpeakerExists = False
                gstrCurrentSpeaker = ""
            End If
        Else
            'No speakers created on this machine
            SpeakerStatus = 3
            gblnSpeakerExists = False
            gstrCurrentSpeaker = ""
        End If

        'Speaker does not coincide with Provider/Speaker configuration
        'No Speakers configured against the current provider
        'No speakers created on this machine

    End Sub

    Private Sub btnOpenSperaker_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) ''DB Handles btnOpenSperaker.Click

    End Sub

    Private Function checkChanges()
        If DgnEngineControl1.Speaker <> "" AndAlso DgnEngineControl1.SpeakerModified Then
            DgnEngineControl1.SpeakerSave()
            Return True
        Else
            Return True
        End If
    End Function

    Private Function LoadSpeakerAndTopic() As Object
        Dim CreateSpeakerAndTopic As Object
        Dim NewTopic As String
        If gstrCurrentSpeaker = "" Then
            MsgBox("Speaker name cannot be empty!")
            Return False
        End If

        ' Looking whether this speaker already exists.
        ' Speaker was already created. Use the topic selected by user.
        NewTopic = _arrTopics.Item(0).ToString

SelectSpeakerAndTopic:
        ' Selecting(loading) the speaker and topic.
        On Error GoTo Cannot_Load_Speaker
        DgnEngineControl1.SpeakerTopicSelect(gstrCurrentSpeaker, NewTopic)
        Return True
Cannot_Load_Speaker:
        ' Handle "locked user" situation for Roaming User.
        If Err.Number = DNSTools.DgnErrorCodeConstants.dgnerrRoamingMasterLockExists Then
            ' Ask the user whether he wants to break the lock.
            If MsgBox("User " + gstrCurrentSpeaker + " is locked, and thus cannot be accessed." + vbCrLf + _
                        "This could happen because another computer is opening or saving this user." + _
                        "In this case, please wait a moment and try again.  If you choose to break " + _
                        "the lock, it is possible your user will become corrupted or data will be lost." + _
                        vbCrLf + "Break the lock?", vbYesNo Or vbExclamation, Text) = vbYes Then
                ' Break the lock and retry the loading attempt.
                DgnEngineControl1.RoamingUserBreakLockNow()
                GoTo SelectSpeakerAndTopic
            End If
        Else
            MsgBox("Cannot load speaker." & vbCrLf & "Reason : " & Err.Description)
        End If
        Return False
    End Function

    Private Sub cmbSpeaker_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) ''DB Handles cmbSpeaker.SelectedIndexChanged
        Call Fill_Topics()
    End Sub

    Private Sub Fill_Topics()
        _arrTopics.Clear()
        Dim I As Integer
        For I = 1 To DgnEngineControl1.get_Topics(strSpeakerName).Count
            _arrTopics.Add(DgnEngineControl1.get_Topics(strSpeakerName).Item(I))
        Next
    End Sub

    Private Sub RegisterVoice()
        On Error GoTo Cannot_Load_Speaker
        DgnEngineControl1.set_CompatibilityModule(DNSTools.DgnCompatibilityModuleConstants.dgncompmoduleAll, -1, True)
        Vcmd.Register("", DNSTools.DgnRegisterConstants.dgnregNoTrayMic)
        Exit Sub
Cannot_Load_Speaker:
        ' Handle "locked user" situation for Roaming User.
        If Err.Number = DNSTools.DgnErrorCodeConstants.dgnerrRoamingMasterLockExists Then
            ' Ask the user whether he wants to break the lock.
            If MsgBox("User " + gstrCurrentSpeaker + " is locked, and thus cannot be accessed." + vbCrLf + _
                "This could happen because another computer is opening or saving this user." + _
                "In this case, please wait a moment and try again.  If you choose to break " + _
                "the lock, it is possible your user will become corrupted or data will be lost." + _
                vbCrLf + "Break the lock?", vbYesNo Or vbExclamation, Text) = vbYes Then

                ' Break the lock and retry the loading attempt.
                DgnEngineControl1.RoamingUserBreakLockNow()
                'GoTo SelectSpeakerAndTopic
            End If
        ElseIf Err.Number <> 5 Then
            MsgBox("Cannot load speaker." & vbCrLf & "Reason : " & Err.Description)
        End If
    End Sub

    Private Sub VoiceSettings()
        If gblnVoiceEnabled = False Then
            mnuToolsVoiceCenter.Visible = False
            mnuDoctorSpeakerConfiguration.Visible = False
            sep18.Visible = False
            sslbl_VoiceInfo.Text = "No Voice Facility"
        Else
            Call Fill_Speakers(1)
            mnuToolsVoiceCenter.Visible = True
            mnuDoctorSpeakerConfiguration.Visible = True
            sep18.Visible = True
        End If
    End Sub

    Private Sub SetCompatibilityModules()
        'Register the Engine

        'Dim myDragonControl As DragonControl = New DragonControl()

        Try
            blnCompatibilityModulesSet = True
            Try
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Engine registration started at form load", gloAuditTrail.ActivityOutCome.Success)
                DgnEngineControl1.Register(DNSTools.DgnRegisterConstants.dgnregNoTrayMic)
                'myDragonControl.Register(DgnEngineControl1)
                'DragonControl.Register(DgnEngineControl1)
            Catch ex As System.Runtime.InteropServices.COMException
                gblnVoiceEnabled = False
                gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Engine could not be registered at form load " & ex.Message, gloAuditTrail.ActivityOutCome.Failure)
                Exit Sub
            Catch ex As Exception
                gblnVoiceEnabled = False
                gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Engine could not be registered at form load " & ex.Message, gloAuditTrail.ActivityOutCome.Failure)
                Exit Sub
            End Try
            'Set Compatibility modules
            DgnEngineControl1.set_CompatibilityModule(DNSTools.DgnCompatibilityModuleConstants.dgncompmoduleEditControlSupport, -1, False)
            DgnEngineControl1.set_CompatibilityModule(DNSTools.DgnCompatibilityModuleConstants.dgncompmoduleNatText, -1, False)
            DgnEngineControl1.set_CompatibilityModule(DNSTools.DgnCompatibilityModuleConstants.dgncompmoduleWord, -1, True)
            DgnEngineControl1.set_CompatibilityModule(DNSTools.DgnCompatibilityModuleConstants.dgncompmoduleExcel, -1, False)
            DgnEngineControl1.set_CompatibilityModule(DNSTools.DgnCompatibilityModuleConstants.dgncompmoduleWordPerfect, -1, False)

            If DgnEngineControl1.Speakers.Count > 0 Then
                'Register Microphone
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Microphone registration Started at form load", gloAuditTrail.ActivityOutCome.Success)
                DgnMicBtn1.Register(DNSTools.DgnRegisterConstants.dgnregNoTrayMic)
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Microphone registration Completed at form load", gloAuditTrail.ActivityOutCome.Success)
            End If

            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Engine registration Completed at form load", gloAuditTrail.ActivityOutCome.Success)
        Catch ex As System.Runtime.InteropServices.COMException
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Compatibility Modules/Mic reg could not be done at form load " & ex.Message, gloAuditTrail.ActivityOutCome.Failure)
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Compatibility Modules/Mic reg could not be done at form load " & ex.Message, gloAuditTrail.ActivityOutCome.Failure)
        End Try

    End Sub

    Private Function ValidateSpeaker() As Boolean
        Dim speaker As Object
        For Each speaker In DgnEngineControl1.Speakers
            If strSpeakerName = speaker Then
                Return True
                Exit Function
            End If
        Next
        Return False
    End Function

    Private Sub LoadVoicefornewuser()
        ''DB
        Try
            'Refresh Variables
            gstrLoginProviderName = ""
            strSpeakerName = ""
            gblnSpeakerExists = False
            SpeakerStatus = 0
            sslbl_CurrentSpeaker.Text = ""
            _arrTopics.Clear()

            'Fill providers against the new user and set gstrProvidername
            'to the new provider
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill_ProvidersAndPatients started at lock screen where system is voice enabled", gloAuditTrail.ActivityOutCome.Success)
            Fill_ProvidersAndPatients()
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill_ProvidersAndPatients Completed at lock screen where system is voice enabled", gloAuditTrail.ActivityOutCome.Success)
            'if voice has been enabled then load the voice engine
            'and also load speaker if a valid speaker exists
            SwitchUsers(1)
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Error at LoadVoicefornewuser - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub

    Private Sub SwitchUsers(ByVal _speakerRow As Int64)
        ''DB 
        Try
            'default provider exists
            If gblnIsAdmin Then
                mnuDoctorSpeakerConfiguration.Visible = True
                mnuToolsVoiceCenter.Visible = True
                sep18.Visible = True
            Else
                mnuDoctorSpeakerConfiguration.Visible = False
                mnuToolsVoiceCenter.Visible = False
                sep18.Visible = False
            End If
            If gstrLoginProviderName <> "" Then
                blnIsload = True
                Try
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill_Speakers started at lock screen where system is voice enabled", gloAuditTrail.ActivityOutCome.Success)
                    Call Fill_Speakers(_speakerRow)
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill_Speakers Completed at lock screen where system is voice enabled", gloAuditTrail.ActivityOutCome.Success)
                Catch ex As Exception

                Finally
                    blnIsload = False
                End Try

                If SpeakerStatus = 1 Then
                    ''Start'GLO2010-0006508 :: No voice user error message :: Need to change message
                    MessageBox.Show("There are no voice profiles currently set up that match current provider/speaker configuration", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    ''End'Start'GLO2010-0006508 :: No voice user error message :: Need to change message
                    Me.Cursor = Cursors.Default
                    If DgnEngineControl1.Speaker <> "" Then
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill Speakers Exited at SwitchUsers SpeakerStatus=1", gloAuditTrail.ActivityOutCome.Success)
                        DgnEngineControl1.UnloadCompatibilityModules()
                        DgnEngineControl1.SpeakerClose()
                    End If
                    Exit Sub
                ElseIf SpeakerStatus = 2 Then
                    MessageBox.Show("There are No Speakers Configured against the Current Provider", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Me.Cursor = Cursors.Default
                    If DgnEngineControl1.Speaker <> "" Then
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill Speakers Exited at SwitchUsers SpeakerStatus=2", gloAuditTrail.ActivityOutCome.Success)
                        DgnEngineControl1.UnloadCompatibilityModules()
                        DgnEngineControl1.SpeakerClose()
                    End If
                    Exit Sub
                ElseIf SpeakerStatus = 3 Then
                    MessageBox.Show("There are No Speakers Created on this Machine", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Me.Cursor = Cursors.Default
                    If DgnEngineControl1.Speaker <> "" Then
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill Speakers Exited at SwitchUsers SpeakerStatus=3", gloAuditTrail.ActivityOutCome.Success)
                        DgnEngineControl1.UnloadCompatibilityModules()
                        DgnEngineControl1.SpeakerClose()
                    End If
                    Exit Sub
                End If

                If _arrTopics.Count > 0 Then
                    'if there is an error loading speaker then
                    Try
                        Try

                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Load Speakers Started at SwitchUsers", gloAuditTrail.ActivityOutCome.Success)
                            DgnEngineControl1.SpeakerTopicSelect(strSpeakerName, _arrTopics.Item(0).ToString)
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Load Speakers Completed at SwitchUsers", gloAuditTrail.ActivityOutCome.Success)
                        Catch ex As Exception
                            _speakerRow = _speakerRow + 1
                            If _speakerRow > SpeakerCount Then
                                If ex.Message.Contains("Access is denied") Then
                                    MessageBox.Show("The voice profile for this user is locked on another machine/session. Please release that voice profile to continue." & vbCrLf & vbCrLf & "If you are seeing this message regularly then you can create multiple voice profiles for this user.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Warning)
                                Else
                                    MessageBox.Show("Could not load Speaker. The following exception occured:" & vbCrLf & ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                                End If

                                gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Error Loading Speakers at SwitchUsers " & ex.Message, gloAuditTrail.ActivityOutCome.Failure)
                                strSpeakerName = ""
                                gstrCurrentSpeaker = ""
                                gblnSpeakerExists = False
                                If DgnEngineControl1.Speaker <> "" Then
                                    DgnEngineControl1.SpeakerSave()
                                End If
                                Me.Cursor = Cursors.Default
                                Exit Sub
                            Else
                                SwitchUsers(_speakerRow)
                            End If
                        End Try
                        gstrCurrentSpeaker = strSpeakerName
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Voice Component Registration Started at SwitchUsers", gloAuditTrail.ActivityOutCome.Success)

                        Call RegisterVoice()

                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Voice Component Registration Completed at SwitchUsers", gloAuditTrail.ActivityOutCome.Success)

                        sslbl_CurrentSpeaker.Text = "Current Speaker :- " & Trim(strSpeakerName)
                        mnuToolsVoiceCenter.Visible = True
                        sep18.Visible = True
                    Catch ex As Exception
                        _speakerRow = _speakerRow + 1
                        If _speakerRow > SpeakerCount Then
                            If ex.Message.Contains("Access is denied") Then
                                MessageBox.Show("The voice profile for this user is locked on another machine/session. Please release that voice profile to continue." & vbCrLf & vbCrLf & "If you are seeing this message regularly then you can create multiple voice profiles for this user.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Warning)
                            Else
                                MessageBox.Show("Could not Load Voice Components for speaker: " & strSpeakerName, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                            End If

                            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Error Loading Voice Components for a speaker at SwitchUsers " & ex.Message & " at " & ex.StackTrace, gloAuditTrail.ActivityOutCome.Failure)
                            strSpeakerName = ""
                            gstrCurrentSpeaker = ""
                            gblnSpeakerExists = False
                            If DgnEngineControl1.Speaker <> "" Then
                                DgnEngineControl1.SpeakerSave()
                            End If
                            Me.Cursor = Cursors.Default
                            SpeakerCount = 0
                            Exit Sub
                        Else
                            SwitchUsers(_speakerRow)
                        End If
                    End Try
                Else
                    MessageBox.Show("There are No Topics found against the current speaker", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    strSpeakerName = ""
                    gstrCurrentSpeaker = ""
                    gblnSpeakerExists = False
                    If DgnEngineControl1.Speaker <> "" Then
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Close Speaker Started at SwitchUsers(No Topics fund for new user)", gloAuditTrail.ActivityOutCome.Success)
                        DgnEngineControl1.UnloadCompatibilityModules()
                        DgnEngineControl1.SpeakerClose()

                    End If
                    Me.Cursor = Cursors.Default
                    Exit Sub
                End If
            ElseIf gstrLoginProviderName = "" Then
                If DgnEngineControl1.Speaker <> "" Then
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Close Speaker Started at SwitchUsers (ProviderName Empty for new user)", gloAuditTrail.ActivityOutCome.Success)
                    DgnEngineControl1.UnloadCompatibilityModules()
                    DgnEngineControl1.SpeakerClose()
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Error at SwithUsers - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub

    Private Sub VCmd_CommandOther(ByVal sender As Object, ByVal e As AxDNSTools._DDgnVCmdEvents_CommandOtherEvent)

    End Sub

    Private Sub VCmd_CommandRecognize(ByVal eventSender As System.Object, ByVal e As AxDNSTools._DDgnVCmdEvents_CommandRecognizeEvent) Handles Vcmd.CommandRecognize
        Dim blnCmdFlag As Boolean = False
        Try
            If e.iD > 0 Then
                If Not myRefCaller Is Nothing Then
                    Select Case e.iD
                        Case 1
                            myRefCaller.ActivateBasicVoiceCmds(e.listResults)
                        Case 2
                            myRefCaller.ActivateVoiceCmds(e.listResults)
                            If e.listResults.Item(1) = "Finish Exam" Then
                                blnCmdFlag = True
                            End If
                    End Select
                ElseIf Me.ActiveMdiChild.Name = "frmTemplateGallery" Or Me.ActiveMdiChild.Name = "frmPatientExam" Or Me.ActiveMdiChild.Name = "frmMessages" Or Me.ActiveMdiChild.Name = "frmPatientLetter" Or Me.ActiveMdiChild.Name = "frm_LM_Orders" Or Me.ActiveMdiChild.Name = "frmPTProtocols" Or Me.ActiveMdiChild.Name = "frmNurseNotes" Or Me.ActiveMdiChild.Name = "frmPatientConsent" Or Me.ActiveMdiChild.Name = "frmPatientEducation" Or Me.ActiveMdiChild.Name = "frmDisclosureMgmt" Or Me.ActiveMdiChild.Name = "frmTriage" Or Me.ActiveMdiChild.Name = "frmCPTTemplate" Or Me.ActiveMdiChild.Name = "frmDM_Template" Or Me.ActiveMdiChild.Name = "frmMSTTemplateGallery" Then
                    Dim I As gloVoice
                    I = CType(Me.ActiveMdiChild, gloVoice)
                    Select Case e.iD
                        Case 1
                            I.ActivateBasicVoiceCmds(e.listResults)
                        Case 2
                            I.ActivateVoiceCmds(e.listResults)
                            If e.listResults.Item(1) = "Finish Exam" Then
                                blnCmdFlag = True
                            End If
                    End Select
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Cannot Execute Voice Command - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show("Cannot Execute Voice Command", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If blnCmdFlag = True Then
                frmPatientExam.blnVoiceVcmd = True
            End If
        End Try
    End Sub

    Private Sub DgnMicBtn1_MicStateEvent(ByVal sender As System.Object, ByVal e As AxDNSTools._DDgnMicBtnEvents_MicStateEvent) Handles DgnMicBtn1.MicStateEvent

        Try
            If Not IsNothing(Me.ActiveMdiChild) Then
                If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                    IsDectaionInProgress = False
                    If IsNothing(TimerWritting) = True Then
                        TimerWritting = New Windows.Forms.Timer
                        RemoveHandler TimerWritting.Tick, AddressOf TimerWrittingClick
                        AddHandler TimerWritting.Tick, AddressOf TimerWrittingClick
                        TimerWritting.Interval = 1000
                    End If
                    If IsNothing(TimerpnlUtteranceProgress) = True Then
                        TimerpnlUtteranceProgress = New Windows.Forms.Timer
                        RemoveHandler TimerpnlUtteranceProgress.Tick, AddressOf TimerpnlUtteranceProgressClick
                        AddHandler TimerpnlUtteranceProgress.Tick, AddressOf TimerpnlUtteranceProgressClick
                        TimerpnlUtteranceProgress.Interval = 2000
                    End If
                End If
            End If
            If gblnVoiceEnabled = True AndAlso gblnSpeakerExists = True Then

                If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff Then
                    'when microphone is switched off Enable lock screen
                    If Not IsNothing(Me.ActiveMdiChild) Then
                        If Me.ActiveMdiChild.Name = "frmVoiceCenter" Then
                            blnMicrophoneOn = True
                        Else
                            blnMicrophoneOn = False
                        End If
                    Else
                        blnMicrophoneOn = False
                    End If

                    '' 20090514 Code added by Mahesh  
                    '' To detect the Dictaion is on (to solve the lockscreen whiile dectation issue)
                    blnIsDictationOn = False
                    ''
                    If Not IsNothing(Me.ActiveMdiChild) Then
                        If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                            If IsNothing(TimerWritting) = False Then
                                TimerWritting.Stop()
                                TimerWritting.Dispose()
                                TimerWritting = Nothing
                            End If
                            If IsNothing(TimerpnlUtteranceProgress) = False Then
                                TimerpnlUtteranceProgress.Stop()
                                TimerpnlUtteranceProgress.Dispose()
                                TimerpnlUtteranceProgress = Nothing
                            End If
                            IsHoKeyPressed = False
                        End If
                    End If
                Else
                    blnMicrophoneOn = True
                End If

                Dim I As IHotKey

                Try
                    If Not IsNothing(Me.ActiveMdiChild) Then
                        If Not myRefCaller Is Nothing Then
                            I = CType(myRefCaller, IHotKey)
                            If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff Then
                                I.Navigate("OFF")
                            ElseIf DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                                I.Navigate("ON")
                            End If
                        ElseIf Me.ActiveMdiChild.Name = "frmTemplateGallery" Or Me.ActiveMdiChild.Name = "frmPatientExam" Or Me.ActiveMdiChild.Name = "frmMessages" Or Me.ActiveMdiChild.Name = "frmPatientLetter" Or Me.ActiveMdiChild.Name = "frm_LM_Orders" Or Me.ActiveMdiChild.Name = "frmPTProtocols" Or Me.ActiveMdiChild.Name = "frmNurseNotes" Or Me.ActiveMdiChild.Name = "frmPatientConsent" Or Me.ActiveMdiChild.Name = "frmPatientEducation" Or Me.ActiveMdiChild.Name = "frmDisclosureMgmt" Or Me.ActiveMdiChild.Name = "frmTriage" Or Me.ActiveMdiChild.Name = "frmCPTTemplate" Or Me.ActiveMdiChild.Name = "frmDM_Template" Or Me.ActiveMdiChild.Name = "frmMSTTemplateGallery" Then
                            I = CType(Me.ActiveMdiChild, IHotKey)
                            If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff Then
                                I.Navigate("OFF")
                            ElseIf DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                                I.Navigate("ON")
                            End If
                        End If
                    End If
                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Error Switching Microphone State - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
                End Try
            End If
        Catch objErr As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Error Switching Microphone State - " & objErr.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show("Error Switching Microphone State", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#End Region

#Region " BirthDay Reminder "


    Private Sub tmrBirthDayReminder_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tmrBirthDayReminder.Tick
        If pnlBirthDayReminder.Top > Me.Height - (pnlBirthDayReminder.Height + 50) Then
            pnlBirthDayReminder.Top = pnlBirthDayReminder.Top - 10
        Else
            tmrBirthDayReminder.Enabled = False
        End If
    End Sub

    Private Sub picBirthReminderClose_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles picBirthReminderClose.Click
        tmrBirthDayReminder.Enabled = False
        pnlBirthDayReminder.Visible = False
        'tmrFaxRecievedclose.Enabled = False
    End Sub

    'Private Sub Fill_Extremity()
    '    Dim dtExtremity As DataTable = Nothing ''Slr new not needed
    '    Dim objCategory As New clsPatientHistory
    '    Try
    '        dtExtremity = objCategory.GetAllCategory("Extremity")
    '        objCategory.Dispose()
    '        objCategory = Nothing
    '        Dim nCount As Int16
    '        With cmbExtrimity
    '            .BeginUpdate()
    '            .Items.Clear()
    '            If Not IsNothing(dtExtremity) Then
    '                For nCount = 0 To dtExtremity.Rows.Count - 1
    '                    .Items.Add(dtExtremity.Rows(nCount).Item(1))
    '                Next
    '            End If
    '            If .Items.Count >= 1 Then
    '                .SelectedIndex = 0
    '            End If
    '            .EndUpdate()
    '        End With
    '    Catch ex As Exception
    '    Finally
    '        If Not IsNothing(dtExtremity) Then
    '            dtExtremity.Dispose()
    '            dtExtremity = Nothing
    '        End If

    '    End Try
    'End Sub

#End Region

#Region " Patient Details "

    Private Sub ts_PatientDetails_ItemClicked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ToolStripItemClickedEventArgs) Handles ts_PatientDetails.ItemClicked
        Try

            _isShowDialogueForm = True
            RegisterMyHotKey()
            sToolStripClicked = ""

            Select Case e.ClickedItem.Name
                Case tsbtn_NewExam.Name
                    SelectedPatientDetail = PatientDetails.NewExam
                Case tsbtn_History.Name
                    SelectedPatientDetail = PatientDetails.History
                Case tsbtn_Medication.Name
                    SelectedPatientDetail = PatientDetails.Medication
                Case tsbtn_Prescription.Name
                    SelectedPatientDetail = PatientDetails.Prescription
                Case tsbtn_ProblemList.Name
                    SelectedPatientDetail = PatientDetails.ProblemList
                Case tsbtn_Orders.Name
                    SelectedPatientDetail = PatientDetails.OrderTemplates
                Case tsbtn_Messages.Name
                    SelectedPatientDetail = PatientDetails.Messages
                Case tsbtn_PastExam.Name
                    SelectedPatientDetail = PatientDetails.PastExams
                Case tsbtn_Vital.Name
                    SelectedPatientDetail = PatientDetails.Vitals
                Case tsbtn_ViewDocs.Name
                    SelectedPatientDetail = PatientDetails.ViewDocs
                Case tsbtn_PendingFax.Name
                    SelectedPatientDetail = PatientDetails.FAX_Pending
                Case tsbtn_Sentfax.Name
                    SelectedPatientDetail = PatientDetails.FAX_Sent
                Case tsbtn_AuditTrail.Name
                    SelectedPatientDetail = PatientDetails.AuditTrail
                Case tsbtn_Insurance.Name
                    SelectedPatientDetail = PatientDetails.Insurance
                Case tsbtn_Billing.Name
                    SelectedPatientDetail = PatientDetails.Billing
                Case tsbtn_NYWCForms.Name
                    SelectedPatientDetail = PatientDetails.NYWorkerCompForms
                Case tsbtn_SPB.Name
                    SelectedPatientDetail = PatientDetails.SBPData
                Case tsbtn_NurseNotes.Name
                    SelectedPatientDetail = PatientDetails.NurseNotes
                Case tsbtn_DisclosureMgt.Name
                    SelectedPatientDetail = PatientDetails.DisclosureManagement
                Case tsbtn_PatientConsent.Name
                    SelectedPatientDetail = PatientDetails.PatientConsent
                Case tsbtn_PatientLetters.Name
                    SelectedPatientDetail = PatientDetails.PatientLetters
                Case tsbtn_Labs.Name
                    SelectedPatientDetail = PatientDetails.Orders
                Case tsbtn_EligbilityInfo.Name
                    SelectedPatientDetail = PatientDetails.EligibilityInformation
                Case tsbtn_Appointments.Name
                    SelectedPatientDetail = PatientDetails.PatientAppointments
                Case tsbtn_Balance.Name
                    SelectedPatientDetail = PatientDetails.Balance
                Case tsbtn_Referrals.Name
                    SelectedPatientDetail = PatientDetails.Referrals
                Case tsbtn_Triage.Name
                    SelectedPatientDetail = PatientDetails.Triage
                Case tsbtn_PatientEducation.Name
                    SelectedPatientDetail = PatientDetails.PatientEducation
                Case tsbtn_PriorAuthorization.Name
                    SelectedPatientDetail = PatientDetails.PriorAuthorization
                Case tsbtn_PatientTasks.Name
                    SelectedPatientDetail = PatientDetails.PatientTasks
                Case tsbtn_PatientCases.Name
                    SelectedPatientDetail = PatientDetails.patientCases
                Case tsbtn_IntuitCommunication.Name
                    SelectedPatientDetail = PatientDetails.IntuitCommunication
                Case tsbtn_PatientCommunication.Name
                    SelectedPatientDetail = PatientDetails.PatientCommunication
                Case tsbtn_Order.Name
                    SelectedPatientDetail = PatientDetails.Order
                Case tsbtn_NYWCForms.Name
                    SelectedPatientDetail = PatientDetails.NYWorkerCompForms
                Case tsbtn_SPB.Name
                    SelectedPatientDetail = PatientDetails.SBPData

            End Select

            '' To show the selected patient details 
            Call ShowPatientDetails()

        Catch ex As Exception
        Finally
            _isShowDialogueForm = False

        End Try
    End Sub

    Private Sub SetPatientDetailsHeader(ByVal selectedPatientDetail As PatientDetails)

        sToolStripClicked = ""
        tsbtn_NYWCForms.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_SPB.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_History.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Medication.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Prescription.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_ProblemList.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Orders.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_PastExam.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Vital.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_ViewDocs.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Sentfax.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_PendingFax.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Messages.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_AuditTrail.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Insurance.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Billing.BackgroundImage = tsbtn_Normal.BackgroundImage
        ' tsbtn_HealthPlan.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_NurseNotes.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Labs.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_PatientConsent.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_DisclosureMgt.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_PatientLetters.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Labs.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_EligbilityInfo.BackgroundImage = tsbtn_Normal.BackgroundImage
        'Patient Appointments 
        tsbtn_Appointments.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Balance.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Referrals.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Triage.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_PatientEducation.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_NewExam.BackgroundImage = tsbtn_Normal.BackgroundImage 'dhruv - New Exam
        tsbtn_PriorAuthorization.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_PatientTasks.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_PatientCases.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_IntuitCommunication.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_PatientCommunication.BackgroundImage = tsbtn_Normal.BackgroundImage
        tsbtn_Order.BackgroundImage = tsbtn_Normal.BackgroundImage
        _SeachFlag = False ''After selecting toolstrip button system should display all details

        Select Case selectedPatientDetail
            Case PatientDetails.NewExam
                tsbtn_NewExam.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_NewExam.Image
                pnlPatientDetail.Text = "New Exam"

            Case PatientDetails.History
                tsbtn_History.BackgroundImage = tsbtn_Selected.BackgroundImage
                'tsbtn_History.Tag = 1
                pnlPatientDetail.Image = tsbtn_History.Image
                pnlPatientDetail.Text = "History"
            Case PatientDetails.Medication
                tsbtn_Medication.BackgroundImage = tsbtn_Selected.BackgroundImage
                ' tsbtn_Medication.Tag = 1
                pnlPatientDetail.Image = tsbtn_Medication.Image
                pnlPatientDetail.Text = "Medication"

            Case PatientDetails.Prescription
                tsbtn_Prescription.BackgroundImage = tsbtn_Selected.BackgroundImage
                'tsbtn_Prescription.Tag = 1
                pnlPatientDetail.Image = tsbtn_Prescription.Image
                pnlPatientDetail.Text = "Prescription"

            Case PatientDetails.ProblemList
                tsbtn_ProblemList.BackgroundImage = tsbtn_Selected.BackgroundImage
                'tsbtn_ProblemList.Tag = 1
                pnlPatientDetail.Image = tsbtn_ProblemList.Image
                pnlPatientDetail.Text = "Problem List"

            Case PatientDetails.OrderTemplates
                tsbtn_Orders.BackgroundImage = tsbtn_Selected.BackgroundImage
                ' tsbtn_Orders.Tag = 1
                pnlPatientDetail.Image = tsbtn_Orders.Image
                pnlPatientDetail.Text = "Order Templates"

            Case PatientDetails.Messages
                '' Added On 20070816 Mahesh
                tsbtn_Messages.BackgroundImage = tsbtn_Selected.BackgroundImage
                'tsbtn_Messages.Tag = 1
                pnlPatientDetail.Image = tsbtn_Messages.Image
                pnlPatientDetail.Text = "Messages"

            Case PatientDetails.PastExams

                tsbtn_PastExam.BackgroundImage = tsbtn_Selected.BackgroundImage
                ' tsbtn_PastExam.Tag = 1
                pnlPatientDetail.Image = tsbtn_PastExam.Image
                pnlPatientDetail.Text = "Past Exams"

            Case PatientDetails.Vitals
                tsbtn_Vital.BackgroundImage = tsbtn_Selected.BackgroundImage
                ' tsbtn_Vital.Tag = 1
                pnlPatientDetail.Image = tsbtn_Vital.Image
                pnlPatientDetail.Text = "Vitals"

            Case PatientDetails.ViewDocs
                tsbtn_ViewDocs.BackgroundImage = tsbtn_Selected.BackgroundImage
                ' tsbtn_ViewDocs.Tag = 1
                pnlPatientDetail.Image = tsbtn_ViewDocs.Image
                pnlPatientDetail.Text = "View Documents"

            Case PatientDetails.FAX_Pending
                tsbtn_PendingFax.BackgroundImage = tsbtn_Selected.BackgroundImage
                ' tsbtn_PendingFax.Tag = 1
                pnlPatientDetail.Image = tsbtn_PendingFax.Image
                pnlPatientDetail.Text = "Pending Fax"

            Case PatientDetails.FAX_Sent
                tsbtn_Sentfax.BackgroundImage = tsbtn_Selected.BackgroundImage
                '  tsbtn_Sentfax.Tag = 1
                pnlPatientDetail.Image = tsbtn_Sentfax.Image
                pnlPatientDetail.Text = "Sent Fax"

            Case PatientDetails.AuditTrail
                tsbtn_AuditTrail.BackgroundImage = tsbtn_Selected.BackgroundImage
                ' tsbtn_AuditTrail.Tag = 1
                pnlPatientDetail.Image = tsbtn_AuditTrail.Image
                pnlPatientDetail.Text = "AuditTrail"

            Case PatientDetails.Insurance
                tsbtn_Insurance.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_Insurance.Image
                pnlPatientDetail.Text = "Insurance"

            Case PatientDetails.Billing
                tsbtn_Billing.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_Billing.Image
                pnlPatientDetail.Text = "Billing"

            Case PatientDetails.NYWorkerCompForms
                tsbtn_NYWCForms.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_NYWCForms.Image
                pnlPatientDetail.Text = "NY WC Forms"

            Case PatientDetails.SBPData
                tsbtn_SPB.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_SPB.Image
                pnlPatientDetail.Text = "Social Psychological Behavioral Observations"

            Case PatientDetails.NurseNotes
                tsbtn_NurseNotes.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_NurseNotes.Image
                pnlPatientDetail.Text = "Nurse Notes"


            Case PatientDetails.DisclosureManagement
                tsbtn_DisclosureMgt.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_DisclosureMgt.Image
                pnlPatientDetail.Text = "Disclosure Management"


            Case PatientDetails.PatientConsent
                tsbtn_PatientConsent.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_PatientConsent.Image
                pnlPatientDetail.Text = "Patient Consent"

            Case PatientDetails.PatientLetters
                tsbtn_PatientLetters.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_PatientLetters.Image
                pnlPatientDetail.Text = "Patient Letters"

            Case PatientDetails.Orders
                tsbtn_Labs.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_Labs.Image
                pnlPatientDetail.Text = "Order  Results"

            Case PatientDetails.EligibilityInformation
                tsbtn_EligbilityInfo.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_EligbilityInfo.Image
                pnlPatientDetail.Text = "Eligibility Information"

            Case PatientDetails.PatientAppointments
                tsbtn_Appointments.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_Appointments.Image
                pnlPatientDetail.Text = "Appointments"

            Case PatientDetails.Balance
                tsbtn_Balance.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_Balance.Image
                pnlPatientDetail.Text = "Balance"

            Case PatientDetails.Referrals
                tsbtn_Referrals.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_Referrals.Image
                pnlPatientDetail.Text = "Referrals"

            Case PatientDetails.Triage
                tsbtn_Triage.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_Triage.Image
                pnlPatientDetail.Text = "Triage"

            Case PatientDetails.PatientEducation
                tsbtn_PatientEducation.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_PatientEducation.Image
                pnlPatientDetail.Text = "Patient Education"

            Case PatientDetails.PriorAuthorization
                tsbtn_PriorAuthorization.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_PriorAuthorization.Image
                pnlPatientDetail.Text = "Prior Authorization"

            Case PatientDetails.PatientTasks
                tsbtn_PatientTasks.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_PatientTasks.Image
                pnlPatientDetail.Text = "Tasks"

            Case PatientDetails.patientCases
                tsbtn_PatientCases.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_PatientCases.Image
                pnlPatientDetail.Text = "Cases"

            Case PatientDetails.IntuitCommunication
                tsbtn_IntuitCommunication.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_IntuitCommunication.Image
                pnlPatientDetail.Text = "Patient Portal Communications"
            Case PatientDetails.PatientCommunication
                tsbtn_PatientCommunication.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_PatientCommunication.Image
                pnlPatientDetail.Text = "Patient Communication"
            Case PatientDetails.Order
                tsbtn_Order.BackgroundImage = tsbtn_Selected.BackgroundImage
                pnlPatientDetail.Image = tsbtn_Order.Image
                pnlPatientDetail.Text = "Orders"
        End Select

    End Sub

    Private Sub chkCancelRx_CheckChanged(sender As Object, e As EventArgs) Handles chkCancelRx.CheckedChanged
        Try
            Call Fill_PatientPrescription(gnPatientID)
            If cmnuPatientDetails IsNot Nothing Then
                If cmnuPatientDetails.Items.OfType(Of ToolStripItem).Any(Function(p) p.Tag = "CancelRx Response") Then
                    Dim mnuCancelRxResponse As ToolStripItem = cmnuPatientDetails.Items.OfType(Of ToolStripItem).FirstOrDefault(Function(p) p.Tag = "CancelRx Response")

                    If mnuCancelRxResponse IsNot Nothing Then
                        mnuCancelRxResponse.Visible = chkCancelRx.Checked
                        mnuCancelRxResponse = Nothing
                    End If

                End If
                If cmnuPatientDetails.Items.OfType(Of ToolStripItem).Any(Function(p) p.Tag = "Cancel Prescription") Then
                    Dim mnuCancelPrescription As ToolStripItem = cmnuPatientDetails.Items.OfType(Of ToolStripItem).FirstOrDefault(Function(p) p.Tag = "Cancel Prescription")

                    If mnuCancelPrescription IsNot Nothing Then
                        mnuCancelPrescription.Visible = Not chkCancelRx.Checked
                        mnuCancelPrescription = Nothing
                    End If
                End If
            End If            
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Bug #82464: 00000909: Task screen not opening respective screen
    ''' <summary>
    ''' To load the selected Patient detail Panel (eq. History, medication, prescription etc.)
    ''' </summary>
    ''' <param name="ResetFilerCriteria"></param>
    ''' <remarks></remarks>
    Public Sub ShowPatientDetails(Optional ByVal ResetFilerCriteria As Boolean = True, Optional ByVal _IsFormClosing As Boolean = False)
        Try
            txtOrderComment.Visible = False
            SplitterOrderComments.Visible = False

            C1dgPatientDetails.DataSource = Nothing
            'C1dgPatientDetails.Clear(ClearFlags.All)
            gloC1FlexStyle.Style(C1dgPatientDetails)
            C1dgPatientDetails.AllowEditing = False
            C1dgPatientDetails.AllowSorting = AllowSortingEnum.SingleColumn
            C1dgPatientDetails.ScrollBars = ScrollBars.None

            C1dgPatientDetails.Rows.Count = 1
            Dim _colItem As Integer = 0
            ''Added by MAYURI:20111020-To Fix case-GLO2010-0010016-IF We Remove history from user rights then also it displays in patient detail panel
            If SelectedPatientDetail = PatientDetails.None Then
                For _colItem = 0 To ts_PatientDetails.Items.Count - 1
                    If ts_PatientDetails.Items(_colItem).Visible = True Then
                        Select Case ts_PatientDetails.Items(_colItem).Text
                            Case "History"
                                SelectedPatientDetail = PatientDetails.History
                            Case "Medication"
                                SelectedPatientDetail = PatientDetails.Medication
                            Case "New Exam"   ''Bug #84149: CR00000379: New exam enhancement
                                SelectedPatientDetail = PatientDetails.NewExam
                            Case "Audit Log"
                                SelectedPatientDetail = PatientDetails.AuditTrail
                            Case "Past Exams"
                                SelectedPatientDetail = PatientDetails.PastExams
                            Case "Prescription"
                                SelectedPatientDetail = PatientDetails.Prescription
                            Case "Messages"
                                SelectedPatientDetail = PatientDetails.Messages
                            Case "Order Templates"
                                SelectedPatientDetail = PatientDetails.OrderTemplates
                            Case "Sent Fax"
                                SelectedPatientDetail = PatientDetails.FAX_Sent
                            Case "Pending Fax"
                                SelectedPatientDetail = PatientDetails.FAX_Pending
                            Case "Problem List"
                                SelectedPatientDetail = PatientDetails.ProblemList
                            Case "Triage"
                                SelectedPatientDetail = PatientDetails.Triage
                            Case "Vitals"
                                SelectedPatientDetail = PatientDetails.Vitals
                            Case "View Documents"
                                SelectedPatientDetail = PatientDetails.ViewDocs
                            Case "Insurance"
                                SelectedPatientDetail = PatientDetails.Insurance
                            Case "Billing"
                                SelectedPatientDetail = PatientDetails.Billing
                            Case "NY WC Forms"
                                SelectedPatientDetail = PatientDetails.NYWorkerCompForms
                            Case "Nurse Notes"
                                SelectedPatientDetail = PatientDetails.NurseNotes
                            Case "Disclosure Management"
                                SelectedPatientDetail = PatientDetails.DisclosureManagement
                            Case "Patient Consent"
                                SelectedPatientDetail = PatientDetails.PatientConsent
                            Case "Patient Letters"
                                SelectedPatientDetail = PatientDetails.PatientLetters
                            Case "Health Plan"
                                SelectedPatientDetail = PatientDetails.HealthPlan
                            Case "Order  Results"
                                SelectedPatientDetail = PatientDetails.Orders
                            Case "Eligibility Information"
                                SelectedPatientDetail = PatientDetails.EligibilityInformation
                            Case "Appointments"
                                SelectedPatientDetail = PatientDetails.PatientAppointments
                            Case "Balance"
                                SelectedPatientDetail = PatientDetails.Balance
                            Case "Referrals"
                                SelectedPatientDetail = PatientDetails.Referrals
                            Case "Patient Education"
                                SelectedPatientDetail = PatientDetails.PatientEducation
                            Case "Prior Authorization"
                                SelectedPatientDetail = PatientDetails.PriorAuthorization
                            Case "Tasks"
                                SelectedPatientDetail = PatientDetails.PatientTasks
                            Case "Cases"
                                SelectedPatientDetail = PatientDetails.patientCases
                            Case "Patient Portal Communications"
                                SelectedPatientDetail = PatientDetails.IntuitCommunication
                            Case "Patient Communication"
                                SelectedPatientDetail = PatientDetails.PatientCommunication
                            Case "Orders"
                                SelectedPatientDetail = PatientDetails.Order
                            Case "SBPData"
                                SelectedPatientDetail = PatientDetails.SBPData
                        End Select


                        Exit For
                    End If
                Next
            End If

            _colItem = Nothing

            If IsAccess(True) = False Then
                C1dgPatientDetails.Rows.Count = 1
                If (ResetFilerCriteria) Then
                    Call ResetSearchControls()
                End If
                Exit Sub
            End If

            chkGetLatestActive.Visible = False
            pnlCancelRx.Visible = False
            chkCancelRx.Visible = False

            If (ResetFilerCriteria) Then
                Call ResetSearchControls()
            End If

            Select Case SelectedPatientDetail
                Case PatientDetails.History
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "History"
                        Exit Sub
                    Else
                        Call Fill_PatientHistory(gnPatientID)
                    End If
                Case PatientDetails.Medication
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Medication"
                        Exit Sub
                    Else
                        If _cmbStatusToActive = False Then
                            _isSearchFlagFromShowPatientDetails = True
                        End If
                        _SeachFlag = True
                        Call fill_medication()
                    End If
                    'dhruv - New Exam Settings
                Case PatientDetails.NewExam
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "New Exams"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "New Exams"
                        ''Bug #84149: CR00000379: New exam enhancement
                        pnlSearchFilter.Visible = True
                        Call Fill_NewExams()
                        If txtSearchIntuit.Text.Trim() <> "" Then
                            txtSearchIntuit_TextChanged(Nothing, Nothing)
                        End If

                    End If
                Case PatientDetails.AuditTrail
                    ''To show labels even if patient list is empty
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Audit Log"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Audit Log"
                        Call Fill_AuditTrail()
                    End If

                Case PatientDetails.PastExams
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Past Exams"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Past Exams"
                        pnlSearchFilter.Visible = True
                        Call Fill_PastExams()
                    End If


                Case PatientDetails.Prescription

                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Prescription"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Prescription"
                        pnlSearchFilter.Visible = True
                        pnlCancelRx.Visible = True
                        chkCancelRx.Visible = True
                        Call Fill_PatientPrescription(gnPatientID)
                    End If

                Case PatientDetails.Messages
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Messages"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Messages"
                        pnlSearchFilter.Visible = True
                        Call Fill_PatientMessages()
                        ShowMessages_New()
                    End If

                Case PatientDetails.OrderTemplates
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Order Templates"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Order Templates"
                        pnlSearchFilter.Visible = True
                        Call Fill_Orders()
                    End If

                    'FAX Status
                Case PatientDetails.FAX_Sent
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Sent Fax"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Sent Fax"
                        Call Fill_FAXSent()
                    End If


                Case PatientDetails.FAX_Pending
                    ''DB
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Pending Fax"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Pending Fax"

                        'internet fax
                        Try
                            If gblnInternetFax = False Then
                                If System.IO.Directory.Exists(gstrFAXOutputDirectory) = False Then
                                    Exit Sub
                                End If
                            End If

                            Call Fill_PendingFAX()

                        Catch ex As Exception
                            Throw ex
                        End Try
                    End If

                Case PatientDetails.ProblemList
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Problem List"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Problem List"
                        pnlSearchFilter.Visible = True
                        Call Fill_ProblemList()
                    End If

                Case PatientDetails.Triage
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Triage"
                        Exit Sub
                    Else
                        C1dgPatientDetails.AllowSorting = AllowSortingEnum.None
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Triage"
                        'To Visisble Search panel
                        pnlSearchFilter.Visible = True
                        Call Fill_Triage()
                        ''
                    End If

                Case PatientDetails.Vitals
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Vitals"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Vitals"
                        '''' Fill Patient History
                        Call Fill_Vitals()
                    End If

                Case PatientDetails.ViewDocs
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "View Documents"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "View Documents"
                        pnlSearchFilter.Visible = True
                        '''' Fill Patient Documents
                        Call Fill_PatientScanedDocuments(gnPatientID)
                    End If

                Case PatientDetails.Insurance
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Insurance"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Insurance"
                        Call Fill_Insurances()
                    End If

                Case PatientDetails.Billing
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Billing"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Billing"
                        Fill_Billing()
                    End If

                Case PatientDetails.NYWorkerCompForms
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "NY WC Forms"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "NY WC Forms"
                        FillPatientWorkerCompForms()
                    End If

                Case PatientDetails.NurseNotes
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Nurse Notes"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Nurse Notes"
                        pnlSearchFilter.Visible = True
                        Fill_NurseNotes()
                    End If

                Case PatientDetails.DisclosureManagement
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Disclosure Management"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Disclosure Management"
                        pnlSearchFilter.Visible = True
                        Fill_DisclosureManagement()
                    End If

                Case PatientDetails.PatientConsent
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Patient Consent"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Patient Consent"
                        pnlSearchFilter.Visible = True
                        Fill_PatientConsent()
                    End If

                Case PatientDetails.PatientLetters
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Patient Letters"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Patient Letters"
                        pnlSearchFilter.Visible = True
                        Fill_PatientLetters()
                    End If

                Case PatientDetails.HealthPlan
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Health Plan"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Health Plan"
                    End If


                Case PatientDetails.Orders
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Order  Results"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Order  Results"

                        Fill_Labs()
                    End If

                Case PatientDetails.EligibilityInformation
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Eligibility Information"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Eligibility Information"
                        Fill_EligibilityInfo()
                    End If
                    ''show patient appointments
                Case PatientDetails.PatientAppointments
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Appointments"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Appointments"
                        pnlSearchFilter.Visible = True
                        Fill_Appointments()
                    End If
                    ''show patient Balance
                Case PatientDetails.Balance
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Balance"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Balance"
                        Fill_Balance()
                    End If

                Case PatientDetails.Referrals
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Referrals"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Referrals"
                        Fill_Referrals()

                    End If

                Case PatientDetails.PatientEducation
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Patient Education"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Patient Education"
                        pnlSearchFilter.Visible = True
                        Call Fill_Patienteducation()
                    End If

                Case PatientDetails.PriorAuthorization
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Prior Authorization"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Prior Authorization"
                        Call Fill_PriorAuthorization(gnPatientID)
                    End If
                Case PatientDetails.PatientTasks
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Tasks"
                        pnlSearchFilter.Visible = False
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Tasks"
                        pnlSearchFilter.Visible = False
                        Call Fill_PatientTasks(gnPatientID)
                    End If
                Case PatientDetails.patientCases
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Cases"
                        pnlSearchFilter.Visible = False
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Cases"
                        pnlSearchFilter.Visible = False
                        Call FillCases(gnPatientID)
                    End If

                Case PatientDetails.IntuitCommunication

                    C1dgPatientDetails.Visible = True
                    pnlPatientDetail.Text = "Patient Portal Communications"
                    pnlSearchFilter.Visible = True
                    txtSearchIntuit.Text = ""
                    Panel14.Width = 295
                    isPatientDetailsGridSorted = False
                    Call Fill_IntuitMessages(gnPatientID, "")

                Case PatientDetails.PatientCommunication

                    C1dgPatientDetails.Visible = True
                    pnlPatientDetail.Text = "Patient Communication"
                    pnlSearchFilter.Visible = True
                    txtSearchIntuit.Text = ""
                    Panel14.Width = 295
                    isPatientDetailsGridSorted = False
                    Call Fill_PatientCommunication()


                Case PatientDetails.Order
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Orders"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Orders"
                        FillOrder()
                    End If

                Case PatientDetails.SBPData
                    If gnPatientID = 0 Then
                        pnlPatientDetail.Text = "Social Psychological Behavioral Data"
                        Exit Sub
                    Else
                        C1dgPatientDetails.Visible = True
                        pnlPatientDetail.Text = "Social Psychological Behavioral Data"
                        '''' Fill Patient History
                        Call Fill_SBPTransactionData()
                    End If

            End Select

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

            C1dgPatientDetails.ScrollBars = ScrollBars.Both
           

            If GridSelect_RowCount = C1dgPatientDetails.Rows.Count Then

                If _IsFormClosing = True Then
                    SetControlSelection_EMR()

                End If
            ElseIf C1dgPatientDetails.Rows.Count > 1 Then
                C1dgPatientDetails.Select(1, 0)

            End If

        End Try
    End Sub


    Private Sub Fill_IntuitMessages(ByVal patientID As Long, ByVal SearchBy As String)

        Dim dtIntuitmsg As DataTable = Nothing  ''Slr new not needed 
        Dim objIntuit As New clsIntuit

        Try
            If chkenbdate.Checked Then
                Dim fDate As String = dtpFromDate.Value.Date.ToString()
                Dim tDate As String = dtpToDate.Value.Date.AddDays(1).ToString()
                If SearchBy = "" Then
                    dtIntuitmsg = objIntuit.GetIntuitMessageForPatient(patientID, fDate, tDate)
                Else
                    dtIntuitmsg = objIntuit.SearchMessageByDate(patientID, fDate, tDate, SearchBy)
                End If
                fDate = Nothing
                tDate = Nothing
            Else
                If SearchBy = "" Then
                    dtIntuitmsg = objIntuit.GetIntuitMessageForPatient(patientID)
                Else
                    dtIntuitmsg = objIntuit.SearchMessage(patientID, SearchBy)
                End If
            End If

            If Not IsNothing(dtIntuitmsg) Then

                C1dgPatientDetails.DataSource = Nothing
                C1dgPatientDetails.Clear()
                C1dgPatientDetails.DataSource = dtIntuitmsg.DefaultView
                C1dgPatientDetails.DrawMode = C1.Win.C1FlexGrid.DrawModeEnum.OwnerDraw
                C1dgPatientDetails.AllowSorting = True
                C1dgPatientDetails.Cols(0).Caption = ""
                C1dgPatientDetails.Cols("Sender").Caption = "From"
                C1dgPatientDetails.Cols("Receiver").Caption = "To"
                C1dgPatientDetails.Cols("sCommSubject").Caption = "Subject"
                C1dgPatientDetails.Cols("dCommCreationDate").Caption = "Date"

                C1dgPatientDetails.Cols("dCommCreationDate").DataType = GetType(System.DateTime)
                C1dgPatientDetails.Cols("dCommCreationDate").Format = "MM/dd/yyyy h:mm tt"



                C1dgPatientDetails.Cols("sCommMessage").Visible = False
                C1dgPatientDetails.Cols("nMessageID").Visible = False
                C1dgPatientDetails.Cols("nCommDetailID").Visible = False
                C1dgPatientDetails.Cols("bCommMessageType").Visible = False
                C1dgPatientDetails.Cols("sCommServiceType").Visible = False
                C1dgPatientDetails.Cols("bIsReadFlag").Visible = False
                C1dgPatientDetails.Cols("nCommStaffID").Visible = False
                C1dgPatientDetails.Cols("nCommContainerID").Visible = False
                C1dgPatientDetails.Cols("sCommAttachOneName").Visible = False
                C1dgPatientDetails.Cols("sCommAttachTwoName").Visible = False
                C1dgPatientDetails.Cols("sCommAttachThreeName").Visible = False
                C1dgPatientDetails.Cols("Attachmentcount").Visible = False
                C1dgPatientDetails.Cols("dTransactionDate").Visible = False

                Dim _width As Integer = pnlPatientDetail.Width
                If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                    _width = Convert.ToInt32(c1dgPatientDetailSize)
                End If

                C1dgPatientDetails.Cols(0).Width = _width * 0.03
                C1dgPatientDetails.Cols("Sender").Width = _width * 0.2
                C1dgPatientDetails.Cols("Receiver").Width = _width * 0.2
                C1dgPatientDetails.Cols("sCommSubject").Width = _width * 0.3
                C1dgPatientDetails.Cols("sCommMessage").Width = _width * 0.7
                C1dgPatientDetails.Cols("dCommCreationDate").Width = _width * 0.14
                C1dgPatientDetails.Cols("nMessageID").Width = _width * 0.07
                C1dgPatientDetails.Cols("nCommDetailID").Width = _width * 0.07
                C1dgPatientDetails.Cols("bCommMessageType").Width = _width * 0.07
                C1dgPatientDetails.Cols("sCommServiceType").Width = _width * 0.07
                C1dgPatientDetails.Cols("bIsReadFlag").Width = _width * 0.07
                C1dgPatientDetails.Cols("nCommStaffID").Width = _width * 0.07
                C1dgPatientDetails.Cols("nCommContainerID").Width = _width * 0.07
                C1dgPatientDetails.Cols("sCommAttachOneName").Width = _width * 0.07
                C1dgPatientDetails.Cols("sCommAttachTwoName").Width = _width * 0.07
                C1dgPatientDetails.Cols("sCommAttachThreeName").Width = _width * 0.07
                C1dgPatientDetails.Cols("Attachment").Width = _width * 0.09
                C1dgPatientDetails.Cols("Attachmentcount").Width = _width * 0.07
                C1dgPatientDetails.Cols("dTransactionDate").Width = _width * 0.07

                ''Read Messages - Adding a flag in patient portal communication tab to show whether patient read the message or not
                If PortalType = "gloPatientPortal" Then
                    C1dgPatientDetails.Cols("Sender").Width = _width * 0.16
                    C1dgPatientDetails.Cols("Receiver").Width = _width * 0.16
                    C1dgPatientDetails.Cols("Message Read").Caption = "Read"
                    C1dgPatientDetails.Cols("Message Read").Width = _width * 0.1
                    C1dgPatientDetails.Cols("Message Read").TextAlign = TextAlignEnum.LeftCenter
                Else
                    C1dgPatientDetails.Cols("Message Read").Visible = False
                End If

                _width = Nothing

                C1dgPatientDetails.Cols("Sender").TextAlign = TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols("Receiver").TextAlign = TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols("sCommSubject").TextAlign = TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols("dCommCreationDate").TextAlign = TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols("Attachment").TextAlign = TextAlignEnum.LeftCenter
            End If

            C1dgPatientDetails.Redraw = True
            If PortalType = "gloPatientPortal" Then
                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Portal Messages viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
            Else
                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Messages viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
            End If
            
            'gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Messages viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, ex, gloAuditTrail.ActivityOutCome.Failure)
        Finally

            If Not IsNothing(dtIntuitmsg) Then
                dtIntuitmsg.Dispose()
                dtIntuitmsg = Nothing
            End If

            objIntuit = Nothing

        End Try



    End Sub

    Private Sub Fill_PatientHistory(ByVal PatientID As Long)
        Dim objDashBoard As New clsDoctorsDashBoard
        Dim dt As New DataTable 'new added for history datatable  change made for bugid 62734

        gnVisitID = GetVisitID(Now, PatientID)
        If gnVisitID > 0 Then
            'To Check if Current History Exists
            dt = objDashBoard.Fill_History(PatientID, gnVisitID, 0)
        End If

        If Not IsNothing(dt) Then
            If dt.Rows.Count > 0 Then
                'History Exists for Current Date

            Else
                'If History is Not Exist For Current Date then Check for the Previous Date
                dt = objDashBoard.Fill_History(PatientID, gnVisitID, 1)
                If Not IsNothing(dt) Then
                    If dt.Rows.Count > 0 Then
                        'If there Exist a Visit of History for Previous Date Then 
                        'Get the History for that Date
                        dt = objDashBoard.Fill_History(PatientID, dt.Rows(0)(0), 2)
                    Else
                    End If
                End If
            End If
        Else
            dt = objDashBoard.Fill_History(PatientID, gnVisitID, 1)
            If Not IsNothing(dt) Then
                If dt.Rows.Count > 0 Then
                    'If there Exist a Visit of History for Previous Date Then 
                    'Get the History for that Date
                    dt = objDashBoard.Fill_History(PatientID, dt.Rows(0)(0), 2)
                Else
                End If
            End If
        End If
        Fill_History(dt)

        objDashBoard = Nothing

        If Not IsNothing(dt) Then
            dt.Dispose()
        End If
        dt = Nothing

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient History viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub

    Private Sub Fill_History(ByVal dt As DataTable)
        ''sHistoryCategory, sHistoryItem, sComments, nVisitID, dtVisitDate, nDrugID
        Try
            Dim ds As DataSet ''Slr new not needed 
            Dim objclsDB As New clsDoctorsDashBoard
            Dim _categorytype As String = ""
            Dim stronsetActiveStatus As String = ""
            Dim _arrOnsetActive() As String
            Dim IsActive As Boolean = False
            Dim IsOnsetDate As Boolean = False
            Dim dtReaction As DataTable = Nothing  ''change made for patient switching optimization
            Dim dtSmoking As DataTable = Nothing
            ds = objclsDB.Fill_StandardHistoryTypes()

            C1dgPatientDetails.Clear(ClearFlags.All)
            With C1dgPatientDetails

                .AllowSorting = AllowSortingEnum.None
                .Visible = True
                .BringToFront()
                .Cols.Count = 15 '28-Mar-13 Aniket: Show the History Source on the Dashboard
                .Rows.Fixed = 1
                .Rows.Count = 1
                '' Set Fixed Rows
                .SetData(0, 0, "VisitID")
                .Cols(0).TextAlign = TextAlignEnum.GeneralCenter
                .SetData(0, 1, "Category_Hidden")
                .Cols(1).TextAlign = TextAlignEnum.GeneralCenter
                .SetData(0, 2, "Visit Date_Hidden")
                .Cols(2).TextAlign = TextAlignEnum.GeneralCenter
                .SetData(0, 3, "Visit Date")
                .Cols(3).TextAlign = TextAlignEnum.GeneralCenter
                .SetData(0, 4, "Category")
                .Cols(4).TextAlign = TextAlignEnum.LeftCenter

                '05-May-15 Aniket: Resolving Bug #82976: EMR: PT history- Grid header name mismatch
                .SetData(0, 5, "Item")
                .Cols(5).TextAlign = TextAlignEnum.LeftCenter
                .SetData(0, 6, "Comments")
                .Cols(6).TextAlign = TextAlignEnum.LeftCenter
                .SetData(0, 7, "")
                .Cols(7).TextAlign = TextAlignEnum.GeneralCenter

                ''Added Rahul on 20101007 for Smoking status 
                .SetData(0, 8, "Smoking Status")
                .Cols(8).TextAlign = TextAlignEnum.GeneralCenter
                ''
                .SetData(0, 9, "Active")
                .Cols(9).TextAlign = TextAlignEnum.GeneralCenter

                .SetData(0, 10, "DrugID")
                .Cols(10).TextAlign = TextAlignEnum.GeneralCenter

                .Cols(11).AllowEditing = False
                .SetData(0, 11, "Occur Date") '25-Jun-13 Aniket: Change caption to Occur Date
                .Cols(11).TextAlignFixed = TextAlignEnum.GeneralCenter

                .Cols(12).AllowEditing = False
                .SetData(0, 12, "Date Entered")
                .Cols(12).TextAlignFixed = TextAlignEnum.GeneralCenter

                .Cols(13).AllowEditing = False
                .SetData(0, 13, "ICD9")
                .Cols(13).TextAlignFixed = TextAlignEnum.GeneralCenter
                .Cols(13).Width = 0

                '28-Mar-13 Aniket: Show the History Source on the Dashboard
                .SetData(0, 14, "Source")
                .Cols(14).TextAlign = TextAlignEnum.LeftCenter

                Dim _width As Double = C1dgPatientDetails.Width
                If .Width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                    _width = Convert.ToInt32(c1dgPatientDetailSize)
                End If

                .Cols(0).Width = _width * 0
                .Cols(1).Width = _width * 0
                .Cols(2).Width = _width * 0
                .Cols(3).Width = _width * 0.08
                .Cols(4).Width = _width * 0.15
                .Cols(5).Width = _width * 0.19
                .Cols(6).Width = _width * 0.19
                .Cols(7).Width = _width * 0.11
                'Smoking Column
                If gblnShowSmokingColumn Then
                    .Cols(8).Width = _width * 0.11
                Else
                    .Cols(8).Width = 0
                End If
                .Cols(9).Width = _width * 0.04
                .Cols(10).Width = 0
                .Cols(11).Width = _width * 0.093
                '''' 

                _width = Nothing

                .BeginInit()
                If IsNothing(dt) = False Then
                    For i As Int16 = 0 To dt.Rows.Count - 1

                        Dim _Row As Integer = 0
                        ' Dim _tempID As Long
                        For j As Int16 = 1 To .Rows.Count - 1
                            'Bug #61329: 00000599 : patient has multiple history items in different casing the system will throw an error.
                            If .GetData(j, 1).ToString.ToUpper = dt.Rows(i)("sHistoryCategory").ToString.ToUpper Then

                                'TO Insert the New Item At the END of the CAtegory
                                Try

                                    '28-Apr-15 Aniket: Added condition to resolve History exception thrown
                                    If .Rows.Count > j + 1 Then
                                        'Bug #61329: 00000599 : patient has multiple history items in different casing the system will throw an error.
                                        If .GetData(j, 1).ToString.ToUpper <> .GetData(j + 1, 1).ToString.ToUpper Then
                                            'If The Current Category ID Is Not Matchs with the thw Category Name  at Next ROW 
                                            'Then Add new Row at Just After the Current Row i.e At the END of the Category
                                            .Rows.Insert(j + 1)
                                            _Row = j + 1
                                            .SetData(_Row, 0, dt.Rows(i)("nVisitID"))
                                            Exit For
                                        End If
                                    Else
                                        'If The System Does Not Get the ROW At (i+1) Position then it Throws the Exception
                                        'i.e we have to add the Row at the End 
                                        .Rows.Insert(j + 1)
                                        _Row = j + 1
                                        .SetData(_Row, 0, dt.Rows(i)("nVisitID"))
                                        Exit For
                                    End If

                                Catch ex As Exception
                                    'If The System Does Not Get the ROW At (i+1) Position then it Throws the Exception
                                    'i.e we have to add the Row at the End 
                                    .Rows.Insert(j + 1)
                                    _Row = j + 1
                                    .SetData(_Row, 0, dt.Rows(i)("nVisitID"))
                                    Exit For
                                End Try
                            End If
                        Next
                        '(0, "VisitID")(1, "Category_Hidden")(2, "Visit Date_Hidden")(3, "Visit Date")(4, "Category")
                        '(5, "History")(6, "Comments")(7,"Reaction")(8,"Status")(9, "DrugID")

                        Dim objclsPatientHistory As New clsPatientHistory
                        _categorytype = Convert.ToString(dt.Rows(i)(0)).Trim
                        If _categorytype.Contains("Smoking Status") = True OrElse _categorytype = "OB Medical History" OrElse _categorytype = "OB Genetic History" OrElse _categorytype = "OB Infection History" OrElse _categorytype = "OB Initial Physical Examination" Then
                            Dim intCount As Byte = 0
                        Else
                            If Convert.ToString(dt.Rows(i)("sHistoryType")).Trim = "" Then
                                _categorytype = Convert.ToString(dt.Rows(i)(0)).Trim
                                _categorytype = objclsPatientHistory.getHistoryTypefromcategorymaster_Other(_categorytype, ds)
                            Else
                                _categorytype = Convert.ToString(dt.Rows(i)("sHistoryType")).Trim
                            End If
                        End If
                       

                        If _Row = 0 Then ''  Category Is Not exists
                            .Rows.Add()
                            _Row = .Rows.Count - 1
                            .SetData(_Row, 0, dt.Rows(i)("nVisitID"))
                            .SetData(_Row, 1, dt.Rows(i)("sHistoryCategory"))
                            .SetData(_Row, 2, dt.Rows(i)("dtVisitDate"))
                            If _Row = 1 Then
                                .SetData(_Row, 3, dt.Rows(i)("dtVisitDate"))
                            End If
                            .SetData(_Row, 4, dt.Rows(i)("sHistoryCategory"))

                            Dim asgTask As C1.Win.C1FlexGrid.CellStyle
                            Try
                                If (C1dgPatientDetails.Styles.Contains("asgTask")) Then
                                    asgTask = C1dgPatientDetails.Styles("asgTask")
                                Else
                                    asgTask = C1dgPatientDetails.Styles.Add("asgTask")
                                    asgTask.Font = gloGlobal.clsgloFont.getFontFromExistingSource(.Font, FontStyle.Bold) 'New System.Drawing.Font(.Font.FontFamily.Name, 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte(0))

                                End If
                            Catch ex As Exception
                                asgTask = C1dgPatientDetails.Styles.Add("asgTask")
                                asgTask.Font = gloGlobal.clsgloFont.getFontFromExistingSource(.Font, FontStyle.Bold) 'New System.Drawing.Font(.Font.FontFamily.Name, 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte(0))

                            End Try
                            C1dgPatientDetails.SetCellStyle(_Row, 7, asgTask)

                            'Bug #61329: 00000599 : patient has multiple history items in different casing the system will throw an error.
                            If Convert.ToString(dt.Rows(i)("sHistoryCategory").ToString.ToUpper) = "ALLERGIES" Then
                                .SetData(_Row, 7, "Reaction")
                                'Bug #61329: 00000599 : patient has multiple history items in different casing the system will throw an error.
                            ElseIf Convert.ToString(dt.Rows(i)("sHistoryCategory").ToString.ToUpper) = "FAMILY HISTORY" Then
                                .SetData(_Row, 7, "Family member")
                            ElseIf Convert.ToString(dt.Rows(i)("sHistoryCategory")).ToUpper = "OB INITIAL PHYSICAL EXAMINATION" Then
                                .SetData(_Row, 7, "Initial Physical Exam")
                            Else
                                .SetData(_Row, 7, "")
                            End If

                            .Rows.Insert(_Row + 1)
                            _Row = _Row + 1
                        End If
                        '(0, "VisitID")(1, "Category_Hidden")(2, "Visit Date_Hidden")(3, "Visit Date")(4, "Category")
                        '(5, "History")(6, "Comments")(7,"Reaction")(8,"Status")(9, "DrugID")
                        .SetData(_Row, 0, dt.Rows(i)("nVisitID"))
                        .SetData(_Row, 1, dt.Rows(i)("sHistoryCategory"))
                        .SetData(_Row, 2, dt.Rows(i)("dtVisitDate"))
                        .SetData(_Row, 5, dt.Rows(i)("sHistoryItem"))
                        .SetData(_Row, 6, dt.Rows(i)("sComments"))
                        .SetData(_Row, 7, "")
                        .SetData(_Row, 8, "")
                        '' chetan added on 16-nov-2010
                        .SetData(_Row, 12, dt.Rows(i)("DOE_Allergy"))
                        .SetData(_Row, 13, dt.Rows(i)("sICD9"))

                        '28-Mar-13 Aniket: Show the History Source on the Dashboard
                        .SetData(_Row, 14, dt.Rows(i)("sHistorySource"))

                        Dim cStyle As C1.Win.C1FlexGrid.CellStyle
                        Dim rgReaction As C1.Win.C1FlexGrid.CellRange = .GetCellRange(_Row, 7, _Row, 7)
                        Dim rgActive As C1.Win.C1FlexGrid.CellRange = .GetCellRange(_Row, 9, _Row, 9)
                        ''If the category is allergy then insert combox and checkbox in flexgrid 
                        IsActive = False
                        IsOnsetDate = False
                        If _categorytype.Contains("Smoking Status") = True OrElse _categorytype = "OB Medical History" OrElse _categorytype = "OB Genetic History" OrElse _categorytype = "OB Infection History" OrElse _categorytype = "OB Initial Physical Examination" Then
                            IsActive = True
                            IsOnsetDate = False
                        Else


                            If _categorytype <> "" Then
                                If _categorytype.Length > 2 Then


                                    stronsetActiveStatus = objclsPatientHistory.CheckHistoryTypeinStandardTable_other(_categorytype, ds)
                                    _arrOnsetActive = stronsetActiveStatus.Split(",")
                                    If IsNothing(_arrOnsetActive) = False Then
                                        If _arrOnsetActive.Length >= 1 Then
                                            IsOnsetDate = _arrOnsetActive.GetValue(0)
                                            If _arrOnsetActive.Length > 1 Then
                                                IsActive = _arrOnsetActive.GetValue(1)
                                            End If

                                        End If
                                    End If
                                End If
                            End If
                        End If
                        If _categorytype.Contains("Smoking Status") = True OrElse _categorytype = "Sur" Or _categorytype = "Pro" Or _categorytype = "All" Or _categorytype = "Fam" Or _categorytype = "Dia" Or _categorytype = "Soc" Then
                            .SetData(_Row, 11, dt.Rows(i)("OnsetDate"))
                        End If

                        If IsActive AndAlso _categorytype = "All" Then

                            Dim strReaction As String = ""
                            Dim strActive As String = ""
                            If dt.Rows(i)("sReaction") <> "" Then
                                Dim arr() As String 'Srting Array
                                arr = Split(dt.Rows(i)("sReaction"), "|")
                                strReaction = arr.GetValue(0)
                                If (arr.Length > 1) Then
                                    strActive = arr.GetValue(1)
                                End If
                                arr = Nothing
                            End If

                            Dim strReactions As String = " "
                            ' Dim objclsPatientHistory As clsPatientHistory = Nothing
                            If IsNothing(dtReaction) Then  ''code change for patient switching performance
                                objclsPatientHistory = New clsPatientHistory
                                dtReaction = objclsPatientHistory.GetAllCategory("Reaction")
                            End If

                            If IsNothing(dtReaction) = False Then
                                If strReactions = " " Then  ''condition added  for patient switching performance
                                    For k As Int16 = 0 To dtReaction.Rows.Count - 1
                                        strReactions = strReactions & "|" & dtReaction.Rows(k)(1)
                                    Next
                                End If
                            End If


                            'Try
                            '    If (.Styles.Contains("Reaction")) Then
                            '        cStyle = .Styles("Reaction")
                            '    Else
                            '        cStyle = .Styles.Add("Reaction")
                            '    End If
                            'Catch ex As Exception
                            '    cStyle = .Styles.Add("Reaction")
                            'End Try


                            '  cStyle.ComboList = strReactions

                            'rgReaction.Style = cStyle
                            'rgActive.StyleNew.DataType = GetType(Boolean)
                            'rgActive.StyleNew.TextAlign = TextAlignEnum.CenterCenter
                            'rgActive.StyleNew.ImageAlign = ImageAlignEnum.CenterCenter

                            ''Added Rahul for display each Reaction on new line on 20101007
                            Dim arrReaction As String()
                            arrReaction = strReaction.Split(vbNewLine)

                            C1dgPatientDetails.Rows(_Row).Height = C1dgPatientDetails.Rows.DefaultSize * arrReaction.Length - 1
                            C1dgPatientDetails.SetData(_Row, 7, strReaction)
                            '.SetData(_Row, 7, strReaction)
                            ''
                            '05-May-15 Aniket: Resolved Bug #82973: EMR: Patient History- In patient details panel, alignment of all checkboxes should be center
                            rgActive.StyleNew.DataType = GetType(Boolean)
                            rgActive.StyleNew.TextAlign = TextAlignEnum.CenterCenter
                            rgActive.StyleNew.ImageAlign = ImageAlignEnum.CenterCenter

                            If strActive = "Active" Then
                                .SetCellCheck(_Row, 9, CheckEnum.Checked)
                            End If

                            arrReaction = Nothing
                            strActive = Nothing
                            strReaction = Nothing



                            strReactions = Nothing
                            objclsPatientHistory.Dispose()
                            objclsPatientHistory = Nothing

                        ElseIf _categorytype = "Fam" Then

                            Dim strFamily As String = ""
                            Dim strFamilyActive As String = ""
                            If dt.Rows(i)("sReaction") <> "" Then
                                Dim arr() As String 'Srting Array
                                Dim arr1() As String 'Srting Array
                                arr = Split(dt.Rows(i)("sReaction"), "|")
                                arr1 = arr(0).Split(":")

                                If arr1.Length > 0 Then
                                    strFamily = arr1(0)
                                End If

                                If (arr.Length > 1) Then
                                    strFamilyActive = arr.GetValue(1)
                                End If
                            End If
                            Try
                                If (.Styles.Contains("Family History")) Then
                                    cStyle = .Styles("Family History")
                                Else
                                    cStyle = .Styles.Add("Family History")
                                End If
                            Catch ex As Exception
                                cStyle = .Styles.Add("Family History")
                            End Try

                            cStyle.ComboList = strFamily
                            rgReaction.Style = cStyle

                            If IsActive Then
                                rgActive.StyleNew.DataType = GetType(Boolean)
                                rgActive.StyleNew.TextAlign = TextAlignEnum.CenterCenter
                                rgActive.StyleNew.ImageAlign = ImageAlignEnum.CenterCenter

                                If strFamilyActive = "Active" Then
                                    .SetCellCheck(_Row, 9, CheckEnum.Checked)
                                End If
                            End If

                            Dim arrReaction As String()
                            arrReaction = strFamily.Split(vbNewLine)
                            C1dgPatientDetails.Rows(_Row).Height = C1dgPatientDetails.Rows.DefaultSize * arrReaction.Length - 1
                            C1dgPatientDetails.SetData(_Row, 7, strFamily)
                        ElseIf _categorytype = "OB Initial Physical Examination" Then

                            Dim strExam As String = ""
                            Dim strExamActive As String = ""
                            If dt.Rows(i)("sReaction") <> "" Then
                                Dim arr() As String 'Srting Array

                                arr = Split(dt.Rows(i)("sReaction"), "|")

                                If arr.Length > 0 Then
                                    strExam = arr.GetValue(0)
                                End If

                                If (arr.Length > 1) Then
                                    strExamActive = arr.GetValue(1)
                                End If
                            End If

                            Dim arrReaction As String()
                            arrReaction = strExam.Split(vbNewLine)
                            C1dgPatientDetails.Rows(_Row).Height = C1dgPatientDetails.Rows.DefaultSize * arrReaction.Length - 1
                            C1dgPatientDetails.SetData(_Row, 7, strExam)
                            ''Added Rahul for Smoking Status on 20101007
                            'Bug #61329: 00000599 : patient has multiple history items in different casing the system will throw an error.
                        ElseIf InStr(dt.Rows(i)("sHistoryCategory").ToString.ToUpper, "SMOKING", CompareMethod.Text) = 1 Then

                            Dim strSmoking As String = ""
                            Dim strSmokeActive As String = ""
                            If dt.Rows(i)("sReaction") <> "" Then
                                Dim arr() As String 'Srting Array
                                arr = Split(dt.Rows(i)("sReaction"), "|")
                                strSmoking = arr.GetValue(0)
                                If (arr.Length > 1) Then
                                    strSmokeActive = arr.GetValue(1)
                                End If
                            End If

                            Dim strSmokings As String = " "


                            If IsNothing(dtSmoking) Then
                                Dim objclsPHistory As clsPatientHistory
                                objclsPHistory = New clsPatientHistory()
                                dtSmoking = objclsPHistory.GetAllCategory("Smoking Status Type")
                                objclsPHistory.Dispose()
                                objclsPHistory = Nothing
                            End If
                            If IsNothing(dtSmoking) = False Then
                                If strSmokings = " " Then
                                    For k As Int16 = 0 To dtSmoking.Rows.Count - 1
                                        strSmokings = strSmokings & "|" & dtSmoking.Rows(k)(1)
                                    Next
                                End If
                            End If

                            'Try
                            '    If (.Styles.Contains("Smoking Status")) Then
                            '        cStyle = .Styles("Smoking Status")
                            '    Else
                            '        cStyle = .Styles.Add("Smoking Status")
                            '    End If
                            'Catch ex As Exception
                            '    cStyle = .Styles.Add("Smoking Status")
                            'End Try

                            ' cStyle.ComboList = strSmokings


                            ' rgReaction.Style = cStyle

                            Dim arrSmoking As String()
                            arrSmoking = strSmoking.Split(vbNewLine)

                            C1dgPatientDetails.Rows(_Row).Height = C1dgPatientDetails.Rows.DefaultSize * arrSmoking.Length - 1
                            C1dgPatientDetails.SetData(_Row, 8, strSmoking)

                            'rgActive.StyleNew.DataType = GetType(Boolean)
                            'rgActive.StyleNew.TextAlign = TextAlignEnum.CenterCenter
                            'rgActive.StyleNew.ImageAlign = ImageAlignEnum.CenterCenter
                            'If strSmokeActive = "Active" Then
                            '    .SetCellCheck(_Row, 9, CheckEnum.Checked)
                            'End If
                            'If Not IsNothing(dtSmoking) Then ''slr free dtsmoking
                            '    dtSmoking.Dispose()
                            'End If
                            'dtSmoking = Nothing
                            strSmokings = Nothing
                            arrSmoking = Nothing
                            'objclsPHistory = Nothing
                        ElseIf IsActive Then

                            Dim strReaction As String = ""
                            Dim strActive As String = ""
                            If dt.Rows(i)("sReaction") <> "" Then
                                Dim arr() As String 'Srting Array
                                arr = Split(dt.Rows(i)("sReaction"), "|")
                                strReaction = arr.GetValue(0)
                                If (arr.Length > 1) Then
                                    strActive = arr.GetValue(1)
                                End If
                                arr = Nothing
                            End If
                            rgActive.StyleNew.DataType = GetType(Boolean)
                            rgActive.StyleNew.TextAlign = TextAlignEnum.CenterCenter
                            rgActive.StyleNew.ImageAlign = ImageAlignEnum.CenterCenter

                            If strActive = "Active" Then
                                .SetCellCheck(_Row, 9, CheckEnum.Checked)
                            End If

                            strActive = Nothing
                            strReaction = Nothing
                        End If

                        cStyle = Nothing
                        rgReaction = Nothing
                        rgActive = Nothing

                        .SetData(_Row, 10, dt.Rows(i)("nDrugID"))
                        .Row = _Row

                        _Row = Nothing
                    Next

                End If
                FillHistroy()
                .EndInit()
            End With
            If Not IsNothing(objclsDB) Then  ''slr dispose objclsdb
                objclsDB = Nothing
            End If
            If Not IsNothing(dtReaction) Then
                dtReaction.Dispose()
                dtReaction = Nothing
            End If
            If Not IsNothing(dtSmoking) Then
                dtSmoking.Dispose()
                dtSmoking = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub FillHistroy()
        '' Chetan 20101117'' TO SHOW ACTIVE/INACTIVE/ALL ALLERGIES WITH COMBO CHANGE ''
        Dim myCount As Integer = 0
        Dim myArrLst As New ArrayList()
        myArrLst.Clear()
        Try
            If C1dgPatientDetails.Rows.Count <= 1 Then
                Exit Sub
            End If

            Select Case cmbStatus.SelectedItem.ToString().ToUpper()
                Case "ALL"

                    For iRow As Integer = 1 To C1dgPatientDetails.Rows.Count - 1
                        '  If C1dgPatientDetails.GetData(iRow, 1).ToString() = "Allergies" Then
                        C1dgPatientDetails.Rows(iRow).Visible = True
                        ' End If
                    Next

                Case "ACTIVE"
                    For iRow As Integer = 1 To C1dgPatientDetails.Rows.Count - 1
                        ' If C1dgPatientDetails.GetData(iRow, 1).ToString() = "Allergies" Then
                        If C1dgPatientDetails.GetCellCheck(iRow, 9) = CheckEnum.Unchecked Then
                            C1dgPatientDetails.Rows(iRow).Visible = False
                        Else
                            C1dgPatientDetails.Rows(iRow).Visible = True
                            myArrLst.Add(iRow)
                            myCount = iRow
                        End If
                        '  End If
                    Next
                Case "INACTIVE"
                    For iRow As Integer = 1 To C1dgPatientDetails.Rows.Count - 1
                        '  If C1dgPatientDetails.GetData(iRow, 1).ToString() = "Allergies" Then
                        If C1dgPatientDetails.GetCellCheck(iRow, 9) = CheckEnum.Checked Then
                            C1dgPatientDetails.Rows(iRow).Visible = False
                        Else
                            C1dgPatientDetails.Rows(iRow).Visible = True
                        End If
                        '   End If
                    Next
            End Select
            If myCount = 1 Then
                ''If All Allergies are InActive then don't show the Allergy(Text) Category.
                C1dgPatientDetails.Rows(myArrLst.Item(0)).Visible = False
            End If
            If Not IsNothing(myArrLst) Then ''Slr free myArrlst
                myArrLst.Clear()
                myArrLst = Nothing
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
        ' '' Chetan 20101117'' TO SHOW ACTIVE/INACTIVE/ALL ALLERGIES WITH COMBO CHANGE ''
        'Try
        '    If C1dgPatientDetails.Rows.Count <= 1 Then
        '        Exit Sub
        '    End If

        '    Select Case cmbStatus.SelectedItem.ToString().ToUpper()
        '        Case "ALL"

        '            For iRow As Integer = 1 To C1dgPatientDetails.Rows.Count - 1
        '                If C1dgPatientDetails.GetData(iRow, 1).ToString() = "Allergies" Then
        '                    C1dgPatientDetails.Rows(iRow).Visible = True
        '                End If
        '            Next

        '        Case "ACTIVE"
        '            For iRow As Integer = 1 To C1dgPatientDetails.Rows.Count - 1
        '                If C1dgPatientDetails.GetData(iRow, 1).ToString() = "Allergies" Then
        '                    If C1dgPatientDetails.GetCellCheck(iRow, 9) = CheckEnum.Unchecked Then
        '                        C1dgPatientDetails.Rows(iRow).Visible = False
        '                    Else
        '                        C1dgPatientDetails.Rows(iRow).Visible = True
        '                    End If
        '                End If
        '            Next
        '        Case "INACTIVE"
        '            For iRow As Integer = 1 To C1dgPatientDetails.Rows.Count - 1
        '                If C1dgPatientDetails.GetData(iRow, 1).ToString() = "Allergies" Then
        '                    If C1dgPatientDetails.GetCellCheck(iRow, 9) = CheckEnum.Checked Then
        '                        C1dgPatientDetails.Rows(iRow).Visible = False
        '                    Else
        '                        C1dgPatientDetails.Rows(iRow).Visible = True
        '                    End If
        '                End If
        '            Next
        '    End Select
        'Catch ex As Exception
        '    gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString(), False)
        'End Try
    End Sub

    Private Sub Fill_Insurances()

        Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)
        Dim dt_ins As DataTable = Nothing
       
        Try

            dt_ins = ogloPatient.getPatientInsurancesNew(gnPatientID)

            If dt_ins IsNot Nothing Then
                C1dgPatientDetails.Cols.Count = dt_ins.Columns.Count
                C1dgPatientDetails.DataSource = dt_ins.DefaultView

                C1dgPatientDetails.SetData(0, 0, "Insurance ID")
                C1dgPatientDetails.SetData(0, 1, "Insurance Name")
                'line commented and modified by dipak 20091221 to display subscriberID as InsuranceID
                C1dgPatientDetails.SetData(0, 2, "Insurance ID")
                'end
                C1dgPatientDetails.SetData(0, 3, "Subscriber Name")
                C1dgPatientDetails.SetData(0, 4, "Policy")
                C1dgPatientDetails.SetData(0, 5, "Group")
                C1dgPatientDetails.SetData(0, 6, "Subscriber Phone")
                'code commented by dipak 20091216 to fix bug No :Main dashboard Insurance tab issues as index changed
                C1dgPatientDetails.SetData(0, 45, "Insurance Phone")
                C1dgPatientDetails.SetData(0, 43, "Type")
                C1dgPatientDetails.SetData(0, 16, "Coverage %")
                C1dgPatientDetails.SetData(0, 17, "Copay")
                ''added for Problem 00000213 8020V
                C1dgPatientDetails.SetData(0, 48, "Benefit Note")
                C1dgPatientDetails.Cols(0).Visible = False
                C1dgPatientDetails.Cols(2).Visible = True
                C1dgPatientDetails.Cols(4).Visible = False
                C1dgPatientDetails.Cols(45).Visible = True
                C1dgPatientDetails.Cols(6).Visible = False

                C1dgPatientDetails.Cols(0).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(2).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(3).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(4).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(5).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(6).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(7).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(43).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(16).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(17).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter



                C1dgPatientDetails.Cols(0).AllowEditing = False
                C1dgPatientDetails.Cols(1).AllowEditing = False
                C1dgPatientDetails.Cols(2).AllowEditing = False
                C1dgPatientDetails.Cols(3).AllowEditing = False
                C1dgPatientDetails.Cols(4).AllowEditing = False
                C1dgPatientDetails.Cols(5).AllowEditing = False
                C1dgPatientDetails.Cols(6).AllowEditing = False
                C1dgPatientDetails.Cols(7).AllowEditing = False
                C1dgPatientDetails.Cols(43).AllowEditing = False
                C1dgPatientDetails.Cols(16).AllowEditing = False
                C1dgPatientDetails.Cols(17).AllowEditing = False
                C1dgPatientDetails.Cols(48).AllowEditing = False      ''added for Problem 00000213 8020V

                Dim _width As Integer = (C1dgPatientDetails.Width - 15) / 10
                'Change for resolving the case No :GLO2009 - 0003377
                If _width < ((Convert.ToInt32(c1dgPatientDetailSize) - 15) / 10) AndAlso c1dgPatientDetailSize <> Nothing Then
                    _width = ((Convert.ToInt32(c1dgPatientDetailSize) - 15) / 10)
                End If

                C1dgPatientDetails.Cols(1).Width = _width * 1.6
                C1dgPatientDetails.Cols(2).Width = _width * 1.6
                C1dgPatientDetails.Cols(3).Width = _width * 1.6
                C1dgPatientDetails.Cols(4).Width = 0
                C1dgPatientDetails.Cols(5).Width = _width * 1
                C1dgPatientDetails.Cols(6).Width = _width * 1.3
                C1dgPatientDetails.Cols(7).Width = 0
                C1dgPatientDetails.Cols(43).Width = _width * 0.8
                C1dgPatientDetails.Cols(16).Width = _width * 0.8
                C1dgPatientDetails.Cols(17).Width = _width * 0.8
                C1dgPatientDetails.Cols(48).Width = _width * 1.2

                _width = Nothing

                'for loop condition modified by dipak 20091221 to hide bauto chaim to fix bu no 4954 Dashboard > Insurance Tab > shows unnecessary 'bAutoClaim' column under Insurance.
                'For i As Integer = 7 To C1dgPatientDetails.Cols.Count - 1
                For i As Integer = 7 To C1dgPatientDetails.Cols.Count - 1
                    C1dgPatientDetails.Cols(i).Visible = False
                Next
                C1dgPatientDetails.Cols(48).Visible = True      ''added for Problem 00000213 8020V
                C1dgPatientDetails.Cols(45).Visible = True
                C1dgPatientDetails.Cols(43).Visible = True
                C1dgPatientDetails.Cols(16).Visible = True
                C1dgPatientDetails.Cols(17).Visible = True
                C1dgPatientDetails.Cols(2).Move(3)
                C1dgPatientDetails.Cols(43).Move(2)
                'code added by dipak to move column to posiotion to arrange sequence
                C1dgPatientDetails.Cols(45).Move(7)
            End If
            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Insurance viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception

        Finally
            If ogloPatient IsNot Nothing Then
                ogloPatient.Dispose()
                ogloPatient = Nothing
            End If

            If dt_ins IsNot Nothing Then
                dt_ins.Dispose()
                dt_ins = Nothing
            End If

        End Try
    End Sub

    Private Sub fill_medication()
        Dim objpatientdetail As New clsPatientDetails
        Dim dtfiltered As DataTable ''Slr new not needed 
        ''added by mayuri:20100119-to get details according to criteria selection
        dtPatientDetails = objpatientdetail.Fill_Medication(gnPatientID)

        '' In case of Active we are showing records only for the To date (Current Active)
        '' So disabled the Checkbox 
        If (cmbStatus.Text = "Active") Then
            chkenbdate.Enabled = False
            chkenbdate.Checked = False
        Else
            chkenbdate.Enabled = True
        End If

        If chkenbdate.Checked = False Then
            If Not IsNothing(dtPatientDetails) Then
                RemoveHandler dtpFromDate.TextChanged, AddressOf dtpFromDate_TextChanged
                RemoveHandler dtpToDate.TextChanged, AddressOf dtpToDate_TextChanged

                Search(dtPatientDetails)

                AddHandler dtpFromDate.TextChanged, AddressOf dtpFromDate_TextChanged
                AddHandler dtpToDate.TextChanged, AddressOf dtpToDate_TextChanged

            End If
        End If

        ''
        If _SeachFlag Then
            Dim dvfilter As DataView  ''Slr new not needed 
            dvfilter = dtPatientDetails.DefaultView

            '' filter by dates '' 
            Dim strfilter As String = ""
            If cmbStatus.Text = "Active" Then
                strfilter = "dtmedicationdate >=  '" & dtpToDate.Value.Date & " 12:00:00 am" & "' and dtmedicationdate <= '" & dtpToDate.Value.Date & " 11:59:59 pm" & "' "

            Else
                strfilter = "dtmedicationdate >=  '" & dtpFromDate.Value.Date & " 12:00:00 am" & "' and dtmedicationdate <= '" & dtpToDate.Value.Date & " 11:59:59 pm" & "' "

            End If

            If cmbStatus.Text <> "All" AndAlso cmbStatus.Text <> "Active All" Then '' filter only status ''
                strfilter = strfilter & " and sStatus = '" & cmbStatus.Text & "' "
            ElseIf cmbStatus.Text = "Active All" Then
                If chkenbdate.Checked = False Then 'Developer:Pradeep/Date:03/05/2012/Bug:22468/Reason:Date filter was not implemented 
                    strfilter = "sStatus = " & "'Active'"
                Else
                    strfilter = strfilter & " and  sStatus = " & "'Active'"
                End If

            End If

            dvfilter.RowFilter = strfilter
            dtfiltered = dvfilter.ToTable

            If Not IsNothing(dvfilter) Then
                dvfilter.Dispose()
            End If
            dvfilter = Nothing

        Else
            dtfiltered = dtPatientDetails
        End If

        'PRD : PRD EMR 6030_XXXX Rx Workflow, Configurable Rx Formats functionality changes
        objpatientdetail.Dispose()
        objpatientdetail = Nothing
        C1dgPatientDetails.DataSource = dtfiltered.DefaultView
        C1dgPatientDetails.Cols("dtmedicationdate").Caption = "Updated"
        C1dgPatientDetails.Cols("username").Caption = "Reviewed By"
        C1dgPatientDetails.Cols("UpdatedBy").Caption = "Updated By"
        C1dgPatientDetails.Cols("smedication").Caption = "Drug"
        C1dgPatientDetails.Cols("Prescriber").Caption = "Prescriber"
        C1dgPatientDetails.Cols("dtstartdate").Caption = "Start Date"
        C1dgPatientDetails.Cols("dtenddate").Caption = "End Date"
        C1dgPatientDetails.Cols("sstatus").Caption = "Status"
        C1dgPatientDetails.Cols("sfrequency").Caption = "Patient Directions"
        C1dgPatientDetails.Cols("sduration").Caption = "Duration"
        C1dgPatientDetails.Cols("samount").Caption = "Quantity" '"amount"
        C1dgPatientDetails.Cols("sRefills").Caption = "Refills"
        C1dgPatientDetails.Cols("sMethod").Caption = "Issue Method"
        C1dgPatientDetails.Cols("Pharmacy").Caption = "Pharmacy"
        'PRD EMR 6030_XXXX Rx Workflow Updated PRD Rx Field Names
        C1dgPatientDetails.Cols("username").Visible = True

        C1dgPatientDetails.Cols("sDosage").Caption = "Dosage"
        C1dgPatientDetails.Cols("sRoute").Caption = "Route"

        C1dgPatientDetails.Cols("sDosage").Move(7)
        C1dgPatientDetails.Cols("sRoute").Move(8)
        C1dgPatientDetails.Cols("sfrequency").Move(9)

        C1dgPatientDetails.AllowEditing = False
        C1dgPatientDetails.AllowSorting = True

        Dim _width As Integer = pnlPatientDetail.Width
        'For Resolving case no : GLO2009-0003377
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If

        'PRD : PRD EMR 6030_XXXX Rx Workflow, Configurable Rx Formats functionality 

        C1dgPatientDetails.Cols("dtmedicationdate").Width = _width * 0.08
        C1dgPatientDetails.Cols("smedication").Width = _width * 0.2
        C1dgPatientDetails.Cols("Prescriber").Width = _width * 0.1
        C1dgPatientDetails.Cols("dtstartdate").Width = _width * 0.08
        C1dgPatientDetails.Cols("dtenddate").Width = _width * 0.08
        C1dgPatientDetails.Cols("sstatus").Width = _width * 0.07
        C1dgPatientDetails.Cols("username").Width = _width * 0.09
        C1dgPatientDetails.Cols("UpdatedBy").Width = _width * 0.09
        C1dgPatientDetails.Cols("sfrequency").Width = _width * 0.12
        C1dgPatientDetails.Cols("sduration").Width = _width * 0.07
        C1dgPatientDetails.Cols("samount").Width = _width * 0.07
        C1dgPatientDetails.Cols("sRefills").Width = _width * 0.05
        C1dgPatientDetails.Cols("sMethod").Width = _width * 0.095
        'PRD EMR 6030_XXXX Rx Workflow Updated PRD Rx Field Names
        C1dgPatientDetails.Cols("Pharmacy").Width = _width * 0.09

        C1dgPatientDetails.Cols("sDosage").Width = _width * 0.1
        C1dgPatientDetails.Cols("sRoute").Width = _width * 0.12

        If Not IsNothing(dtfiltered) Then
            dtfiltered.Dispose()
        End If

        dtfiltered = Nothing

        _width = Nothing

        C1dgPatientDetails.Cols("samount").TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "patient medication viewed from dashboard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub


    Private Sub Fill_PatientPrescription(ByVal PatientID As Long)
        Dim dtFiltered As DataTable
        
        Using p As New gloEMRGeneralLibrary.PrescriptionBusinessLayer()
            dtPatientDetails = p.GetPatientPrescriptions(PatientID, chkCancelRx.Checked)
        End Using

        Dim strFilter As String = ""
        Dim dvFilter As New DataView
        C1dgPatientDetails.Clear(ClearFlags.All)
        dvFilter = dtPatientDetails.DefaultView

        '' This condition is added to implement the optional From/To date filters.
        If (chkenbdate.Checked) Then
            '' FILTER BY DATES '' 
            strFilter = "dtPrescriptionDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND dtPrescriptionDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "

            '' FILTER DATAVIEW ''
            If cmbStatus.Text <> "All" Then '' FILTER ONLY METHOD ''
                strFilter = strFilter & " AND sMethod = '" & cmbStatus.Text & "' "
            End If
        Else
            If cmbStatus.Text <> "All" Then '' FILTER ONLY METHOD ''
                strFilter = " sMethod = '" & cmbStatus.Text & "' "
            End If
        End If

        dvFilter.RowFilter = strFilter

        strFilter = Nothing

        dtFiltered = dvFilter.ToTable

        dvFilter.Dispose()
        dvFilter = Nothing
        
        'PRD : PRD EMR 6030_XXXX Rx Workflow, Configurable Rx Formats functionality 
        With C1dgPatientDetails

            'PRD : PRD EMR 6030_XXXX Rx Workflow, Configurable Rx Formats functionality 
            .AllowSorting = True

            .Visible = True
            .BringToFront()
            'CR : #CR00001071: Added column 'Pharmacy' in patient details on dashborad
            .Cols.Count = 19
            .Rows.Count = 1
            '' Set Fixed Rows
            .SetData(0, 0, "Date")
            .SetData(0, 1, "Drug")
            .SetData(0, 2, "Prescriber")
            .SetData(0, 3, "Patient Directions")
            .SetData(0, 4, "Duration")
            .SetData(0, 5, "Quantity") '.SetData(0, 6, "Amount")
            .SetData(0, 6, "Refills")
            .SetData(0, 7, "Issue Method")
            .SetData(0, 8, "Status")
            .SetData(0, 9, "eRx Message")
            .SetData(0, 10, "User")
            .SetData(0, 11, "Allow Substitution")
            'CR : #CR00001071: Added column 'Pharmacy' in patient details on dashborad
            .SetData(0, 12, "Pharmacy")
            .SetData(0, 13, "Pharmacy Note")
            .SetData(0, 14, "Prescription Id")
            .SetData(0, 15, "IseRxed")
            .SetData(0, 16, "Cancelled Rx")
            .SetData(0, 17, "PharmacyId")
            .SetData(0, 18, "ProviderId")
            '''' 
            Dim _width As Integer = pnlPatientDetail.Width
            'For Resolving case no : GLO2009-0003377
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If


            'PRD : PRD EMR 6030_XXXX Rx Workflow, Configurable Rx Formats functionality 
            .Cols(0).Width = _width * 0.08
            .Cols(1).Width = _width * 0.2
            .Cols(2).Width = _width * 0.1
            .Cols(3).Width = _width * 0.12
            .Cols(4).Width = _width * 0.07
            .Cols(5).Width = _width * 0.07
            .Cols(6).Width = _width * 0.05
            .Cols(7).Width = _width * 0.095
            .Cols(8).Width = _width * 0.1
            .Cols(9).Width = _width * 0.0
            .Cols(10).Width = _width * 0.08
            .Cols(11).Width = _width * 0.14
            'CR : #CR00001071: Added column 'Pharmacy' in patient details on dashborad
            .Cols(12).Width = _width * 0.2
            .Cols(13).Width = _width * 0.1
            .Cols(14).Width = 0 '_width * 0.1
            .Cols(15).Width = 0 '_width * 0.1
            .Cols(16).Width = _width * 0.0
            .Cols(17).Width = 0
            .Cols(18).Width = 0

            _width = Nothing

            .Cols(0).TextAlign = TextAlignEnum.LeftCenter
            .Cols(1).TextAlign = TextAlignEnum.LeftCenter
            .Cols(2).TextAlign = TextAlignEnum.LeftCenter
            .Cols(3).TextAlign = TextAlignEnum.LeftCenter
            .Cols(4).TextAlign = TextAlignEnum.LeftCenter
            .Cols(5).TextAlign = TextAlignEnum.LeftCenter
            .Cols(6).TextAlign = TextAlignEnum.LeftCenter
            .Cols(7).TextAlign = TextAlignEnum.LeftCenter
            .Cols(8).TextAlign = TextAlignEnum.LeftCenter
            .Cols(9).TextAlign = TextAlignEnum.LeftCenter
            .Cols(10).TextAlign = TextAlignEnum.LeftCenter
            .Cols(11).TextAlign = TextAlignEnum.LeftCenter
            'CR : #CR00001071: Added column 'Pharmacy' in patient details on dashborad
            .Cols(12).TextAlign = TextAlignEnum.LeftCenter
            .Cols(13).TextAlign = TextAlignEnum.LeftCenter
            .Cols(14).TextAlign = TextAlignEnum.LeftCenter
            .Cols(15).TextAlign = TextAlignEnum.LeftCenter
            .Cols(16).TextAlign = TextAlignEnum.LeftCenter
            .Cols(17).TextAlign = TextAlignEnum.LeftCenter
            .Cols(18).TextAlign = TextAlignEnum.LeftCenter

            If IsNothing(dtFiltered) = False Then
                For i As Int16 = 0 To dtFiltered.Rows.Count - 1
                    Dim r As C1.Win.C1FlexGrid.Row
                    r = .Rows.Add()
                    r.Height = 20
                    'Added for the PRD : PRD EMR 6030_XXXX Rx Workflow, Configurable Rx Formats functionality changes
                    .SetData(r.Index, 0, CType(dtFiltered.Rows(i)("dtPrescriptionDate"), Date).ToShortDateString())
                    .SetData(r.Index, 1, dtFiltered.Rows(i)("sMedication")) ' & " " & dtFiltered.Rows(i)("sDosage") & " " & dtFiltered.Rows(i)("sDrugForm") & " " & dtFiltered.Rows(i)("sRoute"))
                    .SetData(r.Index, 2, dtFiltered.Rows(i)("Prescriber"))
                    .SetData(r.Index, 3, dtFiltered.Rows(i)("sFrequency"))
                    .SetData(r.Index, 4, dtFiltered.Rows(i)("sDuration"))
                    .SetData(r.Index, 5, dtFiltered.Rows(i)("sAmount"))
                    .SetData(r.Index, 6, dtFiltered.Rows(i)("sRefills"))
                    .SetData(r.Index, 7, dtFiltered.Rows(i)("sMethod"))
                    .SetData(r.Index, 8, dtFiltered.Rows(i)("eRxStatus"))
                    'commented in 6030 for Rx feild changes To show eRxStatus we have provided option in context menu

                    .SetData(r.Index, 9, dtFiltered.Rows(i)("eRxStatusMessage"))
                    .SetData(r.Index, 10, dtFiltered.Rows(i)("UserName"))
                    .SetData(r.Index, 11, dtFiltered.Rows(i)("AllowSubstitue"))
                    'CR : #CR00001071: Added column 'Pharmacy' in patient details on dashborad
                    .SetData(r.Index, 12, dtFiltered.Rows(i)("sName"))
                    Dim str As String = dtFiltered.Rows(i)("sNotes")
                    .SetData(r.Index, 13, str.Replace(Environment.NewLine, " "))
                    .SetData(r.Index, 14, dtFiltered.Rows(i)("PrescriptionID"))
                    .SetData(r.Index, 15, dtFiltered.Rows(i)("IseRxed"))
                    .SetUserData(r.Index, 16, dtFiltered.Rows(i)("IsCancelled"))
                    .SetData(r.Index, 17, dtFiltered.Rows(i)("PharmacyId"))
                    .SetData(r.Index, 18, dtFiltered.Rows(i)("ProviderId"))

                    r = Nothing

                Next

            End If
        End With

        dtFiltered.Dispose()
        dtFiltered = Nothing

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Prescription viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub

    Private Sub Fill_ProblemList()
        Dim dtFiltered As DataTable
        Dim objProblemList As New clsPatientProblemList
        Dim strFilter As String = ""
        Dim dvFilter As New DataView

        'Added by Mayuri:20100119-To get details according to criteria selection
        dtPatientDetails = objProblemList.Fill_ProblemLists(gnPatientID)

        If (chkenbdate.Checked = True) Then
            strFilter = "dtDOS >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND dtDOS <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "
        End If

        ' If _SeachFlag Then  commented 
        C1dgPatientDetails.Clear(ClearFlags.All)

        dvFilter = dtPatientDetails.DefaultView

        '' FILTER BY DATES '' 
        '' FILTER DATAVIEW ''
        If cmbStatus.Text <> "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER BOTH ''
            '' FILTER STATUS ''
            If strFilter.Trim() <> "" Then
                strFilter = strFilter & " AND Status = " & cmbStatus.SelectedValue & " "
                '' FILTER USER ''
                strFilter = strFilter & " AND UserName = '" & cmbProvider.Text & "'"
            Else
                strFilter = "  Status = " & cmbStatus.SelectedValue & " "
                '' FILTER USER ''
                strFilter = strFilter & " AND UserName = '" & cmbProvider.Text & "'"

            End If

        ElseIf cmbStatus.Text <> "All" AndAlso cmbProvider.Text = "All" Then '' FILTER ONLY STATUS ''
            If strFilter.Trim() <> "" Then
                strFilter = strFilter & " AND Status = " & cmbStatus.SelectedValue & " "
            Else
                strFilter = "  Status = " & cmbStatus.SelectedValue & " "
            End If


        ElseIf cmbStatus.Text = "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER ONLY USER ''
            If strFilter.Trim() <> "" Then
                strFilter = strFilter & " AND UserName = '" & cmbProvider.Text & "'"
            Else
                strFilter = "  UserName = '" & cmbProvider.Text & "'"
            End If
        End If


        If strFilter.Trim() <> "" Then
            dvFilter.RowFilter = strFilter
            dtFiltered = dvFilter.ToTable
        Else
            dtFiltered = dtPatientDetails
        End If

        dvFilter.Dispose()
        dvFilter = Nothing

        strFilter = Nothing

        objProblemList.Dispose()
        objProblemList = Nothing

        With C1dgPatientDetails
            .Visible = True
            .BringToFront()
            .Cols.Count = 20 '8
            .Rows.Count = 1
            '' Set Fixed Rows
            .SetData(0, 0, "ProblemID")
            .SetData(0, 1, "DOS")
            '.SetData(0, 2, "Chief Complaint")
            .SetData(0, 2, "Description")
            .SetData(0, 3, "SnoMed CT ID")
            .SetData(0, 4, "Diagnosis")
            .SetData(0, 5, "Prescription")
            .SetData(0, 6, "VisitID")
            .SetData(0, 7, "Status")
            .SetData(0, 8, "User")
            .SetData(0, 9, "Resolved Date")
            .SetData(0, 10, "UserID")
            .SetData(0, 11, "Immediacy")

            .SetData(0, 12, "Provider")
            .SetData(0, 13, "Location")
            .SetData(0, 14, "Last Update")

            .SetData(0, 15, "ExamID")

            .SetData(0, 16, "Problem Type")

            .SetData(0, 17, "SnoMed ID")
            .SetData(0, 18, "Description ID")
            .SetData(0, 19, "Defination")

            Dim _width As Integer = pnlPatientDetail.Width
            'For Resolving case no : GLO2009-0003377
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If


            .Cols(0).Width = 0
            .Cols(1).Width = _width * 0.1
            .Cols(2).Width = _width * 0.2
            .Cols(3).Width = _width * 0.1
            .Cols(4).Width = _width * 0.3
            .Cols(5).Width = _width * 0.3
            .Cols(6).Width = 0
            .Cols(7).Width = _width * 0.08
            .Cols(8).Width = _width * 0.1
            .Cols(9).Width = _width * 0.15
            .Cols(10).Width = _width * 0
            .Cols(11).Width = _width * 0.15
            .Cols(12).Width = _width * 0.15
            .Cols(13).Width = _width * 0.15
            .Cols(14).Width = _width * 0.11
            .Cols(15).Width = _width * 0.0
            .Cols(16).Width = _width * 0.1

            .Cols(17).Width = _width * 0
            .Cols(18).Width = _width * 0
            .Cols(19).Width = _width * 0

            _width = Nothing


            .Cols(0).TextAlign = TextAlignEnum.LeftCenter
            .Cols(1).TextAlign = TextAlignEnum.LeftCenter
            .Cols(2).TextAlign = TextAlignEnum.LeftCenter
            .Cols(3).TextAlign = TextAlignEnum.LeftCenter
            .Cols(4).TextAlign = TextAlignEnum.LeftCenter
            .Cols(5).TextAlign = TextAlignEnum.LeftCenter
            .Cols(6).TextAlign = TextAlignEnum.LeftCenter
            .Cols(7).TextAlign = TextAlignEnum.LeftCenter
            .Cols(8).TextAlign = TextAlignEnum.LeftCenter
            .Cols(9).TextAlign = TextAlignEnum.LeftCenter
            .Cols(10).TextAlign = TextAlignEnum.LeftCenter
            .Cols(11).TextAlign = TextAlignEnum.LeftCenter
            .Cols(12).TextAlign = TextAlignEnum.LeftCenter
            .Cols(13).TextAlign = TextAlignEnum.LeftCenter
            .Cols(14).TextAlign = TextAlignEnum.LeftCenter
            .Cols(15).TextAlign = TextAlignEnum.LeftCenter
            .Cols(16).TextAlign = TextAlignEnum.LeftCenter

            If IsNothing(dtFiltered) = False Then
                For i As Int16 = 0 To dtFiltered.Rows.Count - 1
                    Dim forecolor As Color
                    'Dim backcolor As Color
                    Dim status As String = ""

                    If dtFiltered.Rows(i)("Status") = frmProblemList.Status.Active Then
                        forecolor = Color.Red
                        status = "Active"
                    ElseIf dtFiltered.Rows(i)("Status") = frmProblemList.Status.Resolved Then
                        forecolor = Color.Green
                        status = "Resolved"
                    ElseIf dtFiltered.Rows(i)("Status") = frmProblemList.Status.Inactive Then
                        forecolor = Color.Blue
                        status = "Inactive"
                    ElseIf dtFiltered.Rows(i)("Status") = frmProblemList.Status.Chronic Then
                        forecolor = Color.Black
                        status = "Chronic"
                    End If

                    Dim r As C1.Win.C1FlexGrid.Row
                    r = .Rows.Add()
                    r.StyleNew.ForeColor = forecolor
                    r.Height = 20

                    .SetData(r.Index, 0, dtFiltered.Rows(i)("nProblemID"))
                    .SetData(r.Index, 1, dtFiltered.Rows(i)("dtDOS"))
                    .SetData(r.Index, 3, dtFiltered.Rows(i)("sConceptID"))
                    .SetData(r.Index, 4, dtFiltered.Rows(i)("Diagnosis"))

                    .SetData(r.Index, 5, dtFiltered.Rows(i)("Prescription"))
                    .SetData(r.Index, 6, dtFiltered.Rows(i)("VisitID"))
                    .SetData(r.Index, 7, status)
                    .SetData(r.Index, 8, dtFiltered.Rows(i)("UserName"))
                    .SetData(r.Index, 9, dtFiltered.Rows(i)("ResolvedDt"))
                    .SetData(r.Index, 10, dtFiltered.Rows(i)("nUserID"))
                    .SetData(r.Index, 11, dtFiltered.Rows(i)("Immediacy"))
                    .SetData(r.Index, 12, dtFiltered.Rows(i)("Provider"))
                    .SetData(r.Index, 13, dtFiltered.Rows(i)("Location"))

                    If Not IsNothing(dtFiltered.Rows(i)("ModifiedDate")) Then
                        If Not dtFiltered.Rows(i)("ModifiedDate").ToString().Contains("4/12/1900") Then
                            .SetData(r.Index, 14, dtFiltered.Rows(i)("ModifiedDate"))
                        End If
                    End If

                    .SetData(r.Index, 15, dtFiltered.Rows(i)("ExamID"))
                    .SetData(r.Index, 16, dtFiltered.Rows(i)("sTransactionID1"))

                    .SetData(r.Index, 17, dtFiltered.Rows(i)("sSnoMedID"))
                    .SetData(r.Index, 18, dtFiltered.Rows(i)("sDescriptionID"))
                    .SetData(r.Index, 19, dtFiltered.Rows(i)("sDescription"))

                    'added for showing chief complaint
                    Dim _strComplaints As String = ""
                    Dim _Comments() As String
                    Dim _nCommentCount As Integer = 0

                    If Not IsNothing(dtFiltered.Rows(i)("Comments")) Then
                        If dtFiltered.Rows(i)("Comments") <> "" Then
                            _strComplaints = dtFiltered.Rows(i)("Complaint") & vbNewLine & dtFiltered.Rows(i)("Comments")
                            _Comments = Split(dtFiltered.Rows(i)("Comments"), vbNewLine)
                            _nCommentCount = _Comments.Length + 1
                        Else
                            _strComplaints = dtFiltered.Rows(i)("Complaint")
                        End If
                    Else
                        _strComplaints = dtFiltered.Rows(i)("Complaint")
                    End If
                    .Rows(.Rows.Count - 1).AllowResizing = AllowDraggingEnum.Both
                    .Rows(.Rows.Count - 1).AllowDragging = DrawModeEnum.OwnerDraw
                    If _nCommentCount <> 0 Then
                        .Rows(.Rows.Count - 1).Height = .Rows.DefaultSize * _nCommentCount
                    End If
                    .SetData(r.Index, 2, _strComplaints)

                    _strComplaints = Nothing
                    _Comments = Nothing
                    _nCommentCount = Nothing

                    r = Nothing
                    forecolor = Nothing
                    status = Nothing

                Next
            End If
        End With

        If Not IsNothing(dtFiltered) Then
            dtFiltered.Dispose()
            dtFiltered = Nothing
        End If

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Problem List viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub

    Private Sub Fill_PatientScanedDocuments(ByVal PatientID As Long, Optional ByVal designGrid As Boolean = True)
        ' Dim oCategories As New gloEDocumentV3.Common.Categories()
        Dim oList As New gloEDocumentV3.eDocManager.eDocGetList()
        Dim oDocuments As gloEDocumentV3.Document.BaseDocuments = Nothing
        Dim oImage_D As New frmDMS_Support

        Try

            Dim IsArchiveDocument As Boolean = False
            Dim IsNotArchiveDocuemnt As Boolean = False
            IsArchiveDocument = oList.GetArchiveInformation(PatientID)
            IsNotArchiveDocuemnt = oList.GetNonArchiveInformation(PatientID)

            If IsArchiveDocument = False AndAlso IsNotArchiveDocuemnt = False Then
                pnlArchiveInfo.Visible = False
            ElseIf IsArchiveDocument = False AndAlso IsNotArchiveDocuemnt = True Then
                pnlArchiveInfo.Visible = False
            ElseIf IsArchiveDocument = True AndAlso IsNotArchiveDocuemnt = True Then
                pnlArchiveInfo.Visible = True
                lblInfo.Text = "Documents are partially archived for a patient " & gstrPatientFirstName & " " & gstrPatientLastName
            ElseIf IsArchiveDocument = True AndAlso IsNotArchiveDocuemnt = False Then
                pnlArchiveInfo.Visible = True
                lblInfo.Text = "Documents are archived for a patient " & gstrPatientFirstName & " " & gstrPatientLastName
            End If

            'Design Category Grid
            If designGrid Then
                DesignCategorisedDocument(C1dgPatientDetails)
            Else
                C1dgPatientDetails.Rows.Count = 1
            End If

            With C1dgPatientDetails
                oDocuments = oList.GetPatientBaseDocuments(gnPatientID, gClinicID)
                Dim arrYears As New ArrayList
                If Not oDocuments Is Nothing Then
                    For k As Int16 = 0 To oDocuments.Count - 1

                        For j As Integer = 0 To oDocuments(k).EContainers.Count - 1
                            'filter for date
                            If chkenbdate.Checked = True Then
                                If Not (oDocuments(k).CreatedDateTime.Date >= dtpFromDate.Value.Date AndAlso oDocuments(k).CreatedDateTime.Date <= dtpToDate.Value.Date) Then
                                    Continue For
                                End If
                            End If

                            'filter for year
                            If cmbStatus.Text <> "All" Then
                                If oDocuments(k).Year <> cmbStatus.Text Then
                                    Continue For
                                End If
                            End If

                            'filter for month
                            If cmbProvider.Text <> "All" Then
                                'Check value for month is numeric as there may be values 10 or October by Rohit on 2011-10-13.
                                If (oDocuments(k).Month <> cmbProvider.Text) Then
                                    If (cmbProvider.SelectedValue <> oDocuments(k).Month) Then
                                        Continue For
                                    End If
                                End If
                            End If

                            If arrYears.Contains(oDocuments(k).Year) = False Then
                                arrYears.Add(oDocuments(k).Year)
                            End If

                            .Rows.Add()
                            .Cols(COL_View_DocumentName).TextAlign = TextAlignEnum.LeftCenter

                            Dim rgStyle As C1.Win.C1FlexGrid.CellRange = .GetCellRange(.Rows.Count - 1, COL_View_DocumentName, .Rows.Count - 1, COL_View_DocumentName)
                            rgStyle.StyleNew.DataType = GetType(String)
                            .SetData(.Rows.Count - 1, COL_View_DocumentName, oDocuments(k).DocumentName)
                            .SetData(.Rows.Count - 1, COL_D_CAT_SOURCEMACHINE, "")  ' Source Machine
                            .SetData(.Rows.Count - 1, COL_D_CAT_SYSTEMFOLDER, "")    ' System Folder
                            .SetData(.Rows.Count - 1, COL_D_CAT_CONTAINER, oDocuments(k).EContainers(j).EContainerID)          ' Container
                            .SetData(.Rows.Count - 1, COL_View_Category, oDocuments(k).Category)            ' Category
                            .SetData(.Rows.Count - 1, COL_D_CAT_PATIENTID, gnPatientID)          ' Patient ID
                            .SetData(.Rows.Count - 1, COL_D_CAT_YEAR, oDocuments(k).Year)                    ' Year
                            .SetData(.Rows.Count - 1, COL_D_CAT_MONTH, oDocuments(k).Month)                  ' Month
                            .SetData(.Rows.Count - 1, COL_D_CAT_SOURCEBIN, "")          ' Source Bin
                            .SetData(.Rows.Count - 1, COL_D_CAT_INUSED, "")                ' In Used
                            .SetData(.Rows.Count - 1, COL_D_CAT_USEDMACHINE, "")      ' Used Machine
                            .SetData(.Rows.Count - 1, COL_D_CAT_USEDTYPE, "")            ' Used Type
                            .SetData(.Rows.Count - 1, COL_D_CAT_PATH, "")                    ' Path
                            .SetData(.Rows.Count - 1, COL_D_CAT_COLTYPE, CType(enumColType.Document, Integer))
                            .SetData(.Rows.Count - 1, COL_D_CAT_FILENAME, oDocuments(k).EContainers(j).EDocumentID) '' DocumentID
                            .SetData(.Rows.Count - 1, COL_D_CAT_MACHINEID, "")
                            .SetData(.Rows.Count - 1, COL_D_CAT_VERSIONNO, "")

                            If oDocuments(k).HasNote = True Then
                                .SetCellImage(.Rows.Count - 1, COL_View_NOTEFLAG, oImage_D.Img_Note.Image)  'Image.FromFile("D:\Vinayak M3XP\gloEMR\gloEMR\bin\Images\DMS\Flag1.JPG"))
                            End If
                            If oDocuments(k).IsAcknowledge = True Then
                                .SetData(.Rows.Count - 1, COL_D_CAT_ISREVIWED, 1)
                                .SetCellImage(.Rows.Count - 1, COL_View_REVIWEDFLAG, oImage_D.Img_Reviwed.Image)  'Image.FromFile("D:\Vinayak M3XP\gloEMR\gloEMR\bin\Images\DMS\Flag1.JPG"))
                                .Cols(COL_View_REVIWEDFLAG).ImageAlign = ImageAlignEnum.CenterCenter
                            Else
                                .SetData(.Rows.Count - 1, COL_D_CAT_ISREVIWED, 0)
                                .SetCellImage(.Rows.Count - 1, COL_View_REVIWEDFLAG, oImage_D.Img_Blanck.Image)  'Image.FromFile("D:\Vinayak M3XP\gloEMR\gloEMR\bin\Images\DMS\Flag1.JPG"))
                                .Cols(COL_View_REVIWEDFLAG).ImageAlign = ImageAlignEnum.CenterCenter
                            End If
                        Next
                    Next
                End If

                If arrYears.Count > 0 Then
                    arrYears.Sort()
                    For iYear As Integer = 0 To arrYears.Count - 1
                        If cmbStatus.Items.Contains(arrYears(iYear)) = False Then
                            cmbStatus.Items.Add(arrYears(iYear))
                        End If
                    Next
                End If

                arrYears = Nothing

            End With

            blnFormLoad = False

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Document List viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

        Catch objError As Exception
            blnFormLoad = False
            MessageBox.Show(objError.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK)
        Finally

            If Not IsNothing(oDocuments) Then
                oDocuments.Dispose()
                oDocuments = Nothing
            End If

            If Not IsNothing(oImage_D) Then
                oImage_D.Dispose()
                oImage_D = Nothing
            End If

            If Not IsNothing(oList) Then
                oList.Dispose()
                oList = Nothing
            End If

        End Try
    End Sub

    Private Sub Fill_Orders()
        Dim dtFiltered As DataTable
        Dim objPatientDetail As New clsPatientDetails

        dtPatientDetails = objPatientDetail.Fill_PatientOrders(gnPatientID)

        Dim dvFilter As DataView  ''SLR: new is not neeedd
        dvFilter = dtPatientDetails.DefaultView

        'FILTER BY DATES
        Dim strFilter As String = ""

        If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
            strFilter = "lm_OrderDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND lm_OrderDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "
        End If

        If strFilter.Trim() <> "" Then
            dvFilter.RowFilter = strFilter
            dtFiltered = dvFilter.ToTable
        Else
            dtFiltered = dtPatientDetails.Copy()
        End If

        strFilter = Nothing

        'dvFilter.Dispose()
        'dvFilter = Nothing

        objPatientDetail.Dispose()
        objPatientDetail = Nothing

        C1dgPatientDetails.DataSource = dtFiltered

        C1dgPatientDetails.Cols("lm_Visit_ID").Visible = False
        C1dgPatientDetails.Cols("ICD9").Visible = False
        C1dgPatientDetails.Cols("lm_NumericResult").Visible = False

        C1dgPatientDetails.Cols("lm_OrderDate").Caption = "Order Date"
        C1dgPatientDetails.Cols("lm_sCategoryName").Caption = "Category"
        C1dgPatientDetails.Cols("lm_sTestName").Caption = "Test Name"
        C1dgPatientDetails.Cols("lm_NumericResult").Caption = "Numeric Result"

        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If
        C1dgPatientDetails.Cols("lm_OrderDate").Width = _width * 0.23
        C1dgPatientDetails.Cols("lm_sCategoryName").Width = _width * 0.25
        C1dgPatientDetails.Cols("lm_sTestName").Width = _width * 0.25
        C1dgPatientDetails.Cols("lm_NumericResult").Width = _width * 0.23

        _width = Nothing
        If Not IsNothing(dvFilter) Then  ''slr free dvFilter
            dvFilter.Dispose()
        End If
        dvFilter = Nothing
        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Orders viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub

    Private Sub Fill_PatientMessages()

        Dim objPatientDetail As New clsPatientDetails
        Dim dtFiltered As DataTable
        dtPatientDetails = objPatientDetail.Fill_PatientMessges(gnPatientID)

        Dim dvFilter As DataView ''Slr new not needed 
        dvFilter = dtPatientDetails.DefaultView
        'FILTER BY DATES
        Dim strFilter As String = ""

        If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
            strFilter = "Date >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND Date <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "

        End If

        'FILTER DATAVIEW
        If cmbStatus.Text <> "All" Then 'FILTER BOTH
            'FILTER STATUS
            If strFilter.Trim() <> "" Then
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & " AND Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & " AND Finished = 'No' "
                End If
            Else
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & "  Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & " Finished = 'No' "
                End If
            End If
        End If
        If strFilter.Trim() <> "" Then
            dvFilter.RowFilter = strFilter
            dtFiltered = dvFilter.ToTable
        Else
            dtFiltered = dtPatientDetails.Copy() ''slr add copy 
        End If

        strFilter = Nothing

        objPatientDetail.Dispose()
        objPatientDetail = Nothing

        C1dgPatientDetails.DataSource = dtFiltered

        C1dgPatientDetails.Cols("nMessageID").Visible = False
        C1dgPatientDetails.Cols("sTemplateName").Caption = "Template"

        'Problem 00000024 : date column displays the date that the message was last "Saved" rather than "Created." 
        C1dgPatientDetails.Cols("Date").Caption = "Created Date"
        C1dgPatientDetails.Cols("LastReplyDate").Caption = "Last Replied Date"

        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If
        C1dgPatientDetails.Cols("Subject").Width = _width * 0.23   ''added for message PRD changes 8022
        C1dgPatientDetails.Cols("Date").Width = _width * 0.1
        C1dgPatientDetails.Cols("LastReplyDate").Width = _width * 0.12
        C1dgPatientDetails.Cols("sTemplateName").Width = _width * 0.35
        C1dgPatientDetails.Cols("Finished").Width = _width * 0.08
        C1dgPatientDetails.Cols("Priority").Width = _width * 0.07
        C1dgPatientDetails.Cols("Priority").Caption = "Priority"

        _width = Nothing

        '02-Dec-14 Aniket: Patient switching optimization
        'Dim oMessage As New clsMessage
        'If oMessage.IsContainHighPriorityMessage(gnLoginID) Then
        '    sslbl_MessagePriority.Visible = True
        'Else
        '    sslbl_MessagePriority.Visible = False
        'End If

        'oMessage.Dispose()
        'oMessage = Nothing

        If Not IsNothing(dvFilter) Then  ''Slr dispose dvfilter
            dvFilter.Dispose()
        End If
        dvFilter = Nothing
        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Messages viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub
    Private Sub Fill_PatientCommunication()
        Dim objPatientDetail As New clsPatientDetails
        Try

            Dim dtFiltered As DataTable
            dtPatientDetails = objPatientDetail.Fill_PatientCommunication(gnPatientID)

            Dim dvFilter As New DataView
            dvFilter = dtPatientDetails.DefaultView
            'FILTER BY DATES
            Dim strFilter As String = ""

            If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
                strFilter = "Date >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND Date <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "

            End If



            If strFilter.Trim() <> "" Then
                dvFilter.RowFilter = strFilter
                dtFiltered = dvFilter.ToTable
            Else
                dtFiltered = dtPatientDetails
            End If

            strFilter = Nothing




            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.DataSource = dtFiltered

            C1dgPatientDetails.Cols("nID").Visible = False

            C1dgPatientDetails.Cols("Title").Caption = "Title"


            C1dgPatientDetails.Cols("Type").Caption = "Comm. Type"
            C1dgPatientDetails.Cols("CommType").Caption = "Type"

            Dim _width As Integer = pnlPatientDetail.Width
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If
            C1dgPatientDetails.Cols("Date").DataType = GetType(String)
            C1dgPatientDetails.Cols("Date").AllowSorting = False
            C1dgPatientDetails.Cols("Date").Width = _width * 0.15
            C1dgPatientDetails.Cols("Type").Width = _width * 0.15
            C1dgPatientDetails.Cols("Title").Width = _width * 0.45
            C1dgPatientDetails.Cols("CommType").Width = _width * 0.25
            _width = Nothing


            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Messages viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        Finally
            If Not IsNothing(objPatientDetail) Then
                objPatientDetail.Dispose()
                objPatientDetail = Nothing
            End If

        End Try
    End Sub
    Private Sub Fill_PastExams()
        Try


            Dim dtFiltered As DataTable ''Slr new not needed 
            Dim objPatientDetail As New clsPatientDetails

            ''added for optimizing dashboard patient details Exam tab
            Dim dsExam As DataSet = objPatientDetail.Fill_PastExams_Dashboard(gnPatientID)
            objPatientDetail.Dispose()
            objPatientDetail = Nothing
            If (IsNothing(dsExam) = False) Then
                If dsExam.Tables.Count > 0 Then
                    dtPatientDetails = dsExam.Tables(0)
                End If
            End If

            If (IsNothing(dtPatientDetails)) Then
                Exit Sub
                'SLR: No need to create blank table
                ' dtPatientDetails = New DataTable()
            End If
            If Not IsNothing(dt_ExamID) Then
                dt_ExamID.Dispose()
                dt_ExamID = Nothing
            End If
            If IsNothing(dt_TemplateSpeciality) Then
                If dsExam.Tables.Count > 2 Then
                    dt_TemplateSpeciality = dsExam.Tables(2)
                    Fill_TemplateSpecility()
                End If
            End If
            If IsNothing(dt_ProviderCombo) Then
                If dsExam.Tables.Count > 3 Then
                    dt_ProviderCombo = dsExam.Tables(3)
                End If
            End If
            FillProviderCombo() ''added for Bug #77371 
            If dsExam.Tables.Count > 1 Then
                dt_ExamID = dsExam.Tables(1)
            End If

            If IsNothing(dt_CasesCombo) Then
                Fill_CaseCombo()
            End If



            dtFiltered = dtPatientDetails

            If Not IsNothing(dtFiltered) Then
                dtFiltered.Columns.Add("RoleOfProvider", GetType(String))
                dtFiltered.AcceptChanges()
            End If

            Dim dvFilter As DataView  ''slr new not needed 
            dvFilter = dtFiltered.DefaultView
            Dim strFilter As String = ""
            'FILTER BY DATES
            If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
                strFilter = "DOS >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND DOS <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "
            End If
            'FILTER DATAVIEW
            If strFilter.Trim() <> "" Then


                If cmbStatus.Text <> "All" AndAlso cmbProvider.Text.Replace("'", "''") <> "All" Then '' FILTER BOTH ''
                    'FILTER STATUS
                    If cmbStatus.Text = "Finished" Then
                        strFilter = strFilter & " AND Finished = 'Yes' "
                    ElseIf cmbStatus.Text = "UnFinished" Then
                        strFilter = strFilter & " AND Finished = 'No' "
                    End If
                    'FILTER PROVIDER
                    strFilter = strFilter & " AND ProviderName = '" & cmbProvider.Text.Replace("'", "''") & "'"

                ElseIf cmbStatus.Text <> "All" AndAlso cmbProvider.Text = "All" Then '' FILTER ONLY STATUS ''
                    If cmbStatus.Text = "Finished" Then
                        strFilter = strFilter & " AND Finished = 'Yes' "
                    ElseIf cmbStatus.Text = "UnFinished" Then
                        strFilter = strFilter & " AND Finished = 'No' "
                    End If

                ElseIf cmbStatus.Text = "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER ONLY PROVIDER ''
                    strFilter = strFilter & " AND ProviderName = '" & cmbProvider.Text.Replace("'", "''") & "'"

                End If
            Else
                If cmbStatus.Text <> "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER BOTH ''
                    '' FILTER STATUS ''
                    If cmbStatus.Text = "Finished" Then
                        strFilter = strFilter & "  Finished = 'Yes' "
                    ElseIf cmbStatus.Text = "UnFinished" Then
                        strFilter = strFilter & "  Finished = 'No' "
                    End If
                    '' FILTER PROVIDER ''
                    strFilter = strFilter & " AND ProviderName = '" & cmbProvider.Text.Replace("'", "''") & "'"

                ElseIf cmbStatus.Text <> "All" AndAlso cmbProvider.Text = "All" Then '' FILTER ONLY STATUS ''
                    If cmbStatus.Text = "Finished" Then
                        strFilter = strFilter & "  Finished = 'Yes' "
                    ElseIf cmbStatus.Text = "UnFinished" Then
                        strFilter = strFilter & "  Finished = 'No' "
                    End If

                ElseIf cmbStatus.Text = "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER ONLY PROVIDER ''
                    strFilter = strFilter & "  ProviderName = '" & cmbProvider.Text.Replace("'", "''") & "'"
                End If

            End If

            '20120824-Template Specialty Filter
            If cmbTemplateSpeciality.Text <> "All" Then
                ''20121012::Bug No.38873::Version 7010
                If strFilter = "" Then
                    strFilter = strFilter & "Specialty = '" & Replace(cmbTemplateSpeciality.Text, "'", "''") & "'" 'Aniket: Resolved Issue 46695
                Else
                    strFilter = strFilter & "AND Specialty = '" & Replace(cmbTemplateSpeciality.Text, "'", "''") & "'" 'Aniket: Resolved Issue 46695
                End If
                ''
            End If
            ''

            If cmbCase.Text <> "All" Then
                If strFilter = "" Then
                    strFilter = strFilter & "Case = '" & Replace(cmbCase.Text, "'", "''") & "'"
                Else
                    strFilter = strFilter & "AND Case = '" & Replace(cmbCase.Text, "'", "''") & "'"
                End If
                ''
            End If

            If strFilter.Trim() <> "" Then
                dvFilter.RowFilter = strFilter
                dtFiltered = dvFilter.ToTable
            Else
                dtFiltered = dvFilter.ToTable
            End If

            Dim strRoles As String = ""
            Dim nExamID As Long = 0

            If Not IsNothing(dvFilter) Then
                dvFilter.Dispose()
                dvFilter = Nothing
            End If


            C1dgPatientDetails.DataSource = dtFiltered
            C1dgPatientDetails.Cols("nExamID").Visible = False
            C1dgPatientDetails.Cols("nVisitID").Visible = False

            'Incident 00005646 : System Hangs-up in exam opens from Dashboard PatientDetails Panel.
            'Following Property set to false to avoid two tooltips showing on grid.
            C1dgPatientDetails.ShowCellLabels = False

            'Width Setting
            Dim _width As Integer = (C1dgPatientDetails.Width - 15) / 10
            'For Resolving case no : GLO2009-0003377
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If

            C1dgPatientDetails.Cols("nExamID").Width = 0
            C1dgPatientDetails.Cols("nVisitID").Width = 0
            C1dgPatientDetails.Cols("DOS").Width = _width * 0.1
            C1dgPatientDetails.Cols("Exam Name").Width = _width * 0.24
            C1dgPatientDetails.Cols("Template Name").Width = _width * 0.15
            C1dgPatientDetails.Cols("ReviewedBy").Width = _width * 0.1
            C1dgPatientDetails.Cols("ProviderName").Width = _width * 0.2
            C1dgPatientDetails.Cols("Finished").Width = _width * 0.1
            C1dgPatientDetails.Cols("RoleOfProvider").Width = _width * 0.11
            C1dgPatientDetails.Cols("Discharge Date").Width = _width * 0.11
            C1dgPatientDetails.Cols("Discharge Disposition").Width = _width * 0.4
            C1dgPatientDetails.Cols("Diagnosis Type").Width = _width * 0.1

            _width = Nothing

            C1dgPatientDetails.AllowEditing = True
            C1dgPatientDetails.Cols("nExamID").AllowEditing = False
            C1dgPatientDetails.Cols("nVisitID").AllowEditing = False
            C1dgPatientDetails.Cols("DOS").AllowEditing = False
            C1dgPatientDetails.Cols("Exam Name").AllowEditing = False
            C1dgPatientDetails.Cols("Template Name").AllowEditing = False
            C1dgPatientDetails.Cols("ReviewedBy").AllowEditing = False
            C1dgPatientDetails.Cols("ProviderName").AllowEditing = False
            C1dgPatientDetails.Cols("Finished").AllowEditing = False
            C1dgPatientDetails.Cols("Specialty").AllowEditing = False
            C1dgPatientDetails.Cols("Case").AllowEditing = False
            C1dgPatientDetails.Cols("RoleOfProvider").AllowEditing = True
            C1dgPatientDetails.Cols("Discharge Date").AllowEditing = False
            C1dgPatientDetails.Cols("Discharge Disposition").AllowEditing = False
            C1dgPatientDetails.Cols("Diagnosis Type").AllowEditing = False
            C1dgPatientDetails.Cols("ReviewedBy").Caption = "Reviewed By"
            C1dgPatientDetails.Cols("ProviderName").Caption = "Provider Name"
            C1dgPatientDetails.Cols("RoleOfProvider").Caption = "Role of Provider"
            C1dgPatientDetails.Cols("Discharge Date").Caption = "Discharge Date"
            C1dgPatientDetails.Cols("Discharge Disposition").Caption = "Discharge Disposition"
            C1dgPatientDetails.Cols("Diagnosis Type").Caption = "Diagnosis Type"

            'C1dgPatientDetails.Cols("RoleOfProvider").AllowEditing = False

            'Set combo list for each row in column 'Role of Provider' 
            If Not IsNothing(dtFiltered) Then

                Dim dvExamid As DataView = dtFiltered.DefaultView
                Dim dtdistinctexamid As DataTable = dvExamid.ToTable(True, "nExamID")
                Dim htableexamid As Hashtable = Nothing
                If (dtdistinctexamid.Rows.Count > 0) Then
                    Dim strexamids As String = String.Empty
                    For Len As Integer = 0 To dtdistinctexamid.Rows.Count - 1
                        strexamids &= Convert.ToString(dtdistinctexamid(Len)("nExamID")) & ","
                    Next
                    If (strexamids <> String.Empty) Then
                        strexamids = strexamids.Substring(0, strexamids.Length - 1)
                        htableexamid = GetRoles(strexamids, dtdistinctexamid)
                    End If
                End If
                For k As Integer = 0 To dtFiltered.Rows.Count - 1
                    Dim objectID As Object = dtFiltered.Rows(k)("nExamID")

                    If (IsNothing(objectID) = False) Then

                        nExamID = Convert.ToInt64(objectID)
                        strRoles = ""
                        If (Not IsNothing(htableexamid)) Then
                            strRoles = htableexamid.Item(nExamID.ToString())
                        End If


                        Dim cStyle As C1.Win.C1FlexGrid.CellStyle
                        Try
                            If (C1dgPatientDetails.Styles.Contains("CS_Roles" & k)) Then
                                cStyle = C1dgPatientDetails.Styles("CS_Roles" & k)
                            Else
                                cStyle = C1dgPatientDetails.Styles.Add("CS_Roles" & k) ''style new for every row
                            End If
                        Catch ex As Exception
                            cStyle = C1dgPatientDetails.Styles.Add("CS_Roles" & k) ''style new for every row
                        End Try
                        Dim rgRole As C1.Win.C1FlexGrid.CellRange = C1dgPatientDetails.GetCellRange(k + 1, 9)

                        C1dgPatientDetails.ShowButtons = ShowButtonsEnum.Always
                        cStyle.ComboList = strRoles
                        rgRole.Style = cStyle

                        C1dgPatientDetails.SetCellStyle(k + 1, 9, cStyle)

                        cStyle = Nothing

                        ''Select First value of combo list  for role of Provider 
                        If String.IsNullOrEmpty(strRoles) = False Then

                            Dim _arrSpliter As String()
                            _arrSpliter = strRoles.Split("|") ''Split the string 
                            If (IsNothing(_arrSpliter) = False) Then
                                If _arrSpliter(0).Length > 0 Then
                                    Dim strFirstRole As String = _arrSpliter(0) ''First value
                                    C1dgPatientDetails.SetData(k + 1, "RoleOfProvider", strFirstRole)
                                    strFirstRole = Nothing
                                End If
                                _arrSpliter = Nothing
                            End If

                        End If
                    End If

                Next
                If Not IsNothing(htableexamid) Then
                    htableexamid.Clear()
                    htableexamid = Nothing
                End If
                If Not IsNothing(dtdistinctexamid) Then
                    dtdistinctexamid.Dispose()
                    dtdistinctexamid = Nothing
                End If
                If Not IsNothing(dsExam) Then
                    dsExam.Dispose()
                    dsExam = Nothing
                End If
            End If
            'dhruv - to move the column from the location 8 to 5 -> 8th column was the finished exam
            C1dgPatientDetails.Cols.Move(9, 5)

            strRoles = Nothing
            nExamID = Nothing

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Past Exam viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Exam, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, ex.ToString() + "Patient Past Exam viewed from DashBoard", gloAuditTrail.ActivityOutCome.Failure)

        End Try
    End Sub

    'Private Sub Fill_Vitals()

    '    Dim dvPatientVitals As DataView
    '    Dim objPatientVitals As New clsPatientVitals
    '    dvPatientVitals = objPatientVitals.GetAllVitals(gnPatientID)
    '    objPatientVitals = Nothing
    '    C1dgPatientDetails.DataSource = dvPatientVitals
    '    C1dgPatientDetails.AllowEditing = False

    '    C1dgPatientDetails.Cols("nVitalID").Visible = False
    '    C1dgPatientDetails.Cols("nVisitID").Visible = False
    '    C1dgPatientDetails.Cols("nPatientID").Visible = False
    '    C1dgPatientDetails.Cols("dStature").Visible = False
    '    C1dgPatientDetails.Cols("dTHRperMin").Visible = False
    '    C1dgPatientDetails.Cols("dTHRperMax").Visible = False
    '    C1dgPatientDetails.Cols("dTHRMin").Visible = False
    '    C1dgPatientDetails.Cols("dTHRMax").Visible = False
    '    C1dgPatientDetails.Cols("dTHR").Visible = False
    '    C1dgPatientDetails.Cols("dWeightinKg").Visible = False
    '    C1dgPatientDetails.Cols("dHeightinInch").Visible = False
    '    C1dgPatientDetails.Cols("dHeightinCm").Visible = False
    '    C1dgPatientDetails.Cols("sWeightinLbsOz").Visible = False
    '    C1dgPatientDetails.Cols("dTemperatureinCelcius").Visible = False
    '    C1dgPatientDetails.Cols("dPEFR2").Visible = False
    '    C1dgPatientDetails.Cols("dPEFR3").Visible = False
    '    C1dgPatientDetails.Cols("dHeadCircuminInch").Visible = False

    '    C1dgPatientDetails.Cols("dRespiratoryRate").Caption = "Respiratory Rate"
    '    C1dgPatientDetails.Cols("dWeightChange").Caption = "Weight change"
    '    C1dgPatientDetails.Cols("nPainLevel").Caption = "Pain Level Current"
    '    C1dgPatientDetails.Cols("dPEFR1").Caption = "PEFR"
    '    C1dgPatientDetails.Cols("dPulseOx").Caption = "Pulse Ox"
    '    C1dgPatientDetails.Cols("dStatureinInch").Caption = "Stature (in)"
    '    C1dgPatientDetails.Cols("dtVitalDate").Caption = "Date"
    '    C1dgPatientDetails.Cols("sHeight").Caption = "Height"
    '    C1dgPatientDetails.Cols("dWeightinlbs").Caption = "Weight (lbs)"
    '    C1dgPatientDetails.Cols("dBMI").Caption = "BMI"
    '    C1dgPatientDetails.Cols("dTemperature").Caption = "Temperature (F)"
    '    C1dgPatientDetails.Cols("dPulsePerMinute").Caption = "Pulse"
    '    C1dgPatientDetails.Cols("BPSitting").Caption = "BP Sitting"
    '    C1dgPatientDetails.Cols("BPStanding").Caption = "BP Standing"
    '    C1dgPatientDetails.Cols("sComments").Caption = "Comments"
    '    C1dgPatientDetails.Cols("dHeadCircumferance").Caption = "Head Cir (cm)"
    '    C1dgPatientDetails.Cols("nPainLevelWithMedication").Caption = "Pain Level With Medication"
    '    C1dgPatientDetails.Cols("nPainLevelWithoutMedication").Caption = "Pain Level Without Medication"
    '    C1dgPatientDetails.Cols("nPainLevelWorst").Caption = "Pain Level Worst"
    '    C1dgPatientDetails.Cols("nODIPercent").Caption = "ODI (%)"
    '    C1dgPatientDetails.Cols("BPSitting").TextAlign = TextAlignEnum.CenterCenter
    '    C1dgPatientDetails.Cols("BPStanding").TextAlign = TextAlignEnum.CenterCenter
    '    C1dgPatientDetails.Cols("sHeight").TextAlign = TextAlignEnum.RightCenter
    '    C1dgPatientDetails.AllowEditing = False
    '    Dim _width As Integer = pnlPatientDetail.Width
    '    If _width < Convert.ToInt32(c1dgPatientDetailSize) And c1dgPatientDetailSize <> Nothing Then
    '        _width = Convert.ToInt32(c1dgPatientDetailSize)
    '    End If
    '    C1dgPatientDetails.Cols("dtVitalDate").Width = _width * 0.1
    '    C1dgPatientDetails.Cols("sHeight").Width = _width * 0.1
    '    C1dgPatientDetails.Cols("dWeightinlbs").Width = _width * 0.09
    '    C1dgPatientDetails.Cols("dBMI").Width = _width * 0.06
    '    C1dgPatientDetails.Cols("dTemperature").Width = _width * 0.1
    '    C1dgPatientDetails.Cols("dPulsePerMinute").Width = _width * 0.06
    '    C1dgPatientDetails.Cols("BPSitting").Width = _width * 0.12
    '    C1dgPatientDetails.Cols("BPStanding").Width = _width * 0.12
    '    C1dgPatientDetails.Cols("sComments").Width = _width * 0.12
    '    C1dgPatientDetails.Cols("dHeadCircumferance").Width = _width * 0.1
    '    C1dgPatientDetails.Cols("nPainLevelWithMedication").Width = _width * 0.2
    '    C1dgPatientDetails.Cols("nPainLevelWithoutMedication").Width = _width * 0.2
    '    C1dgPatientDetails.Cols("nPainLevelWorst").Width = _width * 0.15
    '    C1dgPatientDetails.Cols("nODIPercent").Width = _width * 0.1
    '    C1dgPatientDetails.Cols("nPainLevel").Width = _width * 0.12
    '    C1dgPatientDetails.ShowCellLabels = True
    '    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Vitals viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    'End Sub
    Private Sub Fill_Vitals()

        Dim dvPatientVitals As DataView
        Dim objPatientVitals As New clsPatientVitals
        dvPatientVitals = objPatientVitals.GetAllVitals(gnPatientID)
        objPatientVitals = Nothing
        C1dgPatientDetails.DataSource = dvPatientVitals
        C1dgPatientDetails.AllowEditing = False

        'C1dgPatientDetails.Cols("nVitalID").Visible = False
        'C1dgPatientDetails.Cols("nVisitID").Visible = False
        'C1dgPatientDetails.Cols("nPatientID").Visible = False
        'C1dgPatientDetails.Cols("dStature").Visible = False
        'C1dgPatientDetails.Cols("dTHRperMin").Visible = False
        'C1dgPatientDetails.Cols("dTHRperMax").Visible = False
        'C1dgPatientDetails.Cols("dTHRMin").Visible = False
        'C1dgPatientDetails.Cols("dTHRMax").Visible = False
        'C1dgPatientDetails.Cols("dTHR").Visible = False
        'C1dgPatientDetails.Cols("dWeightinKg").Visible = False
        'C1dgPatientDetails.Cols("dHeightinInch").Visible = False
        'C1dgPatientDetails.Cols("dHeightinCm").Visible = False
        'C1dgPatientDetails.Cols("sWeightinLbsOz").Visible = False
        'C1dgPatientDetails.Cols("dTemperatureinCelcius").Visible = False
        'C1dgPatientDetails.Cols("dPEFR2").Visible = False
        'C1dgPatientDetails.Cols("dPEFR3").Visible = False
        'C1dgPatientDetails.Cols("dHeadCircuminInch").Visible = False
        ''
        Try
            Dim _col As Int16
            For _col = 0 To C1dgPatientDetails.Cols.Count - 1

                C1dgPatientDetails.Cols(_col).Visible = False
            Next

            _col = Nothing
            ''Problem: 00000262
            ''Reason: display dtVitalDate in DateTime format same as in View->Vitals.
            ''Description: set datatype of dtVitalDate as object also change width of dtVitalDate from 0.1 to 0.15 column at line no:12627
            C1dgPatientDetails.Cols("dtVitalDate").DataType = GetType(Object)
            C1dgPatientDetails.Cols("dtVitalDate").Visible = True
        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        ''
        ''Problem : 00000069
        ''Reason :  When weight is selected as (kG) only in Vitals Customization Settings under gloAdmin the weight is NOT displayed in the dashboard. 
        ''          When I select both (lbs) and (kgs) the weight does show and only in lbs.
        ''Description : We added added column to C1dgPatientDetails and also uncomment the code to show column in case statement.
        C1dgPatientDetails.Cols("dRespiratoryRate").Caption = "Respiratory Rate"
        C1dgPatientDetails.Cols("dWeightChange").Caption = "Weight change"
        C1dgPatientDetails.Cols("nPainLevel").Caption = "Pain Level Current"
        C1dgPatientDetails.Cols("dTHR").Caption = "THR"
        C1dgPatientDetails.Cols("dTHRMin").Caption = "THR Minimum"
        C1dgPatientDetails.Cols("dTHRMax").Caption = "THR Maximum"
        C1dgPatientDetails.Cols("dPEFR1").Caption = "PEFR"
        C1dgPatientDetails.Cols("dPulseOx").Caption = "Pulse Ox"
        C1dgPatientDetails.Cols("dPulseOxSupplement").Caption = "Pulse Ox on O2"
        C1dgPatientDetails.Cols("dPulseRate").Caption = "O2 Rate"
        C1dgPatientDetails.Cols("dStatureinInch").Caption = "Stature (in)"
        C1dgPatientDetails.Cols("dStature").Caption = "Stature (cm)"
        C1dgPatientDetails.Cols("dtVitalDate").Caption = "Date"
        C1dgPatientDetails.Cols("sHeight").Caption = "Height/Length"
        C1dgPatientDetails.Cols("dHeightinCm").Caption = "Height/Length (cm)"
        C1dgPatientDetails.Cols("dHeightinInch").Caption = "Height/Length (in)"
        C1dgPatientDetails.Cols("sWeightinLbsOz").Caption = "Weight (lbsoz)"
        C1dgPatientDetails.Cols("dWeightinlbs").Caption = "Weight (lbs)"
        C1dgPatientDetails.Cols("dWeightinKg").Caption = "Weight (kg)"
        C1dgPatientDetails.Cols("dBMI").Caption = "BMI"
        C1dgPatientDetails.Cols("nBMIPercentile").Caption = "BMI Percentile"
        C1dgPatientDetails.Cols("dTemperature").Caption = "Temperature (F)"
        C1dgPatientDetails.Cols("dTemperatureinCelcius").Caption = "Temperature (C)"
        C1dgPatientDetails.Cols("dPulsePerMinute").Caption = "Pulse"
        C1dgPatientDetails.Cols("BPSitting").Caption = "BP Sitting"
        C1dgPatientDetails.Cols("BPStanding").Caption = "BP Standing"
        C1dgPatientDetails.Cols("sComments").Caption = "Comments"
        C1dgPatientDetails.Cols("dHeadCircumferance").Caption = "Head Cir (cm)"
        C1dgPatientDetails.Cols("dHeadCircuminInch").Caption = "Head Cir (in)"
        C1dgPatientDetails.Cols("nPainLevelWithMedication").Caption = "Pain Level With Medication"
        C1dgPatientDetails.Cols("nPainLevelWithoutMedication").Caption = "Pain Level Without Medication"
        C1dgPatientDetails.Cols("nPainLevelWorst").Caption = "Pain Level Worst"
        C1dgPatientDetails.Cols("nODIPercent").Caption = "ODI (%)"
        C1dgPatientDetails.Cols("nDAS28").Caption = "DAS 28"
        C1dgPatientDetails.Cols("TotalPregnancies").Caption = "Total Pregnancies"
        C1dgPatientDetails.Cols("FullTerm").Caption = "Full Term"
        C1dgPatientDetails.Cols("Living").Caption = "Living"
        C1dgPatientDetails.Cols("MultipleBirth").Caption = "Multiple Birth"
        C1dgPatientDetails.Cols("Premature").Caption = "Premature"
        C1dgPatientDetails.Cols("AbortedInduced").Caption = "Aborted Induced"
        C1dgPatientDetails.Cols("AbortedSpontaneous").Caption = "Aborted Spontaneous"
        C1dgPatientDetails.Cols("Ectopics").Caption = "Ectopics"
        C1dgPatientDetails.Cols("BPSitting").TextAlign = TextAlignEnum.CenterCenter
        C1dgPatientDetails.Cols("BPStanding").TextAlign = TextAlignEnum.CenterCenter
        C1dgPatientDetails.Cols("sHeight").TextAlign = TextAlignEnum.RightCenter
        C1dgPatientDetails.AllowEditing = False

        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If

        C1dgPatientDetails.Cols("dtVitalDate").Width = _width * 0.15
        C1dgPatientDetails.Cols("sHeight").Width = _width * 0.12
        C1dgPatientDetails.Cols("dHeightinCm").Width = _width * 0.14
        C1dgPatientDetails.Cols("dHeightinInch").Width = _width * 0.14
        C1dgPatientDetails.Cols("dWeightinlbs").Width = _width * 0.09
        ''wt change
        C1dgPatientDetails.Cols("dBMI").Width = _width * 0.06
        C1dgPatientDetails.Cols("nBMIPercentile").Width = _width * 0.1
        C1dgPatientDetails.Cols("dTemperature").Width = _width * 0.1

        ''respiratory rate
        C1dgPatientDetails.Cols("dPulsePerMinute").Width = _width * 0.06
        ''pulse ox
        C1dgPatientDetails.Cols("dPulseOxSupplement").Width = _width * 0.1
        C1dgPatientDetails.Cols("dPulseRate").Width = _width * 0.07

        C1dgPatientDetails.Cols("BPSitting").Width = _width * 0.12
        C1dgPatientDetails.Cols("BPStanding").Width = _width * 0.12
        C1dgPatientDetails.Cols("sComments").Width = _width * 0.12
        C1dgPatientDetails.Cols("dHeadCircumferance").Width = _width * 0.1

        C1dgPatientDetails.Cols("nPainLevelWithMedication").Width = _width * 0.2
        C1dgPatientDetails.Cols("nPainLevelWithoutMedication").Width = _width * 0.2
        C1dgPatientDetails.Cols("nPainLevelWorst").Width = _width * 0.15
        ''PEFR
        ''stature(in)
        ''site
        'last
        ''neck(cm)
        ''neck(in)
        ''left
        ''right
        C1dgPatientDetails.Cols("nODIPercent").Width = _width * 0.1
        C1dgPatientDetails.Cols("nDAS28").Width = _width * 0.1
        C1dgPatientDetails.Cols("nPainLevel").Width = _width * 0.12
        'Incident 00005646 : System Hangs-up in exam opens from Dashboard PatientDetails Panel.
        'Following Property set to false to avoid two tooltips showing on grid.
        C1dgPatientDetails.ShowCellLabels = False

        _width = Nothing

        ''''
        Dim Vitals() As String
        ' Dim bpcnt As Integer = 0
        Dim str1 As String = ""
        Dim k As Int16
        Dim l As Int16 = 4
        Dim SelectedVitals() As String
        Dim objSettings As New clsSettings
        objSettings.GetSettings()

        If IsNothing(objSettings.VitalSettingsValue) = False Then


            If objSettings.VitalSettingsValue = "" Then
                objSettings.VitalSettingsValue = "0.1-Height (ft & in),0.2-Height (in),0.3-Height (cm),1.1-Weight (lbsoz),1.2-Weight (lbs),1.3-Weight (kg),2.0-Weight Change,3.0-BMI,4.0-Respiratory Rate,5.0-Pulse Per Min,6.0-Pulse OX,6.1-Pulse Ox w/Supplemental Oxygen,7.1-BP Sitting,7.2-BP Standing,8.1-Temperature (F),8.2-Temperature (C),9.0-PEFR,10.0-Last Menstrual Period,11.1-Head Circumference (in),11.2-Head Circumference (cm),12.1-Neck Circumference (in),12.2-Neck Circumference (cm),13.1-Stature (in),13.2-Stature (cm),14.0-Left Eye Pressure Over Time,15.0-Right Eye Pressure Over Time,16.0-Heart Rate,17.1-Pain Level : Current,17.2-Pain Level : With Medication,17.3-Pain Level : Without Medication,17.4-Pain Level : Worst,18.0-OB Vitals,19.0-ODI,20.0-Comments,21.0-DAS 28,22.1-Total Pregnancies,22.2-Full Term,22.3-Living,22.4-Multiple Births,22.5-Premature,22.6-Aborted (Spontaneous),22.7-Aborted (Induced),22.8-Ectopic"
            End If
            SelectedVitals = objSettings.VitalSettingsValue.Trim.Split(",")

            For k = 0 To SelectedVitals.Length - 1
                Vitals = SelectedVitals.GetValue(k).ToString().Split("-")
                If str1 = "" Then
                    str1 = Vitals.GetValue(1)
                Else
                    str1 = str1 & "," & Vitals.GetValue(1)
                End If
            Next
            Dim j As Int64
            SelectedVitals = str1.Split(",")

            For j = 0 To SelectedVitals.Length - 1
                Select Case SelectedVitals(j)
                    Case "Height (ft & in)"
                        C1dgPatientDetails.Cols("sHeight").Visible = True
                        C1dgPatientDetails.Cols("sHeight").Move(l)
                        l = l + 1
                    Case "Weight (lbs)"
                        C1dgPatientDetails.Cols("dWeightinlbs").Visible = True
                        C1dgPatientDetails.Cols("dWeightinlbs").Move(l)
                        l = l + 1
                    Case "Weight Change"
                        C1dgPatientDetails.Cols("dWeightChange").Visible = True
                        C1dgPatientDetails.Cols("dWeightChange").Move(l)
                        l = l + 1
                    Case "BMI"
                        C1dgPatientDetails.Cols("dBMI").Visible = True
                        C1dgPatientDetails.Cols("dBMI").Move(l)
                        l = l + 1
                        C1dgPatientDetails.Cols("nBMIPercentile").Visible = True
                        C1dgPatientDetails.Cols("nBMIPercentile").Move(l)
                        l = l + 1
                    Case "Weight (kg)"
                        C1dgPatientDetails.Cols("dWeightinKg").Visible = True
                        C1dgPatientDetails.Cols("dWeightinKg").Move(l)
                        l = l + 1
                    Case "Temperature (F)"
                        C1dgPatientDetails.Cols("dTemperature").Visible = True
                        C1dgPatientDetails.Cols("dTemperature").Move(l)
                        l = l + 1
                    Case "Comments"
                        C1dgPatientDetails.Cols("sComments").Visible = True
                        C1dgPatientDetails.Cols("sComments").Move(l)
                        l = l + 1
                    Case "Respiratory Rate"
                        C1dgPatientDetails.Cols("dRespiratoryRate").Visible = True
                        C1dgPatientDetails.Cols("dRespiratoryRate").Move(l)
                        l = l + 1
                    Case "Pulse Per Min"
                        C1dgPatientDetails.Cols("dPulsePerMinute").Visible = True
                        C1dgPatientDetails.Cols("dPulsePerMinute").Move(l)
                        l = l + 1
                    Case "Pulse OX"
                        C1dgPatientDetails.Cols("dPulseOx").Visible = True
                        C1dgPatientDetails.Cols("dPulseOx").Move(l)
                        l = l + 1
                    Case "Pulse Ox w/Supplemental Oxygen"
                        C1dgPatientDetails.Cols("dPulseOxSupplement").Visible = True
                        C1dgPatientDetails.Cols("dPulseOxSupplement").Move(l)
                        l = l + 1
                        C1dgPatientDetails.Cols("dPulseRate").Visible = True
                        C1dgPatientDetails.Cols("dPulseRate").Move(l)
                        l = l + 1
                    Case "BP Sitting"
                        C1dgPatientDetails.Cols("BPSitting").Visible = True
                        C1dgPatientDetails.Cols("BPSitting").Move(l)
                        l = l + 1
                        C1dgPatientDetails.Cols("Site For BP").Visible = True
                        C1dgPatientDetails.Cols("Site For BP").Move(l)
                        l = l + 1
                    Case "BP Standing"
                        C1dgPatientDetails.Cols("BPStanding").Visible = True
                        C1dgPatientDetails.Cols("BPStanding").Move(l)
                        l = l + 1
                        C1dgPatientDetails.Cols("Site For BP").Visible = True
                        C1dgPatientDetails.Cols("Site For BP").Move(l)
                        l = l + 1
                    Case "Head Circumference (cm)"
                        C1dgPatientDetails.Cols("dHeadCircumferance").Visible = True
                        C1dgPatientDetails.Cols("dHeadCircumferance").Move(l)
                        l = l + 1
                    Case "Stature (cm)"
                        C1dgPatientDetails.Cols("dStature").Visible = True
                        C1dgPatientDetails.Cols("dStature").Move(l)
                        l = l + 1
                    Case "Heart Rate"
                        C1dgPatientDetails.Cols("dTHR").Visible = True
                        C1dgPatientDetails.Cols("dTHR").Move(l)
                        l = l + 1
                        C1dgPatientDetails.Cols("dTHRMin").Visible = True
                        C1dgPatientDetails.Cols("dTHRMin").Move(l)
                        l = l + 1
                        C1dgPatientDetails.Cols("dTHRMax").Visible = True
                        C1dgPatientDetails.Cols("dTHRMax").Move(l)
                        l = l + 1
                    Case "Height (in)"
                        C1dgPatientDetails.Cols("dHeightinInch").Visible = True
                        C1dgPatientDetails.Cols("dHeightinInch").Move(l)
                        l = l + 1
                    Case "Height (cm)"
                        C1dgPatientDetails.Cols("dHeightinCm").Visible = True
                        C1dgPatientDetails.Cols("dHeightinCm").Move(l)
                        l = l + 1
                    Case "Weight (lbsoz)"
                        C1dgPatientDetails.Cols("sWeightinLbsOz").Visible = True
                        C1dgPatientDetails.Cols("sWeightinLbsOz").Move(l)
                        l = l + 1
                    Case "Temperature (C)"
                        C1dgPatientDetails.Cols("dTemperatureinCelcius").Visible = True
                        C1dgPatientDetails.Cols("dTemperatureinCelcius").Move(l)
                        l = l + 1
                    Case "Pain Level : Current", "Pain Level"
                        C1dgPatientDetails.Cols("nPainLevel").Visible = True
                        C1dgPatientDetails.Cols("nPainLevel").Move(l)
                        l = l + 1
                    Case "Pain Level : With Medication"
                        C1dgPatientDetails.Cols("nPainLevelWithMedication").Visible = True
                        C1dgPatientDetails.Cols("nPainLevelWithMedication").Move(l)
                        l = l + 1
                    Case "Pain Level : Without Medication"
                        C1dgPatientDetails.Cols("nPainLevelWithoutMedication").Visible = True
                        C1dgPatientDetails.Cols("nPainLevelWithoutMedication").Move(l)
                        l = l + 1
                    Case "Pain Level : Worst"
                        C1dgPatientDetails.Cols("nPainLevelWorst").Visible = True
                        C1dgPatientDetails.Cols("nPainLevelWorst").Move(l)
                        l = l + 1
                    Case "PEFR"
                        C1dgPatientDetails.Cols("dPEFR1").Visible = True
                        C1dgPatientDetails.Cols("dPEFR1").Move(l)
                        l = l + 1
                    Case "Head Circumference (in)"
                        C1dgPatientDetails.Cols("dHeadCircuminInch").Visible = True
                        C1dgPatientDetails.Cols("dHeadCircuminInch").Move(l)
                        l = l + 1
                    Case "Stature (in)"
                        C1dgPatientDetails.Cols("dStatureinInch").Visible = True
                        C1dgPatientDetails.Cols("dStatureinInch").Move(l)
                        l = l + 1

                    Case "Last Menstrual Period"
                        C1dgPatientDetails.Cols("Last Menstrual Period").Visible = True
                        C1dgPatientDetails.Cols("Last Menstrual Period").Move(l)
                        l = l + 1
                    Case "Neck Circumference (in)"
                        C1dgPatientDetails.Cols("Neck Circumference (in)").Visible = True
                        C1dgPatientDetails.Cols("Neck Circumference (in)").Move(l)
                        l = l + 1
                    Case "Neck Circumference (cm)"
                        C1dgPatientDetails.Cols("Neck Circumference (cm)").Visible = True
                        C1dgPatientDetails.Cols("Neck Circumference (cm)").Move(l)
                        l = l + 1
                    Case "Left Eye Pressure Over Time"
                        C1dgPatientDetails.Cols("Left Eye Pressure").Visible = True
                        C1dgPatientDetails.Cols("Left Eye Pressure").Move(l)
                        l = l + 1
                    Case "Right Eye Pressure Over Time"
                        C1dgPatientDetails.Cols("Right Eye Pressure").Visible = True
                        C1dgPatientDetails.Cols("Right Eye Pressure").Move(l)
                        l = l + 1
                    Case "ODI"
                        C1dgPatientDetails.Cols("nODIPercent").Visible = True
                        C1dgPatientDetails.Cols("nODIPercent").Move(l)
                        l = l + 1
                    Case "DAS 28"
                        C1dgPatientDetails.Cols("nDAS28").Visible = True
                        C1dgPatientDetails.Cols("nDAS28").Move(l)
                        l = l + 1
                    Case "Total Pregnancies"
                        C1dgPatientDetails.Cols("TotalPregnancies").Visible = True
                        C1dgPatientDetails.Cols("TotalPregnancies").Move(l)
                        l = l + 1
                    Case "Full Term"
                        C1dgPatientDetails.Cols("FullTerm").Visible = True
                        C1dgPatientDetails.Cols("FullTerm").Move(l)
                        l = l + 1
                    Case "Living"
                        C1dgPatientDetails.Cols("Living").Visible = True
                        C1dgPatientDetails.Cols("Living").Move(l)
                        l = l + 1
                    Case "Multiple Births"
                        C1dgPatientDetails.Cols("MultipleBirth").Visible = True
                        C1dgPatientDetails.Cols("MultipleBirth").Move(l)
                        l = l + 1
                    Case "Premature"
                        C1dgPatientDetails.Cols("Premature").Visible = True
                        C1dgPatientDetails.Cols("Premature").Move(l)
                        l = l + 1
                    Case "Aborted (Induced)"
                        C1dgPatientDetails.Cols("AbortedInduced").Visible = True
                        C1dgPatientDetails.Cols("AbortedInduced").Move(l)
                        l = l + 1
                    Case "Aborted (Spontaneous)"
                        C1dgPatientDetails.Cols("AbortedSpontaneous").Visible = True
                        C1dgPatientDetails.Cols("AbortedSpontaneous").Move(l)
                        l = l + 1
                    Case "Ectopic"
                        C1dgPatientDetails.Cols("Ectopics").Visible = True
                        C1dgPatientDetails.Cols("Ectopics").Move(l)
                        l = l + 1
                End Select

            Next
            j = Nothing
        End If

        Vitals = Nothing
        'bpcnt = Nothing
        str1 = Nothing
        k = Nothing
        l = Nothing
        SelectedVitals = Nothing
        If Not IsNothing(objSettings) Then
            objSettings.Dispose() : objSettings = Nothing
        End If

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Vitals viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub

    Private Sub Fill_SBPTransactionData()

        Try
            Dim dtAppointment As New DataTable()
            Dim oParameters As New gloDatabaseLayer.DBParameters
            Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())


            Dim dt As DataTable = Nothing ''slr new not needed 

            If IsAccess(True) = False Then
                Exit Sub
            End If

            oDB.Connect(False)
            'Get the Patient Demographic Details for dashboard.
            oParameters.Add("@nPatientid", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)
            oDB.Retrive("SBP_GetVisits", oParameters, dt)

            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing

            'Dim dvFilter As DataView  ''slr new not needed 
            'dvFilter = dt.DefaultView

            '' FILTER BY DATES '' 
            'Dim strFilter As String = ""
            'If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
            '    strFilter = "VisitDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND VisitDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "

            '    dvFilter.RowFilter = strFilter
            '    dt = dvFilter.ToTable
            'End If

            'strFilter = Nothing
            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.DataSource = dt.DefaultView
            C1dgPatientDetails.Cols("nvisitid").Caption = "VisitId"
            C1dgPatientDetails.Cols("dtvisitdate").Caption = "Visit Date"
            C1dgPatientDetails.Cols("dttransactiondate").Caption = "Transaction Date"
           
            C1dgPatientDetails.AllowEditing = False

            Dim _width As Integer = pnlPatientDetail.Width
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If

            C1dgPatientDetails.Cols("nvisitid").Width = 0 '' _width * 0.3

            C1dgPatientDetails.Cols("dtvisitdate").DataType = GetType(String)
            C1dgPatientDetails.Cols("dtvisitdate").Format = "MM/dd/yyyy h:mm:ss tt"
            C1dgPatientDetails.Cols("dtvisitdate").Width = 0 ''_width * 0.2

            C1dgPatientDetails.Cols("dttransactiondate").DataType = GetType(String)
            C1dgPatientDetails.Cols("dttransactiondate").Format = "MM/dd/yyyy h:mm:ss tt"
            C1dgPatientDetails.Cols("dttransactiondate").Width = _width * 0.3

            C1dgPatientDetails.ExtendLastCol = True
            _width = Nothing

            dt.Dispose()
            dt = Nothing

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient education viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)


        Catch ex As Exception

        Finally

        End Try
    End Sub
    Private Sub Fill_Referrals()
        Try

            Dim dt_Reffrals As DataTable

            'Get the Patient Referrals. 
            Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString())

            dt_Reffrals = ogloPatient.getPatientReffrals(gnPatientID)

            ogloPatient.Dispose()
            ogloPatient = Nothing

            C1dgPatientDetails.DataSource = Nothing

            C1dgPatientDetails.Clear(ClearFlags.All)
            'Set the column Names.                               
            C1dgPatientDetails.Cols.Count = 10
            C1dgPatientDetails.Rows.Count = 1

            C1dgPatientDetails.SetData(0, 0, "Referral Name")
            C1dgPatientDetails.SetData(0, 1, "Address")
            C1dgPatientDetails.SetData(0, 2, "City")
            C1dgPatientDetails.SetData(0, 3, "State")
            C1dgPatientDetails.SetData(0, 4, "Zip")
            C1dgPatientDetails.SetData(0, 5, "Phone")
            C1dgPatientDetails.SetData(0, 6, "Fax")
            C1dgPatientDetails.SetData(0, 7, "Email")
            C1dgPatientDetails.SetData(0, 8, "Patient Detail ID")
            C1dgPatientDetails.SetData(0, 9, "Contact ID")


            If dt_Reffrals IsNot Nothing Then
                'For each row in DataTable add the row to data grid.              
                For i As Integer = 0 To dt_Reffrals.Rows.Count - 1
                    C1dgPatientDetails.Rows.Add()
                    'IF CONDITION ADDED BY SHUBHANGI TO DISPLAY PREFIX & SUFFIX IF THEY PRESENT 20100619
                    If (dt_Reffrals.Rows(i)("sPrefix").ToString <> "") AndAlso (dt_Reffrals.Rows(i)("sDegree").ToString <> "") Then
                        C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 0, (dt_Reffrals.Rows(i)("sPrefix") & " ") + (dt_Reffrals.Rows(i)("sFirstName") & " ") + (dt_Reffrals.Rows(i)("sMiddleName") & " ") + (dt_Reffrals.Rows(i)("sLastName") & " ") + (dt_Reffrals.Rows(i)("sDegree")))
                    ElseIf (dt_Reffrals.Rows(i)("sPrefix").ToString = "") AndAlso (dt_Reffrals.Rows(i)("sDegree").ToString <> "") Then
                        C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 0, (dt_Reffrals.Rows(i)("sFirstName") & " ") + (dt_Reffrals.Rows(i)("sMiddleName") & " ") + (dt_Reffrals.Rows(i)("sLastName") & " ") + (dt_Reffrals.Rows(i)("sDegree")))
                    ElseIf (dt_Reffrals.Rows(i)("sPrefix").ToString <> "") AndAlso (dt_Reffrals.Rows(i)("sDegree").ToString = "") Then
                        C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 0, (dt_Reffrals.Rows(i)("sPrefix") & " ") + (dt_Reffrals.Rows(i)("sFirstName") & " ") + (dt_Reffrals.Rows(i)("sMiddleName") & " ") + (dt_Reffrals.Rows(i)("sLastName")))
                    Else
                        C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 0, (dt_Reffrals.Rows(i)("sFirstName") & " ") + (dt_Reffrals.Rows(i)("sMiddleName") & " ") + (dt_Reffrals.Rows(i)("sLastName")))
                    End If
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 1, (dt_Reffrals.Rows(i)("sAddressLine1") & " ") + dt_Reffrals.Rows(i)("sAddressLine2"))
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 2, dt_Reffrals.Rows(i)("sCity"))
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 3, dt_Reffrals.Rows(i)("sState"))
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 4, dt_Reffrals.Rows(i)("sZip"))
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 5, dt_Reffrals.Rows(i)("sPhone"))
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 6, dt_Reffrals.Rows(i)("sFax"))
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 7, dt_Reffrals.Rows(i)("sEmail"))
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 8, dt_Reffrals.Rows(i)("nPatientDetailID"))
                    C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 9, dt_Reffrals.Rows(i)("nContactId"))
                Next
            End If


            C1dgPatientDetails.Cols(0).AllowEditing = False
            C1dgPatientDetails.Cols(1).AllowEditing = False
            C1dgPatientDetails.Cols(2).AllowEditing = False
            C1dgPatientDetails.Cols(3).AllowEditing = False
            C1dgPatientDetails.Cols(4).AllowEditing = False
            C1dgPatientDetails.Cols(5).AllowEditing = False
            C1dgPatientDetails.Cols(6).AllowEditing = False
            C1dgPatientDetails.Cols(7).AllowEditing = False
            C1dgPatientDetails.Cols(8).AllowEditing = False
            C1dgPatientDetails.Cols(9).AllowEditing = False


            C1dgPatientDetails.Cols(0).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(2).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(3).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(4).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(5).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(6).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(7).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter

            Dim _width As Integer = (C1dgPatientDetails.Width - 15) / 10
            If _width < ((Convert.ToInt32(c1dgPatientDetailSize) - 15) / 10) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = ((Convert.ToInt32(c1dgPatientDetailSize) - 15) / 10)
            End If
            C1dgPatientDetails.Cols(0).Width = _width * 2
            C1dgPatientDetails.Cols(1).Width = _width * 2
            C1dgPatientDetails.Cols(2).Width = _width * 1
            C1dgPatientDetails.Cols(3).Width = _width * 1
            C1dgPatientDetails.Cols(4).Width = _width * 1
            C1dgPatientDetails.Cols(5).Width = _width * 1
            C1dgPatientDetails.Cols(6).Width = _width * 1
            C1dgPatientDetails.Cols(7).Width = _width * 1

            C1dgPatientDetails.Cols(8).Visible = False
            C1dgPatientDetails.Cols(9).Visible = False

            _width = Nothing

            If Not IsNothing(dt_Reffrals) Then
                dt_Reffrals.Dispose()
                dt_Reffrals = Nothing
            End If

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Referrals viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub Fill_PendingFAX()
        Dim objPendingFAXes As New clsFAX
        Dim dtPendingFAX As DataTable ''Slr new not needed 
        Try

            'Dashboard Faxes
            dtPendingFAX = objPendingFAXes.Scan_PendingFAXes(gnPatientID)
            objPendingFAXes.Dispose()
            objPendingFAXes = Nothing


            C1dgPatientDetails.DataSource = dtPendingFAX
            C1dgPatientDetails.AllowEditing = False


            Dim _width As Integer = pnlPatientDetail.Width
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If

            C1dgPatientDetails.Cols("FAXID").Width = 0

            'Added dateformat to resolve Bug #91899: 00001051: Dashboard >> Patient Details >> Sent Fax 
            C1dgPatientDetails.Cols("FAXDate").Format = "G"

            C1dgPatientDetails.Cols("FAXDate").Width = _width * 0.15
            C1dgPatientDetails.Cols("FAXTo").Width = _width * 0.15
            C1dgPatientDetails.Cols("FAXNo").Width = _width * 0.12
            C1dgPatientDetails.Cols("FAXType").Width = _width * 0.1
            C1dgPatientDetails.Cols("PatientName").Width = _width * 0.13
            C1dgPatientDetails.Cols("FAXFileName").Width = _width * 0.11
            C1dgPatientDetails.Cols("NoOfAttempts").Width = _width * 0.07
            C1dgPatientDetails.Cols("CurrentStatus").Width = _width * 0.1

            'Internet fax
            C1dgPatientDetails.Cols("EFax_DocumentExtension").Width = 0
            C1dgPatientDetails.Cols("StatusDescription").Width = _width * 0.1
            C1dgPatientDetails.Cols("TransStatusCode").Width = 0
            C1dgPatientDetails.Cols("TransStatusDescription").Width = _width * 0.2

            _width = Nothing

            C1dgPatientDetails.Cols("LoginUser").Width = 0
            C1dgPatientDetails.Cols("PatientID").Width = 0
            C1dgPatientDetails.Cols("LoginUser").Width = 0

            C1dgPatientDetails.Cols("FAXDate").Caption = "Fax Date"
            C1dgPatientDetails.Cols("FAXTo").Caption = "Fax To"
            C1dgPatientDetails.Cols("FAXNo").Caption = "Fax No"
            C1dgPatientDetails.Cols("FAXType").Caption = "Fax Type"
            C1dgPatientDetails.Cols("PatientName").Caption = "Patient Name"
            C1dgPatientDetails.Cols("FAXFileName").Caption = "File Name"
            C1dgPatientDetails.Cols("NoOfAttempts").Caption = "Attempts"
            C1dgPatientDetails.Cols("CurrentStatus").Caption = "Current Status"
            C1dgPatientDetails.Cols("StatusCode").Caption = "Status Code"

            C1dgPatientDetails.Cols("StatusDescription").Caption = "Status Desc"
            C1dgPatientDetails.Cols("TransStatusDescription").Caption = "Transaction Status Desc"

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Pending Fax viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
        End Try
    End Sub

    Private Sub Fill_FAXSent()
        ''Sent FAX Status
        Dim dtPatientDetails As DataTable
        Dim objPatientDetail As New clsPatientDetails
        dtPatientDetails = objPatientDetail.Fill_FAXStatus(gnPatientID)

        objPatientDetail.Dispose()
        objPatientDetail = Nothing

        C1dgPatientDetails.DataSource = dtPatientDetails

        'FAXID, FAXDate, FAXTO, FAXNo, FAXType, FAXSend, FAXStatus

        C1dgPatientDetails.Cols("FAXID").Visible = False

        'Added dateformat to resolve Bug #91899: 00001051: Dashboard >> Patient Details >> Sent Fax 
        C1dgPatientDetails.Cols("FAXDate").Format = "G"

        C1dgPatientDetails.Cols("FAXDate").Caption = "Date"
        C1dgPatientDetails.Cols("FAXTO").Caption = "Fax To"
        C1dgPatientDetails.Cols("FAXNo").Caption = "Fax No"
        C1dgPatientDetails.Cols("FAXType").Caption = "Fax Type"
        C1dgPatientDetails.Cols("FAXSend").Caption = "Send"
        C1dgPatientDetails.Cols("FAXStatus").Caption = "Status"

        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If
        C1dgPatientDetails.Cols("FAXDate").Width = _width * 0.15
        C1dgPatientDetails.Cols("FAXTO").Width = _width * 0.15
        C1dgPatientDetails.Cols("FAXNo").Width = _width * 0.15
        C1dgPatientDetails.Cols("FAXType").Width = _width * 0.23
        C1dgPatientDetails.Cols("FAXSend").Width = _width * 0.12
        C1dgPatientDetails.Cols("FAXStatus").Width = _width * 0.12

        _width = Nothing

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Sent Fax viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub

    Private Sub Fill_Labs()
        Try



            Dim _FromDate As DateTime = Now
            Dim _ToDate As DateTime = Now
            Dim _Criteria As String = ""
            C1dgPatientDetails.Visible = False
            If IsNothing(GloUC_TransactionHistory1) = False Then


                ''Added on 20100119-To Reset criteria in order to filter patients according to selected criteria

                If _SeachFlag Then
                    _FromDate = GloUC_TransactionHistory1.dtpFrom.Value
                    _ToDate = GloUC_TransactionHistory1.dtpToDate.Value
                    _Criteria = GloUC_TransactionHistory1.cmbCriteria.Text
                End If


                pnlPatientDetails.Controls.Remove(GloUC_TransactionHistory1)
                'End If
                RemoveHandler GloUC_TransactionHistory1.gUC_ViewDocument, AddressOf gloLabUC_Transaction1_gUC_ViewDocument
                RemoveHandler GloUC_TransactionHistory1.EvntViewOrderHandler, AddressOf ModifyOrder

                GloUC_TransactionHistory1.Dispose()
                GloUC_TransactionHistory1 = Nothing
            End If

            GloUC_TransactionHistory1 = New gloUserControlLibrary.gloUC_TransactionHistory

            pnlPatientDetails.Controls.Add(GloUC_TransactionHistory1)
            GloUC_TransactionHistory1.Visible = True
            GloUC_TransactionHistory1.Dock = DockStyle.Fill

            ' GloUC_TransactionHistory1.gUC_ViewDocument += new gloUserControlLibrary.gloUC_TransactionHistory.gUC_ViewDocumentEventHandler(gloLabUC_Transaction1_gUC_ViewDocument); 
            AddHandler GloUC_TransactionHistory1.gUC_ViewDocument, AddressOf gloLabUC_Transaction1_gUC_ViewDocument
            AddHandler GloUC_TransactionHistory1.EvntViewOrderHandler, AddressOf ModifyOrder
            GloUC_TransactionHistory1.LoadPreviousLabs(gnPatientID, DateTime.Now) '.ToString("MM/dd/yyyy hh:mm:ss"))
            ''Added on 20100119-To set values according to selection
            If _Criteria <> "" Then
                GloUC_TransactionHistory1.cmbCriteria.Text = _Criteria
                GloUC_TransactionHistory1.dtpFrom.Value = _FromDate

                GloUC_TransactionHistory1.dtpToDate.Value = _ToDate
            Else
                GloUC_TransactionHistory1.cmbCriteria.Text = "Date"
                _SeachFlag = False
            End If

            _FromDate = Nothing
            _ToDate = Nothing
            _Criteria = Nothing



            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Labs viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception

        End Try

    End Sub
    Private Sub gloLabUC_Transaction1_gUC_ViewDocument(TestID As Long, DocumentID As Long)
        Try
            Dim oViewDocument As gloEDocumentV3.gloEDocV3Management = Nothing
            If DocumentID > 0 Then
                If oViewDocument Is Nothing Then
                    oViewDocument = New gloEDocumentV3.gloEDocV3Management()
                End If

                'oViewDocument.oPatientExam = objgloLabPatientExam
                'oViewDocument.oPatientMessages = objgloLabPatientMessages
                'oViewDocument.oPatientLetters = objgloLabPatientLetters
                'oViewDocument.oNurseNotes = objgloLabNurseNotes
                'oViewDocument.oHistory = objgloLabHistory
                'oViewDocument.oLabs = objgloLabLabs
                'oViewDocument.oDMS = objgloLabDMS
                'oViewDocument.oRxmed = objgloLabRxmed
                'oViewDocument.oOrders = objgloLabOrders
                'oViewDocument.oProblemList = objgloLabProblemList
                'oViewDocument.oCriteria = objgloLabCriteria
                'oViewDocument.oWord = objgloLabWord


                'oViewDocument.ShowEDocument(_patientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewDocumentForExternalModule, Me.ParentForm, gloEDocumentV3.Enumeration.enum_OpenExternalSource.LabOrder, DocumentID)
                'oViewDocument.EvnRefreshDocuments += New gloEDocumentV3.gloEDocV3Management.RefreshDocuments(oViewDocument_EvnRefreshDocuments)
                oViewDocument.oPatientExam = New clsPatientExams

                oViewDocument.oPatientMessages = New clsMessage
                oViewDocument.oPatientLetters = New clsPatientLetters
                oViewDocument.oNurseNotes = New clsNurseNotes
                oViewDocument.oHistory = New clsPatientHistory
                oViewDocument.oLabs = New clsLabs
                oViewDocument.oDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                oViewDocument.oRxmed = New clsPatientDetails
                oViewDocument.oOrders = New clsPatientDetails
                oViewDocument.oProblemList = New clsPatientProblemList

                oViewDocument.oCriteria = New DocCriteria
                oViewDocument.oWord = New clsWordDocument
                Dim isItDialog As Boolean = oViewDocument.ShowEDocument(gnPatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewDocumentForExternalModule, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.DashBoard, DocumentID)
                If (isItDialog = True) Then


                    If (IsNothing(oViewDocument.oPatientExam) = False) Then
                        DirectCast(oViewDocument.oPatientExam, clsPatientExams).Dispose()
                        oViewDocument.oPatientExam = Nothing
                    End If
                    If (IsNothing(oViewDocument.oPatientMessages) = False) Then
                        DirectCast(oViewDocument.oPatientMessages, clsMessage).Dispose()
                        oViewDocument.oPatientMessages = Nothing
                    End If
                    If (IsNothing(oViewDocument.oPatientLetters) = False) Then
                        DirectCast(oViewDocument.oPatientLetters, clsPatientLetters).Dispose()
                        oViewDocument.oPatientLetters = Nothing
                    End If
                    If (IsNothing(oViewDocument.oNurseNotes) = False) Then
                        DirectCast(oViewDocument.oNurseNotes, clsNurseNotes).Dispose()
                        oViewDocument.oNurseNotes = Nothing
                    End If
                    If (IsNothing(oViewDocument.oHistory) = False) Then
                        DirectCast(oViewDocument.oHistory, clsPatientHistory).Dispose()
                        oViewDocument.oHistory = Nothing
                    End If
                    If (IsNothing(oViewDocument.oLabs) = False) Then
                        DirectCast(oViewDocument.oLabs, clsLabs).Dispose()
                        oViewDocument.oLabs = Nothing
                    End If
                    If (IsNothing(oViewDocument.oDMS) = False) Then
                        DirectCast(oViewDocument.oDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                        oViewDocument.oDMS = Nothing
                    End If
                    If (IsNothing(oViewDocument.oRxmed) = False) Then
                        DirectCast(oViewDocument.oRxmed, clsPatientDetails).Dispose()
                        oViewDocument.oRxmed = Nothing
                    End If
                    If (IsNothing(oViewDocument.oOrders) = False) Then
                        DirectCast(oViewDocument.oOrders, clsPatientDetails).Dispose()
                        oViewDocument.oOrders = Nothing
                    End If
                    If (IsNothing(oViewDocument.oProblemList) = False) Then
                        DirectCast(oViewDocument.oProblemList, clsPatientProblemList).Dispose()
                        oViewDocument.oProblemList = Nothing
                    End If
                    If (IsNothing(oViewDocument.oCriteria) = False) Then
                        DirectCast(oViewDocument.oCriteria, DocCriteria).Dispose()
                        oViewDocument.oCriteria = Nothing
                    End If
                    oViewDocument.Dispose()
                End If
                oViewDocument = Nothing
            End If
        Catch ex As Exception

            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try

    End Sub


    Private Sub Fill_NurseNotes()

        Dim dtFiltered As DataTable
        Dim objclsNotes As New clsNurseNotes
        'Added by Mayuri:20100119-To get details according to criteria selection
        dtPatientDetails = objclsNotes.GetAllNurseNotes(gnPatientID).ToTable
        objclsNotes.Dispose()
        objclsNotes = Nothing

        Dim dvFilter As DataView ''slr new not needed
        dvFilter = dtPatientDetails.DefaultView

        Dim strFilter As String = ""

        If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
            'FILTER BY DATES
            strFilter = "dtNotesDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND dtNotesDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "
        End If
        'FILTER DATAVIEW
        If cmbStatus.Text <> "All" Then
            'FILTER STATUS
            If strFilter.Trim() <> "" Then
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & " AND Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & " AND Finished = 'No' "
                End If
            Else
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & "  Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & "  Finished = 'No' "
                End If
            End If
        End If

        If strFilter.Trim() <> "" Then
            dvFilter.RowFilter = strFilter
            dtFiltered = dvFilter.ToTable
        Else
            dtFiltered = dtPatientDetails.Copy()  ''slr to display data bugid 61988
        End If

        strFilter = Nothing

        C1dgPatientDetails.DataSource = dtFiltered
        C1dgPatientDetails.Cols(0).Visible = False
        C1dgPatientDetails.Cols(2).Visible = False
        C1dgPatientDetails.Cols(0).Caption = "NotesID"
        C1dgPatientDetails.Cols(1).Caption = "Notes Date"
        C1dgPatientDetails.Cols(2).Caption = "TemplateID"
        C1dgPatientDetails.Cols(3).Caption = "Notes Header"
        C1dgPatientDetails.Cols(4).Caption = "Finished"

        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If

        C1dgPatientDetails.Cols(0).Width = 0
        C1dgPatientDetails.Cols(1).Width = _width * 0.2
        C1dgPatientDetails.Cols(2).Width = 0
        C1dgPatientDetails.Cols(3).Width = _width * 0.5
        C1dgPatientDetails.Cols(4).Width = _width * 0.2

        _width = Nothing
        If Not IsNothing(dvFilter) Then ''slr dispose dvfilter
            dvFilter.Dispose()
            dvFilter = Nothing
        End If

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Nurse Notes viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

    End Sub

    Private Sub Fill_PatientConsent()

        Dim dtFiltered As DataTable
        Dim objclsPatientConsent As New clsPatientConsent

        'Added by Mayuri:20100119-To get details according to criteria selection
        dtPatientDetails = objclsPatientConsent.GetAllPatientConsents(gnPatientID).ToTable
        objclsPatientConsent = Nothing

        Dim dvFilter As DataView    ''Slr new is not needed 
        dvFilter = dtPatientDetails.DefaultView

        Dim strFilter As String = ""

        If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
            strFilter = "dtConsentDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND dtConsentDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "
        End If
        'FILTER DATAVIEW
        If cmbStatus.Text <> "All" Then '' FILTER BOTH ''
            'FILTER STATUS
            If strFilter.Trim <> "" Then
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & " AND Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & " AND Finished = 'No' "
                End If
            Else
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & "  Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & "  Finished = 'No' "
                End If
            End If
        End If

        If strFilter.Trim() <> "" Then
            dvFilter.RowFilter = strFilter
            dtFiltered = dvFilter.ToTable
        Else
            dtFiltered = dtPatientDetails.Copy() ''slr add copy 
        End If

        strFilter = Nothing

        C1dgPatientDetails.DataSource = dtFiltered
        C1dgPatientDetails.Cols(0).Visible = False
        C1dgPatientDetails.Cols(2).Visible = False
        C1dgPatientDetails.Cols(0).Caption = "Consent ID"
        C1dgPatientDetails.Cols(1).Caption = "Consent Date"
        C1dgPatientDetails.Cols(2).Caption = "Template ID"
        C1dgPatientDetails.Cols(3).Caption = "Consent Header"
        C1dgPatientDetails.Cols(4).Caption = "Finished"


        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If

        C1dgPatientDetails.Cols(0).Width = 0
        C1dgPatientDetails.Cols(1).Width = _width * 0.2
        C1dgPatientDetails.Cols(2).Width = 0
        C1dgPatientDetails.Cols(3).Width = _width * 0.5
        C1dgPatientDetails.Cols(4).Width = _width * 0.2

        _width = Nothing
        If Not IsNothing(dvFilter) Then ''slr free dvfilter
            dvFilter.Dispose()
            dvFilter = Nothing
        End If
        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Consent viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub

    Private Sub Fill_PatientLetters()

        Dim dtFiltered As DataTable
        Dim objclsPatientLetters As New clsPatientLetters
        'Added by Mayuri:20100119-To get details according to criteria selection
        dtPatientDetails = objclsPatientLetters.GetAllPatientLetters(gnPatientID).ToTable
        objclsPatientLetters.Dispose()

        Dim dvFilter As DataView  'Slr new not needed 
        dvFilter = dtPatientDetails.DefaultView

        'FILTER BY DATES
        Dim strFilter As String = ""
        If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked) = True Then
            strFilter = "dtLetterDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND dtLetterDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "
        End If

        'FILTER DATAVIEW
        If cmbStatus.Text <> "All" Then
            'FILTER STATUS
            If strFilter.Trim() <> "" Then
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & " AND Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & " AND Finished = 'No' "
                End If

            Else
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & "  Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & "  Finished = 'No' "
                End If
            End If
        End If

        If strFilter.Trim() <> "" Then
            dvFilter.RowFilter = strFilter
            dtFiltered = dvFilter.ToTable
        Else
            dtFiltered = dtPatientDetails.Copy() ''slr to display data bugid 61988
        End If

        C1dgPatientDetails.DataSource = dtFiltered
        C1dgPatientDetails.Cols(0).Visible = False
        C1dgPatientDetails.Cols(2).Visible = False

        C1dgPatientDetails.Cols(0).Caption = "Letter ID"
        C1dgPatientDetails.Cols(1).Caption = "Letter Date"
        C1dgPatientDetails.Cols(2).Caption = "Template ID"
        C1dgPatientDetails.Cols(3).Caption = "Letter Header"
        C1dgPatientDetails.Cols(4).Caption = "Finished"

        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If

        C1dgPatientDetails.Cols(0).Width = 0
        C1dgPatientDetails.Cols(1).Width = _width * 0.2
        C1dgPatientDetails.Cols(2).Width = 0
        C1dgPatientDetails.Cols(3).Width = _width * 0.5
        C1dgPatientDetails.Cols(4).Width = _width * 0.2

        _width = Nothing

        objclsPatientLetters = Nothing
        If Not IsNothing(dvFilter) Then  ''slr free dvFilter
            dvFilter.Dispose()
            dvFilter = Nothing
        End If


        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Letters viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

    End Sub

    Private Sub Fill_DisclosureManagement()

        Dim dtFiltered As DataTable
        Dim objclsDisclosure As New clsDisclosureMgmt

        dtPatientDetails = objclsDisclosure.GetAllDisclosures(gnPatientID).ToTable ''Added by Mayuri:20100118-To fill details of selected patient
        objclsDisclosure = Nothing

        Dim dvFilter As New DataView
        dvFilter = dtPatientDetails.DefaultView

        'FILTER BY DATES
        Dim strFilter As String = ""
        If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
            strFilter = "dtDisclosureDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND dtDisclosureDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "

        End If

        'FILTER DATAVIEW
        If cmbStatus.Text <> "All" Then 'FILTER BOTH
            'FILTER STATUS
            If strFilter.Trim() <> "" Then
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & " AND Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & " AND Finished = 'No' "
                End If
            Else
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & "  Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & "  Finished = 'No' "
                End If
            End If
        End If
        If strFilter.Trim() <> "" Then
            dvFilter.RowFilter = strFilter
            dtFiltered = dvFilter.ToTable
        Else
            dtFiltered = dtPatientDetails.Copy()  ''added to solve the 00026578 incident
        End If

        strFilter = Nothing

        C1dgPatientDetails.DataSource = dtFiltered
        C1dgPatientDetails.Cols(0).Visible = False
        C1dgPatientDetails.Cols(2).Visible = False
        C1dgPatientDetails.Cols(0).Caption = "Disclosure ID"
        C1dgPatientDetails.Cols(1).Caption = "Disclosure Date"
        C1dgPatientDetails.Cols(2).Caption = "Template ID"
        C1dgPatientDetails.Cols(3).Caption = "Disclosure Header"
        C1dgPatientDetails.Cols(4).Caption = "Finished"

        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If

        C1dgPatientDetails.Cols(0).Width = 0
        C1dgPatientDetails.Cols(1).Width = _width * 0.2
        C1dgPatientDetails.Cols(2).Width = 0
        C1dgPatientDetails.Cols(3).Width = _width * 0.5
        C1dgPatientDetails.Cols(4).Width = _width * 0.2

        _width = Nothing
        If Not IsNothing(dvFilter) Then  ''slr free dvfilter
            dvFilter.Dispose()
            dvFilter = Nothing
        End If

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Disclosure Management viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
    End Sub

    Private Sub Fill_AuditTrail()

        Dim dtPatientDetails As DataTable
        Dim objPatientDetail As New clsPatientDetails

        dtPatientDetails = objPatientDetail.Fill_AuditTrails(gnPatientID)
        'Added this change as for problem #00000831 in order to handle object reference exception
        If dtPatientDetails Is Nothing Then
            dtPatientDetails = objPatientDetail.Fill_AuditTrails(gnPatientID)
            If dtPatientDetails Is Nothing Then
                objPatientDetail.Dispose()
                objPatientDetail = Nothing

                Exit Sub
            End If
        End If

        objPatientDetail.Dispose()
        objPatientDetail = Nothing

        C1dgPatientDetails.DataSource = dtPatientDetails.DefaultView
        C1dgPatientDetails.AllowEditing = False

        C1dgPatientDetails.Cols("Description").Caption = "Description"
        C1dgPatientDetails.Cols("Machine Name").Caption = "Machine Name"
        C1dgPatientDetails.Cols("ActivityCategory").Caption = "Category"
        C1dgPatientDetails.Cols("SoftwareComponent").Caption = "Software Component"
        C1dgPatientDetails.Cols("Outcome").Caption = "Outcome"
        C1dgPatientDetails.Cols("TransactionID").Caption = "TransactionID"
        C1dgPatientDetails.Cols("ActivityType").Caption = "ActivityType"
        C1dgPatientDetails.Cols("ActivityModule").Caption = "ActivityModule"

        C1dgPatientDetails.Cols("Activity Date").Caption = "Activity Date Time"
        C1dgPatientDetails.Cols("Activity Date").Format = "MM/dd/yyyy h:mm:ss tt"

        'Added Code for Audit LOG Enhancement
        C1dgPatientDetails.Cols("Machine IP").Caption = "Machine IP"
        C1dgPatientDetails.Cols("Remote Machine Name").Caption = "Remote Machine Name"
        C1dgPatientDetails.Cols("Remote Machine IP").Caption = "Remote Machine IP"
        C1dgPatientDetails.Cols("Remote User Name").Caption = "Remote User Name"
        C1dgPatientDetails.Cols("Domain").Caption = "Domain"

        C1dgPatientDetails.AllowEditing = False

        Dim _width As Integer = pnlPatientDetail.Width
        If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = Convert.ToInt32(c1dgPatientDetailSize)
        End If

        C1dgPatientDetails.Cols("Activity Date").Width = _width * 0.13
        C1dgPatientDetails.Cols("Description").Width = _width * 0.25
        C1dgPatientDetails.Cols("User Name").Width = _width * 0.1
        C1dgPatientDetails.Cols("Machine Name").Width = _width * 0.1
        C1dgPatientDetails.Cols("AuditTrailID").Width = 0
        C1dgPatientDetails.Cols("ActivityCategory").Width = _width * 0.15
        C1dgPatientDetails.Cols("SoftwareComponent").Width = _width * 0.15
        C1dgPatientDetails.Cols("Outcome").Width = _width * 0.12
        C1dgPatientDetails.Cols("TransactionID").Width = 0
        C1dgPatientDetails.Cols("ActivityType").Width = 0
        'Added Code for Audit LOG Enhancement
        C1dgPatientDetails.Cols("ActivityModule").Width = 0
        C1dgPatientDetails.Cols("Machine IP").Width = _width * 0.12
        C1dgPatientDetails.Cols("Remote Machine Name").Width = _width * 0.18
        C1dgPatientDetails.Cols("Remote Machine IP").Width = _width * 0.18
        C1dgPatientDetails.Cols("Remote User Name").Width = _width * 0.18
        C1dgPatientDetails.Cols("Domain").Width = _width * 0.18
        _width = Nothing

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Audit Log viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

    End Sub

    Private Sub Fill_Appointments_old()

        Dim dtAppointment As New DataTable()
        Dim oParam As New gloDatabaseLayer.DBParameters
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())

        Try
            If IsAccess(True) = False Then
                Exit Sub
            End If

            oDB.Connect(False)
            oParam.Add("@nPatientID", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@nClinicID", gnClinicID, ParameterDirection.Input, SqlDbType.BigInt)
            oDB.Retrive("gsp_GetPatientAppointments", oParam, dtAppointment)

            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing

            C1dgPatientDetails.Cols.Count = 17
            C1dgPatientDetails.Rows.Count = 1

            C1dgPatientDetails.DataSource = Nothing


            C1dgPatientDetails.ShowCellLabels = False
            C1dgPatientDetails.ExtendLastCol = False
            C1dgPatientDetails.SelectionMode = C1.Win.C1FlexGrid.SelectionModeEnum.Row
            C1dgPatientDetails.FocusRect = C1.Win.C1FlexGrid.FocusRectEnum.None
            C1dgPatientDetails.AllowSorting = AllowSortingEnum.None


            C1dgPatientDetails.Cols(COL_MSTAPTID).Caption = "MST AppointmentID"
            C1dgPatientDetails.Cols(COL_APTDTL).Caption = "DTL AppointmentID"
            C1dgPatientDetails.Cols(COL_DATE).Caption = "Date"
            C1dgPatientDetails.Cols(COL_STARTTIME).Caption = "Start Time"
            C1dgPatientDetails.Cols(COL_ENDTIME).Caption = "End Time"
            C1dgPatientDetails.Cols(COL_LOCATION).Caption = "Location"
            C1dgPatientDetails.Cols(COL_DEPARTMENT).Caption = "Department"
            C1dgPatientDetails.Cols(COL_APPTYPE).Caption = "Appointment Type"
            C1dgPatientDetails.Cols(COL_PROVIDER).Caption = "Provider"
            C1dgPatientDetails.Cols(COL_NOTES).Caption = "Notes"
            C1dgPatientDetails.Cols(COL_USEDSTATUS).Caption = "Status"

            C1dgPatientDetails.Cols(COL_MSTAPTID).Visible = False
            C1dgPatientDetails.Cols(COL_APTDTL).Visible = False
            C1dgPatientDetails.Cols(COL_DATE).Visible = True
            C1dgPatientDetails.Cols(COL_STARTTIME).Visible = True
            C1dgPatientDetails.Cols(COL_ENDTIME).Visible = True
            C1dgPatientDetails.Cols(COL_LOCATION).Visible = True
            C1dgPatientDetails.Cols(COL_DEPARTMENT).Visible = True
            C1dgPatientDetails.Cols(COL_APPTYPE).Visible = True
            C1dgPatientDetails.Cols(COL_ASBASEID).Visible = False
            C1dgPatientDetails.Cols(COL_PROVIDER).Visible = True
            C1dgPatientDetails.Cols(COL_USEDSTATUS).Visible = True
            C1dgPatientDetails.Cols(COL_MASTERAPPMETHOD).Visible = False
            C1dgPatientDetails.Cols(COL_APPMETHOD).Visible = False
            C1dgPatientDetails.Cols(COL_LINENUMBER).Visible = False
            C1dgPatientDetails.Cols(COL_CLINICID).Visible = False
            C1dgPatientDetails.Cols(COL_Status).Visible = False

            Dim _width As Integer = pnlPatientDetail.Width
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If

            C1dgPatientDetails.Cols(COL_MSTAPTID).Width = 0
            C1dgPatientDetails.Cols(COL_APTDTL).Width = 0
            C1dgPatientDetails.Cols(COL_DATE).Width = _width * 0.1
            C1dgPatientDetails.Cols(COL_STARTTIME).Width = _width * 0.1
            C1dgPatientDetails.Cols(COL_ENDTIME).Width = _width * 0.1
            C1dgPatientDetails.Cols(COL_LOCATION).Width = _width * 0.1
            C1dgPatientDetails.Cols(COL_DEPARTMENT).Width = _width * 0.1
            C1dgPatientDetails.Cols(COL_APPTYPE).Width = _width * 0.15
            C1dgPatientDetails.Cols(COL_ASBASEID).Width = 0
            C1dgPatientDetails.Cols(COL_PROVIDER).Width = _width * 0.17
            C1dgPatientDetails.Cols(COL_MASTERAPPMETHOD).Width = 0
            C1dgPatientDetails.Cols(COL_APPMETHOD).Width = 0
            C1dgPatientDetails.Cols(COL_LINENUMBER).Width = 0
            C1dgPatientDetails.Cols(COL_CLINICID).Width = 0
            C1dgPatientDetails.Cols(COL_USEDSTATUS).Width = _width * 0.1
            C1dgPatientDetails.Cols(COL_Status).Width = 0

            C1dgPatientDetails.AllowEditing = True
            C1dgPatientDetails.Cols(COL_MSTAPTID).AllowEditing = False
            C1dgPatientDetails.Cols(COL_APTDTL).AllowEditing = False
            C1dgPatientDetails.Cols(COL_DATE).AllowEditing = False
            C1dgPatientDetails.Cols(COL_STARTTIME).AllowEditing = False
            C1dgPatientDetails.Cols(COL_ENDTIME).AllowEditing = False
            C1dgPatientDetails.Cols(COL_LOCATION).AllowEditing = False
            C1dgPatientDetails.Cols(COL_DEPARTMENT).AllowEditing = False
            C1dgPatientDetails.Cols(COL_APPTYPE).AllowEditing = False
            C1dgPatientDetails.Cols(COL_PROVIDER).AllowEditing = False
            C1dgPatientDetails.Cols(COL_ASBASEID).AllowEditing = False
            C1dgPatientDetails.Cols(COL_USEDSTATUS).AllowEditing = False
            C1dgPatientDetails.Cols(COL_MASTERAPPMETHOD).AllowEditing = False
            C1dgPatientDetails.Cols(COL_APPMETHOD).AllowEditing = False
            C1dgPatientDetails.Cols(COL_LINENUMBER).AllowEditing = False
            C1dgPatientDetails.Cols(COL_CLINICID).AllowEditing = False

            C1dgPatientDetails.Cols(COL_MSTAPTID).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_APTDTL).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_DATE).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_STARTTIME).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_ENDTIME).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_LOCATION).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_DEPARTMENT).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_APPTYPE).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(8).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_PROVIDER).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(10).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_USEDSTATUS).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_MASTERAPPMETHOD).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_APPMETHOD).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_LINENUMBER).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_CLINICID).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            '''''''''''''
            If dtAppointment IsNot Nothing AndAlso dtAppointment.Rows.Count > 0 Then

                'If search flag is true then pull appointments for the selected search criteria 
                'else  pull all appointments
                Dim dvFilter As New DataView
                dvFilter = dtAppointment.DefaultView

                'FILTER BY DATES
                Dim strFilter As String = ""

                If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
                    strFilter = "dtStartDate >=  " & gloDateMaster.gloDate.DateAsNumber(dtpFromDate.Value.Date.ToString()) & " AND  dtStartDate <=  " & gloDateMaster.gloDate.DateAsNumber(dtpToDate.Value.Date.ToString()) & ""

                End If

                '' FILTER DATAVIEW ''
                If strFilter.Trim() <> "" Then
                    If cmbStatus.Text <> "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER BOTH ''
                        '' FILTER STATUS ''
                        strFilter = strFilter & " AND nUsedStatus = " & cmbStatus.SelectedValue & " "
                        '' FILTER USER ''
                        strFilter = strFilter & " AND Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"

                    ElseIf cmbStatus.Text <> "All" AndAlso cmbProvider.Text = "All" Then '' FILTER ONLY STATUS ''
                        strFilter = strFilter & " AND nUsedStatus = " & cmbStatus.SelectedValue & " "
                    ElseIf cmbStatus.Text = "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER ONLY Provider ''
                        strFilter = strFilter & " AND Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                    End If
                Else
                    If cmbStatus.Text <> "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER BOTH ''
                        '' FILTER STATUS ''
                        strFilter = strFilter & "  nUsedStatus = " & cmbStatus.SelectedValue & " "
                        '' FILTER USER ''
                        strFilter = strFilter & " AND Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"

                    ElseIf cmbStatus.Text <> "All" AndAlso cmbProvider.Text = "All" Then '' FILTER ONLY STATUS ''
                        strFilter = strFilter & "  nUsedStatus = " & cmbStatus.SelectedValue & " "
                    ElseIf cmbStatus.Text = "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER ONLY Provider ''
                        strFilter = strFilter & "  Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                    End If
                End If
                If strFilter.Trim() <> "" Then

                    dvFilter.RowFilter = strFilter
                End If
                dtAppointment = dvFilter.ToTable

                'End If

                For i As Integer = 0 To dtAppointment.Rows.Count - 1
                    C1dgPatientDetails.Rows.Add()
                    Dim rowIndex As Integer = C1dgPatientDetails.Rows.Count - 1


                    C1dgPatientDetails.SetData(rowIndex, COL_MSTAPTID, Convert.ToInt64(dtAppointment.Rows(i)("nMSTAppointmentID")))
                    C1dgPatientDetails.SetData(rowIndex, COL_APTDTL, Convert.ToInt64(dtAppointment.Rows(i)("nDTLAppointmentID")))
                    C1dgPatientDetails.SetData(rowIndex, COL_DATE, gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtAppointment.Rows(i)("dtStartDate"))).ToShortDateString())
                    C1dgPatientDetails.SetData(rowIndex, COL_STARTTIME, gloDateMaster.gloTime.TimeAsDateTime(DateTime.Now.[Date], Convert.ToInt32(dtAppointment.Rows(i)("dtStartTime"))).ToShortTimeString())
                    C1dgPatientDetails.SetData(rowIndex, COL_ENDTIME, gloDateMaster.gloTime.TimeAsDateTime(DateTime.Now.[Date], Convert.ToInt32(dtAppointment.Rows(i)("dtEndTime"))).ToShortTimeString())
                    C1dgPatientDetails.SetData(rowIndex, COL_LOCATION, Convert.ToString(dtAppointment.Rows(i)("Location")))
                    C1dgPatientDetails.SetData(rowIndex, COL_DEPARTMENT, Convert.ToString(dtAppointment.Rows(i)("Department")))
                    C1dgPatientDetails.SetData(rowIndex, COL_APPTYPE, Convert.ToString(dtAppointment.Rows(i)("AppointmentType")))
                    C1dgPatientDetails.SetData(rowIndex, COL_ASBASEID, Convert.ToInt64(dtAppointment.Rows(i)("nASBaseID")))
                    C1dgPatientDetails.SetData(rowIndex, COL_PROVIDER, Trim(Convert.ToString(dtAppointment.Rows(i)("Provider"))))
                    C1dgPatientDetails.SetData(rowIndex, COL_NOTES, Convert.ToString(dtAppointment.Rows(i)("Notes")))
                    C1dgPatientDetails.SetData(rowIndex, COL_Status, Convert.ToInt32(dtAppointment.Rows(i)("nUsedStatus")))
                    C1dgPatientDetails.SetData(rowIndex, COL_MASTERAPPMETHOD, Convert.ToInt32(dtAppointment.Rows(i)("MSTAppMethod")))
                    C1dgPatientDetails.SetData(rowIndex, COL_APPMETHOD, Convert.ToInt32(dtAppointment.Rows(i)("DTLAppMethod")))
                    C1dgPatientDetails.SetData(rowIndex, COL_LINENUMBER, Convert.ToInt32(dtAppointment.Rows(i)("nLineNumber")))
                    C1dgPatientDetails.SetData(rowIndex, COL_CLINICID, gnClinicID)
                    'Show Appointment Status 
                    Dim sStatus As String = ""
                    Select Case DirectCast(Convert.ToInt32(dtAppointment.Rows(i)("nUsedStatus")), gloAppointmentScheduling.ASUsedStatus)
                        Case gloAppointmentScheduling.ASUsedStatus.NotUsed
                            sStatus = "Not Used"
                            Exit Select
                        Case gloAppointmentScheduling.ASUsedStatus.Registred
                            sStatus = "Registered"
                            Exit Select
                        Case gloAppointmentScheduling.ASUsedStatus.Waiting
                            sStatus = "Waiting"
                            Exit Select
                        Case gloAppointmentScheduling.ASUsedStatus.CheckIn
                            sStatus = "Check in"
                            Exit Select
                        Case gloAppointmentScheduling.ASUsedStatus.CheckOut
                            sStatus = "Check out"
                            Exit Select
                        Case gloAppointmentScheduling.ASUsedStatus.NoShow
                            sStatus = "No Show"
                            Exit Select
                        Case gloAppointmentScheduling.ASUsedStatus.Cancel
                            sStatus = "Cancel"
                            Exit Select
                        Case gloAppointmentScheduling.ASUsedStatus.Delete
                            sStatus = "Deleted"
                            Exit Select
                        Case gloAppointmentScheduling.ASUsedStatus.Unknown3, gloAppointmentScheduling.ASUsedStatus.Unknown3, gloAppointmentScheduling.ASUsedStatus.Unknown4, gloAppointmentScheduling.ASUsedStatus.Unknown5

                            sStatus = ""
                            Exit Select
                    End Select
                    C1dgPatientDetails.SetData(rowIndex, COL_USEDSTATUS, sStatus)
                Next
            End If

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Appointments viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

        Catch ex As Exception
            If IsNothing(dtAppointment) Then
                dtAppointment.Dispose()
            End If
            If IsNothing(oParam) Then
                oParam.Dispose()
            End If
            If IsNothing(oDB) Then
                oDB.Dispose()
            End If

        End Try
    End Sub
    ''
    Private Sub Fill_Appointments()
        UpdateLog("START - Fill_Appointments")
        Dim dtAppointment As New DataTable()
        Dim oParam As New gloDatabaseLayer.DBParameters
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())

        Try

            If IsAccess(True) = False Then
                Exit Sub
            End If

            oDB.Connect(False)
            oParam.Add("@nPatientID", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@nClinicID", gnClinicID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@nExtemptFromReport", gblnExtemptFromReport, ParameterDirection.Input, SqlDbType.Bit)
            oDB.Retrive("gsp_GetPatientAppointments", oParam, dtAppointment)

            oDB.Disconnect()

            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.Cols.Count = 20
            C1dgPatientDetails.Rows.Count = 1

            C1dgPatientDetails.ShowCellLabels = False
            C1dgPatientDetails.ExtendLastCol = False
            C1dgPatientDetails.SelectionMode = C1.Win.C1FlexGrid.SelectionModeEnum.Row
            C1dgPatientDetails.FocusRect = C1.Win.C1FlexGrid.FocusRectEnum.None
            C1dgPatientDetails.AllowSorting = AllowSortingEnum.None


            Dim dvFilter As New DataView
            dvFilter = dtAppointment.DefaultView


            'GLO2011-0011959 - Multiple days appointment
            'Patient Details - Appointment filter changed to showing multiple day's appointment after filter criteria applied.

            Dim strFilter As String = ""
            If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
                'strFilter = "dtStartDate >=  " & gloDateMaster.gloDate.DateAsNumber(dtpFromDate.Value.Date.ToShortDateString()) & " AND  dtEndDate <=  " & gloDateMaster.gloDate.DateAsNumber(dtpToDate.Value.Date.ToShortDateString()) & ""
                strFilter = "((dtStartDate >= " & gloDateMaster.gloDate.DateAsNumber(dtpFromDate.Value.Date.ToShortDateString()) & " AND dtStartDate <= " & gloDateMaster.gloDate.DateAsNumber(dtpToDate.Value.Date.ToShortDateString()) & ") or (dtEndDate >= " & gloDateMaster.gloDate.DateAsNumber(dtpFromDate.Value.Date.ToShortDateString()) & " AND  dtEndDate <=  " & gloDateMaster.gloDate.DateAsNumber(dtpToDate.Value.Date.ToShortDateString()) & "))"
            End If

            '' FILTER DATAVIEW ''
            If strFilter.Trim() <> "" Then
                If cmbStatus.Text <> "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER BOTH ''
                    '' FILTER STATUS ''
                    ''''strFilter = strFilter & " AND sStatus = " & cmbStatus.SelectedValue & " "
                    If strFilter.Trim() <> "" Then
                        strFilter = strFilter & " AND sStatus LIKE '%" & cmbStatus.Text.Replace("'", "''") & "%'"
                    Else
                        strFilter = " sStatus LIKE '%" & cmbStatus.Text.Replace("'", "''") & "%'"
                    End If


                    '' FILTER USER ''
                    If strFilter.Trim() <> "" Then
                        strFilter = strFilter & " AND Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                    Else
                        strFilter = " Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                    End If



                ElseIf cmbStatus.Text <> "All" AndAlso cmbProvider.Text = "All" Then '' FILTER ONLY STATUS ''
                    ''''strFilter = strFilter & " AND nUsedStatus = " & cmbStatus.SelectedValue & " "
                    If strFilter.Trim() <> "" Then
                        strFilter = strFilter & " AND sStatus LIKE '%" & cmbStatus.Text.Replace("'", "''") & "%'"
                    Else
                        strFilter = " sStatus LIKE '%" & cmbStatus.Text.Replace("'", "''") & "%'"
                    End If

                ElseIf cmbStatus.Text = "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER ONLY Provider ''
                    If strFilter.Trim() <> "" Then
                        strFilter = strFilter & " AND Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                    Else
                        strFilter = " Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                    End If

                End If
            Else
                If cmbStatus.Text <> "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER BOTH ''
                    '' FILTER STATUS ''
                    '''' strFilter = strFilter & "  nUsedStatus = " & cmbStatus.SelectedValue & " "
                    If strFilter.Trim() <> "" Then
                        strFilter = strFilter & " AND sStatus LIKE '%" & cmbStatus.Text.Replace("'", "''") & "%'"
                    Else
                        strFilter = " sStatus LIKE '%" & cmbStatus.Text.Replace("'", "''") & "%'"
                    End If
                    '' FILTER USER ''
                    If strFilter.Trim() <> "" Then
                        strFilter = strFilter & " AND Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                    Else
                        strFilter = " Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                    End If

                ElseIf cmbStatus.Text <> "All" AndAlso cmbProvider.Text = "All" Then '' FILTER ONLY STATUS ''
                    '''' strFilter = strFilter & "  nUsedStatus = " & cmbStatus.SelectedValue & " "
                    If strFilter.Trim() <> "" Then
                        strFilter = strFilter & " AND sStatus LIKE '%" & cmbStatus.Text.Replace("'", "''") & "%'"
                    Else
                        strFilter = " sStatus LIKE '%" & cmbStatus.Text.Replace("'", "''") & "%'"
                    End If

                ElseIf cmbStatus.Text = "All" AndAlso cmbProvider.Text <> "All" Then '' FILTER ONLY Provider ''
                    strFilter = strFilter & "  Provider LIKE '%" & cmbProvider.Text.Replace("'", "''") & "%'"
                End If
            End If
            If strFilter.Trim() <> "" Then

                dvFilter.RowFilter = strFilter
            End If

            strFilter = Nothing

            dtAppointment = dvFilter.ToTable
            C1dgPatientDetails.DataSource = dtAppointment
            C1dgPatientDetails.Cols(COL_MSTAPTID).Caption = "MST AppointmentID"
            C1dgPatientDetails.Cols(COL_APTDTL).Caption = "DTL AppointmentID"
            C1dgPatientDetails.Cols(COL_DATE).Caption = "Date"
            C1dgPatientDetails.Cols(COL_DATE1).Caption = "Date"
            C1dgPatientDetails.Cols(COL_STARTTIME).Caption = "Start Time"
            C1dgPatientDetails.Cols(COL_ENDTIME).Caption = "End Time"
            C1dgPatientDetails.Cols(COL_LOCATION).Caption = "Location"
            C1dgPatientDetails.Cols(COL_DEPARTMENT).Caption = "Department"
            C1dgPatientDetails.Cols(COL_ASBASEID).Caption = "Master AppointmentID"
            C1dgPatientDetails.Cols(COL_APPTYPE).Caption = "Appointment Type"
            C1dgPatientDetails.Cols(COL_NOTES).Caption = "Notes"
            C1dgPatientDetails.Cols(COL_PROVIDER).Caption = "Provider"
            C1dgPatientDetails.Cols(COL_Status).Caption = "Status"

            C1dgPatientDetails.Cols(COL_MSTAPTID).Visible = False
            C1dgPatientDetails.Cols(COL_APTDTL).Visible = False
            C1dgPatientDetails.Cols(COL_DATE).Visible = False
            C1dgPatientDetails.Cols(COL_DATE1).Visible = True
            C1dgPatientDetails.Cols(COL_STARTTIME).Visible = True
            C1dgPatientDetails.Cols(COL_ENDTIME).Visible = True
            C1dgPatientDetails.Cols(COL_LOCATION).Visible = True
            C1dgPatientDetails.Cols(COL_DEPARTMENT).Visible = True
            C1dgPatientDetails.Cols(COL_ASBASEID).Visible = False
            C1dgPatientDetails.Cols(COL_APPTYPE).Visible = True
            C1dgPatientDetails.Cols(COL_NOTES).Visible = True
            C1dgPatientDetails.Cols(COL_PROVIDER).Visible = True
            C1dgPatientDetails.Cols(COL_USEDSTATUS).Visible = False
            C1dgPatientDetails.Cols(COL_MASTERAPPMETHOD).Visible = False
            C1dgPatientDetails.Cols(COL_APPMETHOD).Visible = False
            C1dgPatientDetails.Cols(COL_LINENUMBER).Visible = False
            C1dgPatientDetails.Cols(COL_ASBASEFlag).Visible = False
            C1dgPatientDetails.Cols(COL_Status).Visible = True

            'GLO2011-0011959 - Multiple days appointment
            'Patient Details - Appointment Added new column for multiple day's appointment and setting visible property

            C1dgPatientDetails.Cols(COL_EndDate).Visible = False


            Dim _width As Integer = pnlPatientDetail.Width
            C1dgPatientDetails.Cols(COL_MSTAPTID).Width = 0
            C1dgPatientDetails.Cols(COL_APTDTL).Width = 0
            C1dgPatientDetails.Cols(COL_DATE).Width = 0
            C1dgPatientDetails.Cols(COL_DATE1).Width = _width * 0.09
            C1dgPatientDetails.Cols(COL_STARTTIME).Width = _width * 0.08
            C1dgPatientDetails.Cols(COL_ENDTIME).Width = _width * 0.08
            C1dgPatientDetails.Cols(COL_LOCATION).Width = _width * 0.1
            C1dgPatientDetails.Cols(COL_DEPARTMENT).Width = _width * 0.1
            C1dgPatientDetails.Cols(COL_ASBASEID).Width = 0
            C1dgPatientDetails.Cols(COL_APPTYPE).Width = _width * 0.14
            C1dgPatientDetails.Cols(COL_NOTES).Width = _width * 0.17
            C1dgPatientDetails.Cols(COL_PROVIDER).Width = _width * 0.15
            C1dgPatientDetails.Cols(COL_USEDSTATUS).Width = 0
            C1dgPatientDetails.Cols(COL_MASTERAPPMETHOD).Width = 0
            C1dgPatientDetails.Cols(COL_APPMETHOD).Width = 0
            C1dgPatientDetails.Cols(COL_LINENUMBER).Width = 0
            C1dgPatientDetails.Cols(COL_ASBASEFlag).Width = 0
            C1dgPatientDetails.Cols(COL_Status).Width = _width * 0.08

            _width = Nothing

            C1dgPatientDetails.AllowEditing = True
            C1dgPatientDetails.Cols(COL_MSTAPTID).AllowEditing = False
            C1dgPatientDetails.Cols(COL_APTDTL).AllowEditing = False
            C1dgPatientDetails.Cols(COL_DATE1).AllowEditing = False
            C1dgPatientDetails.Cols(COL_STARTTIME).AllowEditing = False
            C1dgPatientDetails.Cols(COL_ENDTIME).AllowEditing = False
            C1dgPatientDetails.Cols(COL_LOCATION).AllowEditing = False
            C1dgPatientDetails.Cols(COL_DEPARTMENT).AllowEditing = False
            C1dgPatientDetails.Cols(COL_APPTYPE).AllowEditing = False
            C1dgPatientDetails.Cols(COL_PROVIDER).AllowEditing = False
            C1dgPatientDetails.Cols(COL_ASBASEID).AllowEditing = False
            C1dgPatientDetails.Cols(COL_Status).AllowEditing = False
            C1dgPatientDetails.Cols(COL_MASTERAPPMETHOD).AllowEditing = False
            C1dgPatientDetails.Cols(COL_APPMETHOD).AllowEditing = False
            C1dgPatientDetails.Cols(COL_LINENUMBER).AllowEditing = False
            C1dgPatientDetails.Cols(COL_NOTES).AllowEditing = False


            C1dgPatientDetails.Cols(COL_MSTAPTID).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_APTDTL).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_DATE1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_LOCATION).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_DEPARTMENT).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_APPTYPE).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(8).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_PROVIDER).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(10).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_Status).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_MASTERAPPMETHOD).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_APPMETHOD).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_LINENUMBER).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(COL_DATE1).DataType = GetType(System.DateTime)
            C1dgPatientDetails.Cols(COL_DATE1).Format = "MM/dd/yyyy"

            C1dgPatientDetails.Cols(COL_STARTTIME).DataType = GetType(System.DateTime)
            C1dgPatientDetails.Cols(COL_STARTTIME).Format = "h:mm tt"


            C1dgPatientDetails.Cols(COL_ENDTIME).DataType = GetType(System.DateTime)
            C1dgPatientDetails.Cols(COL_ENDTIME).Format = "h:mm tt"

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Appointments viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

        Catch ex As Exception
        Finally

            If Not IsNothing(oParam) Then
                oParam.Dispose()
                oParam = Nothing
            End If

            If Not IsNothing(oDB) Then
                oDB.Dispose()
                oDB = Nothing
            End If

        End Try
        UpdateLog("END - Fill_Appointments")
    End Sub
    ''

    Public Sub Fill_EligibilityInfo()

        Dim oClsRxHubInterface As New ClsRxHubInterface()
        Dim oEligibilityCheck As New clsEligibilityCheckDBLayer()
        Dim dt As DataTable = Nothing ''slr new not needed 
        Try

            dt = oEligibilityCheck.GetGeneralEligiblityInformation(gnPatientID)

            C1dgPatientDetails.DataSource = Nothing
            If Not IsNothing(dt) Then
                'If dt.Rows.Count > 0 Then
                C1dgPatientDetails.DataSource = dt


                C1dgPatientDetails.Cols("sSTLoopControlID").Visible = False


                C1dgPatientDetails.Cols("sPBM_PayerName").Caption = "PBM Payer Name"
                C1dgPatientDetails.Cols("sPBM_PayerParticipantID").Visible = False
                C1dgPatientDetails.Cols("sPBM_PayerMemberID").Visible = False

                C1dgPatientDetails.Cols("sPhysicianName").Caption = "Physician Name"

                C1dgPatientDetails.Cols("sPhysicianSuffix").Caption = "Physician Suffix"

                C1dgPatientDetails.Cols("sHealthPlanNumber").Caption = "Health Plan Number"

                C1dgPatientDetails.Cols("sHealthPlanName").Caption = "Health Plan Name"
                C1dgPatientDetails.Cols("sRelationshipCode").Visible = False


                C1dgPatientDetails.Cols("sRelationshipDescription").Caption = "Relationship Description"
                C1dgPatientDetails.Cols("sPersonCode").Visible = False
                C1dgPatientDetails.Cols("sCardHolderID").Visible = False
                C1dgPatientDetails.Cols("sGroupID").Visible = False


                C1dgPatientDetails.Cols("sCardHolderName").Caption = "Card Holder Name"


                C1dgPatientDetails.Cols("sGroupName").Caption = "Group Name"
                C1dgPatientDetails.Cols("sFormularyListID").Visible = False
                C1dgPatientDetails.Cols("sAlternativeListID").Visible = False
                C1dgPatientDetails.Cols("sCoverageID").Visible = False
                C1dgPatientDetails.Cols("sBINNumber").Visible = True
                C1dgPatientDetails.Cols("sCoPayID").Visible = False


                C1dgPatientDetails.Cols("sPharmacyEligible").Caption = "Pharmacy Eligible"
                C1dgPatientDetails.Cols("sPharmacyCoverageName").Caption = "Pharmacy Coverage Name"
                C1dgPatientDetails.Cols("sPhEligiblityorBenefitInfo").Caption = "Pharmacy Eligibility or Benefit Information"
                C1dgPatientDetails.Cols("sMailOrderRxDrugEligible").Caption = "Mail Order RxDrug Eligible"
                C1dgPatientDetails.Cols("sMailOrderRxDrugCoverageName").Caption = "Mail Order RxDrug Coverage Name"
                C1dgPatientDetails.Cols("sMailOrdEligiblityorBenefitInfo").Caption = "Mail Order Eligibility or Benefit Information"

                C1dgPatientDetails.Cols("DependentName").Caption = "Dependent Name"
                C1dgPatientDetails.Cols("sDGender").Caption = "Dependent Gender"
                C1dgPatientDetails.Cols("sDDOB").Caption = "Dependent DOB"
                C1dgPatientDetails.Cols("sDSSN").Caption = "Dependent SSN"
                C1dgPatientDetails.Cols("sDAddress1").Caption = "Dependent Address1"
                C1dgPatientDetails.Cols("sDAddress2").Caption = "Dependent Address2"
                C1dgPatientDetails.Cols("sDCity").Caption = "Dependentdemo City"
                C1dgPatientDetails.Cols("sDState").Caption = "Dependentdemo State"
                C1dgPatientDetails.Cols("sDZip").Caption = "Dependentdemo Zip"
                C1dgPatientDetails.Cols("sBINNumber").Caption = "BIN Number"
                C1dgPatientDetails.Cols("nPatientID").Visible = False
                C1dgPatientDetails.Cols("dtResquestDateTimeStamp").Caption = "Request Date"
                C1dgPatientDetails.Cols("dtResquestDateTimeStamp").DataType = GetType(String)

                C1dgPatientDetails.Cols("sMessageID").Visible = False
                C1dgPatientDetails.Cols("IsDependentdemoChange").Visible = False

                C1dgPatientDetails.Cols("SubscriberName").Caption = "Subscriber Name"
                C1dgPatientDetails.Cols("sSubscriberGender").Caption = "Subscriber Gender"
                C1dgPatientDetails.Cols("sSubscriberDOB").Caption = "Subscriber DOB"
                C1dgPatientDetails.Cols("sSubscriberSSN").Caption = "Subscriber SSN"
                C1dgPatientDetails.Cols("sSubscriberAddress1").Caption = "Subscriber Address1"
                C1dgPatientDetails.Cols("sSubscriberAddress2").Caption = "Subscriber Address2"
                C1dgPatientDetails.Cols("sSubscriberCity").Caption = "Subscriber City"
                C1dgPatientDetails.Cols("sSubscriberState").Caption = "Subscriber State"
                C1dgPatientDetails.Cols("sSubscriberZip").Caption = "Subscriber Zip"

                C1dgPatientDetails.Cols("IsSubscriberdemoChange").Visible = False

                C1dgPatientDetails.Cols("DependentdemoChgName").Caption = "Changed Dependent Name"
                C1dgPatientDetails.Cols("sDependentdemoChgGender").Caption = "Changed Dependent Gender"
                C1dgPatientDetails.Cols("sDependentdemoChgDOB").Caption = "Changed Dependent DOB"
                C1dgPatientDetails.Cols("sDependentdemoChgSSN").Caption = "Changed Dependent SSN"
                C1dgPatientDetails.Cols("sDependentdemoChgAddress1").Caption = "Changed Dependent Address1"
                C1dgPatientDetails.Cols("sDependentdemoChgAddress2").Caption = "Changed Dependent Address2"
                C1dgPatientDetails.Cols("sDependentdemoChgCity").Caption = "Changed Dependentdemo City"
                C1dgPatientDetails.Cols("sDependentdemoChgState").Caption = "ChangedDependentdemo State"
                C1dgPatientDetails.Cols("sDependentdemoChgZip").Caption = "Changed Dependentdemo Zip"

                C1dgPatientDetails.Cols("SubscriberDemoChgName").Caption = "Changed Subscriber Name"
                C1dgPatientDetails.Cols("sSubscriberDemoChgGender").Caption = "Changed Subscriber Gender"
                C1dgPatientDetails.Cols("sSubscriberDemoChgDOB").Caption = "Changed Subscriber DOB"
                C1dgPatientDetails.Cols("sSubscriberDemoChgSSN").Caption = "Changed Subscriber SSN"
                C1dgPatientDetails.Cols("sSubscriberDemoChgAddress1").Caption = "Changed Subscriber Address1"
                C1dgPatientDetails.Cols("sSubscriberDemoChgAddress2").Caption = "Changed Subscriber Address2"
                C1dgPatientDetails.Cols("sSubscriberDemoChgCity").Caption = "Changed Subscriber City"
                C1dgPatientDetails.Cols("sSubscriberDemoChgState").Caption = "Changed Subscriber State"
                C1dgPatientDetails.Cols("sSubscriberDemoChgZip").Caption = "Changed Subscriber Zip"

                If dt.Rows.Count > 0 Then
                    Dim IsFound As Boolean = False
                    For i As Integer = 0 To C1dgPatientDetails.Cols.Count - 1
                        IsFound = False
                        For j As Integer = 1 To C1dgPatientDetails.Rows.Count - 1
                            If C1dgPatientDetails.GetData(j, i).ToString().Trim() <> "" Then
                                IsFound = True
                                Exit For
                            End If
                        Next
                        If IsFound = False Then
                            C1dgPatientDetails.Cols(i).Visible = False
                        End If
                    Next
                End If

            Else
                C1dgPatientDetails.Rows.Count = 1
            End If
        Catch ex As Exception
        Finally
            If Not IsNothing(oClsRxHubInterface) Then
                oClsRxHubInterface.Dispose()  ''slr dispose
                oClsRxHubInterface = Nothing
            End If
            If Not IsNothing(oEligibilityCheck) Then
                oEligibilityCheck.Dispose()   ''slr dispose
                oEligibilityCheck = Nothing
            End If
            If Not IsNothing(dt) Then
                dt = Nothing
            End If
        End Try
    End Sub

    Private Sub DesignCategorisedDocument(ByVal DesignControl As C1FlexGrid)

        With DesignControl
            .AllowSorting = AllowSortingEnum.None
            .Visible = True
            .BringToFront()
            .Cols.Count = Col_view_Count
            .Rows.Count = 1
            .Rows.Fixed = 1
            .Cols.Fixed = 0


            .Cols(COL_D_CAT_CATEGORY).Width = 0                 ' ID
            .Cols(COL_D_CAT_NAME).Width = 0    '225             ' Name
            .Cols(COL_D_CAT_NOTEFLAG).Width = 0 '15          ' Note Flag
            .Cols(COL_D_CAT_EXTRAFLAG).Width = 0          ' Extra Col
            .Cols(COL_D_CAT_SOURCEMACHINE).Width = 0      ' Source Machine
            .Cols(COL_D_CAT_SYSTEMFOLDER).Width = 0       ' System Folder
            .Cols(COL_D_CAT_CONTAINER).Width = 0          ' Container
            .Cols(COL_D_CAT_CATEGORY).Width = 0           ' Category
            .Cols(COL_D_CAT_PATIENTID).Width = 0          ' Patient ID
            .Cols(COL_D_CAT_YEAR).Width = 0               ' Year
            .Cols(COL_D_CAT_MONTH).Width = 0              ' Month
            .Cols(COL_D_CAT_SOURCEBIN).Width = 0          ' Source Bin
            .Cols(COL_D_CAT_INUSED).Width = 0             ' In Used
            .Cols(COL_D_CAT_USEDMACHINE).Width = 0        ' Used Machine
            .Cols(COL_D_CAT_USEDTYPE).Width = 0           ' Used Type
            .Cols(COL_D_CAT_PATH).Width = 0               ' Path
            .Cols(COL_D_CAT_FILENAME).Width = 0           ' File Name
            .Cols(COL_D_CAT_MACHINEID).Width = 0               ' Machine ID
            .Cols(COL_D_CAT_COLTYPE).Width = 0           ' Col Type
            .Cols(COL_D_CAT_VERSIONNO).Width = 0           ' Version No
            .Cols(COL_D_CAT_MACHINEID).Width = 0               ' Machine ID
            .Cols(COL_D_CAT_COLTYPE).Width = 0           ' Col Type
            .Cols(COL_D_CAT_REVIWEDFLAG).Width = 0 '15           ' Col Type

            ''Pramod 06162007 View Documents START

            Dim _width As Integer = pnlPatientDetail.Width
            'Change for resolving case no GLO2009-0003377
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If
            .Cols(COL_View_CategoryHidden).Width = _width * 0
            .Cols(COL_View_Category).Width = _width * 0.47  ' Category Name
            .Cols(COL_View_Month).Width = _width * 0          'Month
            .Cols(COL_View_DocumentName).Width = _width * 0.47   'Document Name 
            .Cols(COL_View_NOTEFLAG).Width = 18  'Acknowledgements 
            .Cols(COL_View_REVIWEDFLAG).Width = 18           'review
            ''Pramod 06162007 View Documents END

            .Cols(COL_D_CAT_ID).Visible = False           ' ID
            .Cols(COL_D_CAT_NAME).Visible = False 'True          ' Name
            .Cols(COL_D_CAT_NOTEFLAG).Visible = False 'True      ' Note Flag
            .Cols(COL_D_CAT_EXTRAFLAG).Visible = False    ' Extra Col
            .Cols(COL_D_CAT_SOURCEMACHINE).Visible = False ' Source Machine
            .Cols(COL_D_CAT_SYSTEMFOLDER).Visible = False ' System Folder
            .Cols(COL_D_CAT_CONTAINER).Visible = False    ' Container
            .Cols(COL_D_CAT_CATEGORY).Visible = False     ' Category
            .Cols(COL_D_CAT_PATIENTID).Visible = False    ' Patient ID
            .Cols(COL_D_CAT_YEAR).Visible = False         ' Year
            .Cols(COL_D_CAT_MONTH).Visible = False        ' Month
            .Cols(COL_D_CAT_SOURCEBIN).Visible = False    ' Source Bin
            .Cols(COL_D_CAT_INUSED).Visible = False       ' In Used
            .Cols(COL_D_CAT_USEDMACHINE).Visible = False  ' Used Machine
            .Cols(COL_D_CAT_USEDTYPE).Visible = False     ' Used Type
            .Cols(COL_D_CAT_PATH).Visible = False         ' Path
            .Cols(COL_D_CAT_FILENAME).Visible = False           ' File Name
            .Cols(COL_D_CAT_MACHINEID).Visible = False               ' Machine ID
            .Cols(COL_D_CAT_COLTYPE).Visible = False      ' Col Type
            .Cols(COL_D_CAT_VERSIONNO).Visible = False      ' Version No
            .Cols(COL_D_CAT_VERSIONNO).Visible = False      ' Col Type
            .Cols(COL_D_CAT_ISREVIWED).Visible = False      ' Col Type
            .Cols(COL_D_CAT_REVIWEDFLAG).Visible = False ' True      ' Col Type

            ''Pramod 06162007 View Documents START
            .Cols(COL_View_CategoryHidden).Visible = False

            .Cols(COL_View_Category).Visible = True       ' Category Name
            .Cols(COL_View_Category).AllowEditing = False


            .Cols(COL_View_Month).Visible = False          'Month
            .Cols(COL_View_Month).AllowEditing = False

            .Cols(COL_View_DocumentName).Visible = True   'Document Name  
            .Cols(COL_View_DocumentName).AllowEditing = False


            .Cols(COL_View_NOTEFLAG).Visible = True  'Acknowledgements 
            .Cols(COL_View_NOTEFLAG).AllowEditing = False


            .Cols(COL_View_REVIWEDFLAG).Visible = True           'review
            .Cols(COL_View_REVIWEDFLAG).AllowEditing = False

            .SetData(0, COL_View_CategoryHidden, "Category")
            .Cols(COL_View_CategoryHidden).TextAlign = TextAlignEnum.LeftCenter
            .SetData(0, COL_View_Category, "Category")
            .Cols(COL_View_Category).TextAlign = TextAlignEnum.LeftCenter
            .Cols(COL_View_Category).DataType = GetType(System.String)

            'Resolved Bug : 39495 
            .Cols(COL_D_CAT_YEAR).DataType = GetType(System.String)

            'Resolved Bug : 42405 
            .Cols(COL_D_CAT_FILENAME).DataType = GetType(System.String)

            .SetData(0, COL_View_DocumentName, "Document Name")
            .Cols(COL_View_DocumentName).TextAlign = TextAlignEnum.GeneralCenter

        End With

    End Sub

    Private Sub Fill_Triage()
        Dim Col_TriagId As Integer = 0
        Dim Col_TemplateId As Integer = 1
        Dim Col_TemplatName As Integer = 2
        Dim Col_Date As Integer = 3
        Dim Col_ISFinished As Integer = 4
        Dim oClsTriage As New gloStream.gloEMR.Triage.clsTriage
        Dim dt As DataTable ''slr new not needed 

        dt = oClsTriage.Fill_Triage(gnPatientID)
        oClsTriage = Nothing


        Dim dvFilter As DataView
        dvFilter = dt.DefaultView

        '' FILTER BY DATES '' 
        Dim strFilter As String = ""
        If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
            strFilter = "dtDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND dtDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "
        End If
        '' FILTER DATAVIEW ''
        If cmbStatus.Text <> "All" Then '' FILTER BOTH ''
            '' FILTER STATUS ''
            If strFilter.Trim() <> "" Then
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & " AND Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & " AND Finished = 'No' "
                End If

            Else
                If cmbStatus.Text = "Finished" Then
                    strFilter = strFilter & "  Finished = 'Yes' "
                ElseIf cmbStatus.Text = "UnFinished" Then
                    strFilter = strFilter & "  Finished = 'No' "
                End If

            End If

        End If

        If strFilter.Trim() <> "" Then
            dvFilter.RowFilter = strFilter
            dt = dvFilter.ToTable
        End If

        strFilter = Nothing

        With C1dgPatientDetails

            .AllowSorting = AllowSortingEnum.None
            .Visible = True
            .BringToFront()

            Dim nwidth As Integer = pnlPatientDetails.Width
            'For Resolving case no : GLO2009-0003377
            If nwidth < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                nwidth = Convert.ToInt32(c1dgPatientDetailSize)
            End If

            C1dgPatientDetails.Visible = True

            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.DataSource = dvFilter
            C1dgPatientDetails.Rows.Fixed = 1

            C1dgPatientDetails.Cols(Col_TriagId).Caption = "Triage ID"
            C1dgPatientDetails.Cols(Col_TemplateId).Caption = "Template ID"
            C1dgPatientDetails.Cols(Col_TemplatName).Caption = "Template Name"
            C1dgPatientDetails.Cols(Col_Date).Caption = "Date"
            C1dgPatientDetails.Cols(Col_ISFinished).Caption = "Finished"

            C1dgPatientDetails.Cols(Col_TriagId).Visible = False
            C1dgPatientDetails.Cols(Col_TemplateId).Visible = False
            C1dgPatientDetails.Cols(Col_TemplatName).Visible = True
            C1dgPatientDetails.Cols(Col_Date).Visible = True
            C1dgPatientDetails.Cols(Col_ISFinished).Visible = True
            ''

            .Cols(2).Width = nwidth / 3
            .Cols(3).Width = nwidth / 3
            .Cols(4).Width = nwidth / 3
            .Cols(0).Width = 0
            .Cols(1).Width = 0

            nwidth = Nothing

        End With
        ''end code

        Col_TriagId = Nothing
        Col_TemplateId = Nothing
        Col_TemplatName = Nothing
        Col_Date = Nothing
        Col_ISFinished = Nothing

        If Not IsNothing(dt) Then
            dt.Dispose()
            dt = Nothing
        End If

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Triage viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

    End Sub
    Public Sub ofrmPatientEducation_FormClosed(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosedEventArgs)
        Dim ofrmPatientEducation As frmPatientEducationPreview = Nothing
        Try
            ofrmPatientEducation = DirectCast(sender, frmPatientEducationPreview)
        Catch ex As Exception

        End Try

        Try
            If (IsNothing(ofrmPatientEducation) = False) Then
                RemoveHandler ofrmPatientEducation.FormClosed, AddressOf ofrmPatientEducation_FormClosed
            End If

        Catch ex As Exception

        End Try

        Try
            If (IsNothing(ofrmPatientEducation) = False) Then
                ofrmPatientEducation.Close()
            End If

        Catch ex As Exception

        End Try
        Try
            If (IsNothing(ofrmPatientEducation) = False) Then
                ofrmPatientEducation.Dispose()
                ofrmPatientEducation = Nothing
            End If
        Catch ex As Exception

        End Try
        Fill_Patienteducation()
    End Sub
    Public Sub ofrmInfoButton_FormClosed(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosedEventArgs)
        Dim ofrmInfoButton As gloEMRGeneralLibrary.frmInfoButtonBrowser = Nothing

        Try
            ofrmInfoButton = DirectCast(sender, gloEMRGeneralLibrary.frmInfoButtonBrowser)
        Catch ex As Exception

        End Try

        Try
            If (IsNothing(ofrmInfoButton) = False) Then
                RemoveHandler ofrmInfoButton.FormClosed, AddressOf ofrmInfoButton_FormClosed
            End If

        Catch ex As Exception

        End Try

        Try
            If (IsNothing(ofrmInfoButton) = False) Then
                ofrmInfoButton.Close()
            End If

        Catch ex As Exception

        End Try
        Try
            If (IsNothing(ofrmInfoButton) = False) Then
                ofrmInfoButton.Dispose()
                ofrmInfoButton = Nothing
            End If
        Catch ex As Exception

        End Try
        Fill_Patienteducation()
    End Sub
    Private Sub Fill_Patienteducation()
        Try

            Dim cls As New clsPatientEducation
            Dim dt As DataTable ''slr new not needed 
            dt = cls.GetAllEducations(gnPatientID).Table()

            cls = Nothing

            Dim dvFilter As DataView  ''slr new not needed 
            dvFilter = dt.DefaultView

            '' FILTER BY DATES '' 
            Dim strFilter As String = ""
            If (chkenbdate.Visible = True) AndAlso (chkenbdate.Checked = True) Then
                strFilter = "VisitDate >=  '" & dtpFromDate.Value.Date & " 12:00:00 AM" & "' AND VisitDate <= '" & dtpToDate.Value.Date & " 11:59:59 PM" & "' "

                dvFilter.RowFilter = strFilter
                dt = dvFilter.ToTable
            End If

            strFilter = Nothing

            C1dgPatientDetails.DataSource = dt.DefaultView
            C1dgPatientDetails.Cols("nEducationID").Caption = "Education ID"
            C1dgPatientDetails.Cols("sTemplateName").Caption = "Education"
            C1dgPatientDetails.Cols("nVisitID").Caption = "Visit ID"
            C1dgPatientDetails.Cols("VisitDate").Caption = "Date"
            C1dgPatientDetails.Cols("Source").Caption = "Source"
            C1dgPatientDetails.Cols("Resource_Category").Caption = "Resource Category"
            C1dgPatientDetails.Cols("Resource_Type").Caption = "Resource Type"
            C1dgPatientDetails.Cols("sDocumentURL").Caption = "Document URL"


            C1dgPatientDetails.AllowEditing = False

            Dim _width As Integer = pnlPatientDetail.Width
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If

            C1dgPatientDetails.Cols("nEducationID").Width = 0
            C1dgPatientDetails.Cols("sTemplateName").Width = _width * 0.3
            C1dgPatientDetails.Cols("nVisitID").Width = 0
            C1dgPatientDetails.Cols("VisitDate").Width = _width * 0.3
            C1dgPatientDetails.Cols("Source").Width = _width * 0.3
            C1dgPatientDetails.Cols("Resource_Category").Width = 0
            C1dgPatientDetails.Cols("Resource_Type").Width = 0
            C1dgPatientDetails.Cols("sDocumentURL").Width = 0
            C1dgPatientDetails.Cols("Src").Visible = False
            C1dgPatientDetails.Cols("ResCat").Visible = False
            C1dgPatientDetails.Cols("ResType").Visible = False
            _width = Nothing

            dt.Dispose()
            dt = Nothing

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient education viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception

        Finally

        End Try

    End Sub

    ''Dhruv - To show the soap templates in the grid
    Private Sub Fill_NewExams()

        Dim dtFiltered As DataTable ''slr new not needed 
        Dim objPatientDetail As New clsPatientDetails
        ''Bug #84149: CR00000379: New exam enhancement
        Dim nSelectedProviderId As Long = 0
        If cmbProvider.Items.Count > 0 Then
            nSelectedProviderId = cmbProvider.SelectedValue
        End If
        'Changes for new Template Category parameter
        Dim nSelectedCategoryId As Long = 0
        If cmbTemplateSpeciality.Items.Count > 0 Then
            nSelectedCategoryId = cmbTemplateSpeciality.SelectedValue
        End If

        dtFiltered = objPatientDetail.Fill_NewExams(nSelectedProviderId, nSelectedCategoryId)

        objPatientDetail.Dispose()
        objPatientDetail = Nothing

        C1dgPatientDetails.DataSource = dtFiltered.DefaultView
        'Incident 00005646 : System Hangs-up in exam opens from Dashboard PatientDetails Panel.
        'Following Property set to false to avoid two tooltips showing on grid.
        C1dgPatientDetails.ShowCellLabels = False

        ''Columns to be visible
        C1dgPatientDetails.Cols("nTemplateId").Visible = False
        C1dgPatientDetails.Cols("sTemplateName").Visible = True

        ''Width
        Dim _width As Integer = (C1dgPatientDetails.Width - 15) / 10
        If _width < ((Convert.ToInt32(c1dgPatientDetailSize) - 15) / 10) AndAlso c1dgPatientDetailSize <> Nothing Then
            _width = ((Convert.ToInt32(c1dgPatientDetailSize) - 15) / 10)
        End If

        ''Column width
        C1dgPatientDetails.Cols("nTemplateId").Width = 0
        C1dgPatientDetails.Cols("sTemplateName").Width = _width * 7

        _width = Nothing

        ''column for the Editing purpose
        C1dgPatientDetails.Cols(0).AllowEditing = False
        C1dgPatientDetails.Cols(1).AllowEditing = False

        ''Column Caption
        C1dgPatientDetails.Cols("nTemplateId").Caption = "TemplateID"
        C1dgPatientDetails.Cols("sTemplateName").Caption = "Template Name"

        dtFiltered.Dispose()
        dtFiltered = Nothing

        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patients New Exams of the category new viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

    End Sub

    Private Sub Fill_PriorAuthorization(ByVal PatientId As Int64)

        C1dgPatientDetails.DataSource = Nothing
        C1dgPatientDetails.Clear()

        C1dgPatientDetails.Cols.Count = 13
        C1dgPatientDetails.Rows.Count = 1
        C1dgPatientDetails.SetData(0, 0, "PriorAuthorizationID")
        C1dgPatientDetails.SetData(0, 1, "Auth #")
        C1dgPatientDetails.SetData(0, 2, "Referring")
        C1dgPatientDetails.SetData(0, 3, "Insurance")
        C1dgPatientDetails.SetData(0, 4, "ReferralID")
        C1dgPatientDetails.SetData(0, 5, "IsTrackAuthLimit")
        C1dgPatientDetails.SetData(0, 6, "Note")
        C1dgPatientDetails.SetData(0, 7, "Start")
        C1dgPatientDetails.SetData(0, 8, "Expiration")
        C1dgPatientDetails.SetData(0, 9, "#Visits Allowed")
        C1dgPatientDetails.SetData(0, 10, "PatientName")
        C1dgPatientDetails.SetData(0, 11, "Visits Remain")
        C1dgPatientDetails.SetData(0, 12, "IsInActive")

        C1dgPatientDetails.Cols(0).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(2).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(3).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(4).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(5).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(6).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(7).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(8).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(9).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(10).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(11).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(12).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter

        C1dgPatientDetails.Cols(0).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(2).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(3).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(4).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(5).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(6).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(7).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(8).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(9).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(10).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(11).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(12).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter

        C1dgPatientDetails.Cols(0).AllowEditing = False
        C1dgPatientDetails.Cols(1).AllowEditing = False
        C1dgPatientDetails.Cols(2).AllowEditing = False
        C1dgPatientDetails.Cols(3).AllowEditing = False
        C1dgPatientDetails.Cols(4).AllowEditing = False
        C1dgPatientDetails.Cols(5).AllowEditing = False
        C1dgPatientDetails.Cols(6).AllowEditing = False
        C1dgPatientDetails.Cols(7).AllowEditing = False
        C1dgPatientDetails.Cols(8).AllowEditing = False
        C1dgPatientDetails.Cols(9).AllowEditing = False
        C1dgPatientDetails.Cols(10).AllowEditing = False
        C1dgPatientDetails.Cols(11).AllowEditing = False
        C1dgPatientDetails.Cols(12).AllowEditing = False

        C1dgPatientDetails.Cols(0).Visible = False
        C1dgPatientDetails.Cols(4).Visible = False
        C1dgPatientDetails.Cols(5).Visible = False
        C1dgPatientDetails.Cols(9).Visible = False
        C1dgPatientDetails.Cols(10).Visible = False
        C1dgPatientDetails.Cols(12).Visible = False

        C1dgPatientDetails.Cols(1).Width = 100
        C1dgPatientDetails.Cols(2).Width = 125
        C1dgPatientDetails.Cols(3).Width = 125
        C1dgPatientDetails.Cols(4).Width = 0
        C1dgPatientDetails.Cols(5).Width = 0
        C1dgPatientDetails.Cols(6).Width = 225
        C1dgPatientDetails.Cols(7).Width = 75
        C1dgPatientDetails.Cols(8).Width = 75
        C1dgPatientDetails.Cols(9).Width = 0
        C1dgPatientDetails.Cols(10).Width = 110
        C1dgPatientDetails.Cols(11).Width = 100
        C1dgPatientDetails.Cols(12).Width = 125
        'End If

        Dim ogloPatient As gloPatient.gloPatient = New gloPatient.gloPatient(GetConnectionString())
        Try
            Dim dtTransaction As DataTable = Nothing

            dtTransaction = ogloPatient.GetPatientPriorAuthorization(PatientId, gnClinicID, gloDateMaster.gloDate.DateAsNumber(DateTime.Now.ToString()))

            ogloPatient.Dispose()
            ogloPatient = Nothing


            If Not IsNothing(dtTransaction) Then
                If dtTransaction.Rows.Count > 0 Then

                    For i As Integer = 0 To dtTransaction.Rows.Count - 1

                        C1dgPatientDetails.Rows.Add()
                        Dim RowIndex As Int32 = C1dgPatientDetails.Rows.Count - 1

                        C1dgPatientDetails.SetData(RowIndex, 0, dtTransaction.Rows(i)("nPriorAuthorizationID").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 1, dtTransaction.Rows(i)("sPriorAuthorizationNo").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 2, dtTransaction.Rows(i)("sReferralName").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 3, dtTransaction.Rows(i)("sInsuranceName").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 4, dtTransaction.Rows(i)("nReferralID").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 5, dtTransaction.Rows(i)("bIsTrackAuthLimit").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 6, dtTransaction.Rows(i)("sAuthorizationNote").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 7, dtTransaction.Rows(i)("nStartDate").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 8, dtTransaction.Rows(i)("nExpDate").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 9, dtTransaction.Rows(i)("nVisitsAllowed").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 10, dtTransaction.Rows(i)("PatientName").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 11, dtTransaction.Rows(i)("VisitsRemained").ToString())
                        C1dgPatientDetails.SetData(RowIndex, 12, dtTransaction.Rows(i)("bIsInActive").ToString())

                        RowIndex = Nothing

                    Next
                End If
            End If
            C1dgPatientDetails.Cols(0).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(2).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(3).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(4).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(5).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(6).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(7).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(8).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(9).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(10).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(11).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(12).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter

            If Not IsNothing(dtTransaction) Then   ''slr free dttransaction
                dtTransaction.Dispose()
                dtTransaction = Nothing
            End If
            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Patient Prior Authorization viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub Fill_PatientTasks(ByVal PatientId As Int64)
        Dim dtTask As DataTable = Nothing ''slr new not needed 
        Dim ogloTasks As New gloTaskMail.gloTask(GetConnectionString)
        Try

            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.Clear()


            C1dgPatientDetails.Cols.Count = 18
            C1dgPatientDetails.Rows.Count = 1
            C1dgPatientDetails.SetData(0, Col_View_taskID, "TaskID")
            C1dgPatientDetails.SetData(0, Col_View_PriorityID, "PriorityID")
            C1dgPatientDetails.SetData(0, Col_View_FollowUpID, "FollowUpID")
            C1dgPatientDetails.SetData(0, Col_View_Priority, "")
            C1dgPatientDetails.SetData(0, Col_View_Subject, "Subject")
            C1dgPatientDetails.SetData(0, Col_View_Owner, "Owner")
            C1dgPatientDetails.SetData(0, Col_View_Status, "Status")
            C1dgPatientDetails.SetData(0, Col_View_DueDate, "Due Date")
            C1dgPatientDetails.SetData(0, Col_View_startdate, "Start Date")
            C1dgPatientDetails.SetData(0, Col_View_ProviderName, "Provider")
            C1dgPatientDetails.SetData(0, Col_View_Description, "Description")
            C1dgPatientDetails.SetData(0, Col_View_Followup, "")
            C1dgPatientDetails.SetData(0, Col_View_UserID, "UserID")
            C1dgPatientDetails.SetData(0, Col_View_OwnerID, "OwnerID")
            C1dgPatientDetails.SetData(0, Col_View_TaskGroupID, "nTaskGroupID")
            C1dgPatientDetails.SetData(0, Col_ViewTask_TAKEID, "bisOwner")
            C1dgPatientDetails.SetData(0, Col_ViewTask_OwnerAssigned, "bIsOwnerAssigned")
            C1dgPatientDetails.SetData(0, Col_ViewTask_Resp, "Resp")

            C1dgPatientDetails.Cols(Col_View_taskID).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_FollowUpID).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_PriorityID).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_Priority).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.GeneralCenter
            C1dgPatientDetails.Cols(Col_View_Subject).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_Owner).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_Status).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_DueDate).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_startdate).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_ProviderName).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_Description).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_Followup).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_UserID).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_View_OwnerID).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(Col_ViewTask_Resp).ImageAlign = C1.Win.C1FlexGrid.TextAlignEnum.CenterCenter


            C1dgPatientDetails.Cols(Col_View_taskID).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_FollowUpID).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_PriorityID).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_Priority).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_Subject).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_Owner).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_Status).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_DueDate).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_startdate).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_ProviderName).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_Description).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_Followup).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_UserID).AllowEditing = False
            C1dgPatientDetails.Cols(Col_View_OwnerID).AllowEditing = False
            C1dgPatientDetails.Cols(Col_ViewTask_TAKEID).AllowEditing = False
            C1dgPatientDetails.Cols(Col_ViewTask_OwnerAssigned).AllowEditing = False
            C1dgPatientDetails.Cols(Col_ViewTask_Resp).AllowEditing = False


            C1dgPatientDetails.Cols(Col_View_taskID).Visible = False
            C1dgPatientDetails.Cols(Col_View_FollowUpID).Visible = False
            C1dgPatientDetails.Cols(Col_View_PriorityID).Visible = False
            C1dgPatientDetails.Cols(Col_ViewTask_TAKEID).Visible = False
            C1dgPatientDetails.Cols(Col_ViewTask_OwnerAssigned).Visible = False
            C1dgPatientDetails.Cols(Col_View_TaskGroupID).Visible = False



            C1dgPatientDetails.Cols(Col_View_taskID).Width = 0
            C1dgPatientDetails.Cols(Col_View_FollowUpID).Width = 0
            C1dgPatientDetails.Cols(Col_View_PriorityID).Width = 0
            C1dgPatientDetails.Cols(Col_View_Priority).Width = 15
            C1dgPatientDetails.Cols(Col_View_Subject).Width = 180
            C1dgPatientDetails.Cols(Col_View_Owner).Width = 50
            C1dgPatientDetails.Cols(Col_View_Status).Width = 100
            C1dgPatientDetails.Cols(Col_View_DueDate).Width = 70
            C1dgPatientDetails.Cols(Col_View_startdate).Width = 70
            C1dgPatientDetails.Cols(Col_View_ProviderName).Width = 100
            C1dgPatientDetails.Cols(Col_View_Description).Width = 320
            C1dgPatientDetails.Cols(Col_View_Followup).Width = 22
            C1dgPatientDetails.Cols(Col_View_UserID).Width = 0
            C1dgPatientDetails.Cols(Col_View_OwnerID).Width = 0
            C1dgPatientDetails.Cols(Col_ViewTask_TAKEID).Width = 0
            C1dgPatientDetails.Cols(Col_ViewTask_OwnerAssigned).Width = 0
            C1dgPatientDetails.Cols(Col_ViewTask_Resp).Width = 40
            C1dgPatientDetails.Cols(Col_View_TaskGroupID).Width = 0


            C1dgPatientDetails.Cols(Col_View_Priority).AllowResizing = False
            C1dgPatientDetails.Cols(Col_View_Followup).AllowResizing = False
            C1dgPatientDetails.Redraw = False
            dtTask = ogloTasks.GetPatientTasksList(PatientId)
            If (IsNothing(dtTask) = False) Then


                If dtTask.Rows.Count > 0 Then
                    Dim csSubject As C1.Win.C1FlexGrid.CellStyle
                    Try
                        If (C1dgPatientDetails.Styles.Contains("cs_Subject")) Then
                            csSubject = C1dgPatientDetails.Styles("cs_Subject")
                        Else
                            csSubject = C1dgPatientDetails.Styles.Add("cs_Subject") ''style new for every row
                            csSubject.Font = gloGlobal.clsgloFont.gFont_STRIKEOUT 'New System.Drawing.Font("Tahoma", 9, System.Drawing.FontStyle.Strikeout, System.Drawing.GraphicsUnit.Point, CByte(0))

                        End If
                    Catch ex As Exception
                        csSubject = C1dgPatientDetails.Styles.Add("cs_Subject") ''style new for every row
                        csSubject.Font = gloGlobal.clsgloFont.gFont_STRIKEOUT 'New System.Drawing.Font("Tahoma", 9, System.Drawing.FontStyle.Strikeout, System.Drawing.GraphicsUnit.Point, CByte(0))

                    End Try



                    For i As Integer = 0 To dtTask.Rows.Count - 1

                        C1dgPatientDetails.Rows.Add()
                        Dim RowIndex As Int32 = C1dgPatientDetails.Rows.Count - 1

                        C1dgPatientDetails.SetData(RowIndex, Col_View_taskID, dtTask.Rows(i)("TaskID").ToString())
                        C1dgPatientDetails.SetData(RowIndex, Col_View_PriorityID, dtTask.Rows(i)("PriorityID").ToString())
                        C1dgPatientDetails.SetData(RowIndex, Col_View_FollowUpID, dtTask.Rows(i)("FollowUpID").ToString())
                        Select Case dtTask.Rows(i)("Priority").ToString()
                            Case "High Priority"
                                C1dgPatientDetails.SetCellImage(RowIndex, Col_View_Priority, Imgts_PatientDetails.Images(53))
                                C1dgPatientDetails.SetData(RowIndex, Col_View_Priority, "High Priority")
                            Case "Normal Priority"

                            Case "Low Priority"
                                C1dgPatientDetails.SetCellImage(RowIndex, Col_View_Priority, Imgts_PatientDetails.Images(52))
                                C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, Col_View_Priority, "Low Priority")
                            Case Else
                                '' Default Normal
                                'C1dgPatientDetails.SetCellImage(RowIndex, 3, imgList_Common.Images(1))
                                'C1dgPatientDetails.SetData(C1dgPatientDetails.Rows.Count - 1, 3, "Normal Priority")
                        End Select
                        ''added if condition to check task ownership if groupid is zero then it is single user task 
                        If (dtTask.Rows(i)("TaskGroupID").ToString() = "0") Then
                            C1dgPatientDetails.SetCellImage(RowIndex, Col_ViewTask_Resp, My.Resources.Task_Single.ToBitmap())
                        End If
                        If (((dtTask.Rows(i)("bIsOwnerAssigned")) = "True") And (dtTask.Rows(i)("bisOwner")) = "True") Then  ''task owner

                            C1dgPatientDetails.SetCellImage(RowIndex, Col_ViewTask_Resp, My.Resources.Task_Owner.ToBitmap())
                        End If
                        If (((dtTask.Rows(i)("bIsOwnerAssigned")) = "True") And (dtTask.Rows(i)("bisOwner")) = "False") Then  ''task own by other preson of same group

                            C1dgPatientDetails.SetCellImage(RowIndex, Col_ViewTask_Resp, My.Resources.Task_OtherTaken.ToBitmap())
                        End If
                        If (((dtTask.Rows(i)("bIsOwnerAssigned")) = "False") And (dtTask.Rows(i)("bisOwner")) = "False" And (dtTask.Rows(i)("TaskGroupID").ToString() <> "0")) Then '' task assign to group, yet no one has taken ownership

                            C1dgPatientDetails.SetCellImage(RowIndex, Col_ViewTask_Resp, My.Resources.Task_NoOwner.ToBitmap())
                        End If

                        C1dgPatientDetails.SetData(RowIndex, Col_View_Subject, dtTask.Rows(i)("Subject").ToString())
                        C1dgPatientDetails.SetData(RowIndex, Col_View_Owner, dtTask.Rows(i)("Owner").ToString())
                        C1dgPatientDetails.SetData(RowIndex, Col_View_DueDate, dtTask.Rows(i)("DueDate").ToString())
                        C1dgPatientDetails.SetData(RowIndex, Col_View_startdate, dtTask.Rows(i)("StartDate").ToString())
                        C1dgPatientDetails.SetData(RowIndex, Col_View_ProviderName, dtTask.Rows(i)("ProviderName").ToString())
                        C1dgPatientDetails.SetData(RowIndex, Col_View_Description, dtTask.Rows(i)("Description").ToString())
                        C1dgPatientDetails.SetData(RowIndex, Col_View_Status, dtTask.Rows(i)("Status").ToString())
                        If dtTask.Rows(i)("Status").ToString() = "Completed" Then
                            C1dgPatientDetails.Rows(RowIndex).Style = csSubject
                        End If
                        Select Case dtTask.Rows(i)("Followup").ToString()
                            Case "Today"
                                C1dgPatientDetails.SetCellImage(RowIndex, Col_View_Followup, Imgts_PatientDetails.Images(48))
                                C1dgPatientDetails.SetData(RowIndex, Col_View_Followup, dtTask.Rows(i)("Followup").ToString())
                            Case "Tomorrow"
                                C1dgPatientDetails.SetCellImage(RowIndex, Col_View_Followup, Imgts_PatientDetails.Images(49))
                                C1dgPatientDetails.SetData(RowIndex, Col_View_Followup, dtTask.Rows(i)("Followup").ToString())
                            Case "No Date"
                                C1dgPatientDetails.SetCellImage(RowIndex, Col_View_Followup, Imgts_PatientDetails.Images(50))
                                C1dgPatientDetails.SetData(RowIndex, Col_View_Followup, dtTask.Rows(i)("Followup").ToString())
                            Case Else
                                C1dgPatientDetails.SetCellImage(RowIndex, Col_View_Followup, Imgts_PatientDetails.Images(51))
                                C1dgPatientDetails.SetData(RowIndex, Col_View_Followup, dtTask.Rows(i)("Followup").ToString())
                        End Select
                    Next
                End If
            End If
            C1dgPatientDetails.Redraw = True

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient Tasks information viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

            If Not IsNothing(dtTask) Then
                dtTask.Dispose()
                dtTask = Nothing
            End If

            If Not IsNothing(ogloTasks) Then
                ogloTasks.Dispose()
                ogloTasks = Nothing
            End If

        End Try
    End Sub
    ''code added for new order tab added 
    Private Sub FillOrder()

        'Dim dt As DataTable
        Try

            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.Clear(ClearFlags.All)

            C1dgPatientDetails.Cols.Count = 16

            C1dgPatientDetails.Rows.Count = 1
            '    C1dgPatientDetails.Clear()


            ' setfont
            C1dgPatientDetails.Font = gloGlobal.clsgloFont.gFont 'New System.Drawing.Font("Tahoma", 9, FontStyle.Regular)
            C1dgPatientDetails.SelectionMode = C1.Win.C1FlexGrid.SelectionModeEnum.Row
            C1dgPatientDetails.BackColor = Color.White
            C1dgPatientDetails.AllowSorting = C1.Win.C1FlexGrid.AllowSortingEnum.None

            C1dgPatientDetails.SetData(0, 0, "Order No")
            C1dgPatientDetails.SetData(0, 1, "Order #")
            C1dgPatientDetails.SetData(0, 2, "Order ID")
            C1dgPatientDetails.SetData(0, 3, "Reference #")

            C1dgPatientDetails.SetData(0, 4, "Order Date")
            C1dgPatientDetails.SetData(0, 5, "Order Status")
            C1dgPatientDetails.SetData(0, 6, "Billing Type")
            C1dgPatientDetails.SetData(0, 7, "Provider Name")
            C1dgPatientDetails.SetData(0, 8, "Results")
            C1dgPatientDetails.SetData(0, 9, "Acknowledged")
            C1dgPatientDetails.SetData(0, 10, "Locked")
            C1dgPatientDetails.SetData(0, 11, "MACHINENAME")
            C1dgPatientDetails.SetData(0, 12, "HasResult_Value")
            C1dgPatientDetails.SetData(0, 13, "HasAkw_Value")
            C1dgPatientDetails.SetData(0, 14, "Electronic Order Status") ' by Abhijeet on date 20100330
            C1dgPatientDetails.SetData(0, 15, "Order Comments") '20140407 manoj PRD: View Lab Order Comments: added New column

            C1dgPatientDetails.Cols(3).TextAlign = TextAlignEnum.LeftCenter '20140826 v8030: manoj Jadhav: lab refrance number set as left align 

            C1dgPatientDetails.Cols(0).Width = 0
            C1dgPatientDetails.Cols(2).Width = 0
            C1dgPatientDetails.Cols(10).Width = 0
            C1dgPatientDetails.Cols(11).Width = 0
            C1dgPatientDetails.Cols(12).Width = 0
            C1dgPatientDetails.Cols(13).Width = 0

            C1dgPatientDetails.Cols(4).Width = 150
            C1dgPatientDetails.Cols(5).Width = 150
            C1dgPatientDetails.Cols(7).Width = 150
            C1dgPatientDetails.Cols(15).Width = 0 '20140407 manoj PRD: View Lab Order Comments: added New column
            C1dgPatientDetails.Cols(15).Visible = False '20140407 manoj PRD: View Lab Order Comments: added New column
            C1dgPatientDetails.ExtendLastCol = True
            Dim wdth As Integer = C1dgPatientDetails.Width
            fillOpenOrdsGrid_New()
            If C1dgPatientDetails.Rows.Count > 1 Then  ''added for bugid 70607 ,by default selecting first row 
                If C1dgPatientDetails.RowSel = -1 Then
                    C1dgPatientDetails.Select(1, 0)
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try


    End Sub

    ''code added for order PRD 8020 new order tab added 
    Private Sub fillOpenOrdsGrid_New()
        Dim dt As DataTable = Nothing
        Dim rowsCountToDisplay As Int32 = 0
        Dim iRow1 As Int32 = 0
        Dim ordRowNo As Int32 = 0
        C1dgPatientDetails.BeginUpdate()
        Try


            dt = GetOrderby_PatientID(gnPatientID)

            If (IsNothing(dt) = False) Then



                If dt.Rows.Count > 0 Then
                    Dim iRow As Integer
                    For iRow = iRow1 To dt.Rows.Count - 1 Step iRow + 1 'SLR: is the step ok? 1 or irow+1 : I am confused.

                        C1dgPatientDetails.Rows.Add()
                        Dim _Row As Int32 = C1dgPatientDetails.Rows.Count - 1
                        C1dgPatientDetails.SetData(_Row, 0, dt.Rows(iRow)("labom_OrderNoID").ToString()) '' Order No
                        C1dgPatientDetails.SetData(_Row, 1, dt.Rows(iRow)("PrfixID").ToString())   ''Order #"

                        C1dgPatientDetails.SetData(_Row, 2, dt.Rows(iRow)("labom_OrderID").ToString())  ''Order ID
                        C1dgPatientDetails.SetData(_Row, 4, dt.Rows(iRow)("labom_OrderDate").ToString())  ''Order Date




                        Dim _strOrderStatus As String = Convert.ToString(dt.Rows(iRow)("labom_gloLabOrderStatus1"))
                        Dim _strBillingType As String = Convert.ToString(dt.Rows(iRow)("labom_gloLabOrderBillingType1"))


                        C1dgPatientDetails.SetData(_Row, 5, dt.Rows(iRow)("OrderStatus"))  ''Order Status
                        C1dgPatientDetails.SetData(_Row, 6, _strBillingType)   ''Billing Type
                        C1dgPatientDetails.SetData(_Row, 7, dt.Rows(iRow)("ProviderName").ToString()) ''Provider Name





                        Dim _nOrderID As Int64 = 0
                        Dim _OrderNumberPreFix As String = String.Empty

                        Dim _MachineName As String = String.Empty


                        _nOrderID = Convert.ToInt64(dt.Rows(iRow)("labom_OrderID").ToString())
                        _MachineName = Convert.ToString(dt.Rows(iRow)("labom_MachineName").ToString())

                        If _nOrderID <> 0 Then
                            C1dgPatientDetails.SetData(_Row, 8, Convert.ToInt64(dt.Rows(iRow)("IsResult")))  ''"Results")
                            If Convert.ToInt64(dt.Rows(iRow)("IsResult")) > 0 Then
                                C1dgPatientDetails.SetData(_Row, 8, "Yes")   ''gloEmdeonInterface.Properties.Resources.FlagAcknowledge1
                            Else
                                C1dgPatientDetails.SetData(_Row, 8, "No") ''gloEmdeonInterface.Properties.Resources.FlagNone
                            End If
                        End If

                        If Convert.ToInt64(dt.Rows(iRow)("IsAkw")) > 0 AndAlso Convert.ToInt64(dt.Rows(iRow)("bIsClosed")) > 0 Then ''"Acknowledged"
                            C1dgPatientDetails.SetData(_Row, 9, "Yes") ''gloEmdeonInterface.Properties.Resources.Yes
                        Else
                            C1dgPatientDetails.SetData(_Row, 9, "No")  ''gloEmdeonInterface.Properties.Resources.FlagNone
                        End If




                        If Convert.ToInt64(dt.Rows(iRow)("IsAkw")) > 0 AndAlso Convert.ToInt64(dt.Rows(iRow)("bIsClosed")) > 0 Then ''HasAkw_Value
                            C1dgPatientDetails.SetData(_Row, 13, Convert.ToInt64(dt.Rows(iRow)("IsAkw")))
                        Else
                            C1dgPatientDetails.SetData(_Row, 13, 0)
                        End If


                        C1dgPatientDetails.SetData(_Row, 14, _strOrderStatus)  ''Electronic Order status


                        _nOrderID = 0
                        _MachineName = String.Empty


                        'start of code commented by manoj jadhav on 20140527 for showing lab external code for hL7 orders
                        'If ConfirmNull(_strOrderStatus) And ConfirmNull(_strBillingType) Then

                        '    Dim _LabExternalCode As String = String.Empty

                        '    _LabExternalCode = Convert.ToString(dt.Rows(iRow)("labom_ExternalCode").ToString())

                        '    If ConfirmNull(_LabExternalCode) Then
                        '        C1dgPatientDetails.SetData(_Row, 3, _LabExternalCode.ToString())  ''"Reference 
                        '    End If

                        '    _LabExternalCode = String.Empty

                        'End If
                        'end of code commented by manoj jadhav on 20140527 for showing lab external code for hL7 orders

                        ''start of code added by manoj jadhav on 20140527 for showing lab external code for hL7 orders
                        'Dim _LabExternalCode As String = Convert.ToString(dt.Rows(iRow)("labom_ExternalCode"))

                        'If ConfirmNull(_LabExternalCode) Then

                        '    If ConfirmNull(_strBillingType) Then

                        '        If ConfirmNull(_strOrderStatus) Then
                        '            C1dgPatientDetails.SetData(_Row, 3, _LabExternalCode.ToString())  ''"Emdeon lab order Reference number
                        '        End If
                        '    Else
                        '        C1dgPatientDetails.SetData(_Row, 3, _LabExternalCode.ToString())  ''"HL7 order Reference number
                        '    End If
                        'End If

                        '_LabExternalCode = String.Empty
                        ''end of code added by manoj jadhav on 20140527 for showing lab external code for hL7 orders

                        C1dgPatientDetails.SetData(_Row, 3, Convert.ToString(dt.Rows(iRow)("labom_ExternalCode")).Trim())  ''"HL7 order Reference number

                        _strOrderStatus = String.Empty
                        _strBillingType = String.Empty

                        C1dgPatientDetails.SetData(_Row, 15, Convert.ToString(dt.Rows(iRow)("labom_LabComment"))) '20140407 manoj PRD: View Lab Order Comments: added New column

                    Next
                    C1dgPatientDetails_AfterSelChange(Nothing, Nothing) '20140407 manoj PRD: View Lab Order Comments: added Call to Method 
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        Finally
            If Not IsNothing(dt) Then
                dt.Dispose()
                dt = Nothing
            End If
        End Try
        C1dgPatientDetails.EndUpdate()
    End Sub
    ''code added for new order tab added 
    Private Function GetOrderby_PatientID(ByVal PatientID As Long) As DataTable
        Dim dt As DataTable = New DataTable()
        Dim obj As gloEMRGeneralLibrary.gloEMRLab.gloEMRLabOrder = New gloEMRGeneralLibrary.gloEMRLab.gloEMRLabOrder()
        Try
            Dim fromdate As String = ""
            Dim todate As String = ""
            Dim ack As String = ""
            If chkenbdate.Checked = True Then
                fromdate = dtpFromDate.Value.ToShortDateString()
                todate = dtpToDate.Value.ToShortDateString()
            End If
            ack = cmbProvider.Text.Trim()
            ''added for order PRD 8020
            dt = obj.GetOrder_ByPatientID(gnPatientID, fromdate, todate, ack)
            Return dt
        Catch 'exx As ExecutionEngineException
            Return Nothing
        Finally
            If Not dt Is Nothing Then
                dt.Dispose()
                dt = Nothing
            End If
            If Not obj Is Nothing Then
                obj.Dispose()
                obj = Nothing
            End If
        End Try
    End Function



    Private Sub FillCases(ByVal PatientID As Int64)

        C1dgPatientDetails.DataSource = Nothing
        C1dgPatientDetails.Clear()

        C1dgPatientDetails.Cols.Count = 13
        C1dgPatientDetails.Rows.Count = 1

        Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)

        Try
            Dim dtTransaction As DataTable = Nothing
            dtTransaction = ogloPatient.GetPatientCases(PatientID, gClinicID, gloDateMaster.gloDate.DateAsNumber(DateTime.Now.ToString()))

            C1dgPatientDetails.DataSource = dtTransaction
        Catch ex As Exception
            ex.ToString()
            ex = Nothing

        Finally

        End Try

        ogloPatient.Dispose()
        ogloPatient = Nothing

        C1dgPatientDetails.SetData(0, 0, "nid")
        C1dgPatientDetails.SetData(0, 1, "Case Name")
        C1dgPatientDetails.SetData(0, 2, "AccidentType")
        C1dgPatientDetails.SetData(0, 3, "Claim #")
        C1dgPatientDetails.SetData(0, 4, "Start Date")
        C1dgPatientDetails.SetData(0, 5, "End Date")
        C1dgPatientDetails.SetData(0, 6, "Diag")
        C1dgPatientDetails.SetData(0, 7, "Facility")
        C1dgPatientDetails.SetData(0, 8, "Auth #")
        C1dgPatientDetails.SetData(0, 9, "Referring Provider")
        C1dgPatientDetails.SetData(0, 10, "Rpt Category ")
        C1dgPatientDetails.SetData(0, 11, "Note")

        C1dgPatientDetails.Cols(0).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(2).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(3).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(4).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(5).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(6).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(7).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(8).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(9).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(10).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
        C1dgPatientDetails.Cols(11).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter

        C1dgPatientDetails.Cols(0).AllowEditing = False
        C1dgPatientDetails.Cols(1).AllowEditing = False
        C1dgPatientDetails.Cols(2).AllowEditing = False
        C1dgPatientDetails.Cols(3).AllowEditing = False
        C1dgPatientDetails.Cols(4).AllowEditing = False
        C1dgPatientDetails.Cols(5).AllowEditing = False
        C1dgPatientDetails.Cols(6).AllowEditing = False
        C1dgPatientDetails.Cols(7).AllowEditing = False
        C1dgPatientDetails.Cols(8).AllowEditing = False
        C1dgPatientDetails.Cols(9).AllowEditing = False
        C1dgPatientDetails.Cols(10).AllowEditing = False
        C1dgPatientDetails.Cols(11).AllowEditing = False


        C1dgPatientDetails.Cols(0).Visible = False

        C1dgPatientDetails.Cols(4).DataType = GetType(System.DateTime)
        C1dgPatientDetails.Cols(5).DataType = GetType(System.DateTime)
        C1dgPatientDetails.Cols(4).Format = "MM/dd/yyyy"
        C1dgPatientDetails.Cols(5).Format = "MM/dd/yyyy"

        Dim _designWidth As Boolean = False
        Try
            Dim oSetting As New gloSettings.GeneralSettings(GetConnectionString)
            _designWidth = oSetting.LoadGridColumnWidth(C1dgPatientDetails, gloSettings.ModuleOfGridColumn.DashBoardPatientCases, gloGlobal.gloPMGlobal.UserID)
            oSetting.Dispose()
            oSetting = Nothing
        Catch ex As Exception
            ex.ToString()
            ex = Nothing
        End Try
        If _designWidth = False Then
            Dim _width As Integer = (C1dgPatientDetails.Width - 60 \ 8)

            C1dgPatientDetails.Cols(1).Width = 175
            C1dgPatientDetails.Cols(2).Width = 75
            C1dgPatientDetails.Cols(3).Width = 75
            C1dgPatientDetails.Cols(4).Width = 75
            C1dgPatientDetails.Cols(5).Width = 75
            C1dgPatientDetails.Cols(6).Width = 175
            C1dgPatientDetails.Cols(7).Width = 140
            C1dgPatientDetails.Cols(8).Width = 75
            C1dgPatientDetails.Cols(9).Width = 140
            C1dgPatientDetails.Cols(10).Width = 100
            C1dgPatientDetails.Cols(11).Width = 100
        End If


    End Sub

    Private Sub Fill_Billing()
        Try

            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.Clear()

            C1dgPatientDetails.Cols.Count = 13
            C1dgPatientDetails.Rows.Count = 1

            C1dgPatientDetails.SetData(0, 0, "No.")
            C1dgPatientDetails.SetData(0, 1, "Date")
            C1dgPatientDetails.SetData(0, 2, "Claim No")
            C1dgPatientDetails.SetData(0, 3, "CPT")
            C1dgPatientDetails.SetData(0, 4, "Dx1")
            C1dgPatientDetails.SetData(0, 5, "Dx2")
            C1dgPatientDetails.SetData(0, 6, "Dx3")
            C1dgPatientDetails.SetData(0, 7, "Dx4")
            C1dgPatientDetails.SetData(0, 8, "Mod1")
            C1dgPatientDetails.SetData(0, 9, "Mod2")
            C1dgPatientDetails.SetData(0, 10, "Charges")
            C1dgPatientDetails.SetData(0, 11, "Total")
            C1dgPatientDetails.SetData(0, 12, "Unit")

            C1dgPatientDetails.Cols(0).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(2).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(3).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(4).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(5).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(6).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(7).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(8).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(9).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(10).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.RightCenter
            C1dgPatientDetails.Cols(11).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.RightCenter
            C1dgPatientDetails.Cols(12).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.RightCenter

            C1dgPatientDetails.Cols(0).AllowEditing = False
            C1dgPatientDetails.Cols(1).AllowEditing = False
            C1dgPatientDetails.Cols(2).AllowEditing = False
            C1dgPatientDetails.Cols(3).AllowEditing = False
            C1dgPatientDetails.Cols(4).AllowEditing = False
            C1dgPatientDetails.Cols(5).AllowEditing = False
            C1dgPatientDetails.Cols(6).AllowEditing = False
            C1dgPatientDetails.Cols(7).AllowEditing = False
            C1dgPatientDetails.Cols(8).AllowEditing = False
            C1dgPatientDetails.Cols(9).AllowEditing = False
            C1dgPatientDetails.Cols(10).AllowEditing = False
            C1dgPatientDetails.Cols(11).AllowEditing = False
            C1dgPatientDetails.Cols(12).AllowEditing = False

            C1dgPatientDetails.Cols(0).Visible = False

            Dim _width As Integer = pnlPatientDetail.Width
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If

            C1dgPatientDetails.Cols(0).Width = 0
            C1dgPatientDetails.Cols(1).Width = _width * 0.11
            C1dgPatientDetails.Cols(2).Width = _width * 0.1
            C1dgPatientDetails.Cols(3).Width = _width * 0.16
            C1dgPatientDetails.Cols(4).Width = _width * 0.1
            C1dgPatientDetails.Cols(5).Width = _width * 0.08
            C1dgPatientDetails.Cols(6).Width = _width * 0.08
            C1dgPatientDetails.Cols(7).Width = _width * 0.08
            C1dgPatientDetails.Cols(8).Width = _width * 0.08
            C1dgPatientDetails.Cols(9).Width = _width * 0.08
            C1dgPatientDetails.Cols(10).Width = _width * 0.08
            C1dgPatientDetails.Cols(11).Width = _width * 0.08
            C1dgPatientDetails.Cols(12).Width = _width * 0.08



            Dim ogloBilling As New gloBilling.gloBilling(GetConnectionString(), "")
            Dim dtTransaction As DataTable = ogloBilling.GetPatientTransactions(gnPatientID)

            If dtTransaction IsNot Nothing Then
                For i As Integer = 0 To dtTransaction.Rows.Count - 1
                    C1dgPatientDetails.Rows.Add()
                    Dim RowIndex As Int32 = C1dgPatientDetails.Rows.Count - 1

                    C1dgPatientDetails.SetData(RowIndex, 0, i)
                    C1dgPatientDetails.SetData(RowIndex, 1, gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtTransaction.Rows(i)("nFromDate"))))
                    C1dgPatientDetails.SetData(RowIndex, 2, dtTransaction.Rows(i)("nClaimNo").ToString().PadLeft(5, "0"c))
                    C1dgPatientDetails.SetData(RowIndex, 3, (dtTransaction.Rows(i)("sCPTCode").ToString() & "-") + dtTransaction.Rows(i)("sCPTDescription").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 4, dtTransaction.Rows(i)("sDx1Code").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 5, dtTransaction.Rows(i)("sDx2Code").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 6, dtTransaction.Rows(i)("sDx3Code").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 7, dtTransaction.Rows(i)("sDx4Code").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 8, dtTransaction.Rows(i)("sMod1Code").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 9, dtTransaction.Rows(i)("sMod2Code").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 10, dtTransaction.Rows(i)("dCharges").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 11, dtTransaction.Rows(i)("dTotal").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 12, dtTransaction.Rows(i)("dUnit").ToString())
                Next
            End If

            If Not IsNothing(dtTransaction) Then ''slr free dttransaction
                dtTransaction.Dispose()
                dtTransaction = Nothing
            End If

            If Not IsNothing(ogloBilling) Then  ''slr free oglobilling 
                ogloBilling.Dispose()
                ogloBilling = Nothing
            End If

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient billing information viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

        Catch ex As Exception
            MessageBox.Show(ex.Message(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try

    End Sub
    Private Sub FillPatientWorkerCompForms()
        Try

            C1dgPatientDetails.DataSource = Nothing


            C1dgPatientDetails.Clear()
            '/Set the column Names.                              
            C1dgPatientDetails.Cols.Count = 16
            C1dgPatientDetails.Rows.Count = 1

            'C1dgPatientDetails.SetData(0, 0, "FormId.");

            C1dgPatientDetails.SetData(0, 0, "Form ID")
            C1dgPatientDetails.SetData(0, 1, "Date Of Injury")
            C1dgPatientDetails.SetData(0, 2, "Form Type")
            C1dgPatientDetails.SetData(0, 3, "Patient ID")
            C1dgPatientDetails.SetData(0, 4, "Claim #")
            C1dgPatientDetails.SetData(0, 5, "DOS")
            C1dgPatientDetails.SetData(0, 6, "Close Date")
            C1dgPatientDetails.SetData(0, 7, "Created By")
            C1dgPatientDetails.SetData(0, 8, "Created On")
            C1dgPatientDetails.SetData(0, 9, "Modified By")
            C1dgPatientDetails.SetData(0, 10, "Modified On")
            C1dgPatientDetails.SetData(0, 11, "Exam ID")
            C1dgPatientDetails.SetData(0, 12, "ClaimTransactionMasterID")
            C1dgPatientDetails.SetData(0, 13, "ClaimTransactionID")
            C1dgPatientDetails.SetData(0, 14, "Last Modified By ID")
            C1dgPatientDetails.SetData(0, 15, "Form Type ID")

            C1dgPatientDetails.Cols(0).Visible = False
            C1dgPatientDetails.Cols(1).Visible = True
            C1dgPatientDetails.Cols(2).Visible = True
            C1dgPatientDetails.Cols(3).Visible = False
            C1dgPatientDetails.Cols(4).Visible = True
            C1dgPatientDetails.Cols(5).Visible = True
            C1dgPatientDetails.Cols(6).Visible = False
            C1dgPatientDetails.Cols(7).Visible = True
            C1dgPatientDetails.Cols(8).Visible = True
            C1dgPatientDetails.Cols(9).Visible = True
            C1dgPatientDetails.Cols(10).Visible = True
            C1dgPatientDetails.Cols(11).Visible = False
            C1dgPatientDetails.Cols(12).Visible = False
            C1dgPatientDetails.Cols(13).Visible = False
            C1dgPatientDetails.Cols(14).Visible = False
            C1dgPatientDetails.Cols(15).Visible = False

            For j As Integer = 0 To 15
                C1dgPatientDetails.Cols(j).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
                C1dgPatientDetails.Cols(j).AllowEditing = False
            Next
            C1dgPatientDetails.ExtendLastCol = True

            'C1dgPatientDetails.Cols[6].DataType = typeof(System.DateTime);
            'C1dgPatientDetails.Cols[6].Format = "MM/dd/yyyy";



            Dim _designWidth As Boolean = False
            'try
            '{
            '    gloSettings.GeneralSettings oSetting = new gloSettings.GeneralSettings(gloPMGlobal.DatabaseConnectionString);
            '    _designWidth = oSetting.LoadGridColumnWidth(C1dgPatientDetails, gloSettings.ModuleOfGridColumn.DashBoardPatientBilling, gloPMGlobal.UserID);
            '    oSetting.Dispose();
            '}
            'catch (Exception) // ex)
            '{

            '}
            If _designWidth = False Then
                'int _width = (C1dgPatientDetails.Width - 60) / 32;

                C1dgPatientDetails.Cols(0).Width = 100
                C1dgPatientDetails.Cols(1).Width = 100
                C1dgPatientDetails.Cols(2).Width = 80
                C1dgPatientDetails.Cols(3).Width = 90
                C1dgPatientDetails.Cols(4).Width = 80
                C1dgPatientDetails.Cols(5).Width = 100
                C1dgPatientDetails.Cols(6).Width = 150
                C1dgPatientDetails.Cols(7).Width = 100
                C1dgPatientDetails.Cols(8).Width = 100
                C1dgPatientDetails.Cols(9).Width = 100
                C1dgPatientDetails.Cols(10).Width = 100
                C1dgPatientDetails.Cols(11).Width = 150
                C1dgPatientDetails.Cols(12).Width = 150
                C1dgPatientDetails.Cols(13).Width = 150
                C1dgPatientDetails.Cols(14).Width = 150
                C1dgPatientDetails.Cols(15).Width = 10


            End If

            ' Retrieve Patient NY Forms list from the database for selected patient in Dashboard.
            Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
            Dim oDBParams As gloDatabaseLayer.DBParameters = Nothing
            Dim dtTransaction As DataTable = Nothing
            Try
                oDB.Connect(False)
                oDBParams = New gloDatabaseLayer.DBParameters()
                oDBParams.Add("@PatientID", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)

                oDB.Retrive("gsp_GetDataForWorkersCompForms_Dashboard", oDBParams, dtTransaction)
                oDBParams.Clear()
                oDB.Disconnect()
            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            Finally
                If oDB IsNot Nothing Then
                    oDB.Dispose()
                    oDB = Nothing
                End If
                If oDBParams IsNot Nothing Then
                    oDBParams.Clear()
                    oDBParams.Dispose()
                    oDBParams = Nothing
                End If
            End Try

            ' Set data to the Patient NY Forms list to patient details panel on Dashboard
            Dim RowIndex As Int32 = 0
            If dtTransaction IsNot Nothing Then
                For i As Integer = 0 To dtTransaction.Rows.Count - 1
                    C1dgPatientDetails.Rows.Add()
                    RowIndex = C1dgPatientDetails.Rows.Count - 1
                    C1dgPatientDetails.SetData(RowIndex, 0, dtTransaction.Rows(i)("FormId").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 1, dtTransaction.Rows(i)("nInjuryDate").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 2, dtTransaction.Rows(i)("NYFormTypeDisplay").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 3, dtTransaction.Rows(i)("PatientId").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 4, dtTransaction.Rows(i)("ClaimNo").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 5, dtTransaction.Rows(i)("DOS").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 6, dtTransaction.Rows(i)("CloseDate").ToString())
                    C1dgPatientDetails.SetData(RowIndex, 7, dtTransaction.Rows(i)("CreatedBy"))
                    C1dgPatientDetails.SetData(RowIndex, 8, dtTransaction.Rows(i)("CreatedOn"))
                    C1dgPatientDetails.SetData(RowIndex, 9, dtTransaction.Rows(i)("LastModifiedByName"))
                    C1dgPatientDetails.SetData(RowIndex, 10, dtTransaction.Rows(i)("LastModifiedDate"))
                    C1dgPatientDetails.SetData(RowIndex, 11, dtTransaction.Rows(i)("ExamId"))
                    C1dgPatientDetails.SetData(RowIndex, 12, dtTransaction.Rows(i)("ClaimTransactionMasterID"))
                    C1dgPatientDetails.SetData(RowIndex, 13, dtTransaction.Rows(i)("ClaimTransactionID"))
                    C1dgPatientDetails.SetData(RowIndex, 14, dtTransaction.Rows(i)("LastModifiedBy"))
                    C1dgPatientDetails.SetData(RowIndex, 15, dtTransaction.Rows(i)("NYFormTypeID"))

                Next
            End If

            If dtTransaction IsNot Nothing Then
                dtTransaction.Dispose()
                dtTransaction = Nothing
            End If
            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient billing information viewed from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

        Catch ex As Exception
            MessageBox.Show(ex.Message(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try

    End Sub

    Private Sub Fill_Balance()
        Dim ogloPayment As New gloBilling.gloPayment(GetConnectionString())
        Try
            'clear c1 contents 

            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.Clear(ClearFlags.All)
            C1dgPatientDetails.Cols.Count = 15
            C1dgPatientDetails.Rows.Count = 1

            C1dgPatientDetails.SetData(0, 0, "No.")
            C1dgPatientDetails.SetData(0, 1, "Date")
            C1dgPatientDetails.SetData(0, 2, "Claim No")
            C1dgPatientDetails.SetData(0, 3, "CPT")
            C1dgPatientDetails.SetData(0, 4, "Dx1")
            C1dgPatientDetails.SetData(0, 5, "Dx2")
            C1dgPatientDetails.SetData(0, 6, "Dx3")
            C1dgPatientDetails.SetData(0, 7, "Dx4")
            C1dgPatientDetails.SetData(0, 8, "Mod1")
            C1dgPatientDetails.SetData(0, 9, "Mod2")
            C1dgPatientDetails.SetData(0, 10, "Charges")
            C1dgPatientDetails.SetData(0, 11, "Total")
            C1dgPatientDetails.SetData(0, 12, "Allowed")
            C1dgPatientDetails.SetData(0, 13, "Payment")
            C1dgPatientDetails.SetData(0, 14, "Balance")


            C1dgPatientDetails.AllowEditing = False

            C1dgPatientDetails.Cols(0).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(1).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(2).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(3).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(4).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(5).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(6).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(7).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(8).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(9).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftCenter
            C1dgPatientDetails.Cols(10).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.RightCenter
            C1dgPatientDetails.Cols(11).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.RightCenter
            C1dgPatientDetails.Cols(12).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.RightCenter
            C1dgPatientDetails.Cols(13).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.RightCenter
            C1dgPatientDetails.Cols(14).TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.RightCenter

            C1dgPatientDetails.Cols(0).Visible = False
            C1dgPatientDetails.Cols(1).Visible = True
            C1dgPatientDetails.Cols(2).Visible = True
            C1dgPatientDetails.Cols(3).Visible = True
            C1dgPatientDetails.Cols(4).Visible = False
            C1dgPatientDetails.Cols(5).Visible = False
            C1dgPatientDetails.Cols(6).Visible = False
            C1dgPatientDetails.Cols(7).Visible = False
            C1dgPatientDetails.Cols(8).Visible = False
            C1dgPatientDetails.Cols(9).Visible = False
            C1dgPatientDetails.Cols(10).Visible = True
            C1dgPatientDetails.Cols(11).Visible = False
            C1dgPatientDetails.Cols(12).Visible = True
            C1dgPatientDetails.Cols(13).Visible = True
            C1dgPatientDetails.Cols(14).Visible = True


            Dim _width As Integer = pnlPatientDetail.Width
            'Change for resolving case no GLO2009-0003377
            If _width < Convert.ToInt32(c1dgPatientDetailSize) AndAlso c1dgPatientDetailSize <> Nothing Then
                _width = Convert.ToInt32(c1dgPatientDetailSize)
            End If

            C1dgPatientDetails.Cols(0).Width = 0
            C1dgPatientDetails.Cols(1).Width = _width * 0.11
            C1dgPatientDetails.Cols(2).Width = _width * 0.1
            C1dgPatientDetails.Cols(3).Width = _width * 0.16
            C1dgPatientDetails.Cols(4).Width = 0
            C1dgPatientDetails.Cols(5).Width = 0
            C1dgPatientDetails.Cols(6).Width = 0
            C1dgPatientDetails.Cols(7).Width = 0
            C1dgPatientDetails.Cols(8).Width = 0
            C1dgPatientDetails.Cols(9).Width = 0
            C1dgPatientDetails.Cols(10).Width = _width * 0.08
            C1dgPatientDetails.Cols(11).Width = _width * 0.08
            C1dgPatientDetails.Cols(12).Width = _width * 0.08
            C1dgPatientDetails.Cols(13).Width = _width * 0.08
            C1dgPatientDetails.Cols(14).Width = _width * 0.08

            If gnPatientID > 0 Then
                Dim oPaymentTransaction As gloBilling.Common.PaymentTransaction = ogloPayment.GetBillingTransactions(gnPatientID, gnClinicID, 0, False, True)
                If oPaymentTransaction IsNot Nothing Then
                    Dim dTotalBalance As [Decimal] = 0
                    If oPaymentTransaction.TransactionPaymentClaims.Count > 0 Then
                        For i As Integer = 0 To oPaymentTransaction.TransactionPaymentClaims.Count - 1
                            Dim _ClaimNo As String = oPaymentTransaction.TransactionPaymentClaims(i).DisplayClaimNo
                            For j As Integer = 0 To oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines.Count - 1
                                Dim NewRow As C1.Win.C1FlexGrid.Row = C1dgPatientDetails.Rows.Add()

                                C1dgPatientDetails.SetData(NewRow.Index, 0, gloDateMaster.gloDate.DateAsDate(oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).ClaimNo))
                                C1dgPatientDetails.SetData(NewRow.Index, 1, gloDateMaster.gloDate.DateAsDate(oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).DOSFrom))
                                C1dgPatientDetails.SetData(NewRow.Index, 2, _ClaimNo)
                                C1dgPatientDetails.SetData(NewRow.Index, 3, (oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).CPTCode & "-") + oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).CPTDescription)
                                C1dgPatientDetails.SetData(NewRow.Index, 10, oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).TransactionCharges)
                                C1dgPatientDetails.SetData(NewRow.Index, 12, oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).TransactionAllowed)
                                C1dgPatientDetails.SetData(NewRow.Index, 13, oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).TransactionPaid)
                                C1dgPatientDetails.SetData(NewRow.Index, 14, oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).TransactionBalance)

                                dTotalBalance += oPaymentTransaction.TransactionPaymentClaims(i).ClaimLines(j).TransactionBalance
                            Next
                        Next
                        Dim rg As C1.Win.C1FlexGrid.CellRange
                        rg = C1dgPatientDetails.GetCellRange(1, 1, C1dgPatientDetails.Rows.Count - 1, 1)
                        C1dgPatientDetails.Sort(C1.Win.C1FlexGrid.SortFlags.Descending, rg)

                        Dim NewTotalBalanceRow As C1.Win.C1FlexGrid.Row = C1dgPatientDetails.Rows.Add()
                        C1dgPatientDetails.SetData(NewTotalBalanceRow.Index, 13, "Balance")
                        C1dgPatientDetails.SetData(NewTotalBalanceRow.Index, 14, dTotalBalance)
                        C1dgPatientDetails.AllowSorting = C1.Win.C1FlexGrid.AllowSortingEnum.None


                        Dim ogloAdvPay As New gloAdvancePayment(GetConnectionString())
                        Dim _totalCopay As Decimal = 0
                        Dim _totalAdvance As Decimal = 0
                        Dim _grandTotal As Decimal = 0

                        Dim rowTotalCopay As C1.Win.C1FlexGrid.Row = C1dgPatientDetails.Rows.Add()
                        C1dgPatientDetails.SetData(rowTotalCopay.Index, 13, "Total Copay")
                        _totalCopay = ogloAdvPay.GetUnappliedAmount(gnPatientID, PaymentOtherType.Copay)
                        C1dgPatientDetails.SetData(rowTotalCopay.Index, 14, _totalCopay)

                        Dim rowTotalAdvance As C1.Win.C1FlexGrid.Row = C1dgPatientDetails.Rows.Add()
                        C1dgPatientDetails.SetData(rowTotalAdvance.Index, 13, "Total Advance")
                        _totalAdvance = ogloAdvPay.GetUnappliedAmount(gnPatientID, PaymentOtherType.AdvancePayment)
                        C1dgPatientDetails.SetData(rowTotalAdvance.Index, 14, _totalAdvance)

                        Dim rowGrandTotal As C1.Win.C1FlexGrid.Row = C1dgPatientDetails.Rows.Add()
                        C1dgPatientDetails.SetData(rowGrandTotal.Index, 13, "Total Balance")
                        _grandTotal = dTotalBalance - (_totalCopay + _totalAdvance)

                        C1dgPatientDetails.SetData(rowGrandTotal.Index, 14, _grandTotal)
                        If Not IsNothing(ogloAdvPay) Then  ''slr free ogloAdvPay
                            ogloAdvPay.Dispose()
                            ogloAdvPay = Nothing
                        End If
                    End If
                End If
            End If
            If Not IsNothing(ogloPayment) Then  ''slr free ogloPayment
                ogloPayment.Dispose()
                ogloPayment = Nothing
            End If
        Catch ex As Exception

        End Try

    End Sub

    Public Sub Fill_Tasks()

    End Sub

    ''Code added to display role of Provider to grid by Sandip Darade
    ''Get roles of provider for the Exam 
    'Private Function GetRoles(ByVal nExamID As Long) As String
    '    Dim strSelect As String = ""
    '    Dim dtroles As DataTable = Nothing
    '    Dim oDB As New DataBaseLayer
    '    Dim strRoles As String = ""

    '    Try
    '        strSelect = "SELECT  roleOFprovider  = CASE WHEN ISNULL(sProviderName,'') = '' THEN ( ISNULL(sLoginName,'')  + '-' +  ISNULL(sCategory,'') ) ELSE (ISNULL(sProviderName,'') + '-' +  ISNULL(sCategory,'') ) END   FROM PatientExam_DTL  WHERE nExamID = " & nExamID & " ORDER BY  sLoginName , sProviderName "

    '        '   dtroles = New DataTable  ''slr new not needed
    '        dtroles = oDB.GetDataTable_Query(strSelect)
    '        If dtroles IsNot Nothing AndAlso dtroles.Rows.Count > 0 Then
    '            For k As Integer = 0 To dtroles.Rows.Count - 1
    '                If k = 0 Then
    '                    strRoles = Convert.ToString(dtroles.Rows(k)("roleOFprovider"))
    '                Else
    '                    strRoles += "|" & Convert.ToString(dtroles.Rows(k)("roleOFprovider"))
    '                End If
    '            Next
    '        End If
    '    Catch ex As Exception
    '        MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
    '    End Try
    '    If Not IsNothing(oDB) Then  ''Slr free ODB
    '        oDB.Dispose()
    '        oDB = Nothing
    '    End If
    '    If Not IsNothing(dtroles) Then ''Slr free dtroles
    '        dtroles.Dispose()
    '        dtroles = Nothing
    '    End If

    '    Return strRoles
    'End Function

    Private Function GetRoles(ByVal strExamIDs As String, ByVal dtExamIds As DataTable) As Hashtable
        Dim strSelect As String = ""
        Dim dtroles As DataTable = Nothing
        Dim htable As Hashtable = Nothing
        Dim oDB As New DataBaseLayer
        Dim strRoles As String = ""

        Try
            ' strSelect = "SELECT nExamId,  roleOFprovider  = CASE WHEN ISNULL(sProviderName,'') = '' THEN ( ISNULL(sLoginName,'')  + '-' +  ISNULL(sCategory,'') ) ELSE (ISNULL(sProviderName,'') + '-' +  ISNULL(sCategory,'') ) END   FROM PatientExam_DTL  WHERE nExamID in( " & strExamIDs & ") ORDER BY  nExamId,sLoginName , sProviderName "
            ''    strSelect = "SELECT  roleOFprovider  = CASE WHEN ISNULL(sProviderName,'') = '' THEN ( ISNULL(sLoginName,'')  + '-' +  ISNULL(sCategory,'') ) ELSE (ISNULL(sProviderName,'') + '-' +  ISNULL(sCategory,'') ) END   FROM PatientExam_DTL  WHERE nExamID = " & strExamIDs & " ORDER BY  sLoginName , sProviderName "
            '   dtroles = New DataTable  ''slr new not needed
            ''oDB.GetDataTable_Query(strSelect)
            dtroles = dt_ExamID
            If dtroles IsNot Nothing AndAlso dtroles.Rows.Count > 0 Then
                htable = New Hashtable()
                For Each drexamid As DataRow In dtExamIds.Rows
                    Dim drr() As DataRow = dtroles.Select("nExamid=" + Convert.ToString(drexamid("nExamid")) + "")
                    If drr.Length > 0 Then
                        For k As Integer = 0 To drr.Length - 1
                            If k = 0 Then
                                strRoles = Convert.ToString(drr(k)("roleOFprovider"))
                            Else
                                strRoles += "|" & Convert.ToString(drr(k)("roleOFprovider"))
                            End If
                        Next
                        htable.Add(drexamid("nExamid").ToString(), strRoles)
                        strRoles = ""
                    End If
                Next
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        If Not IsNothing(oDB) Then  ''Slr free ODB
            oDB.Dispose()
            oDB = Nothing
        End If
        If Not IsNothing(dtroles) Then ''Slr free dtroles
            dtroles.Dispose()
            dtroles = Nothing
        End If

        Return htable
    End Function


#Region " Search Patient Details "
    '20120824-Fill Template Speciality Combo Box 
    Private Sub Fill_TemplateSpecility()
        '  Dim pExam As New clsPatientExams()
        '' pExam.GetAllTemplateSpecility()

        'Changes for new Template Category parameter in New Exam tab in Patient Details
        Label64.Text = "Specialty:"
        If Not IsNothing(dt_TemplateSpeciality) Then
            Dim dt As DataTable = dt_TemplateSpeciality
            Dim str As String = dt.DefaultView.Sort()
            Dim dr As DataRow() = dt.Select("nCategoryId=0")
            If dr.Length = 0 Then
                Dim r As DataRow
                r = dt.NewRow
                r.Item("sDescription") = "All"
                r.Item("nCategoryId") = 0
                dt.Rows.InsertAt(r, 0)
            End If
            dr = Nothing
            Try
                cmbTemplateSpeciality.DataSource = dt.DefaultView
                cmbTemplateSpeciality.ValueMember = dt.Columns(0).ColumnName
                cmbTemplateSpeciality.DisplayMember = dt.Columns(1).ColumnName
                cmbTemplateSpeciality.SelectedIndex = 0
            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Exam, gloAuditTrail.ActivityCategory.Finish, gloAuditTrail.ActivityType.View, ex, gloAuditTrail.ActivityOutCome.Failure)
            Finally
                'If IsNothing(dt) = False Then ''slr free dt
                '    '             dt.Dispose()
                '    dt = Nothing
                'End If

                'If IsNothing(pExam) = False Then  ''slr free pexam
                '    pExam.Dispose()
                '    pExam = Nothing
                'End If
            End Try
        End If
    End Sub

    Private Sub Fill_CaseCombo()
        dt_CasesCombo = GetCaseDetails(gnPatientID)
        If Not IsNothing(dt_CasesCombo) Then
            Dim dt As DataTable = dt_CasesCombo
            Dim str As String = dt.DefaultView.Sort()
            Dim dr As DataRow() = dt.Select("CaseID=0")
            If dr.Length = 0 Then
                Dim r As DataRow
                r = dt.NewRow
                r.Item("CaseName") = "All"
                r.Item("CaseID") = 0
                dt.Rows.InsertAt(r, 0)
            End If
            dr = Nothing
            Try
                cmbCase.DataSource = dt.DefaultView
                cmbCase.ValueMember = dt.Columns(0).ColumnName
                cmbCase.DisplayMember = dt.Columns(1).ColumnName
                cmbCase.SelectedIndex = 0
            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Exam, gloAuditTrail.ActivityCategory.Finish, gloAuditTrail.ActivityType.View, ex, gloAuditTrail.ActivityOutCome.Failure)
            Finally

            End Try
        End If
    End Sub

    Public Function GetCaseDetails(ByVal PatientID As Long) As DataTable
        Dim oDB As New DataBaseLayer
        Dim oParamater As DBParameter
        Dim oResultTable As DataTable = Nothing ''slr no new needed 
        Try
            oParamater = New DBParameter
            oParamater.DataType = SqlDbType.VarChar
            oParamater.Direction = ParameterDirection.Input
            oParamater.Name = "@PatientID"
            oParamater.Value = PatientID
            oDB.DBParametersCol.Add(oParamater)
            oParamater = Nothing

            oParamater = New DBParameter
            oParamater.DataType = SqlDbType.Bit
            oParamater.Direction = ParameterDirection.Input
            oParamater.Name = "@IsFromDashboard"
            oParamater.Value = True
            oDB.DBParametersCol.Add(oParamater)
            oParamater = Nothing

            oResultTable = oDB.GetDataTable("gsp_fillcaseDetails_mst")

            If Not oResultTable Is Nothing Then
                'oResultTable.Rows.Add(0, "")
                Return oResultTable
            Else
                Return Nothing
            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Exam, gloAuditTrail.ActivityCategory.Notes, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
            ex = Nothing
            Return Nothing
        Finally
            If IsNothing(oDB) = False Then
                oDB.Dispose() : oDB = Nothing
            End If
            oResultTable = Nothing
        End Try
    End Function

    Private Sub cmbCase_SelectionChangeCommitted(sender As Object, e As System.EventArgs) Handles cmbCase.SelectionChangeCommitted
        Fill_PastExams()
    End Sub

    Public Sub FillFinishUnfinishCombo()
        Dim dtStatus As New DataTable
        Dim MyRow As DataRow

        dtStatus.Columns.Add(New DataColumn("StatusID", GetType(Short)))
        dtStatus.Columns.Add(New DataColumn("ExamStatus", GetType(String)))

        MyRow = dtStatus.NewRow()
        MyRow(0) = 2
        MyRow(1) = "All"
        dtStatus.Rows.Add(MyRow)
        MyRow = Nothing

        MyRow = dtStatus.NewRow()
        MyRow(0) = 1
        MyRow(1) = "Finished"
        dtStatus.Rows.Add(MyRow)
        MyRow = Nothing

        MyRow = dtStatus.NewRow()
        MyRow(0) = 0
        MyRow(1) = "UnFinished"
        dtStatus.Rows.Add(MyRow)
        MyRow = Nothing


        cmbStatus.DataSource = dtStatus
        cmbStatus.DisplayMember = dtStatus.Columns("ExamStatus").ToString()
        cmbStatus.ValueMember = dtStatus.Columns("StatusID").ToString()
    End Sub

    Public Sub FillProviderCombo()
        Dim dt As DataTable = Nothing   ''Slr new not needed 
        If IsNothing(dt_ProviderCombo) Then
            Dim oDB As New DataBaseLayer

            Dim strSelect As String = "select nProviderID,isnull(sFirstName,'') + ' ' + CASE ISNULL(sMiddleName,'') WHEN  '' THEN '' When sMiddleName then  " _
                                     & "sMiddleName +  ' ' END +  isnull(sLastName,'') as Name from Provider_MST"
            dt = oDB.GetDataTable_Query(strSelect)
            dt_ProviderCombo = dt
            oDB.Dispose()
            oDB = Nothing
            strSelect = Nothing
        Else
            dt = dt_ProviderCombo
        End If

        If Not IsNothing(dt) Then
            Dim dr As DataRow() = dt.Select("nProviderID=0")
            If (dr.Length = 0) Then
                Dim r As DataRow
                r = dt.NewRow
                r.Item("Name") = "All"
                r.Item("nProviderID") = 0
                dt.Rows.InsertAt(r, 0)

                r = Nothing
            End If
        End If

        'Dim strProviderName As String = ""
        cmbProvider.DataSource = dt
        cmbProvider.DisplayMember = dt.Columns("Name").ToString()
        cmbProvider.ValueMember = dt.Columns("nProviderID").ToString()
    End Sub

    Public Sub FillNewExamTemplateCategory()
        'Changes for new Template Category parameter in New Exam tab in Patient Details
        dt_TemplateSpeciality = Nothing
        Label64.Text = "Category:"
        Dim objPatientDetail As New clsPatientDetails
        Dim dt As DataTable = objPatientDetail.GetTemplateCategory()
        cmbTemplateSpeciality.DataSource = dt.DefaultView
        cmbTemplateSpeciality.ValueMember = "nCategoryID"
        cmbTemplateSpeciality.DisplayMember = "sDescription"
        cmbTemplateSpeciality.SelectedValue = dt.Rows(0).Item("SOAPID")
    End Sub


    Private Sub FillMedicationStatusCombo()
        'cmbStatus.Items.Clear()
        cmbStatus.DataSource = Nothing
        cmbStatus.Items.Clear()
        cmbStatus.Items.Add("Active")
        cmbStatus.Items.Add("Active All")
        cmbStatus.Items.Add("All")
        cmbStatus.Items.Add("Inactive")
        cmbStatus.Items.Add("Erroneous")
        cmbStatus.Items.Add("Cancelled")
        cmbStatus.Items.Add("Completed")
        cmbStatus.Items.Add("Discontinued")
        cmbStatus.Items.Add("Unknown")

        cmbStatus.Items.Add("Aborted")
        cmbStatus.Items.Add("Held")
        cmbStatus.Items.Add("Normal")
        cmbStatus.Items.Add("New")
        cmbStatus.Items.Add("Nullified")
        cmbStatus.Items.Add("Obsolete")
        cmbStatus.Items.Add("Suspended")

        cmbStatus.SelectedIndex = 0
    End Sub

    Private Sub FillHistoryStatusCombo()

        ' cmbStatus.Items.Clear()
        cmbStatus.DataSource = Nothing
        cmbStatus.Items.Clear()
        cmbStatus.Items.Add("All")
        cmbStatus.Items.Add("Active")
        cmbStatus.Items.Add("Inactive")
        cmbStatus.SelectedIndex = 0 ''Setting Status to Active 
    End Sub

    Private Sub FillRxMethodsCombo()
        ' cmbStatus.Items.Clear()
        cmbStatus.DataSource = Nothing
        cmbStatus.Items.Clear()
        cmbStatus.Items.Add("All")
        cmbStatus.Items.Add("Fax")
        cmbStatus.Items.Add("Print")
        cmbStatus.Items.Add("Phone")
        cmbStatus.Items.Add("Sample")
        cmbStatus.Items.Add("Handwritten")
        cmbStatus.Items.Add("eRx")
        cmbStatus.SelectedIndex = 0
    End Sub

    Private Sub FillProblemListStatusCombo()
        Dim dtStatus As New DataTable
        Dim MyRow As DataRow

        dtStatus.Columns.Add(New DataColumn("StatusID", GetType(Short)))
        dtStatus.Columns.Add(New DataColumn("ProblemListStatus", GetType(String)))

        MyRow = dtStatus.NewRow()
        MyRow("StatusID") = 0
        MyRow("ProblemListStatus") = "All"
        dtStatus.Rows.Add(MyRow)
        MyRow = Nothing

        MyRow = dtStatus.NewRow()
        MyRow("StatusID") = 2
        MyRow("ProblemListStatus") = "Active"
        dtStatus.Rows.Add(MyRow)
        MyRow = Nothing

        MyRow = dtStatus.NewRow()
        MyRow("StatusID") = 3
        MyRow("ProblemListStatus") = "Inactive"
        dtStatus.Rows.Add(MyRow)
        MyRow = Nothing

        MyRow = dtStatus.NewRow()
        MyRow("StatusID") = 1
        MyRow("ProblemListStatus") = "Resolved"
        dtStatus.Rows.Add(MyRow)
        MyRow = Nothing

        cmbStatus.DataSource = dtStatus
        cmbStatus.DisplayMember = dtStatus.Columns("ProblemListStatus").ToString()
        cmbStatus.ValueMember = dtStatus.Columns("StatusID").ToString()
    End Sub

    Private Sub FillProviderComboWithUserList()
        Dim oDB As New DataBaseLayer
        Dim strSelect As String = "SELECT nUserID, ISNULL(sLoginName,'') AS sLoginName FROM User_MST"
        Dim dt As DataTable ''slr new not needed 

        dt = oDB.GetDataTable_Query(strSelect)

        strSelect = Nothing

        Dim r As DataRow
        r = dt.NewRow
        r.Item("sLoginName") = "All"
        r.Item("nUserID") = 0
        dt.Rows.InsertAt(r, 0)

        r = Nothing

        'Dim strProviderName As String = ""
        cmbProvider.DataSource = dt
        cmbProvider.DisplayMember = dt.Columns("sLoginName").ToString()
        cmbProvider.ValueMember = dt.Columns("nUserID").ToString()

        oDB.Dispose()
        oDB = Nothing

    End Sub

    ''' <summary>
    ''' When View Documents selected on patient Details tab, Common combo control should be filled with enumerations of month by Rohit on 2011-10-13
    ''' </summary>
    ''' <remarks>Local used function include month and number, along with All options</remarks>
    ''' 
    Private Sub FillMonthListInProviderCombo()
        'Local variable.
        Dim tempDate As Date = "01/01/2011"

        'Clear binding from parent control
        ' cmbProvider.Items.Clear()
        cmbProvider.DataSource = Nothing
        cmbProvider.Items.Clear()

        'Temporary data table for the filter
        Dim dt As New DataTable()
        dt.Columns.Add("sMonthname")
        dt.Columns.Add("nMonth")
        dt.Rows.Clear()

        'for All Months filter
        dt.Rows.Add()
        dt.Rows(0)("sMonthname") = "All"
        dt.Rows(0)("nMonth") = 0

        'Creation of filter criteria
        For iMonth As Int16 = 1 To 12
            dt.Rows.Add()
            dt.Rows(iMonth)("sMonthname") = CType(iMonth, gloStream.gloDMS.Supporting.enumMonth)
            dt.Rows(iMonth)("nMonth") = iMonth
            tempDate = tempDate.AddMonths(1)
        Next

        ' Set data source for dropdown list 
        cmbProvider.DataSource = dt

        ' Set Display and View member for dropdown from data source
        cmbProvider.DisplayMember = dt.Columns("sMonthname").ToString()
        cmbProvider.ValueMember = dt.Columns("nMonth").ToString()

        tempDate = Nothing
    End Sub
    'end of code added by Rohit on 2011-10-13

    Private Sub cmbExamProvider_SelectionChangeCommitted(ByVal sender As Object, ByVal e As System.EventArgs) 'Handles cmbProvider.SelectionChangeCommitted
        RaiseEvent SearchFilterChanged(enumFilterCriteria.Provider)
    End Sub

    Private Sub cmbExamStatus_SelectionChangeCommitted(ByVal sender As Object, ByVal e As System.EventArgs) 'Handles cmbStatus.SelectionChangeCommitted
        RaiseEvent SearchFilterChanged(enumFilterCriteria.Status)
    End Sub

    Private Sub ResetSearchControls()
        Try
            RemoveHandlers()
            _ResetFlag = True

            Panel5.Visible = False
            C1dgPatientDetails.AllowSorting = AllowSortingEnum.None
            C1dgPatientDetails.Visible = True
            Select Case SelectedPatientDetail
                ''Bug #84149: CR00000379: New exam enhancement
                Case PatientDetails.NYWorkerCompForms, PatientDetails.Insurance, PatientDetails.Vitals, PatientDetails.Referrals, PatientDetails.FAX_Pending, PatientDetails.FAX_Sent, PatientDetails.PriorAuthorization, PatientDetails.AuditTrail, PatientDetails.Orders, PatientDetails.EligibilityInformation, PatientDetails.SBPData
                    pnlSearchFilter.Visible = False
                Case Else
                    pnlSearchFilter.Visible = True
            End Select
            cmbStatus.Visible = True
            txtSearchIntuit.Visible = False
            Panel14.Width = 153
            pnlSpeciality.Visible = False
            cmbProvider.Width = 137
            lblProvider.Width = 54
            pnlCase.Visible = False
            Select Case SelectedPatientDetail
                Case PatientDetails.History
                    lblStatus.Text = "Allergy/Diagnosis Status :"
                    lblStatus.Width = 120
                    Panel14.Width = 295
                    Panel14.Visible = True
                    Panel13.Visible = False
                    Panel16.Visible = False
                    FillHistoryStatusCombo()

                Case PatientDetails.Medication
                    lblStatus.Text = "Status :"
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = False
                    FillMedicationStatusCombo()

                Case PatientDetails.Prescription
                    lblStatus.Text = "Method :"
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = False
                    FillRxMethodsCombo()

                Case PatientDetails.ProblemList
                    lblStatus.Text = "Status :"
                    lblProvider.Text = "User :"
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = True
                    FillProblemListStatusCombo()
                    FillProviderComboWithUserList()
                Case PatientDetails.ViewDocs
                    lblStatus.Text = "Year "
                    lblProvider.Text = "Month "
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = True
                    '  cmbStatus.Items.Clear()
                    cmbStatus.DataSource = Nothing
                    cmbStatus.Items.Clear()
                    cmbStatus.Items.Add("All")
                    cmbStatus.SelectedIndex = 0
                    FillMonthListInProviderCombo()
                    cmbProvider.SelectedIndex = 0

                Case PatientDetails.OrderTemplates
                    Panel13.Visible = False
                    Panel14.Visible = False
                    Panel16.Visible = True

                Case PatientDetails.Messages, PatientDetails.PatientLetters, PatientDetails.PatientConsent, PatientDetails.DisclosureManagement, PatientDetails.NurseNotes
                    lblStatus.Text = "Status :"
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = False
                    FillFinishUnfinishCombo()

                Case PatientDetails.PastExams
                    lblProvider.Text = "Provider :"
                    lblStatus.Text = "Status :"
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = True
                    pnlSpeciality.Visible = True
                    pnlCase.Visible = True
                    FillFinishUnfinishCombo()
                    '  FillProviderCombo()
                    '20120824-Template Speciality Combo box Filled
                    Fill_TemplateSpecility()
                    Fill_CaseCombo()

                    ''Bug #84149: CR00000379: New exam enhancement
                Case PatientDetails.NewExam
                    lblProvider.Text = "Provider :"
                    lblStatus.Text = "Search By :"
                    Panel16.Visible = False
                    Panel14.Visible = True
                    Panel13.Visible = True
                    cmbStatus.Visible = False
                    txtSearchIntuit.Visible = True
                    txtSearchIntuit.Text = ""
                    Panel14.Width = 295
                    'Changes for new Template Category parameter
                    pnlSpeciality.Visible = True
                    FillNewExamTemplateCategory()
                    FillProviderCombo()

                Case PatientDetails.PatientAppointments
                    lblStatus.Text = "Status :"
                    lblProvider.Text = "Provider :"
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = True
                    FillProviderCombo()
                    FillAppointmentStatusCombo()

                Case PatientDetails.PatientEducation
                    Panel13.Visible = False
                    Panel14.Visible = False
                    Panel16.Visible = True

                Case PatientDetails.Triage
                    lblStatus.Text = "Status :"
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = False
                    FillFinishUnfinishCombo()

                Case PatientDetails.PatientCommunication

                    Panel13.Visible = False
                    Panel14.Visible = False
                    Panel16.Visible = True

                    'Panel14.Width = 300
                    'cmbStatus.Width = 70
                    'lblStatus.Width = 100
                    'txtSearchIntuit.Width = 130
                    'cmbStatus.Visible = True
                    'txtSearchIntuit.Visible = True
                    'cmbStatus.Dock = DockStyle.Left
                    'lblStatus.Dock = DockStyle.Left
                    'txtSearchIntuit.Dock = DockStyle.Right
                    'cmbStatus.Items.Clear()
                    'cmbStatus.Items.Add("All")
                    'cmbStatus.Items.Add("Sent")
                    'cmbStatus.Items.Add("Received")

                Case PatientDetails.IntuitCommunication
                    lblStatus.Text = "Search By :"
                    Panel16.Visible = True
                    Panel14.Visible = True
                    Panel13.Visible = False
                    cmbStatus.Visible = False
                    ''changes made for order PRD 8020
                Case PatientDetails.Order
                    ' Label44.Text = ""
                    lblStatus.Text = "Order List :"
                    lblProvider.Text = "Acknowledged :"
                    lblProvider.Width = 85    ''54
                    Panel16.Visible = True ''false
                    Panel13.Visible = True
                    Panel14.Visible = False
                    cmbStatus.Visible = False
                    '  cmbProvider.Items.Clear()  ''bugid 68319
                    cmbProvider.DataSource = Nothing
                    cmbProvider.Items.Clear()  ''bugid 68319
                    cmbProvider.Items.Add("All")
                    cmbProvider.Items.Add("Yes")
                    cmbProvider.Items.Add("No")
                    cmbProvider.Width = 90   ''137
                Case PatientDetails.SBPData
                    Panel13.Visible = False
                    Panel14.Visible = False
                    Panel16.Visible = True

            End Select

            If (Panel16.Visible) Then
                chkenbdate.Enabled = True
                If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                    chkenbdate.Checked = True
                    dtpFromDate.Enabled = True
                    dtpToDate.Enabled = True
                Else
                    chkenbdate.Checked = False
                    dtpFromDate.Enabled = False
                    dtpToDate.Enabled = False
                End If


                If (SelectedPatientDetail <> PatientDetails.Medication) Then
                    If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                        dtpToDate.Value = Now.Date
                        Dim sDate As String = ""
                        If Now.Date.Month <= 6 Then
                            sDate = (Now.Date.Month + 6).ToString() + "/" + Now.Date.Day.ToString() + "/" + (Now.Date.Year - 1).ToString()
                        ElseIf Now.Date.Month >= 7 Then
                            sDate = (Now.Date.Month - 6).ToString() + "/" + Now.Date.Day.ToString() + "/" + Now.Date.Year.ToString()
                        End If
                        dtpFromDate.Value = Convert.ToDateTime(sDate).Date

                        sDate = Nothing

                        txtSearchIntuit.Visible = True
                        Panel14.Width = 295
                    Else
                        dtpFromDate.Value = Now.Date
                        dtpToDate.Value = Now.Date
                    End If

                End If

            End If

            Call ResetButton(SelectedPatientDetail) ''Reset Button
            '' To select first as a default status
            If SelectedPatientDetail <> PatientDetails.History Then
                If cmbStatus.Items.Count > 0 Then
                    cmbStatus.SelectedIndex = 0
                End If
            End If
            '' To select first as a default provider
            If cmbProvider.Items.Count > 0 Then
                ''Bug #84149: CR00000379: New exam enhancement
                If gnLoginProviderID <> 0 AndAlso SelectedPatientDetail = PatientDetails.NewExam Then
                    cmbProvider.SelectedValue = gnLoginProviderID
                Else
                    cmbProvider.SelectedIndex = 0
                End If
            End If
        Catch
        Finally
            _ResetFlag = False
            AddHandlers()
        End Try
    End Sub

#End Region

    Private Sub txtTestResultComment_LinkClicked(ByVal sender As Object, ByVal e As System.Windows.Forms.LinkClickedEventArgs) Handles txtOrderComment.LinkClicked '20140907 manoj PRD: View Lab Order Comments: added New Event
        Try
            If Not String.IsNullOrEmpty(e.LinkText.Trim()) Then
                gloGlobal.gloLabGenral.OpenLinkInBrowser(e.LinkText.Trim())
            End If
        Catch
        End Try
    End Sub

    Private Sub C1dgPatientDetails_AfterSelChange(sender As Object, e As C1.Win.C1FlexGrid.RangeEventArgs) Handles C1dgPatientDetails.AfterSelChange '20140407 manoj PRD: View Lab Order Comments: added New Event
        Try

            If SelectedPatientDetail = PatientDetails.Order AndAlso C1dgPatientDetails.RowSel > 0 Then
                txtOrderComment.Text = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 15))
                If Not String.IsNullOrEmpty(txtOrderComment.Text) Then
                    txtOrderComment.Visible = True
                    SplitterOrderComments.Visible = True
                    SplitterOrderComments.BringToFront()
                Else
                    txtOrderComment.Visible = False
                    SplitterOrderComments.Visible = False
                    SplitterOrderComments.SendToBack()
                End If
            End If
        Catch
        End Try
    End Sub

    Private Sub C1dgPatientDetails_BeforeEdit(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.RowColEventArgs) Handles C1dgPatientDetails.BeforeEdit
        If pnlPatientDetail.Text = "Past Exams" Then
            If e.Row > 1 Then
                If e.Col = 9 AndAlso Convert.ToString(C1dgPatientDetails.GetData(e.Row, e.Col)) = "" Then
                    e.Cancel = True
                End If
            End If
        End If
    End Sub


    Private Sub C1dgPatientDetails_MouseClick(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1dgPatientDetails.MouseClick
        C1dgPatientDetails.Row = C1dgPatientDetails.HitTest(e.Location).Row
        PatientDetailsRowClickIndex = C1dgPatientDetails.HitTest(e.Location).Row
        Select Case SelectedPatientDetail
            Case PatientDetails.IntuitCommunication
                If PatientDetailsRowClickIndex > 0 Then
                    IntuitMessageFrom = Convert.ToString(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("Sender"))
                    IntuitMessageTo = Convert.ToString(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("Receiver"))
                    IntuitMessageSubject = Convert.ToString(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("sCommSubject"))
                    IntuitMessageDate = Convert.ToString(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("dCommCreationDate"))
                    IntuitCommDetailId = Convert.ToInt64(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("nCommDetailID"))
                    IntuitMsgreadUnread = Convert.ToBoolean(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("bIsReadFlag"))
                    IntuitMessageType = Convert.ToBoolean(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("bCommMessageType"))
                    IntuitMessageBody = Convert.ToString(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("sCommMessage"))
                    IntuitAttachmentcount = Convert.ToInt64(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("Attachmentcount"))
                    IntuitMessageStaffId = Convert.ToInt64(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("nCommStaffID"))
                    IntuitMessageContainerId = Convert.ToInt64(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("nCommContainerID"))
                    IntuitServiceType = Convert.ToString(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("sCommServiceType"))

                End If
        End Select
    End Sub


    'Add New Details
    Private Sub C1dgPatientDetails_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1dgPatientDetails.MouseDown
        _IsFromAppointmentforTemplatePrint = False
        Try


            C1dgPatientDetails.Select()

            If gnPatientID <= 0 Then
                'Try
                '    If (IsNothing(C1dgPatientDetails.ContextMenu) = False) Then
                '        C1dgPatientDetails.ContextMenu.Dispose()
                '        C1dgPatientDetails.ContextMenu = Nothing
                '    End If
                'Catch ex As Exception

                'End Try
                'C1dgPatientDetails.ContextMenu = Nothing
                ClearContextMenuStrip(C1dgPatientDetails.ContextMenuStrip)
                ClearContextMenuStrip(C1Triage.ContextMenuStrip)
                ClearContextMenuStrip(cmnuPatientDetails)
                AssignContextMenuStrip(C1dgPatientDetails.ContextMenuStrip, cmnuPatientDetails)
                AssignContextMenuStrip(C1Triage.ContextMenuStrip, cmnuPatientDetails)
                Exit Sub
            End If

            Dim oMenuItem As ToolStripMenuItem
            Dim oChildItem As ToolStripMenuItem
            Dim oMenuItemSeperator As ToolStripSeparator

            ClearContextMenuStrip(C1dgPatientDetails.ContextMenuStrip)
            ClearContextMenuStrip(C1Triage.ContextMenuStrip)
            ClearContextMenuStrip(cmnuPatientDetails)

            'cmnuPatientDetails.Items.Clear()
            If e.Button = MouseButtons.Right Then
                Dim _nRow As Integer = C1dgPatientDetails.HitTest(e.X, e.Y).Row
                If _nRow >= 0 Then
                    C1dgPatientDetails.Row = _nRow

                End If

                'Fill Context Menu  
                Select Case SelectedPatientDetail
                    Case PatientDetails.NYWorkerCompForms
                        ' NY Worker Comp Context Menu
                        Dim nRow As Integer
                        nRow = C1dgPatientDetails.HitTest(e.X, e.Y).Row
                        If nRow = 0 Then
                            oMenuItem = New ToolStripMenuItem
                            Dim oChildMenuItem As ToolStripMenuItem = Nothing
                            oMenuItem.Text = "New Form"
                            oMenuItem.Tag = "New Form"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(28)
                            cmnuPatientDetails.Items.Add(oMenuItem)

                            'AddHandler oMenuItem.Click, AddressOf NewWCForm

                            oChildMenuItem = New ToolStripMenuItem()
                            oChildMenuItem.Text = "C-4"
                            oChildMenuItem.Tag = "C-4"

                            oMenuItem.DropDownItems.Add(oChildMenuItem)
                            AddHandler oChildMenuItem.Click, AddressOf cmnuNYWC_C4Item_Click
                            oChildMenuItem = Nothing

                            oChildMenuItem = New ToolStripMenuItem()
                            oChildMenuItem.Text = "C-4.2"
                            oChildMenuItem.Tag = "C-4.2"

                            oMenuItem.DropDownItems.Add(oChildMenuItem)
                            AddHandler oChildMenuItem.Click, AddressOf cmnuNYWC_C42Item_Click
                            oChildMenuItem = Nothing

                            oChildMenuItem = New ToolStripMenuItem()
                            oChildMenuItem.Text = "C-4 Auth"
                            oChildMenuItem.Tag = "C-4 Auth"

                            oMenuItem.DropDownItems.Add(oChildMenuItem)
                            AddHandler oChildMenuItem.Click, AddressOf cmnuNYWC_C4AuthItem_Click
                            oChildMenuItem = Nothing

                            oChildMenuItem = New ToolStripMenuItem()
                            oChildMenuItem.Text = "MG-2"
                            oChildMenuItem.Tag = "MG-2"

                            oMenuItem.DropDownItems.Add(oChildMenuItem)
                            AddHandler oChildMenuItem.Click, AddressOf cmnuNYWC_MG2Item_Click
                            oChildMenuItem = Nothing

                            oChildMenuItem = New ToolStripMenuItem()
                            oChildMenuItem.Text = "MG-2.1"
                            oChildMenuItem.Tag = "MG-2.1"

                            oMenuItem.DropDownItems.Add(oChildMenuItem)
                            AddHandler oChildMenuItem.Click, AddressOf cmnuNYWC_MG21Item_Click
                            oChildMenuItem = Nothing


                        End If
                        If nRow > 0 Then
                            'If objUserRights.
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Modify Form"
                            oMenuItem.Tag = "Modify Form"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(28)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf ModifyWCForm

                        End If

                    Case PatientDetails.Insurance
                        'Insurance
                        Dim nRow As Integer
                        nRow = C1dgPatientDetails.HitTest(e.X, e.Y).Row
                        If nRow > 0 Then
                            If objUserRights.Insurance = True Then
                                tempInsId = C1dgPatientDetails.GetData(nRow, 0)
                                tempInsName = C1dgPatientDetails.GetData(nRow, 1)
                                'Bug #66982: 00000214 : Questions
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Prior  Authorization"
                                oMenuItem.Tag = "Prior Authorization"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(72)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf PriorAuthorization

                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Modify"
                                oMenuItem.Tag = "Modify"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(28)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf ModifyInsurance

                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Eligibility Check "
                                oMenuItem.Tag = "Eligibility Check "
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(25)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf eligibilityCheck

                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Patient Benefit"
                                oMenuItem.Tag = "Patient Benefit"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(59)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf ViewBenefits
                            End If
                        End If

                    Case PatientDetails.History
                        'History
                        If objUserRights.PatientHistory = True Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add History"
                            oMenuItem.Tag = "Add History"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(0)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If

                    Case PatientDetails.Medication                            'Medication
                        If objUserRights.PatientMedication = True Then


                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Medication"
                            oMenuItem.Tag = "Add Medication"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(9)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                            'Incident #55315: 00016572 : Carry forward issue
                            'New Menu added to edit medication
                            If _nRow > 0 Then
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Edit Medication"
                                oMenuItem.Tag = "Edit Medication"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(28)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf EditPrescription

                            End If
                        End If
                    Case PatientDetails.Prescription  'Prescription
                        If objUserRights.PatientPrescription = True Then
                            If C1dgPatientDetails.Rows.Count > 1 Then

                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Add Prescription"
                                oMenuItem.Tag = "Add Prescription"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(10)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf AddPatientDetails

                                oMenuItem = Nothing
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Add Pharmacy Notes"
                                oMenuItem.Tag = "Add Pharmacy Notes"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(32)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf AddPatientDetails

                                '''''''fetch the eRxStatus and eRxStatusMessage values from the selected grid row. 
                                oMenuItem = Nothing
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Show eRx status"
                                oMenuItem.Tag = "Show eRx status"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(38)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf AddPatientDetails

                                '''''''RxFill Notifications 
                                oMenuItem = Nothing
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Show RxFill Notifications"
                                oMenuItem.Tag = "Show RxFill Notifications"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(76)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf AddPatientDetails

                                If C1dgPatientDetails.RowSel > 0 AndAlso mdlGeneral.IsCancelRxEnabledForProvider Then
                                    'If (C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 15) <> 0) Then
                                    '''''''RxFill Notifications 
                                    oMenuItem = Nothing
                                    oMenuItem = New ToolStripMenuItem
                                    oMenuItem.Text = "Cancel Prescription"
                                    oMenuItem.Tag = "Cancel Prescription"
                                    oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                    oMenuItem.Image = Imgts_PatientDetails.Images(77)
                                    oMenuItem.Visible = Not chkCancelRx.Checked
                                    cmnuPatientDetails.Items.Add(oMenuItem)
                                    '  AddHandler oMenuItem.Click, AddressOf AddPatientDetails


                                    Dim item1 As New System.Windows.Forms.ToolStripMenuItem()
                                    item1.Text = "Cancel Prescription"
                                    item1.Tag = "Cancel Prescription"
                                    item1.ForeColor = Color.FromArgb(31, 73, 125)
                                    item1.Image = Imgts_PatientDetails.Images(77)

                                    AddHandler item1.Click, AddressOf AddPatientDetails

                                    oMenuItem.DropDownItems.Add(item1)

                                    Dim item2 As New System.Windows.Forms.ToolStripMenuItem()
                                    item2.Text = "Discontinue Prescription"
                                    item2.Tag = "Discontinue Prescription"
                                    item2.ForeColor = Color.FromArgb(31, 73, 125)
                                    item2.Image = Imgts_PatientDetails.Images(77)

                                    AddHandler item2.Click, AddressOf AddPatientDetails

                                    oMenuItem.DropDownItems.Add(item2)

                                    'End If

                                    If (C1dgPatientDetails.GetUserData(C1dgPatientDetails.RowSel, 16) > 0) Then
                                        '''''''RxFill Notifications 
                                        oMenuItem = Nothing
                                        oMenuItem = New ToolStripMenuItem
                                        oMenuItem.Text = "Show CancelRx Response"
                                        oMenuItem.Tag = "CancelRx Response"
                                        oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                        oMenuItem.Image = Imgts_PatientDetails.Images(78)
                                        oMenuItem.Visible = chkCancelRx.Checked
                                        cmnuPatientDetails.Items.Add(oMenuItem)
                                        AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                                    End If
                                End If
                            End If

                        End If
                    Case PatientDetails.OrderTemplates                                  'Orders
                        If objUserRights.RadiologyOrders = True Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Order Templates"
                            oMenuItem.Tag = "Add Order Templates"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(13)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If
                    Case PatientDetails.Vitals
                        If objUserRights.PatientVitals = True Then 'Vitals


                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Vitals"
                            oMenuItem.Tag = "Add Vitals"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(3)
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(3)

                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If
                        If (C1dgPatientDetails.Rows.Count > 1) Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Show Graph"
                            oMenuItem.Tag = "Show Graph"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(21)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf ShowVitalsGraph
                            'AdvanceCharts
                            If gblnAdvancedGrowthChart Then
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Advance Chart"
                                oMenuItem.Tag = "Advance Chart"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(22)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf ShowAdvanceCharts
                            End If
                            ''
                        End If

                    Case PatientDetails.Messages                                  'Messages
                        If objUserRights.Messages = True Then 'Vitals


                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Messages"
                            oMenuItem.Tag = "Add Messages"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(14)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If
                        'For Message History
                        Dim nRow As Integer
                        nRow = C1dgPatientDetails.HitTest(e.X, e.Y).Row
                        If nRow >= 0 Then
                            oMenuItem = New ToolStripMenuItem

                            oMenuItem.Text = "Message History"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(23)
                            oMenuItem.Tag = C1dgPatientDetails.Item(nRow, 0)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf ShowMessageHistory
                        End If
                        ''

                    Case PatientDetails.ProblemList
                        If objUserRights.PatientProblemList = True Then 'Problem
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "View Problem List"
                            oMenuItem.Tag = "Add Problem"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(11)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If

                    Case PatientDetails.SBPData
                        If objUserRights.GoSocialPsychologicalBehavioralObservations = True Then 'Social Psychological Behavioral Observations
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "SPB"
                            oMenuItem.Tag = "Social Psychological Behavioral Observations"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(11)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If

                    Case PatientDetails.PastExams                                 'PastExams
                        If objUserRights.PatientPastExam = True Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Exam"
                            oMenuItem.Tag = "Add Exam"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(15)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If

                        Dim nRow As Integer = C1dgPatientDetails.HitTest(e.X, e.Y).Row
                        If nRow > 0 Then
                            ' If (C1dgPatientDetails.Rows.Count > 1) Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Specify Provider's Role"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(20)
                            oMenuItem.Tag = "Role"
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf Addroles

                            'View Diagnosis for the selected exam
                            _IsPastExam = True
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "View Diagnosis"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = imgList_Common.Images(15)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf oMenuItemViewDiagnosisClick


                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Generate CDA"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = imgList_Common.Images(34)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf oMenuItemGenCDAClick

                            'Code Start-Added by kanchan on 20101111 for ccd
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Generate CCD (old)"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = imgList_Common.Images(27)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf oMenuItemGenCCDClick
                            'Code End-Added by kanchan on 20101111 for ccd


                            'Developer:Sanjog Dhamke
                            'Date: 21 March 2012
                            'Bug PRD Name:Copy Exam Functionality
                            'Reason: To implement new functionality

                            'Added by Amit - 7020 Enable Copy Exam if setting is 1 then showing "Copy Exam" menu
                            Dim value As New Object()
                            Dim ogloSettings As New gloSettings.GeneralSettings(GetConnectionString())
                            ogloSettings.GetSetting("ENABLECOPYEXAM", 0, gnClinicID, value)
                            ogloSettings.Dispose()
                            ogloSettings = Nothing

                            If value = "1" Then
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Copy Exam"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = imgList_Common.Images(31)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf CopyPastExam
                                'Sanjog
                            End If
                            value = Nothing
                        End If

                    Case PatientDetails.PatientLetters
                        If objUserRights.PatientLetters = True Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Patient Letter"
                            oMenuItem.Tag = " Add Patient Letter"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(18)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If
                    Case PatientDetails.PatientConsent
                        If objUserRights.PatientConcent = True Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Patient Consent"
                            oMenuItem.Tag = " Add Patient Consent"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(17)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If
                    Case PatientDetails.DisclosureManagement
                        If objUserRights.DislocureMgmt = True Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Disclosure Management"
                            oMenuItem.Tag = " Add Disclosure Management"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(19)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                        End If
                    Case PatientDetails.NurseNotes
                        If objUserRights.NurseNotes = True Then
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Nurses Notes"
                            oMenuItem.Tag = "Add Nurses Notes"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(16)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AddPatientDetails

                        End If
                    Case PatientDetails.PatientAppointments
                        _IsFromAppointment = False
                        FillAppointmentMenus(_IsFromAppointmentforTemplatePrint)

                    Case PatientDetails.Billing, PatientDetails.Balance
                    Case PatientDetails.Referrals
                        oMenuItem = New ToolStripMenuItem
                        oMenuItem.Text = "Add Referral"
                        oMenuItem.Tag = "Add Referral"
                        oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                        oMenuItem.Image = Imgts_PatientDetails.Images(29)

                        Dim nRow As Integer
                        nRow = C1dgPatientDetails.HitTest(e.X, e.Y).Row
                        If nRow > 0 Then
                            C1dgPatientDetails.Row = nRow
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Remove Referral"
                            oMenuItem.Tag = "Remove Referral"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(30)

                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Modify Referral"
                            oMenuItem.Tag = "Modify Referral"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(34)
                            cmnuPatientDetails.Items.Add(oMenuItem)

                        End If
                        ''To open Triage form to Add new triage on PatientDetails box
                    Case PatientDetails.Triage
                        Dim _SelRow As Integer = C1dgPatientDetails.HitTest(e.X, e.Y).Row

                        'code change by dipak 20090821
                        ' if statement "If _SelRow >= 1" moved down to solve the bug #1571 Triage > Application not Shows  'Right Click Context menu'.
                        C1dgPatientDetails.Row = _SelRow
                        '
                        'Try
                        '    If (IsNothing(C1dgPatientDetails.ContextMenuStrip) = False) Then
                        '        C1dgPatientDetails.ContextMenuStrip.Dispose()
                        '        C1dgPatientDetails.ContextMenuStrip = Nothing
                        '    End If
                        'Catch ex As Exception

                        'End Try

                        'C1dgPatientDetails.ContextMenuStrip = Nothing
                        ClearContextMenuStrip(C1dgPatientDetails.ContextMenuStrip)
                        ClearContextMenuStrip(C1Triage.ContextMenuStrip)
                        ClearContextMenuStrip(cmnuPatientDetails)

                        If e.Button = Windows.Forms.MouseButtons.Right Then
                            '                            cmnuPatientDetails.Items.Clear()
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Add Triage"
                            oMenuItem.Tag = "Add Triage"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(31)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf On_AddNewTriage_Click
                        End If

                    Case PatientDetails.PriorAuthorization
                        Dim _SelRow As Integer = C1dgPatientDetails.HitTest(e.X, e.Y).Row
                        'code change by dipak 20090821
                        ' if statement "If _SelRow >= 1" moved down to solve the bug #1571 Triage > Application not Shows  'Right Click Context menu'.
                        C1dgPatientDetails.Row = _SelRow
                        '
                        'Try
                        '    If (IsNothing(C1dgPatientDetails.ContextMenuStrip) = False) Then
                        '        C1dgPatientDetails.ContextMenuStrip.Dispose()
                        '        C1dgPatientDetails.ContextMenuStrip = Nothing
                        '    End If
                        'Catch ex As Exception

                        'End Try
                        ClearContextMenuStrip(C1dgPatientDetails.ContextMenuStrip)
                        ClearContextMenuStrip(C1Triage.ContextMenuStrip)
                        ClearContextMenuStrip(cmnuPatientDetails)

                        'C1dgPatientDetails.ContextMenuStrip = Nothing
                        If e.Button = Windows.Forms.MouseButtons.Right Then
                            If _SelRow > 0 Then
                                '                                cmnuPatientDetails.Items.Clear()
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Modify Prior Authorization"
                                oMenuItem.Tag = "Modify Prior Authorization"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(35)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf C1dgPatientDetails_DoubleClick
                            End If
                        End If
                    Case PatientDetails.PatientTasks

                        cmnuPatientDetails.Items.Clear()

                        Dim ResTask As System.ComponentModel.ComponentResourceManager = New System.ComponentModel.ComponentResourceManager(GetType(MainMenu))
                        oMenuItem = New ToolStripMenuItem
                        oMenuItem.Text = "New Task"
                        oMenuItem.Tag = "New Task"
                        oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                        oMenuItem.Image = CType(ResTask.GetObject("cmnuItem_NewTask.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(54)
                        cmnuPatientDetails.Items.Add(oMenuItem)
                        AddHandler oMenuItem.Click, AddressOf cmnuItem_NewTask_Click

                        If _nRow > 0 Then

                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Edit Task"
                            oMenuItem.Tag = "Edit Task"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(54)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf Edit_Task

                            'oMenuItem = New ToolStripMenuItem
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Accept Task"
                            oMenuItem.Tag = "Accept Task"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = CType(ResTask.GetObject("cmnuItem_AcceptTask.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(40)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf AcceptTask

                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Decline Task"
                            oMenuItem.Tag = "Decline Task"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = CType(ResTask.GetObject("cmnuItem_RejectTask.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(47)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf DeclineTask


                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Mark Completed"
                            oMenuItem.Tag = "100"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = CType(ResTask.GetObject("cmnuItem_CompleteTask.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(39)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf CompleteTask

                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Delete"
                            oMenuItem.Tag = "Delete"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = CType(ResTask.GetObject("cmnuItem_DeleteTask.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(55)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf Delete_Task

                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Follow Up"
                            oMenuItem.Tag = "Follow Up"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = CType(ResTask.GetObject("cmnuItem_FollowUpTask.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(56)
                            cmnuPatientDetails.Items.Add(oMenuItem)


                            Dim oTaskMail As New gloTasksMails.gloTaskMail(GetConnectionString)
                            Dim oFollowUps As gloTasksMails.Common.Followups = Nothing

                            Try


                                oFollowUps = oTaskMail.GetFollowUps()

                                If oFollowUps IsNot Nothing AndAlso oFollowUps.Count > 0 Then
                                    For i As Integer = 0 To oFollowUps.Count - 1
                                        oChildItem = New ToolStripMenuItem()
                                        oChildItem.Text = oFollowUps(i).Description
                                        oChildItem.Name = oFollowUps(i).Description
                                        oChildItem.ForeColor = Color.FromArgb(31, 73, 125)
                                        oChildItem.Tag = oFollowUps(i).ID
                                        If oFollowUps(i).Description.ToUpper() = "TODAY" Then
                                            oChildItem.Image = Imgts_PatientDetails.Images(48)

                                        ElseIf oFollowUps(i).Description.ToUpper() = "Tomorrow" Then
                                            oChildItem.Image = Imgts_PatientDetails.Images(49)
                                        ElseIf oFollowUps(i).Description.ToUpper() = "NO DATE" Then
                                            oChildItem.Image = Imgts_PatientDetails.Images(50)
                                        Else
                                            oChildItem.Image = Imgts_PatientDetails.Images(51)
                                        End If
                                        oMenuItem.DropDownItems.Add(oChildItem)
                                        AddHandler oChildItem.Click, AddressOf Change_Followup
                                    Next
                                End If
                            Catch ex As Exception
                                MessageBox.Show("ERROR : " + ex.Message, _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                            Finally
                                If oFollowUps IsNot Nothing Then
                                    oFollowUps.Dispose()
                                End If
                            End Try


                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Priority"
                            oMenuItem.Tag = "Priority"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = CType(ResTask.GetObject("cmnuItem_Priority.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(52)
                            cmnuPatientDetails.Items.Add(oMenuItem)


                            Dim oPriorities As gloTasksMails.Common.Priorities = Nothing
                            Try
                                oPriorities = oTaskMail.GetPriorities()
                                If oPriorities IsNot Nothing AndAlso oPriorities.Count > 0 Then
                                    For i As Integer = 0 To oPriorities.Count - 1
                                        oChildItem = New ToolStripMenuItem()
                                        oChildItem.Text = oPriorities(i).Description
                                        oChildItem.Name = oPriorities(i).Description
                                        oChildItem.ForeColor = Color.FromArgb(31, 73, 125)
                                        oChildItem.Tag = oPriorities(i).ID
                                        If oPriorities(i).PriorityLevel = 1 Then
                                            oChildItem.Image = Imgts_PatientDetails.Images(53)
                                        ElseIf oPriorities(i).PriorityLevel = 2 Then

                                        ElseIf oPriorities(i).PriorityLevel = 3 Then
                                            oChildItem.Image = Imgts_PatientDetails.Images(52)
                                        End If
                                        oMenuItem.DropDownItems.Add(oChildItem)
                                        AddHandler oChildItem.Click, AddressOf Change_Priority
                                    Next
                                End If
                            Catch ex As Exception
                                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
                            Finally
                                If IsNothing(oPriorities) = False Then
                                    oPriorities.Dispose()
                                    oPriorities = Nothing
                                End If
                            End Try

                            'oMenuItem = New ToolStripMenuItem 'slr why twice
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Partial completion options"
                            oMenuItem.Tag = "Partial completion options"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = CType(ResTask.GetObject("cmunItem_Completed.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(46)
                            cmnuPatientDetails.Items.Add(oMenuItem)

                            oChildItem = New ToolStripMenuItem
                            oChildItem.Text = "0 %"
                            oChildItem.Tag = "0"
                            oChildItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oChildItem.Image = CType(ResTask.GetObject("cmnuItem_0Percent.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(41)
                            oMenuItem.DropDownItems.Add(oChildItem)
                            AddHandler oChildItem.Click, AddressOf CompleteTask

                            oChildItem = New ToolStripMenuItem
                            oChildItem.Text = "25 %"
                            oChildItem.Tag = "25"
                            oChildItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oChildItem.Image = CType(ResTask.GetObject("cmnuItem_25Percent.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(42)
                            oMenuItem.DropDownItems.Add(oChildItem)
                            AddHandler oChildItem.Click, AddressOf CompleteTask

                            oChildItem = New ToolStripMenuItem
                            oChildItem.Text = "50 %"
                            oChildItem.Tag = "50"
                            oChildItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oChildItem.Image = CType(ResTask.GetObject("cmnuItem_50Percent.Image"), System.Drawing.Image)
                            oMenuItem.DropDownItems.Add(oChildItem)
                            AddHandler oChildItem.Click, AddressOf CompleteTask

                            oChildItem = New ToolStripMenuItem
                            oChildItem.Text = "75 %"
                            oChildItem.Tag = "75"
                            oChildItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oChildItem.Image = CType(ResTask.GetObject("cmnuItem_75Percent.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(44)
                            oMenuItem.DropDownItems.Add(oChildItem)
                            AddHandler oChildItem.Click, AddressOf CompleteTask

                            oChildItem = New ToolStripMenuItem
                            oChildItem.Text = "100 %"
                            oChildItem.Tag = "100"
                            oChildItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oChildItem.Image = CType(ResTask.GetObject("cmnuItem_100Percent.Image"), System.Drawing.Image) 'Imgts_PatientDetails.Images(45)
                            oMenuItem.DropDownItems.Add(oChildItem)
                            AddHandler oChildItem.Click, AddressOf CompleteTask

                            'oMenuItem = New ToolStripMenuItem
                            'oMenuItem.Text = "Track Tasks"
                            'oMenuItem.Tag = "Track Tasks"
                            'oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            'oMenuItem.Image = Imgts_PatientDetails.Images(39)
                            'cmnuPatientDetails.Items.Add(oMenuItem)
                            'AddHandler oMenuItem.Click, AddressOf TrackTask

                            'All ContextMenu Visible False
                            'cmnuPatientDetails.Items(0).Visible = False 'Edit
                            'cmnuPatientDetails.Items(1).Visible = False 'Accept
                            'cmnuPatientDetails.Items(2).Visible = False 'Decline
                            'cmnuPatientDetails.Items(3).Visible = False 'Mark Complete
                            'cmnuPatientDetails.Items(4).Visible = False 'Delete
                            'cmnuPatientDetails.Items(5).Visible = False 'Follow Up
                            'cmnuPatientDetails.Items(6).Visible = False 'Priority
                            'cmnuPatientDetails.Items(7).Visible = False 'Partial 

                            cmnuPatientDetails.Items(0).Visible = False 'New Task
                            cmnuPatientDetails.Items(1).Visible = False 'Edit
                            cmnuPatientDetails.Items(2).Visible = False 'Accept
                            cmnuPatientDetails.Items(3).Visible = False 'Decline
                            cmnuPatientDetails.Items(4).Visible = False 'Mark Complete
                            cmnuPatientDetails.Items(5).Visible = False 'Delete
                            cmnuPatientDetails.Items(6).Visible = False 'Follow Up
                            cmnuPatientDetails.Items(7).Visible = False 'Priority
                            cmnuPatientDetails.Items(8).Visible = False 'Partial 

                            'IF Task not Yet Accepted only Accept and  Decline

                            If C1dgPatientDetails.GetData(_nRow, Col_View_Status) = "Not Yet Accepted" Then
                                If C1dgPatientDetails.GetData(_nRow, Col_View_Owner) = gstrLoginName Then
                                    'cmnuPatientDetails.Items(1).Visible = True
                                    'cmnuPatientDetails.Items(2).Visible = True
                                    cmnuPatientDetails.Items(2).Visible = True
                                    cmnuPatientDetails.Items(3).Visible = True
                                End If
                            ElseIf C1dgPatientDetails.GetData(_nRow, Col_View_Owner) = gstrLoginName Then
                                'cmnuPatientDetails.Items(0).Visible = True 'Edit
                                'cmnuPatientDetails.Items(1).Visible = False 'Accept
                                'cmnuPatientDetails.Items(2).Visible = False 'Decline
                                'cmnuPatientDetails.Items(3).Visible = True 'Mark Complete
                                'cmnuPatientDetails.Items(4).Visible = True 'Delete
                                'cmnuPatientDetails.Items(5).Visible = True 'Follow Up
                                'cmnuPatientDetails.Items(6).Visible = True 'Priority
                                'cmnuPatientDetails.Items(7).Visible = True 'Partial 

                                cmnuPatientDetails.Items(0).Visible = True 'New Task
                                cmnuPatientDetails.Items(1).Visible = True 'Edit
                                cmnuPatientDetails.Items(2).Visible = False 'Accept
                                cmnuPatientDetails.Items(3).Visible = False 'Decline
                                cmnuPatientDetails.Items(4).Visible = True 'Mark Complete
                                cmnuPatientDetails.Items(5).Visible = True 'Delete
                                cmnuPatientDetails.Items(6).Visible = True 'Follow Up
                                cmnuPatientDetails.Items(7).Visible = True 'Priority
                                cmnuPatientDetails.Items(8).Visible = True 'Partial 


                            Else
                                MessageBox.Show("You are not the owner of this task.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                            End If
                            If (IsNothing(oTaskMail) = False) Then
                                oTaskMail.Dispose()
                                oTaskMail = Nothing
                            End If
                        End If

                        ResTask = Nothing

                    Case PatientDetails.patientCases
                        cmnuPatientDetails.Items.Clear()

                        oMenuItem = New ToolStripMenuItem
                        oMenuItem.Text = "New Cases"
                        oMenuItem.Tag = "New Cases"
                        oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                        oMenuItem.Image = Imgts_PatientDetails.Images(57)
                        cmnuPatientDetails.Items.Add(oMenuItem)
                        AddHandler oMenuItem.Click, AddressOf AddCases

                        If _nRow > 0 Then


                            ' oMenuItem = New ToolStripMenuItem  Slr why twice
                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Modify Cases"
                            oMenuItem.Tag = "Modify Cases"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(58)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf ModifyCases


                        End If


                    Case PatientDetails.IntuitCommunication
                        If _nRow > 0 Then
                            PatientDetailsRowClickIndex = C1dgPatientDetails.HitTest(e.X, e.Y).Row
                            IntuitMsgreadUnread = Convert.ToBoolean(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("bIsReadFlag"))
                            IntuitCommDetailId = Convert.ToInt64(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("nCommDetailID"))
                            IntuitMessageFrom = Convert.ToString(C1dgPatientDetails.Rows(PatientDetailsRowClickIndex)("Sender"))
                            IntuitMessageTo = Convert.ToString(C1dgPatientDetails.Rows(C1dgPatientDetails.HitTest(e.X, e.Y).Row)("Receiver"))
                            IntuitMessageDate = Convert.ToString(C1dgPatientDetails.Rows(C1dgPatientDetails.HitTest(e.X, e.Y).Row)("dCommCreationDate"))
                            IntuitMessageSubject = Convert.ToString(C1dgPatientDetails.Rows(C1dgPatientDetails.HitTest(e.X, e.Y).Row)("sCommSubject"))
                            IntuitMessageType = Convert.ToBoolean(C1dgPatientDetails.Rows(C1dgPatientDetails.HitTest(e.X, e.Y).Row)("bCommMessageType"))
                            IntuitMessageBody = Convert.ToString(C1dgPatientDetails.Rows(C1dgPatientDetails.HitTest(e.X, e.Y).Row)("sCommMessage"))
                            IntuitMessageStaffId = Convert.ToInt64(C1dgPatientDetails.Rows(C1dgPatientDetails.HitTest(e.X, e.Y).Row)("nCommStaffID"))
                            IntuitMessageContainerId = Convert.ToInt64(C1dgPatientDetails.Rows(C1dgPatientDetails.HitTest(e.X, e.Y).Row)("nCommContainerID"))
                            IntuitServiceType = Convert.ToString(C1dgPatientDetails.Rows(C1dgPatientDetails.HitTest(e.X, e.Y).Row)("sCommServiceType"))
                            cmnuPatientDetails.Items.Clear()

                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Open"
                            oMenuItem.Tag = "Open"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(70)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf OpenIntuitMessage

                            oMenuItemSeperator = New ToolStripSeparator
                            cmnuPatientDetails.Items.Add(oMenuItemSeperator)

                            If IntuitMessageType Then
                                oMenuItem = New ToolStripMenuItem
                                oMenuItem.Text = "Reply"
                                oMenuItem.Tag = "Reply"
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItem.Image = Imgts_PatientDetails.Images(62)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf ReplyIntuitMessage
                            End If


                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Create Task"
                            oMenuItem.Tag = "Create Task"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(63)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf CreateIntuitTask

                            oMenuItemSeperator = New ToolStripSeparator
                            cmnuPatientDetails.Items.Add(oMenuItemSeperator)



                            If IntuitMessageType Then

                                oMenuItem = New ToolStripMenuItem
                                If IntuitMsgreadUnread Then
                                    oMenuItem.Text = "Mark as Unread"
                                    oMenuItem.Tag = "Mark as Unread"
                                    oMenuItem.Image = Imgts_PatientDetails.Images(67)
                                    IntuitMessageStatus = "Mark as Unread"
                                ElseIf Not IntuitMsgreadUnread Then
                                    oMenuItem.Text = "Mark as Read"
                                    oMenuItem.Tag = "Mark as Read"
                                    oMenuItem.Image = Imgts_PatientDetails.Images(66)
                                    IntuitMessageStatus = "Mark as Read"
                                End If
                                oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                cmnuPatientDetails.Items.Add(oMenuItem)
                                AddHandler oMenuItem.Click, AddressOf MarkReadUnread

                                oMenuItemSeperator = New ToolStripSeparator
                                cmnuPatientDetails.Items.Add(oMenuItemSeperator)
                            End If

                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Delete"
                            oMenuItem.Tag = "Delete"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(64)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf DeleteIntuitMessage

                            oMenuItemSeperator = New ToolStripSeparator
                            cmnuPatientDetails.Items.Add(oMenuItemSeperator)

                            oMenuItem = New ToolStripMenuItem
                            oMenuItem.Text = "Send New Patient Portal Message to Patient"
                            oMenuItem.Tag = "Send New Patient Portal Message to Patient"
                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                            oMenuItem.Image = Imgts_PatientDetails.Images(65)
                            cmnuPatientDetails.Items.Add(oMenuItem)
                            AddHandler oMenuItem.Click, AddressOf SendNewIntuitSecureMessage

                            cmnuPatientDetails.Items(0).Visible = True 'Edit
                            cmnuPatientDetails.Items(1).Visible = True 'Accept
                            cmnuPatientDetails.Items(2).Visible = True 'Decline
                            cmnuPatientDetails.Items(3).Visible = True 'Mark Complete
                            cmnuPatientDetails.Items(4).Visible = True
                            'If gblnIntuitCommunication = False Then
                            '    cmnuPatientDetails.Items(4).Visible = False
                            'Else
                            '    If objUserRights.Intuit = True Then
                            '        cmnuPatientDetails.Items(4).Visible = True
                            '    Else
                            '        cmnuPatientDetails.Items(4).Visible = False
                            '    End If
                            'End If
                        End If
                    Case PatientDetails.Order               ''added to modify and view order                   
                        If objUserRights.OrdersAndResultsSetup = True Then

                            If C1dgPatientDetails.Rows.Count > 1 Then
                                If _nRow > 0 Then ''''added for bugid 70607, to disable right click on header row v8022
                                    oMenuItem = New ToolStripMenuItem
                                    oMenuItem.Text = "Generate CDA"
                                    oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                    oMenuItem.Image = imgList_Common.Images(34)
                                    cmnuPatientDetails.Items.Add(oMenuItem)
                                    AddHandler oMenuItem.Click, AddressOf oMenuItemGenCDAFromOrderClick



                                    oMenuItem = New ToolStripMenuItem
                                    oMenuItem.Text = "View Order"
                                    oMenuItem.Tag = "View Order"
                                    oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                    oMenuItem.Image = Imgts_PatientDetails.Images(73)
                                    cmnuPatientDetails.Items.Add(oMenuItem)
                                    AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                                    oMenuItem = Nothing
                                    oMenuItem = New ToolStripMenuItem
                                    oMenuItem.Text = "Modify Order"
                                    oMenuItem.Tag = "Modify Order"
                                    oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                    oMenuItem.Image = Imgts_PatientDetails.Images(74)
                                    cmnuPatientDetails.Items.Add(oMenuItem)
                                    AddHandler oMenuItem.Click, AddressOf AddPatientDetails
                                End If
                            End If
                        End If
                    Case PatientDetails.PatientEducation
                        oMenuItem = New ToolStripMenuItem
                        oMenuItem.Text = "Add Patient Education"
                        oMenuItem.Tag = "Add Patient Education"
                        oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                        oMenuItem.Image = Imgts_PatientDetails.Images(75)
                        cmnuPatientDetails.Items.Add(oMenuItem)
                        AddHandler oMenuItem.Click, AddressOf AddPatientDetails





                End Select
                'Try
                '    If (IsNothing(C1dgPatientDetails.ContextMenuStrip) = False) Then
                '        C1dgPatientDetails.ContextMenuStrip.Dispose()
                '        C1dgPatientDetails.ContextMenuStrip = Nothing
                '    End If
                'Catch ex As Exception

                'End Try
                C1dgPatientDetails.ContextMenuStrip = cmnuPatientDetails
                AssignContextMenuStrip(C1dgPatientDetails.ContextMenuStrip, cmnuPatientDetails)
                AssignContextMenuStrip(C1Triage.ContextMenuStrip, cmnuPatientDetails)
            End If  '' If e.Button = MouseButtons.Right Then



        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)


        End Try
    End Sub

    Private Sub Addroles(ByVal sender As Object, ByVal e As EventArgs)
        Try
            GetControlSelection()
            GridSelect_RowCount = C1dgPatientDetails.Rows.Count
            Dim oCurrentMenu As ToolStripMenuItem = CType(sender, ToolStripMenuItem)
            Dim ofrmAddRoles As New frmAddRoles(Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0)))
            ofrmAddRoles.ShowDialog(IIf(IsNothing(ofrmAddRoles.Parent), Me, ofrmAddRoles.Parent))
            ofrmAddRoles.Dispose()
            ShowPatientDetails(, True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)


        End Try
    End Sub

    Private Sub oMenuItemGenCDAFromOrderClick(ByVal sender As Object, ByVal e As EventArgs)
        Dim orderid As Long = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 2)
        Dim OrderDetails As String = ""
        If Not IsNothing(GloUC_TransactionHistory1) Then
            OrderDetails = GloUC_TransactionHistory1.GetOrderDetails(orderid)
        Else
            GloUC_TransactionHistory1 = New gloUserControlLibrary.gloUC_TransactionHistory()
            OrderDetails = GloUC_TransactionHistory1.GetOrderDetails(orderid)
            GloUC_TransactionHistory1.Dispose()
            GloUC_TransactionHistory1 = Nothing
        End If
        openCDA(orderid, OrderDetails)
    End Sub

    Private Sub Get_PatientDetails()
        Try
            Using dtPatient As DataTable = GetPatientInfo(gnPatientID)
                If Not IsNothing(dtPatient) AndAlso dtPatient.Rows.Count > 0 Then
                    _patientInfo = dtPatient.Rows(0)
                End If

            End Using
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Prescription, gloAuditTrail.ActivityCategory.CreatePrescription, gloAuditTrail.ActivityType.Close, ex.ToString(), gloAuditTrail.ActivityOutCome.Failure)
            ex = Nothing
        End Try
    End Sub

    Private _pharmacyInfo As DataRow = Nothing
    Public Property PharmacyInfo() As DataRow
        Get
            Return _pharmacyInfo
        End Get
        Set(ByVal value As DataRow)
            _pharmacyInfo = value
        End Set
    End Property

    Private _providerInfo As DataRow = Nothing
    Public Property ProviderInfo() As DataRow
        Get
            Return _providerInfo
        End Get
        Set(ByVal value As DataRow)
            _providerInfo = value
        End Set
    End Property

    Private Sub AddPatientDetails(ByVal sender As Object, ByVal e As EventArgs)
        Try
            GetControlSelection()
            GridSelect_RowCount = C1dgPatientDetails.Rows.Count
            _isShowDialogueForm = True
            RegisterMyHotKey()
            If IsAccess(False) = False Then
                Exit Sub
            End If
            GetControlSelection()
            GridSelect_RowCount = C1dgPatientDetails.Rows.Count

            Dim oCurrentMenu As ToolStripMenuItem = CType(sender, ToolStripMenuItem)

            Select Case SelectedPatientDetail
                Case PatientDetails.History
                    mnuPatientHistory_Click(sender, e)
                Case PatientDetails.Medication
                    mnuPatientMedication_Click(sender, e)
                Case PatientDetails.Prescription
                    Dim nPrescriptionId As Int64 = 0
                    Dim sPharmacyNotes As String = ""
                    If sender.Tag = "Add Pharmacy Notes" Then ''''''''''Case Number: GLO2008-0001699
                        If C1dgPatientDetails.RowSel > 0 Then
                            'PRD : PRD EMR 6030_XXXX Rx Workflow, Configurable Rx Formats functionality changes
                            'CR : #CR00001071: Added column 'Pharmacy' in patient details on dashborad
                            nPrescriptionId = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 14) '''''''''''''''13 is for prescriptionId
                            sPharmacyNotes = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 13) '''''''''''''''12 is for PharmacyNotes
                        End If

                        Dim ofrmAddPhNotes As New frmAddPharmacyNotest(gnPatientID, nPrescriptionId, sPharmacyNotes) ''''''''Case Number: GLO2008-0001699
                        ofrmAddPhNotes.ShowDialog(IIf(IsNothing(ofrmAddPhNotes.Parent), Me, ofrmAddPhNotes.Parent))
                        ShowPatientDetails(, True)
                        If Not IsNothing(ofrmAddPhNotes) Then ''Slr free ofrmaddphnotes
                            ofrmAddPhNotes.Close()
                            ofrmAddPhNotes.Dispose()
                            ofrmAddPhNotes = Nothing
                        End If
                    ElseIf sender.Tag = "Show eRx status" Then

                        Dim eRxStatus As String = ""
                        Dim eRxStatusMessage As String = ""
                        If C1dgPatientDetails.RowSel > 0 Then
                            If Not IsNothing(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 8)) Then
                                eRxStatus = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 8)
                            Else
                                eRxStatus = ""
                            End If

                            If Not IsNothing(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 9)) Then
                                eRxStatusMessage = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 9)
                            Else
                                eRxStatusMessage = ""
                            End If


                            If eRxStatusMessage <> "" Then
                                MessageBox.Show(eRxStatusMessage, "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                            ElseIf eRxStatus <> "" Then '''''show what was saved in eRxStatus field
                                MessageBox.Show(eRxStatus, "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                            Else ''''''bug fixed 2780
                                MessageBox.Show("No status message available.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                            End If
                        End If
                    ElseIf sender.Tag = "Show RxFill Notifications" Then
                        Dim dtVisitDate As Date

                        If C1dgPatientDetails.RowSel > 0 Then
                            dtVisitDate = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0)
                            nPrescriptionId = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 14) '''''''''''''''13 is for prescriptionId


                            Dim ofrmRxFillNotifications As frmRxFillNotification = Nothing

                            ofrmRxFillNotifications = frmRxFillNotification.GetInstance(gnPatientID, nPrescriptionId, dtVisitDate)
                            If IsNothing(ofrmRxFillNotifications) = True Then
                                Exit Sub
                            End If

                            Using helper As New gloEMRGeneralLibrary.PrescriptionBusinessLayer()
                                Dim dtRxFillReqs As DataTable = helper.GetRxFillRequestsById(nPrescriptionId, gloEMRGeneralLibrary.PrescriptionBusinessLayer.IDType.PrescriptionID)

                                If dtRxFillReqs IsNot Nothing Then
                                    If dtRxFillReqs.Rows.Count > 0 Then
                                        ofrmRxFillNotifications.ShowDialog(IIf(IsNothing(ofrmRxFillNotifications.Parent), Me, ofrmRxFillNotifications.Parent))

                                        ShowPatientDetails(, True)
                                    Else
                                        MessageBox.Show("No RxFill notifications received for this prescription.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    End If
                                Else
                                    MessageBox.Show("No RxFill notifications received for this prescription.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                End If
                            End Using

                            If Not IsNothing(ofrmRxFillNotifications) Then ''Slr free ofrmaddphnotes
                                ofrmRxFillNotifications.Close()
                                ofrmRxFillNotifications.Dispose()
                                ofrmRxFillNotifications = Nothing
                            End If
                        End If
                    ElseIf sender.tag = "CancelRx Response" Then
                        Dim dtCancelResponses As DataTable = Nothing
                        Dim sPrescriberOrderNumber As String = ""
                        Dim nPrescriberOrderNumber As Int64 = 0

                        If C1dgPatientDetails.RowSel > 0 Then
                            If Not IsNothing(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 14)) Then
                                sPrescriberOrderNumber = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 14)
                            Else
                                sPrescriberOrderNumber = ""
                            End If

                            If Int64.TryParse(sPrescriberOrderNumber, nPrescriberOrderNumber) Then
                                Dim frmCancelRxResponses As New frmCancelRxResponses(nPrescriberOrderNumber, gnPatientID)

                                If frmCancelRxResponses.XMLData IsNot Nothing AndAlso Not String.IsNullOrWhiteSpace(frmCancelRxResponses.XMLData) Then                                    
                                    frmCancelRxResponses.ShowDialog(Me)
                                Else
                                    MessageBox.Show("No CancelRx Response was found for this request", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                End If
                            End If
                        End If

                    ElseIf sender.tag = "Cancel Prescription" Then
                        SendCancelRx("C")
                        Call ShowPatientDetails(True)
                    ElseIf sender.tag = "Discontinue Prescription" Then
                        SendCancelRx("D")
                        Call ShowPatientDetails(True)
                    Else
                        mnuPatientPrescription_Click(sender, e)
                    End If

                Case PatientDetails.OrderTemplates
                    mnuPatient_RadiologyOrders_Click(sender, e)
                Case PatientDetails.Vitals
                    mnuPatientVitals_Click(sender, e)
                Case PatientDetails.Messages
                    mnuPatientMessages_Click(sender, e)
                Case PatientDetails.ProblemList
                    '' to Add New Problem List
                    ''Bug #78099: 00000828: Record locking.
                    Try
                        Dim blnRecordLock As Boolean = False
                        If gblnRecordLocking = True Then
                            Dim mydt As mytable ''slr new not needed 
                            ' mydt = New mytable  twice slr
                            mydt = Scan_n_Lock_Transaction(TrnType.ProblemList, gnPatientID, 0, Now)
                            If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                If MessageBox.Show("This patients problem lists are being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot Modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                    blnRecordLock = True
                                Else
                                    Exit Sub
                                End If
                            End If
                        End If

                        Dim frm As New frmProblemList(0, GenerateVisitID(Now.Date, gnPatientID), gnPatientID, blnRecordLock)
                        frm.ShowMessageForPendingReconciliation()

                        frm.MdiParent = Me
                        ''Sanjog Added on 2011 feb 28 to visible the Exam button in Problem list form
                        frmProblemList.blnRxMedFromExam = False
                        frmProblemList.blnOpenFromExam = False
                        ''Sanjog Added on 2011 feb 28 to visible the Exam button in Problem list form
                        frm.WindowState = FormWindowState.Maximized

                        frm.Show()

                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False


                    Catch ex As Exception
                        MessageBox.Show(ex.ToString())
                    Finally

                    End Try

                Case PatientDetails.PastExams
                    NewExam()

                Case PatientDetails.SBPData
                    Try

                        Dim sConnectionString As String = GetConnectionString()
                        Dim oSBPTransaction As New frmSBPTransaction(gnPatientID, sConnectionString)
                        oSBPTransaction.MdiParent = Me
                        oSBPTransaction.WindowState = FormWindowState.Maximized
                        oSBPTransaction.Show()
                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False
     



                    Catch ex As Exception
                      
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                        MessageBox.Show(Me, ex.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
                    Finally
                 
                    End Try
                Case PatientDetails.PatientLetters
                    NewOrUpdateLetters(False)
                Case PatientDetails.PatientConsent
                    NewOrUpdateConsent(False)
                Case PatientDetails.DisclosureManagement
                    NewOrUpdateDisclosureDetrails(False)
                Case PatientDetails.NurseNotes
                    NewOrUpdateNursesNotes(False)
                Case PatientDetails.PatientAppointments
                    AddAppointment()
                Case PatientDetails.Insurance

                Case PatientDetails.Order ''added to  view order
                    If sender.Tag = "View Order" Then ''''''''''
                        If C1dgPatientDetails.RowSel > 0 Then
                            Dim orderid As Long = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 2)
                            Dim frm As New frmViewgloLab(orderid, gnPatientID)
                            'Code added for Already lab order Is open
                            If (frm.CheckInstance() = True) Then  ''added for bugid 70331
                                MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                frm.Close()
                                If (IsNothing(frm) = False) Then
                                    frm.Dispose()
                                    frm = Nothing
                                End If
                                Exit Sub
                            End If

                            frm.MdiParent = Me
                            frm.SelectOrderTab = True
                            frm.WindowState = FormWindowState.Maximized

                            AddHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                            AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD

                            'Reason: To Open the Patient Letter & Referral Letter
                            AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                            AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                            AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                            AddHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                            AddHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                            AddHandler frm.Activated, AddressOf frmViewgloLab_Activated
                            AddHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                            ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                            AddHandler frm.EntOpenEducation, AddressOf OpenEducation
                            AddHandler frm.FormClosed, AddressOf ofrmViewgloLab_openEducationFormClosed

                            frm.objgloLabPatientExam = New clsPatientExams

                            frm.objgloLabPatientMessages = New clsMessage
                            frm.objgloLabPatientLetters = New clsPatientLetters
                            frm.objgloLabNurseNotes = New clsNurseNotes
                            frm.objgloLabHistory = New clsPatientHistory
                            frm.objgloLabLabs = New clsLabs
                            frm.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                            frm.objgloLabRxmed = New clsPatientDetails
                            frm.objgloLabOrders = New clsPatientDetails
                            frm.objgloLabProblemList = New clsPatientProblemList

                            frm.objgloLabCriteria = New DocCriteria
                            frm.objgloLabWord = New clsWordDocument

                            frm.LoginProviderID = gnLoginProviderID
                            ''added for Bug #68475:  
                            With frm.LabOrderParameter
                                .IsEditMode = False
                                .OrderID = orderid
                                .OrderNumberID = 0
                                .OrderNumberPrefix = "ORD"
                                .PatientID = gnPatientID
                                .VisitID = GenerateVisitID(gnPatientID)
                                .TransactionDate = Now
                                .CloseAfterSave = True

                            End With
                            Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
                            '  objclsSplit_Laborder.clsUCLabControl = New gloUserControlLibrary.gloUC_TransactionHistory()
                            objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn
                            frm.VisitID = gnVisitID
                            frm.clsSplit_Laborder = objclsSplit_Laborder
                            frm.Show()

                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False
                        End If


                    ElseIf sender.Tag = "Modify Order" Then  ''added to modify order
                        If C1dgPatientDetails.RowSel > 0 Then
                            GetControlSelection()
                            GridSelect_RowCount = C1dgPatientDetails.Rows.Count
                            Dim orderid As Long = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 2)
                            Dim frm As New frmViewgloLab(orderid, gnPatientID)
                            'Code added for Already lab order Is open
                            If (frm.CheckInstance() = True) Then   ''added for bugid 70331
                                MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                frm.Close()
                                If (IsNothing(frm) = False) Then
                                    frm.Dispose()
                                    frm = Nothing
                                End If
                                Exit Sub
                            End If

                            frm.MdiParent = Me
                            frm.SelectOrderTab = True
                            frm.WindowState = FormWindowState.Maximized

                            AddHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                            AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD

                            'Reason: To Open the Patient Letter & Referral Letter
                            AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                            AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                            AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                            AddHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                            AddHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                            AddHandler frm.Activated, AddressOf frmViewgloLab_Activated
                            AddHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                            ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                            AddHandler frm.EntOpenEducation, AddressOf OpenEducation
                            AddHandler frm.FormClosed, AddressOf ofrmViewgloLab_openEducationFormClosed

                            frm.objgloLabPatientExam = New clsPatientExams

                            frm.objgloLabPatientMessages = New clsMessage
                            frm.objgloLabPatientLetters = New clsPatientLetters
                            frm.objgloLabNurseNotes = New clsNurseNotes
                            frm.objgloLabHistory = New clsPatientHistory
                            frm.objgloLabLabs = New clsLabs
                            frm.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                            frm.objgloLabRxmed = New clsPatientDetails
                            frm.objgloLabOrders = New clsPatientDetails
                            frm.objgloLabProblemList = New clsPatientProblemList

                            frm.objgloLabCriteria = New DocCriteria
                            frm.objgloLabWord = New clsWordDocument

                            frm.LoginProviderID = gnLoginProviderID
                            ''added for Bug #68475:  
                            With frm.LabOrderParameter
                                .IsEditMode = False
                                .OrderID = orderid
                                .OrderNumberID = 0
                                .OrderNumberPrefix = "ORD"
                                .PatientID = gnPatientID
                                .VisitID = GenerateVisitID(gnPatientID)
                                .TransactionDate = Now
                                .CloseAfterSave = True

                            End With
                            ''changes added for split control functionality in orders&results
                            Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
                            objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn
                            frm.VisitID = gnVisitID
                            frm.clsSplit_Laborder = objclsSplit_Laborder



                            frm.Show()
                            frm.ShowModifyOrderFromDashboard()

                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False

                        End If
                    End If
                Case PatientDetails.PatientEducation
                    OpenPatient_Education()
            End Select

            'ShowPatientDetails()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            _isShowDialogueForm = False
            pnlFormularyTransactionMessage.Visible = False
            Me.Cursor = Cursors.Default
        End Try
    End Sub

    Private Sub SendCancelRx(ByVal CancelStatus As String)
        Dim RetMsg As String = Nothing
        Dim nPatientID As Int64 = 0
        Dim ss_helper As gloSureScript.gloSurescriptsHelper = Nothing
        Dim sMsg As String = ""
        Dim sCancellationType As String = ""
        Try
            ss_helper = New gloSureScript.gloSurescriptsHelper(gstrSurescriptServiceURL)
            ss_helper.LoginProviderID = gnLoginProviderID

            gloSureScript.gloSurescriptGeneral.ServerName = gstrSQLServerName
            gloSureScript.gloSurescriptGeneral.DatabaseName = gstrDatabaseName
            gloSureScript.gloSurescriptGeneral.sUserName = gstrSQLUserEMR
            gloSureScript.gloSurescriptGeneral.sPassword = gstrSQLPasswordEMR
            gloSureScript.gloSurescriptGeneral.gblnIsSQLAuthentication = gblnSQLAuthentication

            Dim sPrescriptionNo As String = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 14)
            Dim sDrugName As String = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 1)

            Get_PatientDetails()

            Dim dtMessages As DataTable = Nothing

            Using helper As New gloEMRGeneralLibrary.PrescriptionBusinessLayer()
                dtMessages = helper.GeteRxDetailsForCancelRx(sPrescriptionNo)
            End Using

            If CancelStatus = "C" Then
                sMsg = "You are about to cancel this prescription : " & sDrugName & System.Environment.NewLine() & "Are you sure ? "
                lblFormularyTransactionMessage.Text = "Sending Rx cancellation request..."
                sCancellationType = "Cancel"
            ElseIf CancelStatus = "D" Then
                sMsg = "You are about to discontinue this prescription : " & sDrugName & System.Environment.NewLine() & "Are you sure ? "
                lblFormularyTransactionMessage.Text = "Sending Rx discontinue request..."
                sCancellationType = "Discontinue"
            End If

            If MessageBox.Show(sMsg, gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Warning) = Windows.Forms.DialogResult.No Then
                Exit Sub
            End If

            Me.Cursor = Cursors.WaitCursor

            pnlFormularyTransactionMessage.Visible = True ''''
            pnlFormularyTransactionMessage.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            Dim PrescriptionId As Int64 = 0
            Int64.TryParse(sPrescriptionNo, PrescriptionId)

            Dim PharmacyID As Int64 = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 17))
            Dim ProviderID As Int64 = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 18))

            Dim medPrescribed As gloGlobal.Common.ServiceObjectBase.MedPrescribed = Nothing

            Using helper As New gloEMRGeneralLibrary.PrescriptionBusinessLayer()
                medPrescribed = helper.FillMedPrescribed(PrescriptionId)

                Using dtProvider As DataTable = helper.GetPatientProviderDetails(ProviderID)
                    If Not IsNothing(dtProvider) AndAlso dtProvider.Rows.Count > 0 Then
                        _providerInfo = dtProvider.Rows(0)
                    End If

                End Using

                Using dtPharmacy As DataTable = helper.GetPharmacyDetails(PharmacyID)
                    If dtPharmacy IsNot Nothing Then
                        If dtPharmacy.Rows.Count > 0 Then
                            _pharmacyInfo = dtPharmacy.Rows(0)
                        End If
                    End If
                End Using
            End Using


            If _patientInfo.Table.Columns.Contains("nPatientID") AndAlso Not IsDBNull(_patientInfo("nPatientID")) Then
                Dim sPatientID As String = Convert.ToString(_patientInfo("nPatientID"))
                Int64.TryParse(sPatientID, nPatientID)
            End If

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.CancelRx, gloAuditTrail.ActivityType.CancelOperation, "Sending CancelRx (" + sCancellationType + ") request", nPatientID, PrescriptionId, gnLoginProviderID, gloAuditTrail.ActivityOutCome.Success)

            If dtMessages IsNot Nothing Then
                If dtMessages.Rows.Count > 0 Then
                    RetMsg = ss_helper.SendCancelRxMessage(sPrescriptionNo, medPrescribed, _patientInfo, dtMessages, CancelStatus, gloEMRGeneralLibrary.gloGeneral.globalSecurity.gstrLoginName)
                Else
                    RetMsg = ss_helper.SendCancelRxMessage(sPrescriptionNo, medPrescribed, _patientInfo, _providerInfo, _pharmacyInfo, CancelStatus, gloEMRGeneralLibrary.gloGeneral.globalSecurity.gstrLoginName)
                End If
            Else
                RetMsg = ss_helper.SendCancelRxMessage(sPrescriptionNo, medPrescribed, _patientInfo, _providerInfo, _pharmacyInfo, CancelStatus, gloEMRGeneralLibrary.gloGeneral.globalSecurity.gstrLoginName)
            End If

            pnlFormularyTransactionMessage.Visible = False
            Me.Cursor = Cursors.Default

            If Not String.IsNullOrEmpty(RetMsg) Then
                MessageBox.Show(RetMsg, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)

                Using p As New gloSureScript.gloSureScriptDBLayer()
                    If CancelStatus = "C" Then
                        p.UpdateMedicationStatus(nPatientID, sPrescriptionNo, "Cancelled")
                    ElseIf CancelStatus = "D" Then
                        p.UpdateMedicationStatus(nPatientID, sPrescriptionNo, "Discontinued")
                    End If
                End Using
            End If


        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub ShowVitalsGraph(ByVal sender As Object, ByVal e As EventArgs)

        If IsNothing(gstrPatientDOB) = True OrElse gstrPatientDOB = "" Then
            Exit Sub
        Else
            Try
                Dim ageCal = DateDiff(DateInterval.Month, CType(gstrPatientDOB, Date), Date.Now.Date)
                Dim IsAgeGreater As Boolean = False

                ' check for the patient age is more than 3 years
                If ageCal > 240 Then
                    IsAgeGreater = True
                End If

                Dim Frm As New frmShowGraphs(IsAgeGreater, gnPatientID)
                With Frm
                    .Owner = Me
                    .ShowInTaskbar = False
                    .WindowState = FormWindowState.Maximized
                    ' .MdiParent = Me.MdiParent
                    ' .ShowDialog(IIf(IsNothing(Frm.Parent), Me, Frm.Parent))
                    .ShowDialog(Frm.Parent)
                End With
                If Not IsNothing(Frm) Then  ''Slr dispose frm
                    Frm.Close()
                    Frm.Dispose()
                    Frm = Nothing
                End If
                'catch block added by dipak 20091226 to fix bug no :3207 :-Vital > Chart > Could not load file or assembly 'MSDATASRC
            Catch ex As IO.FileNotFoundException
                If (ex.Message.Contains("AxInterop.MSChart20Lib")) Then
                    MessageBox.Show("The required components for Grapg chart are missing. Please install.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            Catch ex As Runtime.InteropServices.COMException
                If (ex.ToString().Contains("REGDB_E_CLASSNOTREG")) Then
                    MessageBox.Show("The required components for Graph chart are missing. Please install.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
                'End code added by dipak 20091226

            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        End If
    End Sub

    ''Sudhir 20090218 - Show Advance Chart on ContextMenu of Patient Details Grid
    Private Sub ShowAdvanceCharts(ByVal sender As Object, ByVal e As EventArgs)
        GetControlSelection()
        If gstrPatientGender = "Other" Then
            MessageBox.Show("No Growth Charts available for specified gender.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Exit Sub
        End If
        If IsNothing(gstrPatientDOB) = True OrElse gstrPatientDOB = "" Then
            Exit Sub
        Else
            Try


                Dim Frm As New frmAdvanceGraph(gnPatientID)
                Frm.Owner = Me
                Frm.MdiParent = Me
                Frm.ShowInTaskbar = False
                Frm.WindowState = FormWindowState.Maximized

                Frm.Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

                'catch block added by dipak 20091226 to fix bug no :3207 :-Vital > Chart > Could not load file or assembly 'MSDATASRC
            Catch ex As IO.FileNotFoundException
                If (ex.Message.Contains("GROWTHCHARTLib")) Then
                    MessageBox.Show("The required components for Advance chart are missing. Please install.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            Catch ex As Runtime.InteropServices.COMException
                If (ex.ToString().Contains("REGDB_E_CLASSNOTREG")) Then
                    MessageBox.Show("The required components for Advance chart are missing. Please install.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
                'End code added by dipak 20091226
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                ShowHideMainMenu(True, True)
                pnlMainToolBar.Visible = True


            End Try

        End If

    End Sub

    'Modify Patient Details
    Private Sub C1dgPatientDetails_DoubleClick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles C1dgPatientDetails.DoubleClick
        Try

            GridSelect_RowCount = C1dgPatientDetails.Rows.Count

            If SelectedPatientDetail = PatientDetails.ViewDocs Then
                If (objUserRights.DeceasedPatient = True) Then

                Else
                    If IsAccess(False) = False Then
                        Exit Sub
                    End If
                End If

            Else
                If IsAccess(False) = False Then
                    Exit Sub
                End If
            End If


            If gnPatientID <= 0 Then
                Exit Sub
            End If
            'if condition added by dipak to allow Open only Viewdocuments on doubleclick  document of Deceased patient

            'To check exception related to word
            If CheckWordForException() = False Then
                Exit Sub
            End If
            'End

            If C1dgPatientDetails.Row = PatientDetailsRowClickIndex Then



                If C1dgPatientDetails.Row > 0 Then
                    GetControlSelection()
                    GridSelect_RowCount = C1dgPatientDetails.Rows.Count
                    Select Case SelectedPatientDetail
                        Case PatientDetails.ProblemList

                            '' <><><> Record Level Locking <><><><> 
                            Try


                                Dim blnRecordLock As Boolean = False
                                If gblnRecordLocking = True Then
                                    Dim mydt As mytable ''slr new not needed 
                                    ' mydt = New mytable  twice slr
                                    mydt = Scan_n_Lock_Transaction(TrnType.ProblemList, gnPatientID, 0, Now)
                                    If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                        If MessageBox.Show("This patients problem lists are being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot Modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                            blnRecordLock = True
                                        Else
                                            Exit Sub
                                        End If
                                    End If
                                End If
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "problemid:strt", gloAuditTrail.ActivityOutCome.Success)

                                Dim _problemID As Int64 = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)    'ProblemID  


                                Dim _visitID As Int64 = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 6), Int64)      'VisitID  

                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "frm:strt", gloAuditTrail.ActivityOutCome.Success)

                                Dim frm As New frmProblemList(_problemID, _visitID, gnPatientID, blnRecordLock)
                                frm.ShowMessageForPendingReconciliation()

                                frm.MdiParent = Me
                                ''Sanjog Added on 2011 feb 28 to visible the Exam button in Problem list form
                                frmProblemList.blnRxMedFromExam = False
                                frmProblemList.blnOpenFromExam = False
                                ''Sanjog Added on 2011 feb 28 to visible the Exam button in Problem list form
                                frm.WindowState = FormWindowState.Maximized

                                frm.Show()

                                ShowHideMainMenu(False, False)
                                pnlMainToolBar.Visible = False


                            Catch ex As Exception
                                MessageBox.Show(ex.ToString())
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "frm:end", gloAuditTrail.ActivityOutCome.Success)
                            Finally

                            End Try

                        Case PatientDetails.Order  ''added for order prd 8020 changes 

                            Try
                                Dim orderid As Long = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 2)
                                Dim frm As New frmViewgloLab(orderid, gnPatientID)
                                'Code added for Already lab order Is open
                                If (frm.CheckInstance() = True) Then  ''added for bugid 70331
                                    MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    frm.Close()
                                    If (IsNothing(frm) = False) Then
                                        frm.Dispose()
                                        frm = Nothing
                                    End If
                                    Exit Sub
                                End If

                                frm.MdiParent = Me
                                frm.SelectOrderTab = True
                                frm.WindowState = FormWindowState.Maximized

                                AddHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                                AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD

                                'Reason: To Open the Patient Letter & Referral Letter
                                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                                AddHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                                AddHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                                AddHandler frm.Activated, AddressOf frmViewgloLab_Activated
                                AddHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                AddHandler frm.EntOpenEducation, AddressOf OpenEducation
                                AddHandler frm.FormClosed, AddressOf ofrmViewgloLab_openEducationFormClosed

                                frm.objgloLabPatientExam = New clsPatientExams

                                frm.objgloLabPatientMessages = New clsMessage
                                frm.objgloLabPatientLetters = New clsPatientLetters
                                frm.objgloLabNurseNotes = New clsNurseNotes
                                frm.objgloLabHistory = New clsPatientHistory
                                frm.objgloLabLabs = New clsLabs
                                frm.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                                frm.objgloLabRxmed = New clsPatientDetails
                                frm.objgloLabOrders = New clsPatientDetails
                                frm.objgloLabProblemList = New clsPatientProblemList

                                frm.objgloLabCriteria = New DocCriteria
                                frm.objgloLabWord = New clsWordDocument

                                frm.LoginProviderID = gnLoginProviderID
                                ''added for Bug #68475:  
                                With frm.LabOrderParameter
                                    .IsEditMode = False
                                    .OrderID = orderid
                                    .OrderNumberID = 0
                                    .OrderNumberPrefix = "ORD"
                                    .PatientID = gnPatientID
                                    .VisitID = GenerateVisitID(gnPatientID)
                                    .TransactionDate = Now
                                    .CloseAfterSave = True

                                End With
                                ''changes added for split control functionality in orders&results
                                Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
                                objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn


                                frm.VisitID = gnVisitID
                                frm.clsSplit_Laborder = objclsSplit_Laborder
                                frm.Show()

                                ShowHideMainMenu(False, False)
                                pnlMainToolBar.Visible = False


                            Catch ex As Exception
                                MessageBox.Show(ex.ToString())
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Load, "Order Viewed", gloAuditTrail.ActivityOutCome.Success)
                            Finally

                            End Try

                        Case PatientDetails.History
                            ' '' <><><> Record Level Locking <><><><>  
                            Dim _VisitID As Int64 = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                            Dim _VisitDate As Date = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 2), Date)

                            Dim blnRecordLock As Boolean = False
                            ''Variable added on 20091226-to check whether user has HistoryRights or not
                            Dim _RecordLock As Boolean = False
                            'If gblnRecordLocking = True Then
                            '    Dim mydt As New mytable
                            '    mydt = Scan_n_Lock_Transaction(TrnType.PatientHistory, gnPatientID, _VisitID, _VisitDate)
                            '    'If mydt.Code <> gstrLoginName Or mydt.Description <> gstrClientMachineName Then
                            '    If mydt.Description <> gstrClientMachineName Then
                            '        If MessageBox.Show("This Patient History is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now.", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                            '            '' Open in Lock Mode
                            '            blnRecordLock = True
                            '            _RecordLock = True
                            '        Else
                            '            '' Dont Open '' DO Nothing
                            '            Exit Sub
                            '        End If
                            '    End If
                            'End If
                            '''' <><><> Record Level Locking <><><><> 

                            Dim frm As frmHistory
                            'code added by dipak no 20090827 to set blnRecordLock = True if user doesn't have rights 
                            If (objUserRights.PatientHistory = False) Then
                                blnRecordLock = True
                            End If
                            If (objUserRights.History = False) Then
                                _RecordLock = True
                            End If
                            'end add dipak
                            frm = frmHistory.GetInstance(_VisitID, _VisitDate, gnPatientID, blnRecordLock, _RecordLock)
                            If IsNothing(frm) = True Then
                                Exit Sub
                            End If

                            If (frmHistory.IsOpen = False) Then
                                frm.blnShowMessageBox = False
                                frm.PopulatePatientHistory_Final()
                            End If
                            If frm.blncancel Then
                                frm.MdiParent = Me
                                frm.WindowState = FormWindowState.Maximized
                                frm.Show()
                                ShowHideMainMenu(False, False)
                                pnlMainToolBar.Visible = False
                            Else
                                frm.Dispose()
                                frm = Nothing
                            End If


                        Case PatientDetails.Medication
                            'Incident #55315: 00016572 : Carry forward issue
                            mnuPatientPrescription_Click(sender, e)

                        Case PatientDetails.Prescription
                            mnuPatientPrescription_Click(sender, e)
                        Case PatientDetails.OrderTemplates

                            If IsAccess(False, gnPatientID) = False Then
                                Exit Sub
                            End If

                            Dim nVisitId As Long
                            Dim VisitDate As String

                            nVisitId = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                            VisitDate = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 1), String)

                            ' '' <><><> Record Level Locking <><><><>                         
                            Dim blnRecordLock As Boolean = False
                            If gblnRecordLocking = True Then
                                Dim mydt As mytable ''slr new not needed 
                                mydt = Scan_n_Lock_Transaction(TrnType.Radiology, gnPatientID, nVisitId, VisitDate)
                                If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                    If MessageBox.Show("This Radiology Order is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                        blnRecordLock = True
                                    Else
                                        ' slr free mydt
                                        If Not IsNothing(mydt) Then
                                            mydt.Dispose()
                                            mydt = Nothing
                                        End If
                                        Exit Sub
                                    End If
                                    ' slr free mydt
                                    If Not IsNothing(mydt) Then
                                        mydt.Dispose()
                                        mydt = Nothing
                                    End If
                                End If
                            End If
                            ' '' <><><> Record Level Locking <><><><> 

                            'Create instance of Class to get message User                         
                            Dim frm As frm_LM_Orders
                            'code added by dipak on 20090827 to set blnRecordLock = True  to the user doesnot have rights objUserRights.PatientOrders
                            If (objUserRights.RadiologyOrders = False) Then
                                blnRecordLock = True
                            End If
                            'end addd dipak
                            frm = frm_LM_Orders.GetInstance(nVisitId, VisitDate, gnPatientID, 1, blnRecordLock)
                            If IsNothing(frm) = True Then
                                Exit Sub
                            End If
                            'AddHandler frm.EvntGenerateCDAFromLMOrders, AddressOf openCDA

                            frm.MdiParent = Me
                            frm.WindowState = FormWindowState.Maximized
                            frm.Show()

                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False


                        Case PatientDetails.Vitals
                            If IsAccess(False, gnPatientID) = False Then
                                Exit Sub
                            End If

                            Dim blnRecordLock As Boolean = False
                            Dim _VitalID As Int64 = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                            ''Added by Mayuri:20110303-
                            ' '' <><><> Record Level Locking <><><><> 

                            If gblnRecordLocking = True Then
                                Dim mydt As mytable ''slr new not needed 

                                mydt = Scan_n_Lock_Transaction(TrnType.PatientVitals, _VitalID, 0, Now)
                                If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                    If MessageBox.Show("This Patient Vital is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                        blnRecordLock = True
                                    Else
                                        If Not IsNothing(mydt) Then ''slr free mydt
                                            mydt.Dispose()
                                            mydt = Nothing
                                        End If
                                        Exit Sub
                                    End If
                                End If
                                If Not IsNothing(mydt) Then ''slr free mydt
                                    mydt.Dispose()
                                    mydt = Nothing
                                End If
                            End If
                            '''' <><><> Record Level Locking <><><><> 
                            'code added by dipak on 20090827 to set blnRecordLock = True  to the user doesnot have rights objUserRights.PatientVitals
                            If (objUserRights.PatientVitals = False) Then
                                blnRecordLock = True
                            End If
                            'end addd dipak
                            Dim frmPatientVitals As New frmPatientVitals(_VitalID, gnPatientID, False, blnRecordLock)
                            frmPatientVitals.Text = "Modify Vital"
                            frmPatientVitals.ShowInTaskbar = False
                            frmPatientVitals.StartPosition = FormStartPosition.CenterParent
                            frmPatientVitals.ShowDialog(IIf(IsNothing(frmPatientVitals.Parent), Me, frmPatientVitals.Parent))
                            mnu_DashBoard_Click(Nothing, Nothing)
                            frmPatientVitals.Dispose()
                            frmPatientVitals = Nothing

                            ''Added by Mayuri:20100617-To refresh vitals 
                            If (SelectedPatientDetail = PatientDetails.Vitals) Then
                                Call Fill_Vitals()
                                SetControlSelection_EMR()
                            End If

                        Case PatientDetails.SBPData
                            If IsAccess(False, gnPatientID) = False Then
                                Exit Sub
                            End If

                            'Dim sConnectionString As String = GetConnectionString()
                            'Dim oSBPTransaction As New frmSBPTransaction(gnPatientID, sConnectionString)
                            'oSBPTransaction.ShowInTaskbar = False
                            'oSBPTransaction.StartPosition = FormStartPosition.CenterParent
                            'oSBPTransaction.ShowDialog(IIf(IsNothing(frmSBPTransaction.Parent), Me, frmSBPTransaction.Parent))
                            'mnu_DashBoard_Click(Nothing, Nothing)
                            'oSBPTransaction.Dispose()
                            'oSBPTransaction = Nothing
                            Dim _SelectedSBPTransactionDate As DateTime = Nothing

                            Dim sConnectionString As String = GetConnectionString()
                            For i As Int16 = 0 To C1dgPatientDetails.Rows.Count - 1
                                Dim selRow As Int16 = 0
                                selRow = C1dgPatientDetails.RowSel
                                If i = selRow Then
                                    _SelectedSBPTransactionDate = C1dgPatientDetails.GetData(selRow, 2) ''col 2 is transaction date
                                    Dim oSBPTransaction As New frmSBPTransaction(gnPatientID, _SelectedSBPTransactionDate, sConnectionString, True, selRow)
                                    oSBPTransaction.MdiParent = Me
                                    oSBPTransaction.WindowState = FormWindowState.Maximized
                                    oSBPTransaction.Show()
                                    ShowHideMainMenu(False, False)
                                    pnlMainToolBar.Visible = False

                                    Exit Select
                                End If

                            Next


                        Case PatientDetails.Messages

                            If IsAccess(False) = False Then
                                Exit Sub
                            End If

                            'To check exception related to word
                            'If CheckWordForException() = False Then
                            '    Exit Sub
                            'End If

                            Dim nMsgId As Long
                            'Message ID in column 0
                            nMsgId = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                            Dim msgDate As Date
                            msgDate = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 1), Date)
                            Dim blnIsFinished As Boolean = False

                            ' '' <><><> Record Level Locking <><><><>                         
                            Dim blnRecordLock As Boolean = False

                            Dim mydt As mytable  ''slr new not needed
                            If gblnRecordLocking = True Then
                                mydt = Scan_n_Lock_Transaction(TrnType.Messages, nMsgId, 0, msgDate)
                                If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                    If MessageBox.Show("This message is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Exclamation) = Windows.Forms.DialogResult.Yes Then
                                        ''Record open only for view.
                                        blnRecordLock = True
                                        '' Word document is only view can't add data to documents.
                                        blnIsFinished = True
                                    Else
                                        'Return False
                                        If Not IsNothing(mydt) Then  ''slr free mydt
                                            mydt.Dispose()
                                            mydt = Nothing
                                        End If
                                        Exit Sub
                                    End If
                                End If

                                If Not IsNothing(mydt) Then ''slr free mydt
                                    mydt.Dispose()
                                    mydt = Nothing
                                End If
                            End If
                            '''' <><><> Record Level Locking <><><><> 

                            'Create instance of Class to get message User 
                            'Dim dt As DataTable
                            'Dim i As Integer

                            If C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0).ToString().Trim() = "Yes" Then
                                blnIsFinished = True
                            Else
                                blnIsFinished = False
                            End If

                            'IF Message is displayed as unfinished Message on the loacal mc  but is finished from 
                            'other machine then read the finished status of the Message from database   
                            Try
                                Dim oDB As New gloStream.gloDataBase.gloDataBase
                                Dim strSQL As String
                                Dim Status As String

                                strSQL = " SELECT  ISNULL(bIsFinished , 'False' ) AS bIsFinished FROM  Message" _
                                        & " WHERE nMessageID = " & nMsgId & " AND nPatientID =" & gnPatientID & " AND dtMsgDate ='" & msgDate & "' "
                                oDB.Connect(GetConnectionString)
                                Status = oDB.ExecuteQueryScaler(strSQL)

                                blnIsFinished = Convert.ToBoolean(Status)
                                oDB.Disconnect()
                                oDB.Dispose()
                                oDB = Nothing
                            Catch ex As Exception

                            End Try

                            Dim frm As frmMessages

                            If objUserRights.Messages = False Then
                                blnRecordLock = True
                            End If

                            frm = frmMessages.GetInstance(nMsgId, gnLoginID, msgDate, gnPatientID, 1, blnIsFinished, blnRecordLock)

                            If IsNothing(frm) = True Then
                                Exit Sub
                            End If

                            frm.Text = "Modify Messages"
                            frm.MdiParent = Me
                            frm.myCallerMain = Me
                            frm.IsModify = True
                            frmVWMessages.blnModify = True
                            frm.WindowState = FormWindowState.Maximized
                            frm.BringToFront()
                            frm.Show()

                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False


                            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Messages, gloAuditTrail.ActivityCategory.PatientMessages, gloAuditTrail.ActivityType.View, "Patient Message viewed", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success)
                        Case PatientDetails.FAX_Pending    '' "Pending"
                            If IsAccess(False, gnPatientID) = False Then
                                Exit Sub
                            End If

                            If CheckWordForException() = False Then
                                Exit Sub
                            End If

                            Dim _FaxID As Int64 = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                            Dim frm As New frmPendingFAXPreview()
                            frm.ShowPendingFAXDetails(_FaxID, gnPatientID, False)
                            frm.MdiParent = Me
                            frm.Show()
                            ShowHideMainMenu(False, False)
                        Case PatientDetails.PastExams

                            Dim nPastExamID As Long
                            Dim nVisitID As Long
                            Dim dtDOS As DateTime
                            Dim strExamName As String
                            'Dim bIsReviewed As Boolean
                            'Variable added By Shweta 20091128
                            Dim strTemplateName As String

                            nPastExamID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                            nVisitID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 1), Int64)
                            dtDOS = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 2), Date)
                            strExamName = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 3), String)

                            strTemplateName = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 4))
                            Dim blnFinished As Boolean

                            If CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 8), String) = "Yes" Then
                                blnFinished = True
                            Else
                                blnFinished = False
                            End If

                            ''IF exam is displayed as unfinished exam on the local mc  but is finished from 
                            ''other machine then read the finished status of the exam from database   
                            Try
                                Dim oDB As New gloStream.gloDataBase.gloDataBase
                                Dim strSQL As String
                                Dim Status As String

                                strSQL = "SELECT ISNULL(bIsFinished ,'False' ) AS bIsFinished FROM PatientExams WHERE nExamID = " & nPastExamID & " " _
                                        & " AND nVisitID = " & nVisitID & " AND  nPatientID = " & gnPatientID & "  AND dtDOS = '" & dtDOS & "' "
                                oDB.Connect(GetConnectionString)
                                Status = oDB.ExecuteQueryScaler(strSQL)

                                blnFinished = Convert.ToBoolean(Status)

                                oDB.Disconnect()
                                oDB.Dispose()
                                oDB = Nothing

                            Catch ex As Exception

                            End Try

                            ShowPastExam(nPastExamID, gnPatientID, nVisitID, dtDOS, strExamName, strTemplateName, blnFinished, gstrPatientCode)

                        Case PatientDetails.ViewDocs
                            Call ShowPatientDocuments()

                        Case PatientDetails.PatientLetters
                            NewOrUpdateLetters(True)

                        Case PatientDetails.PatientConsent
                            NewOrUpdateConsent(True)

                        Case PatientDetails.DisclosureManagement
                            NewOrUpdateDisclosureDetrails(True)

                        Case PatientDetails.NurseNotes
                            NewOrUpdateNursesNotes(True)
                        Case PatientDetails.PatientAppointments
                            '  Dim ht As HitTestInfo
                            If (C1dgPatientDetails.Row > 0) Then
                                ModifyAppointment()


                            End If

                            ''To open Triage to modify on Patient details box
                        Case PatientDetails.Triage
                            Try
                                '       If CheckWordForException() = False Then
                                'Exit Sub
                                '  End If
                                If C1dgPatientDetails.Row > 0 Then
                                    Dim TriageID As Int64 = 0
                                    Dim TemplateID As Int64 = 0
                                    TriageID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                                    TemplateID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 1), Int64)
                                    Dim blnRecordLock As Boolean = False
                                    If gblnRecordLocking = True Then
                                        Dim mydt As mytable ''Slr new not needed 
                                        mydt = Scan_n_Lock_Transaction(TrnType.Triage, TriageID, 0, Now)
                                        If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                            If MessageBox.Show("This Patients Triage are being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot Modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                                blnRecordLock = True
                                            Else
                                                If Not IsNothing(mydt) Then
                                                    mydt.Dispose()
                                                    mydt = Nothing
                                                End If
                                                Exit Sub
                                            End If
                                        End If
                                        If Not IsNothing(mydt) Then
                                            mydt.Dispose()
                                            mydt = Nothing
                                        End If
                                    End If
                                    ''To Modify Triage
                                    Dim frm As frmTriage
                                    frm = frmTriage.GetInstance(TriageID, gnPatientID, 3, blnRecordLock, TemplateID) '' 3 for DashBoard ''
                                    'AddHandler frm.EvntGenerateCDAFromTriage, AddressOf openCDA
                                    If IsNothing(frm) = True Then
                                        Exit Sub
                                    End If
                                    frmVWTriage.blnmodify = True

                                    frm.MdiParent = Me
                                    frm.myCallerMain = Me
                                    frm.IsModify = True
                                    frm.WindowState = FormWindowState.Maximized
                                    frm.BringToFront()
                                    frm.Show()

                                    ShowHideMainMenu(False, False)
                                    pnlMainToolBar.Visible = False



                                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Triage, gloAuditTrail.ActivityCategory.Triage, gloAuditTrail.ActivityType.View, "Triage viewed", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success)
                                End If
                            Catch ex As Exception
                                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                            End Try

                            ''Modify patient education 
                        Case PatientDetails.PatientEducation



                            ''Code Changes to resolve Bug No. 66007::Application shows error message while checking medline document from Patient education.
                            Dim grdEducationID As Int64 = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                            Dim grdDocumentName As String = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, "sTemplateName"), String)

                            Dim grdDocumentUrl As String = String.Empty
                            Dim grdVisitId As Long = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, "nVisitID"), Long)
                            Dim nSource As Short = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, "Src"), Short)
                            Dim ResCat As Short = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, "ResCat"), Short)
                            Dim ResType As Short = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, "ResType"), Short)


                            If ResCat = gloEMRGeneralLibrary.clsInfobutton.enumResourceCategory.OnlineLibrary Then
                                Dim InfoButtonForm As gloEMRGeneralLibrary.frmInfoButtonBrowser = gloEMRGeneralLibrary.frmInfoButtonBrowser.GetInstance
                                Try
                                    RemoveHandler InfoButtonForm.FormClosed, AddressOf ofrmInfoButton_FormClosed 'Fill_Patienteducation
                                Catch ex As Exception

                                End Try
                                AddHandler InfoButtonForm.FormClosed, AddressOf ofrmInfoButton_FormClosed 'Fill_Patienteducation
                                With InfoButtonForm
                                    .LoginProviderID = gnLoginProviderID
                                    .PatientId = gnPatientID
                                    .VisitID = grdVisitId
                                    .Source = nSource
                                    .ResourceCategory = ResCat
                                    .ResourceType = ResType
                                    .EducationID = grdEducationID
                                    .isViewed = True
                                    .Show()
                                    .ValidatePortalFeatures()
                                    grdDocumentUrl = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, "sDocumentURL"), String)

                                    .NavigateTo(grdDocumentUrl)
                                    .Visible = True
                                    .Activate()
                                End With

                            Else

                                Dim ofrmPatientEducation As New frmPatientEducationPreview()
                                With ofrmPatientEducation

                                    .VISID = grdVisitId
                                    .ResourcCat = ResCat
                                    .ResourcTyp = ResType
                                    .Sourc = nSource
                                    .PATID = gnPatientID
                                    .TempName = grdDocumentName
                                    .TMPID = grdEducationID
                                    .ISGRID = True
                                    ''00000803: Patient Education. Changes for modify education scenario.
                                    .isModify = True
                                    .EducationID = grdEducationID
                                End With

                                AddHandler ofrmPatientEducation.FormClosed, AddressOf ofrmPatientEducation_FormClosed 'Fill_Patienteducation
                                Try

                                    If ResType = gloEMRGeneralLibrary.clsInfobutton.enumResourceType.PatientEducation Then
                                        ofrmPatientEducation.Text = "Modify Patient Education"
                                    ElseIf ResType = gloEMRGeneralLibrary.clsInfobutton.enumResourceType.PatientReferenceMaterial Then
                                        ofrmPatientEducation.Text = "Modify Patient Reference Material"
                                    ElseIf ResType = gloEMRGeneralLibrary.clsInfobutton.enumResourceType.ProviderReferenceMaterial Then
                                        ofrmPatientEducation.Text = "Modify Provider Reference Material"
                                    End If
                                    ShowHideMainMenu(True, True)

                                    ofrmPatientEducation.MdiParent = Me
                                    'ofrmPatientEducation.BringToFront()
                                    ofrmPatientEducation.Show()
                                    ShowHideMainMenu(False, False)
                                    pnlMainToolBar.Visible = False
                                    ofrmPatientEducation.WindowState = FormWindowState.Maximized

                                Catch ex As Exception
                                    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                                    ShowHideMainMenu(True, True)
                                    pnlMainToolBar.Visible = True
                                    ofrmPatientEducation.Dispose()
                                    ofrmPatientEducation = Nothing
                                End Try
                            End If

                            grdEducationID = Nothing
                            grdDocumentName = Nothing
                            ResType = Nothing
                            ResCat = Nothing
                            nSource = Nothing
                            grdDocumentUrl = Nothing
                            grdVisitId = Nothing


                        Case PatientDetails.Insurance
                            'code added by dipak 20091226 to fixed the bug no :4953	 Dashboard > Insurance Tab > not opens "Insurance Information" window. Double-click not working
                            Try

                                Dim oPatient As New gloPatient.gloPatient(GetConnectionString)
                                oPatient.ShowPatientRegistration(gnPatientID, gloPatient.ModifyPatientDetailType.Insurance, gnPatientID, Me)
                                '' 
                                _bIsPatientModify = True
                                If gloPatient.gloPatient.SendHL7Details = True Then
                                    PatientRegSaveClose(gnPatientID)
                                End If
                                _bIsPatientModify = False
                                oPatient.Dispose()
                                oPatient = Nothing
                                If (SelectedPatientDetail = PatientDetails.Insurance) Then
                                    Fill_Insurances()
                                End If

                                'end code added by dipak 
                            Catch ex As Exception
                                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                            End Try

                        Case PatientDetails.NewExam
                            Dim _temptemplatename As String = C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 1).ToString()
                            _TemplateName = _temptemplatename
                            _TemplateID = C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0).ToString()
                            NewExam()
                            _TemplateName = ""
                            _TemplateID = 0
                            ''UpdateTemplate()

                        Case PatientDetails.PriorAuthorization
                            Dim _SelectedAuthID As Int64 = 0
                            If (C1dgPatientDetails.RowSel <> Nothing AndAlso C1dgPatientDetails.RowSel > 0) Then
                                '  GetControlSelection()

                                _SelectedAuthID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0))

                                Dim OBJPrior As gloPMGeneral.frmModifyAuthorization = New gloPMGeneral.frmModifyAuthorization(GetConnectionString, _SelectedAuthID)
                                OBJPrior.ShowDialog(IIf(IsNothing(OBJPrior.Parent), Me, OBJPrior.Parent))
                                OBJPrior.BringToFront()
                                If Not IsNothing(OBJPrior) Then ''slr free objprior
                                    OBJPrior.Close()
                                    OBJPrior.Dispose()
                                    OBJPrior = Nothing
                                End If
                                If (SelectedPatientDetail = PatientDetails.PriorAuthorization) Then
                                    Fill_PriorAuthorization(gnPatientID)
                                    SetControlSelection_EMR()
                                End If
                                ' SetControlSelection()
                            End If
                        Case PatientDetails.patientCases
                            Dim _SelectedCaseID As Int64 = 0
                            If (C1dgPatientDetails.RowSel <> Nothing AndAlso C1dgPatientDetails.RowSel > 0) Then
                                _SelectedCaseID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0))

                                Dim ofrmSetupCases As gloBilling.frmSetupCases = New gloBilling.frmSetupCases(gnPatientID, _SelectedCaseID)
                                ofrmSetupCases.ShowDialog(IIf(IsNothing(ofrmSetupCases.Parent), Me, ofrmSetupCases.Parent))
                                ofrmSetupCases.BringToFront()
                                If Not IsNothing(ofrmSetupCases) Then ''Slr free ofrmSetupCases
                                    ofrmSetupCases.Close()
                                    ofrmSetupCases.Dispose()
                                    ofrmSetupCases = Nothing
                                End If
                                If (SelectedPatientDetail = PatientDetails.patientCases) Then
                                    FillCases(gnPatientID)
                                    SetControlSelection_EMR()
                                    '   SetControlSelection()
                                End If
                            End If
                        Case PatientDetails.PatientTasks
                            If Not (IsNothing(C1dgPatientDetails.RowSel)) Then
                                Dim _taskId As Int64 = 0
                                _taskId = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID), Int64)
                                If (_taskId = 0) Then
                                    Exit Sub
                                Else
                                    If C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_Owner) = gstrLoginName Then
                                        ofrmTask = New gloTaskMail.frmTask(GetConnectionString, _taskId)
                                        ofrmTask.PatientID = gnPatientID  ''added for bugid 82614 diaplaying patient all task
                                        'Bug #82464: 00000909: Task screen not opening respective screen
                                        AddHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange ''added for taskincident to autoclose task window or not depend on setting 
                                        ofrmTask.IsEMREnable = True
                                        nTaskId = _taskId
                                        ofrmTask.ShowDialog(IIf(IsNothing(ofrmTask.Parent), Me, ofrmTask.Parent))
                                        RemoveHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange ''Slr remove handler

                                        HandlesTaskChange(Nothing, Nothing, ofrmTask.e2Task)
                                        If Not IsNothing(ofrmTask) Then ''Slr free ofrmSetupCases
                                            ofrmTask.Close()
                                            ofrmTask.Dispose()
                                            ofrmTask = Nothing
                                            _objfrmtask = Nothing
                                        End If

                                    Else
                                        MessageBox.Show("You are not the owner of this task.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    End If

                                End If
                            End If

                        Case PatientDetails.IntuitCommunication
                            OpenIntuitMessage()
                        Case PatientDetails.AuditTrail
                            Dim strActivityType As String = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityType")
                            Dim strActivityModule As String = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule")

                            Select Case strActivityModule

                                Case "Patient", "History", "ProblemList", "Medication", "Vitals", "Exam", "Immunization", "CarePlan", "Prescription", "CCD", "Labs", "Orders", "ImplantableDevice"
                                    If (strActivityType = "Add" Or strActivityType = "Modify" Or strActivityType = "Delete") Then
                                        If C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "TransactionID") <> 0 AndAlso C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule") <> "Patient" Then
                                            If strActivityModule = "Labs" Then
                                                OpenAduitTrail(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "TransactionID"), strActivityType, strActivityModule)
                                            ElseIf strActivityModule = "CarePlan" Then
                                                OpenAduitTrail(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "TransactionID"), strActivityType, strActivityModule, C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "AuditTrailID"))
                                            Else
                                                If (C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityType") = "Modify") Then
                                                    If C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule") = "Exam" Then
                                                        OpenAduitTrail(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "TransactionID"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityType"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule"))
                                                    Else
                                                        OpenAduitTrail(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "AuditTrailID"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityType"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule"))
                                                    End If

                                                Else

                                                    OpenAduitTrail(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "TransactionID"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityType"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule"))
                                                End If
                                            End If
                                        ElseIf C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "TransactionID") <> 0 AndAlso C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule") = "Patient" AndAlso C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityCategory") = "PatientEducation" AndAlso strActivityType = "Add" Then
                                            OpenAduitTrail(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "TransactionID"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityType"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule"))
                                        Else
                                            If C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityCategory") = "SetupPatient" Then
                                                OpenAduitTrail(gnPatientID, C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityType"), C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "ActivityModule"), Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, "AuditTrailID")))

                                            End If
                                        End If
                                    End If
                                Case Else
                            End Select
                        Case PatientDetails.NYWorkerCompForms
                            ModifyWCForm()
                    End Select
                End If
            End If


        Catch ex As Exception

            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Close, "Problem List Error", gloAuditTrail.ActivityOutCome.Failure)

            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            '  SetControlSelection_EMR()

        End Try
    End Sub

    Private Sub OpenAduitTrail(ByVal nTransactionID As Int64, ByVal sActivityType As String, ByVal ActivityModule As String, Optional ByVal nAuditTrailId As Int64 = 0)
        'Dim _isUpdatedReconcile As Boolean = False
        Dim sCategory As String = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 5)).Trim
        If sCategory = "Reconciliation" Then
            ''Or sActivityType = "UpdateReconcileList" Then

            If Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 1)).Contains("Medication") Then
                ActivityModule = "MedicationReconcile"
            ElseIf Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 1)).Contains("Allergy") Then
                ActivityModule = "AllergyReconcile"
            ElseIf Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 1)).Contains("Problem") Then
                ActivityModule = "ProblemReconcile"


            End If
            'If Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 1)).Contains("Updated") Then
            '    _isUpdatedReconcile = True
            'End If

        ElseIf sCategory = "PatientEducation" Then
            ActivityModule = "PatientEducation"
        End If

        Dim frm = Nothing

        If ActivityModule = "Labs" Then
            frm = New frmVWAudit_Labs(nTransactionID, sActivityType, ActivityModule)
        ElseIf ActivityModule = "CarePlan" Then
            Dim sModule As String = ""
            Select Case sCategory
                Case gloAuditTrail.ActivityCategory.PatientHealthConcern.ToString()
                    sModule = "HealthConcern"
                Case gloAuditTrail.ActivityCategory.PatientGoal.ToString()
                    sModule = "Goal"
                Case gloAuditTrail.ActivityCategory.PatientIntervention.ToString()
                    sModule = "Intervention"
                Case gloAuditTrail.ActivityCategory.PatientOutcome.ToString()
                    sModule = "Outcome"
            End Select
            If sModule = "" Then
                If sActivityType = "Modify" Then
                    frm = New frmVWAudit(nAuditTrailId, sActivityType, ActivityModule)
                Else
                    frm = New frmVWAudit(nTransactionID, sActivityType, ActivityModule)
                End If
            Else
                frm = New frmCarePlanHistory(0, nTransactionID, sModule)
                Try
                    frm.Width = Screen.PrimaryScreen.WorkingArea.Width '- 40
                Catch

                End Try
            End If
        Else
            frm = New frmVWAudit(nTransactionID, sActivityType, ActivityModule, nAuditTrailId)
        End If
        frm.StartPosition = FormStartPosition.CenterScreen
        frm.BringToFront()
        If ActivityModule = "ProblemList" Then
            frm.Text = "Problem List Audit"
        ElseIf ActivityModule = "Vitals" Then
            frm.Text = "Vitals Audit"
        ElseIf ActivityModule = "CarePlan" Then
            frm.Text = "Care Plan Audit"
        ElseIf ActivityModule = "Medication" Then
            frm.Text = "Medication Audit"
        ElseIf ActivityModule = "Prescription" Then
            frm.Text = "Prescription Audit"
        ElseIf ActivityModule = "History" Then
            frm.Text = "History Audit"
        ElseIf ActivityModule = "Immunization" Then
            frm.Text = "Immunization Audit"
        ElseIf ActivityModule = "Patient" Then
            frm.Text = "Patient Audit"
        ElseIf ActivityModule = "Exam" Then
            frm.Text = "Exam Audit"
        ElseIf ActivityModule = "Labs" Then
            frm.Text = "Lab Audit"
        ElseIf ActivityModule = "PatientEducation" Then
            frm.text = "Patient Education Audit"
        ElseIf ActivityModule = "ImplantableDevice" Then
            frm.text = "Patient Implantable Devices"
        End If
        If sCategory = "Reconciliation" Then
            frm.Text = "CCDA Reconcile Audit"
        End If

        'ElseIf ActivityModule = "MedicationReconcile" Then
        '    frm.Text = "CCDA Medication Reconcile Audit"
        '    'frm.IsUpdatedReconcile = _isUpdatedReconcile
        'ElseIf ActivityModule = "AllergyReconcile" Then
        '    frm.Text = "CCDA Allergy Reconcile Audit"
        '    ' frm.IsUpdatedReconcile = _isUpdatedReconcile
        'ElseIf ActivityModule = "ProblemReconcile" Then
        '    frm.Text = "CCDA Problem Reconcile Audit"
        '    '  frm.IsUpdatedReconcile = _isUpdatedReconcile

        'End If

        frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))

        ''slr free frm
        If Not IsNothing(frm) Then
            frm.Close()
            frm.Dispose()
            frm = Nothing
        End If

    End Sub
    'Changed By Shweta 20091128
    'Added parameter related to template name
    Private Sub ShowPastExam(ByVal ExamID As Long, ByVal PatientId As Int64, ByVal VisitID As Long, ByVal DOS As String, ByVal ExamName As String, ByVal sTemplateName As String, ByVal blnFinished As Boolean, Optional ByVal PatientCode As String = "")
        Try

            gnPatientID = PatientId
            oPatientListControl.PatientID = gnPatientID
            If gstrPatientCode = "" Then
                gstrPatientCode = GetPatientCodefromID(PatientId)
            End If

            If Trim(gstrPatientFirstName) <> "" Then

                If Not blnFinished Then
                    Dim objExam As New clsPatientExams
                    objExam.SetProviderExam(ExamID)
                    objExam.Dispose()
                    objExam = Nothing
                End If

                Me.Cursor = Cursors.WaitCursor

                Dim frm As New frmPatientExam(gnPatientID, gnVisitID)

                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                ' AddHandler frm.EvntGenerateCDAFromPatientExam, AddressOf openCDA

                With frm
                    .Hide()
                    .blnModify = True
                    .Text = "Past Exams"
                    Dim sender As Object = Nothing
                    Dim e As System.EventArgs = Nothing
                    .cmdPastExam_Click(sender, e)
                    .PatientID = gnPatientID
                    ' .chkShowPreview.Visible = True
                    .pnlPastExam.Visible = True
                    UpdateLog("PastExam Load:Started")
                    '' IF CONDITION BY SUDHIR 20090701 ''
                    If .OpenPastExam(ExamID, VisitID, Convert.ToDateTime(DOS), ExamName.Trim, blnFinished, sTemplateName) = True Then

                        .MdiParent = Me
                        .IsPastExam = True
                        .Show()

                        If .ExamViewMode Then
                            .ViewExam(ExamID)
                        Else
                            .OpenPastExamContents(ExamID, blnFinished)
                        End If

                        ShowHideMainMenu(False, False)
                        Me.pnlMainToolBar.Visible = False

                        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Open, "Exam Opened.", gnPatientID, ExamID, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                    Else
                        RemoveHandler frm.EntOpenMessage, AddressOf OpenMessage
                        RemoveHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                        RemoveHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters

                        frm.Dispose()
                        frm = Nothing
                    End If
                    UpdateLog("PastExam Load:completed")
                End With
                Me.Cursor = Cursors.Default
            Else
                Me.Cursor = Cursors.Default
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        Me.Cursor = Cursors.Default
    End Sub

    Private Sub ShowPastExam(ByVal ExamID As Long, ByVal PatientId As Int64, ByVal VisitID As Long, ByVal DOS As String, ByVal ExamName As String, ByVal blnFinished As Boolean, Optional ByVal PatientCode As String = "")
        Try

            gnPatientID = PatientId
            oPatientListControl.PatientID = gnPatientID
            gstrPatientCode = GetPatientCodefromID(PatientId)

            ShowPatientAllDetails(PatientId)

            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If
                'To check exception related to word
                If CheckWordForException() = False Then
                    Exit Sub
                End If
                'End

                If Not blnFinished Then
                    Dim objExam As New clsPatientExams
                    objExam.SetProviderExam(ExamID)
                    objExam.Dispose()
                    objExam = Nothing
                End If

                Me.Cursor = Cursors.WaitCursor

                Dim frm As New frmPatientExam(gnPatientID, gnVisitID)

                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                'AddHandler frm.EvntGenerateCDAFromPatientExam, AddressOf openCDA

                With frm
                    .Hide()
                    .blnModify = True
                    .Text = "Past Exams"
                    Dim sender As Object = Nothing
                    Dim e As System.EventArgs = Nothing
                    .cmdPastExam_Click(sender, e)
                    .PatientID = gnPatientID
                    ' .chkShowPreview.Visible = True
                    .pnlPastExam.Visible = True

                    '' IF CONDITION BY SUDHIR 20090701 ''
                    If .OpenPastExam(ExamID, VisitID, Convert.ToDateTime(DOS), ExamName.Trim, blnFinished) = True Then

                        .MdiParent = Me
                        .IsPastExam = True
                        .Show()

                        If .ExamViewMode Then
                            .ViewExam(ExamID)
                        Else
                            .OpenPastExamContents(ExamID, blnFinished)
                        End If

                        Me.pnlMainToolBar.Visible = False
                        ShowHideMainMenu(False, False)

                        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Open, "Exam Opened.", gnPatientID, ExamID, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                    Else
                        RemoveHandler frm.EntOpenMessage, AddressOf OpenMessage
                        RemoveHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                        RemoveHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters

                        frm.Dispose()
                        frm = Nothing
                    End If

                End With
                Me.Cursor = Cursors.Default
            Else
                Me.Cursor = Cursors.Default
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        Me.Cursor = Cursors.Default
    End Sub

    Private Sub ShowPatientDocuments()
        Try
            If (C1dgPatientDetails.RowSel) > 0 Then
                If C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, COL_CAT_COLTYPE) = enumColType.Document Then

                    '' SUDHIR 20090521 '' CHECK PROVIDER ''
                    If gblnProviderDisable = True Then
                        If ShowAssociateProvider(gnPatientID, Me) = False Then
                            Exit Sub
                        Else
                            oPatientListControl.FillPatients()
                        End If
                    End If
                    '' END SUDHIR

                    Dim _ContID As Long = 0
                    Dim _DocID As Long = 0
                    Dim _Year As String = ""
                    Try
                        _DocID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, COL_D_CAT_FILENAME).ToString())
                        _ContID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, COL_D_CAT_CONTAINER).ToString())
                        _Year = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, COL_D_CAT_YEAR).ToString()
                    Catch ex As Exception

                    End Try

                    If _DocID > 0 AndAlso _Year <> "" Then
                        If oEDocumentV3 Is Nothing Then
                            oEDocumentV3 = New gloEDocumentV3.gloEDocV3Management()
                        End If
                        ''"Dhruv 20100634 -> For setting the DocmentPat for the DMS"
                        gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory = gstrFAXOutputDirectory
                        gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = gblnInternetFax
                        gloEDocumentV3.gloEDocV3Admin.gblnAddFaxCoverpage = gblnFAXCoverPage

                        'Commented by rahul patel on 26-10-2010
                        'gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), gDMSV3TempPath, gnLoginID, gClinicID, Application.StartupPath)
                        'Added by rahul patel on 26-10-2010
                        'For DMS Hybrid database changes
                        gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV3TempPath, gnLoginID, gClinicID, System.Windows.Forms.Application.StartupPath)
                        'End of code added by rahul patel

                        ''End ->"Dhruv 20100634 -> For setting the DocmentPat for the DMS"

                        oEDocumentV3.oPatientExam = New clsPatientExams

                        oEDocumentV3.oPatientMessages = New clsMessage
                        oEDocumentV3.oPatientLetters = New clsPatientLetters
                        oEDocumentV3.oNurseNotes = New clsNurseNotes
                        oEDocumentV3.oHistory = New clsPatientHistory
                        oEDocumentV3.oLabs = New clsLabs
                        oEDocumentV3.oDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                        oEDocumentV3.oRxmed = New clsPatientDetails
                        oEDocumentV3.oOrders = New clsPatientDetails
                        oEDocumentV3.oProblemList = New clsPatientProblemList

                        oEDocumentV3.oCriteria = New DocCriteria
                        oEDocumentV3.oWord = New clsWordDocument
                        oEDocumentV3.dMdi = Me

                        Dim isItDialog As Boolean = oEDocumentV3.ShowEDocument(gnPatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewDocumentForExternalModule, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.DashBoard, _DocID)
                        If (isItDialog = True) Then


                            If (IsNothing(oEDocumentV3.oPatientExam) = False) Then
                                DirectCast(oEDocumentV3.oPatientExam, clsPatientExams).Dispose()
                                oEDocumentV3.oPatientExam = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oPatientMessages) = False) Then
                                DirectCast(oEDocumentV3.oPatientMessages, clsMessage).Dispose()
                                oEDocumentV3.oPatientMessages = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oPatientLetters) = False) Then
                                DirectCast(oEDocumentV3.oPatientLetters, clsPatientLetters).Dispose()
                                oEDocumentV3.oPatientLetters = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oNurseNotes) = False) Then
                                DirectCast(oEDocumentV3.oNurseNotes, clsNurseNotes).Dispose()
                                oEDocumentV3.oNurseNotes = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oHistory) = False) Then
                                DirectCast(oEDocumentV3.oHistory, clsPatientHistory).Dispose()
                                oEDocumentV3.oHistory = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oLabs) = False) Then
                                DirectCast(oEDocumentV3.oLabs, clsLabs).Dispose()
                                oEDocumentV3.oLabs = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oDMS) = False) Then
                                DirectCast(oEDocumentV3.oDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                                oEDocumentV3.oDMS = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oRxmed) = False) Then
                                DirectCast(oEDocumentV3.oRxmed, clsPatientDetails).Dispose()
                                oEDocumentV3.oRxmed = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oOrders) = False) Then
                                DirectCast(oEDocumentV3.oOrders, clsPatientDetails).Dispose()
                                oEDocumentV3.oOrders = Nothing
                            End If
                            If (IsNothing(oEDocumentV3.oProblemList) = False) Then
                                DirectCast(oEDocumentV3.oProblemList, clsPatientProblemList).Dispose()
                                oEDocumentV3.oProblemList = Nothing
                            End If

                            If (IsNothing(oEDocumentV3.oCriteria) = False) Then
                                DirectCast(oEDocumentV3.oCriteria, DocCriteria).Dispose()
                                oEDocumentV3.oCriteria = Nothing
                            End If
                            oEDocumentV3.Dispose()
                        End If
                        oEDocumentV3 = Nothing
                    End If
                    Exit Sub

                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ''Sudhir 20090216
    Private Sub ShowMessageHistory(ByVal sender As Object, ByVal e As EventArgs)
        Try
            Dim frm As New frmMessageHistory(CType(sender, ToolStripMenuItem).Tag)
            With frm
                .StartPosition = FormStartPosition.CenterScreen
                .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            End With
            If Not IsNothing(frm) Then  ''slr free frm
                frm.Close()
                frm.Dispose()
                frm = Nothing
            End If

        Catch ex As Exception
        End Try
    End Sub
    ''

#Region " New Patient Detail Style"


    Private Sub ToolStripButton_MouseEnter(ByVal ToolStripButton As ToolStripButton)

    End Sub

    Private Sub ToolStripButton_MouseLeave(ByVal ToolStripButton As ToolStripButton)

    End Sub

    Private Sub tsbtn_History_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_History.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_History)
    End Sub

    Private Sub tsbtn_History_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_History.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_History)
    End Sub

    Private Sub tsbtn_Medication_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Medication.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_Medication)
    End Sub

    Private Sub tsbtn_Medication_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Medication.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_Medication)
    End Sub

    Private Sub tsbtn_Prescription_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Prescription.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_Prescription)
    End Sub
    Private Sub tsbtn_Prescription_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Prescription.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_Prescription)
    End Sub

    Private Sub tsbtn_ProblemList_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_ProblemList.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_ProblemList)
    End Sub

    Private Sub tsbtn_ProblemList_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_ProblemList.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_ProblemList)
    End Sub

    Private Sub tsbtn_Orders_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Orders.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_Orders)
    End Sub

    Private Sub tsbtn_Orders_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Orders.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_Orders)
    End Sub

    Private Sub tsbtn_Messages_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Messages.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_Messages)
    End Sub

    Private Sub tsbtn_Messages_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Messages.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_Messages)
    End Sub

    Private Sub tsbtn_ViewDocs_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_ViewDocs.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_ViewDocs)
    End Sub

    Private Sub tsbtn_ViewDocs_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_ViewDocs.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_ViewDocs)
    End Sub

    Private Sub tsbtn_PastExam_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_PastExam.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_PastExam)
    End Sub

    Private Sub tsbtn_PastExam_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_PastExam.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_PastExam)
    End Sub

    Private Sub tsbtn_NewExam_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Vital.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_Vital)
    End Sub

    Private Sub tsbtn_NewExam_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Vital.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_Vital)
    End Sub

    Private Sub tsbtn_Sentfax_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Sentfax.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_Sentfax)
    End Sub

    Private Sub tsbtn_Sentfax_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Sentfax.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_Sentfax)
    End Sub

    Private Sub tsbtn_PendingFax_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_PendingFax.MouseEnter
        ToolStripButton_MouseEnter(tsbtn_PendingFax)
    End Sub

    Private Sub tsbtn_PendingFax_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_PendingFax.MouseLeave
        ToolStripButton_MouseLeave(tsbtn_PendingFax)
    End Sub


#End Region

#End Region

#Region " Patient Status "

    'Private Sub btnCheckIn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Try
    '        If gnPatientID <= 0 Then
    '            Exit Sub
    '        End If

    '        If IsAccess(False) = False Then
    '            Exit Sub
    '        End If

    '        Dim Location As String
    '        Dim Status As String

    '        Dim Users As Collection
    '        Location = Split(lblPatientLocation.Text.Trim, "- at", 2).GetValue(0)
    '        Status = lblPatientStatus.Text.Trim

    '        Users = lblPatientStatus.Tag

    '        Dim frm As New frmLocationStatus(Location, Status, Users, gnPatientID)
    '        With frm
    '            .ShowInTaskbar = False
    '            .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))

    '            'Call Get_PatientLocationStatus()
    '            Call Fill_Tasks()
    '        End With
    '        If Not IsNothing(frm) Then  ''slr free frm
    '            frm.Close()
    '            frm.Dispose()
    '            frm = Nothing
    '        End If
    '    Catch ex As Exception
    '        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
    '    End Try
    'End Sub

    'Private Sub btnCheckOut_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Try
    '        If gnPatientID <= 0 Then
    '            Exit Sub
    '        End If

    '        If IsAccess(False) = False Then
    '            Exit Sub
    '        End If

    '        lblTimeOut.Text = Now.ToLongTimeString

    '        Dim oDB As New gloStream.gloDataBase.gloDataBase
    '        With oDB
    '            .DBParameters.Add("@dtDate", Now.Date, ParameterDirection.Input, SqlDbType.DateTime)
    '            .DBParameters.Add("@nPatientID", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)
    '            .DBParameters.Add("@sTimeIn", lblTimeIn.Text.Trim, ParameterDirection.Input, SqlDbType.VarChar, 50)
    '            .DBParameters.Add("@sLocation", lblPatientLocation.Text.Trim, ParameterDirection.Input, SqlDbType.VarChar, 250)
    '            .DBParameters.Add("@sStatus", lblPatientStatus.Text.Trim, ParameterDirection.Input, SqlDbType.VarChar, 250)
    '            .DBParameters.Add("@sTimeOut", lblTimeOut.Text, ParameterDirection.Input, SqlDbType.VarChar, 50)
    '            '' For Check Out Pass 1 
    '            .DBParameters.Add("@bIsCheckOut", 1, ParameterDirection.Input, SqlDbType.Bit)
    '            .DBParameters.Add("@nID", 0, ParameterDirection.InputOutput, SqlDbType.BigInt)
    '            .Connect(GetConnectionString)
    '            If .ExecuteNonQuery("gsp_INSERT_PatientTracking") = True Then
    '                btnCheckIn.Enabled = False
    '                btnStatus.Enabled = False
    '                btnCheckOut.Enabled = False
    '            End If


    '            '' To Refresh The To DO List If it Is open
    '            Dim frm As frmToDoList
    '            frm = frmToDoList.GetInstance(_dtAppontmentDate, 1)

    '            If IsNothing(frm) = False Then
    '                If frm.Fill_ToDoList(_dtAppontmentDate) = False Then
    '                    frm.Close()
    '                    frm.Dispose()
    '                    frm = Nothing
    '                End If
    '            End If
    '            .Disconnect()
    '        End With
    '        oDB.Dispose()
    '        oDB = Nothing
    '    Catch ex As Exception
    '        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
    '    End Try
    'End Sub
    Private Sub DisplayGlobalPeriodMessage(ByVal _patientId As Long)
        Dim objPatientStatus As New PatientStatus(GetConnectionString)

        Dim _dtGlobalPeriod As DataTable = Nothing
        _dtGlobalPeriod = objPatientStatus.GetGlobalPeriods_ForAlter(_patientId)

        If _dtGlobalPeriod IsNot Nothing Then
            If _dtGlobalPeriod.Rows.Count = 1 Then
                Dim _strMessage As [String] = "Todays visit falls within a Global Period:" + Environment.NewLine + "CPT : " + _dtGlobalPeriod.Rows(0)("CPT").ToString().Trim() + Environment.NewLine + "Dates : " + _dtGlobalPeriod.Rows(0)("Dates").ToString().Trim()
                If _dtGlobalPeriod.Rows(0)("Provider").ToString().Trim() <> "" Then
                    _strMessage = _strMessage + Environment.NewLine + "Provider : " + _dtGlobalPeriod.Rows(0)("Provider").ToString().Trim()
                End If
                If _dtGlobalPeriod.Rows(0)("Insurance").ToString().Trim() <> "" Then
                    _strMessage = _strMessage + Environment.NewLine + "Insurance : " + _dtGlobalPeriod.Rows(0)("Insurance").ToString().Trim()
                End If
                If _dtGlobalPeriod.Rows(0)("Reminder").ToString().Trim() <> "" Then
                    _strMessage = _strMessage + Environment.NewLine + "Reminder : " + _dtGlobalPeriod.Rows(0)("Reminder").ToString().Trim()
                End If
                If _dtGlobalPeriod.Rows(0)("Notes").ToString().Trim() <> "" Then
                    _strMessage = _strMessage + Environment.NewLine + "Comment : " + _dtGlobalPeriod.Rows(0)("Notes").ToString().Trim()
                End If
                MessageBox.Show(_strMessage, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            ElseIf _dtGlobalPeriod.Rows.Count > 1 Then
                MessageBox.Show("Todays visit falls within MULTIPLE Global Periods.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If
        End If
        If Not IsNothing(_dtGlobalPeriod) Then  ''slr free _dtGlobalPeriod
            _dtGlobalPeriod.Dispose()
            _dtGlobalPeriod = Nothing
        End If

        If Not IsNothing(objPatientStatus) Then   ''slr free _dtGlobalPeriod
            objPatientStatus.Dispose()
            objPatientStatus = Nothing
        End If
    End Sub


    'Private Sub btnStatus_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    btnCheckIn_Click(sender, e)
    'End Sub

    'Private Sub Get_PatientLocationStatus()
    '    Try
    '        Dim oDB As New gloStream.gloDataBase.gloDataBase

    '        lblTimeIn.Text = ""
    '        lblPatientLocation.Text = ""
    '        lblPatientStatus.Text = ""
    '        lblPatientStatus.Tag = Nothing
    '        lblTimeOut.Text = ""

    '        btnCheckIn.Enabled = True
    '        btnStatus.Enabled = True
    '        btnCheckOut.Enabled = True


    '        Dim dt As DataTable
    '        Dim col_Users As New Collection
    '        Dim i As Integer

    '        With oDB
    '            '''' Get The Location & status 
    '            .DBParameters.Add("@nPatientID", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)
    '            .DBParameters.Add("@dtDate", Now.Date, ParameterDirection.Input, SqlDbType.DateTime)
    '            '' @flag = 1    --MAX(nID)- Get The Latest Location & Status For the Given Date 
    '            .DBParameters.Add("@flag", 1, ParameterDirection.Input, SqlDbType.Int)
    '            .Connect(GetConnectionString)
    '            dt = .ReadData("gsp_GetPatientLocation")
    '            .Disconnect()
    '            '  Dim dtstatuscode As DataTable  slr not used
    '            Dim dtcolorcode As DataTable
    '            If IsNothing(dt) = False Then
    '                If dt.Rows.Count > 0 Then
    '                    For i = 0 To dt.Rows.Count - 1
    '                        col_Users.Add(dt.Rows(i)("nUserID"))
    '                    Next


    '                    With dt.Rows(0)
    '                        If .Item("sLocation").ToString.Trim <> "" Then
    '                            lblPatientLocation.Text = .Item("sLocation") & "- at " & .Item("sTimeIn")
    '                            lblPatientStatus.Text = .Item("sStatus")
    '                        Else
    '                            lblPatientLocation.Text = ""
    '                            lblPatientStatus.Text = ""
    '                        End If

    '                        dtcolorcode = Nothing

    '                        Dim strSelectStatus As String = "SELECT  Distinct StatusUsers.nColorCode, StatusUsers.nStatusID  " _
    '                                                          & " FROM StatusUsers INNER JOIN Category_MST " _
    '                                                            & "  ON StatusUsers.nStatusID = Category_MST.nCategoryID where sDescription = '" & .Item("sStatus") & "' "

    '                        oDB.Connect(GetConnectionString)
    '                        dtcolorcode = oDB.ReadQueryDataTable(strSelectStatus)
    '                        oDB.Disconnect()

    '                        If IsNothing(dtcolorcode) = False Then
    '                            If dtcolorcode.Rows.Count > 0 Then
    '                                lblPatientLocation.ForeColor = Color.FromArgb(dtcolorcode.Rows(0)("nColorCode"))
    '                                lblPatientStatus.ForeColor = Color.FromArgb(dtcolorcode.Rows(0)("nColorCode"))
    '                            End If
    '                        End If

    '                        lblPatientStatus.Tag = col_Users
    '                        lblTimeOut.Text = .Item("sTimeOut")

    '                        If lblTimeOut.Text.Trim <> "" Then
    '                            btnCheckIn.Enabled = False
    '                            btnStatus.Enabled = False
    '                            btnCheckOut.Enabled = False
    '                        End If
    '                    End With
    '                End If
    '            End If

    '            .DBParameters.Clear()
    '            If Not IsNothing(dt) Then  ''slr dispose it
    '                dt.Dispose()
    '            End If
    '            dt = Nothing

    '            '' Get The Time In
    '            .DBParameters.Add("@nPatientID", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)
    '            .DBParameters.Add("@dtDate", Now.Date, ParameterDirection.Input, SqlDbType.DateTime)
    '            '' @flag = 2    --MIN(nID)- Get The TimeIn Value For the Given Date 
    '            .DBParameters.Add("@flag", 2, ParameterDirection.Input, SqlDbType.Int)
    '            .Connect(GetConnectionString)
    '            dt = .ReadData("gsp_GetPatientLocation")
    '            .Disconnect()

    '            If IsNothing(dt) = False Then
    '                If dt.Rows.Count > 0 Then
    '                    With dt.Rows(0)
    '                        lblTimeIn.Text = .Item("sTimeIn")
    '                        If lblTimeIn.Text.Trim <> "" Then
    '                            btnCheckIn.Enabled = False
    '                        End If
    '                    End With
    '                End If
    '            End If
    '        End With

    '        If lblTimeIn.Text.Trim = "" Then
    '            btnCheckOut.Enabled = False
    '        End If

    '        If Not IsNothing(dt) Then  ''slr dispose it
    '            dt.Dispose()
    '        End If
    '        dt = Nothing

    '        If IsNothing(oDB) = False Then
    '            oDB.Dispose() : oDB = Nothing
    '        End If

    '    Catch ex As Exception
    '        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
    '    End Try
    'End Sub

#End Region


    Private Sub DMS_ChartPull()
        '''' View Documents
        Try

            If gnPatientID <= 0 Then
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank

                If oPatientListControl.VisiblePatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If


            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim oList As New gloEDocumentV3.eDocManager.eDocGetList()
            If oList.GetDocumentCounts(gnPatientID, gClinicID) > 0 Then
                'Commented BY Rahul Patel on 26-10-2010
                'gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), gDMSV2TempPath, Convert.ToInt64(gnLoginID), gClinicID, Application.StartupPath)
                'Added by Rahul Patel on 26-10-2010
                'For changing the DMS Hybrid Database change.
                gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV2TempPath, Convert.ToInt64(gnLoginID), gClinicID, System.Windows.Forms.Application.StartupPath)
                'End of code added by Rahul Patel on 26-10-2010
                'sarika internet fax
                gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory = gstrFAXOutputDirectory
                gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = gblnInternetFax
                gloEDocumentV3.gloEDocV3Admin.gblnAddFaxCoverpage = gblnFAXCoverPage
                'sarika internet fax
                Dim oEDocument As New gloEDocumentV3.gloEDocV3Management()
                oEDocument.ShowEDocument(gnPatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewDocument, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.None, 0)
                oEDocument.Dispose()

            Else
                MessageBox.Show("No scan documents present for: " & gstrPatientFirstName & " " & gstrPatientLastName, "Pull Chart", MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If
            oList.Dispose()
            oList = Nothing

        Catch objErr As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Public Sub Scan_Documents(Optional ByVal CanImport As Boolean = True, Optional ByVal bIsFocus As Boolean = True)
        Try

            If gnPatientID <= 0 Then
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If
            'code comented by dipak to allow Open only Viewdocuments on doubleclick  document of Deceased patient
            'If CheckPatientStatus(gnPatientID) = False Then
            '    Exit Sub
            'End If
            If IsNothing(objUserRights) Then
                objUserRights = New clsLoginUserRights
                Dim ogloUserRights As New gloUserRights.ClsgloUserRights(GetConnectionString)
                objUserRights.RetrieveUserRights(gstrLoginName)
            End If

            If (objUserRights.DeceasedPatient = True Or CanImport = False) Then

            Else
                If IsAccess(False) = False Then
                    Exit Sub
                End If
            End If
            'end code commented by dipak 20100107

            '' SUDHIR 20090521 '' CHECK PROVIDER ''
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If
            '' END SUDHIR

            ''Check For Migration
            Dim oEDocument As New gloEDocumentV3.gloEDocV3Management()

            gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory = gstrFAXOutputDirectory
            gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = gblnInternetFax
            gloEDocumentV3.gloEDocV3Admin.gblnAddFaxCoverpage = gblnFAXCoverPage
            gloEDocumentV3.gloEDocV3Admin.gblnAssociatedProvider = gblnAssociatedProviderSignature
            'Commented BY Rahul Patel on 26-10-2010
            'gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), gDMSV3TempPath, gnLoginID, gClinicID, Application.StartupPath)
            'Added by Rahul Patel on 26-10-2010
            'For DMS Hybrid Database change
            gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV3TempPath, gnLoginID, gClinicID, System.Windows.Forms.Application.StartupPath)
            'End of code added by Rahul Patel on 26-10-2010
            gloEDocumentV3.gloEDocV3Admin.SetUserName(gstrLoginName)
            gloEDocumentV3.gloEDocV3Admin.GetDefaultPrinterDialog(gblnUseDefaultPrinter)

            oEDocument.oPatientExam = New clsPatientExams

            oEDocument.oPatientMessages = New clsMessage
            oEDocument.oPatientLetters = New clsPatientLetters
            oEDocument.oNurseNotes = New clsNurseNotes
            oEDocument.oHistory = New clsPatientHistory
            oEDocument.oLabs = New clsLabs
            oEDocument.oDMS = New gloEDocumentV3.eDocManager.eDocGetList()
            oEDocument.oRxmed = New clsPatientDetails
            oEDocument.oOrders = New clsPatientDetails
            oEDocument.oProblemList = New clsPatientProblemList

            oEDocument.oCriteria = New DocCriteria
            oEDocument.oWord = New clsWordDocument
            oEDocument.dMdi = Me

            Dim isItDialog As Boolean = True
            If CanImport = True Then
                isItDialog = oEDocument.ShowEDocument(gnPatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ScanDocument, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.None, 0)
            Else
                ''Bugzilla ID-4056, RC3 List No -36
                '' Enable all buttons excpet Scan, Import  & Delete 
                isItDialog = oEDocument.ShowEDocument(gnPatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewAllDocuments, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.None, 0)
            End If
            If (isItDialog) Then


                If (IsNothing(oEDocument.oPatientExam) = False) Then
                    DirectCast(oEDocument.oPatientExam, clsPatientExams).Dispose()
                    oEDocument.oPatientExam = Nothing
                End If
                If (IsNothing(oEDocument.oPatientMessages) = False) Then
                    DirectCast(oEDocument.oPatientMessages, clsMessage).Dispose()
                    oEDocument.oPatientMessages = Nothing
                End If
                If (IsNothing(oEDocument.oPatientLetters) = False) Then
                    DirectCast(oEDocument.oPatientLetters, clsPatientLetters).Dispose()
                    oEDocument.oPatientLetters = Nothing
                End If
                If (IsNothing(oEDocument.oNurseNotes) = False) Then
                    DirectCast(oEDocument.oNurseNotes, clsNurseNotes).Dispose()
                    oEDocument.oNurseNotes = Nothing
                End If
                If (IsNothing(oEDocument.oHistory) = False) Then
                    DirectCast(oEDocument.oHistory, clsPatientHistory).Dispose()
                    oEDocument.oHistory = Nothing
                End If
                If (IsNothing(oEDocument.oLabs) = False) Then
                    DirectCast(oEDocument.oLabs, clsLabs).Dispose()
                    oEDocument.oLabs = Nothing
                End If
                If (IsNothing(oEDocument.oDMS) = False) Then
                    DirectCast(oEDocument.oDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                    oEDocument.oDMS = Nothing
                End If
                If (IsNothing(oEDocument.oRxmed) = False) Then
                    DirectCast(oEDocument.oRxmed, clsPatientDetails).Dispose()
                    oEDocument.oRxmed = Nothing
                End If
                If (IsNothing(oEDocument.oOrders) = False) Then
                    DirectCast(oEDocument.oOrders, clsPatientDetails).Dispose()
                    oEDocument.oOrders = Nothing
                End If
                If (IsNothing(oEDocument.oProblemList) = False) Then
                    DirectCast(oEDocument.oProblemList, clsPatientProblemList).Dispose()
                    oEDocument.oProblemList = Nothing
                End If

                If (IsNothing(oEDocument.oCriteria) = False) Then
                    DirectCast(oEDocument.oCriteria, DocCriteria).Dispose()
                    oEDocument.oCriteria = Nothing
                End If
                oEDocument.Dispose()
            End If
            oEDocument = Nothing
            Call ShowPatientDetails()
            If bIsFocus = True Then  '' To Resolved bug 50364
                Me.Focus() '' code integrated for scanning focus issue 
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub RCM_Documents()
        Try

            Dim oEDocument As New gloEDocumentV3.gloEDocV3Management()

            gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory = gstrFAXOutputDirectory
            gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = gblnInternetFax
            gloEDocumentV3.gloEDocV3Admin.gblnAddFaxCoverpage = gblnFAXCoverPage
            gloEDocumentV3.gloEDocV3Admin.gblnAssociatedProvider = gblnAssociatedProviderSignature

            gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV3TempPath, gnLoginID, gClinicID, System.Windows.Forms.Application.StartupPath)

            gloEDocumentV3.gloEDocV3Admin.SetUserName(gstrLoginName)
            gloEDocumentV3.gloEDocV3Admin.GetDefaultPrinterDialog(gblnUseDefaultPrinter)

            oEDocument.dMdi = Me

            Dim isItDialog As Boolean = True

            isItDialog = oEDocument.ShowEDocument(-1, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ScanDocument, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.RCM, 0)

            If (isItDialog) Then
                oEDocument.Dispose()
            End If
            oEDocument = Nothing
            Call ShowPatientDetails()

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Function GenerateFilePath(ByVal BasePath As String, ByVal PatientID As Int64, ByVal ContainerID As Int64, ByVal Year As String) As String
        Return BasePath & "\\" & PatientID.ToString() & "~" & Year.ToString() & "~" & ContainerID.ToString() & ".pdf"
    End Function

    Public Function checkFileStatus(ByVal strPath As String) As Boolean
        Dim ofile As System.IO.FileStream = Nothing
        Try
            If File.Exists(strPath) = False Then
                Return False
            Else
                ofile = IO.File.Open(strPath, FileMode.Open, FileAccess.Read, FileShare.None)
                Return False
            End If

        Catch ex As IO.IOException
            Return True
        Finally
            If Not ofile Is Nothing Then
                ofile.Close()
                ofile.Dispose() ''slr dispose ofile 
                ofile = Nothing
            End If

        End Try
    End Function

    Private Sub AddNewMessage(ByVal sender As Object, ByVal e As EventArgs)
        Try
            If gnPatientID > 0 Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                '  If _nLabPatientId <> 0 Then
                'If (gnPatientID <> _nLabPatientId) Then
                '    SelectPatientOnDashboard(_nLabPatientId)
                'End If
                'End If

                'Dim frmlab As frmViewgloLab
                'frmlab = frmViewgloLab.GetInstance()
                'If IsNothing(frmlab) = False Then
                '    If IsNothing(frmlab.LabPatientID) = False Then
                '        If frmlab.LabPatientID <> 0 Then
                '            SelectPatientOnDashboard(frmlab.LabPatientID)
                '        End If
                '    End If
                'End If

                If gblnProviderDisable = True Then


                    'If ShowAssociateProvider(IIf(_nLabPatientId > 0, _nLabPatientId, gnPatientID)) = False Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If
                System.Windows.Forms.Application.DoEvents()

                'If CheckWordForException() = False Then
                '    Exit Sub
                'End If

                dtWord = New DataTable
                objWord = New clsWordDocument
                dtWord = objWord.FillTemplates(enumTemplateFlag.Messages)
                objWord = Nothing
                If (IsNothing(dtWord) = False) Then


                    If dtWord.Rows.Count = 0 Then
                        ''''If not present then exit from sub
                        MessageBox.Show("No template is associated for messages. Associate any template first.", "Patient Messages", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Exit Sub
                    Else
                        Dim frm As frmMessages
                        '' Opened From Main Menu i.e pass 1
                        '  frm = frmMessages.GetInstance(0, gnLoginID, Now, IIf(_nLabPatientId > 0, _nLabPatientId, gnPatientID), 2)
                        frm = frmMessages.GetInstance(0, gnLoginID, Now, gnPatientID, 2)
                        If IsNothing(frm) = True Then
                            Exit Sub
                        End If

                        'AddHandler frm.e, AddressOf OpenMessage
                        With frm
                            ''Added by Mayuri:20100422-To fix case No:#0003868
                            frmVWMessages.blnModify = False
                            .Update()
                            If (.Visible = False) Then
                                .Text = "New Messages"
                            End If
                            .MdiParent = Me
                            .myCallerMain = Me
                            .dtTemplates = dtWord.Copy

                            .WindowState = FormWindowState.Maximized
                            .BringToFront()
                            .Show()

                            If Not IsNothing(frm.uiPanSplitScreen_PatientMessages) Then
                                If Not IsNothing(frm.uiPanSplitScreen_PatientMessages.Parent) Then
                                    If frm.uiPanSplitScreen_PatientMessages.Parent.Text = "Split Screen" Then
                                        frm.uiPanSplitScreen_PatientMessages.Parent.Visible = True
                                    ElseIf frm.uiPanSplitScreen_PatientMessages.Text = "Split Screen" Then
                                        frm.uiPanSplitScreen_PatientMessages.Visible = True
                                    End If

                                End If

                            End If

                            ShowHideMainMenu(False, False)
                            Me.pnlMainToolBar.Visible = False

                        End With

                    End If

                    '09-Jul-14 Aniket: Resolving Bug #70606:
                    'MessageBox.Show("No template is associated for messages. associate any template first", "patient exam", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub

                End If
            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            Me.pnlMainToolBar.Visible = True
            ShowHideMainMenu(True, True)
        Finally
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
        End Try
    End Sub

    Private Function GetPatientID(ByVal PatientCode As String) As Long
        Dim oDB As New gloStream.gloDataBase.gloDataBase
        Dim strSQL As String
        Dim PatID As String
        strSQL = "SELECT nPatientID FROM Patient WHERE  sPatientCode = '" & PatientCode & "'"
        oDB.Connect(GetConnectionString)
        PatID = oDB.ExecuteQueryScaler(strSQL)
        oDB.Disconnect()
        oDB.Dispose()
        oDB = Nothing
        If PatID = "" Then
            Return 0
        Else
            Return CLng(PatID)
        End If
    End Function

    Private Function GetPatientCodefromID(ByVal nPatientID As Long) As String
        Dim oDB As New gloStream.gloDataBase.gloDataBase
        ' Dim strSQL As String
        Dim PatCode As String
        oDB.Connect(GetConnectionString)
        PatCode = oDB.ExecuteQueryScaler("SELECT  sPatientCode FROM Patient where nPatientID = " & nPatientID)
        oDB.Disconnect()
        oDB.Dispose() ''slr free odb 
        oDB = Nothing
        Return PatCode
    End Function

    Public Sub ShowHideMainMenu(ByVal show As Boolean, ByVal showNavigator As Boolean)
        'code added by dipak for patient context changes
        Try
            If (show = True) Then
                If (gnPatientID <> oPatientListControl.SelectedPatientID) Then
                    SelectPatientOnDashboard(gnPatientID)
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
        End Try
        'End code added by dipak for patient context changes
        Me.SuspendLayout()
        UpdateLog("ShowHideMainMenu Started show =" & show & ", showNavigator =" & showNavigator)
        If (show = False) Then
            For Each c As Control In Me.Controls
                If c.Name.Trim() <> "pnlPatientList" Then
                    c.SuspendLayout()
                End If
            Next

        End If

        pnlPatientList.Visible = show
        pnlGrPatientDemoCardsStatus.Visible = show
        pnlPatientDetail.Visible = show
        pnlMainToolBar.Visible = show
        pnlLeft_Nav.Visible = showNavigator
        pnlPatientCheckInStatus.DockState = Janus.Windows.UI.Dock.PanelDockState.Docked
        pnlPatientCheckInStatus.Visible = showNavigator

        '' Hide Floting Panels 
        If pnlPatientDemographics.DockState = Janus.Windows.UI.Dock.PanelDockState.Floating Then
            If IsNothing(pnlPatientDemographics.ParentGroup) Then
                pnlPatientDemographics.Parent.Visible = show
            Else
                pnlPatientDemographics.ParentGroup.Parent.Visible = show
            End If
        End If

        If pnlJPatientStatus.DockState = Janus.Windows.UI.Dock.PanelDockState.Floating Then

            If IsNothing(pnlJPatientStatus.ParentGroup) Then
                pnlJPatientStatus.Parent.Visible = show
            Else
                pnlJPatientStatus.ParentGroup.Parent.Visible = show
            End If
        End If

        ''Added by Sanjog on 08/06/2010 for DashBoards for Dock Pnl Visible----- startCode 
        If pnl_Messages.DockState = Janus.Windows.UI.Dock.PanelDockState.Floating Then
            pnl_Messages.Parent.Visible = show
        End If
        If pnlTasks.DockState = Janus.Windows.UI.Dock.PanelDockState.Floating Then
            pnlTasks.Parent.Visible = show
        End If
        If pnlNav_Appointments.DockState = Janus.Windows.UI.Dock.PanelDockState.Floating Then
            pnlNav_Appointments.ParentGroup.Parent.Visible = show
        End If

        ''Added by Sanjog on 08/06/2010 for DashBoards for Dock Pnl Visible----- EndCode 

        If pnlPatientCard.DockState = Janus.Windows.UI.Dock.PanelDockState.Floating Then
            If IsNothing(pnlPatientCard.ParentGroup) Then
                pnlPatientCard.Parent.Visible = show
            Else
                pnlPatientCard.ParentGroup.Parent.Visible = show
            End If
        End If

        If pnlPatientDetail.DockState = Janus.Windows.UI.Dock.PanelDockState.Floating Then
            If IsNothing(pnlPatientDetail.ParentGroup) Then
                pnlPatientDetail.Parent.Visible = show
            Else
                pnlPatientDetail.ParentGroup.Parent.Visible = show
            End If
        End If

        If gblnSecurityUser = True Then
            pnlLeft_Nav.Visible = False
            pnlPatientDemographics.Parent.Visible = False
            pnlPatientStatus.Parent.Visible = False
            pnlPatientCard.Parent.Visible = False
            pnlPatientCheckInStatus.DockState = Janus.Windows.UI.Dock.PanelDockState.Docked
            pnlPatientCheckInStatus.Visible = False
        End If

        Me.ResumeLayout()
        If (show = True) Then
            For Each c As Control In Me.Controls
                If c.Name.Trim() <> "pnlPatientList" Then
                    c.ResumeLayout(True)
                End If
            Next
        End If
        UpdateLog("ShowHideMainMenu Ended show =" & show & ", showNavigator =" & showNavigator)

    End Sub
    ''Added optional parameter for exam if form is patient exam opening from task window
    Friend Sub MdiExamChildActivate(ByVal frmExamChild As mdlgloVoice.gloVoice, Optional ByVal _IsFromExam As Boolean = False, Optional ByRef Dashboardform As MainMenu = Nothing)
        Try
            ''To Remove voice menu for Modal forms
            Dashboardform = Me
            If _IsFromExam Then
                myRefCaller = frmExamChild
                Exit Sub
            End If
            If gblnVoiceEnabled = True AndAlso gblnSpeakerExists = True Then
                IExam = Nothing


                myRefCaller = frmExamChild

                If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                    DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "MIC off on MdiExamChildActivate", gloAuditTrail.ActivityOutCome.Success)
                End If

                If Not IsNothing(vVoiceMenu) Then
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "vVoiceMenu cleanup started on MdiExamChildActivate", gloAuditTrail.ActivityOutCome.Success)
                    vVoiceMenu.Remove(1)
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "vVoiceMenu 1 cleanup done on MdiExamChildActivate", gloAuditTrail.ActivityOutCome.Success)
                    vVoiceMenu.Remove(2)
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "vVoiceMenu 2 cleanup done on MdiExamChildActivate", gloAuditTrail.ActivityOutCome.Success)
                    vVoiceMenu.Active = False

                    System.Runtime.InteropServices.Marshal.ReleaseComObject(vVoiceMenu)
                    vVoiceMenu = Nothing
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "vVoiceMenu cleanup done", gloAuditTrail.ActivityOutCome.Success)

                End If

                'Add voice menu for Patient Exam
                Dim strMenuName As String
                strMenuName = "gloEMRVoice" & CType(System.DateTime.Now.Year, String) & CType(System.DateTime.Now.Month, String) & CType(System.DateTime.Now.Day, String) & CType(System.DateTime.Now.Hour, String) & CType(System.DateTime.Now.Minute, String) & CType(System.DateTime.Now.Second, String)
                vVoiceMenu = Vcmd.MenuCreate(strMenuName, strMenuName & "1", DNSTools.DgnLanguageConstants.dgnlangUSEnglish, "", DNSTools.CREATEFLAGS.vcmdmc_CREATE_TEMP)
                vVoiceMenu.hWndMenu = CType(frmExamChild, IExamChildEvents).Handle
                vVoiceMenu.Active = True
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "vVoiceMenu initialisation done on MdiExamChildActivate", gloAuditTrail.ActivityOutCome.Success)

                frmExamChild.AddVoiceCommands()
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "frmExamChild.AddVoiceCommands is done on MdiExamChildActivate", gloAuditTrail.ActivityOutCome.Success)

                IExam = CType(frmExamChild, IHotKey)
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "frmExamChild.IHotKey is done on MdiExamChildActivate", gloAuditTrail.ActivityOutCome.Success)
            Else
                ''to set myrefcaller for forms opeing from exam module like DM template,guidelines fax etc.
                myRefCaller = frmExamChild
            End If

        Catch objErr As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Error at MdiExamChildActivate" & objErr.ToString, gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub
    ''Added optional parameter for exam if form is patient exam opening from task window
    Friend Sub MdiExamChildDeActivate(ByVal frmExamChild As mdlgloVoice.gloVoice, Optional ByVal _IsFromExam As Boolean = False)
        Try
            If _IsFromExam Then
                myRefCaller = Nothing
                Exit Sub
            End If
            '' To Remove voice menu for Modal forms
            If gblnVoiceEnabled = True AndAlso gblnSpeakerExists = True Then

                IExam = Nothing

                myRefCaller = Nothing
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "MdiExamChildDeActivate  started ", gloAuditTrail.ActivityOutCome.Success)

                If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                    DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                End If

                If Not IsNothing(vVoiceMenu) Then
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "MdiExamChildDeActivate  started ", gloAuditTrail.ActivityOutCome.Success)

                    vVoiceMenu.Remove(1)
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "vVoiceMenu 1 cleanup done at MdiExamChildDeActivate", gloAuditTrail.ActivityOutCome.Success)
                    vVoiceMenu.Active = False

                    System.Runtime.InteropServices.Marshal.ReleaseComObject(vVoiceMenu)
                    vVoiceMenu = Nothing
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "vVoiceMenu cleanup done at MdiExamChildDeActivate", gloAuditTrail.ActivityOutCome.Success)
                End If

                'Add voice menu for Patient Exam
                Dim strMenuName As String
                strMenuName = "gloEMRVoice" & CType(System.DateTime.Now.Year, String) & CType(System.DateTime.Now.Month, String) & CType(System.DateTime.Now.Day, String) & CType(System.DateTime.Now.Hour, String) & CType(System.DateTime.Now.Minute, String) & CType(System.DateTime.Now.Second, String)
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "vVoiceMenu initializing", gloAuditTrail.ActivityOutCome.Success)
                vVoiceMenu = Vcmd.MenuCreate(strMenuName, strMenuName & "1", DNSTools.DgnLanguageConstants.dgnlangUSEnglish, "", DNSTools.CREATEFLAGS.vcmdmc_CREATE_TEMP)
                vVoiceMenu.hWndMenu = Me.Handle.ToInt32
                vVoiceMenu.Active = True

                If Not IsNothing(vVoiceMenu) Then
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Adding Voice Commands started on MdiExamChildDeActivate", gloAuditTrail.ActivityOutCome.Success)

                    Dim I As gloVoice
                    Try
                        If Me.ActiveMdiChild.Name = "frmTemplateGallery" Or Me.ActiveMdiChild.Name = "frmPatientExam" Or Me.ActiveMdiChild.Name = "frmMessages" Or Me.ActiveMdiChild.Name = "frmPatientLetter" Or Me.ActiveMdiChild.Name = "frm_LM_Orders" Or Me.ActiveMdiChild.Name = "frmPTProtocols" Or Me.ActiveMdiChild.Name = "frmNurseNotes" Or Me.ActiveMdiChild.Name = "frmPatientConsent" Or Me.ActiveMdiChild.Name = "frmPatientEducation" Or Me.ActiveMdiChild.Name = "frmDisclosureMgmt" Or Me.ActiveMdiChild.Name = "frmTriage" Or Me.ActiveMdiChild.Name = "frmCPTTemplate" Or Me.ActiveMdiChild.Name = "frmDM_Template" Or Me.ActiveMdiChild.Name = "frmMSTTemplateGallery" Then
                            I = CType(Me.ActiveMdiChild, gloVoice)
                            I.AddVoiceCommands()
                        End If
                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Error at MdiExamChildDeActivate -" & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
                    End Try
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Adding Voice Commands done on MdiExamChildDeActivate", gloAuditTrail.ActivityOutCome.Success)

                End If
                If Not Me.ActiveMdiChild Is Nothing Then

                    If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                        IExam = CType(Me.ActiveMdiChild, IHotKey)
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "frmPatientExam.IHotKey done on MdiExamChildDeActivate", gloAuditTrail.ActivityOutCome.Success)
                    End If
                End If
            Else
                ''to set myrefcaller for forms opeing from exam module like DM template,guidelines fax etc.
                myRefCaller = Nothing
            End If
        Catch objErr As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Error at MdiExamChildDeActivate -" & objErr.ToString, gloAuditTrail.ActivityOutCome.Failure)
        End Try

    End Sub

    Public Sub ShowDefaultPatientDetails(ByVal PatientID As Long)
        LoadSelectedPatientInfo(PatientID)
        LoadSelectedPatientInfo_Part2((PatientID))
    End Sub

    'To Show default Patient details..like Patient Name, Photo, Patient Details like Demographic Information
    Public Function ShowDefaultPatientDetails() As Boolean
        gnPatientID = GetPatientID(gstrPatientCode)
        Return Nothing
    End Function

#Region " ePrescription "


    Private Sub mnuVwErrorMessages_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) ''Handles mnuVwErrorMessages.Click

        Try

            Dim obj As frmVWErrorMessage
            obj = frmVWErrorMessage.GetInstance()
            obj.ShowInTaskbar = False
            obj.MdiParent = Me
            obj.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ''' <summary>
    ''' Timer Click to show the Alert After Given Interval 
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks>Add By Pramod for Surescript message Alert</remarks>
    Private Sub tmrsurecriptAlert_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tmrsurescriptAlert.Tick ', tmrsurecriptAlert.Tick
        tmrsurescriptAlert.Enabled = False
        If gblnSurescriptAlert = True Then
            FillMessage()
        End If
        tmrsurescriptAlert.Enabled = True
    End Sub

    ''' <summary>
    ''' Design FlexGrid for showing Messages for Surescript Alert
    ''' </summary>
    ''' <remarks>Add by Pramod to show Surescript Alert</remarks>
    Private Sub DesignGrid_Alert()
        SetGridStyle(C1AlertMessages)
        With C1AlertMessages
            .Rows.Count = 1
            .Rows.Fixed = 1
            .Cols.Fixed = 0
            Dim _TotalWidth As Single = .Width - 5
            .Cols.Count = COL_Alt_Count

            ''''Message ID
            .SetData(0, COL_Alt_MessageID, "Message ID")
            .Cols(COL_Alt_MessageID).Width = 0
            .Cols(COL_Alt_MessageID).TextAlign = TextAlignEnum.GeneralCenter
            .Cols(COL_Alt_MessageID).AllowEditing = False

            '''' Prescriber ID
            .SetData(0, COL_ALT_PrescriberID, "Prescriber ID")
            .Cols(COL_ALT_PrescriberID).Width = 0
            .Cols(COL_ALT_PrescriberID).TextAlign = TextAlignEnum.GeneralCenter
            .Cols(COL_ALT_PrescriberID).AllowEditing = False

            ''''Message Date
            .SetData(0, COL_Alt_MessageDate, "Date")
            .Cols(COL_Alt_MessageDate).Width = _TotalWidth * 0.34
            .Cols(COL_Alt_MessageDate).TextAlign = TextAlignEnum.GeneralCenter
            .Cols(COL_Alt_MessageDate).AllowEditing = False

            ''''Message Type
            .SetData(0, COL_Alt_MessageType, "Message Type")
            .Cols(COL_Alt_MessageType).Width = _TotalWidth * 0.28
            .Cols(COL_Alt_MessageType).TextAlign = TextAlignEnum.GeneralCenter
            .Cols(COL_Alt_MessageType).AllowEditing = False

            ''''Message To
            .SetData(0, COL_Alt_MessageTo, "Message To")
            .Cols(COL_Alt_MessageTo).Width = _TotalWidth * 0.28
            .Cols(COL_Alt_MessageTo).TextAlign = TextAlignEnum.GeneralCenter
            .Cols(COL_Alt_MessageTo).AllowEditing = False

            ''''Select
            .SetData(0, COL_Alt_Select, "...")
            .Cols(COL_Alt_Select).Width = _TotalWidth * 0.05
            .Cols(COL_Alt_Select).TextAlign = TextAlignEnum.GeneralCenter
            .Cols(COL_Alt_Select).AllowEditing = True

        End With
    End Sub

    ''' <summary>
    ''' Set Style for FlexGrid 
    ''' </summary>
    ''' <remarks>Add by Pramod to show Surescript Alert</remarks>
    Private Sub SetGridStyle(ByVal oFlex As C1.Win.C1FlexGrid.C1FlexGrid)
        With oFlex
            .ShowButtons = C1.Win.C1FlexGrid.ShowButtonsEnum.Always

            Dim csHeader As C1.Win.C1FlexGrid.CellStyle

            Try
                If (.Styles.Contains("CS_Header")) Then
                    csHeader = .Styles("CS_Header")
                Else
                    csHeader = .Styles.Add("CS_Header") ''style new for every row
                    With csHeader
                        .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Bold) 'IIf(Font.Height = 8.25F, gFont_SMALL_BOLD, IIf(Font.Height = 9.0F, gFont_BOLD, New Font(Font, FontStyle.Bold)))
                        .ForeColor = Color.Maroon
                        .BackColor = Color.FromArgb(192, 203, 233)
                        .DataType = GetType(String)
                    End With
                End If
            Catch ex As Exception
                csHeader = .Styles.Add("CS_Header") ''style new for every row
                With csHeader
                    .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Bold) 'IIf(Font.Height = 8.25F, gFont_SMALL_BOLD, IIf(Font.Height = 9.0F, gFont_BOLD, New Font(Font, FontStyle.Bold)))
                    .ForeColor = Color.Maroon
                    .BackColor = Color.FromArgb(192, 203, 233)
                    .DataType = GetType(String)
                End With
            End Try



            Dim csRecord As C1.Win.C1FlexGrid.CellStyle

            Try
                If (.Styles.Contains("CS_Record")) Then
                    csRecord = .Styles("CS_Record")
                Else
                    csRecord = .Styles.Add("CS_Record") ''style new for every row
                    With csRecord
                        .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Regular) 'IIf(Font.Height = 8.25F, gFont_SMALL, IIf(Font.Height = 9.0F, gFont, New Font(Font, FontStyle.Regular)))
                        .ForeColor = Color.Black
                        .BackColor = Color.GhostWhite
                        .DataType = GetType(String)
                    End With
                End If
            Catch ex As Exception
                csRecord = .Styles.Add("CS_Record") ''style new for every row
                With csRecord
                    .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Regular) 'IIf(Font.Height = 8.25F, gFont_SMALL, IIf(Font.Height = 9.0F, gFont, New Font(Font, FontStyle.Regular)))
                    .ForeColor = Color.Black
                    .BackColor = Color.GhostWhite
                    .DataType = GetType(String)
                End With
            End Try


            Dim csComboList As C1.Win.C1FlexGrid.CellStyle
            Try
                If (.Styles.Contains("CS_ComboList")) Then
                    csComboList = .Styles("CS_ComboList")
                Else
                    csComboList = .Styles.Add("CS_ComboList") ''style new for every row
                    With csComboList
                        .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Regular) 'IIf(Font.Height = 8.25F, gFont_SMALL, IIf(Font.Height = 9.0F, gFont, New Font(Font, FontStyle.Regular)))
                        .ForeColor = Color.Black
                        .BackColor = Color.GhostWhite
                        .DataType = GetType(String)
                        .ComboList = "..."
                    End With
                End If
            Catch ex As Exception
                csComboList = .Styles.Add("CS_ComboList") ''style new for every row
                With csComboList
                    .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Regular) 'IIf(Font.Height = 8.25F, gFont_SMALL, IIf(Font.Height = 9.0F, gFont, New Font(Font, FontStyle.Regular)))
                    .ForeColor = Color.Black
                    .BackColor = Color.GhostWhite
                    .DataType = GetType(String)
                    .ComboList = "..."
                End With
            End Try







            Dim csCheckBox As C1.Win.C1FlexGrid.CellStyle
            Try
                If (.Styles.Contains("CS_CheckBox")) Then
                    csCheckBox = .Styles("CS_CheckBox")
                Else
                    csCheckBox = .Styles.Add("CS_CheckBox") ''style new for every row
                    With csCheckBox
                        .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Regular) 'IIf(Font.Height = 8.25F, gFont_SMALL, IIf(Font.Height = 9.0F, gFont, New Font(Font, FontStyle.Regular)))
                        .ForeColor = Color.Black
                        .BackColor = Color.GhostWhite
                        .DataType = GetType(Boolean)
                    End With
                End If
            Catch ex As Exception
                csCheckBox = .Styles.Add("CS_CheckBox") ''style new for every row
                With csCheckBox
                    .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Regular) 'IIf(Font.Height = 8.25F, gFont_SMALL, IIf(Font.Height = 9.0F, gFont, New Font(Font, FontStyle.Regular)))
                    .ForeColor = Color.Black
                    .BackColor = Color.GhostWhite
                    .DataType = GetType(Boolean)
                End With
            End Try


            Dim csNotNormal As C1.Win.C1FlexGrid.CellStyle
            Try
                If (.Styles.Contains("CS_NotNormal")) Then
                    csNotNormal = .Styles("CS_NotNormal")
                Else
                    csNotNormal = .Styles.Add("CS_NotNormal") ''style new for every row
                    With csNotNormal
                        .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Regular) 'IIf(Font.Height = 8.25F, gFont_SMALL, IIf(Font.Height = 9.0F, gFont, New Font(Font, FontStyle.Regular)))
                        .ForeColor = Color.Red
                        .BackColor = Color.GhostWhite
                    End With
                End If
            Catch ex As Exception
                csNotNormal = .Styles.Add("CS_NotNormal") ''style new for every row
                With csNotNormal
                    .Font = gloGlobal.clsgloFont.getFontFromExistingSource(Font, FontStyle.Regular) 'IIf(Font.Height = 8.25F, gFont_SMALL, IIf(Font.Height = 9.0F, gFont, New Font(Font, FontStyle.Regular)))
                    .ForeColor = Color.Red
                    .BackColor = Color.GhostWhite
                End With
            End Try


        End With
    End Sub
    Dim bNotificationClosed As Boolean = False

    Private Sub btnSurescriptClose_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnSurescriptClose.Click
        tmrshowsurepnl.Enabled = False
        pnlSurescriptAlert.Visible = False
        tmrsurescriptAlert.Enabled = True
        bNotificationClosed = True
    End Sub

    ''' <summary>
    ''' Timer tick to show the Alert Panle from Botttom To top
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks>Add By Pramod to show surescript Alert</remarks>
    Private Sub tmrshowsurepnl_Tick(ByVal sender As Object, ByVal e As System.EventArgs) Handles tmrshowsurepnl.Tick
        tmrshowsurepnl.Enabled = False
        If gblnSurescriptAlert = True Then
            If pnlSurescriptAlert.Top > Me.Height - (pnlSurescriptAlert.Height + 50) Then
                pnlSurescriptAlert.Top = pnlSurescriptAlert.Top - 15
            Else
                tmrshowsurepnl.Enabled = False
            End If
        Else
            tmrshowsurepnl.Enabled = False
        End If
        tmrshowsurepnl.Enabled = True
    End Sub

    ''' <summary>
    ''' Flex Grid Button Clikc event to show the RefillRequest Or Error Message
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks>Add By Pramod to show SureScript Message</remarks>
    Private Sub C1AlertMessages_CellButtonClick(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.RowColEventArgs) Handles C1AlertMessages.CellButtonClick
        Dim PrescriberID As Int64
        Dim sMessageType As String = C1AlertMessages.GetData(C1AlertMessages.Row, COL_Alt_MessageType)

        Int64.TryParse(Convert.ToString(C1AlertMessages.GetData(C1AlertMessages.Row, COL_ALT_PrescriberID)), PrescriberID)

        Select Case sMessageType
            Case "RefillRequest"
                Try

                    Dim obj As frmRxRequest
                    obj = frmRxRequest.GetInstance(gnPatientID, PrescriberID)
                    If IsNothing(obj) = True Then
                        Exit Sub
                    End If

                    obj.ShowInTaskbar = False
                    obj.MdiParent = Me
                    obj.WindowState = FormWindowState.Maximized
                    obj.Show()

                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False

                Catch objErr As Exception
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            Case "Error"
                Try
                    Dim obj As frmVWErrorMessage

                    obj = frmVWErrorMessage.GetInstance(PrescriberID)
                    If IsNothing(obj) = True Then
                        Exit Sub
                    End If

                    obj.ShowInTaskbar = False
                    obj.MdiParent = Me
                    obj.Show()

                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                    obj.WindowState = FormWindowState.Maximized
                Catch objErr As Exception
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            Case "CancelRx", "RxChangeRequest"
                Try
                    Dim obj As frmViewRxRequests = Nothing
                    'Dim enumFormType As frmViewRxRequests.RxFormType = frmViewRxRequests.RxFormType.RxChangeRequest
                    '[Enum].TryParse(sMessageType, enumFormType)

                    obj = frmViewRxRequests.GetInstance(0, PrescriberID)
                    If IsNothing(obj) = True Then
                        Exit Sub
                    End If

                    obj.ShowInTaskbar = False
                    obj.MdiParent = Me
                    obj.Show()

                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                    obj.WindowState = FormWindowState.Maximized
                Catch objErr As Exception
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try

            Case "RxFill"
                Try
                    Dim sMessageID As String = C1AlertMessages.GetData(C1AlertMessages.Row, COL_Alt_MessageID)
                    Dim dtVisitDate As Date = Nothing

                    Date.TryParse(Convert.ToString(C1AlertMessages.GetData(C1AlertMessages.Row, COL_Alt_MessageDate)), dtVisitDate)

                    Dim obj As frmRxFillNotification = Nothing

                    obj = frmRxFillNotification.GetInstance(sMessageID, dtVisitDate)
                    If IsNothing(obj) = True Then
                        Exit Sub
                    End If

                    obj.ShowInTaskbar = False
                    obj.MdiParent = Me
                    obj.Show()

                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                    obj.WindowState = FormWindowState.Maximized

                Catch objErr As Exception
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            Case "CancelRxResponse"
                Try
                    Dim obj As frmViewPrescriptions = Nothing

                    If IsNothing(obj) = True Then
                        obj = frmViewPrescriptions.GetInstance(0, PrescriberID)
                        obj.ShowInTaskbar = False
                        obj.MdiParent = Me
                        obj.Show()

                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False
                        obj.WindowState = FormWindowState.Maximized
                    Else
                        obj.BringToFront()
                    End If
                Catch objErr As Exception
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
        End Select
    End Sub


    ''' <summary>
    ''' Refresh Button click to Refresh the Message on Alert Panel
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks>Add By Pramod  for sureScript Messages</remarks>
    Private Sub btnSRefresh_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnSRefresh.Click
        FillMessage()
    End Sub


    Dim notifications As New List(Of String)

    Public Function ShowNotifications(ByVal newList As List(Of String)) As Boolean

        If newList IsNot Nothing Then
            Return (Not newList.SequenceEqual(notifications))
        Else
            Return False
        End If

        'Return (Not newList.Equals(notifications))
        'For Each i As String In newList
        '    If notifications.Contains(i) = False Then
        '        result = True
        '    End If
        'Next
        'Return result
    End Function

    Public Sub FillMessage()
        Dim oDB As New DataBaseLayer
        Dim oDataset As DataSet = Nothing
        Dim nProviderParameter As New DBParameter()
        Dim new_notifications As New List(Of String)

        Try
            If gblnSurescriptAlert = True Then
                tmrsurescriptAlert.Enabled = False

                nProviderParameter.Name = "@nProviderID"
                nProviderParameter.Value = gnLoginProviderID
                oDB.DBParametersCol.Add(nProviderParameter)

                oDataset = oDB.GetDataSet("GetSurescriptMessages", True)

                If Not IsNothing(oDataset) Then
                    If oDataset.Tables.Count > 0 Then
                        ''if condition added for problem  00000493 : Rx Meds bugid  #53978:
                        ''problem alert box is displaying if no pending messages is there
                        If oDataset.Tables(0).Rows.Count > 0 Then

                            DesignGrid_Alert()
                            tmrshowsurepnl.Enabled = True
                            pnlSurescriptAlert.BringToFront()
                            pnlSurescriptAlert.Top = Me.Height '(Me.Height - 175)


                            new_notifications.Clear()

                            For i As Integer = 0 To oDataset.Tables(0).Rows.Count - 1
                                With C1AlertMessages
                                    .Rows.Add()
                                    .SetCellStyle(i + 1, COL_Alt_Select, C1AlertMessages.Styles("CS_ComboList"))
                                    .SetData(i + 1, COL_Alt_MessageID, oDataset.Tables(0).Rows(i)("nMessageID"))
                                    .SetData(i + 1, COL_ALT_PrescriberID, oDataset.Tables(0).Rows(i)("PrescriberID"))
                                    .SetData(i + 1, COL_Alt_MessageDate, oDataset.Tables(0).Rows(i)("dtDateReceived"))
                                    .SetData(i + 1, COL_Alt_MessageType, oDataset.Tables(0).Rows(i)("MessageName"))
                                    .SetData(i + 1, COL_Alt_MessageTo, oDataset.Tables(0).Rows(i)("ProviderName"))
                                    new_notifications.Add(oDataset.Tables(0).Rows(i)("nMessageID"))
                                End With
                            Next

                            If bNotificationClosed Then
                                pnlSurescriptAlert.Visible = ShowNotifications(new_notifications)
                                If pnlSurescriptAlert.Visible Then
                                    bNotificationClosed = False
                                End If
                            Else
                                pnlSurescriptAlert.Visible = True
                            End If


                            notifications.Clear()
                            notifications.AddRange(new_notifications.ToList())


                        Else
                            tmrshowsurepnl.Enabled = False
                            pnlSurescriptAlert.Visible = False
                        End If
                    Else
                        tmrshowsurepnl.Enabled = False
                        pnlSurescriptAlert.Visible = False
                    End If
                Else
                    tmrshowsurepnl.Enabled = False
                    pnlSurescriptAlert.Visible = False
                End If

                tmrsurescriptAlert.Enabled = True
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            If Not IsNothing(oDB) Then
                oDB.Dispose()
                oDB = Nothing
            End If
            If Not IsNothing(oDataset) Then
                oDataset.Dispose()
                oDataset = Nothing
            End If
        Finally
            If Not IsNothing(oDataset) Then
                oDataset.Dispose()
                oDataset = Nothing
            End If
            If Not IsNothing(oDB) Then
                oDB.Dispose()
                oDB = Nothing
            End If
        End Try
    End Sub


#End Region

#Region " Print FAX "

    Public Shared Function SetFAXPrinterDefaultSettings1() As Boolean
        Dim oclsSettings As clsSettings = Nothing
        Try

            If gstrFAXPrinterName = "" Then
                SetFAXPrinterDefaultSettings1 = Nothing
                Exit Function
            End If
            ''Added for check fax seetings for Black Ice issuie on windows8 as on 20121203 
            If gblnInternetFax = False Then
                oclsSettings = New clsSettings()
                Dim strOsName As String = oclsSettings.GetOSName()
                If strOsName.Trim() <> String.Empty AndAlso strOsName.ToLower().Contains("windows 8") Then
                Else
                    pBlackIceDEVMODE = AxBlackIceDEVMODE1.LoadBlackIceDEVMODE(gstrFAXPrinterName)

                    If pBlackIceDEVMODE = 0 Then
                        MsgBox("Cannot open '" & gstrFAXPrinterName & "' Printer driver", MsgBoxStyle.Exclamation + MsgBoxStyle.OkOnly)
                        SetFAXPrinterDefaultSettings1 = Nothing
                        Exit Function
                    End If

                    ' Output directory
                    bsuccess = AxBlackIceDEVMODE1.SetOutputDirectory(gstrFAXOutputDirectory, pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'SetOutputDirectory'")
                    End If

                    ' File format TIFF group 4

                    bsuccess = AxBlackIceDEVMODE1.SetFileFormat(7, pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'SetFileFormat'")
                    End If


                    ' Orientation (Portrait/Landscape

                    bsuccess = AxBlackIceDEVMODE1.SetOrientation(1, pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'SetOrientation'")
                    End If

                    'disable generation of group file
                    bsuccess = AxBlackIceDEVMODE1.DisableGroupFile(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'DisableGroupFile'")
                    End If

                    ''if group file is generated disable deletion of group file
                    bsuccess = AxBlackIceDEVMODE1.DisableDeleteGroupFile(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'DisableDeleteGroupFile'")
                    End If

                    'The document will not be forced to be printed always using the printers resolution, regardless to the DPI setting stored in the document 
                    bsuccess = AxBlackIceDEVMODE1.DisableForcePrinterDPI(pBlackIceDEVMODE)
                    If Not bsuccess Then
                        MsgBox("Error in calling Active X function: 'DisableForcePrinterDPI'")
                    End If

                    bsuccess = AxBlackIceDEVMODE1.DisableAdvancedPaperSize(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'DisableAdvancedPaperSize'")
                    End If

                    'vertical and horizontal resolution values.
                    bsuccess = AxBlackIceDEVMODE1.SetXDPI(200, pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'SetXDPI'")
                    End If
                    bsuccess = AxBlackIceDEVMODE1.SetYDPI(200, pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'SetYDPI'")
                    End If

                    ' Color depth
                    bsuccess = AxBlackIceDEVMODE1.SetColorDepth(BITS_8, pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        'MsgBox "Error in calling Active X function: 'SetColorDepth'"
                    End If

                    'If this box is checked, the driver will set the page number tag of every page in the output TIFF file.
                    bsuccess = AxBlackIceDEVMODE1.EnablePageNumbering(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'EnablePageNumbering'")
                    End If

                    '3 indicates Exact filename.
                    'i.e., we ourself generate the filename, we are not using any Blackice filename generation method .
                    bsuccess = AxBlackIceDEVMODE1.SetFileGenerationMethod(3, pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'SetFileGenerationMethod'")
                    End If

                    bsuccess = AxBlackIceDEVMODE1.DisableFaxOutput(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'EnableFaxOutput'")
                    End If

                    'If this box is checked, the driver will set the page number tag of every page in the output TIFF file.
                    bsuccess = AxBlackIceDEVMODE1.DisableWriteText(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'DisableWriteText'")
                    End If


                    'GammaLink compatible TIFF output requires this setting to be checked, because they can only send TIFF images with reverse bit order.
                    ' the driver will create a TIFF file that is compatible with the requirements listed in File Format for Internet Fax.
                    bsuccess = AxBlackIceDEVMODE1.DisableInternetTiffFormat(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'DisableInternetTiffformat'")
                    End If

                    'if you are not capturing printer messages for end of printing, for example you can disable this in the printer options and it can get you a little more speed.
                    bsuccess = AxBlackIceDEVMODE1.DisableMessagingInterface(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'DisableMessagingInterface'")
                    End If

                    'The Photo Quality option enables or disables the dithering of the Black Ice driver.
                    bsuccess = AxBlackIceDEVMODE1.SetDithering(DITHER_SHARP, pBlackIceDEVMODE)

                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'SetDithering'")
                    End If

                    bsuccess = AxBlackIceDEVMODE1.EnableMultipageImage(pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error in calling Active X function: 'EnableMultipageImage'")
                    End If

                    'to save the settings applied to the black ice printer deriver
                    ' The Smooth, Sharp, and Stucki filters produce better quality output.
                    bsuccess = AxBlackIceDEVMODE1.SaveBlackIceDEVMODE(gstrFAXPrinterName, pBlackIceDEVMODE)
                    If (bsuccess = False) Then
                        MsgBox("Error saving the devmode")
                        SetFAXPrinterDefaultSettings1 = Nothing
                        Exit Function
                    End If
                End If
            End If
            Return Nothing
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            Return False
        Finally
            If Not IsNothing(oclsSettings) Then
                oclsSettings.Dispose() : oclsSettings = Nothing
            End If
        End Try
    End Function

    Public Function InitiliseFaxSetting()
        Try
            If InvokeRequired Then
                Try
                    Invoke(New InitiliseFaxSettingDelegate(AddressOf InitiliseFaxSetting))
                Catch ex As Exception

                End Try

            Else
                'gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, "gloEMR Load Started", gloAuditTrail.ActivityOutCome.Success)
                ''UpdateLog_DI("gloEMR Load Started")
                'timerLockScreen.Enabled = False
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Initialize, " Initializing FAX Driver Start", gloAuditTrail.ActivityOutCome.Success)
                'UpdateLog(" Initializing FAX Driver Start")
                'f.lblDescription.Text = " Initializing FAX Driver ..."
                MainMenu.AxBlackIceDEVMODE1 = New AxBLACKICEDEVMODELib.AxBlackIceDEVMODE
                CType(MainMenu.AxBlackIceDEVMODE1, System.ComponentModel.ISupportInitialize).BeginInit()
                Dim resources As System.ComponentModel.ComponentResourceManager = New System.ComponentModel.ComponentResourceManager(GetType(MainMenu))
                Me.Controls.Add(AxBlackIceDEVMODE1)
                MainMenu.AxBlackIceDEVMODE1.Enabled = True
                MainMenu.AxBlackIceDEVMODE1.Visible = False
                MainMenu.AxBlackIceDEVMODE1.Location = New System.Drawing.Point(594, 24)
                MainMenu.AxBlackIceDEVMODE1.Name = "AxBlackIceDEVMODE1"
                MainMenu.AxBlackIceDEVMODE1.OcxState = CType(resources.GetObject("AxBlackIceDEVMODE1.OcxState"), System.Windows.Forms.AxHost.State)
                MainMenu.AxBlackIceDEVMODE1.Size = New System.Drawing.Size(16, 16)
                MainMenu.AxBlackIceDEVMODE1.TabIndex = 10
                CType(MainMenu.AxBlackIceDEVMODE1, System.ComponentModel.ISupportInitialize).EndInit()

                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Initialize, " Initializing FAX Driver End", gloAuditTrail.ActivityOutCome.Success)



                Call MainMenu.SetFAXPrinterDefaultSettings1()
            End If
        Catch ex As Exception
            MessageBox.Show("Error while setting Fax printer default settings. " & ex.ToString, "Fax Settings", MessageBoxButtons.OK, MessageBoxIcon.Error)
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Initialize, "Error doing fax settings", gloAuditTrail.ActivityOutCome.Failure)
            'UpdateLog("Error doing fax settings")

        End Try
        Return Nothing
    End Function

    Public Shared Function SetFAXPrinterDocumentSettings1(ByVal strFAXDocumentName As String) As Boolean
        Try
            'If gstrFAXPrinterName = "" Then
            '    MessageBox.Show("Please select the Fax printer name", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
            '    Return False
            'End If

            bsuccess = AxBlackIceDEVMODE1.SetImageFileName(strFAXDocumentName & ".tif", pBlackIceDEVMODE)

            If (bsuccess = False) Then
                MsgBox("Error in calling active X function: 'SetImageFileName'")
            End If

            'all the files will be appended in a single tiff file
            bsuccess = AxBlackIceDEVMODE1.EnableKeepExistingFiles(pBlackIceDEVMODE)
            If (bsuccess = False) Then
                MsgBox("Error in calling active X function: 'EnableKeepExistingFiles'")
            End If

            bsuccess = AxBlackIceDEVMODE1.SaveBlackIceDEVMODE(gstrFAXPrinterName, pBlackIceDEVMODE)
            If (bsuccess = False) Then
                MsgBox("Error saving the devmode")
                Return False
                Exit Function
            End If
            Return True
        Catch ex As Exception
            Return False
        Finally


        End Try
    End Function

    Public Shared Function SetFAXPrinterOutputDirectorySettings1(ByVal strfaxoutputdirectory As String)
        Try
            bsuccess = AxBlackIceDEVMODE1.SetOutputDirectory(strfaxoutputdirectory, pBlackIceDEVMODE)
            If (bsuccess = False) Then
                MsgBox("Error in calling active X function: 'SetOutputDirectory'")
            End If
            bsuccess = AxBlackIceDEVMODE1.SaveBlackIceDEVMODE(gstrFAXPrinterName, pBlackIceDEVMODE)
            If (bsuccess = False) Then
                MsgBox("Error saving the devmode")
                SetFAXPrinterOutputDirectorySettings1 = Nothing
                Exit Function
            End If
            SetFAXPrinterOutputDirectorySettings1 = Nothing
        Catch ex As Exception
            SetFAXPrinterOutputDirectorySettings1 = Nothing
        End Try
    End Function

#End Region

#Region " HOT KEY "
    Public Sub RegisterMyHotKey()
        '' If HOT Keys are not Register then Register HOT Keys
        Try

            If IsActivated = False Then
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "RegisterHotKey started", gloAuditTrail.ActivityOutCome.Success)
                'UpdateVoiceLog("RegisterHotKey started ")

                ''GLO2012-0016207 : User is unable to log back into the gloSuite from the 'Screen Saver' the after the password is entered the login screen returnes.
                Try
                    RemoveHandler Me.HotKeyPressed, AddressOf hotKey_Pressed
                Catch ex As Exception
                    ''As Error which cannot be handled, so try catch.
                End Try

                AddHandler Me.HotKeyPressed, AddressOf hotKey_Pressed

                'This is a modified logic to add Hotkey for exam form - changed on 09/18/2006  by Pravin

                ' Microphone Turn on / Turn off
                Dim htk As HotKey
                htk = New HotKey("My HotKey", Keys.F2, HotKey.HotKeyModifiers.MOD_NONE)
                Me.HotKeys.Add(htk)
                ' Navigation
                htk = New HotKey("Navigate", Keys.F5, HotKey.HotKeyModifiers.MOD_NONE)
                Me.HotKeys.Add(htk)
                'HPI
                htk = New HotKey("HPI", Keys.F6, HotKey.HotKeyModifiers.MOD_NONE)
                Me.HotKeys.Add(htk)
                'X-ray
                htk = New HotKey("Xray", Keys.F7, HotKey.HotKeyModifiers.MOD_NONE)
                Me.HotKeys.Add(htk)
                'MRI
                htk = New HotKey("MRI", Keys.F8, HotKey.HotKeyModifiers.MOD_NONE)
                Me.HotKeys.Add(htk)
                'PLAN
                htk = New HotKey("PLAN", Keys.F9, HotKey.HotKeyModifiers.MOD_NONE)
                Me.HotKeys.Add(htk)
                htk = New HotKey("LS", Keys.F4, HotKey.HotKeyModifiers.MOD_NONE)
                Me.HotKeys.Add(htk)

                htk = New HotKey("TimeStamp", Keys.D, HotKey.HotKeyModifiers.MOD_ALT_SHIFT)  ''Add the hotkey for the user defined timestamp ie (alt+shift+d)
                Me.HotKeys.Add(htk)                                                                        ''only for the frmMessages

                ''hotkey added for help
                htk = New HotKey("gloHelp", Keys.F1, HotKey.HotKeyModifiers.MOD_NONE)
                Me.HotKeys.Add(htk)

                'Bug #45745: CR00000254 : Word Modules
                'Keys only for the Exam
                htk = New HotKey("FinishExam", Keys.F5, HotKey.HotKeyModifiers.MOD_CONTROL)
                Me.HotKeys.Add(htk)
                htk = New HotKey("InsertSignature", Keys.F6, HotKey.HotKeyModifiers.MOD_CONTROL)
                Me.HotKeys.Add(htk)
                '---
                htk = Nothing

                IsActivated = True
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "RegisterHotKey finished", gloAuditTrail.ActivityOutCome.Success)

            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, ex.ToString(), gloAuditTrail.ActivityOutCome.Success)
            Try
                RemoveHandler Me.HotKeyPressed, AddressOf hotKey_Pressed
            Catch 'ex As Exception
                ''As Error which cannot be handled, so try catch.
            End Try
            Try
                HotKeys.Clear()

            Catch ''ex As Exception

            End Try
            IsActivated = False
        Finally
           
            'IsActivated = True
        End Try
    End Sub
    Private Shared NatSpeakProcessId As UInteger = 0
    Public Sub UnRegisterMyHotKey(Optional ByVal CheckNatSpeak As Boolean = False)
        '' If HOT Keys are Register then UnRegister HOT Keys
        If CheckNatSpeak Then
            Dim ProcessID As UInteger = 0
            Dim ActiveWindowIntPtr As IntPtr = gloWord.WordDialogBoxBackgroundCloser.GetMyActivatedHandle()

            GetWindowThreadProcessId(ActiveWindowIntPtr, ProcessID)
            If (ProcessID = NatSpeakProcessId) Then
                Exit Sub
            End If
            Dim Process As Process = Process.GetProcessById(ProcessID)
            If (Process.ProcessName.ToLower().Contains("natspeak")) Then
                NatSpeakProcessId = ProcessID
                Process = Nothing
                Exit Sub
            End If

            'Dim length As Integer = GetWindowTextLength(ActiveWindowIntPtr) + 1
            'If (length > 1) Then

            '    Dim stringBuilder As New System.Text.StringBuilder(length + 1)
            '    GetWindowText(ActiveWindowIntPtr, stringBuilder, length)

            '    If Process.ProcessName.ToLower().Contains("natspeak") AndAlso stringBuilder.ToString().ToLower.Contains("spell") Then
            '        Process = Nothing
            '        Exit Sub
            '    End If

            '    If stringBuilder IsNot Nothing Then
            '        stringBuilder.Clear()
            '        stringBuilder = Nothing
            '    End If
            'End If
            Process = Nothing
        End If

        If IsActivated = True Then
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "UnRegisterHotKey started", gloAuditTrail.ActivityOutCome.Success)
            RemoveHandler Me.HotKeyPressed, AddressOf hotKey_Pressed
            HotKeys.Clear()
            IsActivated = False
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "UnRegisterHotKey finished ", gloAuditTrail.ActivityOutCome.Success)
        End If
    End Sub

    Private Sub hotKey_Pressed(ByVal sender As System.Object, ByVal e As HotKeyPressedEventArgs)
        If (gloWord.WordDialogBoxBackgroundCloser.IsMyApplicationOnTop()) Then


            Dim blnLockScreen As Boolean
            UpdateLog("Me.WindowState " & Me.WindowState.ToString)
            If Me.WindowState <> FormWindowState.Minimized AndAlso Me.Name <> "frmLockScreen" Then
                Dim blnExamChild As Boolean = False

                If Not IsNothing(myRefCaller) Then
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Started hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                    UpdateLog("If Not IsNothing(myRefCaller) Then")
                    Dim I As IHotKey = Nothing
                    Try
                        I = CType(myRefCaller, IHotKey)
                    Catch ex As Exception
                    End Try
                    blnExamChild = True
                    Try
                        If IsNothing(I) = False Then
                            UpdateLog("If IsNothing(I) = False Then")
                            Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                                Case "F5" ' Navigation
                                    I.Navigate("[]")
                                Case "F6"
                                    I.Navigate("[HPI]")
                                Case "F7"
                                    I.Navigate("[Xray]")
                                Case "F8"
                                    I.Navigate("[MRI]")
                                Case "F9"
                                    I.Navigate("[PLAN]")
                                Case "F2"
                                    If Not IsNothing(myRefCaller) Then
                                        If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                                            DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                                            ''To set mic image off
                                            I.Navigate("OFF")
                                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Mic Switched Off at hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                                        ElseIf DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff Then
                                            DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn
                                            ''To set mice image on
                                            I.Navigate("ON")
                                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Mic Switched Off at hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                                        End If

                                    End If
                                Case "F4"
                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "LockScreen invoked at hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                                    '04-Nov-14 Aniket: Bug #75630: gloEMR: Lock screen: Lock screen gets locked again after unlock
                                    blnLockScreen = True
                                    Call LockScreen()
                                Case "D"
                                    I.Navigate("[TimeStamp]")       ''when 'd' is  pressed after pressing alt+shift+d only for the frmMessages

                                Case "F1"
                                    ShowHelp()

                            End Select
                        End If  ' If IsNothing(I) = False Then
                    Catch ex As Exception
                    End Try
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Completed hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                End If ' If Not IsNothing(myRefCaller) Then
                ''Added condition for Dialogue forms
                If Not IsNothing(Me.OwnedForms) Then
                    For Each _frm As Form In Me.OwnedForms
                        If _frm.Name = "frmClinicalChart" Or _frm.Name = "frmCCDAGenerateList" Or _frm.Name = "frmEDocumentViewer" Then
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Started hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                            UpdateLog("If Not IsNothing(OwnedForms) Then")
                            Dim I As IHotKey = Nothing
                            Dim IDoc As gloEDocumentV3.IHotKey = Nothing
                            blnExamChild = True
                            Try
                                If _frm.Name = "frmEDocumentViewer" Then
                                    IDoc = CType(_frm, gloEDocumentV3.IHotKey)
                                    Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                                        Case "F5" ' Navigation
                                            IDoc.Navigate("[]")
                                        Case "F6"
                                            IDoc.Navigate("[HPI]")
                                        Case "F7"
                                            IDoc.Navigate("[Xray]")
                                        Case "F8"
                                            IDoc.Navigate("[MRI]")
                                        Case "F9"
                                            IDoc.Navigate("[PLAN]")
                                    End Select

                                Else
                                    I = CType(_frm, IHotKey)
                                End If
                            Catch ex As Exception
                            End Try



                            Try
                                If IsNothing(I) = False Then
                                    UpdateLog("If IsNothing(I) = False Then")
                                    Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                                        Case "F5" ' Navigation
                                            I.Navigate("[]")
                                        Case "F6"
                                            I.Navigate("[HPI]")
                                        Case "F7"
                                            I.Navigate("[Xray]")
                                        Case "F8"
                                            I.Navigate("[MRI]")
                                        Case "F9"
                                            I.Navigate("[PLAN]")
                                        Case "F2"
                                            If Not IsNothing(myRefCaller) Then
                                                If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                                                    DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                                                    ''To set mic image off
                                                    I.Navigate("OFF")
                                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Mic Switched Off at hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                                                ElseIf DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff Then
                                                    DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn
                                                    ''To set mice image on
                                                    I.Navigate("ON")
                                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Mic Switched Off at hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                                                End If

                                            End If
                                        Case "F4"
                                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "LockScreen invoked at hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)
                                            '04-Nov-14 Aniket: Bug #75630: gloEMR: Lock screen: Lock screen gets locked again after unlock
                                            blnLockScreen = True
                                            Call LockScreen()
                                        Case "D"
                                            I.Navigate("[TimeStamp]")       ''when 'd' is  pressed after pressing alt+shift+d only for the frmMessages

                                        Case "F1"
                                            ShowHelp()

                                    End Select
                                End If  ' If IsNothing(I) = False Then
                            Catch ex As Exception
                            End Try
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Completed hotkey press for ExamChild", gloAuditTrail.ActivityOutCome.Success)

                        End If
                    Next
                End If


                ''
                If Not blnExamChild Then
                    UpdateLog("If Not blnExamChild Then")

                    If Not IsNothing(Me.ActiveMdiChild) Then
                        Me.RestoreAndActivate()
                        UpdateLog("If Not IsNothing(Me.ActiveMdiChild) Then")
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Started hotkey press for ActiveMdiChild", gloAuditTrail.ActivityOutCome.Success)

                        Dim I As IHotKey = Nothing
                        Dim ILab As gloEmdeonInterface.Classes.IHotKey = Nothing

                        Try
                            If Me.ActiveMdiChild.Name = "frmViewgloLab" Then
                                ILab = CType(Me.ActiveMdiChild, gloEmdeonInterface.Classes.IHotKey)
                                Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                                    Case "F5" ' Navigation
                                        ILab.Navigate("[]")
                                    Case "F6"
                                        ILab.Navigate("[HPI]")
                                    Case "F7"
                                        ILab.Navigate("[Xray]")
                                    Case "F8"
                                        ILab.Navigate("[MRI]")
                                    Case "F9"
                                        ILab.Navigate("[PLAN]")
                                End Select
                                'If CType(e.HotKey, HotKey).KeyCode.ToString = "F5" Then
                                '    ILab.Navigate("[]")
                                'End If
                            Else
                                I = CType(Me.ActiveMdiChild, IHotKey)
                            End If
                        Catch ex As Exception
                        End Try
                        ' ensure form is shown:

                        Try
                            If IsNothing(I) = False Then
                                UpdateLog("If IsNothing(I) = False Then")
                                Select Case CType(e.HotKey, HotKey).Modifiers.ToString
                                    ' Bug #45716: CR00000254 : Word Modules	 
                                    ' Case added for the Control (CTRL) Key.
                                    Case "MOD_CONTROL"
                                        If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                                            Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                                                Case "F5" 'Finish Exam
                                                    I.Navigate("[FinishExam]")
                                                Case "F6" 'Insert Signature
                                                    I.Navigate("[InsertSignature]")
                                            End Select
                                        End If
                                    Case Else
                                        Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                                            Case "F5" ' Navigation
                                                HotKeyNavigator(I, "[]")
                                            Case "F6"
                                               HotKeyNavigator(I, "[HPI]")
                                            Case "F7"
                                                  HotKeyNavigator(I, "[Xray]")
                                            Case "F8"
                                                 HotKeyNavigator(I, "[MRI]")
                                            Case "F9"
                                                HotKeyNavigator(I, "[PLAN]")
                                            Case "F2"

                                                If Me.ActiveMdiChild.Name = "frmTemplateGallery" Or Me.ActiveMdiChild.Name = "frmPatientExam" Or Me.ActiveMdiChild.Name = "frmMessages" Or Me.ActiveMdiChild.Name = "frmPatientLetter" Or Me.ActiveMdiChild.Name = "frm_LM_Orders" Or Me.ActiveMdiChild.Name = "frmPTProtocols" Or Me.ActiveMdiChild.Name = "frmNurseNotes" Or Me.ActiveMdiChild.Name = "frmPatientConsent" Or Me.ActiveMdiChild.Name = "frmPatientEducation" Or Me.ActiveMdiChild.Name = "frmDisclosureMgmt" Or Me.ActiveMdiChild.Name = "frmTriage" Or Me.ActiveMdiChild.Name = "frmCPTTemplate" Or Me.ActiveMdiChild.Name = "frmDM_Template" Or Me.ActiveMdiChild.Name = "frmMSTTemplateGallery" Then

                                                    Dim frm As frmPatientExam = Nothing
                                                    Dim bnlIsFromExam As Boolean

                                                    If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                                                        frm = Me.ActiveMdiChild
                                                        If gblnVoiceEnabled = True AndAlso gblnSpeakerExists = True Then
                                                            bnlIsFromExam = True
                                                        End If
                                                    End If

                                                    If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then

                                                        If bnlIsFromExam = True Then
                                                            If IsNothing(frm) = False Then
                                                                'frm.pnlProcess.Visible = True

                                                                If gblnShowDragonWaitProcess = True Then
                                                                    frm.ShowDragonWaitProcess(True)
                                                                    Application.DoEvents()
                                                                End If
                                                            End If
                                                        End If

                                                        DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                                                        I.Navigate("OFF")
                                                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Mic Switched Off at hotkey press - " & Me.ActiveMdiChild.Name, gloAuditTrail.ActivityOutCome.Success)

                                                        If bnlIsFromExam = True Then
                                                            If IsNothing(frm) = False Then
                                                                'frm.pnlProcess.Visible = False

                                                                If gblnShowDragonWaitProcess = True Then
                                                                    frm.ShowDragonWaitProcess(False)
                                                                    Application.DoEvents()
                                                                End If
                                                            End If
                                                        End If

                                                    ElseIf DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff Then
                                                        DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn
                                                        I.Navigate("ON")
                                                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Mic Switched On at hotkey press - " & Me.ActiveMdiChild.Name, gloAuditTrail.ActivityOutCome.Success)
                                                    End If

                                                End If

                                            Case "F4"

                                                '04-Nov-14 Aniket: Bug #75630: gloEMR: Lock screen: Lock screen gets locked again after unlock
                                                If blnLockScreen = False Then
                                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "LockScreen invoked at hotkey press - " & Me.ActiveMdiChild.Name, gloAuditTrail.ActivityOutCome.Success)
                                                    Call LockScreen()
                                                End If

                                            Case "D"
                                                I.Navigate("[TimeStamp]")       ''when 'd' is  pressed after pressing alt+shift+d only for the frmMessages
                                            Case "F1"
                                                ShowHelp()
                                        End Select
                                End Select


                            Else  ''   If IsNothing(I) = False Then
                                UpdateLog("Else of If IsNothing(I) = False Then " & CType(e.HotKey, HotKey).KeyCode.ToString)
                                '' Bug# 5406 - case# 0003668 
                                '' F4 key inconsistant behaviour
                                '' else case was commneted
                                Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                                    Case "F4"
                                        '04-Nov-14 Aniket: Bug #75630: gloEMR: Lock screen: Lock screen gets locked again after unlock
                                        If blnLockScreen = False Then
                                            'UpdateVoiceLog("LockScreen invoked at hotkey press - " & Me.ActiveMdiChild.Name)
                                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "LockScreen invoked at hotkey press - " & Me.ActiveMdiChild.Name, gloAuditTrail.ActivityOutCome.Success)
                                            Call LockScreen()
                                        End If
                                    Case "F1"
                                        ShowHelp()
                                End Select
                            End If  ''  If IsNothing(I) = False Then
                        Catch ex As Exception

                        End Try
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Completed hotkey press for ActiveMdiChild", gloAuditTrail.ActivityOutCome.Success)

                    Else  ''  If Not IsNothing(Me.ActiveMdiChild) Then
                        UpdateLog("Else of If Not IsNothing(Me.ActiveMdiChild) Then " & CType(e.HotKey, HotKey).KeyCode.ToString)
                        Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                            Case "F4"
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen By HOT KEY Press", gloAuditTrail.ActivityOutCome.Success)
                                'UpdateLog("Lock Screen By HOT KEY Press")
                                Call LockScreen()
                            Case "F1"
                                ShowHelp()
                        End Select
                    End If  '' If Not IsNothing(Me.ActiveMdiChild) Then
                Else ''  If Not blnExamChild Then
                    UpdateLog("Else of If Not blnExamChild Then " & CType(e.HotKey, HotKey).KeyCode.ToString)
                    Select Case CType(e.HotKey, HotKey).KeyCode.ToString
                        Case "F4"
                            If blnLockScreen = False Then
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen By HOT KEY Press", gloAuditTrail.ActivityOutCome.Success)
                                Call LockScreen()
                            End If

                            ''
                        Case "F1"
                            ShowHelp()
                    End Select
                End If ''  If Not blnExamChild Then
            End If
        Else
            UnRegisterMyHotKey()
        End If

    End Sub

    Private Sub HotKeyNavigator(ByVal I As IHotKey, ByVal _key As String)
        If Not IsNothing(Me.ActiveMdiChild) Then
            If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                strHotKey = _key
                If blnMicrophoneOn = False Then
                    I.Navigate(_key)
                Else
                    If IsDectaionInProgress Then
                        IsHoKeyPressed = True

                        If gblnShowDragonWaitProcess = True Then
                            CType(Me.ActiveMdiChild, frmPatientExam).pnlUtteranceProgress.Visible = True
                        End If

                        If IsNothing(TimerpnlUtteranceProgress) = False Then
                            TimerpnlUtteranceProgress.Start()
                        End If
                    Else
                        I.Navigate(_key)
                    End If
                End If
            Else
                I.Navigate(_key)
            End If
        End If
    End Sub

    Private Sub ShowHelp()
        Me.HelpComponent1.ShowHelp(Me)
    End Sub
    ''new function added for showing cqm measure help
    Public Sub ShowHelpobj(ByVal formobj As Object)

        gloEMR.Help.EndUserHelp.StaticProcessControlHelp(formobj)

    End Sub


    Private Sub EnableProtection()
        For Each frmTemp As Form In Me.MdiChildren
            If Not frmTemp Is Nothing Then
                Select Case frmTemp.Name

                    Case "frmPatientExam"
                        If CType(frmTemp, frmPatientExam).blnExamFinished = True Then
                            CType(frmTemp, frmPatientExam).tmrDocProtect.Enabled = True
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is protected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is protected")
                        End If
                    Case "frmMessages"
                        If CType(frmTemp, frmMessages).m_IsReadOnly = True Then
                            CType(frmTemp, frmMessages).tmrDocProtect.Enabled = True
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is protected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is protected")
                        End If
                    Case "frmPatientLetter"
                        If CType(frmTemp, frmPatientLetter).m_IsFinished = True Then
                            CType(frmTemp, frmPatientLetter).tmrDocProtect.Enabled = True
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is protected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is protected")

                        End If

                        'Bug #85105: 00000876: Document in procted mode while faxing
                    Case "frmPatientConsent"
                        If CType(frmTemp, frmPatientConsent).m_IsFinished = True Then
                            CType(frmTemp, frmPatientConsent).tmrDocProtect.Enabled = True
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is protected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is protected")

                        End If
                    Case "frmNurseNotes"
                        If CType(frmTemp, frmNurseNotes).m_IsFinished = True Then
                            'If Not CType(frmTemp, frmNurseNotes).Focused Then
                            '    Exit Sub
                            'End If
                            CType(frmTemp, frmNurseNotes).tmrDocProtect.Enabled = True
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is protected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is protected")

                        End If
                    Case "frmPTProtocols"
                        If CType(frmTemp, frmPTProtocols)._IsFinished = True Then
                            CType(frmTemp, frmPTProtocols).tmrDocProtect.Enabled = True
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is protected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is protected")

                        End If
                    Case "frm_LM_Orders"
                        If CType(frmTemp, frm_LM_Orders).blnIsFinish = True Then
                            CType(frmTemp, frm_LM_Orders).tmrDocProtect.Enabled = True
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is protected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is protected")

                        End If
                    Case "frmDisclosureMgmt"
                        If CType(frmTemp, frmDisclosureMgmt).m_IsFinished = True Then
                            CType(frmTemp, frmDisclosureMgmt).tmrDocProtect.Enabled = True
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is protected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is protected")

                        End If
                End Select

            End If

        Next
    End Sub

    Private Sub DisableProtection()
        For Each frmTemp As Form In Me.MdiChildren
            If Not frmTemp Is Nothing Then
                Select Case frmTemp.Name

                    Case "frmPatientExam"
                        If CType(frmTemp, frmPatientExam).blnExamFinished = True Then
                            CType(frmTemp, frmPatientExam).tmrDocProtect.Enabled = False
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is unprotected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is unprotected")
                        End If

                    Case "frmMessages"
                        If CType(frmTemp, frmMessages).m_IsReadOnly = True Then
                            CType(frmTemp, frmMessages).tmrDocProtect.Enabled = False
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is unprotected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is unprotected")
                        End If
                    Case "frmPatientLetter"
                        If CType(frmTemp, frmPatientLetter).m_IsFinished = True Then
                            CType(frmTemp, frmPatientLetter).tmrDocProtect.Enabled = False
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is unprotected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is unprotected")

                        End If

                        'Bug #85105: 00000876: Document in procted mode while faxing
                    Case "frmPatientConsent"
                        If CType(frmTemp, frmPatientConsent).m_IsFinished = True Then
                            CType(frmTemp, frmPatientConsent).tmrDocProtect.Enabled = False
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is unprotected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is unprotected")

                        End If
                    Case "frmDisclosureMgmt"
                        If CType(frmTemp, frmDisclosureMgmt).m_IsFinished = True Then
                            CType(frmTemp, frmDisclosureMgmt).tmrDocProtect.Enabled = False
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is unprotected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is unprotected")

                        End If
                    Case "frmNurseNotes"
                        If CType(frmTemp, frmNurseNotes).m_IsFinished = True Then
                            CType(frmTemp, frmNurseNotes).tmrDocProtect.Enabled = False
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is unprotected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is unprotected")

                        End If
                    Case "frmPTProtocols"
                        If CType(frmTemp, frmPTProtocols)._IsFinished = True Then
                            CType(frmTemp, frmPTProtocols).tmrDocProtect.Enabled = False
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is unprotected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is unprotected")

                        End If
                    Case "frm_LM_Orders"
                        If CType(frmTemp, frm_LM_Orders).blnIsFinish = True Then
                            CType(frmTemp, frm_LM_Orders).tmrDocProtect.Enabled = False
                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "Document in " & frmTemp.Name & " is unprotected", gloAuditTrail.ActivityOutCome.Success)
                            'UpdateVoiceLog("Document in " & frmTemp.Name & " is unprotected")
                        End If
                End Select
            End If

        Next
    End Sub

    Protected Overrides Sub WndProc(ByRef m As Message)
        MyBase.WndProc(m)
        Try

            'Code added by chetan to hide mdichild scrollbar
            If mdiClient IsNot Nothing Then
                'Hide the ScrollBars
                ShowScrollBar(mdiClient.Handle, SB_BOTH, 0)
            End If

            'Code added by chetan to hide mdichild scrollbar 30 june
            If MdiChildren IsNot Nothing Then

                If MdiChildren.Length = 0 AndAlso _isShowDialogueForm = False Then
                    If m.Msg = 24 Then
                        _isShowDialogueForm = True
                        RegisterMyHotKey()
                        UpdateLog("WndProc: Register and m.msg=24 Then")
                    Else
                        If (gloWord.WordDialogBoxBackgroundCloser.IsMyApplicationOnTop() = False) Then
                            UnRegisterMyHotKey()
                            UpdateLog("WndProc: UnRegister and m.msg<>24 Then")
                        End If
                    End If
                End If
            End If

            If (m.Msg = UnmanagedMethods.WM_ACTIVATEAPP) Then
               
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, " HOT Key WM_ACTIVATEAPP " & m.Msg & " - " & m.WParam.ToInt32 & " - " & m.ToString & " - timerLockScreen.Enabled =" & timerLockScreen.Enabled, gloAuditTrail.ActivityOutCome.Success)
                UpdateVoiceLog(" HOT Key WM_ACTIVATEAPP " & m.Msg & " - " & m.WParam.ToInt32 & " - " & m.ToString & " - timerLockScreen.Enabled =" & timerLockScreen.Enabled)
                If m.WParam.ToInt32() = 1 AndAlso timerLockScreen.Enabled = False Then
                    UpdateLog("WndProc: If m.WParam.ToInt32() = 1 And timerLockScreen.Enabled = False Then")
                    UnRegisterMyHotKey()
                ElseIf m.WParam.ToInt32() = 1 Then
                    UpdateVoiceLog(" HOT Key WM_ACTIVATEAPP " & m.Msg & " - " & m.WParam.ToInt32 & " - " & m.ToString & " RegisterMyHotKey ")
                    UpdateLog("WndProc: ElseIf m.WParam.ToInt32() = 1 Then")
                    RegisterMyHotKey()
                    EnableProtection()
                ElseIf m.WParam.ToInt32() = 0 AndAlso _isFromLockScreen = False Then
                    UpdateVoiceLog(" HOT Key WM_ACTIVATEAPP " & m.Msg & " - " & m.WParam.ToInt32 & " - " & m.ToString & " UnRegisterMyHotKey ")
                    UpdateLog("WndProc: ElseIf m.WParam.ToInt32() = 0 Then  , timerLockScreen.Enabled =" & timerLockScreen.Enabled)
                    UnRegisterMyHotKey(True)
                    DisableProtection()
                ElseIf m.WParam.ToInt32() = 0 AndAlso _isFromLockScreen = True Then
                    _isFromLockScreen = False
                    UpdateLog("WndProc:  _isFromLockScreen = False Then")
                End If


            ElseIf (m.Msg = UnmanagedMethods.WM_HOTKEY) Then
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, " HOT Key WM_HOTKEY " & m.Msg & " -- " & m.ToString, gloAuditTrail.ActivityOutCome.Success)
                UpdateVoiceLog(" HOT Key WM_HOTKEY " & m.Msg & " -- " & m.ToString)
                Dim hotKeyId As Integer = m.WParam.ToInt32()
                Select Case hotKeyId
                    Case UnmanagedMethods.IDHOT_SNAPDESKTOP
                        Dim e As System.EventArgs = New System.EventArgs
                        RaiseEvent PrintDesktopPressed(Me, e)

                    Case UnmanagedMethods.IDHOT_SNAPWINDOW
                        Dim e As System.EventArgs = New System.EventArgs
                        RaiseEvent PrintWindowPressed(Me, e)

                    Case Else
                        UpdateLog("WndProc: ElseIf (m.Msg = UnmanagedMethods.WM_HOTKEY) Then, Case Else")
                        Dim htk As HotKey
                        For Each htk In m_hotKeys
                            If (htk.AtomId.Equals(m.WParam)) Then
                                Dim e As HotKeyPressedEventArgs = New HotKeyPressedEventArgs(htk)
                                RaiseEvent HotKeyPressed(Me, e)
                                Exit For
                            End If
                        Next
                End Select
           
            End If
           
            If gloGlobal.clsFocusToLockScreen.blnSetfocustoUserName = True Then  ''added for setting focus to lockscreen username control if lock screen is open incident  CAS-05612-H7T4V3
                If Not IsNothing(txtlockscrusername) Then

                    txtlockscrusername.Focus()
                    txtlockscrusername.Select(txtlockscrusername.Text.Length, 0)
                End If
            End If
        Catch ex As Exception
            ' MessageBox.Show(ex.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            'Debug.WriteLine("Error:" + ex.Message)

        End Try
    End Sub
    


    Protected Overrides Sub OnClosed(ByVal e As System.EventArgs)
        Try
            HotKeys.Clear()
            MyBase.OnClosed(e)
        Catch ex As Exception
        End Try
    End Sub

    Public Sub RestoreAndActivate()
        If Not (UnmanagedMethods.IsWindowVisible(Me.Handle)) Then
            UnmanagedMethods.ShowWindow(Me.Handle, UnmanagedMethods.SW_SHOW)
        End If
        If (UnmanagedMethods.IsIconic(Me.Handle)) Then
            UnmanagedMethods.SendMessage(Me.Handle, UnmanagedMethods.WM_SYSCOMMAND, _
                UnmanagedMethods.SC_RESTORE, IntPtr.Zero)
        End If
        UnmanagedMethods.SetForegroundWindow(Me.Handle)
    End Sub

#End Region

#Region " Lock Screen "

    Private Sub timerLockScreen_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles timerLockScreen.Tick
        Try
            If gLockTime > 0 AndAlso gblnAutoLockEnable = True Then
                '' 20080526  If Timer of Lock Screen is Disabled then don't Show Lock Screen
                If (timerLockScreen.Enabled = False) Then
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Dispose, "Lock Screen Timmer is Disabled & still its Tick event Fired", gloAuditTrail.ActivityOutCome.Success)
                    ''UpdateLog("Lock Screen Timmer is Disabled & still its Tick event Fired")
                    Exit Sub
                End If

                Dim res As Boolean
                Dim info As LastInputInfo
                Dim currentTime As Int32
                Dim lastInputTime As Int32
                Dim requiredToReachMaxvalue As Int32
                Dim diffTime As Int32
                info.cbSize = Len(info)
                res = GetLastInputInfo(info)

                lastInputTime = info.dwTime And Int32.MaxValue
                currentTime = timeGetTime() And Int32.MaxValue
                '//Current Time might be between timegettime and timegettime+precisiontime Since TimegetTime did not increment for every milliseconds

                '//if incase time+precision time reaches maxvalue, we need to wrap the number back to zero otherwise it will go to negative.


                requiredToReachMaxvalue = Int32.MaxValue - currentTime
                If (precisionTime < requiredToReachMaxvalue) Then
                    currentTime = currentTime + precisionTime
                Else
                    currentTime = precisionTime - requiredToReachMaxvalue
                End If


                diffTime = currentTime - lastInputTime
                If (diffTime < 0) Then
                    diffTime = diffTime + Int32.MaxValue
                End If
                ''end code Added on 20100513
                'If System.Math.Abs(timeGetTime - info.dwTime) >= gLockTime * 60000 AndAlso blnIsDictationOn = False Then
                If diffTime >= gLockTime * 60000 AndAlso blnIsDictationOn = False Then

                    Dim oTimespanLastInputFromVoice As TimeSpan = DateTime.Now.Subtract(globalLastInputInfo)
                    ''Compare the time interval current time with the last voice dicated input
                    If oTimespanLastInputFromVoice.Minutes * 60000 >= gLockTime * 60000 Then
                        ' If Environment.TickCount - info.dwTime >= gLockTime * 60000 AndAlso blnIsDictationOn = False Then
                        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen As No Activity Found for @" & gLockTime & "Minutes", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen As No Activity Found for @" & gLockTime & "Minutes", gloAuditTrail.ActivityOutCome.Success)
                        'UpdateLog("Lock Screen As No Activity Found for @" & gLockTime & "Minutes")
                        'gloAuditTrail.gloAuditTrail.CreateLog(gloAuditTrail.enmActivityType.SecurityAdmin, "Lock Screen As No Activity Found for @" & gLockTime & "Minutes", gstrLoginName, gstrClientMachineName, gnPatientID, True, gloAuditTrail.enmOutCome.Success)

                        timerLockScreen.Stop()
                        LockScreen()
                        timerLockScreen.Start()
                        ''
                        ' Call picToDoList_Click(sender, e)
                        ''
                    End If

                End If
            End If
        Catch objErr As Exception
            timerLockScreen.Stop()
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            timerLockScreen.Start()

        Finally
            'GC.Collect()   ''change made against problem 00000591
            'GC.WaitForPendingFinalizers()
        End Try
    End Sub

    Private Sub picLockScreen_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles picLockScreen.Click
        Try
            LockScreen()
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog("LockScreen_Click Event \n " & ex.ToString, False)
        End Try
    End Sub

    Private Sub LockScreen()
        gloGlobal.gloTSPrint._OldSharedPrinterName = "" ''changes made for incident 67769
        If Not IsNothing(gloUserControlLibrary.gloUC_PatientStrip.hshPatData) Then
            gloUserControlLibrary.gloUC_PatientStrip.hshPatData.Clear()
        End If
        '16-Nov-15 Aniket: 8070 Refresh Tasks/Messages when different user logs in after lock screen
        Dim blnIsLoginChanged As Boolean
        Dim objLogin As New clsLogin

        '18-Aug-2015 Aniket: Resolving Bug #84080: EMR: Send Portal- Send portal window goes back as user unlock EMR screen
        Dim intPRTIntuitSecureMessage As System.IntPtr = gloIntuitSecureMessage.frmSendSecureMsg.IntMyHandle()
        Dim intPQRSCode As System.IntPtr = IntPtr.Zero  ''added for checking if PQRScode window is opened
        Dim anyDialogOpened As System.IntPtr = IntPtr.Zero  ''added for checking if any dialog window is opened  of emr appln
        SingleSignON = False
        If (isDisplayed = True) Then
            Exit Sub
        End If



        isDisplayed = True
        UnRegisterMyHotKey()
        _isShowDialogueForm = True
        Dim activeForm As String = String.Empty
        Dim oInbox As gloSurescriptSecureMessage_InBox.Inbox
        Dim oNewMail As InBox.NewMail
        Dim oViewMessage As gloSurescriptSecureMessage.ViewMessage
        Dim frmPQRSinst As gloUIControlLibrary.WPFForms.PQRS.frmPQRS = Nothing
       
        Try
           
            If gblnIsSecureMsgEnable Then
                oInbox = gloSurescriptSecureMessage_InBox.Inbox.CheckFormOpen()
                If Not IsNothing(oInbox) Then
                    'MessageBox.Show("Secure message inbox is open. Pleae close inbox before logoff.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    'oInbox.Show()
                    'oInbox.Activate()
                    oInbox.WindowState = Windows.WindowState.Minimized
                    oInbox.Visibility = Windows.Visibility.Hidden
                    oNewMail = InBox.NewMail.CheckFormOpen()

                    For Each Item As DictionaryEntry In gloSurescriptSecureMessage.SecureMessageProperties.OpenedFormsCollection
                        oViewMessage = DirectCast(Item.Value, ViewMessage)
                        If Not IsNothing(oViewMessage) Then
                            oViewMessage.Visibility = Windows.Visibility.Hidden
                            oViewMessage.WindowState = Windows.WindowState.Minimized
                        End If
                    Next

                    If Not IsNothing(oNewMail) Then
                        oNewMail.Visibility = Windows.Visibility.Hidden
                        oNewMail.WindowState = Windows.WindowState.Minimized
                    End If

                End If
            End If
            ''  gloUIControlLibrary.WPFForms.PQRS.frmPQRS.HideDock(Windows.Visibility.Hidden)
           

            'Dim appSettings As System.Collections.Specialized.NameValueCollection = System.Configuration.ConfigurationSettings.AppSettings

            'Resetting date time variables 
            'Used these variables in LoadLeftPanel method it decides to fill Message, Task, Appointment, unfinished exam, triage records
            DirectMessaging_OldUpdateDateTime = Now.Date
            Mesages_OldUpdateDateTime = Now.Date
            Tasks_OldUpdateDateTime = Now.Date
            UnfinishedExams_OldUpdateDateTime = Now.Date
            Triage_Exams_OldUpdateDateTime = Now.Date
            Appointment_OldUpdateDateTime = Now.Date


            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Started to Preparing for Lock Screen", gloAuditTrail.ActivityOutCome.Success)
            'UpdateVoiceLog("Started to Preparing for Lock Screen")
            '' Check Currnt Instance of Lock Screen 
            '' If Prsent Then Open That Instance 
            ''Else Create New & Then Open That Instance
            Dim frm As frmLockScreen
            frm = frmLockScreen.GetInstance
            txtlockscrusername = frm.txtUserName
            If IsNothing(frm) = True Then
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen Instance is Not Created", gloAuditTrail.ActivityOutCome.Success)
                'UpdateVoiceLog("Lock Screen Instance is Not Created")
                Exit Sub
            End If
            If IsNothing(Form.ActiveForm) = False Then
                If Form.ActiveForm.Name() = "frmLockScreen" Then
                    Exit Sub
                End If
            End If

            ''
            blnMicrophoneOn = False


            If blnMicrophoneOn = True Then Exit Sub
            ''
            tmrCopayAlert.Stop()

            '' Reminder Timmer On
            If Not IsNothing(ogloReminder) Then
                ogloReminder.Stop()
            End If

            timerLockScreen.Enabled = False

            '' For User Right access
            If Me.MdiChildren.Length > 0 Then
                'If pnlNavigator.Visible = False Then
                If pnlLeft_Nav.Visible = False Then
                    blnLeftPnl = False
                Else
                    blnLeftPnl = True
                End If
            End If
            Me.Visible = False
            'Call UnRegisterMyHotKey()
            Dim strusername As String
            Dim blnoldIsAdmin As Boolean

            'copy the old admin status to a temporary variable
            blnoldIsAdmin = gblnIsAdmin

            'copy the old login name to a temporary variable
            strusername = gstrLoginName
            If gblnVoiceEnabled = True Then
                'there exists a valid provider
                If gstrLoginProviderName <> "" Then
                    If strSpeakerName <> "" AndAlso gblnSpeakerExists = True Then

                        'code commented as microphone on/off logic has changed
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Switch off Microphone started before locking screen", gloAuditTrail.ActivityOutCome.Success)
                        'UpdateVoiceLog("Switch off Microphone started before locking screen")
                        If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Then
                            DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                        End If
                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Switch off Microphone Completed before locking screen", gloAuditTrail.ActivityOutCome.Success)
                        'UpdateVoiceLog("Switch off Microphone Completed before locking screen")
                        'code commented as microphone on/off logic has changed

                        'If DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOn Or DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicSleeping Then
                        '    DgnMicBtn1.MicState = DNSTools.DgnMicStateConstants.dgnmicOff
                        'End If

                        '' 20070613
                        'tlbbtn_Microphone.Visible = False
                    End If
                End If
            End If


            Call SaveDisplaySettings()
            SaveFlexGroupDisplaySettings()
            ''  desable The Auto Refresh Timmer of Task & Messages
            tmrMessages.Enabled = False

            ''''log the audit trails 
            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "'" & gstrLoginName & "' successfully Logged out", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen Appeared", gloAuditTrail.ActivityOutCome.Success)

            frm.Visible = False

            'Problem : 00000253 : Lock Screen Issue
            'Issue : User can see the forms after lock screen.
            'Change : Hide all open forms and bring back them to original state after user re-login.

            If Not IsNothing(Form.ActiveForm) Then
                activeForm = Form.ActiveForm.Name
            End If

            For Each _frm As Form In My.Application.OpenForms
                If _frm.Name = "CheckedListBoxDroDown" Then
                    If Not IsNothing(frm) Then
                        frm.Visible = False
                    End If
                    Continue For
                End If
                If _frm.Name <> "frmSplash" AndAlso _frm.IsMdiChild = False AndAlso _frm.Visible = True Then
                    _frm.Visible = False
                End If
            Next

            Dim frmCodeGuide As gloUIControlLibrary.WPFForms.frmCodeGuide = gloUIControlLibrary.WPFForms.frmCodeGuide.CheckInstance()

            If frmCodeGuide IsNot Nothing Then
                frmCodeGuide.Visibility = Windows.Visibility.Hidden
                frmCodeGuide.WindowState = Windows.WindowState.Minimized
            End If

            Dim intChartQueue As System.IntPtr = IntPtr.Zero
            Dim intChartQueueNote As System.IntPtr = IntPtr.Zero
            Dim intChartQueueHistory As System.IntPtr = IntPtr.Zero

            ' Dim ofrmClinicalChartQueue As gloUIControlLibrary.WPFForms.frmClinicalChartQueue = gloUIControlLibrary.WPFForms.frmClinicalChartQueue.CheckInstance()
            If oChart IsNot Nothing Then
                intChartQueue = WPFForms.frmClinicalChartQueue.PropChartQueueHandle
                If (intChartQueue <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.HideWindow(intChartQueue)
                End If

                intChartQueueNote = WPFForms.frmClinicalChartQueueNotes.PropChartQueueNotesHandle
                If (intChartQueueNote <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.HideWindow(intChartQueueNote)
                End If

                intChartQueueHistory = WPFForms.frmClinicalchartQueueHistory.PropChartQueueHistoryHandle
                If (intChartQueueHistory <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.HideWindow(intChartQueueHistory)
                End If
                'Else
                '    Try
                '        anyDialogOpened = gloWord.WordDialogBoxBackgroundCloser.IsDialogWindowOpened()
                '    Catch ex As Exception
                '    End Try
                '    If (anyDialogOpened <> IntPtr.Zero) Then
                '        gloWord.WordDialogBoxBackgroundCloser.HideWindow(anyDialogOpened)
                '    End If
            End If


            Dim frmICD10Gallery As gloUIControlLibrary.WPFForms.frmICDCodeGallery = gloUIControlLibrary.WPFForms.frmICDCodeGallery.CheckFormOpen()

            If frmICD10Gallery IsNot Nothing Then
                frmICD10Gallery.Visibility = Windows.Visibility.Hidden
                frmICD10Gallery.WindowState = Windows.WindowState.Minimized
            End If

            '  Dim enableDialogCloser As Boolean =gloWord.WordDialogBoxBackgroundCloser.EnableDialogCloser
            gloWord.WordDialogBoxBackgroundCloser.EnableDialogCloser = False

            frmPQRSinst = gloUIControlLibrary.WPFForms.PQRS.frmPQRS.CheckFormOpen()

            If (Not frmPQRSinst Is Nothing) Then
                intPQRSCode = gloUIControlLibrary.WPFForms.PQRS.frmPQRS.PropfrmPQrsHandle
                If (intPQRSCode <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.HideWindow(intPQRSCode)
                End If

            Else
                ''if PQRS  window is on top then no need to check for all dialogwindow 
                ''checking for any dialog window is on Top from application
                Try
                    anyDialogOpened = gloWord.WordDialogBoxBackgroundCloser.IsDialogWindowOpened()

                Catch ex As Exception

                End Try
                If (anyDialogOpened <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.HideWindow(anyDialogOpened)
                End If
            End If
            '18-Aug-2015 Aniket: Resolving Bug #84080: EMR: Send Portal- Send portal window goes back as user unlock EMR screen
            If intPRTIntuitSecureMessage <> System.IntPtr.Zero Then
                gloWord.WordDialogBoxBackgroundCloser.HideWindow(intPRTIntuitSecureMessage)
            End If

            objLogin.UpdateLoginStatus(strusername, False, gstrClientMachineName, gintLoginSessionID)

            Dim screen As Screen

            Try
                '07-Mar-2017 Aniket: This will ensure that the lock screen will be on the same screen as the main screen
                screen = screen.FromControl(Me)

                frm.StartPosition = FormStartPosition.Manual
                frm.Location = screen.Bounds.Location + New Point(100, 100)
            Catch ex As Exception

            End Try
          

            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            isDisplayed = False
            frm.Dispose()
            frm = Nothing

            gloWord.WordDialogBoxBackgroundCloser.EnableDialogCloser = True 'enableDialogCloser
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Dispose, "Getting Out of Lock Screen", gloAuditTrail.ActivityOutCome.Success)
            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Dispose, "'" & gstrLoginName & "' successfully Logged In", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
            '' Add Login ID to Application Configuration File
            appSettings("UserID") = gnLoginID
            '' Add Loging Provider's ID to Application Config File



            appSettings("ProviderID") = objLogin.GetLoginProviderID(gstrLoginName).ToString()

            'objLogin.UpdateLoginStatus(gstrLoginName, True, gstrClientMachineName)

            If IsNothing(objLogin) = False Then
                objLogin.Dispose()  ''slr free objLogin
                objLogin = Nothing
            End If





            '' To Set the new User information in DMS
            gloEDocumentV3.gloEDocV3Admin.SetUser(gnLoginID)
            gloEDocumentV3.gloEDocV3Admin.SetUserName(gstrLoginName)
            ''            

            'Bug #39756: 00000279 : EMR Settings - RxMed User issue
            'To Set the new User information in RxMed.
            gloEMRGeneralLibrary.gloGeneral.globalSecurity.gstrLoginName = gstrLoginName
            gloEMRGeneralLibrary.gloGeneral.globalSecurity.gnUserID = gnLoginID

            If strusername <> gstrLoginName Then
                intTotalTaskCnt = 0 ''added for bugid 91439 fro resetting task search count
                '' Set Defalt settings For Currnt user
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "From Lock Screen GetDefaultsettings Start", gloAuditTrail.ActivityOutCome.Success)
                'UpdateVoiceLog("From Lock Screen GetDefaultsettings Start")
                Call GetDefaultsettings()
                GetCheckedOutAppointmentSetting()
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "From Lock Screen GetDefaultsettings END", gloAuditTrail.ActivityOutCome.Success)
                'UpdateVoiceLog("From Lock Screen GetDefaultsettings END")

                ''''' 20070213
                Call AssignUserRights()
                If gblnIsAdmin Then
                    If gblnVoiceEnabled Then
                        mnuToolsVoiceCenter.Visible = True
                        mnuDoctorSpeakerConfiguration.Visible = True
                        sep18.Visible = True
                    Else
                        mnuToolsVoiceCenter.Visible = False
                        mnuDoctorSpeakerConfiguration.Visible = False
                        sep18.Visible = False
                    End If
                Else
                    mnuToolsVoiceCenter.Visible = False
                    mnuDoctorSpeakerConfiguration.Visible = False
                    sep18.Visible = False
                End If
                ' ''''
                'on login change reset flag to show only 100 unfinished exams in left panel
                bIsShowAllUnfinishedexams = False

            'Sandip Darade 20090421
            ''To  Select the provider 
            oPatientListControl.SelectProvider()

            'Sandip Darade 20090423
            ''To  Select the user specific patient data columns
            'Bug #86857: 00000956 : Resolving patient context lock screen issue
            'oPatientListControl.FillPatients()
            ''Bug #75677: gloEMR - Dashboard - Application is showing different patient information in demographics panel and patient list and patient details panel. 
            If oPatientListControl.SelectedPatientID <> 0 AndAlso appSettings("ProviderID") <> 0 Then
                If oPatientListControl.CheckPatientProvider(appSettings("ProviderID"), gnPatientID) = False Then
                    gnPatientID = oPatientListControl.SelectedPatientID
                    oPatientListControl.SelectedPatientID = 0
                End If
            End If
            Call LoadSelectedPatientInfo(gnPatientID)
            Call LoadSelectedPatientInfo_Part2(gnPatientID)
            '' 20070928 Mahesh --
            '' Ref : Bug 375
            '' If Current Login User is Different than Previous User then Reset the Appointment Date
            ''DB dtpAppointment.Value = Now
            End If

            Call LoadDisplaySettings()

            LoadFlexGroupColumnDisplaySettings()
            LoadTaskListGroupSetting()
            'Resolved Bug No.80217::Task- Group by functionality is not working properly
            _flexGroup.Groups = strTaskCustomGroup
            cmbFilters.Text = strTaskCustomGroup
            '
            GetPatientDemographicsSettings()
            Me.Cursor = Cursors.WaitCursor
            '' Refresh Task for the User



            ''check if login user has changed
            If strusername <> gstrLoginName Then
                blnIsLoginChanged = True

                ' ''SelectPatientPanel()

                'check if voice is enabled 
                If gblnVoiceEnabled = True Then

                    Try


                        'there exists a valid provider
                        If gstrLoginProviderName <> "" Then

                            If strSpeakerName <> "" AndAlso gblnSpeakerExists = True Then
                                'check if voicemenu instance exists
                                'if so destroy the instance
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Voice Menu Destruction started at lock screen", gloAuditTrail.ActivityOutCome.Success)
                                'UpdateVoiceLog("Voice Menu Destruction started at lock screen")
                                If Not IsNothing(vVoiceMenu) Then
                                    vVoiceMenu.Remove(1)
                                    vVoiceMenu.Remove(2)
                                    vVoiceMenu.Active = False
                                    'vVoiceMenu = Nothing
                                    System.Runtime.InteropServices.Marshal.ReleaseComObject(vVoiceMenu)
                                    vVoiceMenu = Nothing
                                End If
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Voice Menu Destruction Completed at lock screen", gloAuditTrail.ActivityOutCome.Success)
                                'UpdateVoiceLog("Voice Menu Destruction Completed at lock screen")
                                'code commented from 20/05/2006 (meeting with oscar--Mphone Registered at form load and unregistered at form unload)
                                'DgnMicBtn1.UnRegister()
                                'code commented from 20/05/2006 (meeting with oscar--Mphone Registered at form load and unregistered at form unload)
                                If DgnEngineControl1.Speakers.Count > 0 Then
                                    If Not IsNothing(DgnEngineControl1.Speaker) Then
                                        'V Command should be unregistered before
                                        'Saving the speaker.
                                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Voice Command UnRegistration started at lock screen", gloAuditTrail.ActivityOutCome.Success)
                                        Vcmd.UnRegister()
                                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Voice Command UnRegistration Completed at lock screen", gloAuditTrail.ActivityOutCome.Success)
                                        'Save Speaker
                                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Speaker Save started at lock screen", gloAuditTrail.ActivityOutCome.Success)
                                        DgnEngineControl1.SpeakerSave()
                                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Dispose, "Speaker Save Completed at lock screen", gloAuditTrail.ActivityOutCome.Success)
                                        'Need to set the dgnCompModuleAll setting False
                                        'as this is needed before closing the speaker
                                        DgnEngineControl1.set_CompatibilityModule(DNSTools.DgnCompatibilityModuleConstants.dgncompmoduleAll, -1, False)
                                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "LoadVoiceFornewUser started at lock screen where old speaker present", gloAuditTrail.ActivityOutCome.Success)
                                        LoadVoicefornewuser()
                                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "LoadVoiceFornewUser started at lock screen where old speaker present", gloAuditTrail.ActivityOutCome.Success)
                                    End If
                                End If
                                'if old speaker is not present
                            Else   ''Else OF If strSpeakerName <> "" And gblnSpeakerExists = True Then
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "LoadVoiceFornewUser started at lock screen where old speaker not present", gloAuditTrail.ActivityOutCome.Success)
                                LoadVoicefornewuser()
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "LoadVoiceFornewUser started at lock screen where old speaker not present", gloAuditTrail.ActivityOutCome.Success)
                            End If   '' If strSpeakerName <> "" And gblnSpeakerExists = True Then
                        ElseIf gstrLoginProviderName = "" Then
                            If blnoldIsAdmin Then
                                If DgnEngineControl1.Speaker <> "" Then
                                    'code commented from 20/05/2006 (meeting with oscar--Mphone Registered at form load and unregistered at form unload)
                                    'DgnMicBtn1.UnRegister()
                                    'code commented from 20/05/2006 (meeting with oscar--Mphone Registered at form load and unregistered at form unload)
                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Save Speaker started at lock screen where old speaker present where old user is admin", gloAuditTrail.ActivityOutCome.Success)
                                    DgnEngineControl1.SpeakerSave()
                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Save Speaker Completed at lock screen where old speaker present where old user is admin", gloAuditTrail.ActivityOutCome.Success)
                                    DgnEngineControl1.set_CompatibilityModule(DNSTools.DgnCompatibilityModuleConstants.dgncompmoduleAll, -1, False)
                                End If
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "LoadVoiceFornewUser started at lock screen where old speaker not present and old user is admin", gloAuditTrail.ActivityOutCome.Success)
                                LoadVoicefornewuser()
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "LoadVoiceFornewUser Completed at lock screen where old speaker not present and old user is admin", gloAuditTrail.ActivityOutCome.Success)
                                'old user is not admin
                            Else
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "LoadVoiceFornewUser started at lock screen where old speaker not present and old user is not admin", gloAuditTrail.ActivityOutCome.Success)
                                LoadVoicefornewuser()
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "LoadVoiceFornewUser Completed at lock screen where old speaker not present and old user is not admin", gloAuditTrail.ActivityOutCome.Success)
                            End If
                        End If  ''   If gstrProviderName <> "" Then

                        'if system is not voice enabled
                        '26-May-15 Aniket: Handling Bug #83619: EMR(Concurrency Testing ): Reloggin issue- After reloging by different credentials application gives errror message
                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Close, "Error in LockScreen Voice Setup" & ex.Message & " at " & ex.StackTrace, gloAuditTrail.ActivityOutCome.Failure)
                        MessageBox.Show("Unable to load Voice. Please exit the system and login again.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                    End Try

                Else
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill_ProvidersAndPatients started at lock screen where system is not voice enabled", gloAuditTrail.ActivityOutCome.Success)
                    Fill_ProvidersAndPatients()
                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Load, "Fill_ProvidersAndPatients Completed at lock screen where system is not voice enabled", gloAuditTrail.ActivityOutCome.Success)
                    mnuToolsVoiceCenter.Visible = False
                    mnuDoctorSpeakerConfiguration.Visible = False

                    sep18.Visible = False
                End If                '' If gblnVoiceEnabled = True

                'EPA If logged in user has changed then close the View EPA Process Window and assign roles as associated
                Dim frmRxMeds As frmPrescription = Me.MdiChildren.FirstOrDefault(Function(p) TypeOf (p) Is frmPrescription)

                If frmRxMeds IsNot Nothing Then
                    frmRxMeds.CloseEPAWindow()
                End If

                Me.CheckEPAUserIsInRole(gnLoginID)

            End If
            If gblnIsSecureMsgEnable Then
                oInbox = gloSurescriptSecureMessage_InBox.Inbox.CheckFormOpen()
                If strusername <> gstrLoginName Then

                    Dim DirectDBLayer As New DirectUserProvider_DBLayer
                    Dim dtAssociation As DataTable
                    dtAssociation = DirectDBLayer.GetProvidersByUserID(mdlGeneral.gnLoginID)
                    If (IsNothing(dtAssociation) = False) Then


                        If dtAssociation.Rows.Count > 0 Then

                            If listDirectUserProviderAssociation Is Nothing Then
                                listDirectUserProviderAssociation = New List(Of gloSurescriptSecureMessage.DirectUserProviderAssociation)
                            Else
                                If listDirectUserProviderAssociation.Any() Then
                                    listDirectUserProviderAssociation.Clear()
                                End If

                                If gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation IsNot Nothing Then
                                    If gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation.Any() Then
                                        gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation.Clear()
                                    End If
                                End If
                            End If

                            For Each DataRow As DataRow In dtAssociation.Rows
                                listDirectUserProviderAssociation.Add(New gloSurescriptSecureMessage.DirectUserProviderAssociation(DataRow))
                            Next


                        Else
                            If listDirectUserProviderAssociation IsNot Nothing Then
                                listDirectUserProviderAssociation.Clear()
                                listDirectUserProviderAssociation = Nothing
                            End If
                        End If
                        dtAssociation.Clear()
                        dtAssociation.Dispose()
                        dtAssociation = Nothing
                    Else
                        If listDirectUserProviderAssociation IsNot Nothing Then
                            listDirectUserProviderAssociation.Clear()
                            listDirectUserProviderAssociation = Nothing
                        End If
                    End If
                    DirectDBLayer = Nothing
                    If listDirectUserProviderAssociation IsNot Nothing Then
                        gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation = listDirectUserProviderAssociation
                    Else
                        If gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation IsNot Nothing Then
                            gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation.Clear()
                            gloSurescriptSecureMessage.SecureMessageProperties.ListUserProviderAssociation = Nothing
                        End If
                    End If

                    gloSurescriptSecureMessage.SecureMessageProperties.DatabaseConnectionString = GetConnectionString()
                    gloSurescriptSecureMessage.SecureMessageProperties.UserID = Convert.ToInt64(appSettings("UserID"))
                    gloSurescriptSecureMessage.SecureMessageProperties.UserName = appSettings("UserName")
                    gloSurescriptSecureMessage.SecureMessageProperties.ProviderID = appSettings("ProviderID")
                    gloSurescriptSecureMessage.SecureMessageProperties.SiteID = gstrSiteID
                    gloSurescriptSecureMessage.SecureMessageProperties.Location = gstrLocation
                    gloSurescriptSecureMessage.SecureMessageProperties.AUSID = gstrAUSID
                    gloSurescriptSecureMessage.SecureMessageProperties.ClinicName = gstrClinicName
                    gloSurescriptSecureMessage.SecureMessageProperties.MessageBoxCaption = gstrMessageBoxCaption
                    gloSurescriptSecureMessage.SecureMessageProperties.ClinicID = gnClinicID
                    gloSurescriptSecureMessage.SecureMessageProperties.bIsPatientSavingEnabled = gblnIsPatientSavingEnabled
                    gloSurescriptSecureMessage.SecureMessageProperties.bEnablePatientSavingsInbox = gblnEnablePatientSavingsInbox
                    gloSurescriptSecureMessage.SecureMessageProperties.HasPatientSavingRights = gblnIsPatientSavingRights

                    If gblnIsPatientSavingEnabled AndAlso gblnEnablePatientSavingsInbox AndAlso gblnIsPatientSavingRights Then
                        gloSurescriptSecureMessage.SecureMessageProperties.DisplayPatientSavingsInbox = True
                    Else
                        gloSurescriptSecureMessage.SecureMessageProperties.DisplayPatientSavingsInbox = False
                    End If

                    Dim clsDb As New clsSecureMessageDB()


                    Dim dtProviderDetails As DataTable
                    dtProviderDetails = clsDb.GetProviderDetails(appSettings("ProviderID"))
                    If Not IsNothing(dtProviderDetails) Then
                        If dtProviderDetails.Rows.Count > 0 Then

                            gloSurescriptSecureMessage.SecureMessageProperties.ProviderDirectAddress = Convert.ToString(dtProviderDetails.Rows(0)("sDirectAddress"))
                            strProviderDirectAddress = Convert.ToString(dtProviderDetails.Rows(0)("sDirectAddress"))
                            gloSurescriptSecureMessage.SecureMessageProperties.ProviderName = Convert.ToString(dtProviderDetails.Rows(0)("sProviderName"))
                            gloSurescriptSecureMessage.SecureMessageProperties.SPID = Convert.ToString(dtProviderDetails.Rows(0)("sSPID"))

                            If listDirectUserProviderAssociation IsNot Nothing AndAlso strProviderDirectAddress.Length > 0 Then
                                Dim random As New Random
                                listDirectUserProviderAssociation.Add(New gloSurescriptSecureMessage.DirectUserProviderAssociation(random.Next(999999999) + random.Next(999999999), gloSurescriptSecureMessage.SecureMessageProperties.UserID, appSettings("ProviderID"), gloSurescriptSecureMessage.SecureMessageProperties.ProviderName, gloSurescriptSecureMessage.SecureMessageProperties.ProviderDirectAddress, gloSurescriptSecureMessage.SecureMessageProperties.SPID, True))
                                random = Nothing
                            End If
                        Else
                            gloSurescriptSecureMessage.SecureMessageProperties.ProviderDirectAddress = ""
                            strProviderDirectAddress = ""
                            gloSurescriptSecureMessage.SecureMessageProperties.ProviderName = ""
                            gloSurescriptSecureMessage.SecureMessageProperties.SPID = ""
                        End If
                    Else
                        gloSurescriptSecureMessage.SecureMessageProperties.ProviderDirectAddress = ""
                        strProviderDirectAddress = ""
                        gloSurescriptSecureMessage.SecureMessageProperties.ProviderName = ""
                        gloSurescriptSecureMessage.SecureMessageProperties.SPID = ""

                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objProblemList) = False Then
                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objProblemList, clsPatientProblemList).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objCriteria) = False Then
                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objCriteria, DocCriteria).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objPatientMessages) = False Then
                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objPatientMessages, clsMessage).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objPatientLetters) = False Then
                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objPatientLetters, clsPatientLetters).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objNurseNotes) = False Then

                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objNurseNotes, clsNurseNotes).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objHistory) = False Then

                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objHistory, clsPatientHistory).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objLabs) = False Then

                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objLabs, clsLabs).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objDMS) = False Then

                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objRxmed) = False Then

                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objRxmed, clsPatientDetails).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objOrders) = False Then

                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objOrders, clsPatientDetails).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objCriteria) = False Then

                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objCriteria, DocCriteria).Dispose()
                    End If
                    If IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.objPatientExam) = False Then

                        DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.objPatientExam, clsPatientExams).Dispose()
                    End If

                    gloSurescriptSecureMessage.SecureMessageProperties.objPatientExam = New clsPatientExams
                    gloSurescriptSecureMessage.SecureMessageProperties.objPatientMessages = New clsMessage
                    gloSurescriptSecureMessage.SecureMessageProperties.objPatientLetters = New clsPatientLetters
                    gloSurescriptSecureMessage.SecureMessageProperties.objNurseNotes = New clsNurseNotes
                    gloSurescriptSecureMessage.SecureMessageProperties.objHistory = New clsPatientHistory
                    gloSurescriptSecureMessage.SecureMessageProperties.objLabs = New clsLabs
                    gloSurescriptSecureMessage.SecureMessageProperties.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                    gloSurescriptSecureMessage.SecureMessageProperties.objRxmed = New clsPatientDetails
                    gloSurescriptSecureMessage.SecureMessageProperties.objOrders = New clsPatientDetails
                    gloSurescriptSecureMessage.SecureMessageProperties.objProblemList = New clsPatientProblemList
                    gloSurescriptSecureMessage.SecureMessageProperties.objCriteria = New DocCriteria
                    gloSurescriptSecureMessage.SecureMessageProperties.objWord = New clsWordDocument

                    '30-Apr-13 Aniket: Resolving Memory Leaks
                    If IsNothing(dtProviderDetails) = False Then
                        dtProviderDetails.Dispose()
                        dtProviderDetails = Nothing
                    End If

                    If Not IsNothing(clsDb) Then
                        clsDb.Dispose()
                    End If

                    oNewMail = InBox.NewMail.CheckFormOpen()
                    If Not IsNothing(oNewMail) Then
                        oNewMail.Close()
                    End If

                    If Not IsNothing(gloSurescriptSecureMessage.SecureMessageProperties.OpenedFormsCollection) Then
                        If gloSurescriptSecureMessage.SecureMessageProperties.OpenedFormsCollection.Count > 0 Then
                            Dim _OpenedFormscollections As Hashtable
                            _OpenedFormscollections = DirectCast(gloSurescriptSecureMessage.SecureMessageProperties.OpenedFormsCollection.Clone(), Hashtable)

                            For Each Item As DictionaryEntry In _OpenedFormscollections
                                oViewMessage = DirectCast(Item.Value, ViewMessage)
                                If Not IsNothing(oViewMessage) Then
                                    oViewMessage.Close()
                                End If
                            Next
                            _OpenedFormscollections.Clear()
                            _OpenedFormscollections = Nothing
                        End If
                    End If


                    If Not IsNothing(oInbox) Then
                        oInbox.Close()
                    End If
                Else
                    If Not IsNothing(oInbox) Then
                        oInbox.Visibility = Windows.Visibility.Visible
                        oInbox.WindowState = Windows.WindowState.Maximized
                        oInbox.Activate()
                        oNewMail = InBox.NewMail.CheckFormOpen()
                        If Not IsNothing(oNewMail) Then
                            oNewMail.Visibility = Windows.Visibility.Visible
                            oNewMail.WindowState = Windows.WindowState.Normal
                            oInbox.Activate()
                            oNewMail.BringIntoView()
                        End If


                        For Each Item As DictionaryEntry In gloSurescriptSecureMessage.SecureMessageProperties.OpenedFormsCollection
                            oViewMessage = DirectCast(Item.Value, ViewMessage)
                            If Not IsNothing(oViewMessage) Then
                                oViewMessage.Visibility = Windows.Visibility.Visible
                                oViewMessage.WindowState = Windows.WindowState.Normal
                            End If
                        Next


                    End If
                End If
            End If

            ''''''''''''' Added by Ujwala Atre - to implement 'Allow Emergency Access of Patient Chart' as on 30012010
            gbAllowEmergencyAccess = False 'Reset Flag
            ''''''''''''''''''''
            SetButtonsOnOff()
            SetLicenseModule()



            If gblnVoiceEnabled = True Then
                If Not IsNothing(IExam) Then
                    If gstrLoginProviderName <> "" Then
                        If strSpeakerName <> "" AndAlso gblnSpeakerExists = True Then
                            'only if current user is different then instantiate the voice menu
                            If strusername <> gstrLoginName Then
                                Dim strMenuName As String
                                strMenuName = "gloEMRVoice" & CType(System.DateTime.Now.Year, String) & CType(System.DateTime.Now.Month, String) & CType(System.DateTime.Now.Day, String) & CType(System.DateTime.Now.Hour, String) & CType(System.DateTime.Now.Minute, String) & CType(System.DateTime.Now.Second, String)
                                vVoiceMenu = Vcmd.MenuCreate(strMenuName, strMenuName & "1", DNSTools.DgnLanguageConstants.dgnlangUSEnglish, "", DNSTools.CREATEFLAGS.vcmdmc_CREATE_TEMP)
                                If Not IsNothing(myRefCaller) Then
                                    vVoiceMenu.hWndMenu = CType(myRefCaller, IExamChildEvents).Handle
                                Else
                                    vVoiceMenu.hWndMenu = Me.Handle.ToInt32
                                End If
                                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "vVoiceMenu Initialise done at lock screen", gloAuditTrail.ActivityOutCome.Success)
                                'UpdateVoiceLog(" vVoiceMenu Initialise done at lock screen ")

                                vVoiceMenu.Active = True

                                If Not IsNothing(vVoiceMenu) Then
                                    Dim I As gloVoice
                                    Try
                                        Dim blnExamChild As Boolean = False

                                        'Exam child form loaded when Lock Screen came up
                                        If Not IsNothing(myRefCaller) Then
                                            I = myRefCaller
                                            I.AddVoiceCommands()
                                            blnExamChild = True
                                            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "myRefCaller.AddVoiceCommands() done at lock screen", gloAuditTrail.ActivityOutCome.Success)

                                        End If
                                        'The patient exam form is loaded when lock screen came
                                        If Not blnExamChild Then
                                            For Each frmTemp As Form In Me.MdiChildren
                                                If frmTemp.Name = "frmTemplateGallery" Or frmTemp.Name = "frmPatientExam" Or frmTemp.Name = "frmMessages" Or frmTemp.Name = "frmPatientLetter" Or frmTemp.Name = "frm_LM_Orders" Or frmTemp.Name = "frmPTProtocols" Or frmTemp.Name = "frmNurseNotes" Or frmTemp.Name = "frmPatientConsent" Or frmTemp.Name = "frmPatientEducation" Or frmTemp.Name = "frmDisclosureMgmt" Or frmTemp.Name = "frmTriage" Or frmTemp.Name = "frmCPTTemplate" Or frmTemp.Name = "frmDM_Template" Or frmTemp.Name = "frmMSTTemplateGallery" Then
                                                    I = CType(frmTemp, gloVoice)
                                                    I.AddVoiceCommands()
                                                    gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.VoiceCommands, gloAuditTrail.ActivityType.Initialize, "MdiChildren.AddVoiceCommands() done at lock screen", gloAuditTrail.ActivityOutCome.Success)
                                                End If
                                            Next
                                        End If


                                    Catch ex As Exception

                                    End Try
                                End If
                            End If
                        End If
                    End If

                    '10-No-14 Aniket: Bug #75776: gloEMR - lock screen - Application is showing error message when user try to re-login.
                    Try
                        IExam.Navigate("OFF")
                    Catch ex As Exception

                    End Try

                End If
            End If
            SecurityUserSettings()  ''Added by Mayuri:20100127-For security user only Audit trail and Patient List should display
            GetUserSpeciality()
            ''Added by Mayuri:20100514-Bug:#6663
            oPatientListControl.ClearSearch()
            ''Bug #86857: 00000956 : Patient changes after lock screen.
            If oPatientListControl.SelectedPatientID <> gnPatientID AndAlso oPatientListControl.SelectedPatientID <> 0 Then
                gnPatientID = oPatientListControl.SelectedPatientID
                Call LoadSelectedPatientInfo(gnPatientID)
                LoadSelectedPatientInfo_Part2(gnPatientID)
            End If


            If frmCodeGuide IsNot Nothing Then
                frmCodeGuide.Visibility = Windows.Visibility.Visible
                frmCodeGuide = Nothing
            End If

            If oChart IsNot Nothing Then
                If (intChartQueue <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.ForceWindowIntoForeground(intChartQueue)
                End If

                If (intChartQueueNote <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.ForceWindowIntoForeground(intChartQueueNote)
                End If

                If (intChartQueueHistory <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.ForceWindowIntoForeground(intChartQueueHistory)
                End If
            End If

            If frmICD10Gallery IsNot Nothing Then
                frmICD10Gallery.Visibility = Windows.Visibility.Visible
                frmICD10Gallery.WindowState = Windows.WindowState.Maximized
                frmICD10Gallery.Activate()
                frmICD10Gallery.BringIntoView()
                'frmICD10Gallery = Nothing
            End If
            '' gloUIControlLibrary.WPFForms.PQRS.frmPQRS.HideDock(Windows.Visibility.Visible)
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Close, "Lock Screen Completed About to Show gloEMR Screen ", gloAuditTrail.ActivityOutCome.Success)

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Close, "Error logging from Lock Screen " & ex.Message & " at " & ex.StackTrace, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show("Error Relogging in gloEMR", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Close, " Me.Visible = " & Me.Visible, gloAuditTrail.ActivityOutCome.Success)
            If Me.Visible = False Then
                Me.Visible = True
                'Sanjog- Added on 2011 March 25 to solve the Bug ID 8984- To call this method after load event of the gloUC_TransactionHIstory control

                'Sanjog- Added on 2011 March 25 to solve the Bug ID 8984- To call this method after load event of the gloUC_TransactionHIstory control
                UpdateStatusBar() '' SUDHIR 20090704 ''
                SelectedPatientDetail = PatientDetails.None
                ShowPatientDetails()
                ShowPatientDetailsOnUserRights()
            End If
            gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Close, " Me.Visible = " & Me.Visible, gloAuditTrail.ActivityOutCome.Success)

            ''  Enable The Lock Screen Timmer
            timerLockScreen.Enabled = True

            '' Reminder Timmer On
            If Not IsNothing(ogloReminder) Then
                ogloReminder.Start()
            End If

            ''  Enable The Auto Refresh Timmer of Task & Messages
            tmrMessages.Enabled = True
            tmrMessages_Tick(Nothing, Nothing)
            ShowUnfinishedExams()
            ShowTriage()

            '18-Nov-15 Aniket: Resolving Bug #91316: gloEMR: Task Panel: Application does not refresh Task panel from dashboard as user lock and unlock EMR using another user's credentials
            If blnIsLoginChanged = True Then
                ShowTasks()
                ''added for bugid 98623 reminder task window remains open if login from other user  
                Try
                    Dim objfrmrem As Form = gloReminder.frmReminder.GetInstance()
                    objfrmrem.Close()
                    objfrmrem = Nothing
                Catch ex As Exception
                    ex = Nothing
                End Try

            End If

            If Me.MdiChildren.Length > 0 Then
                Dim frmtemp As Form
                Dim isFormOpen As Boolean = False
                For Each frmtemp In Me.MdiChildren
                    If IsNothing(frmtemp) = False Then
                        If frmtemp.CanSelect = True Then
                            isFormOpen = True
                            Exit For
                        End If
                    End If
                Next

                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Close, "Dashboard MdiChildren = " & Me.MdiChildren(0).Name, gloAuditTrail.ActivityOutCome.Success)
                If isFormOpen = True Then
                    ShowHideMainMenu(False, False)
                Else
                    ShowHideMainMenu(True, True)
                End If
            Else
                ShowHideMainMenu(True, True)
            End If
            Me.Cursor = Cursors.Default
            '' Copay Alert 
            tmrCopayAlert.Stop()
            If pnlNavigator.SelectedPanel.Text.ToUpper = NAV_ALERTS Then
                ShowCopayAlert()
                ShowUnappliedCopayAlert()
            End If

            UpdateLog("In the Finally block of LockScreen, timerLockScreen.Enabled = " & timerLockScreen.Enabled)
            Me.Activate()

            Dim m As New Message
            m.WParam = 1
            m.Msg = UnmanagedMethods.WM_ACTIVATEAPP
            WndProc(m)
            'RegisterMyHotKey()
            ' Free 'm' problem 00000591
            If Not IsNothing(m) Then
                m = Nothing
            End If

            isDisplayed = False

            Try

                Dim frmMessages As frmMessages = Nothing
                Dim frmTask As gloTaskMail.frmTask = Nothing
                Dim frmgloEDocumentV3 As gloEDocumentV3.Forms.frmEDocumentViewer = Nothing
                Dim blnCloseForm As Boolean

                'Problem : 00000253 : Lock Screen Issue
                'Unhide all forms that are hided before lock screen
                For Each _frm As Form In My.Application.OpenForms
                    If _frm.Name <> "frmSplash" AndAlso _frm.IsMdiChild = False AndAlso _frm.Visible = False Then

                        '16-Nov-15 Aniket: 8070 Refresh Tasks/Messages when different user logs in after lock screen
                        If _frm.Name = "frmTask" Then

                            If blnIsLoginChanged = True Then

                                '28-Dec-15 Aniket: Resolving Bug #91489: gloEMR: DMS task: Scan documents does not respond as second user access same scan documents winodw
                                If DirectCast(_frm, gloTaskMail.frmTask).Enabled = True Then
                                    frmTask = DirectCast(_frm, gloTaskMail.frmTask)
                                    blnCloseForm = True
                                End If

                                '17-Nov-15 Aniket: Resolving Bug #91315: gloEMR: Scan Docs: As user logged in by different user after locking EMR, application also closes Scan docs window
                                'Aniket: Do not dispose the following form as it is used in the For Next Loop
                                'DirectCast(_frm, gloTaskMail.frmTask).Dispose()
                                'Continue For
                            End If

                        End If

                        If IsNothing(_frm) = False AndAlso Not String.IsNullOrEmpty(activeForm) AndAlso _frm.Name.Equals(activeForm) Then
                            _frm.BringToFront()
                            'Resolved Bug #75047::View-Referrals - Application is not showing preview for the document
                            If _frm.Name = "frmSummaryofVisit" Then
                                DirectCast(_frm, gloEMR.frmSummaryofVisit).wdReferrals.Refresh()
                            ElseIf _frm.Name = "frmEDocumentViewer" Then
                                frmgloEDocumentV3 = _frm
                            End If
                        End If

                    ElseIf IsNothing(_frm) = False AndAlso _frm.Name = "frmVWMessages" AndAlso _frm.IsMdiChild = True Then
                        If blnIsLoginChanged = True Then
                            DirectCast(_frm, frmVWMessages).RefreshMessages()
                        End If

                    ElseIf IsNothing(_frm) = False AndAlso _frm.Name = "frmMessages" AndAlso _frm.IsMdiChild = True Then
                        If blnIsLoginChanged = True Then
                            frmMessages = DirectCast(_frm, frmMessages)
                            blnCloseForm = True
                            '17-Nov-15 Aniket: Resolving Bug #91315: gloEMR: Scan Docs: As user logged in by different user after locking EMR, application also closes Scan docs window
                            'Continue For


                        End If

                    ElseIf IsNothing(_frm) = False AndAlso _frm.Name = "frmViewTask" AndAlso _frm.IsMdiChild = True Then
                        If blnIsLoginChanged = True Then

                            DirectCast(_frm, gloTaskMail.frmViewTask).UserId = gnLoginID
                            DirectCast(_frm, gloTaskMail.frmViewTask).userName = gstrLoginName
                            DirectCast(_frm, gloTaskMail.frmViewTask).Fill_Users_All_Tasks("", gblnviewCompleteOtherUsersTasks)
                        End If

                    End If

                    If _frm.Name <> "frmSplash" AndAlso _frm.IsMdiChild = False AndAlso _frm.Visible = False Then
                        If IsNothing(_frm) = False Then

                            If blnCloseForm = False Then
                                _frm.Visible = True
                            Else
                                blnCloseForm = False
                            End If
                        End If
                    End If


                Next

                '17-Nov-15 Aniket: Resolving Bug #91315: gloEMR: Scan Docs: As user logged in by different user after locking EMR, application also closes Scan docs window
                If IsNothing(frmMessages) = False Then
                    frmMessages.Close()
                    'Aniket: Do not dispose the following form as is does not work if the form close is cancelled
                    'DirectCast(_frm, frmMessages).Dispose()
                End If

                If IsNothing(frmTask) = False Then

                    'CloseWindowTimer = New System.Windows.Forms.Timer
                    'AddHandler CloseWindowTimer.Tick, AddressOf CloseWindowEvent
                    'CloseWindowTimer.Interval = 10000
                    'CloseWindowTimer.Enabled = True
                    'frmTask.Close()
                    '10-Dec-15 Aniket: Resolving Bug #91498: gloEMR: Task: Application does not close accept task window, when other user loggeg in 
                    If frmTask.ContainsFocus = True Then
                        frmTask.Close()
                        frmTask.Dispose()
                    Else
                        frmTask.Dispose()
                    End If


                    If IsNothing(frmgloEDocumentV3) = False Then
                        frmgloEDocumentV3.BringToFront()
                    End If
                    'Aniket: Do not dispose the following form as is does not work if the form close is cancelled
                    'DirectCast(_frm, frmTask).Dispose()
                End If

                '19-May-16 Aniket: Resolving Bug #96351: gloEMR :Background printing:Application does not display printer list while login by provider .
                If blnIsLoginChanged = True Then
                    gloPrintDialog.clsPrinterSettings.LoadPrinters(GetConnectionString(), gnLoginID)
                End If


            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try

            'Added to hide Call out Split screen control
            HideCallOutSplitScreen()


            'Added by Amit to resolve 
            'Lock Screen > Application display forms in small screen after locking and re-logging.
            If IsNothing(Me.MdiChildren) = False Then
                If Me.MdiChildren.Count > 0 Then
                    If IsNothing(Me.ActiveMdiChild) = False Then
                        Me.ActiveMdiChild.WindowState = FormWindowState.Maximized

                        'Showing split screen of Active mdi form
                        ShowSplitScreenOfActiveForm()

                    End If
                End If
            End If


            oInbox = Nothing
            oNewMail = Nothing
            oViewMessage = Nothing
            _isShowDialogueForm = False
            RegisterMyHotKey()
            UpdateLog("LockScreen: Register from LockScreen")
            _isFromLockScreen = True
            _isShowDialogueForm = False  ''added for function key f4  lockscreen issue for showdialog form

            If (anyDialogOpened <> IntPtr.Zero) Then
                gloWord.WordDialogBoxBackgroundCloser.ForceWindowIntoForeground(anyDialogOpened)
            End If
            '18-Aug-2015 Aniket: Resolving Bug #84080: EMR: Send Portal- Send portal window goes back as user unlock EMR screen

            If intPRTIntuitSecureMessage <> System.IntPtr.Zero Then
                gloWord.WordDialogBoxBackgroundCloser.ForceWindowIntoForeground(intPRTIntuitSecureMessage)
            End If

            If (Not frmPQRSinst Is Nothing) Then
                If (intPQRSCode <> IntPtr.Zero) Then
                    gloWord.WordDialogBoxBackgroundCloser.ForceWindowIntoForeground(intPQRSCode)
                End If

            End If

            frmPQRSinst = Nothing
        End Try
    End Sub
    Dim thrdQueue As Threading.Thread = Nothing
    Private Sub ClinicalChartPrintQueue(patientId As Int64, queueId As Int64, contactId As Int64, dtStartDate As Date, dtEndDate As Date)
        Dim ofrmCC As frmClinicalChart = New frmClinicalChart(patientId, queueId, contactId, dtStartDate, dtEndDate)
        ofrmCC.MaximizeBox = True
        ofrmCC.MinimizeBox = False
        ofrmCC.Visible = False
        ofrmCC.ShowInTaskbar = False
        ofrmCC.StartPosition = FormStartPosition.CenterScreen
        ofrmCC.WindowState = FormWindowState.Maximized
        AddHandler ofrmCC.EvnMsgQueue, AddressOf EnableThreadQueue
        ofrmCC.ShowDialog(IIf(IsNothing(ofrmCC.Parent), Me, ofrmCC.Parent))
        ofrmCC.Dispose()
        ofrmCC = Nothing

    End Sub

    Private Sub EnableThreadQueue(Optional ByVal BackGroundProcessType As gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue)

        'blncont = False
        'Timer1.Enabled = False
        'Timer1.Interval = 500
        'Timer1.Enabled = True
        'blncont = True
        Me.Cursor = Cursors.Default
        If (thrdQueue Is Nothing) Then
            thrdQueue = New Threading.Thread(New Threading.ParameterizedThreadStart(AddressOf processQueuedata))


            thrdQueue.IsBackground = True
            thrdQueue.Start(BackGroundProcessType)
            'Else
            '    Try
            '        'While (blnqueprocess)



            '        'End While
            '        thrdQueue.Abort()
            '    Catch ex As ThreadAbortException


            'Thread.ResetAbort()

            'ex = Nothing
            '    End Try

            '    thrdQueue = Nothing
            '    thrdQueue = New Threading.Thread(New Threading.ThreadStart(AddressOf processQueuedata))
            '    thrdQueue.IsBackground = True
            '    thrdQueue.Start()
        End If
        '' MessageBox.Show(cnt.ToString())

        'Timer1.Enabled = True
        'blncont = False
        'Threading.Thread.Sleep(500)
        'processMoredata()
    End Sub

    Private Sub EnableThreadQueueForPrint()
        'blncont = False
        'Timer1.Enabled = False
        'Timer1.Interval = 500
        'Timer1.Enabled = True
        'blncont = True
        Me.Cursor = Cursors.Default
        If (thrdQueue Is Nothing) Then
            'thrdQueue = New Threading.Thread(New Threading.ThreadStart(AddressOf processQueuedata))
            thrdQueue = New Threading.Thread(Sub()
                                                 processQueuedataForPrint()
                                             End Sub)


            thrdQueue.IsBackground = True
            thrdQueue.Start()
            'Else
            '    Try
            '        'While (blnqueprocess)



            '        'End While
            '        thrdQueue.Abort()
            '    Catch ex As ThreadAbortException


            'Thread.ResetAbort()

            'ex = Nothing
            '    End Try

            '    thrdQueue = Nothing
            '    thrdQueue = New Threading.Thread(New Threading.ThreadStart(AddressOf processQueuedata))
            '    thrdQueue.IsBackground = True
            '    thrdQueue.Start()
        End If
        '' MessageBox.Show(cnt.ToString())

        'Timer1.Enabled = True
        'blncont = False
        'Threading.Thread.Sleep(500)
        'processMoredata()
    End Sub

    Private Sub processQueuedata(Optional ByVal BackgroundProcessType As gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue)

        ' Dim objcon As New SqlConnection(gloGlobal.gloPMGlobal.DatabaseConnectionString)
        Dim objda As New SqlDataAdapter("gsp_GetClinicalChartQueuePrinting", gloGlobal.gloPMGlobal.DatabaseConnectionString)
        objda.SelectCommand.CommandType = CommandType.StoredProcedure
        objda.SelectCommand.Parameters.AddWithValue("@BackgroundProcessType", BackgroundProcessType.GetDescription)
        Dim objdt As New DataTable
        ' Dim objcmd As SqlCommand = Nothing
        '   blnquethrdaborted = False
        Dim ds As DataSet = Nothing

        Dim reccnt As Integer = 0
        Dim localBackgroundProcessType As gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType
        Try
            objda.Fill(objdt)
            For Each dr As DataRow In objdt.Rows
                localBackgroundProcessType = DirectCast([Enum].Parse(GetType(gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType), dr("BackgroundProcessType")), gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType)

                ds = ExportClinicalChartsToFolder(dr(0), False, localBackgroundProcessType)


            Next
        Catch ex As ThreadAbortException
            '  blnquethrdaborted = True
        Catch ex As Exception

        Finally

            If IsNothing(ds) = False Then
                ds.Dispose()
                ds = Nothing
            End If

            If (Not IsNothing(objdt)) Then
                objdt.Dispose()
                objdt = Nothing
            End If
            'If (Not objcon Is Nothing) Then
            '    objcon.Dispose()
            '    objcon = Nothing
            'End If
            If (CheckQueueCount() > 0) Then
                thrdQueue = Nothing
                thrdQueue = New Threading.Thread(New Threading.ThreadStart(AddressOf processQueuedata))
                thrdQueue.IsBackground = True
                thrdQueue.Start()
            Else

                thrdQueue = Nothing
            End If

        End Try
    End Sub

    Private Sub processQueuedataForPrint()
        ' Dim objcon As New SqlConnection(gloGlobal.gloPMGlobal.DatabaseConnectionString)
        Dim objda As New SqlDataAdapter("gsp_GetClinicalChartQueuePrinting_ForPrint", gloGlobal.gloPMGlobal.DatabaseConnectionString)
        objda.SelectCommand.CommandType = CommandType.StoredProcedure
        Dim objdt As New DataTable
        ' Dim objcmd As SqlCommand = Nothing
        '   blnquethrdaborted = False
        Dim ds As DataSet = Nothing

        Dim reccnt As Integer = 0
        Try
            objda.Fill(objdt)
            For Each dr As DataRow In objdt.Rows
                ds = ExportClinicalChartsToFolder(dr(0), True, gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint)
            Next
        Catch ex As ThreadAbortException
            '  blnquethrdaborted = True
        Catch ex As Exception

        Finally

            If IsNothing(ds) = False Then
                ds.Dispose()
                ds = Nothing
            End If

            If (Not IsNothing(objdt)) Then
                objdt.Dispose()
                objdt = Nothing
            End If
            'If (Not objcon Is Nothing) Then
            '    objcon.Dispose()
            '    objcon = Nothing
            'End If
            If (CheckQueueCount(True) > 0) Then
                thrdQueue = Nothing
                thrdQueue = New Threading.Thread(New Threading.ThreadStart(AddressOf processQueuedataForPrint))
                thrdQueue.IsBackground = True
                thrdQueue.Start()
            Else

                thrdQueue = Nothing
            End If

        End Try
    End Sub

    Private Sub GenerateMetaDataFile(ByVal ds As DataSet, ByRef notestype As Integer, Optional ByVal isForPrint As Boolean = False, Optional ByVal popUpDetails As gloClinicalQueueGeneral.QueueDocumentDocumentDetails = Nothing)

        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PrintDocument, gloAuditTrail.ActivityType.Print, "GenerateMetaDataFile 1", gloAuditTrail.ActivityOutCome.Success)

        Dim _QueueWriter As New gloClinicalQueueGeneral.gloQueueMetadatawriter()
        Dim QueueDoc As gloClinicalQueueGeneral.Queue = Nothing

        Try


            Dim strFilePath As String = GenerateClinicalChartFileName(ds, 0, True)

            If IsNothing(strClinicalChartErrorNotes) = True Then
                strClinicalChartErrorNotes = New StringBuilder
            End If

            _QueueWriter.bIsForPrint = isForPrint
            QueueDoc = _QueueWriter.GenerateQueueMetaDataFile(ds, popUpDetails)
            If Convert.ToString(_QueueWriter.strErroMsg) <> "" Then
                gloAuditTrail.gloAuditTrail.ExceptionLog(Convert.ToString(_QueueWriter.strErroMsg), False)
            End If

            Try
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PrintDocument, gloAuditTrail.ActivityType.Print, "GenerateMetaDataFile 2", gloAuditTrail.ActivityOutCome.Success)
                If Not gloGlobal.gloTSPrint.UseZippedMetadata Then
                    gloQueueSchema.gloSerialization.SetClinicalDocument(strFilePath, QueueDoc, bUseFileZip:=False)
                End If



                If isForPrint = True Then
                    Dim First As Boolean = True
                    Dim pdfName As String = ""
                    Dim dt As DataTable = ds.Tables("ClinicalChartQueueDetails")
                    For i As Integer = 0 To dt.Rows.Count - 1
                        Dim PhyFileName As Object = dt.Rows(i)("PhysicalFileName")
                        pdfName = Convert.ToString(PhyFileName)
                        If IsDBNull(PhyFileName) OrElse pdfName.Trim() = "" Then
                            Continue For
                        End If

                        gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PrintDocument, gloAuditTrail.ActivityType.Print, "GenerateMetaDataFile 3", gloAuditTrail.ActivityOutCome.Success)

                        gloGlobal.gloTSPrint.CopyFileToNetworkShare(gloSettings.FolderSettings.AppTempFolderPath & "\" & pdfName, gloGlobal.gloTSPrint.AppFolderPath + "\" + pdfName)
                        If First = True Then
                            If Not gloGlobal.gloTSPrint.UseZippedMetadata Then
                                gloGlobal.gloTSPrint.CopyFileToNetworkShare(strFilePath, gloGlobal.gloTSPrint.AppFolderPath + "\" + strFilePath.Substring(strFilePath.LastIndexOf("\") + 1))
                            Else
                                strFilePath = Path.Combine(gloGlobal.gloTSPrint.AppFolderPath, Path.GetFileNameWithoutExtension(strFilePath) + ".xmz")
                                gloQueueSchema.gloSerialization.SetClinicalDocument(strFilePath, QueueDoc, bUseFileZip:=True)
                            End If


                            First = False


                        End If
                    Next
                End If


            Catch ex As Exception
                notestype = 5
                strClinicalChartErrorNotes.Append("Metadata file")

            End Try
        Catch ex As Exception
            notestype = 5
            strClinicalChartErrorNotes.Append("Metadata file")

        Finally
            If Not IsNothing(_QueueWriter) Then
                _QueueWriter.Dispose()
                _QueueWriter = Nothing
            End If
            If Not IsNothing(QueueDoc) Then
                QueueDoc = Nothing
            End If
        End Try


    End Sub
    Private Function CheckQueueCount(Optional ByVal isForPrint As Boolean = False) As Integer
        Dim objcon As New SqlConnection(gloGlobal.gloPMGlobal.DatabaseConnectionString)
        Dim strCmd As String
        Dim sqlCmd As SqlCommand
        If isForPrint = True Then
            strCmd = "gsp_GetClinicChartQueueCount_ForPrint"
            sqlCmd = New SqlCommand(strCmd, objcon)
        Else
            strCmd = "gsp_GetClinicChartQueueCount"
            sqlCmd = New SqlCommand(strCmd, objcon)
        End If

        ''''' Dim sqlcmd As New SqlCommand(strCmd, objcon)
        Try

            If (objcon.State = ConnectionState.Closed) Then
                objcon.Open()
            End If
            Dim reccnt As Integer = 0
            sqlcmd.CommandType = CommandType.StoredProcedure
            reccnt = Convert.ToInt64(sqlcmd.ExecuteScalar())
            Return reccnt
        Catch ex As Exception
            Return 0
        Finally
            If Not IsNothing(sqlcmd) Then
                sqlcmd.Dispose()
                sqlcmd = Nothing
            End If
            If Not IsNothing(objcon) Then
                If (objcon.State = ConnectionState.Open) Then
                    objcon.Close()
                End If
                objcon.Dispose()
                objcon = Nothing
            End If

        End Try
    End Function
    Private Function PendingMessageQueue() As Boolean
        If (thrdQueue Is Nothing) Then
            Return False
        Else
            MessageBox.Show("Background file generation from 'Clinical Chart' is in progress. You cannot logout until this process is completed. Please try after some time", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            Return True
        End If

    End Function

    Dim oChart As gloUIControlLibrary.WPFForms.frmClinicalChartQueue = Nothing
    Private Sub OpenClinicalChartPrintQueue()
        If oChart IsNot Nothing Then
            oChart = Nothing
        End If
        oChart = New gloUIControlLibrary.WPFForms.frmClinicalChartQueue(gloGlobal.gloPMGlobal.DatabaseConnectionString)
        Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(oChart)
        _interophelper.Owner = Me.Handle
        'oChart.ResizeMode = Windows.ResizeMode.NoResize
        AddHandler oChart.View_Click, AddressOf ClinicalChartPrintQueue
        AddHandler oChart.EvnMsgQueue, AddressOf EnableThreadQueue
        oChart.Height = Me.Height - 15
        oChart.Width = Me.Width - 32
        oChart.Activate()
        oChart.BringIntoView()
        oChart.Focus()
        oChart.ShowDialog()
        If oChart.isClosed = True Then
            oChart = Nothing
        End If
    End Sub
    Private Sub mnu_ClinicalChartPrintQueue_Click(sender As System.Object, e As System.EventArgs) Handles mnu_ClinicalChartPrintQueue.Click

        'ExportClinicalChartsToFolder(173533562002973352)

        'Dim oChart As gloUIControlLibrary.WPFForms.frmClinicalChartQueue = Nothing
        Try
            'oChart = gloUIControlLibrary.WPFForms.frmClinicalChartQueue.CheckInstance()
            'If IsNothing(oChart) Then
            'oChart = gloUIControlLibrary.WPFForms.frmClinicalChartQueue.GetClinicalChartQueueInstance(gloGlobal.gloPMGlobal.DatabaseConnectionString)
            If oChart Is Nothing Then
                OpenClinicalChartPrintQueue()
            Else
                If oChart.isClosed = True Then
                    OpenClinicalChartPrintQueue()
                Else
                    Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(oChart)
                    _interophelper.Owner = Me.Handle
                    oChart.Activate()
                    oChart.BringIntoView()
                End If

            End If



            'Else
            '    oChart.ResizeMode = Windows.ResizeMode.NoResize
            '    Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(oChart)
            '    _interophelper.Owner = Me.Handle
            'End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
            MessageBox.Show(Me, ex.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
            'Finally
            '    oChart = Nothing
        End Try

    End Sub

    Private Sub mnu_SocPsycBehobs_Click(sender As System.Object, e As System.EventArgs) Handles mnu_SocPsycBehobs.Click
        'Dim oSBPform As System.Windows.Forms.Form
        'Dim oSBPform As frmSocialPsychologicalBehaviorData()
        Try




            Dim sConnectionString As String = GetConnectionString()
            Dim oSBPform As New frmSocialPsychologicalBehaviorData(gnPatientID, gnVisitID, sConnectionString)


            oSBPform.MdiParent = Me
            oSBPform.WindowState = FormWindowState.Maximized
            oSBPform.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            'oSBPform.ShowDialog()
            'oSBPform.Dispose()
            'oSBPform = Nothing

            'oSBPform = New System.Windows.Forms.Form
            'If Not IsNothing(oSBPform) Then
            'Dim sConnectionString As String = GetConnectionString()


            'oSBPform = New gloGlobal.Common.frmDynamicHTMLForm()

            'gloGlobal.Common.DynamicFormData.AppConnectionString = sConnectionString
            'gloGlobal.Common.DynamicFormData.nPatientId = gnPatientID
            'gloGlobal.Common.DynamicFormData.nVisitId = gnVisitID
            'gloGlobal.Common.DynamicFormData.nPatientProviderId = gnPatientProviderID
            'gloGlobal.Common.DynamicFormData.nLoginsessionId = gintLoginSessionID
            'gloGlobal.Common.DynamicFormData.PatientProviderName = gstrPatientProviderName
            'oSBPform.Text = "Patient Social Psychological Behavioral observations"

            'oSBPform.ShowDialog()
            'oSBPform.Dispose()
            'oSBPform = Nothing
            'End If








        Catch ex As Exception
            'If Not IsNothing(oSBPform) Then
            '    oSBPform.Dispose()
            '    oSBPform = Nothing
            'End If
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
            MessageBox.Show(Me, ex.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
        Finally
            'If Not IsNothing(oSBPform) Then
            '    oSBPform.Dispose()
            '    oSBPform = Nothing
            'End If
        End Try
    End Sub

    'Private Sub CloseWindowEvent(sender As System.Object, e As System.EventArgs)
    '    CloseWindowTimer.Enabled = False
    '    CloseWindow("gloEMR")
    '    Debug.Write("Timer Fired")
    'End Sub

    Public Function UsersLatestTask(ByVal UserID As Long) As Long

        Dim oDB As New gloStream.gloDataBase.gloDataBase
        Dim PatientID As Long

        oDB.Connect(GetConnectionString)

        oDB.DBParameters.Add("@nUserId", UserID, ParameterDirection.Input, SqlDbType.BigInt)

        PatientID = Trim(oDB.ExecuteScaler("getUsersLatestTask"))
        oDB.Disconnect()
        oDB.Dispose()
        oDB = Nothing

        Return PatientID

    End Function

#End Region


#Region " Deasease Management "

    '''' DM/IM '''''
    Private Sub mnu_DM_Setup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_DM_Setup.Click
        Try
            Dim oDMModule As New frmDM_DiseaseView

            oDMModule.oMainForm = Me
            oDMModule.MdiParent = Me
            oDMModule.ShowInTaskbar = False
            oDMModule.WindowState = FormWindowState.Maximized
            oDMModule.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_DM_Duration_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim frm As New frmDM_GuidlineDuration
            With frm
                .ShowInTaskbar = False
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_DM_Association_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim frm As New frmDM_GuidlineAssociation
            With frm
                .ShowInTaskbar = False
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_DM_Rpt_DueGuideline_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_DM_Rpt_DueGuideline.Click
        Try
            Dim frm As New frmDM_VWrptDueGuidelines
            With frm
                .ShowInTaskbar = False
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_IM_Setup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_IM_Setup.Click
        Try
            Dim oIMSetup As New frmIM_View


            With oIMSetup
                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuProblemList_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuProblemList.Click
        ''Bug #78099: 00000828: Record locking.
        Try
            Dim blnRecordLock As Boolean = False
            If gblnRecordLocking = True Then
                Dim mydt As mytable ''slr new not needed 
                ' mydt = New mytable  twice slr
                mydt = Scan_n_Lock_Transaction(TrnType.ProblemList, gnPatientID, 0, Now)
                If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                    If MessageBox.Show("This patients problem lists are being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot Modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                        blnRecordLock = True
                    Else
                        Exit Sub
                    End If
                End If
            End If

            Dim frm As New frmProblemList(0, GenerateVisitID(Now.Date, gnPatientID), gnPatientID, blnRecordLock)
            frm.ShowMessageForPendingReconciliation()

            frm.MdiParent = Me
            ''Sanjog Added on 2011 feb 28 to visible the Exam button in Problem list form
            frmProblemList.blnRxMedFromExam = False
            frmProblemList.blnOpenFromExam = False
            ''Sanjog Added on 2011 feb 28 to visible the Exam button in Problem list form
            frm.WindowState = FormWindowState.Maximized

            frm.Show()

            ShowHideMainMenu(False, False)


        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

        End Try

    End Sub

    Private Sub mnu_IM_Transaction_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_IM_Transaction.Click
        Try
            If gnPatientID <= 0 Then
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                ''DB If dgPatient.VisibleRowCount > 0 Then
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                Exit Sub
                Exit Sub
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Dim oIMTran As New frmIMTransactionList(gnPatientID)

            With oIMTran

                'end
                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPatient_FindHealthPlan_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatient_FindHealthPlan.Click
        Try
            If gnPatientID <= 0 Then
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank

                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                Exit Sub
                Exit Sub
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Try
                FindHealthPlan()
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK)
            End Try

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub FindHealthPlan()
        Try
            If gnPatientID <= 0 Then
                Exit Sub
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Try
                Dim _toSendPatLst As New Collection
                _toSendPatLst.Add(gnPatientID)
                Dim frmTemplate As New frmDM_PatientSpecific(_toSendPatLst, True, gnVisitID)

                With frmTemplate
                    .MdiParent = Me
                    .ShowInTaskbar = False
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                End With
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK)
            End Try

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_ViewRecommendation_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_ViewRecommendation.Click
        Try
            If gnPatientID <= 0 Then
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                Exit Sub
                Exit Sub
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Try
                ViewRecommendation()
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK)
            End Try

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ViewRecommendation()
        Try
            If gnPatientID <= 0 Then
                Exit Sub
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Try
                Dim _toSendPatLst As New Collection
                _toSendPatLst.Add(gnPatientID)
                Dim frmTemplate As New frmDM_DisplayRecommendations(_toSendPatLst, True, gnVisitID)

                With frmTemplate
                    .MdiParent = Me
                    .ShowInTaskbar = False
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                End With

                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.ViewRecommendationRule, gloAuditTrail.ActivityCategory.ViewRecommendationRule, gloAuditTrail.ActivityType.View, "View Recommendation Opened", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK)

                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.ViewRecommendationRule, gloAuditTrail.ActivityCategory.ViewRecommendationRule, gloAuditTrail.ActivityType.View, "unsuccessfully View Recommendation Opened", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Failure, gloAuditTrail.SoftwareComponent.gloEMR)

            End Try

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub



    Public Sub Fill_DMCriteriaMenu()
        Dim oCriteriaMenu As ToolStripMenuItem
        Dim oCriterias As gloStream.DiseaseManagement.Supporting.ItemDetails
        Dim oDM As New gloStream.DiseaseManagement.DiseaseManagement

        oCriterias = oDM.GetCriteraList()
        If (IsNothing(oCriterias) = False) Then


            If oCriterias.Count > 0 Then
                mnuRpt_HealthPlan.DropDownItems.Clear()

                If _blnDMHealthPlansForCriteria = True Then
                    For i As Int16 = 1 To oCriterias.Count
                        With mnuRpt_HealthPlan
                            oCriteriaMenu = New ToolStripMenuItem
                            oCriteriaMenu.Text = oCriterias(i).Description
                            AddHandler oCriteriaMenu.Click, AddressOf CriteriaMenuClick
                            .DropDownItems.Add(oCriteriaMenu)
                            oCriteriaMenu = Nothing
                        End With
                    Next
                End If
            End If
            oCriterias.Dispose()
            oCriterias = Nothing
        End If
        oDM.Dispose()
        oDM = Nothing
    End Sub

    Private Sub CriteriaMenuClick(ByVal sender As Object, ByVal e As EventArgs)
        Try
            If IsFindCriteriaInProcess = False Then
                Dim oCurrentMenu As ToolStripMenuItem = CType(sender, ToolStripMenuItem)
                _FindCriteriaName = oCurrentMenu.Text
                Dim myInvoker1 As New MethodInvoker(AddressOf PopUpMessage)
                myInvoker1.Invoke()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK)
        End Try
    End Sub

    Private Sub PopUpMessage()
        Dim frm As New frmDM_Process
        frm.Show()
        System.Windows.Forms.Application.DoEvents()
        FindCriteria()
        System.Windows.Forms.Application.DoEvents()
        IsFindCriteriaInProcess = False
        _FindCriteriaName = ""
        frm.Close()
    End Sub

    Private Sub FindCriteria()
        'oDMSetup delete data of selected criteria
        Dim _strFind As String = ""
        If _FindCriteriaName.Trim <> "" Then
            _FindCriteriaID = GetCriteriaID(_FindCriteriaName)
            If _FindCriteriaID > 0 Then
                System.Windows.Forms.Application.DoEvents()
                '_oPatients = oDMProcess.FindGuidelinesForMultiplePatient(_FindCriteriaID)
                System.Windows.Forms.Application.DoEvents()
            End If
        End If
    End Sub

    Private Function GetCriteriaID(ByVal oCriteriaName As String) As Long
        Dim _strSQL As String = ""
        Dim _Result As String = ""
        Dim oDB As New gloStream.gloDataBase.gloDataBase

        If Not oCriteriaName = "" Then
            'Criteria Master Record
            _strSQL = "SELECT dm_mst_Id FROM DM_Criteria_MST WHERE dm_mst_CriteriaName = '" & oCriteriaName & "' AND dm_mst_CriteriaName IS NOT NULL"
            oDB.Connect(GetConnectionString)
            _Result = oDB.ExecuteQueryScaler(_strSQL)
            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing
            If Val(_Result) <> 0 Then
                Return CLng(_Result)
            Else
                Return 0
            End If
        End If
        Return Nothing
    End Function

    Private Sub mnuHealthPlan_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuRpt_HealthPlan.Click
        Try
            Dim frm As New frmDM_VWrptDueGuidelines
            With frm
                .ShowInTaskbar = False
                .MdiParent = Me

                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuRpt_OpenRecommendations_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuRpt_OpenRecommendations.Click
        Try
            Dim frm As New frmDM_OpenRecommendations

            With frm

                .ShowInTaskbar = False
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

            End With
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


#End Region

#Region " Navigator Events from Main Menu "


    ''Added by Sanjog on 05/06/2010 for DashBoards for pnlnavigation----- startCode
    'Sanjog Uncomment on 2011 March to handle the selected panel
    Private Sub pnlNavigator_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles pnlNavigator.Click
        Dim strFirstPannel As String = ""
        If IsNothing(pnlNavigator.GetPanelAt(CType(e, System.Windows.Forms.MouseEventArgs).X, CType(e, System.Windows.Forms.MouseEventArgs).Y)) = False Then
            If (pnlNavigator.GetPanelAt(CType(e, System.Windows.Forms.MouseEventArgs).X, CType(e, System.Windows.Forms.MouseEventArgs).Y).Name.ToUpper.Trim() = strPreviousSelectedPanel) Then
                IsFormLoading = True
                pnlNavigator.SelectedPanel = Nothing
                IsFormLoading = False
            End If
        End If
    End Sub

    Private Sub pnlNavigator_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles pnlNavigator.MouseDown

    End Sub

    Private Sub pnlNavigator_SelectedPanelChanged(ByVal sender As System.Object, ByVal e As Janus.Windows.UI.Dock.PanelActionEventArgs) Handles pnlNavigator.SelectedPanelChanged
        If IsFormLoading Then
            Exit Sub
        End If
        If (IsNothing(e)) Then
            Exit Sub
        End If
        strPreviousSelectedPanel = e.Panel.Name.Trim().ToUpper()
        If (isMessageTimerCallForPanelSelection) Then
            If e.Panel.Name.Trim().ToUpper() = "PNLNAV_APPOINTMENTs".Trim().ToUpper() Or e.Panel.Name.Trim().ToUpper() = "PNLNAV_TRIAGE".Trim().ToUpper() Then
            Else
                Exit Sub
            End If
        End If
        Try
            If PnlFlag = False Then
                If e.Panel.Name.Trim().ToUpper() = "PNLNAV_APPOINTMENTs".Trim().ToUpper() Then
                    pnlNav_Appointments_Click(sender, e)
                ElseIf e.Panel.Name.Trim().ToUpper() = "pnlNav_Calendar".Trim().ToUpper() Then
                    pnlNav_Calendar_Click(sender, e)
                ElseIf e.Panel.Name.Trim().ToUpper() = "PNLNAV_MYDAY".Trim().ToUpper() Then
                    pnlNav_Myday_Click(sender, e)
                ElseIf e.Panel.Name.Trim().ToUpper() = "PNLNAV_TRIAGE".Trim().ToUpper() Then
                    pnlNav_Triage_Click(sender, e)
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub pnlNav_Calendar_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pnlNav_Calendar.Click
        Try
            If PnlFlag = False Then
                ''refresh tasks on dashboard if any added from calendar 
                AddHandler oCalendar.Calendar_Closed, AddressOf HandleCalendarClosed
                oCalendar.gstrSQLServerName = gstrSQLServerName
                oCalendar.gstrDatabaseName = gstrDatabaseName
                oCalendar.gblnSQLAuthentication = gblnSQLAuthentication
                oCalendar.gstrSQLUser = gstrSQLUserEMR
                oCalendar.gstrSQLPassword = gstrSQLPasswordEMR
                oCalendar.gstrCaption = "gloEMR"
                oCalendar.ShowAppointmentView(False, Me)
                pnlMainToolBar.Visible = False

                ''commented for bugid 71569 to resolve refresh appointment panel on dashboard
                '' remove handler added on  HandleCalendarClosed function 
                ' RemoveHandler oCalendar.Calendar_Closed, AddressOf HandleCalendarClosed  ''slr remove handler 
                oCalendar.Dispose()
                ShowHideMainMenu(False, False)
            End If
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
        End Try
    End Sub

    Private Sub pnlNav_Mail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            ShowMails()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Dim blnTaskGroupHeaderClicked As Boolean = False
    Private Sub pnlNav_Tasks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pnlTasks.Click
        Try
            'Dim strPrevTaskGroup As String
            If PnlFlag = False Then
                'strPrevTaskGroup = cmbFilters.Text
                blnTaskGroupHeaderClicked = True
                ShowTasks()
                blnTaskGroupHeaderClicked = False
                '_flexGroup.Groups = strPrevTaskGroup
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub pnlNav_Appointments_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pnlNav_Appointments.Click
        Try
            If PnlFlag = False Then
                ShowAppointments()
                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen As No Activity Found for @" & gLockTime & "Minutes", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                gloAuditTrail.gloAuditTrail.UpdateLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.LockScreen, gloAuditTrail.ActivityType.Open, "Lock Screen As No Activity Found for @" & gLockTime & "Minutes", gloAuditTrail.ActivityOutCome.Success)
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Add, "Save_UserDisplaySettings -- " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub

    'Triage panel click event 
    Private Sub pnlNav_Triage_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pnlNav_Triage.Click
        Try
            If PnlFlag = False Then
                ShowTriage()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub pnlNav_Myday_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles pnlNav_Myday.Click
        Try
            If PnlFlag = False Then
                Dim frm As frmMyDay
                frm = frmMyDay.GetInstance()
                Try
                    RemoveHandler frm.FormClosed, AddressOf OnMyDay_Close
                Catch ex As Exception

                End Try
                'on Date 20100426 for refreshing dashboard tasks
                AddHandler frm.FormClosed, AddressOf OnMyDay_Close

                'Bug #82464: 00000909: Task screen not opening respective screen
                AddHandler frm.OnViewTask_Change, AddressOf HandlesTaskChange

                frm.MdiParent = Me
                frm.Show()
                frm.WindowState = FormWindowState.Maximized
                pnlMainToolBar.Visible = False
                ShowHideMainMenu(False, False)
            End If
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            ShowHideMainMenu(True, True)
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
        End Try
    End Sub

    Private Sub OnMyDay_Close(ByVal sender As Object, ByVal e As FormClosedEventArgs)

        Dim frm As frmMyDay = Nothing

        Try
            frm = DirectCast(sender, frmMyDay)
        Catch ex As Exception

        End Try
        Try
            If (IsNothing(frm) = False) Then
                RemoveHandler frm.FormClosed, AddressOf OnMyDay_Close
                'Bug #82464: 00000909: Task screen not opening respective screen
                RemoveHandler frm.OnViewTask_Change, AddressOf HandlesTaskChange
            End If
            If (IsNothing(frm) = False) Then
                frm.Close()
            End If
            If (IsNothing(frm) = False) Then
                frm.Dispose()
                frm = Nothing
            End If

        Catch ex As Exception

        End Try


        ShowTasks()
    End Sub

    Private Sub pnlNav_Alerts_Click(ByVal sender As Object, ByVal e As System.EventArgs)
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            ShowCopayAlert()
            ShowUnappliedCopayAlert()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'refresh tasks on dashboard if any added from calendar 
    Private Sub HandleCalendarClosed(ByVal sender As Object, ByVal e As System.EventArgs)
        If IsAccess(True) = False Then
            Exit Sub
        End If
        ShowTasks()
        ShowCheckInStatus()
        ShowPatientStatus()
        If (SelectedPatientDetail = PatientDetails.PatientAppointments) Then
            Call Fill_Appointments()
        End If
        If IsNothing(pnlNavigator.SelectedPanel) = False Then
            If pnlNavigator.SelectedPanel.Text.ToUpper.Contains(NAV_APPOINTMENT) Then
                ShowAppointments()
            End If
        End If
        RemoveHandler oCalendar.Calendar_Closed, AddressOf HandleCalendarClosed
    End Sub

    Private Sub pnlMessages_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pnl_Messages.Click
        ShowMessages_New()
    End Sub

#End Region

#Region "View Triage"

    Public Sub ShowTriage()

        Dim dtTriage As New DataTable()
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParam As gloDatabaseLayer.DBParameters = Nothing

        Try

            ' Above Logic will store DueDates of all Task & Assigned Tasks.
            'Get the Patient Referrals.
            'C1Triage.Clear()
            C1Triage.DataSource = Nothing

            C1Triage.AllowResizing = C1.Win.C1FlexGrid.AllowResizingEnum.Columns
            C1Triage.Clear(C1.Win.C1FlexGrid.ClearFlags.All)
            'Set the column Names.                              
            C1Triage.Cols.Count = col_TriageCount
            C1Triage.Rows.Count = 1
            C1Triage.AllowEditing = False
            Dim csProvider As C1.Win.C1FlexGrid.CellStyle
            Try
                If (C1Triage.Styles.Contains("cs_Parent")) Then
                    csProvider = C1Triage.Styles("cs_Parent")
                Else
                    csProvider = C1Triage.Styles.Add("cs_Parent") ''style new for every row
                    csProvider.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    csProvider.BackColor = Color.FromArgb(222, 231, 250)
                    csProvider.ForeColor = Color.FromArgb(21, 66, 139)
                    csProvider.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csProvider.ImageSpacing = 2
                    csProvider.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                    csProvider.Border.Color = Color.FromArgb(159, 181, 221)
                End If
            Catch ex As Exception
                csProvider = C1Triage.Styles.Add("cs_Parent") ''style new for every row
                csProvider.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                csProvider.BackColor = Color.FromArgb(222, 231, 250)
                csProvider.ForeColor = Color.FromArgb(21, 66, 139)
                csProvider.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                csProvider.ImageSpacing = 2
                csProvider.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                csProvider.Border.Color = Color.FromArgb(159, 181, 221)
            End Try
            Dim csAppointment As C1.Win.C1FlexGrid.CellStyle
            Try
                If (C1Triage.Styles.Contains("cs_Child")) Then
                    csAppointment = C1Triage.Styles("cs_Child")
                Else
                    csAppointment = C1Triage.Styles.Add("cs_Child") ''style new for every row
                    csAppointment.Font = gloGlobal.clsgloFont.gFont_SMALL 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    csAppointment.BackColor = Color.FromArgb(240, 247, 255)
                    csAppointment.ForeColor = Color.Black
                    csAppointment.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csAppointment.ImageSpacing = 2
                    csAppointment.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                End If
            Catch ex As Exception
                csAppointment = C1Triage.Styles.Add("cs_Child") ''style new for every row
                csAppointment.Font = gloGlobal.clsgloFont.gFont_SMALL 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                csAppointment.BackColor = Color.FromArgb(240, 247, 255)
                csAppointment.ForeColor = Color.Black
                csAppointment.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                csAppointment.ImageSpacing = 2
                csAppointment.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
            End Try

            Dim csAppointment1 As C1.Win.C1FlexGrid.CellStyle
            Try
                If (C1Triage.Styles.Contains("cs_Child_Bold")) Then
                    csAppointment1 = C1Triage.Styles("cs_Child_Bold")
                Else
                    csAppointment1 = C1Triage.Styles.Add("cs_Child_Bold") ''style new for every row
                    csAppointment1.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    csAppointment1.BackColor = Color.FromArgb(240, 247, 255)
                    csAppointment1.ForeColor = Color.Black
                    csAppointment1.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csAppointment1.ImageSpacing = 2
                    csAppointment1.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                End If
            Catch ex As Exception
                csAppointment1 = C1Triage.Styles.Add("cs_Child_Bold") ''style new for every row
                csAppointment1.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                csAppointment1.BackColor = Color.FromArgb(240, 247, 255)
                csAppointment1.ForeColor = Color.Black
                csAppointment1.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                csAppointment1.ImageSpacing = 2
                csAppointment1.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
            End Try




            C1Triage.Tree.Column = 2
            C1Triage.Tree.Style = C1.Win.C1FlexGrid.TreeStyleFlags.Simple
            C1Triage.Tree.Indent = 4
            C1Triage.Tree.LineColor = Color.Transparent

            C1Triage.SetData(0, col_TriageNo, "No.")
            C1Triage.SetData(0, col_TriageID, "Triage ID")
            C1Triage.SetData(0, col_TriagePatientName, "Patient")
            C1Triage.SetData(0, col_TriageDate, "Triage Date")
            C1Triage.SetData(0, col_TriagePatientID, "PatientID")
            C1Triage.SetData(0, col_TriageTemplateID, "Template ID")




            oDB.Connect(False)
            oParam = New gloDatabaseLayer.DBParameters
            oParam.Add("@UserID", gnLoginID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@blnfinished ", 0, ParameterDirection.Input, SqlDbType.Int)
            oDB.Retrive("TRI_ShowUserTriage", oParam, dtTriage)



            Dim i As Integer
            '  Dim oPatient As New gloPatient.gloPatient(GetConnectionString)  slr not used
            ' Dim oClsDashBoard As New clsDoctorsDashBoard     slr not used

            Dim strPatientname As String = "" '' This string contains Subject : Patient Name - triage name
            'Dim _PatientID As Int64
            'Dim _PatientName As String

            Dim ParentRowIndex As Int32 = 0

            If IsNothing(dtTriage) = False Then
                pnlNav_Triage.Text = "Triage [" & dtTriage.Rows.Count & "]"

                For i = 0 To dtTriage.Rows.Count - 1
                    If Convert.ToBoolean(dtTriage.Rows(i)("bIsFinished")) = False Then


                        Dim _TriageDate As DateTime = Convert.ToDateTime(dtTriage.Rows(i)("dtDate"))
                        Dim _TriageDateString As String = " Date : " + Format(_TriageDate, "MM/dd/yyyy")
                        Dim NodeFound As Boolean = False

                        ''To Search ParentNode for Task DueDate.
                        ParentRowIndex = 0 ''To start Search from Initial row.
                        For j As Int64 = 1 To C1Triage.Rows.Count - 1
                            If C1Triage.Rows(j).Node.Level = 0 Then
                                If Convert.ToBoolean(dtTriage.Rows(i)("bIsFinished")) = False Then
                                    If C1Triage.Rows(j).Node.Data = _TriageDateString Then
                                        ParentRowIndex = j
                                        NodeFound = True
                                        Exit For
                                    End If
                                End If
                            End If
                        Next


                        'Add Parent Node of Found Date. ''If Not Present.
                        If NodeFound = False Then
                            C1Triage.Rows.Add()
                            C1Triage.Rows(C1Triage.Rows.Count - 1).IsNode = True
                            C1Triage.Rows(C1Triage.Rows.Count - 1).ImageAndText = True
                            'C1Triage.Rows(C1Triage.Rows.Count - 1).Node.Image = imgList_Common.Images(13)
                            C1Triage.Rows(C1Triage.Rows.Count - 1).Node.Level = 0
                            C1Triage.Rows(C1Triage.Rows.Count - 1).Node.Data = _TriageDateString '_DueDate.ToString() ' No
                            C1Triage.Rows(C1Triage.Rows.Count - 1).Node.Key = _TriageDate  '' Triage Date
                            C1Triage.Rows(C1Triage.Rows.Count - 1).Node.Row.Style = C1Triage.Styles("cs_Parent")
                            C1Triage.Rows(C1Triage.Rows.Count - 1).Height = 21
                            ParentRowIndex = C1Triage.Rows.Count - 1 ''This Will be Parent Row Index for next Child in this loop.
                        End If

                        ''Add Child Node for Respective Parent .. Parent Index Defined By Variable [ ParentRowIndex ]
                        Dim oChild As C1.Win.C1FlexGrid.Node
                        oChild = C1Triage.Rows(ParentRowIndex).Node.AddNode(C1.Win.C1FlexGrid.NodeTypeEnum.LastChild, "", _TriageDate, Nothing)
                        Dim ChildRowIndex As Int32 = oChild.Row.Index

                        C1Triage.Rows(ChildRowIndex).ImageAndText = True
                        C1Triage.Rows(ChildRowIndex).Node.Row.Style = C1Triage.Styles("cs_Child")

                        strPatientname = Convert.ToString(dtTriage.Rows(i)("sPatientCode")) + " : " + Convert.ToString(dtTriage.Rows(i)("sPatientName")) + " : " + Convert.ToString(dtTriage.Rows(i)("sTemplateName"))

                        C1Triage.SetData(ChildRowIndex, col_TriageNo, i)
                        C1Triage.SetData(ChildRowIndex, col_TriageID, CType(dtTriage.Rows(i)("nTriageID"), Int64)) '' Triage ID
                        C1Triage.SetData(ChildRowIndex, col_TriagePatientName, strPatientname) '' Patient Name 
                        C1Triage.SetData(ChildRowIndex, col_TriageDate, _TriageDate)
                        C1Triage.SetData(ChildRowIndex, col_TriagePatientID, CType(dtTriage.Rows(i)("nPatientID"), Int64))
                        C1Triage.SetData(ChildRowIndex, col_TriageTemplateID, CType(dtTriage.Rows(i)("nTemplateID"), Int64))

                    End If

                Next
            Else
                pnlNav_Triage.Text = "Triage [0]"
            End If

            C1Triage.Rows(0).Visible = False

            C1Triage.Cols(col_TriageNo).Visible = False
            C1Triage.Cols(col_TriageID).Visible = False
            C1Triage.Cols(col_TriageDate).Visible = False
            C1Triage.Cols(col_TriagePatientName).Visible = True
            C1Triage.Cols(col_TriagePatientID).Visible = False
            C1Triage.Cols(col_TriageTemplateID).Visible = False

            Dim _width As Integer = C1Triage.Width

            C1Triage.Cols(col_TriageDate).Width = 0 ''Triage Date
            C1Triage.Cols(col_TriageNo).Width = 0 ''Triage NO
            C1Triage.Cols(col_TriagePatientName).Width = Convert.ToInt32(_width - 18) ''Patient Name
            C1Triage.Cols(col_TriageID).Width = 0 ''Triage Id
            C1Triage.Cols(col_TriagePatientID).Width = 0 ''Patient Id
            C1Triage.Cols(col_TriageTemplateID).Width = 0 ''Template Id


            'code added by pradeep to show total of triages under one date (20100812)
            If IsNothing(dtTriage) = False Then
                For i = 0 To dtTriage.Rows.Count - 1
                    If Convert.ToBoolean(dtTriage.Rows(i)("bIsFinished")) = False Then
                        Dim _TriageDate As DateTime = Convert.ToDateTime(dtTriage.Rows(i)("dtDate"))
                        Dim _TriageDateString As String = " Date : " + Format(_TriageDate, "MM/dd/yyyy")
                        Dim NodeFound As Boolean = False

                        ''To Search ParentNode for Task DueDate.
                        ParentRowIndex = 0 ''To start Search from Initial row.
                        For j As Int64 = 1 To C1Triage.Rows.Count - 1
                            If C1Triage.Rows(j).Node.Level = 0 Then
                                If Convert.ToBoolean(dtTriage.Rows(i)("bIsFinished")) = False Then
                                    If C1Triage.Rows(j).Node.Data = _TriageDateString Then
                                        ParentRowIndex = j
                                        Dim cnt As Integer
                                        cnt = C1Triage.Rows(ParentRowIndex).Node.Children
                                        Dim _str As String
                                        _str = _TriageDateString & " [" & cnt & "]"
                                        C1Triage.SetData(ParentRowIndex, col_TriagePatientName, _str)
                                        Exit For
                                    End If
                                End If
                            End If
                        Next
                    End If
                Next
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            C1Triage.ScrollBars = ScrollBars.Both
            If Not IsNothing(dtTriage) Then
                dtTriage.Dispose()
                dtTriage = Nothing
            End If

            If Not IsNothing(oParam) Then
                oParam.Dispose()
                oParam = Nothing
            End If

            If Not IsNothing(oDB) Then
                oDB.Dispose()
                oDB = Nothing
            End If

        End Try
    End Sub

    Private Sub C1Triage_DoubleClick(ByVal sender As Object, ByVal e As System.EventArgs) Handles C1Triage.DoubleClick
        Try
            If (IsPatientGuidelineOrPatientEducationOpen("Triage") = True) Then
                Exit Sub
            End If

            If gnPatientID <= 0 Then
                Exit Sub
            End If

            If CheckWordForException() = False Then
                Exit Sub
            End If

            If C1Triage.Row > 0 Then
                'if it is child Node (triage Node)
                If C1Triage.Rows(C1Triage.Row).Node.Children = 0 Then
                    Dim TriageID As Int64 = 0
                    Dim TemplateID As Int64 = 0
                    If IsAccess(False, CType(C1Triage.GetData(C1Triage.Row, col_TriagePatientID), Int64)) = False Then
                        Exit Sub
                    Else
                        TriageID = CType(C1Triage.GetData(C1Triage.Row, col_TriageID), Int64)
                        TemplateID = CType(C1Triage.GetData(C1Triage.Row, col_TriageTemplateID), Int64)

                        Dim frm As frmTriage

                        frm = frmTriage.GetInstance(TriageID, CType(C1Triage.GetData(C1Triage.Row, col_TriagePatientID), Int64), 3, False, TemplateID) '' 3 for DashBoard ''
                        'AddHandler frm.EvntGenerateCDAFromTriage, AddressOf openCDA
                        If IsNothing(frm) = True Then
                            Exit Sub
                        End If
                        frmVWTriage.blnmodify = True
                        frm.MdiParent = Me
                        frm.myCallerMain = Me
                        frm.IsModify = True
                        frm.WindowState = FormWindowState.Maximized
                        frm.BringToFront()
                        frm.Show()

                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False

                        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Triage, gloAuditTrail.ActivityCategory.Triage, gloAuditTrail.ActivityType.View, "Triage viewed", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success)
                    End If
                End If
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub C1Triage_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1Triage.MouseDown
        If (pnlPatientList.Visible = False) Then
            'Try
            '    If (IsNothing(C1Triage.ContextMenuStrip) = False) Then
            '        C1Triage.ContextMenuStrip.Dispose()
            '        C1Triage.ContextMenuStrip = Nothing
            '    End If
            'Catch ex As Exception

            'End Try
            ClearContextMenuStrip(C1dgPatientDetails.ContextMenuStrip)
            ClearContextMenuStrip(C1Triage.ContextMenuStrip)
            ClearContextMenuStrip(cmnuPatientDetails)
            AssignContextMenuStrip(C1dgPatientDetails.ContextMenuStrip, cmnuPatientDetails)
            AssignContextMenuStrip(C1Triage.ContextMenuStrip, cmnuPatientDetails)
            ' C1Triage.ContextMenuStrip = Nothing
            Exit Sub
        End If
        Dim _SelRow As Integer = C1Triage.HitTest(e.X, e.Y).Row

        If _SelRow >= 1 Then
            If (CType(C1Triage.GetData(_SelRow, col_TriagePatientID), Int64) <> gnPatientID) Then
                If (pnlPatientList.Visible) Then
                    gnPatientID = CType(C1Triage.GetData(_SelRow, col_TriagePatientID), Int64)
                    Call SelectPatientOnDashboard(gnPatientID)
                End If
                If IsAccess(False, gnPatientID) = False Then
                    Exit Sub
                End If
            End If
        End If

        C1Triage.Row = _SelRow
        'Try
        '    If (IsNothing(C1Triage.ContextMenuStrip) = False) Then
        '        C1Triage.ContextMenuStrip.Dispose()
        '        C1Triage.ContextMenuStrip = Nothing
        '    End If
        'Catch ex As Exception

        'End Try
        'C1Triage.ContextMenuStrip = Nothing
        ClearContextMenuStrip(C1dgPatientDetails.ContextMenuStrip)
        ClearContextMenuStrip(C1Triage.ContextMenuStrip)
        ClearContextMenuStrip(cmnuPatientDetails)
        AssignContextMenuStrip(C1dgPatientDetails.ContextMenuStrip, cmnuPatientDetails)
        AssignContextMenuStrip(C1Triage.ContextMenuStrip, cmnuPatientDetails)

        If e.Button = Windows.Forms.MouseButtons.Right Then
            '           C1Triage.ContextMenuStrip = Nothing
            If gnPatientID <= 0 Then
                Exit Sub
            End If
            '            cmnuPatientDetails.Items.Clear()
            Dim oMenuItem As New ToolStripMenuItem
            oMenuItem.Text = "Add Triage"
            oMenuItem.Tag = "Add Triage"
            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
            oMenuItem.Image = Imgts_PatientDetails.Images(31)
            cmnuPatientDetails.Items.Add(oMenuItem)
            AddHandler oMenuItem.Click, AddressOf On_AddNewTriage_Click
            '          C1Triage.ContextMenuStrip = cmnuPatientDetails
        End If

    End Sub

    '' SUDHIR 20090713 ''
    Private Sub On_AddNewTriage_Click(ByVal sender As Object, ByVal e As EventArgs)
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            'CHECK PROVIDER
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = True Then
                    CType(Me.ParentForm, MainMenu).oPatientListControl.FillPatients()
                End If
            End If

            Dim oTriage As New gloStream.gloEMR.Triage.clsTriage
            Dim dtTemplate As DataTable
            dtTemplate = oTriage.FillTemplates()
            If (IsNothing(dtTemplate) = False) Then


                If dtTemplate.Rows.Count <= 0 Then
                    MessageBox.Show("No Template is associated for Triage. Please associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    dtTemplate.Dispose()
                    dtTemplate = Nothing

                    Exit Sub
                End If
                dtTemplate.Dispose()
                dtTemplate = Nothing
            Else
                MessageBox.Show("No Template is associated for Triage. Please associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub
            End If

            Dim frm As frmTriage

            frm = frmTriage.GetInstance(0, gnPatientID, 3)
            'AddHandler frm.EvntGenerateCDAFromTriage, AddressOf openCDA
            If IsNothing(frm) = True Then
                Exit Sub
            End If
            frmVWTriage.blnmodify = False

            frm.MdiParent = Me
            frm.myCallerMain = Me
            frm.WindowState = FormWindowState.Maximized
            frm.BringToFront()
            frm.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False


        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub pnlNav_TriageContainer_Resize(ByVal sender As Object, ByVal e As System.EventArgs) Handles pnlNav_TriageContainer.Resize
        Try
            If C1Triage.Cols.Count > 0 Then
                C1Triage.Dock = DockStyle.Fill
                Dim _width As Integer = pnlNav_TriageContainer.Width - 2
                C1Triage.Cols(col_TriagePatientName).Width = Convert.ToInt32(_width - 18)
            End If

        Catch ex As Exception
        End Try
    End Sub

#End Region

#Region "View Tasks"
    Public Sub ofrmViewgloLab_FormClosed(sender As Object, e As FormClosedEventArgs)
        Dim ofrmViewgloLab As gloEmdeonInterface.Forms.frmViewgloLab = Nothing
        Try
            ofrmViewgloLab = DirectCast(sender, gloEmdeonInterface.Forms.frmViewgloLab)
        Catch ex As Exception

        End Try

        Try
            If (IsNothing(ofrmViewgloLab) = False) Then
                RemoveHandler ofrmViewgloLab.EntOpenMessage, AddressOf OpenMessage
                RemoveHandler ofrmViewgloLab.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                RemoveHandler ofrmViewgloLab.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                RemoveHandler ofrmViewgloLab.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                RemoveHandler ofrmViewgloLab.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                'Sanjog - Commented bcoz this functionality is not complete yet (lab PRD)
                RemoveHandler ofrmViewgloLab.EvntGenerateCCDHandler, AddressOf openCCD
                ''pradeep 20100809 - To refresh TaskList on close of frmViewgloLab
                RemoveHandler ofrmViewgloLab.FormClosed, AddressOf ofrmViewgloLab_FormClosed 'ShowTasks
                '' Returns the Existance of Form if any    
                RemoveHandler ofrmViewgloLab.Activated, AddressOf frmViewgloLab_Activated
                'AddHandler ofrmViewgloLab.Deactivate, AddressOf frmViewgloLab_Deactivate

                ''Incident #55971: 00017037:Patient Context issue
                ''Change patient from Lab not refresh provider combo box if open Dashboard as File>>Dashboard without closing lab main form.
                RemoveHandler ofrmViewgloLab.OnProviderChanged, AddressOf OnProviderChanged

                RemoveHandler ofrmViewgloLab.EntOpenEducation, AddressOf OpenEducation
                ''(nTemplateID,nPatientID As Int64, ByVal sTemplateName As String, ByVal oType As gloEMRGeneralLibrary.clsInfobutton.enumSource, ByVal OpenFor As String)

                RemoveHandler ofrmViewgloLab.EvntGenerateCDAHandler, AddressOf openCDA

            End If
        Catch ex As Exception

        End Try
        Try
            If IsNothing(ofrmViewgloLab.objgloLabProblemList) = False Then
                DirectCast(ofrmViewgloLab.objgloLabProblemList, clsPatientProblemList).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabCriteria) = False Then
                DirectCast(ofrmViewgloLab.objgloLabCriteria, DocCriteria).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabPatientMessages) = False Then
                DirectCast(ofrmViewgloLab.objgloLabPatientMessages, clsMessage).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabPatientLetters) = False Then
                DirectCast(ofrmViewgloLab.objgloLabPatientLetters, clsPatientLetters).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabNurseNotes) = False Then

                DirectCast(ofrmViewgloLab.objgloLabNurseNotes, clsNurseNotes).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabHistory) = False Then

                DirectCast(ofrmViewgloLab.objgloLabHistory, clsPatientHistory).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabLabs) = False Then

                DirectCast(ofrmViewgloLab.objgloLabLabs, clsLabs).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabDMS) = False Then

                DirectCast(ofrmViewgloLab.objgloLabDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabRxmed) = False Then

                DirectCast(ofrmViewgloLab.objgloLabRxmed, clsPatientDetails).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabOrders) = False Then

                DirectCast(ofrmViewgloLab.objgloLabOrders, clsPatientDetails).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabCriteria) = False Then

                DirectCast(ofrmViewgloLab.objgloLabCriteria, DocCriteria).Dispose()
            End If
            If IsNothing(ofrmViewgloLab.objgloLabPatientExam) = False Then

                DirectCast(ofrmViewgloLab.objgloLabPatientExam, clsPatientExams).Dispose()
            End If
        Catch ex As Exception

        End Try
        Try
            If (IsNothing(ofrmViewgloLab) = False) Then
                ofrmViewgloLab.Close()
            End If

        Catch ex As Exception

        End Try
        Try
            If (IsNothing(ofrmViewgloLab) = False) Then
                ofrmViewgloLab.Dispose()
                ofrmViewgloLab = Nothing
            End If

        Catch ex As Exception

        End Try
        ShowTasks()
    End Sub
    Public Sub ofrmViewgloLab_openEducationFormClosed(sender As Object, e As FormClosedEventArgs)
        Dim frm As gloEmdeonInterface.Forms.frmViewgloLab = Nothing
        Try
            frm = DirectCast(sender, gloEmdeonInterface.Forms.frmViewgloLab)
        Catch ex As Exception

        End Try

        Try
            If (IsNothing(frm) = False) Then
                RemoveHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                RemoveHandler frm.EvntGenerateCCDHandler, AddressOf openCCD

                'Reason: To Open the Patient Letter & Referral Letter
                RemoveHandler frm.EntOpenMessage, AddressOf OpenMessage
                RemoveHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                RemoveHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                RemoveHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                RemoveHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                RemoveHandler frm.Activated, AddressOf frmViewgloLab_Activated
                RemoveHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                RemoveHandler frm.EntOpenEducation, AddressOf OpenEducation
                RemoveHandler frm.FormClosed, AddressOf ofrmViewgloLab_openEducationFormClosed

            End If
        Catch ex As Exception

        End Try
        Try
            If IsNothing(frm.objgloLabProblemList) = False Then
                DirectCast(frm.objgloLabProblemList, clsPatientProblemList).Dispose()
            End If
            If IsNothing(frm.objgloLabCriteria) = False Then
                DirectCast(frm.objgloLabCriteria, DocCriteria).Dispose()
            End If
            If IsNothing(frm.objgloLabPatientMessages) = False Then
                DirectCast(frm.objgloLabPatientMessages, clsMessage).Dispose()
            End If
            If IsNothing(frm.objgloLabPatientLetters) = False Then
                DirectCast(frm.objgloLabPatientLetters, clsPatientLetters).Dispose()
            End If
            If IsNothing(frm.objgloLabNurseNotes) = False Then

                DirectCast(frm.objgloLabNurseNotes, clsNurseNotes).Dispose()
            End If
            If IsNothing(frm.objgloLabHistory) = False Then

                DirectCast(frm.objgloLabHistory, clsPatientHistory).Dispose()
            End If
            If IsNothing(frm.objgloLabLabs) = False Then

                DirectCast(frm.objgloLabLabs, clsLabs).Dispose()
            End If
            If IsNothing(frm.objgloLabDMS) = False Then

                DirectCast(frm.objgloLabDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
            End If
            If IsNothing(frm.objgloLabRxmed) = False Then

                DirectCast(frm.objgloLabRxmed, clsPatientDetails).Dispose()
            End If
            If IsNothing(frm.objgloLabOrders) = False Then

                DirectCast(frm.objgloLabOrders, clsPatientDetails).Dispose()
            End If
            If IsNothing(frm.objgloLabCriteria) = False Then

                DirectCast(frm.objgloLabCriteria, DocCriteria).Dispose()
            End If
            If IsNothing(frm.objgloLabPatientExam) = False Then

                DirectCast(frm.objgloLabPatientExam, clsPatientExams).Dispose()
            End If
        Catch ex As Exception

        End Try
        Try
            If (IsNothing(frm) = False) Then
                frm.Close()
            End If

        Catch ex As Exception

        End Try
        Try
            If (IsNothing(frm) = False) Then
                frm.Dispose()
                frm = Nothing
            End If

        Catch ex As Exception

        End Try

    End Sub

    Public Sub DesignTaskGroup(ByVal PreviousGroup As String)

        If blnTaskGroupHeaderClicked = False Then
            LoadFlexGroupColumnDisplaySettings()
        End If
        RemoveHandler cmnuItem_TaskTake.Click, AddressOf cmnuItem_TaskTakeClicked
        RemoveHandler cmbFilters.SelectedIndexChanged, AddressOf cmbFilters_SelectedIndexChanged
        If blnIsTaskGroupSorted = False Then
            If PreviousGroup = "" Then
                If TaskGroupBeforeRightClick Then
                    _flexGroup.Groups = PreviousGroup
                    cmbFilters.Text = PreviousGroup
                Else
                    If blnIsGroupSetToBlankByUser Then
                        _flexGroup.Groups = PreviousGroup
                        cmbFilters.Text = PreviousGroup
                    Else
                        LoadTaskListGroupSetting()
                        _flexGroup.Groups = strTaskCustomGroup
                        cmbFilters.Text = strTaskCustomGroup
                    End If
                End If
            Else
                _flexGroup.Groups = PreviousGroup
                cmbFilters.Text = PreviousGroup
            End If
        End If
        AddHandler cmbFilters.SelectedIndexChanged, AddressOf cmbFilters_SelectedIndexChanged
        AddHandler cmnuItem_TaskTake.Click, AddressOf cmnuItem_TaskTakeClicked
    End Sub

    Public Sub SelectTaskOnFlexGroup(ByVal taskId As Long, ByVal rowSel As Int16)
        Dim myrow As C1.Win.C1FlexGrid.Row = (From column In _flexGroup.Grid.Rows Where column("TaskID") = Convert.ToString(taskId)).FirstOrDefault()
        If Not IsNothing(myrow) Then
            rowSel = myrow.Index
        End If

        If _flexGroup.Grid.Rows.Count > rowSel AndAlso rowSel > 0 Then
            If _flexGroup.Grid.Rows(rowSel).IsNode Then
                rowSel = rowSel + 1
            End If
            ''Bug #80258: 00000883 : Focus shifts to dashboard from scan docs
            If rowSel <> 1 Then
                _flexGroup.Grid.Select(rowSel, 0)
            End If
        Else
            ''Bug #80258: 00000883 : Focus shifts to dashboard from scan docs
            If _flexGroup.Grid.Rows.Count <> 2 Then
                If _flexGroup.Groups = "" Then
                    _flexGroup.Grid.Select(2, 0)
                Else
                    _flexGroup.Grid.Select(3, 0)
                End If

            End If
        End If

    End Sub
    Public Sub ShowTasksHanlder()
        Call ShowTasks()
    End Sub

    Public Sub ShowTasks(Optional ByVal CalledFrom As Int16 = 0, Optional ByVal SearchTextCleared As Boolean = False)

        Dim dtLocalTasks As DataTable = Nothing
        Dim oTasks As gloTaskMail.Tasks = Nothing ''slr new not needed 
        Dim ogloTasks As New gloTaskMail.gloTask(GetConnectionString)
        Dim rowSel As Integer
        Dim PreviousGroup As String = ""
        Dim blnTaskLoadedForSearch As Boolean = False
        Try
            If bnlIstaskOpened = False Then
                PreviousGroup = cmbFilters.Text

                Dim _taskId As Int64

                If _flexGroup.Grid.Row <> -1 Then
                    _taskId = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"), Int64)
                End If



                Dim intSearchCount As Long
                '15-Jan-14 Aniket: Resolving Bug #78531: Dashboard > Task Search > Clearing a task search loads all the tasks which takes time to load
                If txtTaskSearch.Text.Trim() = "" Then
                    If intTotalTaskCnt > 100 Then
                        intSearchCount = 100
                    Else
                        intSearchCount = intTotalTaskCnt
                    End If
                Else
                    intSearchCount = intTotalTaskCnt
                End If
                If Not IsNothing(_flexGroup.Grid.DataSource) Then
                    If txtTaskSearch.Text.Trim() <> "" Then
                        dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, intTotalTaskCnt, txtTaskSearch.Text.Trim())
                        blnTaskLoadedForSearch = True
                    Else
                        If CalledFrom = 1 Then
                            dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, DirectCast(_flexGroup.Grid.DataSource, System.Data.DataTable).Rows.Count + 100)
                        ElseIf CalledFrom = 2 Then
                            dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, intSearchCount)
                        Else
                            If Not IsNothing(dtTask) Then
                                If dtTask.Rows.Count > 0 Then
                                    If Convert.ToInt64(dtTask.Rows(0)("Total Count")) < 100 Then
                                        'Aniket: Resolving task refresh issue
                                        dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, 100) 'Convert.ToInt64(dtTask.Rows(0)("Total Count"))
                                    Else
                                        If dtTask.Rows.Count < Convert.ToInt64(dtTask.Rows(0)("Total Count")) Then
                                            dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, dtTask.Rows.Count)
                                        Else
                                            dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, 100)
                                        End If
                                    End If
                                Else
                                    dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, 100)
                                End If
                            End If
                            'dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, DirectCast(_flexGroup.Grid.DataSource, System.Data.DataTable).Rows.Count)
                        End If
                    End If
                Else
                    dtLocalTasks = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, 100)
                End If
                rowSel = _flexGroup.Grid.RowSel
                If Not IsNothing(dtLocalTasks) Then
                    If dtLocalTasks.Rows.Count > 0 Then
                        intTotalTaskCnt = Convert.ToInt64(dtLocalTasks.Rows(0)("Total Count"))
                    Else
                        If txtTaskSearch.Text.Trim() = "" Then
                            intTotalTaskCnt = 0
                        End If
                    End If
                End If

                ogloTasks.Dispose()
                ogloTasks = Nothing

                'Dim keys(0) As DataColumn
                'keys(0) = dtLocalTasks.Columns("TaskID")
                'dtLocalTasks.PrimaryKey = keys

                If IsNothing(dtTask) = True Then
                    dtTask = dtLocalTasks
                Else
                    dtTask.Clear()
                    dtTask.Merge(dtLocalTasks)
                End If


                If Not IsNothing(dtTask) Then
                    'If IsNothing(_flexGroup.Grid.DataSource) = False Then

                    If dtTask.Rows.Count > 0 Then
                        pnlTasks.Text = "Tasks [" + dtTask.Rows(0)("Total Count").ToString() + "]"
                        pnlViewMoreTask.Visible = True

                        If Convert.ToInt32(_flexGroup.Grid.Rows.Count - 2) < Convert.ToInt32(dtTask.Rows(0)("Total Count")) Then
                            If blnTaskLoadedForSearch Then
                                lblLinkViewMoreTask.Text = "Showing " + Convert.ToString(dtTask.Rows.Count) + " of " + Convert.ToString(dtTask.Rows(0)("Total Count")) + " Tasks"
                                blnTaskLoadedForSearch = False
                            Else
                                lblLinkViewMoreTask.Text = "Showing " + Convert.ToString(dtTask.Rows.Count) + " of " + Convert.ToString(dtTask.Rows(0)("Total Count")) + " Tasks. Click here to view more."
                            End If
                        Else

                            lblLinkViewMoreTask.Text = "Showing " + Convert.ToString(dtTask.Rows.Count) + " of " + Convert.ToString(dtTask.Rows(0)("Total Count")) + " Tasks"
                        End If
                    Else
                        pnlTasks.Text = "Tasks [0]"
                        pnlViewMoreTask.Visible = False
                    End If
                    'End If


                    If IsNothing(_flexGroup.Grid.DataSource) = True Then

                        If _flexGroup.Groups <> "" Then
                            _flexGroup.Groups = ""
                        End If
                        _flexGroup.Grid.DataSource = dtTask

                        If dtTask.Rows.Count > 0 Then
                            ' lblLinkViewMoreTask.Text = "Showing " + Convert.ToString(_flexGroup.Grid.Rows.Count - 2) + " of " + Convert.ToString(dtTask.Rows(0)("Total Count")) + " Tasks. Click here to view more."
                            intTotalTaskCnt = Convert.ToInt64(dtTask.Rows(0)("Total Count"))
                            _flexGroup.Grid.Cols("Due Date").AllowEditing = False
                            _flexGroup.Grid.Cols("Subject").AllowEditing = False
                            _flexGroup.Grid.Cols("TaskID").AllowEditing = False
                            _flexGroup.Grid.Cols("No.").AllowEditing = False
                            _flexGroup.Grid.Cols("Status").AllowEditing = False
                            _flexGroup.Grid.Cols("% Completed").AllowEditing = False
                            _flexGroup.Grid.Cols("Priority").AllowEditing = False
                            _flexGroup.Grid.Cols("TaskDate").AllowEditing = False
                            _flexGroup.Grid.Cols("PatientID").AllowEditing = False
                            _flexGroup.Grid.Cols("AssignStatus").AllowEditing = False
                            _flexGroup.Grid.Cols("PatientCode").AllowEditing = False
                            _flexGroup.Grid.Cols("Patient Name").AllowEditing = False
                            _flexGroup.Grid.Cols("nProviderID").AllowEditing = False
                            _flexGroup.Grid.Cols("nCategoryID").AllowEditing = False
                            _flexGroup.Grid.Cols("ProviderName").AllowEditing = False
                            _flexGroup.Grid.Cols("Total Count").AllowEditing = False
                            _flexGroup.Grid.Cols("TaskGroupID").AllowEditing = False
                            _flexGroup.Grid.Cols("SSN").AllowEditing = False
                            _flexGroup.Grid.Cols("Date Of Birth").AllowEditing = False
                            _flexGroup.Grid.Cols("Task Type").AllowEditing = False
                            _flexGroup.Grid.Cols("Resp").AllowEditing = False
                            _flexGroup.Grid.Cols("Resp").ImageAlign = ImageAlignEnum.CenterCenter
                        Else
                            pnlTasks.Text = "Tasks [0]"
                            pnlViewMoreTask.Visible = False
                        End If

                        DesignTaskGroup(PreviousGroup)

                    End If
                    _flexGroup.FilterRow = False
                End If

                SelectTaskOnFlexGroup(_taskId, rowSel)
                _flexGroup.setPriorityImage()

            End If

        Catch ex As Exception
            'MsgBox(ex.ToString)
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        Finally
            Me.Cursor = Cursors.Default
        End Try
    End Sub

    Private Sub Fill_Labs_1()
        Try

            C1dgPatientDetails.DataSource = Nothing
            C1dgPatientDetails.Clear()

            Dim dtPatientDetails As DataTable
            Dim objPatientDetail As New clsPatientDetails
            dtPatientDetails = objPatientDetail.Fill_PatientLabOrders(gnPatientID)

            C1dgPatientDetails.DataSource = dtPatientDetails

            dtPatientDetails.Columns.Add("Diagnosis", GetType(String))
            dtPatientDetails.Columns.Add("Treatment", GetType(String))
            dtPatientDetails.AcceptChanges()

            'Set the column Names.                              
            C1dgPatientDetails.Cols.Count = 7

            C1dgPatientDetails.AllowEditing = True
            'Incident 00005646 : System Hangs-up in exam opens from Dashboard PatientDetails Panel.
            'Following Property set to false to avoid two tooltips showing on grid.
            C1dgPatientDetails.ShowCellLabels = False
            Dim _width As Integer = pnlPatientDetail.Width

            C1dgPatientDetails.Cols(0).Width = _width * 0
            C1dgPatientDetails.Cols(1).Width = _width * 0
            C1dgPatientDetails.Cols(2).Width = _width * 0.11
            C1dgPatientDetails.Cols(3).Width = _width * 0.1
            C1dgPatientDetails.Cols(4).Width = _width * 0.15
            C1dgPatientDetails.Cols(5).Width = _width * 0.08
            C1dgPatientDetails.Cols(6).Width = _width * 0.08

            C1dgPatientDetails.Cols(0).AllowEditing = False
            C1dgPatientDetails.Cols(1).AllowEditing = False
            C1dgPatientDetails.Cols(2).AllowEditing = False
            C1dgPatientDetails.Cols(3).AllowEditing = False
            C1dgPatientDetails.Cols(4).AllowEditing = False
            C1dgPatientDetails.Cols(5).AllowEditing = True
            C1dgPatientDetails.Cols(6).AllowEditing = True

            Dim nOrderID As Long = 0
            Dim nTestId As Long = 0
            Dim strDiagnosis As String = ""
            Dim strTreatment As String = ""

            For k As Integer = 0 To dtPatientDetails.Rows.Count - 1
                nOrderID = dtPatientDetails.Rows(k)("OrderID")
                nTestId = dtPatientDetails.Rows(k)("TestID")

                'for Diagnosis
                strDiagnosis = GetDiagCPT(nOrderID, nTestId, 0)
                Dim cStyle As C1.Win.C1FlexGrid.CellStyle
                Try
                    If (C1dgPatientDetails.Styles.Contains("CS_Diagnosis" & k)) Then
                        cStyle = C1dgPatientDetails.Styles("CS_Diagnosis" & k)
                    Else
                        cStyle = C1dgPatientDetails.Styles.Add("CS_Diagnosis" & k) ''style new for every row

                    End If
                Catch ex As Exception
                    cStyle = C1dgPatientDetails.Styles.Add("CS_Diagnosis" & k) ''style new for every row

                End Try


                Dim rgDiag As C1.Win.C1FlexGrid.CellRange = C1dgPatientDetails.GetCellRange(k + 1, 5)

                C1dgPatientDetails.ShowButtons = ShowButtonsEnum.Always
                cStyle.ComboList = strDiagnosis
                rgDiag.Style = cStyle

                C1dgPatientDetails.SetCellStyle(k + 1, 5, cStyle)

                'for Treatment
                strTreatment = GetDiagCPT(nOrderID, nTestId, 1)
                Dim cStyle1 As C1.Win.C1FlexGrid.CellStyle
                Try
                    If (C1dgPatientDetails.Styles.Contains("CS_Treatment" & k)) Then
                        cStyle1 = C1dgPatientDetails.Styles("CS_Treatment" & k)
                    Else
                        cStyle1 = C1dgPatientDetails.Styles.Add("CS_Treatment" & k) ''style new for every row

                    End If
                Catch ex As Exception
                    cStyle1 = C1dgPatientDetails.Styles.Add("CS_Treatment" & k) ''style new for every row

                End Try


                Dim rgCPT As C1.Win.C1FlexGrid.CellRange = C1dgPatientDetails.GetCellRange(k + 1, 6)

                C1dgPatientDetails.ShowButtons = ShowButtonsEnum.Always
                cStyle1.ComboList = strTreatment
                rgCPT.Style = cStyle1

                C1dgPatientDetails.SetCellStyle(k + 1, 6, cStyle1)
            Next
            objPatientDetail.Dispose()
            objPatientDetail = Nothing
        Catch ex As Exception
            MessageBox.Show(ex.ToString, "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Function GetDiagCPT(ByVal nOrderID As Long, ByVal nTestId As Long, ByVal flag As Integer) As String
        Dim objPatientDetail As New clsPatientDetails
        Dim dtDiagCPT As DataTable ''slr new not needed 
        Dim strDiagCPT As String = ""

        Try
            If flag = 0 Then
                'diagnosis
                dtDiagCPT = objPatientDetail.Fill_TestDiagnosis(nOrderID, nTestId)
            Else
                'treatment
                dtDiagCPT = objPatientDetail.Fill_TestTreatments(nOrderID, nTestId)
            End If
            objPatientDetail.Dispose()
            objPatientDetail = Nothing
            If dtDiagCPT IsNot Nothing AndAlso dtDiagCPT.Rows.Count > 0 Then
                For k As Integer = 0 To dtDiagCPT.Rows.Count - 1
                    If k = 0 Then
                        strDiagCPT = Convert.ToString(dtDiagCPT.Rows(k)("DiagnosisCPT"))
                    Else
                        strDiagCPT += "|" & Convert.ToString(dtDiagCPT.Rows(k)("DiagnosisCPT"))
                    End If
                Next
            End If

            If Not IsNothing(dtDiagCPT) Then  ''slr dispose it
                dtDiagCPT.Dispose()
                dtDiagCPT = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        Return strDiagCPT
    End Function

    ' Change Task Priority
    Private Sub cmnuItem_Priority_Click(ByVal sender As Object, ByVal e As EventArgs)
        If IsAccess(True) = False Then
            Exit Sub
        End If

        Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        Try
            ' Dim TaskId As Int64 = Convert.ToInt64(C1UserTasks.GetData(C1UserTasks.Row, 1))
            Dim TaskId As Int64 = Convert.ToInt64(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, 1))
            Dim PriorityID As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
            If TaskId > 0 Then
                ogloTask.ModifyTaskPriority(TaskId, PriorityID)
                ShowTasks()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ogloTask.Dispose()
        End Try
    End Sub

    'Change Task Percentage Completed status
    Private Sub cmnuItem_TaskPercent_Click(ByVal sender As Object, ByVal e As EventArgs) Handles cmnuItem_75Percent.Click, cmnuItem_50Percent.Click, cmnuItem_25Percent.Click, cmnuItem_100Percent.Click, cmnuItem_0Percent.Click
        If IsAccess(True) = False Then
            Exit Sub
        End If

        Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        Try
            'Dim TaskId As Int64 = Convert.ToInt64(C1UserTasks.GetData(C1UserTasks.Row, Col_Task_TaskID))
            'Dim Percentage As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
            'Dim rowsel As Integer = 0
            'Dim rowcnt As Integer = 0
            'If TaskId > 0 Then
            '    If Percentage = 100 Then

            '        rowcnt = C1UserTasks.Rows.Count ''added for problem 00000315 to show selected 
            '        rowsel = C1UserTasks.RowSel
            '    End If
            '    ogloTask.ModifyTaskComplete(TaskId, Percentage)
            '    ShowTasks()
            '    If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
            '        Call Fill_PatientTasks(gnPatientID)
            '    End If
            '    If Percentage = 100 Then
            '        If rowcnt <> C1UserTasks.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
            '            rowsel -= 1
            '        End If

            '        If C1UserTasks.Rows.Count > rowsel Then ''added condition for problem 00000315 to show selected task v8020 
            '            C1UserTasks.Select(rowsel, 0)
            '        End If

            '    End If

            'End If

            Dim TaskId As Int64 = Convert.ToInt64(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"))
            Dim Percentage As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
            Dim rowsel As Integer = 0
            Dim rowcnt As Integer = 0
            If TaskId > 0 Then
                If Percentage = 100 Then

                    rowcnt = _flexGroup.Grid.Rows.Count ''added for problem 00000315 to show selected 
                    rowsel = _flexGroup.Grid.RowSel
                End If
                ogloTask.ModifyTaskComplete(TaskId, Percentage)
                ShowTasks()
                If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
                    Call Fill_PatientTasks(gnPatientID)
                End If
                If Percentage = 100 Then
                    'If rowcnt <> _flexGroup.Grid.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
                    '    rowsel -= 1
                    'End If

                    If _flexGroup.Grid.Rows.Count > rowsel AndAlso rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                        If _flexGroup.Grid.Rows(rowsel).IsNode Then
                            rowsel = rowsel + 1
                        End If
                        _flexGroup.Grid.Select(rowsel, 0)
                    Else
                        _flexGroup.Grid.Select(_flexGroup.Grid.Rows.Count - 1, 0)
                    End If

                End If

            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ogloTask.Dispose()
        End Try
    End Sub

    Private Sub C1UserTasks_AfterScroll(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.RangeEventArgs) Handles C1UserTasks.AfterScroll

        If (e.NewRange.BottomRow = C1UserTasks.Rows.Count - 1) AndAlso e.NewRange.BottomRow <> -1 AndAlso _isTasksFullyLoaded = False Then
            C1UserTasks.SuspendLayout()
            Dim _ScrollPosition As Point
            _ScrollPosition = C1Mesages.ScrollPosition
            nShowTaskRowCount = nShowTaskRowCount + nShowTaskRowCount
            ShowTasks()
            C1UserTasks.ResumeLayout()    'C1Mesages_AfterScroll(sender, e)
        End If
    End Sub

   
    'Resize C1FlexGrid 
    Private Sub c1UserTasks_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1UserTasks.MouseDown
        Try
            If (pnlPatientList.Visible = False) Then
                C1UserTasks.ContextMenuStrip = Nothing
                Exit Sub
            End If
            If objUserRights.Tasks = False Then
                C1UserTasks.ContextMenuStrip = Nothing
                Exit Sub
            End If
            cmunItem_Completed.Visible = False
            cmnuItem_Priority.Visible = False
            cmnuItem_TaskSeparator.Visible = False
            cmnuItem_CompleteTask.Visible = False
            cmnuItem_RejectTask.Visible = False
            cmnuItem_AcceptTask.Visible = False
            cmnuItem_CompleteAll.Visible = False
            cmnuItem_TaskTake.Visible = False
            If e.Button = MouseButtons.Right Then
                If C1UserTasks.HitTest(e.X, e.Y).Row >= 1 Then
                    C1UserTasks.Row = C1UserTasks.HitTest(e.X, e.Y).Row
                    C1UserTasks.ContextMenuStrip = cmnu_Tasks
                    If Not (IsNothing(C1UserTasks.Rows(C1UserTasks.Row)(Col_Task_TaskID))) Then
                        If C1UserTasks.Row < 0 Then
                            cmunItem_Completed.Visible = False
                            cmnuItem_Priority.Visible = False
                            cmnuItem_TaskSeparator.Visible = False
                            cmnuItem_CompleteTask.Visible = False
                            cmnuItem_CompleteAll.Visible = False
                            cmnuItem_TaskTake.Visible = False
                        End If
                    End If
                    If Not (IsNothing(C1UserTasks.Rows(C1UserTasks.Row)(Col_Task_TaskID))) Then
                        If C1UserTasks.Rows(C1UserTasks.Row)(Col_Task_Assigned) <> gnLoginID Then
                            cmnuItem_AcceptTask.Visible = True
                            cmnuItem_RejectTask.Visible = True
                            cmunItem_Completed.Visible = False
                            cmnuItem_CompleteTask.Visible = False
                            cmnuItem_CompleteAll.Visible = False
                        Else
                            cmnuItem_AcceptTask.Visible = False
                            cmnuItem_RejectTask.Visible = False

                            Dim objTask As gloTaskMail.Task = New gloTaskMail.Task()
                            Dim objgloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)

                            objTask = objgloTask.GetTask(C1UserTasks.GetData(C1UserTasks.Row, Col_Task_TaskID))
                            If objTask.TaskType = gloTaskMail.TaskType.UnmatchedPatient Then
                                cmunItem_Completed.Visible = False
                                cmnuItem_CompleteTask.Visible = False
                                cmnuItem_CompleteAll.Visible = False
                            Else
                                cmunItem_Completed.Visible = True
                                cmnuItem_CompleteTask.Visible = True
                                If _IsHasRighttoCompleteTaskforallUsers = True Then
                                    If C1UserTasks.GetData(C1UserTasks.Row, Col_Task_GroupID) <> 0 Then
                                        If objgloTask.IsMultipleUserTask(C1UserTasks.GetData(C1UserTasks.Row, Col_Task_GroupID)) = True Then
                                            cmnuItem_CompleteAll.Visible = True
                                        End If
                                    Else
                                        cmnuItem_CompleteAll.Visible = False
                                    End If
                                End If
                            End If

                            objTask.Dispose()
                            objTask = Nothing

                            objgloTask.Dispose()
                            objgloTask = Nothing

                        End If
                    End If
                Else
                    C1UserTasks.ContextMenuStrip = cmnu_Tasks
                    cmunItem_Completed.Visible = False
                    cmnuItem_Priority.Visible = False
                    cmnuItem_TaskSeparator.Visible = False
                    cmnuItem_AcceptTask.Visible = False

                End If
            End If

            If C1UserTasks.HitTest(e.X, e.Y).Row > 1 Then
                If ((C1UserTasks.Rows.Count >= 1) AndAlso C1UserTasks.Cols.Count >= 8) Then
                    If (CType(C1UserTasks.GetData(C1UserTasks.HitTest(e.X, e.Y).Row, 8), Int64) <> gnPatientID) AndAlso CType(C1UserTasks.GetData(C1UserTasks.HitTest(e.X, e.Y).Row, 8), Int64) > 0 Then
                        If (pnlPatientList.Visible) Then
                            gnPatientID = CType(C1UserTasks.GetData(C1UserTasks.HitTest(e.X, e.Y).Row, 8), Int64)
                            Call SelectPatientOnDashboard(gnPatientID)
                        End If
                        'ShowPatientAllDetails(gnPatientID)''COMMENT BY SUDHIR 20090418 '' AS THIS FUNCTION INVOKE IN ABOVE METHOD '' NO NEED TO CALL AGAIN
                    End If
                End If
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub pnlTasksContainer_Resize(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pnlTasksContainer.Resize

        Dim intColCount As Integer
        Dim _width As Integer = pnlTasksContainer.Width - 2

        Try

            intColCount = C1UserTasks.Cols.Count

            C1UserTasks.Dock = DockStyle.Fill


            If intColCount > Col_Task_Subject Then
                C1UserTasks.Cols(Col_Task_Subject).Width = Convert.ToInt32(_width - 36)
            End If


            If intColCount > Col_Task_Completed Then
                C1UserTasks.Cols(Col_Task_Completed).Width = Convert.ToInt32(0)
            End If

            If intColCount > Col_Task_Priority Then
                C1UserTasks.Cols(Col_Task_Priority).Width = Convert.ToInt32(20)
            End If



        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    'New Task
    Private Sub cmnuItem_NewTask_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmnuItem_NewTask.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Dim rowsel As Integer = 0
            Dim rowcnt As Integer = 0
            'rowcnt = C1UserTasks.Rows.Count ''added for problem 00000315 to show selected task v8020 
            'rowsel = C1UserTasks.RowSel

            rowcnt = _flexGroup.Grid.Rows.Count ''added for problem 00000315 to show selected task v8020 
            rowsel = _flexGroup.Grid.RowSel

            ofrmTask = New gloTaskMail.frmTask(GetConnectionString, 0)

            'Bug #82464: 00000909: Task screen not opening respective screen
            'AddHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange
            ofrmTask.Text = "Tasks"

            ofrmTask.PatientID = gnPatientID
            ofrmTask.ShowDialog(IIf(IsNothing(ofrmTask.Parent), Me, ofrmTask.Parent))
            HandlesTaskChange(Nothing, Nothing, ofrmTask.e2Task)
            ofrmTask.Dispose()
            ofrmTask = Nothing
            _objfrmtask = Nothing

            'If rowcnt <> C1UserTasks.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
            '    rowsel = 2
            'End If

            'If C1UserTasks.Rows.Count > rowsel Then ''added condition for problem 00000315 to show selected task v8020 
            '    C1UserTasks.Select(rowsel, 0)
            'End If

            If rowcnt <> _flexGroup.Grid.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
                rowsel = 2
            End If

            If _flexGroup.Grid.Rows.Count > rowsel AndAlso rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                If _flexGroup.Grid.Rows(rowsel).IsNode Then
                    rowsel = rowsel + 1
                End If
                _flexGroup.Grid.Select(rowsel, 0)
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Accept Assigned Task
    Private Sub cmnuItem_AcceptTask_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmnuItem_AcceptTask.Click

        If MessageBox.Show("Accept selected task request?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.No Then
            Exit Sub
        End If

        Dim rowsel As Integer
        Dim ogloTask As New gloTaskMail.gloTask(GetConnectionString)
        Dim tempTaskID As Int64
        Dim oTask As New gloTaskMail.Task
        Dim oTaskAssign As New gloTaskMail.TaskAssign

        Try

            TaskGroupBeforeRightClick = True
            tempTaskID = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"), Int64)
            oTask = ogloTask.GetTask(tempTaskID)
            'If the User Accepts the Task -New Entry for the Task is made against the user.
            'So we get the assigned Task first & then set its TaskID = 0,
            'also change the OwnerID to current userID & some other fields as done below

            Dim _nAssignFromId As Int64 = 0
            oTaskAssign = ogloTask.GetTaskAssign(tempTaskID, gnLoginID)
            If Not IsNothing(oTaskAssign) Then
                _nAssignFromId = oTaskAssign.AssignFromID
            End If

            If IsNothing(oTask) = False Then
                'Clear the previous assignments for this Task
                oTask.Assignment.Clear()
                oTask.TaskID = 0
                oTask.UserID = gnLoginID
                'Also set the Current User who is accepting this task
                'as the owner of the task.
                oTask.OwnerID = gnLoginID
                oTaskAssign.TaskID = 0
                oTaskAssign.AssignToID = gnLoginID
                oTaskAssign.AssignFromID = _nAssignFromId  ''Sandip Darade 20100503
                oTaskAssign.SelfAssigned = gloTasksMails.Common.SelfAssigned.Self
                oTaskAssign.AcceptRejectHold = gloTasksMails.Common.AcceptRejectHold.Accept
                oTask.Assignment.Add(oTaskAssign)
            End If

            ''New Entry for Task.
            Dim _result As Int64 = ogloTask.Add(oTask)

            ''To Tell Task Sender That Task Has Accepted.
            If _result > 0 Then
                If ogloTask.AcceptTask(tempTaskID, gnLoginID) Then

                    'Activate Reminder for this Task if reminder is present
                    Dim oReminder As New gloReminder.Reminder()
                    oReminder.ActivateTaskReminder(gnLoginID, tempTaskID, _result)
                    '-------------
                End If

                'Code commented for Bug #86221: Unmatched Patient task (Problem 00000942) : Updated patient details of task to previously opened Unmatched Patient Task 

                'changes : Update new task ID in glolab unmatched table for an Un match patient task
                'If oTask.TaskType = gloTaskMail.TaskType.UnmatchedPatient Then
                '    Try
                '        Dim oDB As New gloStream.gloDataBase.gloDataBase
                '        Dim query As String
                '        oDB.Connect(GetConnectionString)

                '        query = "UPDATE PatientsUnmatchedInLab set nTaskId=" & _result.ToString() & " where nTaskId= " & tempTaskID
                '        oDB.ExecuteNonSQLQuery(query)
                '        oDB.Disconnect()
                '        oDB.Dispose()
                '        oDB = Nothing
                '    Catch ex As Exception
                '        gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                '    End Try
                'End If
            Else
                MessageBox.Show("ERROR : Record not added. ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
                Return
            End If

            ShowTasks()

            Try

                Dim myrow As C1.Win.C1FlexGrid.Row = (From column In _flexGroup.Grid.Rows Where column("TaskID") = Convert.ToString(_result)).FirstOrDefault()

                If Not IsNothing(myrow) Then
                    rowsel = myrow.Index
                End If

                If _flexGroup.Grid.Rows.Count > rowsel AndAlso rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                    If _flexGroup.Grid.Rows(rowsel).IsNode Then
                        rowsel = rowsel + 1
                    End If
                    _flexGroup.Grid.Select(rowsel, 0)
                Else
                    _flexGroup.Grid.Select(_flexGroup.Grid.Rows.Count - 1, 0)
                End If

                If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
                    Call Fill_PatientTasks(gnPatientID)
                End If

                TaskGroupBeforeRightClick = False

            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
            End Try

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ogloTask = Nothing
            oTask = Nothing
            oTaskAssign = Nothing
        End Try

    End Sub

    'Modify Task
    Private Sub c1UserTasks_DoubleClick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles C1UserTasks.DoubleClick
        Try
            Dim rowsel As Integer = 0
            Dim rowcnt As Integer = 0
            rowcnt = C1UserTasks.Rows.Count ''added for problem 00000315 to show selected task v8020 
            If C1UserTasks.Row > 0 Then
                'if it is chield Node (Task Node)
                If Not (IsNothing(C1UserTasks.Rows(C1UserTasks.Row).Node)) Then
                    If C1UserTasks.Rows(C1UserTasks.Row).Node.Children = 0 Then
                        Dim _taskId As Int64 = 0
                        _taskId = CType(C1UserTasks.GetData(C1UserTasks.Row, Col_Task_TaskID), Int64)
                        If (_taskId = 0) Then
                            Exit Sub
                        End If
                        If IsAccess(False, CType(C1UserTasks.GetData(C1UserTasks.Row, 8), Int64)) = False Then
                            Exit Sub
                        Else
                            rowsel = C1UserTasks.RowSel
                            ofrmTask = New gloTaskMail.frmTask(GetConnectionString, _taskId)
                            AddHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange  ''added for taskincident to autoclose task window or not depend on setting 
                            ofrmTask.IsEMREnable = True
                            nTaskId = _taskId
                            ofrmTask.ShowDialog(IIf(IsNothing(ofrmTask.Parent), Me, ofrmTask.Parent))

                            RemoveHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange

                            ofrmTask.Dispose()
                            ofrmTask = Nothing
                            _objfrmtask = Nothing
                            ''Added by Abhijeet on 20111123 to auto complete of task after viewing it
                            Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
                            Dim oTask As New gloTaskMail.Task()
                            oTask = ogloTask.GetTask(_taskId)
                            If Not IsNothing(oTask) Then
                                If _taskId > 0 AndAlso oTask.Progress.Complete <> 100 AndAlso (oTask.TaskType = gloTaskMail.TaskType.HL7LabInboundFailureNotifyTask) Then
                                    ogloTask.CompleteAll(_taskId)
                                    ShowTasks() '' Refresh Task panel Data
                                ElseIf _taskId > 0 AndAlso oTask.Progress.Complete <> 100 AndAlso (oTask.TaskType = gloTaskMail.TaskType.PatientPortalTask) AndAlso gblnPatientPortalEnabled = True AndAlso gblnPatientPortalAutoCompleteTaskEnabled = True Then
                                    ogloTask.CompleteAll(_taskId)
                                    ShowTasks()
                                ElseIf _taskId > 0 AndAlso oTask.Progress.Complete <> 100 AndAlso (oTask.TaskType = gloTaskMail.TaskType.PatientPortalPatientFormTask) AndAlso gblnPatientPortalEnabled = True AndAlso gblnPatientPortalPFAutoCompleteTaskEnabled = True Then
                                    ogloTask.CompleteAll(_taskId)
                                    ShowTasks()
                                End If
                            End If

                            If Not IsNothing(oTask) Then
                                oTask.Dispose()
                                oTask = Nothing
                            End If
                            If Not IsNothing(ogloTask) Then
                                ogloTask.Dispose()
                                ogloTask = Nothing
                            End If
                            ''End of changes Added by Abhijeet on 20111123 to auto complete of task after viewing it
                        End If
                    End If
                End If
                If rowcnt <> C1UserTasks.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
                    rowsel -= 1
                End If

                If C1UserTasks.Rows.Count > rowsel Then ''added condition for problem 00000315 to show selected task v8020 
                    C1UserTasks.Select(rowsel, 0)
                End If

            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ShowPastExamFromTask(ByVal ExamID As Long, ByVal PatientId As Int64, ByVal VisitID As Long, ByVal DOS As String, ByVal ExamName As String, ByVal sTemplateName As String, ByVal blnFinished As Boolean, Optional ByVal PatientCode As String = "")
        Try
            If Trim(gstrPatientFirstName) <> "" Then

                If IsAccess(True) = False Then
                    Exit Sub
                End If

                If CheckWordForException() = False Then
                    Exit Sub
                End If

                If Not blnFinished Then
                    Dim objExam As New clsPatientExams
                    objExam.SetProviderExam(ExamID)
                    objExam.Dispose() ''slr dispose   
                    objExam = Nothing
                End If

                Me.Cursor = Cursors.WaitCursor
                ''Change gnPatientID(global) with PatientId(local) for perticular task.
                ''because patient strip shows the default patient selected on dashboard if we open exam from View->Task->Show exam for different user in follow-Up user's group.
                ''start
                'Dim frm As New frmPatientExam(gnPatientID, gnVisitID)
                Dim frm As New frmPatientExam(PatientId, gnVisitID)
                ''End
                AddHandler frm.FormClosed, AddressOf On_ExamClosed
                'AddHandler frm.EvntGenerateCDAFromPatientExam, AddressOf openCDA
                With frm
                    .Hide()
                    .blnModify = True
                    .Text = "Past Exams"
                    .WindowState = FormWindowState.Maximized
                    .MinimizeBox = False
                    '.MdiParent = Me    ''me.parent change to me bugid 106965
                    If (blntaskfrmopenfrmTaskgrd = True) Then
                        .MdiParent = Nothing  ''nothing set for incident CAS-17137-T5M3P4
                    Else
                        .MdiParent = Me
                    End If
                    blntaskfrmopenfrmTaskgrd = False
                    .pnlPastExamView.Visible = False
                    .pnlNewExam.Dock = DockStyle.Fill
                    .Splitter1.Visible = False
                    .Splitter3.Visible = False

                    ._blnIsOpenFromTask = True

                    Dim sender As Object = Nothing
                    Dim e As System.EventArgs = Nothing
                    ''Change gnPatientID(global) with PatientId(local) for perticular task.
                    ''because patient strip shows the default patient selected on dashboard if we open exam from View->Task->Show exam for different user in follow-Up user's group.
                    ''start
                    '.PatientID = gnPatientID
                    .PatientID = PatientId
                    ''End
                    If (.OpenPastExam(ExamID, VisitID, Convert.ToDateTime(DOS), ExamName.Trim, blnFinished, sTemplateName) = True) Then
                        'Bug #48129: 00000427 : Word Modules
                        'Past Exam flag not set when we open exam from Task.
                        .IsPastExam = True
                        .Show()
                        .BringToFront()
                        If .ExamViewMode Then
                            .ViewExam(ExamID)
                        Else
                            .OpenPastExamContents(ExamID, blnFinished)
                        End If
                        .Select()
                        ''Comment made against bug no:Bug #31322: Tasks Panel>>Open task>>Complete task for all users>>Login with other user>>Open task from task Panle>>Click on Show Exam>>Not opening Past Exam form 
                        ''start
                        'ofrmTask.Enabled = False
                        ''End
                    Else
                        ''Comment made against bug no:Bug #31322: Tasks Panel>>Open task>>Complete task for all users>>Login with other user>>Open task from task Panle>>Click on Show Exam>>Not opening Past Exam form 
                        ''start
                        'ofrmTask.Enabled = True
                        ''End

                        RemoveHandler frm.FormClosed, AddressOf On_ExamClosed

                        frm.Dispose()
                        frm = Nothing
                    End If
                End With
                Me.Cursor = Cursors.Default
            Else
                Me.Cursor = Cursors.Default
                MessageBox.Show("Please select the Patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.Message, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        Me.Cursor = Cursors.Default
    End Sub

    Private Sub On_ExamClosed(ByVal sender As Object, ByVal e As FormClosedEventArgs)

        Dim frm As frmPatientExam = Nothing

        Try
            frm = DirectCast(sender, frmPatientExam)
        Catch ex As Exception

        End Try
        Try
            If (IsNothing(frm) = False) Then
                RemoveHandler frm.FormClosed, AddressOf On_ExamClosed
            End If
            If (IsNothing(frm) = False) Then
                frm.Close()
            End If
            If (IsNothing(frm) = False) Then
                frm.Dispose()
                frm = Nothing
            End If

        Catch ex As Exception

        End Try


        If ofrmTask IsNot Nothing Then
            ofrmTask.Enabled = True
        End If
    End Sub

    'Added by pradeep on 20101025 for SmartOrder
    Dim _OrderID As Int64
    Dim _IsLabSave As Boolean = False
    Dim _IsOrderSave As Boolean = False
    Dim _IsFlowSheetSave As Boolean = False

    Private Sub UpdateLabTask()
        _IsLabSave = True

    End Sub

    'Added by pradeep on 20101025 for Order Task/Smart Order
    Private Sub UpdateOrderTask()
        _IsOrderSave = True
    End Sub

    'Added by pradeep on 20101025 for Drug Task
    Private Sub UpdateFlowSheetTask()
        _IsFlowSheetSave = True
    End Sub

    'Added by pradeep on 20101025 for Drug Task
    Private Function FillDrugList(ByVal sDrugCode As String) As ArrayList
        Dim sNDCCode() As String
        Dim query As String = ""
        Dim arrDrugs = New ArrayList
        Dim dt As DataTable = Nothing
        Dim sdap As SqlDataAdapter = Nothing
        sNDCCode = Split(sDrugCode, "|")
        For i As Integer = 0 To sNDCCode.Length - 1
            dt = New DataTable()
            query = "SELECT  nDrugsID as nDrugsID, ISNULL(sDrugName,'') as sDrugName, ISNULL(sGenericName,'') as sGenericName, " _
            & " ISNULL(sDosage,'') as sDosage, ISNULL(sRoute,'') as sRoute,ISNULL(sFrequency,'') as sFrequency, " _
            & " ISNULL(sDuration,'') as sDuration, ISNULL(bIsClinicalDrug,'False') as bIsClinicalDrug,ISNULL(sAmount,'') as sAmount," _
            & " ISNULL(nIsNarcotics,0) as nIsNarcotics, ISNULL(mpid,0) as mpid,ISNULL(bIsAllergicDrug,'False') as bIsAllergicDrug," _
            & " ISNULL(nClinicID,0) as nClinicID, ISNULL(bIsBlocked,'False') as bIsBlocked,ISNULL(sNDCCode,'') as sNDCCode," _
            & " ISNULL(sDrugForm,'') as sDrugForm,ISNULL(sDrugQtyQualifier,'') as sDrugQtyQualifier,ISNULL(RxType,'') as RxType from Drugs_MST " _
            & " WHERE sNDCCode='" & sNDCCode(i).ToString() & "'"
            sdap = New SqlDataAdapter(query, GetConnectionString())
            sdap.Fill(dt)
            If Not IsNothing(dt) Then
                If dt.Rows.Count > 0 Then
                    Dim oDrug As New gloEMRGeneralLibrary.gloEMRActors.Drug
                    oDrug.DrugsID = dt.Rows(0)("nDrugsID")
                    oDrug.DrugsName = dt.Rows(0)("sDrugName")
                    oDrug.Dosage = dt.Rows(0)("sDosage")
                    oDrug.DrugForm = dt.Rows(0)("sDrugForm")
                    oDrug.Route = dt.Rows(0)("sRoute")
                    oDrug.Frequency = dt.Rows(0)("sFrequency")
                    oDrug.NDCCode = dt.Rows(0)("sNDCCode")
                    oDrug.IsNarcotics = dt.Rows(0)("nIsNarcotics")
                    oDrug.Duration = dt.Rows(0)("sDuration")
                    oDrug.mpid = dt.Rows(0)("mpid")
                    oDrug.DrugQtyQualifier = dt.Rows(0)("sDrugQtyQualifier")
                    arrDrugs.Add(oDrug)
                End If
            End If
        Next
        If Not IsNothing(dt) Then  ''slr free dt
            dt.Dispose()
            dt = Nothing
        End If
        If Not IsNothing(sdap) Then  ''slr free sdap
            sdap.Dispose()
            sdap = Nothing
        End If
        Return arrDrugs
    End Function
    Dim _objfrmtask As Object = Nothing
    Private Sub HandlesTaskChange(ByVal sender As Object, ByVal e As System.EventArgs, ByVal e2 As gloTaskMail.TaskChangeEventArg, Optional ByVal objfrmtsk As Object = Nothing) ''objfrmtsk parameter added for keeping task screen open or not depending on setting while opening DMS screen 
        If Not IsNothing(e2) Then
            Dim arrlist As ArrayList = Nothing
            Dim olist As myList = Nothing
            If e2.IsTaskClose = False Then
                If e2.oTaskType = gloTaskMail.TaskType.OrderRadiology Then
                    'ORDER

                    Dim oDB As New gloStream.gloDataBase.gloDataBase

                    Dim nVisitID As Int64
                    Dim nPatientID As Int64
                    Dim VisitDate As Date
                    ''Get OrderID for Current Task to open 
                    Dim nTaskID As Int64 = e2.TaskID
                    Dim Query As String
                    Dim strOrder As String = ""
                    Dim strOrders() As String
                    Dim strOrderDetails() As String
                    ' Dim sSubj As String
                    Try

                        ''VisitID is searched from OrderDate Which is searched from TaskID
                        ''OrderDate of Order is Stored in -- TM_TaskMST.sFaxTiffFileName -- Column.
                        oDB.Connect(GetConnectionString)
                        Query = "SELECT nPatientId,sNoteExt FROM TM_TaskMST WHERE nTaskID = " & nTaskID & ""
                        Dim mydr As SqlDataReader
                        Dim taskPatientID As Int64 = 0
                        mydr = oDB.ReadQueryRecords(Query)
                        If (mydr.HasRows) Then
                            mydr.Read()
                            strOrder = Convert.ToString(mydr("sNoteExt"))
                            taskPatientID = Convert.ToInt64(mydr("nPatientId"))
                            If taskPatientID = 0 Then
                                Return
                            End If
                        End If
                        mydr.Close()
                        mydr = Nothing

                        Dim frm As frm_LM_Orders
                        '   Dim dtOrder As DataTable
                        If strOrder = "" Then

                            Query = "SELECT DISTINCT lm_Visit_ID, lm_OrderDate,lm_Patient_ID FROM LM_Orders WHERE lm_OrderDate IN ( SELECT sFaxTiffFileName FROM TM_TaskMST WHERE nTaskID =" & nTaskID & ") and lm_patient_ID =" & taskPatientID

                            Dim dt As DataTable = oDB.ReadQueryDataTable(Query)
                            oDB.Disconnect()
                            oDB.Dispose()
                            oDB = Nothing
                            If IsNothing(dt) = False Then
                                If (dt.Rows.Count > 0) Then
                                    nVisitID = dt.Rows(0)("lm_Visit_ID")
                                    VisitDate = dt.Rows(0)("lm_OrderDate")
                                    nPatientID = dt.Rows(0)("lm_Patient_ID")
                                Else
                                    'added by pradeep 20100906 - to avoid exception if we save no order with the task or if we delete order related with task
                                    MessageBox.Show("This order does not exists.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    Exit Sub
                                End If
                            Else
                                'added by pradeep 20100906 - to avoid exception if we save no order with the task or if we delete order related with task
                                MessageBox.Show("This order does not exists.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Exit Sub
                            End If


                            ' '' <><><> Record Level Locking <><><><>                         
                            Dim blnRecordLock As Boolean = False
                            If gblnRecordLocking = True Then
                                Dim mydt As New mytable
                                mydt = Scan_n_Lock_Transaction(TrnType.Radiology, gnPatientID, nVisitID, VisitDate)
                                If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                    If MessageBox.Show("This Radiology Order is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                        blnRecordLock = True
                                    Else
                                        Exit Sub
                                    End If
                                End If
                            End If

                            'set blnRecordLock = True  to the user does not have rights objUserRights.PatientOrders
                            If (objUserRights.RadiologyOrders = False) Then
                                blnRecordLock = True
                            End If

                            If IsAccess(False, nPatientID) = False Then
                                Exit Sub
                            End If


                            frm = frm_LM_Orders.GetInstance(nVisitID, VisitDate, nPatientID, 1, blnRecordLock)
                            'AddHandler frm.EvntGenerateCDAFromLMOrders, AddressOf openCDA
                            If IsNothing(frm) = True Then
                                Exit Sub
                            End If

                            With frm
                                frm_LM_Orders.IsopenfrmTask = True
                                .MinimizeBox = False
                                .MaximizeBox = False
                                .ShowInTaskbar = False
                                .MdiParent = Nothing
                                .BringToFront()
                                .WindowState = FormWindowState.Maximized
                                .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))

                                If e2.IsOpenFromView = False Then
                                    ShowHideMainMenu(True, True)
                                    Me.pnlMainToolBar.Visible = True
                                End If

                            End With
                            If Not IsNothing(frm) Then ''slr free frm
                                frm.Close()
                                frm.Dispose()
                                frm = Nothing
                            End If
                        Else
                            arrlist = New ArrayList
                            strOrders = Split(strOrder, "|")
                            For i As Integer = 0 To strOrders.Length - 1
                                strOrderDetails = Split(strOrders.GetValue(i), "~")
                                olist = New myList
                                olist.Index = strOrderDetails.GetValue(0)
                                If (strOrderDetails.Length > 1) Then
                                    olist.Value = strOrderDetails.GetValue(1)
                                End If

                                arrlist.Add(olist)
                            Next
                            If Not IsNothing(arrlist) Then
                                If arrlist.Count > 0 Then

                                    frm = frm_LM_Orders.GetInstance(0, Now, taskPatientID)

                                    If IsNothing(frm) = True Then
                                        Exit Sub
                                    End If
                                    'Added by pradeep on 20101025 for SmartOrder
                                    AddHandler frm.EvnSaveOrderHandler, AddressOf UpdateOrderTask
                                    'AddHandler frm.EvntGenerateCDAFromLMOrders, AddressOf openCDA
                                    With frm
                                        ._ExamID = 0
                                        ._ArrRadi = arrlist
                                        ._patientID = taskPatientID
                                        .WindowState = FormWindowState.Maximized
                                        .BringToFront()
                                        .ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
                                    End With
                                    If Not IsNothing(frm) Then  ''slr dispose
                                        RemoveHandler frm.EvnSaveOrderHandler, AddressOf UpdateOrderTask
                                        frm.Close()
                                        frm.Dispose()
                                        frm = Nothing
                                    End If
                                    'Code Start- Added by kanchan on 20100618 for SmartOrder-task to multiple user
                                    If _IsOrderSave = True Then
                                        If Not IsNothing(frm._VisitDate) Then
                                            Dim OrderDate As Date = frm._VisitDate
                                            oDB.Connect(GetConnectionString)
                                            Query = "UPDATE TM_TaskMST SET sNoteEXT='',sFaxTiffFileName='" & OrderDate & "' where ntaskid= " & nTaskID
                                            oDB.ExecuteNonSQLQuery(Query)
                                            oDB.Disconnect()
                                            oDB.Dispose()
                                            oDB = Nothing
                                            ofrmTask.sNoteExt = ""
                                            ofrmTask.FaxTiffFileName = OrderDate.ToString()
                                        End If
                                        _IsOrderSave = False
                                    End If
                                    '                       Code End- Added by kanchan on 20100618 for SmartOrder-task to multiple user
                                End If
                            End If
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    Finally
                        If (IsNothing(oDB) = False) Then
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                    End Try
                    '00000926 : Added or condition for Assgned Lab Order task
                ElseIf e2.oTaskType = gloTaskMail.TaskType.LabOrder Or e2.oTaskType = gloTaskMail.TaskType.AssignedLabOrder Then
                    'LAB ORDER
                    Dim oDBLayer As New gloDatabaseLayer.DBLayer(GetConnectionString)
                    Dim oDB As New gloStream.gloDataBase.gloDataBase


                    Try


                        'Record Level Locking
                        Dim blnRecordLock As Boolean = False
                        If gblnRecordLocking = True Then
                            Dim mydt As mytable  ''slr new not needed 
                            mydt = Scan_n_Lock_Transaction(TrnType.Labs, gnPatientID, gnVisitID, Now)
                            If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                If MessageBox.Show("This Patient Lab is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                    blnRecordLock = True
                                Else
                                    If Not IsNothing(mydt) Then  ''slr free mydt
                                        mydt.Dispose()
                                        mydt = Nothing
                                    End If
                                    Exit Sub
                                End If
                            End If

                            If Not IsNothing(mydt) Then  ''slr free mydt
                                mydt.Dispose()
                                mydt = Nothing
                            End If
                        End If
                        'Record Level Locking

                        Dim nTaskID As Int64 = e2.TaskID
                        Dim Query As String
                        Dim nPatientID As Int64
                        Dim nOrderID As Int64
                        Dim sOrderDetail As String
                        Dim sLabs() As String
                        Dim sLabDetails() As String
                        Dim nTaskDate As Int64
                        Dim nVisitID As Int64
                        Dim strObjResult As String = String.Empty
                        oDBLayer.Connect(False)
                        Query = "SELECT sNoteExt FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                        sOrderDetail = oDBLayer.ExecuteScalar_Query(Query)

                        strObjResult = String.Empty
                        Query = "SELECT nPatientID FROM TM_TaskMST WHERE nTaskID = " & nTaskID

                        strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                        If strObjResult.ToString().Trim().Length > 0 Then
                            nPatientID = Convert.ToInt64(strObjResult.ToString().Trim())
                        End If


                        If sOrderDetail = "" Then
                            Try
                                'OrderID is Stored In TM_TaskMST.nReferenceID1  for reference.
                                Query = "SELECT nReferenceID1 FROM TM_TaskMST WHERE nTaskID = " & nTaskID

                                strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                                If strObjResult.ToString().Trim().Length > 0 Then
                                    nOrderID = Convert.ToInt64(strObjResult.ToString().Trim())
                                End If

                                strObjResult = String.Empty

                                Query = "SELECT nDateCreated FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                                strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                                If strObjResult.ToString().Trim().Length > 0 Then
                                    nTaskDate = Convert.ToInt64(strObjResult.ToString().Trim())
                                End If

                                strObjResult = String.Empty

                                'Added by madan on 20100612--- modified for functionality based on Assigntask form lab.
                                If nOrderID > 0 Then
                                    Query = "SELECT labom_VisitID FROM Lab_Order_MST WHERE labom_OrderID = " & nOrderID
                                    strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                                    If strObjResult.ToString().Trim().Length > 0 Then

                                        nVisitID = Convert.ToInt64(strObjResult.ToString().Trim())
                                    End If

                                End If

                                strObjResult = String.Empty

                                oDBLayer.Disconnect()

                                If IsAccess(False, nPatientID) = False Then
                                    Exit Sub
                                End If

                            Catch ex As Exception
                                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                            Finally
                                If Not IsNothing(oDBLayer) Then
                                    oDBLayer.Disconnect()
                                    oDBLayer.Dispose()
                                    oDBLayer = Nothing
                                End If
                            End Try

                            If nOrderID > 0 Then



                                Dim frm As frmViewgloLab
                                'Code Commented & added by kanchan on 20100323 for calling gloLab instead of Lab
                                frm = New frmViewgloLab(nOrderID, nPatientID)
                                'Code added for Already lab order Is open
                                If (frm.CheckInstance() = True) Then
                                    MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    frm.Close()
                                    If (IsNothing(frm) = False) Then
                                        frm.Dispose()
                                        frm = Nothing
                                    End If

                                    Exit Sub
                                End If


                                'Dim myCloseEventHandler As New System.Windows.Forms.FormClosedEventHandler(AddressOf ShowTasks)

                                'RemoveHandler frm.EvntGenerateCCDHandler, AddressOf openCCD
                                'RemoveHandler frm.EntOpenMessage, AddressOf OpenMessage
                                'RemoveHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                                'RemoveHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                                'RemoveHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                                'RemoveHandler frm.FormClosed, myCloseEventHandler
                                'RemoveHandler frm.Activated, AddressOf frmViewgloLab_Activated
                                'RemoveHandler frm.EntOpenEducation, AddressOf OpenEducation
                                'RemoveHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                                'RemoveHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA
                                'RemoveHandler frm.OnProviderChanged, AddressOf OnProviderChanged


                                'Code Start-Added by kanchan on 20101109 for bug : 5454
                                AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD
                                'Code End-Added by kanchan on 20101109 for bug : 5454
                                'Developer:Sanjog Dhamke
                                'Date: 21 Dec 2011
                                'PRD Name: Lab Usability (6060)
                                'Reason: To Open the Patient Letter & Referral Letter
                                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                                AddHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                                AddHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                                AddHandler frm.FormClosed, AddressOf ofrmViewgloLab_FormClosed 'myCloseEventHandler
                                AddHandler frm.Activated, AddressOf frmViewgloLab_Activated
                                'AddHandler frm.Deactivate, AddressOf frmViewgloLab_Deactivate

                                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                AddHandler frm.EntOpenEducation, AddressOf OpenEducation
                                AddHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                                AddHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                                ''Bug #62739: gloEMR: Orders & Result - Order entry- Application is showing an invalid message 
                                AddHandler frm.OnProviderChanged, AddressOf OnProviderChanged

                                If IsNothing(frm) = True Then
                                    Exit Sub
                                End If

                                With frm.LabOrderParameter
                                    .IsEditMode = False
                                    .OrderID = nOrderID
                                    .OrderNumberID = 0
                                    .OrderNumberPrefix = "ORD"
                                    .PatientID = nPatientID
                                    .VisitID = nVisitID
                                    .TransactionDate = gloDateMaster.gloDate.DateAsDate(nTaskDate)
                                    .CloseAfterSave = True

                                End With

                                'frm.WindowState = FormWindowState.Maximized
                                'frm.ShowInTaskbar = False
                                'frm.MdiParent = Nothing
                                'frm.BringToFront()

                                'frm.ShowDialog(Me)

                                'If e2.IsOpenFromView = False Then
                                '    ShowHideMainMenu(True, True)
                                '    Me.pnlMainToolBar.Visible = True
                                'End If

                                frm.objgloLabPatientExam = New clsPatientExams

                                frm.objgloLabPatientMessages = New clsMessage
                                frm.objgloLabPatientLetters = New clsPatientLetters
                                frm.objgloLabNurseNotes = New clsNurseNotes
                                frm.objgloLabHistory = New clsPatientHistory
                                frm.objgloLabLabs = New clsLabs
                                frm.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                                frm.objgloLabRxmed = New clsPatientDetails
                                frm.objgloLabOrders = New clsPatientDetails
                                frm.objgloLabProblemList = New clsPatientProblemList

                                frm.objgloLabCriteria = New DocCriteria
                                frm.objgloLabWord = New clsWordDocument

                                frm.LoginProviderID = gnLoginProviderID

                                frm.WindowState = FormWindowState.Maximized
                                frm.MdiParent = Me
                                frm.ShowInTaskbar = False

                                ''changes added for split control functionality in orders&results
                                Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
                                objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn

                                ' ofrmViewgloLab.objCriteria = New DocCriteria
                                ' ofrmViewgloLab.objWord = New clsWordDocument
                                frm.VisitID = gnVisitID
                                frm.clsSplit_Laborder = objclsSplit_Laborder

                                frm.Show()

                                ShowHideMainMenu(False, False)
                                Me.pnlMainToolBar.Visible = False

                            Else
                                '''''''''''''''''
                                If IsAccess(False, nPatientID) = False Then
                                    Exit Sub
                                End If
                                '''''''''''''''''
                                Dim frm As frmViewgloLab
                                frm = New frmViewgloLab(nPatientID)
                                'Code added for Already lab order Is open
                                If (frm.CheckInstance() = True) Then
                                    MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    frm.Close()
                                    If (IsNothing(frm) = False) Then
                                        frm.Dispose()
                                        frm = Nothing
                                    End If
                                    Exit Sub
                                End If
                                '---------

                                'Code Start-Added by kanchan on 20101109 for bug : 5454
                                AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD
                                'Developer:Sanjog Dhamke
                                'Date: 21 Dec 2011
                                'PRD Name: Lab Usability (6060)
                                'Reason: To Open the Patient Letter & Referral Letter
                                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                                AddHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                                AddHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                                AddHandler frm.FormClosed, AddressOf ofrmViewgloLab_FormClosed 'ShowTasks
                                AddHandler frm.Activated, AddressOf frmViewgloLab_Activated
                                ' AddHandler frm.Deactivate, AddressOf frmViewgloLab_Deactivate

                                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                AddHandler frm.EntOpenEducation, AddressOf OpenEducation
                                AddHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                                AddHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                                'Code End
                                If IsNothing(frm) = True Then
                                    Exit Sub
                                End If
                                ''10800'Start'Lab: Added Lab Test Details are not Showing
                                With frm.LabOrderParameter
                                    .PatientID = nPatientID
                                    .VisitID = GenerateVisitID(gnPatientID)
                                    .TransactionDate = Now
                                End With
                                ''10800'End'Lab: Added Lab Test Details are not Showing
                                'frm.WindowState = FormWindowState.Maximized
                                'frm.ShowInTaskbar = False
                                'frm.MdiParent = Nothing
                                'frm.BringToFront()

                                'frm.ShowDialog(Me)
                                frm.objgloLabPatientExam = New clsPatientExams

                                frm.objgloLabPatientMessages = New clsMessage
                                frm.objgloLabPatientLetters = New clsPatientLetters
                                frm.objgloLabNurseNotes = New clsNurseNotes
                                frm.objgloLabHistory = New clsPatientHistory
                                frm.objgloLabLabs = New clsLabs
                                frm.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                                frm.objgloLabRxmed = New clsPatientDetails
                                frm.objgloLabOrders = New clsPatientDetails
                                frm.objgloLabProblemList = New clsPatientProblemList

                                frm.objgloLabCriteria = New DocCriteria
                                frm.objgloLabWord = New clsWordDocument

                                frm.LoginProviderID = gnLoginProviderID

                                frm.WindowState = FormWindowState.Maximized
                                frm.MdiParent = Me
                                frm.ShowInTaskbar = False
                                ''changes added for split control functionality in orders&results
                                Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
                                objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn

                                ' ofrmViewgloLab.objCriteria = New DocCriteria
                                ' ofrmViewgloLab.objWord = New clsWordDocument
                                frm.VisitID = gnVisitID
                                frm.clsSplit_Laborder = objclsSplit_Laborder
                                frm.Show()

                                ShowHideMainMenu(False, False)
                                Me.pnlMainToolBar.Visible = False

                            End If

                        Else
                            arrlist = New ArrayList
                            sLabs = Split(sOrderDetail, "|")
                            For i As Integer = 0 To sLabs.Length - 1
                                sLabDetails = Split(sLabs.GetValue(i), "~")
                                For j As Integer = 0 To sLabDetails.Length - 1
                                    Dim Emdeonlst As New gloEmdeonCommon.myList
                                    Emdeonlst.ID = sLabDetails.GetValue(0)
                                    Emdeonlst.Value = sLabDetails.GetValue(1)
                                    arrlist.Add(Emdeonlst)
                                Next
                            Next
                            If Not IsNothing(arrlist) Then
                                If arrlist.Count > 0 Then

                                    '''''''''''''''''
                                    If IsAccess(False, nPatientID) = False Then
                                        Exit Sub
                                    End If
                                    '''''''''''''''''

                                    'Code Start-commented & Added by kanchan on 20100824 while integrtaion of 5060
                                    Dim frmNormalLab As New gloEmdeonInterface.Forms.frmViewNormalLab(nPatientID)
                                    AddHandler frmNormalLab.saveLabOrder, AddressOf UpdateLabTask
                                    AddHandler frmNormalLab.Event_CallCDA, AddressOf mdlGeneral.OpenCDA
                                    ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                    AddHandler frmNormalLab.EducationOrder, AddressOf OpenEducation
                                    frmNormalLab.ArrLabs = arrlist '' Added by Abhijeet on 20100624
                                    frmNormalLab._MdiParent = Me
                                    frmNormalLab.WindowState = FormWindowState.Maximized
                                    frmNormalLab.ShowInTaskbar = False
                                    frmNormalLab.BringToFront()

                                    frmNormalLab.ShowDialog(IIf(IsNothing(frmNormalLab.Parent), Me, frmNormalLab.Parent))
                                    RemoveHandler frmNormalLab.EducationOrder, AddressOf OpenEducation  ''slr remove handler
                                    RemoveHandler frmNormalLab.Event_CallCDA, AddressOf mdlGeneral.OpenCDA
                                    RemoveHandler frmNormalLab.saveLabOrder, AddressOf UpdateLabTask
                                    frmNormalLab.Dispose()

                                    'Code Start- Added by kanchan on 20100618 for SmartOrder-task to multiple user
                                    If _IsLabSave = True Then
                                        If frmNormalLab.LabOrderParameter.OrderID <> 0 Then
                                            Dim _orderid As Int64 = frmNormalLab.LabOrderParameter.OrderID
                                            oDB.Connect(GetConnectionString)
                                            Query = "UPDATE TM_TaskMST SET sNoteEXT='',nReferenceID1=" & _orderid & " where ntaskid= " & nTaskID
                                            oDB.ExecuteNonSQLQuery(Query)
                                            oDB.Disconnect()
                                            oDB.Dispose()
                                            oDB = Nothing
                                            ofrmTask.sNoteExt = ""
                                            ofrmTask.ReferenceID = _orderid
                                        End If
                                        _IsLabSave = False
                                    End If
                                End If
                            End If


                        End If

                        If SelectedPatientDetail = PatientDetails.Orders Then
                            Fill_Labs()
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    Finally
                        If (IsNothing(oDB) = False) Then
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                        If (IsNothing(oDBLayer) = False) Then
                            oDBLayer.Dispose()
                            oDBLayer = Nothing
                        End If
                    End Try

                ElseIf e2.oTaskType = gloTaskMail.TaskType.HL7DocumentTask Then 'Start of code Added by manoj jadhav on 20130219 for diplaying DMS document from task module

                    Dim oDB As gloStream.gloDataBase.gloDataBase = Nothing
                    Dim nTaskID As Int64 = e2.TaskID
                    Dim query As String = String.Empty
                    Dim _RefranceID1 As Long = 0
                    Dim _RefranceID2 As Long = 0
                    Dim _PatientID As Long = 0
                    Dim _Year As String = String.Empty
                    Dim dtResult As DataTable = Nothing
                    Dim _nResultCount As Integer = 0
                    Try
                        oDB = New gloStream.gloDataBase.gloDataBase()
                        oDB.Connect(GetConnectionString())
                        query = "SELECT nReferenceID1,nReferenceID2,nPatientID FROM dbo.TM_TaskMST WHERE nTaskID = " & nTaskID
                        dtResult = oDB.ReadQueryDataTable(query)
                        oDB.Disconnect()

                        If Not dtResult Is Nothing AndAlso dtResult.Rows.Count > 0 Then
                            _RefranceID1 = dtResult.Rows(0)("nReferenceID1")
                            _RefranceID2 = dtResult.Rows(0)("nReferenceID2")
                            _PatientID = dtResult.Rows(0)("nPatientID")
                        End If

                        If _PatientID <= 0 Or _RefranceID1 <= 0 Or _RefranceID2 <= 0 Then
                            Exit Try
                        End If
                        'check for access
                        If IsAccess(False, _PatientID) = False Then
                            Exit Try
                        End If

                        If _RefranceID2 = 1 Then

                            query = "Select Count(eDocumentID) from dbo.eDocument_Details_V3 WHERE eDocumentID =" & _RefranceID1 & " AND PatientID=" & _PatientID & ""
                            oDB.Connect(GetDMSConnectionString())
                            _nResultCount = Convert.ToInt32(oDB.ExecuteQueryScaler(query))
                            oDB.Disconnect()

                            If _nResultCount <= 0 Then
                                MessageBox.Show("This document does not exists.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Exit Try
                            End If

                            Dim objgloEDocV3Management As gloEDocumentV3.gloEDocV3Management = Nothing
                            Dim isItDialog As Boolean = True
                            Try
                                objgloEDocV3Management = New gloEDocumentV3.gloEDocV3Management()
                                objgloEDocV3Management.oPatientExam = New clsPatientExams()
                                objgloEDocV3Management.oPatientMessages = New clsMessage()
                                objgloEDocV3Management.oPatientLetters = New clsPatientLetters()
                                objgloEDocV3Management.oNurseNotes = New clsNurseNotes
                                objgloEDocV3Management.oHistory = New clsPatientHistory
                                objgloEDocV3Management.oLabs = New clsLabs
                                objgloEDocV3Management.oDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                                objgloEDocV3Management.oRxmed = New clsPatientDetails
                                objgloEDocV3Management.oOrders = New clsPatientDetails
                                objgloEDocV3Management.oProblemList = New clsPatientProblemList
                                objgloEDocV3Management.oCriteria = New DocCriteria
                                objgloEDocV3Management.oWord = New clsWordDocument
                                isItDialog = objgloEDocV3Management.ShowEDocument(_PatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewDocumentForExternalModule, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.ViewTask, _RefranceID1)
                            Catch ex As Exception
                                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                            Finally
                                If (isItDialog = True) Then


                                    If Not objgloEDocV3Management Is Nothing Then
                                        If (IsNothing(objgloEDocV3Management.oPatientExam) = False) Then
                                            DirectCast(objgloEDocV3Management.oPatientExam, clsPatientExams).Dispose()
                                            objgloEDocV3Management.oPatientExam = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oPatientMessages) = False) Then
                                            DirectCast(objgloEDocV3Management.oPatientMessages, clsMessage).Dispose()
                                            objgloEDocV3Management.oPatientMessages = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oPatientLetters) = False) Then
                                            DirectCast(objgloEDocV3Management.oPatientLetters, clsPatientLetters).Dispose()
                                            objgloEDocV3Management.oPatientLetters = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oNurseNotes) = False) Then
                                            DirectCast(objgloEDocV3Management.oNurseNotes, clsNurseNotes).Dispose()
                                            objgloEDocV3Management.oNurseNotes = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oHistory) = False) Then
                                            DirectCast(objgloEDocV3Management.oHistory, clsPatientHistory).Dispose()
                                            objgloEDocV3Management.oHistory = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oLabs) = False) Then
                                            DirectCast(objgloEDocV3Management.oLabs, clsLabs).Dispose()
                                            objgloEDocV3Management.oLabs = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oDMS) = False) Then
                                            DirectCast(objgloEDocV3Management.oDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                                            objgloEDocV3Management.oDMS = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oRxmed) = False) Then
                                            DirectCast(objgloEDocV3Management.oRxmed, clsPatientDetails).Dispose()
                                            objgloEDocV3Management.oRxmed = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oOrders) = False) Then
                                            DirectCast(objgloEDocV3Management.oOrders, clsPatientDetails).Dispose()
                                            objgloEDocV3Management.oOrders = Nothing
                                        End If
                                        If (IsNothing(objgloEDocV3Management.oProblemList) = False) Then
                                            DirectCast(objgloEDocV3Management.oProblemList, clsPatientProblemList).Dispose()
                                            objgloEDocV3Management.oProblemList = Nothing
                                        End If

                                        If (IsNothing(objgloEDocV3Management.oCriteria) = False) Then
                                            DirectCast(objgloEDocV3Management.oCriteria, DocCriteria).Dispose()
                                            objgloEDocV3Management.oCriteria = Nothing
                                        End If
                                        objgloEDocV3Management.Dispose()
                                    End If

                                    objgloEDocV3Management = Nothing
                                End If
                            End Try


                        ElseIf _RefranceID2 = 2 Then

                            query = "Select COUNT(DicomID)  from dbo.DicomDetails WHERE DicomID=" & _RefranceID1 & " AND nPatientID=" & _PatientID & ""
                            oDB.Connect(GetConnectionString())
                            _nResultCount = Convert.ToInt32(oDB.ExecuteQueryScaler(query))
                            oDB.Disconnect()

                            If _nResultCount <= 0 Then
                                MessageBox.Show("This document does not exists.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Exit Try
                            End If

                            Dim ofrmDICOM As frmgloDICOM = Nothing
                            Try
                                If DICOMPath <> "" Then
                                    ofrmDICOM = New frmgloDICOM(_PatientID, "Task", _RefranceID1)
                                    ofrmDICOM.WindowState = FormWindowState.Maximized
                                    ofrmDICOM.ShowDialog(IIf(IsNothing(ofrmDICOM.Parent), Me, ofrmDICOM.Parent))
                                Else
                                    MessageBox.Show("'Set the DICOM path from  Tool->Settings->Server Path.'", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                End If
                            Catch comex As System.Runtime.InteropServices.COMException
                                MessageBox.Show("The required components for DICOM are missing.  Please install.  ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                gloAuditTrail.gloAuditTrail.ExceptionLog(comex.ToString(), False) ''to check comexception
                            Catch ex As Exception
                                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                                Throw ex
                            Finally
                                If Not ofrmDICOM Is Nothing Then
                                    ofrmDICOM.Dispose()
                                    ofrmDICOM = Nothing
                                End If
                            End Try
                        End If
                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    Finally
                        If Not oDB Is Nothing Then
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                        nTaskID = 0
                        query = String.Empty
                        _RefranceID1 = 0
                        _RefranceID2 = 0
                        _PatientID = 0
                        _Year = String.Empty
                        _nResultCount = 0
                        If Not dtResult Is Nothing Then
                            dtResult.Dispose()
                            dtResult = Nothing
                        End If

                    End Try 'END of code Added by manoj jadhav on 20130219 for diplaying DMS document from task module

                    '00000926 : Added or condition for Assgned DMS document task
                ElseIf e2.oTaskType = gloTaskMail.TaskType.DMS Or e2.oTaskType = gloTaskMail.TaskType.AssignedDMS Then
                    'DMS Documents
                    Try

                        bnlIstaskOpened = False

                        If ShowTaskSpecificScanDocs(e2, objfrmtsk, False) = False Then
                            Exit Try
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    End Try
                    ''Added By Shweta 20091201
                    'Against the case no :GLO2009 0002794 and bugzilla Id:3700
                ElseIf e2.oTaskType = gloTaskMail.TaskType.Exam Then
                    Dim oDB As New gloStream.gloDataBase.gloDataBase
                    Try

                        ''Change made against bug no:Bug #31322: Tasks Panel>>Open task>>Complete task for all users>>Login with other user>>Open task from task Panle>>Click on Show Exam>>Not opening Past Exam form 
                        ''start
                        'Dim _TaskID As Int64 = ofrmTask.TaskID
                        Dim _TaskID As Int64 = e2.TaskID
                        ''End
                        Dim _Query As String
                        Dim _ExamID As Long = 0
                        Dim dtExam As New DataTable
                        Dim _DOS As String
                        Dim _ExamName As String
                        Dim _sTemplateName As String
                        Dim _blnFinished As Boolean
                        Dim _nVisitID As Int64
                        Dim _PatientID As Int64

                        oDB.Connect(GetConnectionString)
                        _ExamID = e2.ReferenceID1
                        If _ExamID > 0 Then

                            _Query = ""
                            _Query = "SELECT ISNULL(nVisitID,0) as VisitID, ISNULL(nPatientID,0) as PatientID ,dtDOS,ISNULL(sExamName,'')  as ExamName ,ISNULL(sTemplateName,'') as TemplateName, bIsFinished FROM PatientExams WHERE nExamID = " & _ExamID
                            dtExam = oDB.ReadQueryDataTable(_Query)
                            oDB.Disconnect()
                            oDB.Dispose()
                            oDB = Nothing
                            If dtExam IsNot Nothing Then
                                If dtExam.Rows.Count > 0 Then
                                    _nVisitID = dtExam.Rows(0)("VisitID")
                                    _PatientID = dtExam.Rows(0)("PatientID")
                                    _DOS = dtExam.Rows(0)("dtDOS")
                                    _ExamName = dtExam.Rows(0)("ExamName")
                                    _sTemplateName = dtExam.Rows(0)("TemplateName")
                                    _blnFinished = dtExam.Rows(0)("bIsFinished")

                                    '''''''''''''''''
                                    If IsAccess(False, _PatientID) = False Then
                                        Exit Sub
                                    End If
                                    '''''''''''''''''

                                    ShowPastExamFromTask(_ExamID, _PatientID, _nVisitID, _DOS, _ExamName, _sTemplateName, _blnFinished, gstrPatientCode)
                                    ' ofrmTask.Enabled = False
                                End If
                            End If
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    Finally
                        If (IsNothing(oDB) = False) Then
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                    End Try

                    ' Added by Abhijeet on Date 20100422 for task type unmatch patient
                ElseIf e2.oTaskType = gloTaskMail.TaskType.UnmatchedPatient Then
                    'Code Start- Added by kanchan on 20100303 for Emdeon
                    '' Unmatched Patient Matching ''
                    '' by Abhijeet  on 20100310 called form with task id & login idconstructor
                    ''Dim objfrmViewUnMatchPatients As frmViewUnMatchPatients = New frmViewUnMatchPatients()

                    'Code commented Bug #86221: Unmatched Patient task (Problem 00000942) : Updated patient details of task to previously opened Unmatched Patient Task 

                    ' Code Start - Added by kanchan on 20100319
                    'If nTaskId <> e2.TaskID Then
                    '    Try
                    '        Dim oDB As New gloStream.gloDataBase.gloDataBase
                    '        Dim query As String
                    '        oDB.Connect(GetConnectionString)

                    '        query = "UPDATE PatientsUnmatchedInLab set nTaskId=" & e2.TaskID & " where nTaskId= " & nTaskId
                    '        oDB.ExecuteNonSQLQuery(query)
                    '        oDB.Disconnect()
                    '        oDB.Dispose()
                    '        oDB = Nothing
                    '        nTaskId = e2.TaskID
                    '    Catch ex As Exception

                    '    End Try
                    'End If
                    ' Code End

                    Dim objfrmViewUnMatchPatients As frmViewUnMatchPatients = New frmViewUnMatchPatients(e2.TaskID, gnLoginID)
                    objfrmViewUnMatchPatients.WindowState = FormWindowState.Normal
                    objfrmViewUnMatchPatients.ShowDialog(IIf(IsNothing(objfrmViewUnMatchPatients.Parent), Me, objfrmViewUnMatchPatients.Parent))

                    ' Task form is closed as overwriting existing updates of current task
                    If Not IsNothing(ofrmTask) Then
                        ofrmTask.Close()
                    End If

                    objfrmViewUnMatchPatients.Dispose()

                    'end of changes by Abhijeet on Date 20100422 for task type unmatched patient

                    ''Code Start - Added by kanchan on 20100605 for CCD
                ElseIf e2.oTaskType = gloTaskMail.TaskType.CCD Or e2.oTaskType = gloTaskMail.TaskType.CCDUnmatchedPatient Then
                    Try
                        Dim _taskType As Int32
                        If e2.oTaskType = gloTaskMail.TaskType.CCD Then
                            _taskType = 9
                        Else
                            _taskType = 10
                        End If
                        ''

                        ''
                        Dim oDB As New gloStream.gloDataBase.gloDataBase
                        Dim query As String
                        Dim nPatientID As Int64
                        oDB.Connect(GetConnectionString)
                        ''

                        ''
                        If nTaskId <> e2.TaskID Then
                            query = "UPDATE CCD_Queue set nTaskId=" & e2.TaskID & " where nTaskId= " & nTaskId
                            oDB.ExecuteNonSQLQuery(query)
                            nTaskId = e2.TaskID
                        End If
                        query = "SELECT nPatientID FROM TM_TaskMST WHERE nTaskID = " & nTaskId
                        nPatientID = oDB.ExecuteQueryScaler(query)
                        Dim _CCDID As Long = 0
                        ' CCDID is Stored in TM_TaskMST.nReferenceID1  for referance
                        query = "SELECT nReferenceID1 FROM TM_TaskMST WHERE nTaskID = " & nTaskId
                        _CCDID = oDB.ExecuteQueryScaler(query)
                        oDB.Disconnect()
                        oDB.Dispose()
                        oDB = Nothing
                        If _CCDID > 0 Then
                            Dim objfrmCCD_Display As frmCCD_Display = New frmCCD_Display(nPatientID)
                            objfrmCCD_Display.TaskType = e2.oTaskType
                            objfrmCCD_Display.CCDId = _CCDID
                            objfrmCCD_Display.WindowState = FormWindowState.Normal
                            objfrmCCD_Display.StartPosition = FormStartPosition.CenterScreen
                            ''Resolved issue #62659-Mayuri 01/29/2014-Tasks - Closing Show CCD-CCR window also closes Task window
                            If objfrmCCD_Display.ShowDialog(IIf(IsNothing(objfrmCCD_Display.Parent), Me, objfrmCCD_Display.Parent)) = DialogResult.OK Then

                                If Not IsNothing(ofrmTask) Then
                                    ofrmTask.Close()
                                End If
                            End If

                            objfrmCCD_Display.Dispose()
                        End If
                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    End Try
                    ''Code End - Added by kanchan on 20100605 for CCD
                ElseIf e2.oTaskType = gloTaskMail.TaskType.Flowsheet Then
                    ''Code Start-Added by kanchan on 20100619 for Flowsheet
                    Dim oDB As New gloStream.gloDataBase.gloDataBase
                    Try
                        Dim sFlowSheetName As String

                        Dim nPatientID As Int64
                        Dim sFlowName As String
                        Dim query As String
                        Dim sFlow() As String
                        Dim sFlows() As String
                        'Developer:Sanjog(Dhamke)
                        'Date:21 Dec 2011 
                        'Bug ID/PRD Name/Sales force Case: 16259 - Flowsheet is not open from View->Task window
                        'Reason: nTaskId is global variable for Dashboard n it will contain task id which is open from dashboard. Now we are take a local variable for task Id and use it to retrieve value for task.
                        Dim nTaskID As Int64
                        nTaskID = e2.TaskID
                        oDB.Connect(GetConnectionString)
                        query = "SELECT nPatientID FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                        nPatientID = oDB.ExecuteQueryScaler(query)
                        query = "SELECT sNoteExt FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                        sFlowName = oDB.ExecuteQueryScaler(query)
                        If sFlowName = "" Then
                            query = "SELECT sFaxTiffFileName FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                            sFlowSheetName = oDB.ExecuteQueryScaler(query)
                            oDB.Disconnect()
                            If sFlowSheetName <> "" Then

                                '''''''''''''''''
                                If IsAccess(False, nPatientID) = False Then
                                    Exit Sub
                                End If
                                '''''''''''''''''

                                Dim objfrmpatientflowsheet As New frmPatientFlowSheet(nPatientID, sFlowSheetName)
                                If objfrmpatientflowsheet.FormLevelLock() Then
                                    objfrmpatientflowsheet.WindowState = FormWindowState.Maximized
                                    objfrmpatientflowsheet.ShowDialog(IIf(IsNothing(objfrmpatientflowsheet.Parent), Me, objfrmpatientflowsheet.Parent))
                                End If
                                If Not IsNothing(objfrmpatientflowsheet) Then ''slr free objfrmpatientflowsheet
                                    objfrmpatientflowsheet.Close()
                                    objfrmpatientflowsheet.Dispose()
                                    objfrmpatientflowsheet = Nothing
                                End If
                            End If
                        Else
                            Dim _FlowSheetName As String = ""
                            arrlist = New ArrayList
                            sFlow = Split(sFlowName, "|")
                            For i As Integer = 0 To sFlow.Length - 1
                                sFlows = Split(sFlow.GetValue(i), "~")
                                olist = New myList
                                olist.ID = sFlows.GetValue(0)
                                If (sFlows.Length > 1) Then
                                    olist.Value = sFlows.GetValue(1)
                                End If

                                _FlowSheetName = olist.Value
                                arrlist.Add(olist)
                            Next
                            If Not IsNothing(arrlist) Then
                                If arrlist.Count > 0 Then

                                    Dim objfrmpatientflowsheet As New frmPatientFlowSheet(nPatientID, _FlowSheetName)
                                    ''Bug : 00000828: Record locking
                                    If objfrmpatientflowsheet.FormLevelLock() Then
                                        AddHandler objfrmpatientflowsheet.EvnSaveFlowSheet, AddressOf UpdateFlowSheetTask

                                        With objfrmpatientflowsheet
                                            '.Array_Flow_List.Clear()
                                            frmPatientFlowSheet.Array_Flow_List = arrlist
                                            .WindowState = FormWindowState.Maximized
                                            .BringToFront()
                                            .ShowDialog(IIf(IsNothing(objfrmpatientflowsheet.Parent), Me, objfrmpatientflowsheet.Parent))
                                            If Not IsNothing(objfrmpatientflowsheet) Then ''Slr free objfrmpatientflowsheet and removehandler
                                                RemoveHandler objfrmpatientflowsheet.EvnSaveFlowSheet, AddressOf UpdateFlowSheetTask
                                                objfrmpatientflowsheet.Close()
                                                objfrmpatientflowsheet.Dispose()
                                                objfrmpatientflowsheet = Nothing
                                            End If
                                        End With
                                    Else
                                        objfrmpatientflowsheet.Dispose()
                                        objfrmpatientflowsheet = Nothing
                                    End If


                                    If _IsFlowSheetSave = True Then
                                        If _FlowSheetName <> "" Then

                                            oDB.Connect(GetConnectionString)
                                            query = "UPDATE TM_TaskMST SET sNoteEXT='',sFaxTiffFileName='" & _FlowSheetName.Replace("'", "''").ToString & "' where ntaskid= " & nTaskID
                                            oDB.ExecuteNonSQLQuery(query)
                                            oDB.Disconnect()
                                            oDB.Dispose()
                                            oDB = Nothing
                                            ofrmTask.sNoteExt = ""
                                            ofrmTask.FaxTiffFileName = _FlowSheetName
                                        End If
                                    End If
                                End If
                            End If
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    Finally
                        If (IsNothing(oDB) = False) Then
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                    End Try
                    ''Code End - Added by kanchan on 20100619 for flowsheet
                ElseIf e2.oTaskType = gloTaskMail.TaskType.Drug Then
                    'Code Start-Added by kanchan on 20100621 for Drugs
                    Dim oDB As New gloStream.gloDataBase.gloDataBase
                    Try
                        Dim ArrDrugs As New ArrayList()
                        Dim sNotes As String

                        Dim nPatientID As Int64
                        Dim nProviderID As Int64
                        Dim sDrugName As String
                        Dim query As String
                        Dim nDrugVisitID As Int64 = 0 'added by kanchan on 20100622
                        'Developer:Sanjog(Dhamke)
                        'Date:21 Dec 2011 
                        'Bug ID/PRD Name/Sales force Case: Bug ID 16259 - Flowsheet is not open from View->Task window
                        'Reason: nTaskId is global variable for Dashboard n it will contain task id which is open from dashboard. Now we are take a local variable for task Id and use it to retrieve value for task.
                        Dim nTaskID As Int64
                        nTaskID = e2.TaskID
                        oDB.Connect(GetConnectionString)
                        query = "SELECT nPatientID FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                        nPatientID = oDB.ExecuteQueryScaler(query)
                        query = "Select nProviderID FROM Patient where nPatientID= " & nPatientID
                        nProviderID = oDB.ExecuteQueryScaler(query)
                        query = "SELECT sNoteExt FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                        sNotes = oDB.ExecuteQueryScaler(query)
                        If sNotes = "" Then
                            'Commented & added by kanchan on 20100622
                            query = "SELECT sFaxTiffFileName FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                            sDrugName = oDB.ExecuteQueryScaler(query)
                            query = "SELECT nReferenceID1 FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                            nDrugVisitID = oDB.ExecuteQueryScaler(query)
                            oDB.Disconnect()
                            If nDrugVisitID <> 0 Then

                                If IsAccess(False, nPatientID) = False Then
                                    Exit Sub
                                End If
                                '''''''''''''''''

                                Dim frmRxMeds As frmPrescription
                                frmRxMeds = frmPrescription.GetInstance(nDrugVisitID, nPatientID)
                                If IsNothing(frmRxMeds) = True Then
                                    Exit Sub
                                End If

                                ''when form is in dialog mode instead of giving locking message we Show message when Rx-Meds form is already opened at background for the same patient
                                If frmPrescription.IsOpen = False Then
                                    If frmRxMeds.LockForm(nPatientID) = False Then
                                        frmRxMeds.Dispose()
                                        frmRxMeds = Nothing
                                        Exit Sub
                                    Else
                                        With frmRxMeds
                                            .WindowState = FormWindowState.Maximized
                                            .BringToFront()
                                            .ShowReconcileMessage()
                                            .ShowDialog(IIf(IsNothing(frmRxMeds.Parent), Me, frmRxMeds.Parent))
                                            .Dispose()
                                            frmRxMeds = Nothing
                                        End With
                                    End If
                                Else
                                    MessageBox.Show("Rx/Meds screen cannot be opened as it is already open in the background.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                End If
                            End If
                        Else
                            ArrDrugs = FillDrugList(sNotes)
                            If Not IsNothing(ArrDrugs) Then
                                If ArrDrugs.Count > 0 Then
                                    mdlGeneral.gblnIsDrugSave = False
                                    Dim nVisitID As Int64
                                    nVisitID = GetVisitID(Now.Date, nPatientID)

                                    If IsAccess(False, nPatientID) = False Then
                                        Exit Sub
                                    End If

                                    Dim frmRxMeds As frmPrescription
                                    frmRxMeds = frmPrescription.GetInstance(ArrDrugs, nProviderID, nVisitID, nPatientID)
                                    If IsNothing(frmRxMeds) = True Then
                                        Exit Sub
                                    End If

                                    If frmPrescription.IsOpen = False Then                                       
                                        With frmRxMeds
                                            .WindowState = FormWindowState.Maximized
                                            .BringToFront()
                                            .ShowDialog(IIf(IsNothing(frmRxMeds.Parent), Me, frmRxMeds.Parent))
                                            .Dispose()
                                            frmRxMeds = Nothing
                                        End With                                        
                                    Else
                                        MessageBox.Show("Rx/Meds screen cannot be opened as it is already open in the background.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    End If

                                    If mdlGeneral.gblnIsDrugSave = True Then
                                        If mdlGeneral.gnPrescriptionVisitID <> 0 Then
                                            oDB.Connect(GetConnectionString)
                                            'added by kanchan on 20100622
                                            query = "UPDATE TM_TaskMST SET sNoteEXT='',nReferenceID1=" & mdlGeneral.gnPrescriptionVisitID & " where ntaskid= " & nTaskID
                                            oDB.ExecuteNonSQLQuery(query)
                                            oDB.Disconnect()
                                            oDB.Dispose()
                                            oDB = Nothing
                                            ofrmTask.sNoteExt = ""
                                            ofrmTask.ReferenceID = mdlGeneral.gnPrescriptionVisitID
                                        End If
                                    End If
                                Else
                                    MessageBox.Show("The drug which was associated is no longer available in the drug master. Please make the association again.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                End If
                            Else
                                MessageBox.Show("The drug which was associated is no longer available in the drug master. Please make the association again.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                            End If
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    Finally
                        If (IsNothing(oDB) = False) Then
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                    End Try
                    '    'Code End - Added by kanchan on 20100621 for Drugs
                    'End If

                    'Code Start - Added by kanchan on 20100319 for updating the task id 
                ElseIf e2.oTaskType = gloTaskMail.TaskType.OpenEmdeonlabOrder Then
                    'Developer:Sanjog Dhamke
                    'Date: 12/07/2011
                    'Bug ID/PRD Name/Sales force Case: Issue is TaskId is took the global Taskid from Dashboard and place the order against that patient on which task is generated. 
                    'Reason: ntaskID get value of global taskid from dashboard to avoid this we make the parameter to take TaskID and against it find the patient and place lab order for him/her.
                    OpenEmdeon(e2.TaskID)
                ElseIf e2.oTaskType = gloTaskMail.TaskType.PlaceLabOrder Then
                    'Developer:Sanjog Dhamke
                    'Date: Jan 12 2012
                    'PRD Name: Lab Usability PRD (6060)
                    'Reason: Need to open the record result screen to place lab order 
                    Dim oDBLayer As New gloDatabaseLayer.DBLayer(GetConnectionString)
                    Dim oDB As New gloStream.gloDataBase.gloDataBase
                    Try




                        'Record Level Locking
                        Dim blnRecordLock As Boolean = False
                        If gblnRecordLocking = True Then
                            Dim mydt As mytable ''slr new not needed
                            mydt = Scan_n_Lock_Transaction(TrnType.Labs, gnPatientID, gnVisitID, Now)
                            If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                If MessageBox.Show("This Patient Lab is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                    blnRecordLock = True
                                Else
                                    If Not IsNothing(mydt) Then  ''slr free mydt
                                        mydt.Dispose()
                                        mydt = Nothing
                                    End If
                                    Exit Sub
                                End If

                            End If
                            If Not IsNothing(mydt) Then  ''slr free mydt
                                mydt.Dispose()
                                mydt = Nothing
                            End If
                        End If
                        'Record Level Locking

                        Dim nTaskID As Int64 = e2.TaskID
                        Dim Query As String
                        Dim nPatientID As Int64
                        Dim nOrderID As Int64
                        Dim sOrderDetail As String
                        Dim sLabs() As String
                        Dim sLabDetails() As String
                        Dim nTaskDate As Int64
                        Dim nVisitID As Int64
                        Dim strObjResult As String = String.Empty
                        oDBLayer.Connect(False)
                        Query = "SELECT sNoteExt FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                        sOrderDetail = oDBLayer.ExecuteScalar_Query(Query)

                        strObjResult = String.Empty
                        Query = "SELECT nPatientID FROM TM_TaskMST WHERE nTaskID = " & nTaskID

                        strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                        If strObjResult.ToString().Trim().Length > 0 Then
                            nPatientID = Convert.ToInt64(strObjResult.ToString().Trim())
                        End If


                        If sOrderDetail = "" Then
                            Try
                                'OrderID is Stored In TM_TaskMST.nReferenceID1  for reference.
                                Query = "SELECT nReferenceID1 FROM TM_TaskMST WHERE nTaskID = " & nTaskID

                                strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                                If strObjResult.ToString().Trim().Length > 0 Then
                                    nOrderID = Convert.ToInt64(strObjResult.ToString().Trim())
                                End If

                                strObjResult = String.Empty

                                Query = "SELECT nDateCreated FROM TM_TaskMST WHERE nTaskID = " & nTaskID
                                strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                                If strObjResult.ToString().Trim().Length > 0 Then
                                    nTaskDate = Convert.ToInt64(strObjResult.ToString().Trim())
                                End If

                                strObjResult = String.Empty

                                '--- modified for functionality based on Assigntask form lab.
                                If nOrderID > 0 Then
                                    Query = "SELECT labom_VisitID FROM Lab_Order_MST WHERE labom_OrderID = " & nOrderID
                                    strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                                    If strObjResult.ToString().Trim().Length > 0 Then

                                        nVisitID = Convert.ToInt64(strObjResult.ToString().Trim())
                                    End If

                                End If

                                strObjResult = String.Empty

                                oDBLayer.Disconnect()

                                If IsAccess(False, nPatientID) = False Then
                                    Exit Sub
                                End If

                            Catch ex As Exception
                                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                            Finally
                                If Not IsNothing(oDBLayer) Then
                                    oDBLayer.Disconnect()
                                    oDBLayer.Dispose()
                                    oDBLayer = Nothing
                                End If
                            End Try

                            If nOrderID > 0 Then
                                Dim frm As frmViewgloLab
                                frm = New frmViewgloLab(nOrderID, nPatientID)
                                'Code added for Already lab order Is open
                                If (frm.CheckInstance() = True) Then
                                    MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    frm.Close()
                                    If (IsNothing(frm) = False) Then
                                        frm.Dispose()
                                        frm = Nothing
                                    End If

                                    Exit Sub
                                End If
                                '---------

                                AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD
                                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                                AddHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                                AddHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                                AddHandler frm.FormClosed, AddressOf ofrmViewgloLab_FormClosed 'ShowTasks
                                AddHandler frm.Activated, AddressOf frmViewgloLab_Activated
                                'AddHandler frm.Deactivate, AddressOf frmViewgloLab_Deactivate

                                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                AddHandler frm.EntOpenEducation, AddressOf OpenEducation
                                AddHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                                AddHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                                If IsNothing(frm) = True Then
                                    Exit Sub
                                End If
                                frm.objgloLabPatientExam = New clsPatientExams

                                frm.objgloLabPatientMessages = New clsMessage
                                frm.objgloLabPatientLetters = New clsPatientLetters
                                frm.objgloLabNurseNotes = New clsNurseNotes
                                frm.objgloLabHistory = New clsPatientHistory
                                frm.objgloLabLabs = New clsLabs
                                frm.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                                frm.objgloLabRxmed = New clsPatientDetails
                                frm.objgloLabOrders = New clsPatientDetails
                                frm.objgloLabProblemList = New clsPatientProblemList

                                frm.objgloLabCriteria = New DocCriteria
                                frm.objgloLabWord = New clsWordDocument

                                frm.LoginProviderID = gnLoginProviderID

                                With frm.LabOrderParameter
                                    .IsEditMode = False
                                    .OrderID = nOrderID
                                    .OrderNumberID = 0
                                    .OrderNumberPrefix = "ORD"
                                    .PatientID = nPatientID
                                    .VisitID = nVisitID
                                    .TransactionDate = gloDateMaster.gloDate.DateAsDate(nTaskDate)
                                    .CloseAfterSave = True

                                End With

                                'frm.WindowState = FormWindowState.Maximized
                                'frm.ShowInTaskbar = False
                                'frm.MdiParent = Nothing
                                'frm.BringToFront()

                                frm.WindowState = FormWindowState.Maximized
                                frm.MdiParent = Me
                                frm.ShowInTaskbar = False
                                frm.Show()


                                ShowHideMainMenu(False, False)
                                Me.pnlMainToolBar.Visible = False

                                'If e2.IsOpenFromView = False Then
                                '    ShowHideMainMenu(True, True)
                                '    Me.pnlMainToolBar.Visible = True
                                'End If
                            Else
                                '''''''''''''''''
                                If IsAccess(False, nPatientID) = False Then
                                    Exit Sub
                                End If
                                '''''''''''''''''

                                'frm = New frmViewgloLab(nPatientID)
                                'AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD
                                'AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                                'AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                                'AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                                'If IsNothing(frm) = True Then
                                '    Exit Sub
                                'End If
                                ' ''10800'Start'Lab: Added Lab Test Details are not Showing
                                'With frm.LabOrderParameter
                                '    .PatientID = nPatientID
                                '    .VisitID = GenerateVisitID(gnPatientID)
                                '    .TransactionDate = Now
                                'End With
                                ' ''10800'End'Lab: Added Lab Test Details are not Showing
                                'frm.WindowState = FormWindowState.Maximized
                                'frm.ShowInTaskbar = False
                                'frm.MdiParent = Nothing
                                'frm.BringToFront()

                                'frm.ShowDialog(Me)

                                Dim frmNormalLab As New gloEmdeonInterface.Forms.frmViewNormalLab(nPatientID)
                                AddHandler frmNormalLab.saveLabOrder, AddressOf UpdateLabTask
                                AddHandler frmNormalLab.Event_CallCDA, AddressOf mdlGeneral.OpenCDA
                                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                AddHandler frmNormalLab.EducationOrder, AddressOf OpenEducation
                                frmNormalLab.ArrLabs = arrlist '' Added by Abhijeet on 20100624
                                frmNormalLab._MdiParent = Me
                                frmNormalLab.WindowState = FormWindowState.Maximized
                                frmNormalLab.ShowInTaskbar = False
                                frmNormalLab.BringToFront()
                                frmNormalLab.ShowDialog(IIf(IsNothing(frmNormalLab.Parent), Me, frmNormalLab.Parent))
                                RemoveHandler frmNormalLab.saveLabOrder, AddressOf UpdateLabTask  ''slr removehandler
                                RemoveHandler frmNormalLab.Event_CallCDA, AddressOf mdlGeneral.OpenCDA
                                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                RemoveHandler frmNormalLab.EducationOrder, AddressOf OpenEducation  ''slr removehandler

                                frmNormalLab.Dispose()

                                'Code Start- Added by kanchan on 20100618 for SmartOrder-task to multiple user

                                'Developer:Sanjog(Dhamke)
                                'Date: 2 Feb 2012
                                'PRD Name: Lab Usability Changes
                                'Reason:Comment this code bcoz, Don't update nreferenceID with orderID, bcoz we need to open record result screen every time 

                                'If _IsLabSave = True Then
                                '    If frmNormalLab.LabOrderParameter.OrderID <> 0 Then
                                '        Dim _orderid As Int64 = frmNormalLab.LabOrderParameter.OrderID
                                '        oDB.Connect(GetConnectionString)
                                '        Query = "UPDATE TM_TaskMST SET sNoteEXT='',nReferenceID1=" & _orderid & " where ntaskid= " & nTaskID
                                '        oDB.ExecuteNonSQLQuery(Query)
                                '        oDB.Disconnect()
                                '        oDB.Dispose()
                                '        oDB = Nothing
                                '        ofrmTask.sNoteExt = ""
                                '        ofrmTask.ReferenceID = _orderid
                                '    End If
                                '    _IsLabSave = False
                                'End If

                            End If

                        Else
                            arrlist = New ArrayList
                            sLabs = Split(sOrderDetail, "|")
                            For i As Integer = 0 To sLabs.Length - 1
                                sLabDetails = Split(sLabs.GetValue(i), "~")
                                For j As Integer = 0 To sLabDetails.Length - 1
                                    Dim Emdeonlst As New gloEmdeonCommon.myList
                                    Emdeonlst.ID = sLabDetails.GetValue(0)
                                    Emdeonlst.Value = sLabDetails.GetValue(1)
                                    arrlist.Add(Emdeonlst)
                                Next
                            Next
                            If Not IsNothing(arrlist) Then
                                If arrlist.Count > 0 Then

                                    '''''''''''''''''
                                    If IsAccess(False, nPatientID) = False Then
                                        Exit Sub
                                    End If
                                    '''''''''''''''''

                                    'Code Start-commented & Added by kanchan on 20100824 while integrtaion of 5060
                                    Dim frmNormalLab As New gloEmdeonInterface.Forms.frmViewNormalLab(nPatientID)
                                    AddHandler frmNormalLab.saveLabOrder, AddressOf UpdateLabTask

                                    ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                    AddHandler frmNormalLab.EducationOrder, AddressOf OpenEducation
                                    AddHandler frmNormalLab.Event_CallCDA, AddressOf mdlGeneral.OpenCDA
                                    '29-Oct-13 Aniket: Fixing Bug #58097: 
                                    AddHandler frmNormalLab.OnProviderChanged, AddressOf OnProviderChanged

                                    frmNormalLab.ArrLabs = arrlist '' Added by Abhijeet on 20100624
                                    frmNormalLab._MdiParent = Me
                                    frmNormalLab.WindowState = FormWindowState.Maximized
                                    frmNormalLab.ShowInTaskbar = False
                                    frmNormalLab.BringToFront()
                                    frmNormalLab.ShowDialog(IIf(IsNothing(frmNormalLab.Parent), Me, frmNormalLab.Parent))
                                    RemoveHandler frmNormalLab.saveLabOrder, AddressOf UpdateLabTask  ''slr removehandler
                                    RemoveHandler frmNormalLab.Event_CallCDA, AddressOf mdlGeneral.OpenCDA
                                    ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                                    RemoveHandler frmNormalLab.EducationOrder, AddressOf OpenEducation   ''slr removehandler

                                    '29-Oct-13 Aniket: Fixing Bug #58097: 
                                    RemoveHandler frmNormalLab.OnProviderChanged, AddressOf OnProviderChanged   ''slr removehandler


                                    frmNormalLab.Dispose()

                                    'Code Start- Added by kanchan on 20100618 for SmartOrder-task to multiple user
                                    'Commented by Sanjog = To Open Record result Screen Every time with tests collection
                                    'If _IsLabSave = True Then
                                    '    If frmNormalLab.LabOrderParameter.OrderID <> 0 Then
                                    '        Dim _orderid As Int64 = frmNormalLab.LabOrderParameter.OrderID
                                    '        oDB.Connect(GetConnectionString)
                                    '        Query = "UPDATE TM_TaskMST SET sNoteEXT='',nReferenceID1=" & _orderid & " where ntaskid= " & nTaskID
                                    '        oDB.ExecuteNonSQLQuery(Query)
                                    '        oDB.Disconnect()
                                    '        oDB.Dispose()
                                    '        oDB = Nothing
                                    '        ofrmTask.sNoteExt = ""
                                    '        ofrmTask.ReferenceID = _orderid
                                    '    End If
                                    '    _IsLabSave = False
                                    'End If
                                End If
                            End If


                        End If

                        If SelectedPatientDetail = PatientDetails.Orders Then
                            Fill_Labs()
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    Finally
                        If (IsNothing(oDB) = False) Then
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                        If (IsNothing(oDBLayer) = False) Then
                            oDBLayer.Dispose()
                            oDBLayer = Nothing
                        End If
                    End Try

                ElseIf e2.oTaskType = gloTaskMail.TaskType.HL7LabInboundFailureNotifyTask Then

                    Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
                    Dim oTask As New gloTaskMail.Task()

                    oTask = ogloTask.GetTask(e2.TaskID)
                    Dim nTaskDate As Long = oTask.DateCreated
                    Dim dtTaskDate As DateTime
                    If Not IsNothing(ogloTask) Then
                        ogloTask.Dispose()
                        ogloTask = Nothing
                    End If
                    If Not IsNothing(oTask) Then
                        oTask.Dispose()
                        oTask = Nothing
                    End If

                    If nTaskDate > 0 Then

                        dtTaskDate = gloDateMaster.gloDate.DateAsDate(nTaskDate)
                    Else
                        dtTaskDate = Now
                    End If

                    Dim ofrmViewReport As New frmInterfacesMessageErrorReport()
                    ofrmViewReport.WindowState = FormWindowState.Normal
                    ofrmViewReport.dtSpecificDateReport = dtTaskDate
                    ofrmViewReport.ShowDialog(IIf(IsNothing(ofrmViewReport.Parent), Me, ofrmViewReport.Parent))

                    '' Task form is closed as overwriting existing updates of current task
                    'If Not IsNothing(ofrmTask) Then
                    '    ofrmTask.Close()                
                    'End If

                    ofrmViewReport.Dispose()
                ElseIf e2.oTaskType = gloTaskMail.TaskType.PatientPortalTask Then

                    Dim ofrmPatientReview As New gloEmdeonInterface.Forms.frmIntuitPatientReview(mdlGeneral.globlnEnableMultipleRaceFeatures, mdlGeneral.gblnUSEINTUITINTERFACE)
                    ofrmPatientReview.WindowState = FormWindowState.Normal
                    ofrmPatientReview.ShowDialog(IIf(IsNothing(ofrmPatientReview.Parent), Me, ofrmPatientReview.Parent))
                    ofrmPatientReview.Dispose()
                    'added in 6060 to show task created from OB Vitals
                ElseIf e2.oTaskType = gloTaskMail.TaskType.Vitals Then
                    Dim oDB As New gloStream.gloDataBase.gloDataBase
                    Dim frm As frmPatientVitals = Nothing
                    Dim Query As String
                    Try
                        oDB.Connect(GetConnectionString)
                        Query = "SELECT nPatientId FROM TM_TaskMST WHERE nTaskID = " & nTaskId & ""
                        Dim mydr As SqlDataReader
                        Dim taskPatientID As Int64 = 0
                        mydr = oDB.ReadQueryRecords(Query)
                        If (mydr.HasRows) Then
                            mydr.Read()

                            taskPatientID = Convert.ToInt64(mydr("nPatientId"))
                            If taskPatientID = 0 Then
                                Return
                            End If
                        End If
                        mydr.Close()
                        mydr = Nothing

                        frm = New frmPatientVitals(e2.ReferenceID1, taskPatientID)
                        frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    Finally
                        If Not IsNothing(frm) Then
                            frm.Dispose()
                            frm = Nothing
                        End If
                        If Not IsNothing(oDB) Then
                            oDB.Dispose()
                            oDB = Nothing
                        End If
                    End Try
                ElseIf e2.oTaskType = gloTaskMail.TaskType.IntuitSecureMessageTask Or e2.oTaskType = gloTaskMail.TaskType.IntuitAppointmentTask Or e2.oTaskType = gloTaskMail.TaskType.IntuitRxRenewalTask Or e2.oTaskType = gloTaskMail.TaskType.IntuitBillPayTask Then
                    If e2.btnTag = "ViewMessage" Then
                        Dim frmintuit As gloIntuitSecureMessage.frmReadSecureMsg = Nothing

                        Try
                            If IsNothing(e2.PatientID) OrElse e2.PatientID = 0 Then
                                Return
                            End If
                            ''Added Portal Type for MU2 Patient Portal on 20130827
                            Dim strServiceURI = gstrPatientPortalEmailService
                            frmintuit = New gloIntuitSecureMessage.frmReadSecureMsg(e2.PatientID, e2.ReferenceID1, GetConnectionString(), gloSettings.FolderSettings.AppTempFolderPath, gnClientMachineID, gstrClientMachineName, PortalType, Convert.ToString(strServiceURI), gstrPatientPortalSiteNm, gnClinicID, gblnIntuitCommunication)
                            frmintuit.IncludeMessageInReply = gblnIncludeMessageInReply
                            frmintuit.IntuitUserRight = objUserRights.Intuit
                            Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frmintuit)
                            _interophelper.Owner = Me.Handle
                            frmintuit.ShowInTaskbar = False
                            '  frmintuit.Topmost = True

                            'setting value for split screen
                            frmintuit.objPatientExam = New clsPatientExams
                            frmintuit.objPatientMessages = New clsMessage
                            frmintuit.objPatientLetters = New clsPatientLetters
                            frmintuit.objNurseNotes = New clsNurseNotes
                            frmintuit.objHistory = New clsPatientHistory
                            frmintuit.objLabs = New clsLabs
                            frmintuit.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                            frmintuit.objRxmed = New clsPatientDetails
                            frmintuit.objOrders = New clsPatientDetails
                            frmintuit.objProblemList = New clsPatientProblemList
                            frmintuit.objCriteria = New DocCriteria
                            frmintuit.objWord = New clsWordDocument


                            frmintuit.ShowDialog()
                            If IsNothing(_interophelper) = False Then
                                _interophelper = Nothing
                            End If
                        Catch ex As Exception
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                        Finally
                            If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                                Fill_IntuitMessages(gnPatientID, txtSearchIntuit.Text)
                            End If
                            If Not IsNothing(frmintuit) Then
                                If IsNothing(frmintuit.objProblemList) = False Then
                                    DirectCast(frmintuit.objProblemList, clsPatientProblemList).Dispose()
                                End If
                                If IsNothing(frmintuit.objCriteria) = False Then
                                    DirectCast(frmintuit.objCriteria, DocCriteria).Dispose()
                                End If
                                If IsNothing(frmintuit.objPatientMessages) = False Then
                                    DirectCast(frmintuit.objPatientMessages, clsMessage).Dispose()
                                End If
                                If IsNothing(frmintuit.objPatientLetters) = False Then
                                    DirectCast(frmintuit.objPatientLetters, clsPatientLetters).Dispose()
                                End If
                                If IsNothing(frmintuit.objNurseNotes) = False Then

                                    DirectCast(frmintuit.objNurseNotes, clsNurseNotes).Dispose()
                                End If
                                If IsNothing(frmintuit.objHistory) = False Then

                                    DirectCast(frmintuit.objHistory, clsPatientHistory).Dispose()
                                End If
                                If IsNothing(frmintuit.objLabs) = False Then

                                    DirectCast(frmintuit.objLabs, clsLabs).Dispose()
                                End If
                                If IsNothing(frmintuit.objDMS) = False Then

                                    DirectCast(frmintuit.objDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                                End If
                                If IsNothing(frmintuit.objRxmed) = False Then

                                    DirectCast(frmintuit.objRxmed, clsPatientDetails).Dispose()
                                End If
                                If IsNothing(frmintuit.objOrders) = False Then

                                    DirectCast(frmintuit.objOrders, clsPatientDetails).Dispose()
                                End If
                                If IsNothing(frmintuit.objCriteria) = False Then

                                    DirectCast(frmintuit.objCriteria, DocCriteria).Dispose()
                                End If
                                If IsNothing(frmintuit.objPatientExam) = False Then

                                    DirectCast(frmintuit.objPatientExam, clsPatientExams).Dispose()
                                End If
                                frmintuit.Dispose()
                                frmintuit = Nothing
                            End If
                        End Try
                    ElseIf e2.btnTag = "ReplyMessage" Then
                        If objUserRights.Intuit = False Then
                            ''Task #68533: gloEMR Admin - User Management - User Rights - Change "Intuit" to "Patient Portal"
                            ''Change message text.
                            System.Windows.MessageBox.Show("This user does not have the rights to reply a secure message. Please contact your system administrator for the same.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                            Exit Sub
                        End If
                        Dim frmIntuitReply As gloIntuitSecureMessage.frmSendSecureMsg = Nothing
                        Dim _oClsIntuitSecureMessage As gloPatientPortalCommon.ClsIntuitSecureMessage = Nothing
                        Dim _msgFlag As Int16 = 0
                        Try

                            If IsNothing(e2.PatientID) OrElse e2.PatientID = 0 Then
                                Return
                            End If

                            _oClsIntuitSecureMessage = New gloPatientPortalCommon.ClsIntuitSecureMessage(GetConnectionString(), e2.PatientID, e2.ReferenceID1)
                            _msgFlag = _oClsIntuitSecureMessage.IntuitCheckIsReplied(e2.ReferenceID1)
                            If (_msgFlag = 1) Then
                                System.Windows.MessageBox.Show("Your practice has already responded to the appointment request. It is not possible to respond a second time. If there are any changes in the appointment request, please send the patient a new message.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Exit Sub
                            End If
                            If (_msgFlag = 2) Then
                                System.Windows.MessageBox.Show("Your practice has already responded to the prescription renewal request. It is not possible to respond a second time. If there are any changes in the prescription renewal request, please send the patient a new message.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Exit Sub
                            End If

                            ''Added Portal Type for MU2 Patient Portal on 20130827
                            frmIntuitReply = New gloIntuitSecureMessage.frmSendSecureMsg(e2.PatientID, GetConnectionString(), gnClientMachineID, gstrClientMachineName, e2.ReferenceID1, PortalType, gstrPatientPortalEmailService, gstrPatientPortalSiteNm, gnClinicID, gblnIntuitCommunication)
                            frmIntuitReply.IsReplyMessage = True
                            frmIntuitReply.IncludeMessageInReply = gblnIncludeMessageInReply
                            Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frmIntuitReply)
                            _interophelper.Owner = Me.Handle
                            frmIntuitReply.ShowInTaskbar = False

                            ''
                            frmIntuitReply.WindowStartupLocation = Windows.WindowStartupLocation.Manual
                            Dim boundWidth As Int16 = Screen.PrimaryScreen.Bounds.Width
                            Dim boundHeight As Int16 = Screen.PrimaryScreen.Bounds.Height
                            Dim x As Int16 = boundWidth - Me.Width
                            Dim y As Int16 = boundHeight - Me.Height
                            frmIntuitReply.Left = Convert.ToInt16(boundHeight / 4)
                            frmIntuitReply.Top = 25
                            ''


                            ' frmIntuitReply.SubjectFromReadMessage = e2.Subject
                            '  frmIntuitReply.MessageFromReadMessage = e2.sMessage
                            '  frmIntuitReply.Topmost = True

                            'setting value for split screen
                            frmIntuitReply.objPatientExam = New clsPatientExams
                            frmIntuitReply.objPatientMessages = New clsMessage
                            frmIntuitReply.objPatientLetters = New clsPatientLetters
                            frmIntuitReply.objNurseNotes = New clsNurseNotes
                            frmIntuitReply.objHistory = New clsPatientHistory
                            frmIntuitReply.objLabs = New clsLabs
                            frmIntuitReply.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                            frmIntuitReply.objRxmed = New clsPatientDetails
                            frmIntuitReply.objOrders = New clsPatientDetails
                            frmIntuitReply.objProblemList = New clsPatientProblemList
                            frmIntuitReply.objCriteria = New DocCriteria
                            frmIntuitReply.objWord = New clsWordDocument

                            frmIntuitReply.ShowDialog()
                            If IsNothing(_interophelper) = False Then
                                _interophelper = Nothing
                            End If
                        Catch ex As Exception
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                        Finally
                            If IsNothing(_oClsIntuitSecureMessage) = False Then
                                _oClsIntuitSecureMessage.Dispose()
                                _oClsIntuitSecureMessage = Nothing
                            End If

                            If IsNothing(frmIntuitReply) = False Then
                                If IsNothing(frmIntuitReply.objProblemList) = False Then
                                    DirectCast(frmIntuitReply.objProblemList, clsPatientProblemList).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objCriteria) = False Then
                                    DirectCast(frmIntuitReply.objCriteria, DocCriteria).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objPatientMessages) = False Then
                                    DirectCast(frmIntuitReply.objPatientMessages, clsMessage).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objPatientLetters) = False Then
                                    DirectCast(frmIntuitReply.objPatientLetters, clsPatientLetters).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objNurseNotes) = False Then

                                    DirectCast(frmIntuitReply.objNurseNotes, clsNurseNotes).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objHistory) = False Then

                                    DirectCast(frmIntuitReply.objHistory, clsPatientHistory).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objLabs) = False Then

                                    DirectCast(frmIntuitReply.objLabs, clsLabs).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objDMS) = False Then

                                    DirectCast(frmIntuitReply.objDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objRxmed) = False Then

                                    DirectCast(frmIntuitReply.objRxmed, clsPatientDetails).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objOrders) = False Then

                                    DirectCast(frmIntuitReply.objOrders, clsPatientDetails).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objCriteria) = False Then

                                    DirectCast(frmIntuitReply.objCriteria, DocCriteria).Dispose()
                                End If
                                If IsNothing(frmIntuitReply.objPatientExam) = False Then

                                    DirectCast(frmIntuitReply.objPatientExam, clsPatientExams).Dispose()
                                End If
                                frmIntuitReply.Close()
                                frmIntuitReply = Nothing
                            End If

                        End Try
                    ElseIf e2.btnTag = "RxMeds" Then
                        Dim frmRxMeds As frmPrescription
                        Try
                            If IsNothing(e2.PatientID) OrElse e2.PatientID = 0 Then
                                Return
                            End If
                            'Dim nVisitID As Int64
                            'nVisitID = GetVisitID(Now.Date, gnPatientID)
                            frmRxMeds = frmPrescription.GetInstance(e2.PatientID)
                            If IsNothing(frmRxMeds) = True Then
                                Exit Sub
                            End If

                            ''when form is in dialog mode instead of giving locking message we Show message when Rx-Meds form is already opened at background for the same patient
                            If frmPrescription.IsOpen = False Then
                                With frmRxMeds
                                    frmRxMeds.ShowMedication()
                                    .WindowState = FormWindowState.Maximized
                                    .BringToFront()
                                    .ShowReconcileMessage()
                                    .ShowDialog(IIf(IsNothing(frmRxMeds.Parent), Me, frmRxMeds.Parent))
                                    .Dispose()
                                    frmRxMeds = Nothing
                                End With
                            Else
                                MessageBox.Show("Rx/Meds screen cannot be opened as it is already open in the background.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                            End If
                        Catch ex As Exception
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                        End Try
                        'mnuPatientPrescription_Click(sender, e)
                    End If
                ElseIf e2.oTaskType = gloTaskMail.TaskType.Reconcile Then
                    Dim oDB As New gloStream.gloDataBase.gloDataBase
                    Dim query As String
                    Dim nPatientID As Int64
                    oDB.Connect(GetConnectionString)
                    query = "SELECT nPatientID FROM TM_TaskMST WHERE nTaskID = " & e2.TaskID ''taskid replace by e2.taskid Bug #106930:
                    nPatientID = oDB.ExecuteQueryScaler(query)
                    ShowReconciliationAlert(nPatientID)
                    If _IsReadyListPresent Then
                        Dim objfrmReconcilation As New frmReconcileList(nPatientID, _ListType)
                        objfrmReconcilation.LoginUser = gstrLoginName
                        objfrmReconcilation.LoginID = gnLoginID
                        objfrmReconcilation.ShowDialog(IIf(IsNothing(objfrmReconcilation.Parent), Me, objfrmReconcilation.Parent))

                        ShowReconciliationAlert(nPatientID)
                        objfrmReconcilation.Dispose()
                        objfrmReconcilation = Nothing
                    ElseIf _IsImportedFilePresent Then
                        Dim ofrmCCDFiles As New frmCCD_ViewFiles
                        ofrmCCDFiles.SelectedPatientID = nPatientID
                        ofrmCCDFiles.ShowInTaskbar = False
                        ofrmCCDFiles.WindowState = FormWindowState.Maximized
                        ofrmCCDFiles.ShowDialog(IIf(IsNothing(ofrmCCDFiles.Parent), Me, ofrmCCDFiles.Parent))
                        ShowReconciliationAlert(nPatientID)
                        ofrmCCDFiles.Dispose()
                        ofrmCCDFiles = Nothing
                    Else
                        MessageBox.Show("Patient has No Pending Clinical Reconciliations.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    End If
                ElseIf e2.oTaskType = gloTaskMail.TaskType.ImReconcile Then
                    Dim frmReconcilation As New frmHxForecastReconcileList
                    frmReconcilation = New frmHxForecastReconcileList(e2.PatientID, "Immunization")
                    frmReconcilation.LoginUser = gstrLoginName
                    frmReconcilation.LoginID = gnLoginID


                    frmReconcilation.ShowDialog(IIf(IsNothing(frmReconcilation.Parent), Me, frmReconcilation.Parent))
                ElseIf e2.oTaskType = gloTaskMail.TaskType.UnsolicitedTask Then
                    Dim objfrmfrmMergeOrder As frmMergeOrder = New frmMergeOrder(GetConnectionString(), e2.PatientID, e2.ReferenceID1, e2.oTaskType, e2.TaskID)

                    AddHandler objfrmfrmMergeOrder.mergeOperationFired, AddressOf MergeOperationEvent

                    objfrmfrmMergeOrder.ShowInTaskbar = False
                    objfrmfrmMergeOrder.WindowState = FormWindowState.Maximized
                    objfrmfrmMergeOrder.ShowDialog(IIf(IsNothing(objfrmfrmMergeOrder.Parent), Me, objfrmfrmMergeOrder.Parent))
                    ' objfrmfrmMergeOrder.BringToFront()
                    '' Task form is closed as overwriting existing updates of current task
                    'If Not IsNothing(ofrmTask) Then
                    '    ofrmTask.Close()
                    'End If
                    RemoveHandler objfrmfrmMergeOrder.mergeOperationFired, AddressOf MergeOperationEvent
                    objfrmfrmMergeOrder.Dispose()

                    'Code commented for Bug #86221: Unmatched Patient task (Problem 00000942) : Updated patient details of task to previously opened Unmatched Patient Task 
                    'Else
                    '    If nTaskId <> e2.TaskID Then
                    '        Try
                    '            Dim oDB As New gloStream.gloDataBase.gloDataBase
                    '            Dim query As String
                    '            oDB.Connect(GetConnectionString)

                    '            query = "UPDATE PatientsUnmatchedInLab set nTaskId=" & e2.TaskID & " where nTaskId= " & nTaskId
                    '            'query = "UPDATE gloLab_UnmatchPatient set nTaskId=" & e2.TaskID & " where nTaskId= " & nTaskId
                    '            oDB.ExecuteNonSQLQuery(query)
                    '            'Code Start-Added by kanchan on 20100605 for CCD
                    '            query = "UPDATE CCD_Queue set nTaskId=" & e2.TaskID & " where nTaskId= " & nTaskId
                    '            oDB.ExecuteNonSQLQuery(query)
                    '            'Code End-Added by kanchan on 20100605 for CCD
                    '            oDB.Disconnect()
                    '            oDB.Dispose()
                    '            oDB = Nothing
                    '        Catch ex As Exception

                    '        End Try
                    '    End If
                    ' Code End - Added by kanchan on 20100319 for updating the task id 
                ElseIf e2.oTaskType = gloTaskMail.TaskType.PatientPortalPatientFormTask Then

                    Dim _PatientID As Long = e2.PatientID

                    If e2.btnTag = "ShowHistory" Then
                        ShowHistory(_PatientID)
                    ElseIf e2.btnTag = "ShowROS" Then
                        Dim blnProviderDisable_ROS As Boolean = False
                        blnProviderDisable_ROS = IsPatientProviderDisabled(_PatientID)
                        ShowROS("", blnProviderDisable_ROS, _PatientID, bCallForLatestStatus:=True)
                    Else
                        ShowTaskSpecificScanDocs(e2, objfrmtsk, True)
                    End If
                ElseIf e2.oTaskType = gloTaskMail.TaskType.PortalPHI Then

                    Dim _PatientID As Long = e2.PatientID

                    If e2.btnTag = "ReviewPHI" Then
                        Dim blnProviderDisable_PHI As Boolean = False
                        Dim nReferencePHIID As Long = e2.ReferenceID1
                        blnProviderDisable_PHI = IsPatientProviderDisabled(_PatientID)
                        ShowReviewPHI("", blnProviderDisable_PHI, _PatientID, bCallForLatestStatus:=True, ReferencePHIID:=nReferencePHIID, bIsReviewMode:=True)

                    End If

                ElseIf e2.oTaskType = gloTaskMail.TaskType.RCMDocs Then
                    Try

                        bnlIstaskOpened = False

                        If ShowTaskSpecificRCMDocs(e2, objfrmtsk) = False Then
                            Exit Try
                        End If

                    Catch ex As Exception
                        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                    End Try
                End If
            End If
            ShowTasks()
            If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
                Call ShowPatientDetails(False, True)
            End If
        End If
    End Sub

    Private Function ShowTaskSpecificScanDocs(ByVal e2 As gloTaskMail.TaskChangeEventArg, ByVal objfrmtsk As Object, ByVal bIsPortalCall As Boolean) As Boolean

        Dim _ContID As Long = 0
        Dim _DocID As Long = 0
        Dim _PatientID As Long = 0
        Dim _Year As String = ""
        If bIsPortalCall Then
            _PatientID = e2.PatientID
        Else
            Dim oDB As New gloStream.gloDataBase.gloDataBase

            Dim nTaskID As Int64 = e2.TaskID
            Dim query As String
            Try
                oDB.Connect(GetConnectionString)
                '' ContainerID is Stored in TM_TaskMST.nReferenceID1  for referance
                '' DocumentID is Stored In TM_TaskMST.nReferenceID2  for referance.
                query = "SELECT nReferenceID1,nReferenceID2,nPatientID FROM TM_TaskMST WHERE nTaskID = " & nTaskId

                Dim dt As DataTable
                '= New DataTable()  slr new not needed
                dt = oDB.ReadQueryDataTable(query)

                If IsNothing(dt) = False Then
                    If (dt.Rows.Count > 0) Then
                        _ContID = dt.Rows(0)("nReferenceID1")
                        _DocID = dt.Rows(0)("nReferenceID2")
                        _PatientID = dt.Rows(0)("nPatientID")

                    End If
                End If

                oDB.Disconnect()
                oDB.Dispose()
                oDB = Nothing
                If Not IsNothing(dt) Then  ''slr free dt
                    dt.Dispose()
                    dt = Nothing
                End If
            Catch ex As Exception

            End Try
        End If



        If IsAccess(False, _PatientID) = False Then
            Return False
        End If

        If (_DocID > 0 And bIsPortalCall = False) Or (bIsPortalCall) Then 'And _Year <> "" Then
            If oEDocumentV3 Is Nothing Then
                oEDocumentV3 = New gloEDocumentV3.gloEDocV3Management()
            End If
            oEDocumentV3.oPatientExam = New clsPatientExams

            oEDocumentV3.oPatientMessages = New clsMessage
            oEDocumentV3.oPatientLetters = New clsPatientLetters
            oEDocumentV3.oNurseNotes = New clsNurseNotes
            oEDocumentV3.oHistory = New clsPatientHistory
            oEDocumentV3.oLabs = New clsLabs
            oEDocumentV3.oDMS = New gloEDocumentV3.eDocManager.eDocGetList()
            oEDocumentV3.oRxmed = New clsPatientDetails
            oEDocumentV3.oOrders = New clsPatientDetails
            oEDocumentV3.oProblemList = New clsPatientProblemList

            oEDocumentV3.oCriteria = New DocCriteria
            oEDocumentV3.oWord = New clsWordDocument
            oEDocumentV3.dMdi = Me
            If Not objfrmtsk Is Nothing Then
                _objfrmtask = objfrmtsk
                'If (gblnAutoCloseDMSWindow = True) Then
                '    objfrmtsk.Visible = False
                'Else
                objfrmtsk.Enabled = False
                ' End If
                RemoveHandler oEDocumentV3.EvnAcknowledgeTask, AddressOf ShowDMSTask
                AddHandler oEDocumentV3.EvnAcknowledgeTask, AddressOf ShowDMSTask
            End If

            Dim isItDialog As Boolean
            If bIsPortalCall Then
                isItDialog = oEDocumentV3.ShowEDocument(_PatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ScanDocument, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.None, 0)
            Else
                isItDialog = oEDocumentV3.ShowEDocument(_PatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewDocumentForExternalModule, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.DashBoard, _DocID)
            End If

            If (isItDialog = True) Then


                If Not oEDocumentV3 Is Nothing Then
                    If (IsNothing(oEDocumentV3.oPatientExam) = False) Then
                        DirectCast(oEDocumentV3.oPatientExam, clsPatientExams).Dispose()
                        oEDocumentV3.oPatientExam = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oPatientMessages) = False) Then
                        DirectCast(oEDocumentV3.oPatientMessages, clsMessage).Dispose()
                        oEDocumentV3.oPatientMessages = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oPatientLetters) = False) Then
                        DirectCast(oEDocumentV3.oPatientLetters, clsPatientLetters).Dispose()
                        oEDocumentV3.oPatientLetters = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oNurseNotes) = False) Then
                        DirectCast(oEDocumentV3.oNurseNotes, clsNurseNotes).Dispose()
                        oEDocumentV3.oNurseNotes = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oHistory) = False) Then
                        DirectCast(oEDocumentV3.oHistory, clsPatientHistory).Dispose()
                        oEDocumentV3.oHistory = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oLabs) = False) Then
                        DirectCast(oEDocumentV3.oLabs, clsLabs).Dispose()
                        oEDocumentV3.oLabs = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oDMS) = False) Then
                        DirectCast(oEDocumentV3.oDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                        oEDocumentV3.oDMS = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oRxmed) = False) Then
                        DirectCast(oEDocumentV3.oRxmed, clsPatientDetails).Dispose()
                        oEDocumentV3.oRxmed = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oOrders) = False) Then
                        DirectCast(oEDocumentV3.oOrders, clsPatientDetails).Dispose()
                        oEDocumentV3.oOrders = Nothing
                    End If
                    If (IsNothing(oEDocumentV3.oProblemList) = False) Then
                        DirectCast(oEDocumentV3.oProblemList, clsPatientProblemList).Dispose()
                        oEDocumentV3.oProblemList = Nothing
                    End If

                    If (IsNothing(oEDocumentV3.oCriteria) = False) Then
                        DirectCast(oEDocumentV3.oCriteria, DocCriteria).Dispose()
                        oEDocumentV3.oCriteria = Nothing
                    End If
                    RemoveHandler oEDocumentV3.EvnAcknowledgeTask, AddressOf ShowDMSTask
                    oEDocumentV3.Dispose()
                    oEDocumentV3 = Nothing
                End If
            End If
        Else
            MessageBox.Show("This document does not exists.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Return False
        End If
        Return True
    End Function

    Private Function ShowTaskSpecificRCMDocs(ByVal e2 As gloTaskMail.TaskChangeEventArg, ByVal objfrmtsk As Object) As Boolean

        Dim _ContID As Long = 0
        Dim _DocID As Long = 0
        Dim _Year As String = ""

        Dim oDB As New gloStream.gloDataBase.gloDataBase

        Dim nTaskID As Int64 = e2.TaskID
        Dim query As String
        Try
            oDB.Connect(GetConnectionString)
            '' ContainerID is Stored in TM_TaskMST.nReferenceID1  for referance
            '' DocumentID is Stored In TM_TaskMST.nReferenceID2  for referance.
            query = "SELECT nReferenceID1,nReferenceID2 FROM TM_TaskMST WHERE nTaskID = " & nTaskID

            Dim dt As DataTable
            '= New DataTable()  slr new not needed
            dt = oDB.ReadQueryDataTable(query)

            If IsNothing(dt) = False Then
                If (dt.Rows.Count > 0) Then
                    _ContID = dt.Rows(0)("nReferenceID1")
                    _DocID = dt.Rows(0)("nReferenceID2")
                End If
            End If

            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing
            If Not IsNothing(dt) Then  ''slr free dt
                dt.Dispose()
                dt = Nothing
            End If
        Catch ex As Exception

        End Try

        If (_DocID > 0) Then 'And _Year <> "" Then
            If oEDocumentV3 Is Nothing Then
                oEDocumentV3 = New gloEDocumentV3.gloEDocV3Management()
            End If

            oEDocumentV3.dMdi = Me

            If Not objfrmtsk Is Nothing Then
                _objfrmtask = objfrmtsk
                objfrmtsk.Enabled = False

                RemoveHandler oEDocumentV3.EvnAcknowledgeTask, AddressOf ShowDMSTask
                AddHandler oEDocumentV3.EvnAcknowledgeTask, AddressOf ShowDMSTask
            End If

            Dim isItDialog As Boolean

            isItDialog = oEDocumentV3.ShowEDocument(-1, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewDocumentForExternalModule, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.RCM, _DocID)

            'If bIsPortalCall Then
            '    isItDialog = oEDocumentV3.ShowEDocument(_PatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ScanDocument, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.None, 0)
            'Else
            '    isItDialog = oEDocumentV3.ShowEDocument(_PatientID, gloEDocumentV3.Enumeration.enum_OpenEDocumentAs.ViewDocumentForExternalModule, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.DashBoard, _DocID)
            'End If

            If (isItDialog = True) Then
                If Not oEDocumentV3 Is Nothing Then
                    RemoveHandler oEDocumentV3.EvnAcknowledgeTask, AddressOf ShowDMSTask
                    oEDocumentV3.Dispose()
                    oEDocumentV3 = Nothing
                End If
            End If
        Else
            MessageBox.Show("This RCM document does not exists.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Return False
        End If
        Return True
    End Function

#End Region

#Region "View Direct Messages"

    Public Sub ShowDirectMessagesCount()
        If InvokeRequired Then
            Try
                Invoke(New ShowMessagesDelegate(AddressOf ShowDirectMessagesCount))
            Catch ex As Exception

            End Try
        Else
            Try
                Me.Cursor = Cursors.WaitCursor
                Me.GetMessageCount()
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            Finally
                Me.Cursor = Cursors.Default                
            End Try            
        End If
    End Sub

#End Region

#Region "View Messages"

        ''View User messages on dash board

    Public Sub ShowMessages_New()
        If InvokeRequired Then
            Try
                Invoke(New ShowMessagesDelegate(AddressOf ShowMessages_New))
            Catch ex As Exception

            End Try

        Else
            Me.Cursor = Cursors.WaitCursor

            Dim C1MessageSelectedMessageID As Int64
            Dim rowSel As Integer

            If C1Mesages.Row > 1 Then
                C1MessageSelectedMessageID = CType(C1Mesages.GetData(C1Mesages.Row, col_MessageID), Int64)
                rowSel = C1Mesages.RowSel
            End If


            C1Mesages.ScrollBars = ScrollBars.None
            ''change made for problem 00000591
            Dim FontRegular8_25 = gloGlobal.clsgloFont.gFont_SMALL 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
            ''change made for problem 00000591
            Dim FontBold8_25 = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))

            Try
                'C1Mesages.Clear()
                C1Mesages.DataSource = Nothing
                C1Mesages.AllowResizing = C1.Win.C1FlexGrid.AllowResizingEnum.Columns
                C1Mesages.Clear(C1.Win.C1FlexGrid.ClearFlags.All)
                'Set the column Names.                              
                C1Mesages.Cols.Count = col_MessageTotal
                C1Mesages.Rows.Count = 1
                C1Mesages.AllowEditing = False
                Dim csProvider As C1.Win.C1FlexGrid.CellStyle
                Try
                    If (C1Mesages.Styles.Contains("cs_Parent")) Then
                        csProvider = C1Mesages.Styles("cs_Parent")
                    Else
                        csProvider = C1Mesages.Styles.Add("cs_Parent") ''style new for every row
                        csProvider.Font = FontBold8_25  ''New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                        csProvider.BackColor = Color.FromArgb(222, 231, 250)
                        csProvider.ForeColor = Color.FromArgb(21, 66, 139)
                        csProvider.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                        csProvider.ImageSpacing = 2
                        csProvider.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                        csProvider.Border.Color = Color.FromArgb(159, 181, 221)
                    End If
                Catch ex As Exception
                    csProvider = C1Mesages.Styles.Add("cs_Parent") ''style new for every row
                    csProvider.Font = FontBold8_25  ''New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    csProvider.BackColor = Color.FromArgb(222, 231, 250)
                    csProvider.ForeColor = Color.FromArgb(21, 66, 139)
                    csProvider.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csProvider.ImageSpacing = 2
                    csProvider.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                    csProvider.Border.Color = Color.FromArgb(159, 181, 221)
                End Try



                Dim csAppointment As C1.Win.C1FlexGrid.CellStyle
                Try
                    If (C1Mesages.Styles.Contains("cs_Child")) Then
                        csAppointment = C1Mesages.Styles("cs_Child")
                    Else
                        csAppointment = C1Mesages.Styles.Add("cs_Child") ''style new for every row
                        csAppointment.Font = FontRegular8_25 ''New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                        csAppointment.BackColor = Color.FromArgb(240, 247, 255)
                        csAppointment.ForeColor = Color.FromArgb(31, 73, 125)
                        csAppointment.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                        csAppointment.ImageSpacing = 2
                        csAppointment.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                    End If
                Catch ex As Exception
                    csAppointment = C1Mesages.Styles.Add("cs_Child") ''style new for every row
                    csAppointment.Font = FontRegular8_25 ''New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    csAppointment.BackColor = Color.FromArgb(240, 247, 255)
                    csAppointment.ForeColor = Color.FromArgb(31, 73, 125)
                    csAppointment.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csAppointment.ImageSpacing = 2
                    csAppointment.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                End Try
                Dim csAppointment1 As C1.Win.C1FlexGrid.CellStyle
                Try
                    If (C1Mesages.Styles.Contains("cs_Child_Bold")) Then
                        csAppointment1 = C1Mesages.Styles("cs_Child_Bold")
                    Else
                        csAppointment1 = C1Mesages.Styles.Add("cs_Child_Bold") ''style new for every row
                        csAppointment1.Font = FontBold8_25 ''New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                        csAppointment1.BackColor = Color.FromArgb(240, 247, 255)
                        csAppointment1.ForeColor = Color.FromArgb(31, 73, 125)
                        csAppointment1.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                        csAppointment1.ImageSpacing = 2
                        csAppointment1.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                    End If
                Catch ex As Exception
                    csAppointment1 = C1Mesages.Styles.Add("cs_Child_Bold") ''style new for every row
                    csAppointment1.Font = FontBold8_25 ''New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    csAppointment1.BackColor = Color.FromArgb(240, 247, 255)
                    csAppointment1.ForeColor = Color.FromArgb(31, 73, 125)
                    csAppointment1.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csAppointment1.ImageSpacing = 2
                    csAppointment1.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                End Try

                ''below code is necessary to call ownerdrawcell event of c1flexgrid on which we can set images,styles etc.
                C1Mesages.DrawMode = C1.Win.C1FlexGrid.DrawModeEnum.OwnerDraw

                Dim oClsMessages As New clsMessage
                Dim nUserID As Int64
                Dim dt As DataTable
                ' Dim dv As DataView

                nUserID = gnLoginID

                _isMessageFullyLoaded = False
                dt = oClsMessages.GetTopMessages("", nRowCount, nUserID)

                nUserID = Nothing

                oClsMessages.Dispose()
                oClsMessages = Nothing

                If IsNothing(dt) = False Then
                    If (nRowCount > dt.Rows.Count) Then
                        _isMessageFullyLoaded = True
                    End If
                    If (nRowCount < 100) Then
                        nRowCount = 100
                    Else
                        nRowCount = dt.Rows.Count
                        If (nRowCount < 100) Then
                            nRowCount = 100
                        End If
                    End If
                End If

                If Not IsNothing(dt) Then
                    pnl_Messages.Text = "Messages" & " [" & dt.Rows.Count.ToString & "]"
                Else
                    pnl_Messages.Text = "Messages [0]"
                End If

                If IsNothing(dt) = False AndAlso dt.Rows.Count > 0 Then
                    C1Mesages.SetDataBinding(dt, "")
                End If

                C1Mesages.Rows(0).Visible = False
                C1Mesages.Cols(col_MessageNo).Visible = False
                C1Mesages.Cols(col_MessageID).Visible = False
                C1Mesages.Cols(col_MessageDate).Visible = False
                C1Mesages.Cols(col_MsgPatientTemplateName).Visible = True
                C1Mesages.Cols(col_MessagePriority).Visible = True
                C1Mesages.Cols(col_PatientID).Visible = False
                C1Mesages.Cols(col_PatientCode).Visible = False
                C1Mesages.Cols(col_msgPatientName).Visible = False
                C1Mesages.Cols(col_msgFinished).Visible = False
                C1Mesages.Cols(col_MDate).Visible = False
                C1Mesages.Cols(col_TemplateName).Visible = False

                Dim _width As Integer = C1Mesages.Width - 1
                C1Mesages.Cols(col_MessageNo).Width = 0 ''Message NO
                C1Mesages.Cols(col_MsgPatientTemplateName).Width = Convert.ToInt32(_width - 37) ''Message 
                C1Mesages.Cols(col_MessageID).Width = 0 ''Message Id
                C1Mesages.Cols(col_PatientID).Width = 0 ''PatientId
                C1Mesages.Cols(col_MessagePriority).Width = 20

                _width = Nothing

                'code added by pradeep to show total of messages under one date (20100812)
                C1Mesages.Rows(0).Visible = False
                C1Mesages.AllowEditing = False
                C1Mesages.Tree.Column = 3
                C1Mesages.Subtotal(C1.Win.C1FlexGrid.AggregateEnum.Clear)
                C1Mesages.Subtotal(C1.Win.C1FlexGrid.AggregateEnum.Count, 0, 0, 0, "{0}")

                Dim s As CellStyle = C1Mesages.Styles(CellStyleEnum.Subtotal0)
                s.Font = FontBold8_25  ''New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                s.BackColor = Color.FromArgb(222, 231, 250)
                s.ForeColor = Color.FromArgb(21, 66, 139)
                s.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                s.ImageSpacing = 2
                s.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                s.Border.Color = Color.FromArgb(159, 181, 221)

                C1Mesages.Redraw = True
                Dim oMessage As New clsMessage
                If oMessage.IsContainHighPriorityMessage(gnLoginID) Then
                    sslbl_SingleSignOn.Visible = False
                    sslbl_MessagePriority.Visible = True
                Else
                    sslbl_MessagePriority.Visible = False
                End If

                oMessage.Dispose()
                oMessage = Nothing


                If C1Mesages.Rows.Count > 1 Then
                    If C1MessageSelectedMessageID <> 0 Then
                        Dim myrow As C1.Win.C1FlexGrid.Row = (From column In C1Mesages.Rows Where column(col_MessageID) = Convert.ToString(C1MessageSelectedMessageID)).FirstOrDefault()
                        If IsNothing(myrow) = False Then
                            C1Mesages.[Select](myrow.Index, True)
                        Else
                            If C1Mesages.Rows.Count > rowSel AndAlso rowSel > 1 Then
                                C1Mesages.[Select](rowSel, True)
                            End If
                        End If
                    End If
                End If

            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            Finally
                Me.Cursor = Cursors.Default
                If FontRegular8_25 Is Nothing Then
                    FontRegular8_25 = Nothing
                End If
                If FontBold8_25 Is Nothing Then
                    FontBold8_25 = Nothing
                End If

            End Try
            C1Mesages.ScrollBars = ScrollBars.Both
        End If
    End Sub

    Private Sub C1Mesages_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1Mesages.MouseDown

        Try
            If (pnlPatientList.Visible = False) Then
        
                ''Added on 20140709-do not show contextmenu if patient list not visible
                ClearContextMenuStrip(C1Mesages.ContextMenuStrip)
                ClearContextMenuStrip(C1UnfinishedExam.ContextMenuStrip)
                ClearContextMenuStrip(cmnu_messages)
                AssignContextMenuStrip(C1UnfinishedExam.ContextMenuStrip, cmnu_messages)
                AssignContextMenuStrip(C1Mesages.ContextMenuStrip, cmnu_messages)

                Exit Sub
            End If

            If C1Mesages.HitTest(e.X, e.Y).Row >= 1 Then
                If ((C1Mesages.Rows.Count >= 0) AndAlso (C1Mesages.Cols.Count >= col_PatientID)) Then
                    If (CType(C1Mesages.GetData(C1Mesages.HitTest(e.X, e.Y).Row, col_PatientID), Int64) <> gnPatientID AndAlso CType(C1Mesages.GetData(C1Mesages.HitTest(e.X, e.Y).Row, col_PatientID), Int64) <> 0) Then
                        blnPatientStatusOnMessageFired = False
                        If (pnlPatientList.Visible) Then
                            gnPatientID = CType(C1Mesages.GetData(C1Mesages.HitTest(e.X, e.Y).Row, col_PatientID), Int64)
                            Call SelectPatientOnDashboard(gnPatientID)
                        End If

                        '31-Mar-17 Aniket: Resolving Bug #104818 ( Modified): gloEMR: Patient Lock Chart: Application should allow user to change patient as per their selection
                        If blnPatientStatusOnMessageFired = False Then
                            Dim oclsPatReg As New ClsPatientRegistrationDBLayer
                            gstrPatientStatus = oclsPatReg.PatientStatus(gnPatientID, "").ToString()

                            oclsPatReg.Dispose()
                            oclsPatReg = Nothing
                        End If

                        If IsAccess(False, gnPatientID) = False Then
                            Exit Sub
                        End If
                    End If
                End If
            End If


            ''Add context menu  to add message and message history
            C1Mesages.Row = C1Mesages.HitTest(e.X, e.Y).Row
            If e.Button = MouseButtons.Right Then
                If gnPatientID <= 0 Then
                   
                    ClearContextMenuStrip(C1Mesages.ContextMenuStrip)
                    ClearContextMenuStrip(C1UnfinishedExam.ContextMenuStrip)
                    ClearContextMenuStrip(cmnu_messages)
                    AssignContextMenuStrip(C1UnfinishedExam.ContextMenuStrip, cmnu_messages)
                    AssignContextMenuStrip(C1Mesages.ContextMenuStrip, cmnu_messages)

                    Exit Sub
                Else
                    ClearContextMenuStrip(C1Mesages.ContextMenuStrip)
                    ClearContextMenuStrip(C1UnfinishedExam.ContextMenuStrip)
                    ClearContextMenuStrip(cmnu_messages)
                   
                    AssignContextMenuStrip(C1UnfinishedExam.ContextMenuStrip, cmnu_messages)
                    AssignContextMenuStrip(C1Mesages.ContextMenuStrip, cmnu_messages)

                    ''commented by Mayuri:20100424-after right clicking on message panel patient details of message should not selected
                    'SelectedPatientDetail = PatientDetails.Messages
                End If
                Dim oMenuItem As ToolStripMenuItem
                If objUserRights.Messages = True Then
                    C1Mesages.Row = C1Mesages.HitTest(e.X, e.Y).Row
                    oMenuItem = New ToolStripMenuItem
                    oMenuItem.Text = "New Message"
                    oMenuItem.Tag = "Add Message"
                    oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                    oMenuItem.Image = Imgts_PatientDetails.Images(14)
                    cmnu_messages.Items.Add(oMenuItem)

                    AddHandler oMenuItem.Click, AddressOf mnuPatientMessages_Click
                End If
                ''If any messages in the grid then show the history for the selected message
                If C1Mesages.Row > 0 Then
                    If C1Mesages.Rows.Count > 1 Then
                        If Not IsNothing(C1Mesages.Rows(C1Mesages.Row).Node) Then
                            If IsNothing(C1Mesages.GetData(C1Mesages.Row, col_MessageDate)) = False Then
                                If C1Mesages.GetData(C1Mesages.Row, col_MessageDate) <> "0.0" Then
                                    If ((C1Mesages.Rows.Count >= 0) AndAlso (C1Mesages.Cols.Count >= col_MessageID)) Then
                                        If Not IsNothing(CType(C1Mesages.GetData(C1Mesages.RowSel, col_MessageID), Int64)) Then
                                            oMenuItem = New ToolStripMenuItem
                                            oMenuItem.Text = "Message History"
                                            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
                                            oMenuItem.Image = Imgts_PatientDetails.Images(23)
                                            oMenuItem.Tag = (CType(C1Mesages.GetData(C1Mesages.RowSel, col_MessageID), Int64))
                                            cmnu_messages.Items.Add(oMenuItem)
                                            AddHandler oMenuItem.Click, AddressOf ShowMessageHistory
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
        End Try

    End Sub

    Private Sub C1Mesages_DoubleClick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles C1Mesages.DoubleClick
        Dim MessageID As Int64 = 0
        Dim MsgDate As Date
        Try
            If (IsPatientGuidelineOrPatientEducationOpen("Patient Message") = True) Then
                Exit Sub
            End If

            If CheckWordForException() = False Then
                Exit Sub
            End If

            If C1Mesages.Row > 0 Then
                If Not IsNothing(C1Mesages.GetData(C1Mesages.Row, col_MessageDate)) Then
                    If C1Mesages.GetData(C1Mesages.Row, col_MessageDate) <> "0.0" Then


                        If C1Mesages.Rows(C1Mesages.Row).Node.Children = 0 Then

                            If (C1Mesages.Cols.Count >= col_MessageID) Then
                                MessageID = CType(C1Mesages.GetData(C1Mesages.Row, col_MessageID), Int64)
                            End If
                            If (C1Mesages.Cols.Count >= col_MDate) Then
                                MsgDate = CType(C1Mesages.GetData(C1Mesages.Row, col_MDate), DateTime)
                            End If
                            '  Dim objfrmMsg As frmMessages

                            Try
                                If objUserRights.Messages = True Then

                                    If IsAccess(False, (CType(C1Mesages.GetData(C1Mesages.Row, col_PatientID), Int64))) = False Then
                                        Exit Sub
                                    End If

                                    Dim blnIsFinished As Boolean = False
                                    Dim blnRecordLock As Boolean = False

                                    Dim mydt As mytable = Nothing ''slr new not needed
                                    If gblnRecordLocking = True Then
                                        mydt = Scan_n_Lock_Transaction(TrnType.Messages, MessageID, 0, MsgDate)
                                        If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                                            If MessageBox.Show("This message is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Exclamation) = Windows.Forms.DialogResult.Yes Then
                                                ''Record open only for view.
                                                blnRecordLock = True
                                                '' Word document is only view can't add data to documents.
                                                blnIsFinished = True
                                            Else
                                                'Return False
                                                If Not IsNothing(mydt) Then ''slr free mydt
                                                    mydt.Dispose()
                                                    mydt = Nothing
                                                End If
                                                Exit Sub
                                            End If
                                        End If
                                    End If
                                    If Not IsNothing(mydt) Then ''slr free mydt
                                        mydt.Dispose()
                                        mydt = Nothing
                                    End If
                                    'Record Level Locking
                                    'Create instance of Class to get message User 
                                    ' Dim dt As DataTable
                                    'Dim i As Integer

                                    'IF Message is displayed as unfinished Message on the local mc  but is finished from 
                                    'other machine then read the finished status of the Message from database   
                                    Try
                                        Dim oDB As New gloStream.gloDataBase.gloDataBase
                                        Dim strSQL As String
                                        Dim Status As String

                                        strSQL = " SELECT  ISNULL(bIsFinished , 'False' ) AS bIsFinished FROM  Message" _
                                                & " WHERE nMessageID = " & MessageID & " AND nPatientID =" & CType(C1Mesages.GetData(C1Mesages.Row, col_PatientID), Int64) & " AND dtMsgDate ='" & MsgDate & "' "
                                        oDB.Connect(GetConnectionString)
                                        Status = oDB.ExecuteQueryScaler(strSQL)
                                        If Not IsNothing(Status) AndAlso Status.Trim() <> "" Then
                                            blnIsFinished = Convert.ToBoolean(Status)
                                        Else
                                            blnIsFinished = False
                                        End If

                                        oDB.Disconnect()
                                        oDB.Dispose()
                                        oDB = Nothing
                                    Catch ex As Exception

                                    End Try

                                    Dim frm As frmMessages

                                    If objUserRights.Messages = False Then
                                        blnRecordLock = True
                                    End If

                                    frm = frmMessages.GetInstance(MessageID, gnLoginID, MsgDate, CType(C1Mesages.GetData(C1Mesages.Row, col_PatientID), Int64), 1, blnIsFinished, blnRecordLock)

                                    If IsNothing(frm) = True Then
                                        Exit Sub
                                    End If



                                    frm.Text = "Modify Messages"
                                    frm.MdiParent = Me
                                    frm.myCallerMain = Me
                                    frm.IsModify = True
                                    frmVWMessages.blnModify = True

                                    frm.WindowState = FormWindowState.Maximized
                                    frm.BringToFront()
                                    frm.Show()

                                    ShowHideMainMenu(False, False)
                                    pnlMainToolBar.Visible = False

                                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Messages, gloAuditTrail.ActivityCategory.PatientMessages, gloAuditTrail.ActivityType.View, "Patient Message viewed", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success)
                                End If
                            Catch ex As Exception
                                MessageBox.Show(ex.ToString, "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Error)
                                ShowHideMainMenu(True, True)
                                pnlMainToolBar.Visible = True
                            Finally
                            End Try
                        End If
                    End If
                End If
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub pnl_MessagesContainer_Resize(ByVal sender As Object, ByVal e As System.EventArgs) Handles pnl_MessagesContainer.Resize
        Try
            If C1Mesages.Cols.Count > 0 Then
                C1Mesages.Dock = DockStyle.Fill
                Dim _width As Integer = pnl_MessagesContainer.Width - 2

                C1Mesages.Cols(col_MsgPatientTemplateName).Width = Convert.ToInt32(_width - 36)
                C1Mesages.Cols(col_MessagePriority).Width = Convert.ToInt32(20)
            End If

        Catch ex As Exception

        End Try
    End Sub
#End Region

#Region "View Appointments"

    ''' <summary>
    ''' This function will update the Clinical status for all the Appointments in the List
    ''' </summary>
    ''' <param name="UpdateOnlyForSelectedPatient"></param>
    ''' Problem: 68
    ''' new parameter added to update the color on status column for all appointments on left hand side appointment panel.
    ''' by default it is True to update the color for specific patient only.
    ''' <remarks></remarks>
    Private Sub UpdateAppointmentStatus(Optional ByVal UpdateOnlyForSelectedPatient As Boolean = True)

        Me.Cursor = Cursors.WaitCursor
        Try
            If IsNothing(C1Appointments) = False Then
                For rowIndex As Int32 = 1 To C1Appointments.Rows.Count - 1
                    UpdateAppointmentStatus(rowIndex, UpdateOnlyForSelectedPatient)
                Next
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            C1Appointments.ScrollBars = ScrollBars.Both
            Me.Cursor = Cursors.Default
        End Try
    End Sub

    ''' <summary>
    ''' This function will update the Clinical status for only for the given row in the list
    ''' </summary>
    ''' <param name="rowIndex">Selected Row Index</param>
    ''' <param name="UpdateOnlyForSelectedPatient">Pass true if calling for a patient only</param>
    ''' <remarks></remarks>
    ''' ''REverted changes related to styles to solve issue#71466- gloEMR-Appointment->Application shows incorrect colors for patient status on Dashboard.
    Private Sub UpdateAppointmentStatus(ByVal rowIndex As Int32, Optional ByVal UpdateOnlyForSelectedPatient As Boolean = False)

        Dim apptPatientID As Int64
        Dim NormalCellBackColor As Color = Color.FromArgb(240, 247, 255)
        Dim cls As New clsDoctorsDashBoard
        Dim dtENV As DataTable  ''slr new not needed

        '' Bug #7715: Test Party issue -Error when clicked on Patient Status color buttons 
        If C1Appointments.Cols.Count <> col_Count Then
            Exit Sub
        End If

        apptPatientID = Convert.ToInt64(C1Appointments.GetData(rowIndex, col_AppPatientID))

        If (UpdateOnlyForSelectedPatient) Then
            If apptPatientID <> gnPatientID Then
                Exit Sub
            End If
        End If

        dtENV = cls.Get_Patient_ClinicEnvironment(apptPatientID)

        If IsNothing(dtENV) = False Then

            'Problem: 68
            'colors are not resetting after the sorting of appointment grid.
            '' Reset the appointment status to the default 
            'SLR: To be Changed on 8/5/2014
            Dim defaultString As String = "cs_StatusColorDefault" & rowIndex.ToString("D5")
            Dim Style_Default As C1.Win.C1FlexGrid.CellStyle = Nothing ' C1Appointments.Styles.Add("cs_StatusColor" & col_color0 & rowIndex)


            Try
                If (C1Appointments.Styles.Contains(defaultString)) Then
                    Style_Default = C1Appointments.Styles(defaultString)
                Else
                    Style_Default = C1Appointments.Styles.Add(defaultString)

                End If
            Catch ex As Exception
                Style_Default = C1Appointments.Styles.Add(defaultString)

            End Try


            Style_Default.BackColor = NormalCellBackColor
            Style_Default.ForeColor = NormalCellBackColor

            C1Appointments.SetCellStyle(rowIndex, col_color0, Style_Default)
            C1Appointments.SetCellStyle(rowIndex, col_color1, Style_Default)
            C1Appointments.SetCellStyle(rowIndex, col_color2, Style_Default)
            C1Appointments.SetCellStyle(rowIndex, col_color3, Style_Default)
            C1Appointments.SetCellStyle(rowIndex, col_color4, Style_Default)
            C1Appointments.SetCellStyle(rowIndex, col_color5, Style_Default)

            '' Check for the updated status & Set Patient's Clinical Environment Color Codes
            For j As Integer = 0 To dtENV.Rows.Count - 1
                Dim rg As C1.Win.C1FlexGrid.CellRange
                'SLR: changed on 8/5/2014
                Dim myString As String = "ENV" & rowIndex.ToString("D5") & "" & j.ToString("D5")

                Dim cStyle As C1.Win.C1FlexGrid.CellStyle = Nothing 'C1Appointments.Styles.Add(myString)


                If dtENV.Rows(j)("nColor") <> -1 Then
                    Try
                        If (C1Appointments.Styles.Contains(myString)) Then
                            cStyle = C1Appointments.Styles(myString)
                        Else
                            cStyle = C1Appointments.Styles.Add(myString)
                            cStyle.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New Font("Tahoma", 8.25F, FontStyle.Bold)
                        End If
                    Catch ex As Exception
                        cStyle = C1Appointments.Styles.Add(myString)
                        cStyle.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New Font("Tahoma", 8.25F, FontStyle.Bold)
                    End Try
                    cStyle.ForeColor = Color.FromArgb(dtENV.Rows(j)("nColor"))
                    cStyle.BackColor = Color.FromArgb(dtENV.Rows(j)("nColor")) ''Color.White
                    cStyle.TextEffect = TextEffectEnum.Flat
                    cStyle.Border.Style = BorderStyleEnum.Flat
                    cStyle.TextAlign = TextAlignEnum.CenterCenter

                Else
                    cStyle = Nothing
                End If

                Select Case dtENV.Rows(j)("nEnvironment")
                    Case 1
                        If IsNothing(cStyle) = False Then
                            rg = C1Appointments.GetCellRange(rowIndex, col_color0, rowIndex, col_color0)
                            rg.Style = cStyle
                        Else
                            'SLR: To be changed on 8/5/2014
                            Dim myColorString As String = "cs_StatusColor" & col_color0.ToString("D5") & rowIndex.ToString("D5")
                            Dim Style As C1.Win.C1FlexGrid.CellStyle = Nothing 'C1Appointments.Styles.Add(myColorString)

                            Try
                                If (C1Appointments.Styles.Contains(myColorString)) Then
                                    Style = C1Appointments.Styles(myColorString)
                                Else
                                    Style = C1Appointments.Styles.Add(myColorString)

                                End If
                            Catch ex As Exception
                                Style = C1Appointments.Styles.Add(myColorString)

                            End Try
                            Style.BackColor = NormalCellBackColor
                            Style.ForeColor = NormalCellBackColor

                            C1Appointments.SetCellStyle(rowIndex, col_color0, Style)
                        End If
                    Case 2
                        If IsNothing(cStyle) = False Then
                            rg = C1Appointments.GetCellRange(rowIndex, col_color1, rowIndex, col_color1)
                            rg.Style = cStyle
                        Else
                            'SLR: To be changed on 8/5/2014
                            '  Dim Style As C1.Win.C1FlexGrid.CellStyle = C1Appointments.Styles.Add("cs_StatusColor" & col_color1 & rowIndex)
                            Dim myColorString As String = "cs_StatusColor" & col_color1.ToString("D5") & rowIndex.ToString("D5")
                            Dim Style As C1.Win.C1FlexGrid.CellStyle = Nothing 'C1Appointments.Styles.Add(myColorString)

                            Try
                                If (C1Appointments.Styles.Contains(myColorString)) Then
                                    Style = C1Appointments.Styles(myColorString)
                                Else
                                    Style = C1Appointments.Styles.Add(myColorString)

                                End If
                            Catch ex As Exception
                                Style = C1Appointments.Styles.Add(myColorString)

                            End Try
                            Style.BackColor = NormalCellBackColor
                            Style.ForeColor = NormalCellBackColor

                            C1Appointments.SetCellStyle(rowIndex, col_color1, Style)
                        End If
                    Case 3
                        If IsNothing(cStyle) = False Then
                            rg = C1Appointments.GetCellRange(rowIndex, col_color2, rowIndex, col_color2)
                            rg.Style = cStyle
                        Else
                            'SLR: To be changed on 8/5/2014
                            ' Dim Style As C1.Win.C1FlexGrid.CellStyle = C1Appointments.Styles.Add("cs_StatusColor" & col_color2 & rowIndex)
                            Dim myColorString As String = "cs_StatusColor" & col_color2.ToString("D5") & rowIndex.ToString("D5")
                            Dim Style As C1.Win.C1FlexGrid.CellStyle = Nothing 'C1Appointments.Styles.Add(myColorString)

                            Try
                                If (C1Appointments.Styles.Contains(myColorString)) Then
                                    Style = C1Appointments.Styles(myColorString)
                                Else
                                    Style = C1Appointments.Styles.Add(myColorString)

                                End If
                            Catch ex As Exception
                                Style = C1Appointments.Styles.Add(myColorString)

                            End Try
                            Style.BackColor = NormalCellBackColor
                            Style.ForeColor = NormalCellBackColor

                            C1Appointments.SetCellStyle(rowIndex, col_color2, Style)
                        End If
                    Case 4
                        If IsNothing(cStyle) = False Then
                            rg = C1Appointments.GetCellRange(rowIndex, col_color3, rowIndex, col_color3)
                            rg.Style = cStyle
                        Else
                            'SLR: To be changed on 8/5/2014
                            '  Dim Style As C1.Win.C1FlexGrid.CellStyle = C1Appointments.Styles.Add("cs_StatusColor" & col_color3 & rowIndex)
                            Dim myColorString As String = "cs_StatusColor" & col_color3.ToString("D5") & rowIndex.ToString("D5")
                            Dim Style As C1.Win.C1FlexGrid.CellStyle = Nothing 'C1Appointments.Styles.Add(myColorString)

                            Try
                                If (C1Appointments.Styles.Contains(myColorString)) Then
                                    Style = C1Appointments.Styles(myColorString)
                                Else
                                    Style = C1Appointments.Styles.Add(myColorString)

                                End If
                            Catch ex As Exception
                                Style = C1Appointments.Styles.Add(myColorString)

                            End Try
                            Style.BackColor = Color.FromArgb(240, 247, 255)
                            Style.ForeColor = NormalCellBackColor


                            C1Appointments.SetCellStyle(rowIndex, col_color3, Style)
                        End If
                    Case 5
                        If IsNothing(cStyle) = False Then
                            rg = C1Appointments.GetCellRange(rowIndex, col_color4, rowIndex, col_color4)
                            rg.Style = cStyle
                        Else
                            'SLR: To be changed on 8/5/2014
                            ' Dim Style As C1.Win.C1FlexGrid.CellStyle = C1Appointments.Styles.Add("cs_StatusColor" & col_color4 & rowIndex)
                            Dim myColorString As String = "cs_StatusColor" & col_color4.ToString("D5") & rowIndex.ToString("D5")
                            Dim Style As C1.Win.C1FlexGrid.CellStyle = Nothing 'C1Appointments.Styles.Add(myColorString)

                            Try
                                If (C1Appointments.Styles.Contains(myColorString)) Then
                                    Style = C1Appointments.Styles(myColorString)
                                Else
                                    Style = C1Appointments.Styles.Add(myColorString)

                                End If
                            Catch ex As Exception
                                Style = C1Appointments.Styles.Add(myColorString)

                            End Try
                            Style.BackColor = NormalCellBackColor
                            Style.ForeColor = NormalCellBackColor

                            C1Appointments.SetCellStyle(rowIndex, col_color4, Style)
                        End If
                    Case 6
                        If IsNothing(cStyle) = False Then
                            rg = C1Appointments.GetCellRange(rowIndex, col_color5, rowIndex, col_color5)
                            rg.Style = cStyle
                        Else
                            'SLR: To be changed on 8/5/2014
                            'Dim Style As C1.Win.C1FlexGrid.CellStyle = C1Appointments.Styles.Add("cs_StatusColor" & col_color5 & rowIndex)
                            Dim myColorString As String = "cs_StatusColor" & col_color5.ToString("D5") & rowIndex.ToString("D5")
                            Dim Style As C1.Win.C1FlexGrid.CellStyle = Nothing 'C1Appointments.Styles.Add(myColorString)

                            Try
                                If (C1Appointments.Styles.Contains(myColorString)) Then
                                    Style = C1Appointments.Styles(myColorString)
                                Else
                                    Style = C1Appointments.Styles.Add(myColorString)

                                End If
                            Catch ex As Exception
                                Style = C1Appointments.Styles.Add(myColorString)

                            End Try
                            Style.BackColor = NormalCellBackColor
                            Style.ForeColor = NormalCellBackColor

                            C1Appointments.SetCellStyle(rowIndex, col_color5, Style)
                        End If
                End Select
                cStyle = Nothing
                rg = Nothing
            Next
        End If

        If Not IsNothing(dtENV) Then
            dtENV.Dispose()
            dtENV = Nothing
        End If
        cls = Nothing
    End Sub

    Public Sub ShowAppointments()
        Me.Cursor = Cursors.WaitCursor
        Try
            'IF C1Appointment column rezised then only save in database 
            If _isAppointmentGridColumnResize = True Then
                SaveAppointmentColumnWidth()
            End If

            'C1Appointments.Clear()
            C1Appointments.ScrollBars = ScrollBars.None
            C1Appointments.DataSource = Nothing
            C1Appointments.AllowResizing = C1.Win.C1FlexGrid.AllowResizingEnum.Columns
            C1Appointments.Clear(C1.Win.C1FlexGrid.ClearFlags.All)

            'Problem: 68
            'commented the ownerdraw event due to status column not changing the color on grid sort action.
            'C1Appointments.DrawMode = C1.Win.C1FlexGrid.DrawModeEnum.OwnerDraw

            C1Appointments.Cols.Count = col_Count ''Sandip Darade  20100308
            C1Appointments.Rows.Count = 1
            C1Appointments.AllowEditing = False
            C1Appointments.Styles.Focus.BackColor = Color.FromArgb(255, 224, 160)

            Dim NormalCellBackColor As Color = Color.FromArgb(240, 247, 255)
            '  imgAppointmentSetCount = 1

            Dim rrDueDate As New ArrayList ''Used to Store DueDates and sort it afterwards
            '   Dim i As Integer
            Dim dt As DataTable ''slr new not needed
            dt = GetAppointments()

            'Dim oPatient As New gloPatient.gloPatient(GetConnectionString)
            'Dim oClsDashBoard As New clsDoctorsDashBoard

            Dim strPatientname As String = "" '' This string contains: Patient Name
            Dim strLocation As String = "" '' This string contains: Patient Name
            Dim strtime As String = "" '' This string contains: Patient Name
            'Dim _PatientID As Int64
            'Dim _PatientName As String
            C1Appointments.Cols(col_AppTime).Format = "t"
            Dim ParentRowIndex As Int32 = 0

            If IsNothing(dt) = False Then
                Me.pnlNav_Appointments.Text = "Appointments" & " [" & dt.Rows.Count.ToString & "]"
                C1Appointments.DataSource = dt
                dt.Columns.Add("StyleText")
            End If


            C1Appointments.SetData(0, col_No, "No.")
            C1Appointments.SetData(0, col_AppId, "MST ID")
            C1Appointments.SetData(0, col_PatientName, "Patient")
            C1Appointments.SetData(0, col_AppDate, "End Date")
            C1Appointments.SetData(0, col_AppPatientID, "Patient ID")
            C1Appointments.SetData(0, col_ProviderName, "Provider")
            C1Appointments.SetData(0, col_ProviderID, "Provider ID")
            C1Appointments.SetData(0, col_AppTime, "Time")
            C1Appointments.SetData(0, col_AppLocation, "Location")


            C1Appointments.Cols(col_No).Visible = False
            C1Appointments.Cols(col_AppId).Visible = False
            C1Appointments.Cols(col_AppDate).Visible = False
            C1Appointments.Cols(col_PatientName).Visible = True
            C1Appointments.Cols(col_AppTime).Visible = True
            C1Appointments.Cols(col_AppLocation).Visible = True
            C1Appointments.Cols(col_AppPatientID).Visible = False
            C1Appointments.Cols(col_ProviderID).Visible = False  '' ProviderID
            C1Appointments.Cols(col_AppDtlId).Visible = False
            C1Appointments.Cols(col_AppointmentType).Visible = False

            C1Appointments.Cols(col_BannerHeaderColor).Visible = False  '' Color

            C1Appointments.Cols(col_color1).Visible = True  '' color
            C1Appointments.Cols(col_color2).Visible = True
            C1Appointments.Cols(col_color3).Visible = True
            C1Appointments.Cols(col_color4).Visible = True
            C1Appointments.Cols(col_color5).Visible = True
            If IsNothing(dt) = False Then
                C1Appointments.Cols("StyleText").Visible = False
            End If
            ''        
            C1Appointments.Cols(col_ProviderName).Visible = True '' Provider Name 


            Dim _designWidth As Boolean = False
            'Check in database and load save settings
            _designWidth = LoadAppointmentColumnWidth()

            If _designWidth = False Then
                Dim _width As Integer = C1Appointments.Width - 120 ''Convert.ToInt32(0.1 * pnlNav_AppointmentsContainer.Width)

                C1Appointments.Cols(col_AppDate).Width = 0 ''Triage Date
                C1Appointments.Cols(col_No).Width = 0 ''Triage NO
                C1Appointments.Cols(col_AppId).Width = 0 ''Triage Id
                C1Appointments.Cols(col_AppPatientID).Width = 0 ''Patient Id
                C1Appointments.Cols(col_AppDtlId).Width = 0
                C1Appointments.Cols(col_AppTime).Width = 60
                C1Appointments.Cols(col_AppLocation).Width = Convert.ToInt32(_width * 0.29)
                C1Appointments.Cols(col_PatientName).Width = Convert.ToInt32(_width * 0.29) ''Patient Name
                C1Appointments.Cols(col_ProviderName).Width = Convert.ToInt32(_width * 0.29) ''Provider Name
                C1Appointments.Cols(col_ProviderID).Width = 0 ''ProviderID

                C1Appointments.Cols(col_BannerHeaderColor).Width = 0 ''color

                C1Appointments.Cols(col_color0).Width = 9 ''Colorcode
                C1Appointments.Cols(col_color1).Width = 9 ''Colorcode
                C1Appointments.Cols(col_color2).Width = 9 ''Colorcode
                C1Appointments.Cols(col_color3).Width = 9 ''Colorcode
                C1Appointments.Cols(col_color4).Width = 9 ''Colorcode
                C1Appointments.Cols(col_color5).Width = 9 ''Colorcode
                ' Save Column Settings
                SaveAppointmentColumnWidth()
            End If



            C1Appointments.Cols(col_AppTime).TextAlign = TextAlignEnum.RightCenter

            C1Appointments.Cols(col_AppTime).DataType = GetType(System.DateTime)
            C1Appointments.Cols(col_AppTime).Format = "h:mm tt"

            C1Appointments.Cols(col_color0).AllowResizing = False  '' color
            C1Appointments.Cols(col_color1).AllowResizing = False
            C1Appointments.Cols(col_color2).AllowResizing = False
            C1Appointments.Cols(col_color3).AllowResizing = False
            C1Appointments.Cols(col_color4).AllowResizing = False
            C1Appointments.Cols(col_color5).AllowResizing = False
            C1Appointments.Cols(col_AppTime).AllowResizing = False
            '' start Merge header for all color columns 
            '   Dim colstyle As C1.Win.C1FlexGrid.CellRange
            Dim cscolstyle As C1.Win.C1FlexGrid.CellStyle = Nothing 'C1Appointments.Styles.Add("cs")
            Try
                If (C1Appointments.Styles.Contains("cs")) Then
                    cscolstyle = C1Appointments.Styles("cs")
                Else
                    cscolstyle = C1Appointments.Styles.Add("cs")
                    cscolstyle.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    cscolstyle.BackColor = Color.FromArgb(86, 126, 211)
                    cscolstyle.ForeColor = Color.White
                    cscolstyle.Border.Color = Color.FromArgb(159, 181, 221)
                    cscolstyle.Border.Width = 1
                    cscolstyle.TextAlign = TextAlignEnum.CenterCenter
                End If
            Catch ex As Exception
                cscolstyle = C1Appointments.Styles.Add("cs")
                cscolstyle.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                cscolstyle.BackColor = Color.FromArgb(86, 126, 211)
                cscolstyle.ForeColor = Color.White
                cscolstyle.Border.Color = Color.FromArgb(159, 181, 221)
                cscolstyle.Border.Width = 1
                cscolstyle.TextAlign = TextAlignEnum.CenterCenter
            End Try


            C1Appointments.AllowMerging = AllowMergingEnum.Custom
            Dim cs As CellRange = C1Appointments.GetCellRange(0, col_color0, 0, col_color5)
            cs.Data = " Status "
            cs.Style = cscolstyle

            C1Appointments.MergedRanges.Add(cs, False)

            '' End Merge header for all color columns 



            C1Appointments.SelectionMode = SelectionModeEnum.Cell

            C1Appointments.AllowDragging = False

            C1Appointments.Row = -1
            C1Appointments.Col = -1
            'IsDrawAppointment = False

            'Problem: 68
            'called the update appointment status function to update the colors on status column.
            '' Update appointment status
            UpdateAppointmentStatus(False)

            SetColor(False)

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            C1Appointments.ScrollBars = ScrollBars.Both
            Me.Cursor = Cursors.Default

        End Try
    End Sub


    Private Sub SetColor(bln As Boolean)
        Dim cstyle As C1.Win.C1FlexGrid.CellStyle
        Try
            If (C1Appointments.Styles.Contains("nStyle")) Then
                cstyle = C1Appointments.Styles("nStyle")
            Else
                cstyle = C1Appointments.Styles.Add("nStyle")
            End If

        Catch ex As Exception
            cstyle = C1Appointments.Styles.Add("nStyle")
        End Try

        Dim str As String = String.Empty
        Dim lensel As Int32 = 1

        For Len As Integer = 1 To C1Appointments.Rows.Count - 1

            If Not IsDBNull(C1Appointments.Rows(Len)(17)) Then
                cstyle.BackColor = System.Drawing.ColorTranslator.FromHtml(Convert.ToString(C1Appointments.Rows(Len)(17)))

                ''''code added for case CAS-04523-L8Z5R1
                cstyle.ForeColor = gloGlobal.clsgloFont.BestForegroundColorForBackground(cstyle.BackColor)

                C1Appointments.SetCellStyle(Len, col_PatientName, cstyle)
                cstyle = Nothing
            Else
                If bln Then
                    cstyle = C1Appointments.GetCellStyle(Len, col_AppTime)
                    'cstyle.BackColor = Color.FromArgb(240, 247, 255)
                    'cstyle.ForeColor = Color.FromArgb(31, 73, 125)

                    C1Appointments.SetCellStyle(Len, col_PatientName, cstyle)

                    cstyle = Nothing
                End If
            End If

            Dim myString As String = "nStyle" & Len.ToString()

            Try
                If (C1Appointments.Styles.Contains(myString)) Then
                    cstyle = C1Appointments.Styles(myString)
                Else
                    cstyle = C1Appointments.Styles.Add(myString)
                End If
            Catch ex As Exception
                cstyle = C1Appointments.Styles.Add(myString)
            End Try
        Next
    End Sub


    ''' <summary>
    ''' Loads the width of the appointment column.
    ''' </summary>
    Private Function LoadAppointmentColumnWidth() As Boolean
        Dim _designWidth As Boolean = False
        Try
            Dim oSetting As New gloSettings.GeneralSettings(GetConnectionString)
            _designWidth = oSetting.LoadGridColumnWidth(C1Appointments, gloSettings.ModuleOfGridColumn.Appointment, gloGlobal.gloPMGlobal.UserID)
            oSetting.Dispose()
            oSetting = Nothing
            Return _designWidth
        Catch ex As Exception
            Return _designWidth
            ex.ToString()
            ex = Nothing
        End Try
    End Function
    ''' <summary>
    ''' Saves the width of the appointment column.
    ''' </summary>
    Private Sub SaveAppointmentColumnWidth()
        Try
            Dim oSetting As New gloSettings.GeneralSettings(GetConnectionString)
            oSetting.SaveGridColumnWidth(C1Appointments, gloSettings.ModuleOfGridColumn.Appointment, gloGlobal.gloPMGlobal.UserID)
            oSetting.Dispose()
            oSetting = Nothing
            _isAppointmentGridColumnResize = False
        Catch ex As Exception
            ex.ToString()
            ex = Nothing
        End Try
    End Sub


    ''' <summary>
    ''' This function will return the list of appointments for provider as well as resources (optimized function)
    ''' Added by pradeep godse
    ''' </summary>
    ''' <returns></returns>
    ''' <remarks></remarks>
    ''' 



    Private Function GetAppointments() As DataTable
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParam As gloDatabaseLayer.DBParameters


        Try
            oDB.Connect(False)
            oParam = New gloDatabaseLayer.DBParameters
            oParam.Add("@nProviderId", gnSelectedProviderID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@nAppointmentDate", gloDate.DateAsNumber(dtPatientOnDate.ToString), ParameterDirection.Input, SqlDbType.Int)
            oParam.Add("@bShowCheckedOutAppointment", gblnShowCheckedOutAppointment, ParameterDirection.Input, SqlDbType.Bit)
            oParam.Add("@nClinicID", gnClinicID, ParameterDirection.Input, SqlDbType.Int)
            Dim dtAppointment As New DataTable()
            oDB.Retrive("gsp_GetProviderAppointments", oParam, dtAppointment)

            oParam.Dispose()
            oParam = Nothing

            oDB.Disconnect()
           

            Return dtAppointment

        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.[Error])
            Return Nothing
        Finally
            'If Not IsNothing(dtAppointment) Then
            '    dtAppointment.Dispose()
            '    dtAppointment = Nothing
            'End If
            If Not IsNothing(oDB) Then  ''slr free odb
                oDB.Dispose()
                oDB = Nothing
            End If
        End Try

    End Function

    Private Sub C1Appointments_AfterResizeColumn(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.RowColEventArgs) Handles C1Appointments.AfterResizeColumn
        _isAppointmentGridColumnResize = True
    End Sub



    'Problem: 68
    'The After Sort event is added to catch the sort action and then update the appointment status color on appointment grid accordingly new order.
    Private Sub C1Appointments_AfterSort(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.SortColEventArgs) Handles C1Appointments.AfterSort
        '' Update appointment status
        UpdateAppointmentStatus(False)
        SetColor(True)
    End Sub

    ''' <summary>
    ''' This will set the Context Menu for the Appointment Grid
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks></remarks>
    Private Sub C1Appointments_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1Appointments.MouseDown
        Try


            If (pnlPatientList.Visible = False) Then
                'Try
                '    If (IsNothing(C1Appointments.ContextMenuStrip) = False) Then
                '        C1Appointments.ContextMenuStrip.Dispose()
                '        C1Appointments.ContextMenuStrip = Nothing
                '    End If
                'Catch ex As Exception

                'End Try
                ClearContextMenuStrip(oPatientListControl.ContextMenuStrip)

                ClearContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip)

                ClearContextMenuStrip(C1Appointments.ContextMenuStrip)

                ClearContextMenuStrip(pnlRightFill.ContextMenuStrip)

                ClearContextMenuStrip(pnlLeft.ContextMenuStrip)

                ClearContextMenuStrip(cMnuPatient)

                AssignContextMenuStrip(oPatientListControl.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(C1Appointments.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(pnlRightFill.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(pnlLeft.ContextMenuStrip, cMnuPatient)



                '  C1Appointments.ContextMenuStrip = Nothing
                Exit Sub
            End If
            If e.Button = Windows.Forms.MouseButtons.Right Then
                _IsFromAppointmentforTemplatePrint = True

                'line added by dipak 20091014 to solve the problem of Hide  Context menu For  Parent Tree Node on Appointments (i.e. Date)
                'line commented as move to down in else case
                'C1Appointments.ContextMenuStrip = Nothing
                If C1Appointments.HitTest(e.X, e.Y).Row >= 1 Then
                    '20090825 Bug_id 2231(Easily masking to a Single Patient Name)
                    'commented by Mayuri
                    'if condition added by dipak to solve problem of Hide  Context menu For  Parent Tree Node on Appointments (i.e. Date)
                    'due to condition on right click on parent node i.e. Date context menu not display.
                    '' If (C1Appointments.Rows(C1Appointments.HitTest(e.X, e.Y).Row).Node.Level > 0) Then

                    '' 20110127 - Bug #7715: Test Party issue -Error when clicked on Patient Status color buttons 
                    If C1Appointments.Cols.Count <> col_Count Then
                        Exit Sub
                    End If
                    ''
                    If (CType(C1Appointments.GetData(C1Appointments.HitTest(e.X, e.Y).Row, col_AppPatientID), Int64) <> gnPatientID) Then
                        If (pnlPatientList.Visible) Then
                            gnPatientID = CType(C1Appointments.GetData(C1Appointments.HitTest(e.X, e.Y).Row, col_AppPatientID), Int64)
                            'oPatientListControl.SelectPatient(gnPatientID)
                            ''Read Patient Status on select Case #00000189 : EMR Dashboard
                            ''Bug found in Lock Charts. Go to (or search) a patient with a locked chart. Select the patient > right click on a patient that is in the Appointment pane on the dashboard (left access bar). A message will display saying the patient is locked when they are not.

                            Dim oclsPatReg As New ClsPatientRegistrationDBLayer
                            gstrPatientStatus = oclsPatReg.PatientStatus(C1Appointments.GetData(C1Appointments.HitTest(e.X, e.Y).Row, col_AppPatientID), "").ToString()
                            If Not IsNothing(oclsPatReg) Then
                                oclsPatReg.Dispose()
                                oclsPatReg = Nothing
                            End If

                            Call SelectPatientOnDashboard(gnPatientID)
                        End If
                        '1)select appoinment node
                        '2)select date node
                        '3)select appoinment node which was selected previously.
                        'content menu not shown
                    End If
                    'end dipak20091017
                    ''Sandip Darade Add context menu  20090716
                    C1Appointments.Row = C1Appointments.HitTest(e.X, e.Y).Row

                    If IsAccess(False, (CType(C1Appointments.GetData(C1Appointments.HitTest(e.X, e.Y).Row, col_AppPatientID), Int64))) = False Then
                        Exit Sub
                    Else
                        _IsFromAppointment = True
                        Call FillMenus()
                        Call FillAppointmentMenus(_IsFromAppointmentforTemplatePrint)

                        If (CType(C1Appointments.GetData(C1Appointments.Row, col_AppDate), Date) = Date.Today) Then
                            Dim _appointmentID As Int64 = CType(C1Appointments.GetData(C1Appointments.Row, col_AppId), Int64)
                            FillCheckInCheckOutMenu(_appointmentID)
                        End If
                        'Try
                        '    If (IsNothing(C1Appointments.ContextMenuStrip) = False) Then
                        '        C1Appointments.ContextMenuStrip.Dispose()
                        '        C1Appointments.ContextMenuStrip = Nothing
                        '    End If
                        'Catch ex As Exception

                        'End Try
                        C1Appointments.ContextMenuStrip = cMnuPatient
                    End If
                Else
                    'Try
                    '    If (IsNothing(C1Appointments.ContextMenuStrip) = False) Then
                    '        C1Appointments.ContextMenuStrip.Dispose()
                    '        C1Appointments.ContextMenuStrip = Nothing
                    '    End If
                    'Catch ex As Exception

                    'End Try
                    'line added by dipak 20091015 to solve the problem of Hide  Context menu For  Parent Tree Node on Appoinments (i.e. Date)
                    ' C1Appointments.ContextMenuStrip = Nothing
                    ClearContextMenuStrip(oPatientListControl.ContextMenuStrip)

                    ClearContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip)

                    ClearContextMenuStrip(C1Appointments.ContextMenuStrip)

                    ClearContextMenuStrip(pnlRightFill.ContextMenuStrip)

                    ClearContextMenuStrip(pnlLeft.ContextMenuStrip)

                    ClearContextMenuStrip(cMnuPatient)

                    AssignContextMenuStrip(oPatientListControl.ContextMenuStrip, cMnuPatient)

                    AssignContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip, cMnuPatient)

                    AssignContextMenuStrip(C1Appointments.ContextMenuStrip, cMnuPatient)

                    AssignContextMenuStrip(pnlRightFill.ContextMenuStrip, cMnuPatient)

                    AssignContextMenuStrip(pnlLeft.ContextMenuStrip, cMnuPatient)
                End If
            End If
        Catch ex As Exception


        End Try
    End Sub


    Private Sub pnlNav_AppointmentsContainer_Resize(ByVal sender As Object, ByVal e As System.EventArgs) Handles pnlNav_AppointmentsContainer.Resize
        Try
            Dim _width As Integer = C1Appointments.Width - 120

            If IsNothing(C1Appointments.DataSource) = False Then
                C1Appointments.Cols(col_AppDate).Width = 0 ''Triage Date
                C1Appointments.Cols(col_No).Width = 0 ''Triage NO
                C1Appointments.Cols(col_AppId).Width = 0 ''Triage Id
                C1Appointments.Cols(col_AppPatientID).Width = 0 ''Patient Id

                C1Appointments.Cols(col_AppTime).Width = 60

                C1Appointments.Cols(col_ProviderID).Width = 0 ''ProviderID
            End If

        Catch ex As Exception

        End Try

    End Sub

#End Region

#Region "View Unfinished Exams"
    ''View Unfinished Exams on dash board
    Private Sub pnlNav_UnfinishedExamContainer_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        ShowUnfinishedExams()
    End Sub

    Public Sub ShowUnfinishedExams()

        Me.Cursor = Cursors.WaitCursor
        If IsAccess(True) = False Then
            Me.Cursor = Cursors.Default
            Exit Sub
        End If
        ''Changes made for problem 00000591  
        Dim FontRegular8_25 = gloGlobal.clsgloFont.gFont_SMALL 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
        Dim FontBold8_25 = gloGlobal.clsgloFont.gFont_SMALL_BOLD ' New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))


        C1UnfinishedExam.BeginInit()
        Try
            'C1UnfinishedExam.Clear()
            C1UnfinishedExam.DataSource = Nothing

            C1UnfinishedExam.AllowResizing = C1.Win.C1FlexGrid.AllowResizingEnum.Columns
            C1UnfinishedExam.Clear(C1.Win.C1FlexGrid.ClearFlags.All)
            'Set the column Names.                              
            C1UnfinishedExam.Cols.Count = col_UnfinishedExamCount
            C1UnfinishedExam.Rows.Count = 1
            C1UnfinishedExam.AllowEditing = False
            C1UnfinishedExam.ShowCellLabels = True

            Dim csProvider As C1.Win.C1FlexGrid.CellStyle '= C1UnfinishedExam.Styles.Add("cs_Parent")

            Try
                If (C1UnfinishedExam.Styles.Contains("cs_Parent")) Then
                    csProvider = C1UnfinishedExam.Styles("cs_Parent")
                Else
                    csProvider = C1UnfinishedExam.Styles.Add("cs_Parent")
                    csProvider.Font = FontBold8_25 ' New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    ' csProvider.Font = New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                    csProvider.BackColor = Color.FromArgb(222, 231, 250)
                    csProvider.ForeColor = Color.FromArgb(21, 66, 139)
                    csProvider.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csProvider.ImageSpacing = 2
                    csProvider.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                    csProvider.Border.Color = Color.FromArgb(159, 181, 221)
                End If
            Catch ex As Exception
                csProvider = C1UnfinishedExam.Styles.Add("cs_Parent")
                csProvider.Font = FontBold8_25 ' New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                ' csProvider.Font = New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
                csProvider.BackColor = Color.FromArgb(222, 231, 250)
                csProvider.ForeColor = Color.FromArgb(21, 66, 139)
                csProvider.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                csProvider.ImageSpacing = 2
                csProvider.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                csProvider.Border.Color = Color.FromArgb(159, 181, 221)
            End Try

            ''Changes made for problem 00000591  


            Dim csAppointment As C1.Win.C1FlexGrid.CellStyle '= C1UnfinishedExam.Styles.Add("cs_Child")
            Try
                If (C1UnfinishedExam.Styles.Contains("cs_Child")) Then
                    csAppointment = C1UnfinishedExam.Styles("cs_Child")
                Else
                    csAppointment = C1UnfinishedExam.Styles.Add("cs_Child")
                    csAppointment.Font = FontRegular8_25
                    csAppointment.BackColor = Color.FromArgb(240, 247, 255)
                    csAppointment.ForeColor = Color.Black
                    csAppointment.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csAppointment.ImageSpacing = 2
                    csAppointment.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                End If
            Catch ex As Exception
                csAppointment = C1UnfinishedExam.Styles.Add("cs_Child")
                csAppointment.Font = FontRegular8_25
                csAppointment.BackColor = Color.FromArgb(240, 247, 255)
                csAppointment.ForeColor = Color.Black
                csAppointment.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                csAppointment.ImageSpacing = 2
                csAppointment.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
            End Try
            ' csAppointment.Font = New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
            ''Changes made for problem 00000591  


            Dim csAppointment1 As C1.Win.C1FlexGrid.CellStyle '= C1UnfinishedExam.Styles.Add("cs_Child_Bold")
            Try
                If (C1UnfinishedExam.Styles.Contains("cs_Child_Bold")) Then
                    csAppointment1 = C1UnfinishedExam.Styles("cs_Child_Bold")
                Else
                    csAppointment1 = C1UnfinishedExam.Styles.Add("cs_Child_Bold")
                    csAppointment1.Font = FontBold8_25
                    csAppointment1.BackColor = Color.FromArgb(240, 247, 255)
                    csAppointment1.ForeColor = Color.Black
                    csAppointment1.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                    csAppointment1.ImageSpacing = 2
                    csAppointment1.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
                End If
            Catch ex As Exception
                csAppointment1 = C1UnfinishedExam.Styles.Add("cs_Child_Bold")
                csAppointment1.Font = FontBold8_25
                csAppointment1.BackColor = Color.FromArgb(240, 247, 255)
                csAppointment1.ForeColor = Color.Black
                csAppointment1.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
                csAppointment1.ImageSpacing = 2
                csAppointment1.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
            End Try
            ' csAppointment1.Font = New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
            ''Changes made for problem 00000591  


            C1UnfinishedExam.Tree.Column = 2
            C1UnfinishedExam.Tree.Style = C1.Win.C1FlexGrid.TreeStyleFlags.Simple
            C1UnfinishedExam.Tree.Indent = 4
            C1UnfinishedExam.Tree.LineColor = Color.Transparent

            C1UnfinishedExam.SetData(0, col_UnfinishedExamVisitID, "VisitID .")
            C1UnfinishedExam.SetData(0, col_UnfinishedExamID, "Unfinished Exam ID")
            C1UnfinishedExam.SetData(0, col_UnfinishedExamPatientName, "UnfinishedExam Patient")
            C1UnfinishedExam.SetData(0, col_UnfinishedExamDate, "UnfinishedExam Date")
            C1UnfinishedExam.SetData(0, col_UnfinishedExamPatientID, "PatientID")
            C1UnfinishedExam.SetData(0, col_UnfinishedExamPatientCode, "Patient Code")
            C1UnfinishedExam.SetData(0, col_UnfinishedExamName, "Exam Name")
            C1UnfinishedExam.SetData(0, col_UnfinishedTemplateName, "TemplateName")

            Dim i As Integer
            Dim obj As New clsPatientExams
            Dim dtUnfinishedExams As DataTable  ''slr new not needed 
            dtUnfinishedExams = obj.GetProviderUnfinishedExams(gnSelectedProviderID, bIsShowAllUnfinishedexams)


            Dim strExamPatientname As String = "" '' This string contains Subject :  Exam Name :Patient Name 
            'Dim _PatientID As Int64
            'Dim _PatientName As String

            Dim ParentRowIndex As Int32 = 0

            If IsNothing(dtUnfinishedExams) = False Then
                pnlNav_UnfinishedExams.Text = "Unfinished Exams [" & dtUnfinishedExams.Rows.Count & "]"

                For i = 0 To dtUnfinishedExams.Rows.Count - 1
                    Dim _UnfinishedExamDate As DateTime = Convert.ToDateTime((dtUnfinishedExams.Rows(i)("DOS")))
                    Dim _UnfinishedExamDateString As String = " Date : " + Format(_UnfinishedExamDate, "MM/dd/yyyy")
                    Dim NodeFound As Boolean = False
                    ParentRowIndex = 0 ''To start Search from Initial row.
                    For j As Int64 = 1 To C1UnfinishedExam.Rows.Count - 1
                        If C1UnfinishedExam.Rows(j).Node.Level = 0 Then
                            If C1UnfinishedExam.Rows(j).Node.Data = _UnfinishedExamDateString Then
                                ParentRowIndex = j
                                NodeFound = True
                                Exit For
                            End If
                        End If
                    Next


                    'Add Parent Node of Found Date. ''If Not Present.
                    If NodeFound = False Then
                        C1UnfinishedExam.Rows.Add()
                        C1UnfinishedExam.Rows(C1UnfinishedExam.Rows.Count - 1).IsNode = True
                        C1UnfinishedExam.Rows(C1UnfinishedExam.Rows.Count - 1).ImageAndText = True
                        C1UnfinishedExam.Rows(C1UnfinishedExam.Rows.Count - 1).Node.Level = 0
                        C1UnfinishedExam.Rows(C1UnfinishedExam.Rows.Count - 1).Node.Data = _UnfinishedExamDateString '
                        C1UnfinishedExam.Rows(C1UnfinishedExam.Rows.Count - 1).Node.Key = _UnfinishedExamDate  '' UnfinishedExam Date
                        C1UnfinishedExam.Rows(C1UnfinishedExam.Rows.Count - 1).Node.Row.Style = C1UnfinishedExam.Styles("cs_Parent")
                        C1UnfinishedExam.Rows(C1UnfinishedExam.Rows.Count - 1).Height = 21
                        ParentRowIndex = C1UnfinishedExam.Rows.Count - 1 ''This Will be Parent Row Index for next Child in this loop.
                    End If

                    ''Add Child Node for Respective Parent .. Parent Index Defined By Variable [ ParentRowIndex ]
                    Dim oChild As C1.Win.C1FlexGrid.Node
                    oChild = C1UnfinishedExam.Rows(ParentRowIndex).Node.AddNode(C1.Win.C1FlexGrid.NodeTypeEnum.LastChild, "", _UnfinishedExamDate, Nothing)
                    Dim ChildRowIndex As Int32 = oChild.Row.Index

                    C1UnfinishedExam.Rows(ChildRowIndex).ImageAndText = True
                    C1UnfinishedExam.Rows(ChildRowIndex).Node.Row.Style = C1UnfinishedExam.Styles("cs_Child")

                    strExamPatientname = Convert.ToString(dtUnfinishedExams.Rows(i)("PatientCode")) + " : " + Convert.ToString(dtUnfinishedExams.Rows(i)("PatientName")) + " : " + Convert.ToString(dtUnfinishedExams.Rows(i)("ExamName"))
                    C1UnfinishedExam.SetData(ChildRowIndex, col_UnfinishedExamVisitID, CType(dtUnfinishedExams.Rows(i)("VisitID"), Int64))
                    C1UnfinishedExam.SetData(ChildRowIndex, col_UnfinishedExamID, CType(dtUnfinishedExams.Rows(i)("ExamID"), Int64)) '' Triage ID
                    C1UnfinishedExam.SetData(ChildRowIndex, col_UnfinishedExamPatientName, strExamPatientname) '' Triage ID '' Patient Name 
                    C1UnfinishedExam.SetData(ChildRowIndex, col_UnfinishedExamDate, _UnfinishedExamDate)
                    C1UnfinishedExam.SetData(ChildRowIndex, col_UnfinishedExamPatientID, CType(dtUnfinishedExams.Rows(i)("PatientID"), Int64))
                    C1UnfinishedExam.SetData(ChildRowIndex, col_UnfinishedExamPatientCode, CType(dtUnfinishedExams.Rows(i)("PatientCode"), String))
                    C1UnfinishedExam.SetData(ChildRowIndex, col_UnfinishedExamName, CType(dtUnfinishedExams.Rows(i)("ExamName"), String))
                    C1UnfinishedExam.SetData(ChildRowIndex, col_UnfinishedTemplateName, CType(dtUnfinishedExams.Rows(i)("sTemplateName"), String))
                Next

                If dtUnfinishedExams.Rows.Count < 100 Then
                    pnllblLinkUnfinishedexam.Visible = False
                Else
                    If Not bIsShowAllUnfinishedexams Then
                        pnllblLinkUnfinishedexam.Visible = True
                    End If
                End If
            Else
                pnlNav_UnfinishedExams.Text = "Unfinished Exams [0]"
                pnllblLinkUnfinishedexam.Visible = False
            End If

            C1UnfinishedExam.Rows(0).Visible = False

            C1UnfinishedExam.Cols(col_UnfinishedExamVisitID).Visible = False
            C1UnfinishedExam.Cols(col_UnfinishedExamID).Visible = False
            C1UnfinishedExam.Cols(col_UnfinishedExamDate).Visible = False
            C1UnfinishedExam.Cols(col_UnfinishedExamPatientName).Visible = True
            C1UnfinishedExam.Cols(col_UnfinishedExamPatientID).Visible = False
            C1UnfinishedExam.Cols(col_UnfinishedExamName).Visible = False
            C1UnfinishedExam.Cols(col_UnfinishedExamPatientCode).Visible = False
            C1UnfinishedExam.Cols(col_UnfinishedTemplateName).Visible = False
            Dim _width As Integer = C1UnfinishedExam.Width

            C1UnfinishedExam.Cols(col_UnfinishedExamDate).Width = 0 ''UnfinishedExam Date
            C1UnfinishedExam.Cols(col_UnfinishedExamVisitID).Width = 0 ''UnfinishedExam NO
            C1UnfinishedExam.Cols(col_UnfinishedExamPatientName).Width = Convert.ToInt32(_width * 1) ''Patient Name
            C1UnfinishedExam.Cols(col_UnfinishedExamID).Width = 0 ''UnfinishedExam Id
            C1UnfinishedExam.Cols(col_UnfinishedExamPatientID).Width = 0 ''Patient Id
            C1UnfinishedExam.Cols(col_UnfinishedExamName).Width = 0 ''Patient Id
            C1UnfinishedExam.Cols(col_UnfinishedExamPatientCode).Width = 0 ''Patient Code
            'code added by pradeep to show total of Unfinished exam under one date (20100812)
            If IsNothing(dtUnfinishedExams) = False Then
                For i = 0 To dtUnfinishedExams.Rows.Count - 1
                    Dim _UnfinishedExamDate As DateTime = Convert.ToDateTime((dtUnfinishedExams.Rows(i)("DOS")))
                    Dim _UnfinishedExamDateString As String = " Date : " + Format(_UnfinishedExamDate, "MM/dd/yyyy")

                    ''To Search ParentNode for Task DueDate.
                    ParentRowIndex = 0 ''To start Search from Initial row.
                    For j As Int64 = 1 To C1UnfinishedExam.Rows.Count - 1
                        If C1UnfinishedExam.Rows(j).Node.Level = 0 Then
                            If C1UnfinishedExam.Rows(j).Node.Data = _UnfinishedExamDateString Then
                                ParentRowIndex = j
                                Dim cnt As Integer
                                cnt = C1UnfinishedExam.Rows(ParentRowIndex).Node.Children
                                Dim _str As String
                                _str = _UnfinishedExamDateString & " [" & cnt & "]"
                                C1UnfinishedExam.SetData(ParentRowIndex, col_UnfinishedExamPatientName, _str)
                                Exit For
                            End If
                        End If
                    Next
                Next
            Else
                C1UnfinishedExam.Cols(col_UnfinishedExamPatientName).Visible = False
            End If
            C1UnfinishedExam.EndInit()
            If Not IsNothing(obj) Then
                obj.Dispose()
                obj = Nothing
            End If
            If Not IsNothing(dtUnfinishedExams) Then
                dtUnfinishedExams.Dispose()
                dtUnfinishedExams = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Me.Cursor = Cursors.Default
            If Not FontBold8_25 Is Nothing Then
                FontBold8_25 = Nothing
            End If
            If Not FontRegular8_25 Is Nothing Then
                FontRegular8_25 = Nothing
            End If
        End Try
    End Sub

    Private Sub C1UnfinishedExam_DoubleClick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles C1UnfinishedExam.DoubleClick
        If (IsPatientGuidelineOrPatientEducationOpen("Patient Exam") = True) Then
            Exit Sub
        End If

        If CheckWordForException() = False Then
            Exit Sub
        End If

        If C1UnfinishedExam.Row > 0 Then
            If C1UnfinishedExam.Rows(C1UnfinishedExam.Row).Node.Children = 0 Then
                'IF User Does not have rights of Past Exam then don't Open the Exam
                If gblnPastExam = False Then
                    Exit Sub
                End If

                Dim _ExamId As Int64 = 0
                _ExamId = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.RowSel, col_UnfinishedExamID), Int64)

                gstrPatientCode = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.RowSel, col_UnfinishedExamPatientCode), String)
                Try

                    If ShowDefaultPatientDetails() = False Then
                        ShowDefaultPatientDetails(gnPatientID)
                    End If

                    If IsAccess(False, gnPatientID) = False Then
                        Exit Sub
                    End If
                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Exam, gloAuditTrail.ActivityCategory.Finish, gloAuditTrail.ActivityType.View, ex, gloAuditTrail.ActivityOutCome.Failure)
                End Try

                Dim nPastExamID As Long
                Dim nVisitID As Long
                Dim dtDOS As DateTime
                Dim strExamName As String
                Dim blnFinished As Boolean

                nPastExamID = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.RowSel, col_UnfinishedExamID), Int64)
                nVisitID = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.RowSel, col_UnfinishedExamVisitID), Int64)
                dtDOS = Convert.ToDateTime(C1UnfinishedExam.GetData(C1UnfinishedExam.RowSel, col_UnfinishedExamDate))
                strExamName = Convert.ToString(C1UnfinishedExam.GetData(C1UnfinishedExam.RowSel, col_UnfinishedExamName))
                blnFinished = False
                Dim strTemplateName As String = Convert.ToString(C1UnfinishedExam.GetData(C1UnfinishedExam.RowSel, col_UnfinishedTemplateName))

                '' To check the Provider Associated for the Exam is same as provider Selected
                If Not blnFinished Then
                    Dim objExam As New clsPatientExams
                    objExam.SetProviderExam(nPastExamID)
                    objExam.Dispose() ''slr dispose objexam  
                    objExam = Nothing
                End If

                Dim frm As New frmPatientExam(gnPatientID, gnVisitID)
                'AddHandler frm.EvntGenerateCDAFromPatientExam, AddressOf openCDA
                With frm
                    .TemplateName = strTemplateName
                    .Hide()
                    .blnModify = True
                    .Text = "Past Exams"

                    .PatientID = gnPatientID

                    .pnlPastExam.Visible = False
                    .pnlPastExamView.Visible = True
                    ' .chkShowPreview.Visible = True


                    If (.OpenPastExam(nPastExamID, nVisitID, dtDOS, strExamName, blnFinished)) = True Then

                        .IsPastExam = True
                        .MdiParent = Me

                        frmPatientExam.blnOpenFromUnfinishedExam = False
                        .Show()
                        If .ExamViewMode Then
                            .ViewExam(nPastExamID)
                        Else
                            .OpenPastExamContents(nPastExamID, blnFinished)
                        End If

                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False

                        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Open, "Exam Opened (Unfinished Exam)", gnPatientID, nPastExamID, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

                    Else
                        frm.Dispose()
                        frm = Nothing

                    End If
                End With
            End If
        End If

    End Sub

    Private Sub C1UnfinishedExam_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1UnfinishedExam.MouseDown
        Try
            If (pnlPatientList.Visible = False) Then
                'Try
                '    If (IsNothing(C1UnfinishedExam.ContextMenu) = False) Then
                '        C1UnfinishedExam.ContextMenu.Dispose()
                '        C1UnfinishedExam.ContextMenu = Nothing
                '    End If
                'Catch ex As Exception

                'End Try
               
                ' C1UnfinishedExam.ContextMenu = Nothing
                ClearContextMenuStrip(C1Mesages.ContextMenuStrip)
                ClearContextMenuStrip(C1UnfinishedExam.ContextMenuStrip)
                ClearContextMenuStrip(cmnu_messages)
                AssignContextMenuStrip(C1UnfinishedExam.ContextMenuStrip, cmnu_messages)
                AssignContextMenuStrip(C1Mesages.ContextMenuStrip, cmnu_messages)
                Exit Sub
            End If
            If C1UnfinishedExam.HitTest(e.X, e.Y).Row >= 1 Then
                '20090825 Bug_id 2231(Easily masking to a Single Patient Name)

                ''Conditions Added by Mayuri:20110228-To fix issue:#8653-patient gets deselect when we select header
                If ((C1UnfinishedExam.Rows.Count >= 0) AndAlso (C1UnfinishedExam.Cols.Count >= col_UnfinishedExamPatientID)) Then
                    If (CType(C1UnfinishedExam.GetData(C1UnfinishedExam.HitTest(e.X, e.Y).Row, col_UnfinishedExamPatientID), Int64) <> gnPatientID AndAlso CType(C1UnfinishedExam.GetData(C1UnfinishedExam.HitTest(e.X, e.Y).Row, col_UnfinishedExamPatientID), Int64) <> 0) Then
                        If (pnlPatientList.Visible) Then
                            gnPatientID = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.HitTest(e.X, e.Y).Row, col_UnfinishedExamPatientID), Int64)
                            Call SelectPatientOnDashboard(gnPatientID)
                        End If
                    End If
                End If
            End If

            ''Add context menu  to View  diagnosis for the exam
            C1UnfinishedExam.Row = C1UnfinishedExam.HitTest(e.X, e.Y).Row
            If e.Button = MouseButtons.Right Then
                If gnPatientID <= 0 Then
                    'Try
                    '    If (IsNothing(C1UnfinishedExam.ContextMenu) = False) Then
                    '        C1UnfinishedExam.ContextMenu.Dispose()
                    '        C1UnfinishedExam.ContextMenu = Nothing
                    '    End If
                    'Catch ex As Exception

                    'End Try
                    ClearContextMenuStrip(C1Mesages.ContextMenuStrip)
                    ClearContextMenuStrip(C1UnfinishedExam.ContextMenuStrip)
                    ClearContextMenuStrip(cmnu_messages)
                    AssignContextMenuStrip(C1UnfinishedExam.ContextMenuStrip, cmnu_messages)
                    AssignContextMenuStrip(C1Mesages.ContextMenuStrip, cmnu_messages)
                    'C1UnfinishedExam.ContextMenu = Nothing
                    Exit Sub
                Else

                    'cmnu_messages.Items.Clear()
                    'Try
                    '    If (IsNothing(C1UnfinishedExam.ContextMenuStrip) = False) Then
                    '        C1UnfinishedExam.ContextMenuStrip.Dispose()
                    '        C1UnfinishedExam.ContextMenuStrip = Nothing
                    '    End If
                    'Catch ex As Exception

                    'End Try
                    'C1UnfinishedExam.ContextMenuStrip = cmnu_messages
                    ClearContextMenuStrip(C1Mesages.ContextMenuStrip)
                    ClearContextMenuStrip(C1UnfinishedExam.ContextMenuStrip)
                    ClearContextMenuStrip(cmnu_messages)
                    AssignContextMenuStrip(C1UnfinishedExam.ContextMenuStrip, cmnu_messages)
                    AssignContextMenuStrip(C1Mesages.ContextMenuStrip, cmnu_messages)
                End If

                If C1UnfinishedExam.Row > 0 Then
                    If C1UnfinishedExam.Rows.Count > 1 Then
                        If C1UnfinishedExam.Rows(C1UnfinishedExam.Row).Node.Level >= 1 Then
                            If Not IsNothing(CType(C1UnfinishedExam.GetData(C1UnfinishedExam.RowSel, col_UnfinishedExamID), Int64)) Then
                                Dim oMenuItemViewDiagnosis As New ToolStripMenuItem
                                oMenuItemViewDiagnosis.Text = "View Diagnosis"
                                oMenuItemViewDiagnosis.ForeColor = Color.FromArgb(31, 73, 125)
                                oMenuItemViewDiagnosis.Image = imgList_Common.Images(15)
                                cmnu_messages.Items.Add(oMenuItemViewDiagnosis)
                                AddHandler oMenuItemViewDiagnosis.Click, AddressOf oMenuItemViewDiagnosisClick
                            End If
                        End If
                    End If
                End If
            End If

        Catch ex As Exception

            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Exam, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.View, " Patient unfinished exams viewed.  ", gloAuditTrail.ActivityOutCome.Failure)

        End Try
    End Sub

    ''View  diagnosis for the exam
    Private Sub oMenuItemViewDiagnosisClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Try
            Dim _ExamID As Int64
            Dim _VisitID As Int64
            Dim _DOS As DateTime
            Dim _ExamName As String

            If (_IsPastExam = True) Then '' if selecte exam is from the past exams from patient detail grid
                _IsPastExam = False
                _VisitID = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 1)
                _ExamID = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0)
                _DOS = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 2)
                _ExamName = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 3)
            Else '' if selecte exam is from the Unfinished exams 

                _ExamID = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.Row, col_UnfinishedExamID), Int64) ''Exam ID
                _VisitID = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.Row, col_UnfinishedExamVisitID), Int64) ''Visit ID
                _DOS = C1UnfinishedExam.GetData(C1UnfinishedExam.Row, col_UnfinishedExamDate)
                _ExamName = C1UnfinishedExam.GetData(C1UnfinishedExam.Row, col_UnfinishedExamName)
            End If

            ShowDiagnosis(gnPatientID, _ExamID, _VisitID, _DOS, _ExamName)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    'Code Start-Added by kanchan on 20101111 for ccd
    Private Sub oMenuItemGenCCDClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Try
            Dim _VisitID As Int64
            Dim _ExamID As Int64
            Dim _date As Date
            If (_IsPastExam = True) Then '' if selecte exam is from the past exams from patient detail grid
                _VisitID = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 1)
            Else '' if selecte exam is from the Unfinished exams 
                _VisitID = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.Row, col_UnfinishedExamVisitID), Int64) ''Visit ID
            End If


            _ExamID = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0)

            _date = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 2), Date)

            Dim objfrm As New frmCCDGenerateList(gnPatientID, True)
            objfrm.ChkProcedures.Checked = True
            objfrm._IsVisitCCD = True
            objfrm.ExamID = _ExamID
            objfrm.VisitId = _VisitID
            ''Added by Mayuri:20120529-To add functionality of CCD Sections
            Dim dt As DataTable  ''Slr new not needed
            '  Dim dtMUSetting As New DataTable
            Dim DefaultFullCCD() As String
            Dim objSettings As New clsSettings
            Dim i As Int16
            objfrm.dtpFrom.Enabled = True
            objfrm.dtpToDate.Enabled = True

            objfrm.dtpFrom.Value = _date
            objfrm.dtpToDate.Value = _date

            objfrm.chkDate.Visible = False

            objfrm.ChkVitals.Checked = False
            objfrm.ChkFamilyHistory.Checked = False
            objfrm.ChkAdvanceDirectives.Checked = False
            objfrm.ChkResults.Checked = False
            objfrm.ChkResults.Enabled = True
            objfrm.ChkProcedures.Checked = False
            objfrm.ChkImmunization.Checked = False
            objfrm.ChkMedications.Checked = False
            objfrm.ChkMedications.Enabled = True
            objfrm.ChkEncounter.Checked = False
            objfrm.ChkSocialHistory.Checked = False
            objfrm.ChkAllergy.Checked = False
            objfrm.ChkAllergy.Enabled = True
            objfrm.chkProblems.Checked = False
            objfrm.chkProblems.Enabled = True

            dt = objSettings.GetSetting("VISITCCDDEFAULTSECTIONS")

            objSettings.Dispose() : objSettings = Nothing

            If IsNothing(dt) = False Then
                If dt.Rows.Count > 0 Then
                    If dt.Rows(0)("sSettingsValue") <> "" Then
                        DefaultFullCCD = Convert.ToString(dt.Rows(0)("sSettingsValue")).Trim.Split(",")
                        For i = 0 To DefaultFullCCD.Length - 1
                            If DefaultFullCCD.Length > 0 Then
                                Select Case DefaultFullCCD(i)
                                    Case "VisitVitals"
                                        objfrm.ChkVitals.Checked = True
                                    Case "VisitFamHis"
                                        objfrm.ChkFamilyHistory.Checked = True
                                    Case "VisitAdDir"
                                        objfrm.ChkAdvanceDirectives.Checked = True
                                    Case "VisitLabs"
                                        objfrm.ChkResults.Checked = True
                                    Case "visitImmu"
                                        objfrm.ChkImmunization.Checked = True
                                    Case "VisitProc"
                                        objfrm.ChkProcedures.Checked = True
                                    Case "VisitMed"
                                        objfrm.ChkMedications.Checked = True
                                    Case "VisitEncounter"
                                        objfrm.ChkEncounter.Checked = True
                                    Case "VisitSocHis"
                                        objfrm.ChkSocialHistory.Checked = True
                                    Case "VisitAllegy"
                                        objfrm.ChkAllergy.Checked = True
                                    Case "VisitProb"
                                        objfrm.chkProblems.Checked = True
                                End Select
                            End If
                        Next
                    Else

                    End If
                End If
            End If

            If IsNothing(dt) = False Then
                dt.Dispose()
                dt = Nothing
            End If

            With objfrm
                .WindowState = FormWindowState.Normal
                .GeneratedFrom = "Exam CCD"
                .BringToFront()
                .StartPosition = FormStartPosition.CenterParent
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With
            If Not IsNothing(objfrm) Then  ''Slr dispose objfrm
                objfrm.Close()
                objfrm.Dispose()
                objfrm = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub oOrderItemGenCDAClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Try
            openCDA(_CDAOrderID, _CDAOrderDetails)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub oMenuItemGenCDAClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Try
            Dim _VisitID As Int64
            Dim _ExamID As Int64
            Dim _ExamDtl As String
            If (_IsPastExam = True) Then '' if selecte exam is from the past exams from patient detail grid
                _VisitID = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 1)
            Else '' if selecte exam is from the Unfinished exams 
                _VisitID = CType(C1UnfinishedExam.GetData(C1UnfinishedExam.Row, col_UnfinishedExamVisitID), Int64) ''Visit ID
            End If

            _ExamID = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0)
            _ExamDtl = C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 2) & " - " & C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 3)
            Dim objfrm As New frmCCDAGenerateList(gnPatientID)

            objfrm.nVisitId = _VisitID
            objfrm.nExamId = _ExamID
            objfrm.sDetail = _ExamDtl
            objfrm.nCDAFileType = CDAFileTypeEnum.AmbulatorySummary
            With objfrm
                .WindowState = FormWindowState.Normal
                .BringToFront()
                .StartPosition = FormStartPosition.CenterParent
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
                .Dispose()
            End With

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub oOrderMenuItemGenCDAClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Try

        Catch ex As Exception

        End Try

    End Sub
    'Code End-Added by kanchan on 20101111 for ccd
#End Region

#Region " View CheckIn Status "

    Private Sub ShowCheckInStatus()
        Try
            'c1PatientCheckInStatus.Clear()
            c1PatientCheckInStatus.DataSource = Nothing
            c1PatientCheckInStatus.AllowResizing = C1.Win.C1FlexGrid.AllowResizingEnum.Columns
            c1PatientCheckInStatus.Clear(C1.Win.C1FlexGrid.ClearFlags.All)

            'Set the column Names.                              
            c1PatientCheckInStatus.Cols.Count = col_CheckInStatus_TotalColumns
            c1PatientCheckInStatus.Rows.Count = 1
            c1PatientCheckInStatus.AllowEditing = False

            c1PatientCheckInStatus.Rows(0).Visible = False

            c1PatientCheckInStatus.Cols(col_CheckInStatus_CheckInDetail).Width = c1PatientCheckInStatus.Width
            c1PatientCheckInStatus.Cols(col_CheckInStatus_PatientID).Width = 0
            c1PatientCheckInStatus.Cols(col_CheckInStatus_AppointmentID_MST).Width = 0
            c1PatientCheckInStatus.Cols(col_CheckInStatus_AppointmentID_DTL).Width = 0
            c1PatientCheckInStatus.Cols(col_CheckInStatus_StartTime).Width = 0
            c1PatientCheckInStatus.Cols(col_CheckInStatus_Type).Width = 0

            'Dim dtPatient As DataTable
            dtPatient = GetAllCheckInPatient()
            If IsNothing(dtPatient) = False Then
                Dim newRow As Integer = 0
                Dim checkInDetails As String
                For iRow As Integer = 0 To dtPatient.Rows.Count - 1
                    c1PatientCheckInStatus.Rows.Add()
                    newRow = c1PatientCheckInStatus.Rows.Count - 1

                    checkInDetails = dtPatient.Rows(iRow)("PatientName")
                    checkInDetails = checkInDetails + "    " + gloDateMaster.gloTime.TimeAsDateTime(Now.Date, dtPatient.Rows(iRow)("dtStartTime")).ToShortTimeString
                    checkInDetails = checkInDetails + " - " + gloDateMaster.gloTime.TimeAsDateTime(Now.Date, dtPatient.Rows(iRow)("dtEndTime")).ToShortTimeString

                    c1PatientCheckInStatus.SetData(newRow, col_CheckInStatus_CheckInDetail, checkInDetails)
                    c1PatientCheckInStatus.SetData(newRow, col_CheckInStatus_PatientID, dtPatient.Rows(iRow)("nPatientID"))
                    c1PatientCheckInStatus.SetData(newRow, col_CheckInStatus_AppointmentID_MST, dtPatient.Rows(iRow)("nMSTAppointmentID"))
                    c1PatientCheckInStatus.SetData(newRow, col_CheckInStatus_AppointmentID_DTL, dtPatient.Rows(iRow)("nDTLAppointmentID"))
                    c1PatientCheckInStatus.SetData(newRow, col_CheckInStatus_StartTime, dtPatient.Rows(iRow)("dtStartTime"))
                    c1PatientCheckInStatus.SetData(newRow, col_CheckInStatus_Type, dtPatient.Rows(iRow)("sAppointmentType"))
                Next
                checkInDetails = Nothing
                newRow = Nothing
            End If


        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub c1PatientCheckInStatus_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles c1PatientCheckInStatus.MouseDown
        Try
            If (pnlPatientList.Visible = False) Then
                'Try
                '    If (IsNothing(c1PatientCheckInStatus.ContextMenuStrip) = False) Then
                '        c1PatientCheckInStatus.ContextMenuStrip.Dispose()
                '        c1PatientCheckInStatus.ContextMenuStrip = Nothing
                '    End If
                'Catch ex As Exception

                'End Try
                ClearContextMenuStrip(oPatientListControl.ContextMenuStrip)

                ClearContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip)

                ClearContextMenuStrip(C1Appointments.ContextMenuStrip)

                ClearContextMenuStrip(pnlRightFill.ContextMenuStrip)

                ClearContextMenuStrip(pnlLeft.ContextMenuStrip)

                ClearContextMenuStrip(cMnuPatient)

                AssignContextMenuStrip(oPatientListControl.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(C1Appointments.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(pnlRightFill.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(pnlLeft.ContextMenuStrip, cMnuPatient)

                Exit Sub
            End If
            Dim selRow As Integer = c1PatientCheckInStatus.HitTest(e.X, e.Y).Row
            'Try
            '    If (IsNothing(c1PatientCheckInStatus.ContextMenuStrip) = False) Then
            '        c1PatientCheckInStatus.ContextMenuStrip.Dispose()
            '        c1PatientCheckInStatus.ContextMenuStrip = Nothing
            '    End If
            'Catch ex As Exception

            'End Try
            '  c1PatientCheckInStatus.ContextMenuStrip = Nothing
            ClearContextMenuStrip(oPatientListControl.ContextMenuStrip)

            ClearContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip)

            ClearContextMenuStrip(C1Appointments.ContextMenuStrip)

            ClearContextMenuStrip(pnlRightFill.ContextMenuStrip)

            ClearContextMenuStrip(pnlLeft.ContextMenuStrip)

            ClearContextMenuStrip(cMnuPatient)

            AssignContextMenuStrip(oPatientListControl.ContextMenuStrip, cMnuPatient)

            AssignContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip, cMnuPatient)

            AssignContextMenuStrip(C1Appointments.ContextMenuStrip, cMnuPatient)

            AssignContextMenuStrip(pnlRightFill.ContextMenuStrip, cMnuPatient)

            AssignContextMenuStrip(pnlLeft.ContextMenuStrip, cMnuPatient)
            If selRow >= 1 Then
                If IsNothing(dtPatient) = False Then
                    If dtPatient.Rows.Count > 0 Then

                        If (CType(c1PatientCheckInStatus.GetData(selRow, col_CheckInStatus_PatientID), Int64) > 0) Then
                            If (pnlPatientList.Visible) Then
                                gnPatientID = CType(c1PatientCheckInStatus.GetData(selRow, col_CheckInStatus_PatientID), Int64)
                                Call SelectPatientOnDashboard(gnPatientID)
                            End If
                        End If

                        If e.Button = Windows.Forms.MouseButtons.Right Then
                            c1PatientCheckInStatus.Row = selRow
                            '' COMMENT BY SUDHIR 20090522 '' NOW CONTEXT MENU SAME AS PATIENT LIST CONTROL. ''

                            _IsFromAppointment = False
                            Call FillMenus()
                            'Try
                            '    If (IsNothing(c1PatientCheckInStatus.ContextMenuStrip) = False) Then
                            '        c1PatientCheckInStatus.ContextMenuStrip.Dispose()
                            '        c1PatientCheckInStatus.ContextMenuStrip = Nothing
                            '    End If
                            'Catch ex As Exception

                            'End Try
                            c1PatientCheckInStatus.ContextMenuStrip = cMnuPatient
                            FillCheckInCheckOutMenu()

                            '''''first check whether Clinic level/Machine leve formulary settings are On/Off and accordingly show the menu
                            If gblnClinicFormularyAlert = True Then
                                'show the View eligibility context menu
                            End If
                        End If
                    End If
                End If

            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    'Private Sub FillRxEligMenu()
    '    Dim oMenuItem As ToolStripMenuItem
    '    Try
    '        oMenuItem = New ToolStripMenuItem
    '        oMenuItem.Text = "Send Rx Eligibility Request"
    '        oMenuItem.Tag = "RxEligReq"
    '        oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
    '        oMenuItem.Image = Imgts_PatientDetails.Images(0)
    '        cMnuPatient.Items.Add(oMenuItem)
    '        AddHandler oMenuItem.Click, AddressOf RxElgRequest
    '    Catch ex As Exception
    '    End Try
    'End Sub

    Private Sub c1PatientCheckInStatus_MouseMove(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles c1PatientCheckInStatus.MouseMove
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub

    Private Sub pnlPatientCheckInStatus_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles pnlPatientCheckInStatus.Click
        ShowCheckInStatus()
    End Sub

#End Region

#Region " View Mails"

    Private Sub ShowMails()

        'Try
        '    Dim ogloMail As gloExchange.Common.Mail.PmsExchangeMail = New gloExchange.Common.Mail.PmsExchangeMail(GetConnectionString)
        '    Dim dtMails As DataTable = New DataTable()

        '    Try
        '        'Get Login User's mails 
        '        dtMails = ogloMail.GetUserMails(gnLoginID)

        '        c1Mails.DataSource = Nothing
        '        c1Mails.AllowResizing = C1.Win.C1FlexGrid.AllowResizingEnum.Columns
        '        c1Mails.Clear(C1.Win.C1FlexGrid.ClearFlags.All)
        '        c1Mails.Cols.Count = 4
        '        c1Mails.Rows.Count = 1
        '        c1Mails.Styles.EmptyArea.BackColor = Color.White

        '        'Define Cell Style For Parent Node
        '        Dim csParent As C1.Win.C1FlexGrid.CellStyle = c1Mails.Styles.Add("cs_Parent")
        '        csParent.Font = New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
        '        csParent.BackColor = Color.FromArgb(222, 231, 250)
        '        csParent.ForeColor = Color.FromArgb(21, 66, 139)
        '        csParent.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.LeftTop
        '        csParent.ImageSpacing = 2
        '        csParent.Border.Direction = C1.Win.C1FlexGrid.BorderDirEnum.Horizontal
        '        csParent.Border.Style = BorderStyleEnum.Flat
        '        csParent.Border.Color = Color.FromArgb(159, 181, 221)

        '        'Cell Style For Mail Subject
        '        Dim csProviderName As C1.Win.C1FlexGrid.CellStyle = c1Mails.Styles.Add("cs_MailSubject")
        '        csProviderName.Font = New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
        '        csProviderName.BackColor = Color.White
        '        csProviderName.ForeColor = Color.FromArgb(21, 66, 139)
        '        csProviderName.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.RightCenter
        '        csProviderName.TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftBottom
        '        csProviderName.ImageSpacing = 0
        '        csProviderName.Border.Color = Color.Transparent


        '        'Cell Style For Mail Details
        '        Dim csProviderDetail As C1.Win.C1FlexGrid.CellStyle = c1Mails.Styles.Add("cs_MailDetail")
        '        csProviderDetail.Font = New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, (CType((0), Byte)))
        '        csProviderDetail.BackColor = Color.White
        '        csProviderDetail.ForeColor = Color.Black
        '        csProviderDetail.Border.Color = Color.White
        '        csProviderDetail.TextAlign = C1.Win.C1FlexGrid.TextAlignEnum.LeftTop


        '        c1Mails.Tree.Column = 2
        '        c1Mails.Tree.Style = C1.Win.C1FlexGrid.TreeStyleFlags.Simple
        '        c1Mails.Tree.Indent = 0
        '        c1Mails.Tree.LineColor = Color.Transparent

        '        c1Mails.AllowMerging = AllowMergingEnum.Free

        '        c1Mails.SetData(0, 0, "Exchange ItemID")
        '        c1Mails.SetData(0, 1, "Exchange Item Change Key")
        '        c1Mails.SetData(0, 2, "Root")
        '        c1Mails.SetData(0, 3, "Mail Details")


        '        If Not dtMails Is Nothing Then
        '            Dim CurrentParentKey As String = ""
        '            Dim i As Integer
        '            Dim oRange As C1.Win.C1FlexGrid.CellRange

        '            'Fill Mail into Grid   
        '            For i = 0 To dtMails.Rows.Count - 1

        '                Dim ParentRowIndex As Int32 = 0

        '                'Create Parent Node
        '                If CurrentParentKey <> gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtMails.Rows(i)("dtReceivedDate"))).ToShortDateString() Then
        '                    c1Mails.Rows.Add()
        '                    ParentRowIndex = c1Mails.Rows.Count - 1
        '                    c1Mails.Rows(ParentRowIndex).IsNode = True
        '                    c1Mails.Rows(ParentRowIndex).ImageAndText = True
        '                    c1Mails.Rows(ParentRowIndex).Node.Level = 0
        '                    'c1Mails.Rows(ParentRowIndex).Node.Data = gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtMails.Rows(i)("dtReceivedDate"))).ToShortDateString() ' No
        '                    c1Mails.SetData(ParentRowIndex, 3, gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtMails.Rows(i)("dtReceivedDate"))).ToShortDateString())
        '                    c1Mails.Rows(ParentRowIndex).Node.Key = gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtMails.Rows(i)("dtReceivedDate"))).ToShortDateString()
        '                    c1Mails.Rows(ParentRowIndex).Node.Row.Style = c1Mails.Styles("cs_Parent")
        '                    c1Mails.Rows(ParentRowIndex).Height = 25
        '                    c1Mails.Rows(ParentRowIndex).AllowMerging = True
        '                    CurrentParentKey = gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtMails.Rows(i)("dtReceivedDate"))).ToShortDateString()
        '                Else
        '                    'Get Last Parents Index
        '                    ParentRowIndex = c1Mails.Rows(c1Mails.Rows.Count - 1).Node.GetNode(C1.Win.C1FlexGrid.NodeTypeEnum.Parent).Row.Index
        '                End If


        '                Dim oChild As C1.Win.C1FlexGrid.Node
        '                Dim ChildRowIndex As Int32

        '                'Add Child Node 
        '                oChild = c1Mails.Rows(ParentRowIndex).Node.AddNode(C1.Win.C1FlexGrid.NodeTypeEnum.LastChild, "", gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtMails.Rows(i)("dtReceivedDate"))).ToShortDateString(), Nothing)
        '                ChildRowIndex = oChild.Row.Index

        '                'Fill Subject 
        '                c1Mails.SetData(ChildRowIndex, 0, Convert.ToString(dtMails.Rows(i)("sExchangeItemID")))
        '                c1Mails.SetData(ChildRowIndex, 1, Convert.ToString(dtMails.Rows(i)("sExchangeItemChangeKey")))
        '                c1Mails.SetData(ChildRowIndex, 3, Convert.ToString(dtMails.Rows(i)("sSubject")))
        '                c1Mails.SetCellImage(ChildRowIndex, 2, imgList_Common.Images(5))

        '                'Set Row Style
        '                c1Mails.Rows(ChildRowIndex).ImageAndText = True
        '                c1Mails.Rows(ChildRowIndex).Height = 20
        '                c1Mails.Rows(ChildRowIndex).Node.Row.Style = c1Mails.Styles("cs_ProviderNormal")
        '                oRange = c1Mails.GetCellRange(ChildRowIndex, 1, ChildRowIndex, c1Mails.Cols.Count - 1)
        '                oRange.Style = c1Mails.Styles("cs_MailSubject")


        '                'Add Child Node 
        '                oChild = c1Mails.Rows(ParentRowIndex).Node.AddNode(C1.Win.C1FlexGrid.NodeTypeEnum.LastChild, "", gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtMails.Rows(i)("dtReceivedDate"))).ToShortDateString(), Nothing)
        '                ChildRowIndex = oChild.Row.Index

        '                'Fill Mail Details
        '                Dim _MailDetail As String = ""
        '                _MailDetail = "From: " + dtMails.Rows(i)("sSenderName").ToString()
        '                _MailDetail = _MailDetail + Environment.NewLine + "Received Date: " + gloDateMaster.gloDate.DateAsDate(Convert.ToInt64(dtMails.Rows(i)("dtReceivedDate"))).ToShortDateString()
        '                _MailDetail = _MailDetail + Environment.NewLine + "Patient: " + Convert.ToString(dtMails.Rows(i)("PatientName"))

        '                c1Mails.SetData(ChildRowIndex, 0, Convert.ToString(dtMails.Rows(i)("sExchangeItemID")))
        '                c1Mails.SetData(ChildRowIndex, 1, Convert.ToString(dtMails.Rows(i)("sExchangeItemChangeKey")))
        '                c1Mails.SetData(ChildRowIndex, 3, _MailDetail)

        '                'Set Row Style
        '                c1Mails.Rows(ChildRowIndex).Height = 45
        '                oRange = c1Mails.GetCellRange(ChildRowIndex, 1, ChildRowIndex, c1Mails.Cols.Count - 1)
        '                oRange.Style = c1Mails.Styles("cs_MailDetail")


        '            Next

        '        End If

        '        c1Mails.Rows(0).Visible = False
        '        c1Mails.Cols(0).Visible = False
        '        c1Mails.Cols(1).Visible = False

        '        c1Mails.AllowEditing = False

        '        ''Set Column Width 
        '        'Dim _width As Integer = pnlNav_Mail.Width - 2
        '        'c1Mails.Cols(3).Width = Convert.ToInt32(_width * 0.76)
        '        'c1Mails.Cols(2).Width = Convert.ToInt32(_width * 0.17)

        '    Catch ex As Exception
        '        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        '    Finally

        '    End Try
        'Catch ex As Exception

        'End Try

    End Sub

    'Open Mail
    Private Sub c1Mails_DoubleClick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles c1Mails.DoubleClick
        Try
            If c1Mails.Row > 0 Then
                'if it is chield Node (Task Node)
                If c1Mails.Rows(c1Mails.Row).Node.Children = 0 Then
                    Dim _exchangeItemId As String = ""
                    Dim _exchangeItemChangeKey As String = ""

                    _exchangeItemId = c1Mails.GetData(c1Mails.Row, 0).ToString()
                    _exchangeItemChangeKey = c1Mails.GetData(c1Mails.Row, 1).ToString()

                    Dim oViewUserMail As gloTaskMail.frmViewUserMail = gloTaskMail.frmViewUserMail.GetInstance()
                    oViewUserMail.ExchangeItemID = _exchangeItemId
                    oViewUserMail.ExchangeItemChangeKey = _exchangeItemChangeKey
                    oViewUserMail.MdiParent = Me
                    oViewUserMail.WindowState = FormWindowState.Maximized
                    oViewUserMail.Show()

                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False


                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#End Region

#Region " View Billing Alerts "
    Private Sub ShowCopayAlert()
        Dim COL_COPAYALERT_INSID As Integer = 0
        Dim COL_COPAYALERT_INSNAME As Integer = 1
        Dim COL_COPAYALERT_COPAYAMT As Integer = 2
        Dim COL_COPAYALERT_ALERTTEXT As Integer = 3
        Dim COL_COPAYALERT_COUNT As Integer = 4
        Dim rowIndex As Integer = 0

        Try
            'tmrCopayAlert.Stop();
            c1CopayAlert.Cols.Count = COL_COPAYALERT_COUNT
            c1CopayAlert.Rows.Count = 1

            rowIndex = c1CopayAlert.Rows.Count - 1

            Dim ogloAdvancePayment As New gloAdvancePayment(GetConnectionString())
            Dim _dtCopayAlert As DataTable = Nothing
            _dtCopayAlert = ogloAdvancePayment.GetCopayAlert(gnPatientID, DateTime.Now)

            If _dtCopayAlert IsNot Nothing AndAlso _dtCopayAlert.Rows.Count > 0 Then
                pnlCopayAlert.Visible = True
                tmrCopayAlert.Enabled = True
                tmrCopayAlert.Start()

                c1CopayAlert.AllowEditing = False

                c1CopayAlert.SetData(rowIndex, COL_COPAYALERT_INSID, Convert.ToString(_dtCopayAlert.Rows(0)("nInsuranceID")))
                c1CopayAlert.SetData(rowIndex, COL_COPAYALERT_INSNAME, Convert.ToString(_dtCopayAlert.Rows(0)("sInsuranceName")))
                c1CopayAlert.SetData(rowIndex, COL_COPAYALERT_COPAYAMT, Convert.ToString(_dtCopayAlert.Rows(0)("nCoPay")))

                If Convert.ToString(_dtCopayAlert.Rows(0)("nCoPay")).Trim() <> "" AndAlso Convert.ToDecimal(_dtCopayAlert.Rows(0)("nCoPay")) > 0 Then
                    Dim damount As Decimal = Convert.ToDecimal(_dtCopayAlert.Rows(0)("nCoPay"))
                    c1CopayAlert.SetData(rowIndex, COL_COPAYALERT_ALERTTEXT, "Copay Pending :  $" & (damount).ToString("N2").Trim())
                Else
                    c1CopayAlert.SetData(rowIndex, COL_COPAYALERT_ALERTTEXT, "Copay Pending")
                End If



                Dim cs As C1.Win.C1FlexGrid.CellStyle '= c1CopayAlert.Styles.Add("Blink")
                Try
                    If (c1CopayAlert.Styles.Contains("Blink")) Then
                        cs = c1CopayAlert.Styles("Blink")
                    Else
                        cs = c1CopayAlert.Styles.Add("Blink")
                        cs.Font = gloGlobal.clsgloFont.gFont_BOLD 'New System.Drawing.Font("Tahoma", 9.0F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte((0)))
                        cs.BackColor = Color.White
                        cs.Border.Color = Color.White
                    End If
                Catch ex As Exception
                    cs = c1CopayAlert.Styles.Add("Blink")
                    cs.Font = gloGlobal.clsgloFont.gFont_BOLD 'New System.Drawing.Font("Tahoma", 9.0F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte((0)))
                    cs.BackColor = Color.White
                    cs.Border.Color = Color.White
                End Try
               

                c1CopayAlert.SetCellStyle(rowIndex, COL_COPAYALERT_ALERTTEXT, cs)

                c1CopayAlert.Cols(COL_COPAYALERT_INSID).Visible = False
                c1CopayAlert.Cols(COL_COPAYALERT_INSNAME).Visible = False
                c1CopayAlert.Cols(COL_COPAYALERT_COPAYAMT).Visible = False
                c1CopayAlert.Cols(COL_COPAYALERT_ALERTTEXT).Visible = True
                c1CopayAlert.Row = -1

                c1CopayAlert.SelectionMode = C1.Win.C1FlexGrid.SelectionModeEnum.Row
            Else
                pnlCopayAlert.Visible = False

            End If
            If Not IsNothing(ogloAdvancePayment) Then  ''slr dispose  ogloAdvancePayment,_dtCopayAlert
                ogloAdvancePayment.Dispose()
                ogloAdvancePayment = Nothing
            End If
            If Not IsNothing(_dtCopayAlert) Then
                _dtCopayAlert.Dispose()
                _dtCopayAlert = Nothing
            End If

        Catch ex As Exception
            MessageBox.Show("Error - " & ex.ToString(), _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ShowUnappliedCopayAlert()
        Dim COL_UA_COPAYALERT As Integer = 0
        Dim COL_UA_COPAYCOUNT As Integer = 1
        Dim rowIndex As Integer = 0

        Try
            c1UnappliedCopayAlert.Cols.Count = COL_UA_COPAYCOUNT
            c1UnappliedCopayAlert.Rows.Count = 1

            rowIndex = c1UnappliedCopayAlert.Rows.Count - 1

            Dim ogloAdvancePayment As New gloAdvancePayment(GetConnectionString())
            Dim _isCopayUnapplied As Boolean = False
            _isCopayUnapplied = ogloAdvancePayment.IsCopayUnapplied(gnPatientID)
            If _isCopayUnapplied = True Then
                pnlUnappliedCopay.Visible = True
                tmrCopayAlert.Enabled = True

                tmrCopayAlert.Start()
                c1UnappliedCopayAlert.AllowEditing = False
                c1UnappliedCopayAlert.SetData(rowIndex, COL_UA_COPAYALERT, "Copay not applied")

                Dim cs As C1.Win.C1FlexGrid.CellStyle '= c1UnappliedCopayAlert.Styles.Add("Blink")

                Try
                    If (c1UnappliedCopayAlert.Styles.Contains("Blink")) Then
                        cs = c1UnappliedCopayAlert.Styles("Blink")
                    Else
                        cs = c1UnappliedCopayAlert.Styles.Add("Blink")
                        cs.Font = gloGlobal.clsgloFont.gFont_BOLD 'New System.Drawing.Font("Tahoma", 9.0F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte((0)))
                        cs.BackColor = Color.White
                        cs.Border.Color = Color.White
                    End If
                Catch ex As Exception
                    cs = c1UnappliedCopayAlert.Styles.Add("Blink")
                    cs.Font = gloGlobal.clsgloFont.gFont_BOLD 'New System.Drawing.Font("Tahoma", 9.0F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte((0)))
                    cs.BackColor = Color.White
                    cs.Border.Color = Color.White
                End Try
              
                c1UnappliedCopayAlert.SetCellStyle(rowIndex, COL_UA_COPAYALERT, cs)

                c1UnappliedCopayAlert.Cols(COL_UA_COPAYALERT).Visible = True
                c1UnappliedCopayAlert.Row = -1

                c1UnappliedCopayAlert.SelectionMode = C1.Win.C1FlexGrid.SelectionModeEnum.Row
            Else
                pnlUnappliedCopay.Visible = False
            End If

            If Not IsNothing(ogloAdvancePayment) Then  ''slr dispose  ogloAdvancePayment,_dtCopayAlert
                ogloAdvancePayment.Dispose()
                ogloAdvancePayment = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show("ERROR : " & ex.ToString, _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub c1CopayAlert_MouseDoubleClick(ByVal sender As Object, ByVal e As MouseEventArgs) Handles c1CopayAlert.MouseDoubleClick
        Try
            If c1CopayAlert IsNot Nothing AndAlso c1CopayAlert.Rows.Count > 0 Then
                If c1CopayAlert.GetData(0, 0) IsNot Nothing AndAlso Convert.ToString(c1CopayAlert.GetData(0, 0)).Trim() <> "" Then
                    Dim _insId As Int64 = 0
                    Dim _insName As String = ""
                    Dim _copayAmt As Decimal = 0

                    _insId = Convert.ToInt64(c1CopayAlert.GetData(0, 0))
                    _insName = Convert.ToString(c1CopayAlert.GetData(0, 1))
                    _copayAmt = Convert.ToDecimal(c1CopayAlert.GetData(0, 2))

                    'Dim ofrmAdvancePayment As gloBilling.frmAdvancePayment = New frmAdvancePayment(GetConnectionString(), gnPatientID, _insName, _insId, _copayAmt, PaymentOtherType.Copay)
                    'ofrmAdvancePayment.StartPosition = FormStartPosition.CenterScreen
                    'ofrmAdvancePayment.ShowDialog(Me)
                    'ofrmAdvancePayment.Dispose()

                    ShowCopayAlert()
                End If
            End If
        Catch ex As Exception
        End Try
    End Sub

    Private Sub tmrCopayAlert_Tick(ByVal sender As Object, ByVal e As EventArgs) Handles tmrCopayAlert.Tick
        Dim oSettings As New gloSettings.GeneralSettings(GetConnectionString())
        tmrCopayAlert.Enabled = False
        Try
            'Read Alert Settings (Blinking and Color Settings)
            Dim IsBlinking As Boolean = True
            Dim AlertColor As Color = Color.Red
            Dim oValue As Object = Nothing
            oSettings.GetSetting("BlinkingAlert", gnLoginID, gnClinicID, oValue)
            If oValue IsNot Nothing AndAlso Convert.ToString(oValue) <> "" Then
                IsBlinking = Convert.ToBoolean(oValue)
            End If

            oSettings.GetSetting("AlertColor", gnLoginID, gnClinicID, oValue)
            If oValue IsNot Nothing AndAlso Convert.ToString(oValue) <> "" Then
                AlertColor = Color.FromArgb(Convert.ToInt32(oValue))
            End If


            'Show Alert according to settings
            If pnlCopayAlert.Visible = True Then
                Dim cs As C1.Win.C1FlexGrid.CellStyle = c1CopayAlert.Styles("Blink")
                If IsBlinking = True Then
                    If cs.ForeColor = Color.Black Then
                        cs.ForeColor = AlertColor
                    Else
                        cs.ForeColor = Color.Black
                    End If
                Else
                    cs.ForeColor = AlertColor
                End If
            End If

            If pnlUnappliedCopay.Visible = True Then
                Dim cs As C1.Win.C1FlexGrid.CellStyle = c1UnappliedCopayAlert.Styles("Blink")
                If IsBlinking = True Then
                    If cs.ForeColor = Color.Black Then
                        cs.ForeColor = AlertColor
                    Else
                        cs.ForeColor = Color.Black
                    End If
                Else
                    cs.ForeColor = AlertColor
                End If
            End If
            oValue = Nothing     ''slr free oValue
            If Not IsNothing(oSettings) Then  ''slr free oSettings
                oSettings.Dispose()
                oSettings = Nothing
            End If
        Catch ex As Exception
        Finally   ''code change against problem 00000591
            'GC.Collect()
            'GC.WaitForPendingFinalizers()
            tmrCopayAlert.Enabled = True
        End Try

    End Sub


#End Region


#Region " Clinic Environment "

    Private Sub lblENV_01_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lblENV_01.Click
        Try
            lblENV_01.Tag = 1
            lblENV_Click(lblENV_01)
            UpdateAppointmentStatus() 'ShowAppointments()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub lblENV_02_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lblENV_02.Click
        Try
            lblENV_02.Tag = 2
            lblENV_Click(lblENV_02)
            UpdateAppointmentStatus() 'ShowAppointments()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub lblENV_03_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lblENV_03.Click
        Try
            lblENV_03.Tag = 3
            lblENV_Click(lblENV_03)
            UpdateAppointmentStatus() 'ShowAppointments()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub lblENV_04_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lblENV_04.Click
        Try
            lblENV_04.Tag = 4
            lblENV_Click(lblENV_04)
            UpdateAppointmentStatus() 'ShowAppointments()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub lblENV_05_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lblENV_05.Click
        Try
            lblENV_05.Tag = 5
            lblENV_Click(lblENV_05)
            UpdateAppointmentStatus() 'ShowAppointments()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub lblENV_06_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lblENV_06.Click
        Try
            lblENV_06.Tag = 6
            lblENV_Click(lblENV_06)
            UpdateAppointmentStatus() 'ShowAppointments()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub lblENV_Click(ByVal lbl As Label)
        Dim tempColor As Color
        Dim ColorSET As Int16 = 0
        If (gnPatientID = 0) Then
            gnPatientID = oPatientListControl.SelectedPatientID
        End If

        If gnPatientID <= 0 Then
            Exit Sub
        End If

        Dim _nVisitID As Int64 = 0
        'Bug #82275: CR0000361: Patient color status based on color
        '_nVisitID = GetVisitID(Now.Date, gnPatientID)
        If Not _isEnableStaticColor Then
            _nVisitID = GenerateVisitID(Now.Date, gnPatientID)
        Else
            _nVisitID = 0
        End If


        With lbl
            tempColor = lbl.BackColor
            If lbl.ForeColor.ToArgb = Color.White.ToArgb Then
                ColorSET = 0
            Else
                ColorSET = 1
            End If

            Dim cls As New clsDoctorsDashBoard
            Dim IsValid As Boolean = False
            Select Case lbl.Tag
                Case 1
                    IsValid = cls.Set_Patient_ClinicEnvironment(gnPatientID, frmSettings_New.ClinicEnvironment.ENV_1, ColorSET, _nVisitID)   ''.ForeColor.ToArgb)
                Case 2
                    IsValid = cls.Set_Patient_ClinicEnvironment(gnPatientID, frmSettings_New.ClinicEnvironment.ENV_2, ColorSET, _nVisitID) ''.ForeColor.ToArgb)
                Case 3
                    IsValid = cls.Set_Patient_ClinicEnvironment(gnPatientID, frmSettings_New.ClinicEnvironment.ENV_3, ColorSET, _nVisitID)  ''.ForeColor.ToArgb)
                Case 4
                    IsValid = cls.Set_Patient_ClinicEnvironment(gnPatientID, frmSettings_New.ClinicEnvironment.ENV_4, ColorSET, _nVisitID)  ''.ForeColor.ToArgb)
                Case 5
                    IsValid = cls.Set_Patient_ClinicEnvironment(gnPatientID, frmSettings_New.ClinicEnvironment.ENV_5, ColorSET, _nVisitID)  ''.ForeColor.ToArgb)
                Case 6
                    IsValid = cls.Set_Patient_ClinicEnvironment(gnPatientID, frmSettings_New.ClinicEnvironment.ENV_6, ColorSET, _nVisitID)   ''.ForeColor.ToArgb)
            End Select

            If IsValid = True Then
                .BackColor = lbl.ForeColor
                .ForeColor = tempColor
            End If
            If Not IsNothing(cls) Then  ''slr free cls
                cls = Nothing
            End If
        End With

        'End If
        'ShowAppointments()
    End Sub

    Private Sub Get_ClinicEnvironment()
        Dim dt, dtSTD As DataTable
        Dim cls As New clsDoctorsDashBoard
        Dim i As Int16
        dt = cls.Get_Patient_ClinicEnvironment(gnPatientID)
        dtSTD = cls.Get_Clinic_Environment
        cls = Nothing

        If IsNothing(dtSTD) = False Then
            '' Set Clinical Environment Color Codes
            For i = 0 To dtSTD.Rows.Count - 1
                Select Case dtSTD.Rows(i)("nEnvironment")
                    Case 1
                        lblENV_01.ForeColor = Color.FromArgb(dtSTD.Rows(i)("nColor"))
                    Case 2
                        lblENV_02.ForeColor = Color.FromArgb(dtSTD.Rows(i)("nColor"))
                    Case 3
                        lblENV_03.ForeColor = Color.FromArgb(dtSTD.Rows(i)("nColor"))
                    Case 4
                        lblENV_04.ForeColor = Color.FromArgb(dtSTD.Rows(i)("nColor"))
                    Case 5
                        lblENV_05.ForeColor = Color.FromArgb(dtSTD.Rows(i)("nColor"))
                    Case 6
                        lblENV_06.ForeColor = Color.FromArgb(dtSTD.Rows(i)("nColor"))
                End Select
            Next
        End If

        lblENV_01.BackColor = Color.White
        lblENV_02.BackColor = Color.White
        lblENV_03.BackColor = Color.White
        lblENV_04.BackColor = Color.White
        lblENV_05.BackColor = Color.White
        lblENV_06.BackColor = Color.White

        If IsNothing(dt) = False Then
            '' Set Patient's Clinical Environment Color Codes
            For i = 0 To dt.Rows.Count - 1
                Select Case dt.Rows(i)("nEnvironment")
                    Case frmSettings_New.ClinicEnvironment.ENV_1
                        If dt.Rows(i)("nColor") <> -1 Then
                            lblENV_01.BackColor = Color.FromArgb(dt.Rows(i)("nColor"))
                            lblENV_01.ForeColor = Color.White
                        End If
                    Case frmSettings_New.ClinicEnvironment.ENV_2
                        If dt.Rows(i)("nColor") <> -1 Then
                            lblENV_02.BackColor = Color.FromArgb(dt.Rows(i)("nColor"))
                            lblENV_02.ForeColor = Color.White
                        End If
                    Case frmSettings_New.ClinicEnvironment.ENV_3
                        If dt.Rows(i)("nColor") <> -1 Then
                            lblENV_03.BackColor = Color.FromArgb(dt.Rows(i)("nColor"))
                            lblENV_03.ForeColor = Color.White
                        End If
                    Case frmSettings_New.ClinicEnvironment.ENV_4
                        If dt.Rows(i)("nColor") <> -1 Then
                            lblENV_04.BackColor = Color.FromArgb(dt.Rows(i)("nColor"))
                            lblENV_04.ForeColor = Color.White
                        End If
                    Case frmSettings_New.ClinicEnvironment.ENV_5
                        If dt.Rows(i)("nColor") <> -1 Then
                            lblENV_05.BackColor = Color.FromArgb(dt.Rows(i)("nColor"))
                            lblENV_05.ForeColor = Color.White
                        End If
                    Case frmSettings_New.ClinicEnvironment.ENV_6
                        If dt.Rows(i)("nColor") <> -1 Then
                            lblENV_06.BackColor = Color.FromArgb(dt.Rows(i)("nColor"))
                            lblENV_06.ForeColor = Color.White
                        End If
                End Select
            Next


        End If
        If Not IsNothing(dt) Then  ''slr free dt
            dt.Dispose()
            dt = Nothing
        End If
        If Not IsNothing(dtSTD) Then  ''slr free dtstd
            dtSTD.Dispose()
            dtSTD = Nothing
        End If
        If Not IsNothing(cls) Then   ''slr free cls

            cls = Nothing
        End If


    End Sub

#End Region

#Region " ToolStrip Buttons Customization"
    Private Sub tlbStripMain_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles tlbStripMain.MouseDown
        Try

          
            If e.Button = Windows.Forms.MouseButtons.Right Then
                If gblnSecurityUser = False Then
                    'Try
                    '    If (IsNothing(tlbStripMain.ContextMenuStrip) = False) Then
                    '        tlbStripMain.ContextMenuStrip.Dispose()
                    '        tlbStripMain.ContextMenuStrip = Nothing
                    '    End If
                    'Catch ex As Exception

                    'End Try

                    tlbStripMain.ContextMenuStrip = cmnuToolStripCustomize
                    cmnuToolStripCustomize.Tag = "tlbStripMain"
                End If

            Else
                'Try
                '    If (IsNothing(tlbStripMain.ContextMenuStrip) = False) Then
                '        tlbStripMain.ContextMenuStrip.Dispose()
                '        tlbStripMain.ContextMenuStrip = Nothing
                '    End If
                'Catch ex As Exception

                'End Try
                tlbStripMain.ContextMenuStrip = Nothing
                cmnuToolStripCustomize.Tag = Nothing
            End If
            If gblnSecurityUser = False Then ''added for bugid 78617
                cmnuToolStripCustomize.Tag = "tlbStripMain"
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ts_PatientDetails_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles ts_PatientDetails.MouseDown
        Try
           
            If e.Button = Windows.Forms.MouseButtons.Right Then
                If gblnSecurityUser = False Then
                    'Try
                    '    If (IsNothing(ts_PatientDetails.ContextMenuStrip) = False) Then
                    '        ts_PatientDetails.ContextMenuStrip.Dispose()
                    '        ts_PatientDetails.ContextMenuStrip = Nothing
                    '    End If
                    'Catch ex As Exception

                    'End Try

                    ts_PatientDetails.ContextMenuStrip = cmnuToolStripCustomize
                    cmnuToolStripCustomize.Tag = "ts_PatientDetails"
                    If e.X > (pnlPatientDetail.Width) - 500 Then
                        cmnuToolStripCustomize.DefaultDropDownDirection = ToolStripDropDownDirection.BelowLeft
                    End If
                End If
            Else
                'Try
                '    If (IsNothing(ts_PatientDetails.ContextMenuStrip) = False) Then
                '        ts_PatientDetails.ContextMenuStrip.Dispose()
                '        ts_PatientDetails.ContextMenuStrip = Nothing
                '    End If
                'Catch ex As Exception

                'End Try
                ts_PatientDetails.ContextMenuStrip = Nothing
                cmnuToolStripCustomize.Tag = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub CustomizeToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CustomizeToolStripMenuItem.Click
        Try
            Dim frm As frmToolButtonSelection = Nothing
            Dim strPrevGroup As String = ""
            If cmnuToolStripCustomize.Tag = "tlbStripMain" Then
                frm = New frmToolButtonSelection(tlbStripMain, frmToolButtonSelection.enumModuleName.Dashboard, arrDashBoardToolStrip, arrMainStripButtonsToHide)
            ElseIf cmnuToolStripCustomize.Tag = "ts_PatientDetails" Then
                frm = New frmToolButtonSelection(ts_PatientDetails, frmToolButtonSelection.enumModuleName.PatientDetails, arrPatientDetailToolStrip, arrPatDetailsButtonsToHide)
            ElseIf cmnuToolStripCustomize.Tag = "pnlTask" Then
                strPrevGroup = cmbFilters.Text
                _flexGroup.Groups = ""
                Dim arrColList As New ArrayList()
                For Each col As Column In _flexGroup.Grid.Cols
                    If col.Visible Then
                        arrColList.Add(col.Name)
                    End If
                Next
                frm = New frmToolButtonSelection(arrColList)
                frm.strFlexGroupCustomColumns = _flexGroup._FlexColumnInfoCustom
                arrColList = Nothing
            End If

            'frm._ToolButtons = tblStrip_32.Items
            If IsNothing(frm) = False Then
                frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
                If cmnuToolStripCustomize.Tag = "pnlTask" Then
                    If Not IsNothing(frm.strFlexGroupCustomColumns) Then
                        Dim _taskId As Int64
                        Dim rowSel As Int16 = _flexGroup.Grid.RowSel
                        If _flexGroup.Grid.Row <> -1 Then
                            _taskId = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"), Int64)
                        End If
                        _flexGroup.FlexColumnInfoCustom = frm.strFlexGroupCustomColumns
                        _flexGroup.Groups = strPrevGroup
                        _flexGroup.setPriorityImage()
                        SelectTaskOnFlexGroup(_taskId, rowSel)
                    End If
                End If
                If Not IsNothing(frm) Then   ''Slr free frm
                    frm.Close()
                    frm.Dispose()
                    frm = Nothing
                End If
            End If
            If cmnuToolStripCustomize.Tag = "tlbStripMain" Then
              
            ElseIf cmnuToolStripCustomize.Tag = "ts_PatientDetails" Then
                tsbtn_Hover.Visible = False
                tsbtn_Normal.Visible = False
                tsbtn_Selected.Visible = False

                '' SUDHIR 20090619 '' 
                '' AFTER SAVING TOOLSTRIP, IF PREVIOUSLY SELECTED BUTTON IS HIDDEN. 
                '' THEN SHOW PATIENT DETAILS OF FIRST VISIBLE BUTTON ''
                For iButton As Integer = 0 To ts_PatientDetails.Items.Count - 1
                    Dim _ButtonFound As Boolean = False
                    '' CHECK WHETHER PREVIOUS SELECTED BUTTON IS HIDDEN OR NOT ''
                    If ts_PatientDetails.Items(iButton).BackgroundImage Is tsbtn_Selected.BackgroundImage Then
                        '' IF ITS HIDDEN ''
                        If ts_PatientDetails.Items(iButton).Visible = False AndAlso ts_PatientDetails.Items(iButton).IsOnOverflow = False Then
                            '' THEN FIND FOR FIRST VISIBLE BUTTON OF TOOLSTRIP ''
                            For jButton As Integer = 0 To ts_PatientDetails.Items.Count - 1
                                If ts_PatientDetails.Items(jButton).Visible = True AndAlso Not ts_PatientDetails.Items(jButton).Tag Is Nothing Then
                                    '' AND CLICK IT ''
                                    ts_PatientDetails.Items(jButton).PerformClick()
                                    _ButtonFound = True
                                    Exit For '' GO OUT OF LOOP ''
                                End If
                            Next
                        Else
                            _ButtonFound = True
                            ts_PatientDetails.Items(iButton).PerformClick()
                        End If

                        If _ButtonFound = False Then

                            C1dgPatientDetails.DataSource = Nothing
                            C1dgPatientDetails.Visible = False
                            pnlPatientDetail.Image = Nothing
                            pnlPatientDetail.Text = ""
                            pnlSearchFilter.Visible = False
                            SelectedPatientDetail = PatientDetails.None
                        Else
                            C1dgPatientDetails.Visible = True
                        End If
                        Exit For
                    End If
                Next
            End If

            'Sanjog - Added on 2011 May 26 to load the lab control again if Lab tab is selected
            If SelectedPatientDetail = PatientDetails.Orders Then
                Fill_Labs()
            End If
            'Sanjog - Added on 2011 May 26 to load the lab control again if Lab tab is selected

        Catch ex As NullReferenceException
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

#End Region

#Region "Display Settings"

    Private Sub SaveDisplaySettings()

        Dim trn As SqlTransaction = Nothing
        Dim Con As New SqlConnection(GetConnectionString)
        Dim cmd As SqlCommand = Nothing
        Dim objParam As SqlParameter = Nothing
        Dim memStream As MemoryStream
        memStream = New MemoryStream()
        Try

            'Save Display Settings To MemoryStream

            uiPanelManager1.SaveLayoutFile(memStream)

            '-----------------Save MemoryStream To database
            Con.Open()

            trn = Con.BeginTransaction

            'Delete Previous Settings
            cmd = New SqlCommand("gsp_DELETE_UserDisplaySettings", Con)
            cmd.CommandType = CommandType.StoredProcedure
            cmd.Transaction = trn

            objParam = cmd.Parameters.Add("@nUserID", SqlDbType.BigInt)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = gnLoginID

            objParam = cmd.Parameters.Add("@sMachineName", SqlDbType.VarChar)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = gstrClientMachineName

            cmd.ExecuteNonQuery()
            ''Slr dispose cmd
            If Not IsNothing(cmd) Then
                cmd.Parameters.Clear()
                cmd.Dispose()
                cmd = Nothing
            End If
            'Save New Settings
            cmd = New SqlCommand("gsp_INUP_UserDisplaySettings", Con)
            cmd.CommandType = CommandType.StoredProcedure
            cmd.Transaction = trn

            objParam = cmd.Parameters.Add("@nUserID", SqlDbType.BigInt)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = gnLoginID

            objParam = cmd.Parameters.Add("@sMachineName", SqlDbType.VarChar)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = gstrClientMachineName

            objParam = cmd.Parameters.Add("@nPanel", SqlDbType.Int)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = 0

            objParam = cmd.Parameters.Add("@nSize", SqlDbType.Decimal)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = 0

            objParam = cmd.Parameters.Add("@iStyle", SqlDbType.Image)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = memStream.ToArray()

            ' Con.Open()
            cmd.ExecuteNonQuery()
            cmd.Parameters.Clear()
            memStream.Dispose()
            trn.Commit()

        Catch ex As SqlException
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Add, "Save_UserDisplaySettings -- " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show(gstrSQLError, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            trn.Rollback()

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Add, "Save_UserDisplaySettings -- " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            trn.Rollback()
        Finally
            If Not IsNothing(memStream) Then
                memStream.Dispose()
                memStream = Nothing
            End If

            If Not IsNothing(cmd) Then  ''slr dispose cmd
                cmd.Parameters.Clear()
                cmd.Dispose()
                cmd = Nothing
            End If
            If Not IsNothing(trn) Then  ''slr dispose trn
                trn.Dispose()
            End If
            If Not IsNothing(Con) Then      ''slr dispose con
                If Con.State = ConnectionState.Open Then
                    Con.Close()
                End If
                Con.Dispose()
            End If
            Con = Nothing
            trn = Nothing
            Con = Nothing
        End Try
    End Sub

    Private Sub SaveFlexGroupDisplaySettings()
        Dim strFlexColInfo As String = ""
        Try
            If (IsNothing(_flexGroup) = False) Then
                _flexGroup.Groups = ""
                'SLR: optimization made for not to check for strflex <>  for each column
                For Each col As Column In _flexGroup.Grid.Cols

                    If col.Name = "Due Date" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","
                    ElseIf col.Name = "Patient Name" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","
                    ElseIf col.Name = "SSN" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","
                    ElseIf col.Name = "Date Of Birth" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","
                    ElseIf col.Name = "Subject" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","
                    ElseIf col.Name = "Priority" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","
                    ElseIf col.Name = "Status" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","
                    ElseIf col.Name = "Task Type" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","
                    ElseIf col.Name = "Resp" Then
                        'If strFlexColInfo <> "" Then
                        '    strFlexColInfo = strFlexColInfo + ","
                        'End If
                        strFlexColInfo = strFlexColInfo & col.Name.ToString() & ":" & col.Index.ToString() & ":" & Convert.ToString(Convert.ToInt16(col.Visible)) & ","

                    End If
                Next
            'SLR: optimization made to remove last ","
            If (strFlexColInfo <> "") Then
                strFlexColInfo = strFlexColInfo.Substring(0, strFlexColInfo.Length - 1) ' To remove last ","
            End If
            Dim ogloSettings As New gloSettings.GeneralSettings(GetConnectionString)
            ogloSettings.AddSetting("TaskFlexGroupCustomColumn", strFlexColInfo, gnClinicID, gnLoginID, gloSettings.SettingFlag.Clinic)
            ogloSettings.AddSetting("TaskFlexGroupCustomColumnWidth", _flexGroup._FlexColumnWidthInfoCustom, gnClinicID, gnLoginID, gloSettings.SettingFlag.Clinic)
            'If cmbFilters.Text = "" Then
            '    ogloSettings.AddSetting("TaskFlexGroupGroupFilter", "Due Date", gnClinicID, gnLoginID, gloSettings.SettingFlag.Clinic)
            'Else
            ogloSettings.AddSetting("TaskFlexGroupGroupFilter", cmbFilters.Text, gnClinicID, gnLoginID, gloSettings.SettingFlag.Clinic)
            'End If
            ogloSettings.Dispose()
            ogloSettings = Nothing
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Load, "SaveFlexGroupDisplaySettings -- " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show(ex.Message)
        End Try
    End Sub

    Private Sub LoadFlexGroupColumnDisplaySettings()
        Dim ogloSettings As New gloSettings.GeneralSettings(GetConnectionString)
        Dim FlexCustomColumn As New Object()
        Dim FlexCustomColumnWidth As New Object()
        Try

            ogloSettings.GetSetting("TaskFlexGroupCustomColumn", gnLoginID, gnClinicID, FlexCustomColumn)
            ogloSettings.GetSetting("TaskFlexGroupCustomColumnWidth", gnLoginID, gnClinicID, FlexCustomColumnWidth)

            If Convert.ToString(FlexCustomColumnWidth) <> "" Then
                _flexGroup._FlexColumnWidthInfoCustom = Convert.ToString(FlexCustomColumnWidth)
            End If
            If Convert.ToString(FlexCustomColumn) <> "" Then
                _flexGroup.FlexColumnInfoCustom = Convert.ToString(FlexCustomColumn)
            Else
                '_flexGroup.FlexColumnInfoCustom = "Due Date:1:1,Patient Name:2:1,Subject:3:1,Task Type:4:1,Status:5:1,Priority:6:1,SSN:7:1,Date Of Birth:8:1,bisOwner:9:1,bIsOwnerAssigned:10:1"
                _flexGroup.FlexColumnInfoCustom = "Due Date:1:1,Patient Name:2:1,Subject:3:1,Task Type:4:1,Status:5:1,Priority:6:1,SSN:7:1,Date Of Birth:8:1,Resp:23:1"
            End If



        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Load, "LoadFlexGroupDisplaySettings -- " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show(ex.Message)
        Finally
            If Not IsNothing(ogloSettings) Then
                ogloSettings.Dispose()
                ogloSettings = Nothing
            End If
            FlexCustomColumn = Nothing
        End Try
    End Sub
    Dim strTaskCustomGroup As String = ""
    Private Sub LoadTaskListGroupSetting()
        Dim ogloSettings As New gloSettings.GeneralSettings(GetConnectionString)
        Dim FlexGroupFilter As New Object()
        Try
            ogloSettings.GetSetting("TaskFlexGroupGroupFilter", gnLoginID, gnClinicID, FlexGroupFilter)
            'If Convert.ToString(FlexGroupFilter) <> "" Then
            strTaskCustomGroup = Convert.ToString(FlexGroupFilter)
            'cmbFilters.Text = Convert.ToString(FlexGroupFilter)
            '_flexGroup.Groups = Convert.ToString(FlexGroupFilter)
            'Else
            'strTaskCustomGroup = "Due Date"
            ''_flexGroup.Groups = "Due Date"
            ''cmbFilters.Text = "Due Date"
            'End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Load, "LoadFlexGroupDisplaySettings -- " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show(ex.Message)
        Finally
            If Not IsNothing(ogloSettings) Then
                ogloSettings.Dispose()
                ogloSettings = Nothing
            End If
            FlexGroupFilter = Nothing
        End Try

    End Sub


    Private Sub LoadDisplaySettings()
        Dim Con As SqlConnection = Nothing
        Dim cmd As SqlCommand = Nothing
        Dim da As SqlDataAdapter = Nothing ''slr new not needed 
        Dim dt As DataTable = Nothing ''slr new not needed 
        Try
            'Get Users Display Settings
            Con = New SqlConnection(GetConnectionString)
            cmd = New SqlCommand("gsp_GET_UserDisplaySettings", Con)
            cmd.CommandType = CommandType.StoredProcedure
            Dim objParam As SqlParameter

            objParam = cmd.Parameters.Add("@nUserID", SqlDbType.BigInt)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = gnLoginID

            objParam = cmd.Parameters.Add("@sMachineName", SqlDbType.VarChar)
            objParam.Direction = ParameterDirection.Input
            objParam.Value = gstrClientMachineName

            da = New SqlDataAdapter
            dt = New DataTable
            da.SelectCommand = cmd
            da.Fill(dt)

            'Load Display Settings
            If IsNothing(dt) = False Then
                If dt.Rows.Count > 0 Then
                    If IsDBNull(dt.Rows(0)("iStyle")) = False Then
                        Dim oBytesArry() As Byte = CType(dt.Rows(0)("iStyle"), Byte())
                        Dim memStream As MemoryStream = New MemoryStream(oBytesArry)
                        uiPanelManager1.LoadLayoutFile(memStream)
                        'SLR: clear obytesarray
                        If Not oBytesArry Is Nothing Then
                            oBytesArry = Nothing
                        End If
                        memStream.Close()
                        memStream.Dispose()
                        memStream = Nothing
                    End If
                End If
            End If
        Catch ex As SqlException
            MessageBox.Show(gstrSQLError, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Load, "LoadDisplaySettings -- " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Load, "LoadDisplaySettings -- " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(dt) Then
                dt.Dispose()
                dt = Nothing
            End If
            If Not IsNothing(da) Then
                da.Dispose()
                da = Nothing
            End If
            If Not IsNothing(cmd) Then
                cmd.Parameters.Clear()
                cmd.Dispose()
                cmd = Nothing
            End If
            If Not IsNothing(Con) Then
                If Con.State = ConnectionState.Open Then
                    Con.Close()
                End If
                Con.Dispose()
                Con = Nothing
            End If
        End Try
    End Sub

    Private Sub ResetDisplaySettings()

        Dim ogloTasks As New gloTaskMail.gloTask(GetConnectionString)
        Dim oTasks As gloTaskMail.Tasks = Nothing ''slr new not needed 
        Dim oClsTriage As New gloStream.gloEMR.Triage.clsTriage
        Dim oTriages As gloStream.gloEMR.Triage.Supportings.Triages = Nothing
        Dim oClsMessages As New clsMessage
        Dim dt As DataTable = Nothing ''slr new not needed 
        Dim obj As New clsPatientExams
        Dim dtUnfinishedExams As New DataTable
        Dim fileName As String = System.Windows.Forms.Application.StartupPath + "\\PanelDefaultLayout.xml"


        Try

            Dim fInfo As System.IO.FileInfo = New System.IO.FileInfo(fileName)


            If (fInfo.Exists) Then
                Dim ofstream As FileStream = fInfo.Open(FileMode.OpenOrCreate)
                '' Load the User Display Setting from the XML File
                uiPanelManager1.LoadLayoutFile(ofstream)
                ofstream.Close()
                ofstream.Dispose() ''slr dispose ofstream   
                ofstream = Nothing
            End If
            ''added by sanjog on 07/06/2010 for Display patient list and toolbar on defaul setting click
            'added by pradeep 20100812 to show counts for messages,tasks,triages and unfinished exam  
            pnlPatientList.Visible = True
            pnlMainToolBar.Visible = True


            dt = oClsMessages.GetTopMessages("", 100, gnLoginID)
            'oTasks = ogloTasks.GetUnFinishedUserTasks(gnLoginID, nShowTaskRowCount)

            '30-Apr-15 Aniket: Resolving Bug #81248 ( Modified): gloEMR: Task- Task Header displays 100 number of task as user click on load default display settings
            ShowTasks()
            dtUnfinishedExams = obj.GetProviderUnfinishedExams(gnSelectedProviderID)
            oTriages = oClsTriage.GetUserTriage(gnLoginID, True)




            'If Not IsNothing(oTasks) Then
            '    Me.pnlTasks.Text = "Tasks" & " [" & oTasks.Count.ToString & "]"
            'Else
            '    Me.pnlTasks.Text = "Tasks" & " [" & "0" & "]"
            'End If

            If Not (IsNothing(oTriages)) Then
                pnlNav_Triage.Text = "Triage [" & oTriages.Count & "]"
            Else
                pnlNav_Triage.Text = "Triage [0]"
            End If
            If IsNothing(dtUnfinishedExams) = False Then
                If dtUnfinishedExams.Rows.Count > 0 Then
                    pnlNav_UnfinishedExams.Text = "Unfinished Exams [" & dtUnfinishedExams.Rows.Count & "]"
                End If
            Else
                pnlNav_UnfinishedExams.Text = "Unfinished Exams [0]"
            End If
            If IsNothing(dt) = False AndAlso dt.Rows.Count > 0 Then
                pnl_Messages.Text = "Messages [" & dt.Rows.Count.ToString() & "]"
            Else
                pnl_Messages.Text = "Messages [0]"
            End If
            SetYesLab()
            ''''''''''''''end pradeep''''''''''''''''''''''''
            ''added by sanjog on 07/06/2010 for Display patient list and toolbar on defaul setting click
        Catch ex As Exception

        Finally
            ogloTasks.Dispose()
            ogloTasks = Nothing
            If Not IsNothing(oTasks) Then ''slr 
                oTasks.Dispose()
            End If
            oTasks = Nothing

            oClsTriage = Nothing

            oClsMessages.Dispose()
            oClsMessages = Nothing
            If Not IsNothing(dt) Then 'slr
                dt.Dispose()
            End If
            dt = Nothing
            obj.Dispose()
            obj = Nothing
            If Not IsNothing(dtUnfinishedExams) Then  'slr
                dtUnfinishedExams.Dispose()
            End If

            dtUnfinishedExams = Nothing

            If Not IsNothing(oTriages) Then 'slr
                oTriages = Nothing
            End If

        End Try
    End Sub

#End Region

    Dim _ExceptionCaught As Boolean
    Private Sub mnuDicomViewer_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuDicomViewer.Click
        ''sandip Darade 20090826
        ' ' to catch exception if the ocx is not registered

        If IsAccess(False) = False Then
            Exit Sub
        End If

        _ExceptionCaught = False
        Dim ofrmDICOM As New frmgloDICOM(gnPatientID)
        AddHandler System.Windows.Forms.Application.ThreadException, AddressOf OnUnhandledExceptionDICOM
        Try
            If DICOMPath <> "" Then
                ofrmDICOM.MdiParent = Me
                ofrmDICOM.Show()
                ShowHideMainMenu(False, False)
                ofrmDICOM.WindowState = FormWindowState.Maximized
            Else
                MessageBox.Show("'Set the DICOM path from  Tool->Settings->Server Path.'", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If

        Catch comex As System.Runtime.InteropServices.COMException
            _ExceptionCaught = True

            MessageBox.Show("The required components for DICOM are missing.  Please install.  ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        Catch ex As Exception
        Finally
            If (_ExceptionCaught = True) Then
                RemoveHandler System.Windows.Forms.Application.ThreadException, AddressOf OnUnhandledExceptionDICOM  ''slr removehandler
                ofrmDICOM.Dispose()
                If (Me.MdiChildren.Length = 0) Then
                    ShowHideMainMenu(True, True)
                End If
            End If
        End Try
    End Sub

    ''sandip Darade 20090826
    ' ' to catch exception if the ocx is not registered
    Private Sub OnUnhandledExceptionDICOM(ByVal sender As Object, ByVal t As ThreadExceptionEventArgs)
        _ExceptionCaught = True
        MessageBox.Show("The required components for DICOM are missing.  Please install.  ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
    End Sub

    Private Sub mnuMaster_DrugProviderAssociation_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMaster_DrugProviderAssociation.Click
        Try
            Dim oDrugsProviderConfig As frmDrugProviderAssociation = Nothing
            If gnLoginProviderID > 0 Then
                oDrugsProviderConfig = New frmDrugProviderAssociation(gnPatientID, gnLoginProviderID)
            Else
                oDrugsProviderConfig = New frmDrugProviderAssociation(gnPatientID)
            End If


            System.Windows.Forms.Application.DoEvents()
            With oDrugsProviderConfig
                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuLiquidData_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuLiquidData.Click
        Dim frmData As New frmLiquidData
        Try
            System.Windows.Forms.Application.DoEvents()
            With frmData
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_ViewPatientSynopsis_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_ViewPatientSynopsis.Click
        Try
            Try
                If gnPatientID <= 0 Then
                    '''''This IF statement is added by dipak on 20091027,This message will appear if patients are there in the grid i.e., if grid is not blank and patient not selected
                    If oPatientListControl.VisiblePatientCount > 0 Then
                        MessageBox.Show("Select the Patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Exit Sub
                    Else
                        Exit Sub
                    End If
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If

                Dim frm As New frmPatientSynopsis(gnPatientID)
                AddHandler frm.FormClosed, AddressOf On_frmPatientSynopsis_Closed '' SUDHIR 20090708 ''


                frm.MdiParent = Me
                frm.Show()
                frm.WindowState = FormWindowState.Maximized
                ShowHideMainMenu(False, False)
                Me.pnlMainToolBar.Visible = False
            Catch objErr As Exception
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub On_frmPatientSynopsis_Closed(ByVal sender As Object, ByVal e As FormClosedEventArgs)

        Dim frm As frmPatientSynopsis = Nothing

        Try
            frm = DirectCast(sender, frmPatientSynopsis)
        Catch ex As Exception

        End Try
        Try
            If (IsNothing(frm) = False) Then
                RemoveHandler frm.FormClosed, AddressOf On_frmPatientSynopsis_Closed
            End If
            If (IsNothing(frm) = False) Then
                frm.Close()
            End If
            If (IsNothing(frm) = False) Then
                frm.Dispose()
                frm = Nothing
            End If

        Catch ex As Exception

        End Try



        ShowTasks()
    End Sub

    Private Sub mnuImportCCD_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuImportCCD.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If
            Dim frm As New frmAttachment(gnPatientID)
            frm.MyMDIParent = Me
            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            ShowReconciliationAlert()
            If Not IsNothing(frm) Then  ''slr free frm
                frm.MyMDIParent = Nothing
                frm.Dispose()
            End If
            frm = Nothing
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    '---------------------------------------------
    'Added by Rohit on 17-March-2011 
    ''' <summary>
    ''' Added run time menu under Custom Link Menu
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks></remarks>
    Private Sub mnuCustomLink_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuCustomLink.MouseEnter ' mnuCustomLink.Click,
        Dim _oDbLayer As gloDatabaseLayer.DBLayer = Nothing
        Dim dtCustomLinks As DataTable = Nothing
        Dim _strSql As String = String.Empty
        Dim _CurrentLinksMasterCount As Long = 0
        Dim _maxVisibleMenuitems As Long = 10
        Dim _linkURLLocation As String = String.Empty
        Dim _linkName As String = String.Empty
        Dim intRecCnt As Int32
        Try

            _oDbLayer = New gloDatabaseLayer.DBLayer(GetConnectionString)
            _oDbLayer.Connect(False)
            _strSql = "SELECT ISNULL(sLinkName,'') as LinkName, ISNULL(sURL,'') as sURL  FROM User_CustomLinks_MST Order by sLinkName"
            _oDbLayer.Retrive_Query(_strSql, dtCustomLinks)
            _oDbLayer.Disconnect()
            _oDbLayer.Dispose()
            _oDbLayer = Nothing

            mnuCustomLink.DropDown.Items.Clear()
            If (Not IsNothing(dtCustomLinks)) AndAlso (dtCustomLinks.Rows.Count > 0) Then
                _CurrentLinksMasterCount = dtCustomLinks.Rows.Count

                If dtCustomLinks.Rows.Count <= 10 Then
                    mnuCustomLink.DropDown.AutoSize = True
                Else
                    mnuCustomLink.DropDown.AutoSize = False
                    mnuCustomLink.DropDown.Height = 25 * 10 '_CurrentLinksMasterCount
                    mnuCustomLink.DropDown.Width = 200
                End If

                Dim mtl As ToolStripMenuItem
                For intRecCnt = 0 To dtCustomLinks.Rows.Count - 1
                    ''_linkname
                    _linkName = Convert.ToString(dtCustomLinks.Rows(intRecCnt)("LinkName")).Trim()
                    ''_linkURL
                    _linkURLLocation = Convert.ToString(dtCustomLinks.Rows(intRecCnt)("sURL")).Trim()

                    mtl = New ToolStripMenuItem(_linkName, Nothing, AddressOf CustomLinkSubMenu_Click)
                    mtl.Tag = _linkURLLocation
                    mtl.ToolTipText = _linkName
                    'Add run time menus from link master,
                    mnuCustomLink.DropDown.Items.Add(mtl)

                    'Clean up for local variables.
                    _linkName = String.Empty
                    _linkURLLocation = String.Empty
                    mtl = Nothing
                Next
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK)
        Finally
            _strSql = String.Empty
            _CurrentLinksMasterCount = 0
            If Not IsNothing(_oDbLayer) Then
                _oDbLayer.Dispose()
                _oDbLayer = Nothing
            End If
            If Not IsNothing(dtCustomLinks) Then
                dtCustomLinks.Dispose()
                dtCustomLinks = Nothing
            End If
        End Try
    End Sub

    ''' <summary>
    ''' Launch menu selected by user
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks></remarks>
    Private Sub CustomLinkSubMenu_Click(ByVal sender As Object, ByVal e As EventArgs)

        Dim appSettings As System.Collections.Specialized.NameValueCollection = System.Configuration.ConfigurationManager.AppSettings
        Dim _oDbLayer As gloDatabaseLayer.DBLayer = Nothing
        Dim _sSubMenuItem As ToolStripMenuItem
        Dim dtCustomLink As DataTable = Nothing
        Dim _strURL_TobeLaunch As String = String.Empty
        Dim _strQueryString As String = String.Empty
        Dim objencryption As New clsencryption
        Dim _strDecryptedPassword As String = String.Empty
        Dim _strEncryptedPassword_using_EncryptionMethod As String = String.Empty
        Dim _strEncryptedUserName As String = String.Empty
        Dim _strUserName As String = String.Empty
        Dim _txtEncryptedPasseword As New TextBox
        Try

            _sSubMenuItem = DirectCast(sender, ToolStripMenuItem)
            _strURL_TobeLaunch = Convert.ToString(_sSubMenuItem.Tag)

            _strQueryString = "select ISNULL(sLoginID,'') as LoginID, ISNULL(sPassword,'') as [Password], ISNULL(sEncryptionMethod,'') as [EncryptionMethod] FROM User_ExternalCodes WHERE nLinkID=(select ISNULL(nLinkID,0) from User_CustomLinks_MST WHERE sLinkName='" & Convert.ToString(_sSubMenuItem).Replace("'", "''").Trim() & "') AND nUserID=" & Convert.ToInt64(appSettings("UserID")) & " and sModuleName='CustomLink'"

            _oDbLayer = New gloDatabaseLayer.DBLayer(GetConnectionString)

            _oDbLayer.Connect(False)
            _oDbLayer.Retrive_Query(_strQueryString, dtCustomLink)

            _oDbLayer.Disconnect()
            _oDbLayer.Dispose()
            _oDbLayer = Nothing
            If (Not IsNothing(dtCustomLink)) AndAlso (dtCustomLink.Rows.Count > 0) Then
                If Convert.ToString(dtCustomLink.Rows(0).Item("Password")).Trim <> String.Empty AndAlso Convert.ToString(dtCustomLink.Rows(0).Item("LoginID")).Trim <> String.Empty Then
                    'Decrypting the password
                    _strDecryptedPassword = objencryption.DecryptFromBase64String(Convert.ToString(dtCustomLink.Rows(0).Item("Password")), constEncryptDecryptKey)
                    _strUserName = Convert.ToString(dtCustomLink.Rows(0).Item("LoginID"))
                    If Convert.ToString(dtCustomLink.Rows(0).Item("EncryptionMethod")).Trim = "None" Then
                        ValidateURL(_strURL_TobeLaunch, True, _strDecryptedPassword, _strUserName)
                    Else
                        'Added run time text box on form
                        Me.Controls.Add(_txtEncryptedPasseword)
                        ''Encrypted Password
                        _txtEncryptedPasseword.Visible = False
                        _txtEncryptedPasseword.Text = EncryptionInterface.Encrypt(_strDecryptedPassword) ''_strDecryptedPassword.Trim()
                        _strEncryptedPassword_using_EncryptionMethod = _txtEncryptedPasseword.Text 'EncryptionInterface.Encrypt(_strDecryptedPassword)
                        'Encrypted UserName
                        _txtEncryptedPasseword.Text = String.Empty
                        _txtEncryptedPasseword.Text = EncryptionInterface.Encrypt(_strEncryptedUserName)
                        _strEncryptedUserName = _txtEncryptedPasseword.Text
                        ValidateURL(_strURL_TobeLaunch, True, _strEncryptedPassword_using_EncryptionMethod, _strEncryptedUserName)
                    End If
                Else
                    ValidateURL(_strURL_TobeLaunch, False, String.Empty, String.Empty)
                End If
            Else
                ValidateURL(_strURL_TobeLaunch, False, String.Empty, String.Empty)
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK)
        Finally
            If Not IsNothing(_txtEncryptedPasseword) Then
                Me.Controls.Remove(_txtEncryptedPasseword)
                _txtEncryptedPasseword.Text = Nothing
                _txtEncryptedPasseword.Dispose()
            End If
            _strQueryString = String.Empty
            _strURL_TobeLaunch = String.Empty
            _sSubMenuItem = Nothing

            If (IsNothing(objencryption) = False) Then
                objencryption.Dispose()
                objencryption = Nothing
            End If
          
            If Not IsNothing(_oDbLayer) Then
                _oDbLayer.Dispose()
                _oDbLayer = Nothing
            End If
        End Try
    End Sub


    Private Sub ValidateURL(ByVal strURL_Launch As String, ByVal blnIs_User_Valid As Boolean, ByVal sPassword As String, ByVal sUserName As String)
        Try

            strURL_Launch = Microsoft.VisualBasic.Strings.Replace(strURL_Launch, "|-uid-|", "|-UID-|", 1, -1, CompareMethod.Text)
            strURL_Launch = Microsoft.VisualBasic.Strings.Replace(strURL_Launch, "|-pwd-|", "|-PWD-|", 1, -1, CompareMethod.Text)

            If blnIs_User_Valid Then

                strURL_Launch = strURL_Launch.Replace("|-UID-|", sUserName).Replace("|-PWD-|", sPassword)
            Else
                'If MessageBox.Show("You are not authorized to access this link." & vbCrLf & " Are you sure you still want to continue?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Information) = System.Windows.Forms.DialogResult.Yes Then
                If MessageBox.Show("Your account is not associated to this custom link." & vbCrLf & "Do you want to launch without credentials?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Information) = System.Windows.Forms.DialogResult.Yes Then
                    strURL_Launch = strURL_Launch.Replace("|-UID-|", String.Empty).Replace("|-PWD-|", String.Empty)
                Else
                    Exit Sub
                End If
            End If

            Dim startInfo As New ProcessStartInfo("IExplore.exe")
            startInfo.WindowStyle = ProcessWindowStyle.Maximized
            startInfo.Arguments = strURL_Launch
            Process.Start(startInfo)

        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK)
        Finally
        End Try
    End Sub

    'End of code Added by Rohit on 17-March-2011 

    Private Sub mnuGenerateCCD_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuGenerateCCD.Click
        Try
            If gnPatientID <= 0 Then
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If
            If IsAccess(False) = False Then
                Exit Sub
            End If
            Dim objfrm As New frmCCDGenerateList(gnPatientID)
            With objfrm
                .WindowState = FormWindowState.Normal
                ''Added on 20100727 by sanjog for Select all module
                .ChkAll.Checked = True
                ''Added on 20100727 by sanjog for Select all module
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With
            'Code opti by Mitesh 
            If Not IsNothing(objfrm) Then
                objfrm.Dispose()
                objfrm = Nothing
            End If
        Catch ex As gloCCDLibrary.gloCCDException
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        End Try
        'Dim ogloInterface As gloCCDLibrary.gloCCDInterface
        'Try
        '    If gloCCDLibrary.gloLibCCDGeneral.CCDFileGenerationPath <> "" Then
        '        If Directory.Exists(gstrCCDFilePath) = True Then
        '            ogloInterface = New gloCCDLibrary.gloCCDInterface
        '            Try
        '                ogloInterface.GenerateClinicalInformation(gnPatientID, gnLoginID)
        '            Catch ex As Exception
        '                MessageBox.Show("You do not have write permissions for the CCD directory." & vbCrLf & "Contact your system administrator or configure a different directory for CCD.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        '                Exit Sub
        '            End Try

        '            MessageBox.Show("CCD file successfully generated.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        '        Else
        '            MessageBox.Show("Invalid CCD file path. Set a valid CCD path from gloEMR Admin.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        '        End If
        '    Else
        '        MessageBox.Show("Set the CCD file generation path from gloEMR Admin.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        '    End If

        'Catch ex As gloCCDLibrary.gloCCDException
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        'End Try
    End Sub

    Private Sub mnuViewReceivedFaxes_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuViewReceivedFaxes.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim _FaxCategory As String = ""
            Dim _ReceivePath As String = ""

            Dim oDb As New gloStream.gloDataBase.gloDataBase

            oDb.Connect(GetConnectionString)
            Dim strSelectQry As String = "Select sSettingsValue from Settings Where sSettingsName = '" & "OMR Category - Fax" & "' "
            _FaxCategory = oDb.ExecuteQueryScaler(strSelectQry)

            Dim strSelectRevcQry = "Select sSettingsValue from Settings Where sSettingsName = '" & "Fax Receive Path For DMS" & "'"
            _ReceivePath = oDb.ExecuteQueryScaler(strSelectRevcQry)
            oDb.Disconnect()
            oDb.Dispose()
            oDb = Nothing


            'Commented BY Rahul Patel on 26-10-2010
            'gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), gDMSV2TempPath, Convert.ToInt64(gnLoginID), gClinicID, Application.StartupPath)
            'Added by Rahul Patel on 26-10-2010
            'For DMS Hybrid Database change.
            gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV2TempPath, Convert.ToInt64(gnLoginID), gClinicID, System.Windows.Forms.Application.StartupPath)
            'End of code added by Rahul Patel on 26-10-2010

            'sarika internet fax
            gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory = gstrFAXOutputDirectory

            '' CR00000126 : FAX for Terminal Server
            '' New setting added for ReceivedFaxFolder useful only for Terminal Server 
            gloEDocumentV3.gloEDocV3Admin.gstrFaxReceivedDirectoryTS = gstrFAXReceivedDirectoryTS

            gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = gblnInternetFax
            gloEDocumentV3.gloEDocV3Admin.gblnAddFaxCoverpage = gblnFAXCoverPage
            'sarika internet fax
            If IsNothing(oEDocumentV3) Then
                oEDocumentV3 = New gloEDocumentV3.gloEDocV3Management
            End If

            '' CR00000126 : FAX for Terminal Server
            '' Override the Received path setting in case of Terminal Servers
            If (gloSettings.gloRegistrySetting.IsServerOS) Then
                _ReceivePath = gstrFAXReceivedDirectoryTS
            End If

            oEDocumentV3.ShowEReceivedFax(_ReceivePath, _FaxCategory, Me, gloEDocumentV3.Enumeration.enum_OpenExternalSource.None)
            oEDocumentV3.Dispose()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub oEDocumentV3_EvnRefreshDocuments() Handles oEDocumentV3.EvnRefreshDocuments
        '''' Add code here after Recived Fax form close.......................
        '' If View Docs is open in Patient Details then only Refresh the grid
        If SelectedPatientDetail = PatientDetails.ViewDocs Then
            Fill_PatientScanedDocuments(gnPatientID, False)
        End If
        ShowTasks()
    End Sub

    Private Sub oEDocumentV3_EvnActivateReciveFax(ByVal PatientID As Int64) Handles oEDocumentV3.EvnActivateReciveFax
        SetGnPatientID = PatientID
    End Sub

    Private Sub mnuView_PatientConfidential_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_PatientConfidential.Click
        Try
            If gnPatientID > 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If _nConfidentialStatus = 3 Then
                    Exit Sub
                End If
                Dim oFrmViewPatientConfidential As New frmViewPatientConfidential_New(_nConfidentialID, gnPatientID)


                oFrmViewPatientConfidential.MdiParent = Me
                oFrmViewPatientConfidential.WindowState = FormWindowState.Maximized
                oFrmViewPatientConfidential.Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    'access the below function on Confidential form
    Public Sub GetPatientConfidentialInfo()
        '' Patient Confidential Information
        Dim oPatientConfidentilaInfo As New clsPatientConfidentialInfoDBLayer(gnPatientID)
        Dim strStatus As String = ""
        _nConfidentialID = 0
        _nConfidentialStatus = 0
        Dim _nVisitID As Int64 = GetVisitID(Now.Date, gnPatientID)
        strStatus = oPatientConfidentilaInfo.GetPatientConfidentailInfoStatus(_nVisitID)
        Dim strConfidentailStatus() As String
        strConfidentailStatus = Split(strStatus, ",")
        If (strConfidentailStatus.Length > 0) Then
            _nConfidentialID = strConfidentailStatus.GetValue(0)
            If (strConfidentailStatus.Length > 1) Then
                _nConfidentialStatus = strConfidentailStatus.GetValue(1)
            End If

        End If
        '' To Show the Confidential Information Icon
        picConfidentialInfo.Visible = False
        pnlReconciliationAlert.Visible = False
        If _nConfidentialID <> 0 AndAlso _nConfidentialStatus <> 3 Then
            picConfidentialInfo.Visible = True
        End If
        ShowReconciliationAlert()
        ShowPendingAmedmentsAlert(gnPatientID)
        pnlPatientSavings.Visible = False
        If gblnIsPatientSavingEnabled AndAlso gblnIsPatientSavingRights Then
            ShowPatientSavingAlert(gnPatientID)
        End If
        If Not IsNothing(oPatientConfidentilaInfo) Then  ''slr free oPatientConfidentilaInfo
            oPatientConfidentilaInfo = Nothing
        End If
    End Sub

    Private Sub picConfidentialInfo_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles picConfidentialInfo.Click
        Try
            'mnuView_PatientConfidential_Click(sender, e)

            If IsAccess(False) = False Then
                Exit Sub
            End If
            If _nConfidentialStatus = 3 Then
                Exit Sub
            End If
            Dim _nVisitID As Int64 = GetVisitID(Now.Date, gnPatientID)
            Dim oFrmPatientConfidentialInfo As New frmPatientConfidentialInfo(_nConfidentialID, _nVisitID, gnPatientID)
            oFrmPatientConfidentialInfo.ShowDialog(IIf(IsNothing(oFrmPatientConfidentialInfo.Parent), Me, oFrmPatientConfidentialInfo.Parent))
            ''slr free oFrmPatientConfidentialInfo
            If Not IsNothing(oFrmPatientConfidentialInfo) Then
                oFrmPatientConfidentialInfo.Dispose()
                oFrmPatientConfidentialInfo = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#Region "Billing Button Click Events"

    Private Sub tlsMenuItem_Charges_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Try
                Dim ofrmCharges As gloBilling.frmBillingTransaction
                ofrmCharges = gloBilling.frmBillingTransaction.GetInstance(gnPatientID)
                If IsNothing(ofrmCharges) = False Then
                    ShowHideMainMenu(False, False)
                    ofrmCharges.MdiParent = Me
                    ofrmCharges.Show()
                    ofrmCharges.WindowState = FormWindowState.Maximized
                End If
            Catch objErr As Exception
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub tlsMenuItem_Batch_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Try
                Dim oBilling As New gloBilling.gloBilling(GetConnectionString, GetConnectionString)
                oBilling.ShowViewChargesNBatch(gnPatientID, Me)
                oBilling.Dispose()
                ShowHideMainMenu(False, False)
            Catch objErr As Exception
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub tlsMenuItem_Payment_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Try
                'Dim ofrmPayment As gloBilling.frmBillingPayment
                'ofrmPayment = gloBilling.frmBillingPayment.GetInstance(GetConnectionString(), gnPatientID)
                'If IsNothing(ofrmPayment) = False Then
                '    ShowHideMainMenu(False, False)
                '    ofrmPayment.MdiParent = Me
                '    ofrmPayment.Show()
                '    ofrmPayment.WindowState = FormWindowState.Maximized
                'End If
            Catch objErr As Exception
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub tlsMenuItem_Remittance_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'Try
        '    Dim ofrmRemittance As New gloBilling.frmBillingPaymentRemittance(GetConnectionString, gnPatientID, True)
        '    ShowHideMainMenu(False, False)
        '    ofrmRemittance.MdiParent = Me
        '    ofrmRemittance.Show()
        '    ofrmRemittance.WindowState = FormWindowState.Maximized
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'End Try
    End Sub

    Private Sub tlsMenuItem_Balance_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            'Dim ofrmBalance As New gloBilling.frmRpt_PatientBalance(GetConnectionString(), gnPatientID)
            'ShowHideMainMenu(False, False)
            'ofrmBalance.MdiParent = Me
            'ofrmBalance.Show()
            'ofrmBalance.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            'Catch ex As Exception
            '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub tlsMenuItem_Ledger_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'Try
        '    If gblnProviderDisable = True Then
        '        If ShowAssociateProvider(gnPatientID) = False Then
        '            Exit Sub
        '        Else
        '            oPatientListControl.FillPatients()
        '        End If
        '    End If

        '    Dim ofrmLedger As New gloBilling.frmRpt_PatientLedger(gnPatientID)
        '    ShowHideMainMenu(False, False)
        '    ofrmLedger.MdiParent = Me
        '    ofrmLedger.Show()
        '    ofrmLedger.WindowState = FormWindowState.Maximized
        'Catch objErr As Exception
        '    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'End Try
    End Sub

    Private Sub tlsMenuItem_BillingConfiguration_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Dim ofrmBillingConfiguration As New gloBilling.gloBilling(GetConnectionString(), GetConnectionString())
            ShowHideMainMenu(False, False)
            ofrmBillingConfiguration.ShowBillingBookView(Me)
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            'Catch ex As Exception
            '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ''Go Menu Billing Items Click

    Private Sub mnu_BillingCharges_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_BillingCharges.Click
        Try

            If IsAccess(False, gnPatientID) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Try
                Dim ofrmCharges As gloBilling.frmBillingTransaction
                ofrmCharges = gloBilling.frmBillingTransaction.GetInstance(gnPatientID)
                If IsNothing(ofrmCharges) = False Then

                    ofrmCharges.MdiParent = Me
                    ofrmCharges.Show()
                    ShowHideMainMenu(False, False)
                    ofrmCharges.WindowState = FormWindowState.Maximized
                End If
            Catch objErr As Exception
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_BillingBatch_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_BillingBatch.Click

        'Try
        '    If IsAccess(False, gnPatientID) = False Then
        '        Exit Sub
        '    End If

        '    If gblnProviderDisable = True Then
        '        If ShowAssociateProvider(gnPatientID) = False Then
        '            Exit Sub
        '        Else
        '            oPatientListControl.FillPatients()
        '        End If
        '    End If

        '    Try
        '        Dim ofrmBatch As New gloBilling.frmViewBillingTransaction(gnPatientID, GetConnectionString(), GetConnectionString())

        '        ofrmBatch.MdiParent = Me
        '        ofrmBatch.Show()
        '        ShowHideMainMenu(False, False)
        '        ofrmBatch.WindowState = FormWindowState.Maximized
        '    Catch objErr As Exception
        '        MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        '    End Try
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'End Try
    End Sub

    Private Sub mnu_BillingPayment_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_BillingPayment.Click
        Try

            If IsAccess(False, gnPatientID) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Try
                'Dim ofrmPayment As gloBilling.frmBillingPayment
                'ofrmPayment = gloBilling.frmBillingPayment.GetInstance(GetConnectionString(), gnPatientID)
                'If IsNothing(ofrmPayment) = False Then

                '    ofrmPayment.MdiParent = Me
                '    ofrmPayment.Show()
                '    ShowHideMainMenu(False, False)
                '    ofrmPayment.WindowState = FormWindowState.Maximized
                'End If
            Catch objErr As Exception
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_BillingBalance_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_BillingBalance.Click
        Try

            If IsAccess(False, gnPatientID) = False Then
                Exit Sub
            End If
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            'Dim ofrmBalance As New gloBilling.frmRpt_PatientBalance(GetConnectionString(), gnPatientID)

            'ofrmBalance.MdiParent = Me
            'ofrmBalance.Show()
            'ShowHideMainMenu(False, False)
            'ofrmBalance.WindowState = FormWindowState.Maximized
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_BillingLedger_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_BillingLedger.Click
        'Try

        '    If IsAccess(False, gnPatientID) = False Then
        '        Exit Sub
        '    End If

        '    If gblnProviderDisable = True Then
        '        If ShowAssociateProvider(gnPatientID) = False Then
        '            Exit Sub
        '        Else
        '            oPatientListControl.FillPatients()
        '        End If
        '    End If

        '    Dim ofrmLedger As New gloBilling.frmRpt_PatientLedger(gnPatientID)

        '    ofrmLedger.MdiParent = Me
        '    ofrmLedger.Show()
        '    ShowHideMainMenu(False, False)
        '    ofrmLedger.WindowState = FormWindowState.Maximized
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'End Try
    End Sub

    Private Sub mnu_BillingRemittance_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_BillingRemittance.Click

    End Sub

    Private Sub mnu_BillingConfiguration_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_BillingConfiguration.Click
        Try
            If IsAccess(False, gnPatientID) = False Then
                Exit Sub
            End If
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If
            Dim ofrmBillingConfiguration As New gloBilling.gloBilling(GetConnectionString(), GetConnectionString())
            ''added Handler by kanchan on 20120104 for calling gloCommunityViewDataform for ViewBillingConfig Download form.
            ''property added for getting snomed connection string 
            ofrmBillingConfiguration.gstrSMDBDatabaseName = gstrSMDBDatabaseName
            ofrmBillingConfiguration.gstrSMDBServerName = gstrSMDBServerName
            ofrmBillingConfiguration.gstrSMDBUserID = gstrSMDBUserID
            ofrmBillingConfiguration.gstrSMDBPassWord = gstrSMDBPassWord
            ofrmBillingConfiguration.gblnSMDBAuthen = gblnSMDBAuthen
            AddHandler ofrmBillingConfiguration.EvntBillingHandler, AddressOf ViewBillingConfig
            ofrmBillingConfiguration.ShowBillingBookView(Me)
            ShowHideMainMenu(False, False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#End Region


    Private Sub GloUC_TransactionHistory1_MouseClick(ByVal OrderID As Long, ByVal RowID As Integer) Handles GloUC_TransactionHistory1.EvntGenerateCDAHandler
        Try
            'cmnuPatientDetails.Items.Clear()
            'GloUC_TransactionHistory1.ContextMenuStrip = Nothing
            'If RowID > 0 Then
            '    Dim cmnuOrderDetails As ContextMenuStrip = New ContextMenuStrip

            '    Dim oOrderMenuItem As ToolStripMenuItem = New ToolStripMenuItem
            '    oOrderMenuItem.Text = "Generate CDA"
            '    oOrderMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
            '    oOrderMenuItem.Image = imgList_Common.Images(34)
            '    cmnuOrderDetails.Items.Add(oOrderMenuItem)
     
            _CDAOrderID = OrderID
            _CDAOrderDetails = GloUC_TransactionHistory1.GetOrderDetails(_CDAOrderID)
            openCDA(_CDAOrderID, _CDAOrderDetails)
            'AddHandler oOrderMenuItem.Click, AddressOf oOrderItemGenCDAClick
            'GloUC_TransactionHistory1.ContextMenuStrip = cmnuOrderDetails

            'End If
        Catch ex As Exception

        End Try
    End Sub

    Private Sub GloUC_TransactionHistory1_On_Flex_DoubleClick(ByVal PatientID As Long, ByVal OrderID As Long, ByVal VisitID As Long, ByVal TransactionDate As Date) Handles GloUC_TransactionHistory1.On_Flex_DoubleClick
        Try
            

            If (PatientID > 0 AndAlso OrderID > 0) Then



                'code added by dipak on 20090827 to set blnRecordLock = True  to the user doesnot have rights objUserRights.PatientVitals

                If gblnProviderDisable = True Then  ''added for bugid 74932 to solve providerid 0 problem
                    If ShowAssociateProvider(gnPatientID, Me) = False Then
                        Exit Sub
                    Else
                        oPatientListControl.FillPatients()
                    End If
                End If
                Dim blnRecordLock As Boolean = False
                If (objUserRights.OrdersAndResults = False) Then
                    blnRecordLock = True

                End If

                'for viewing gloLab

                Dim frm_g As New gloEmdeonInterface.Forms.frmViewgloLab(OrderID, PatientID)
                'Code added for Already lab order Is open

                If (frm_g.CheckInstance() = True) Then
                    MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    frm_g.Close()
                    If (IsNothing(frm_g) = False) Then
                        frm_g.Dispose()
                        frm_g = Nothing
                    End If
                    Exit Sub
                End If

                'Developer:Sanjog(Dhamke)
                'Date: 2 Feb 2012
                'PRD Name: Lab Usability Changes
                'Reason: If order is open for modification that time its need to direct on orders tab not on result set tab
                frm_g.SelectOrderTab = True
                'End -Sanjog
                'Code Start-Added by kanchan on 20101109 for bug : 5454
                AddHandler frm_g.EvntGenerateCCDHandler, AddressOf openCCD
                'Code End-Added by kanchan on 20101109 for bug : 5454
                'Developer:Sanjog Dhamke
                'Date: 21 Dec 2011
                'PRD Name: Lab Usability (6060)
                'Reason: To Open the Patient Letter & Referral Letter
                AddHandler frm_g.EntOpenMessage, AddressOf OpenMessage
                AddHandler frm_g.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                AddHandler frm_g.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                AddHandler frm_g.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                AddHandler frm_g.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                AddHandler frm_g.EventCDA, AddressOf mdlGeneral.OpenCDA

                AddHandler frm_g.Activated, AddressOf frmViewgloLab_Activated
                AddHandler frm_g.EvntGenerateCDAHandler, AddressOf openCDA
                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                AddHandler frm_g.EntOpenEducation, AddressOf OpenEducation
                AddHandler frm_g.FormClosed, AddressOf ofrmViewgloLab_openEducationFormClosed
                'AddHandler frm_g.Deactivate, AddressOf frmViewgloLab_Deactivate
                frm_g.objgloLabPatientExam = New clsPatientExams

                frm_g.objgloLabPatientMessages = New clsMessage
                frm_g.objgloLabPatientLetters = New clsPatientLetters
                frm_g.objgloLabNurseNotes = New clsNurseNotes
                frm_g.objgloLabHistory = New clsPatientHistory
                frm_g.objgloLabLabs = New clsLabs
                frm_g.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                frm_g.objgloLabRxmed = New clsPatientDetails
                frm_g.objgloLabOrders = New clsPatientDetails
                frm_g.objgloLabProblemList = New clsPatientProblemList

                frm_g.objgloLabCriteria = New DocCriteria
                frm_g.objgloLabWord = New clsWordDocument

                frm_g.LoginProviderID = gnLoginProviderID

                With frm_g.LabOrderParameter
                    .IsEditMode = False
                    .OrderID = OrderID
                    .OrderNumberID = 0
                    .OrderNumberPrefix = "ORD"
                    .PatientID = PatientID
                    .VisitID = VisitID
                    .TransactionDate = TransactionDate
                    .CloseAfterSave = True

                End With
                With frm_g
                    .WindowState = FormWindowState.Maximized
                    .MdiParent = Me

                    .SecureMsgEnable = gblnIsSecureMsgEnable
                    .SecureMsgUserright = gblnSecureUserrights
                    .DirectAddress = strProviderDirectAddress
                    ''changes added for split control functionality in orders&results
                    Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
                    objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn
                    frm_g.VisitID = gnVisitID
                    frm_g.clsSplit_Laborder = objclsSplit_Laborder

                    .Show()

                    ShowHideMainMenu(False, False)
                    Me.pnlMainToolBar.Visible = False

                End With
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)


        End Try
    End Sub

    Private Sub mnuRpt_PatientReminderLetters_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuRpt_PatientReminderLetters.Click
        Try
            Dim frm As New frmRpt_ReminderPatientLetter(Me)

            '  AddHandler frm.onPrintMenuEventclick, AddressOf PrintMenuEventclick
            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            Try
                '   RemoveHandler frm.onPrintMenuEventclick, AddressOf PrintMenuEventclick
            Catch ex As Exception

            End Try

            ''slr free frm
            If Not IsNothing(frm) Then
                frm.Dispose()
                frm = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    'Public Sub PrintMenuEventclick(Optional ByVal blnAddMenu As Boolean = True, Optional ByVal strFormName As String = "")
    '    If (blnAddMenu = True) Then
    '        Dim oBatchPrintMenu As ToolStripMenuItem = New ToolStripMenuItem

    '        oBatchPrintMenu.Text = "Background Printing"
    '        oBatchPrintMenu.ForeColor = Color.FromArgb(31, 73, 125)
    '        ' Dim fnt As New Font("Tahoma", 8.25)
    '        oBatchPrintMenu.Font = gloGlobal.clsgloFont.gFont_SMALL
    '        oBatchPrintMenu.Tag = ""
    '        oBatchPrintMenu.Image = My.Resources.BackgroundPrinting.ToBitmap()

    '        AddHandler oBatchPrintMenu.Click, AddressOf oBatchPrintMenuClick
    '        Me.mnuFile.DropDownItems.Insert(Me.mnuFile.DropDownItems.Count - 1, oBatchPrintMenu)
    '    Else

    '        For iCount As Integer = Me.mnuFile.DropDownItems.Count - 1 To 0 Step -1
    '            Dim oBatchPrintMenu As ToolStripMenuItem = Me.mnuFile.DropDownItems(iCount)
    '            If (IsNothing(oBatchPrintMenu) = False) Then


    '                If (Not oBatchPrintMenu.Text Is Nothing) Then
    '                    If (oBatchPrintMenu.Text = "Background Printing") Then

    '                        Try
    '                            RemoveHandler oBatchPrintMenu.Click, AddressOf oBatchPrintMenuClick

    '                        Catch ex As Exception

    '                        End Try
    '                        Try
    '                            Me.mnuFile.DropDownItems.Remove(oBatchPrintMenu)

    '                        Catch ex As Exception

    '                        End Try
    '                        Try
    '                            oBatchPrintMenu.Dispose()
    '                            oBatchPrintMenu = Nothing
    '                        Catch ex As Exception

    '                        End Try
    '                        Exit Sub
    '                    End If
    '                End If
    '            End If
    '        Next
    '    End If

    'End Sub
    Private Sub oBatchPrintMenuClick(ByVal obj As Object, ByVal eventArgs As EventArgs)
        Try
            Dim x As Integer
            Dim y As Integer
            Dim r As Rectangle
            For Each oFrm As Form In System.Windows.Forms.Application.OpenForms

                If oFrm.Name = "frmgloPrintWordReminderProgressController" Then
                    oFrm.WindowState = FormWindowState.Normal
                    oFrm.TopMost = True
                    r = Screen.PrimaryScreen.WorkingArea
                    x = r.Width - oFrm.Width
                    y = r.Height - oFrm.Height
                    x = CInt(x / 2)
                    y = CInt(y / 2)
                    oFrm.Location = New Point(x, y)
                    r = Nothing
                    Exit For
                End If
            Next

        Catch ex As Exception
            ex = Nothing

        End Try
    End Sub

    Private Sub mnu_CV_Setup_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnu_CV_Setup.Click
        Try
            Dim oCVsetup As New frmCV_Criteria

            oCVsetup.MdiParent = Me
            oCVsetup.ShowInTaskbar = False
            oCVsetup.WindowState = FormWindowState.Maximized
            oCVsetup.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub mnu_TaxID_Setup_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnu_TaxID_Setup.Click
        Try
            Dim ofrmProviderDefaultTaxIDSetting As New frmProviderDefaultTaxIDSetting  ''frmCV_Criteria

            ofrmProviderDefaultTaxIDSetting.MdiParent = Me
            ofrmProviderDefaultTaxIDSetting.ShowInTaskbar = False
            ofrmProviderDefaultTaxIDSetting.WindowState = FormWindowState.Maximized
            ofrmProviderDefaultTaxIDSetting.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuView_PatientChiefComplaints_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_PatientChiefComplaints.Click
        Try
            If gnPatientID > 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If
                Dim ofrm As New frmViewChiefComplaints(gnPatientID)

                ofrm.MdiParent = Me
                ofrm.ShowInTaskbar = False
                ofrm.WindowState = FormWindowState.Maximized
                ofrm.Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#Region "CheckIn/Checkout"

    Private Sub cmnuPatientItem_CheckIn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) 'Handles cmnuPatientItem_CheckIn.Click
        Try
            If Convert.ToString(DirectCast(sender, ToolStripItem).Tag) <> "" Then
                Dim IDs As String() = Convert.ToString(DirectCast(sender, ToolStripItem).Tag).Split(","c)
                Dim MasterAppointmentID As Int64 = Convert.ToInt64(IDs(0))
                Dim DetailAppointmentID As Int64 = If(IDs.Length > 1, Convert.ToInt64(IDs(1)), 0)

                Dim ofrmCheckIn As New gloPMGeneral.frmCheckIn(gnPatientID, MasterAppointmentID, DetailAppointmentID, GetConnectionString())

                ''Bug #4427: check in template patient information sheet not filling out history items once history is checked ''SalesForce #GLO2010-0010515
                ofrmCheckIn.VisitID = gnVisitID

                If ofrmCheckIn.ShowDialog(IIf(IsNothing(ofrmCheckIn.Parent), Me, ofrmCheckIn.Parent)) = Windows.Forms.DialogResult.OK Then
                    GenerateVisitID(Now.Date, gnPatientID)
                End If
                ofrmCheckIn.Dispose()
                ShowPatientStatus()
                ShowCheckInStatus()
                If (SelectedPatientDetail = PatientDetails.PatientAppointments) Then
                    Call Fill_Appointments()
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.[Error])
        End Try

    End Sub

    Private Sub cmnuPatientItem_CheckOut_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) 'Handles cmnuPatientItem_CheckOut.Click
        Try
            If Convert.ToString(DirectCast(sender, ToolStripItem).Tag) <> "" Then
                Dim IDs As String() = Convert.ToString(DirectCast(sender, ToolStripItem).Tag).Split(","c)
                Dim MasterAppointmentID As Int64 = Convert.ToInt64(IDs(0))
                Dim DetailAppointmentID As Int64 = If(IDs.Length > 1, Convert.ToInt64(IDs(1)), 0)
                Dim dtStartDate As DateTime = gloDateMaster.gloDate.DateAsDateString(Convert.ToInt64(IDs(2)))

                Dim oPatientStatus As New gloPMGeneral.PatientStatus(GetConnectionString())

                oPatientStatus.PatientID = gnPatientID
                oPatientStatus.patientStatusDate = DateTime.Now
                oPatientStatus.TimeIn = ""
                oPatientStatus.TimeOut = DateTime.Now.ToLocalTime().ToShortTimeString()
                oPatientStatus.Location = ""
                oPatientStatus.Status = ""
                oPatientStatus.TrackingStatus = 4 ' 0=None ,3=CheckIn, 4=CheckOut 
                oPatientStatus.StartAppointmentDate = dtStartDate

                oPatientStatus.MasterAppointmentID = MasterAppointmentID
                oPatientStatus.DetailAppointmentID = DetailAppointmentID
                DisplayGlobalPeriodMessage(gnPatientID)
                oPatientStatus.PatientCheckOut()
                If Not IsNothing(oPatientStatus) Then  ''Slr free oPatientStatus
                    oPatientStatus.Dispose()
                    oPatientStatus = Nothing
                End If
            End If
            ShowPatientStatus()
            ShowCheckInStatus()
            If IsNothing(pnlNavigator.SelectedPanel) = False Then
                If pnlNavigator.SelectedPanel.Text.ToUpper.Contains(NAV_APPOINTMENT) Then
                    LoadLeftNavigationPanel()

                End If
            End If

            '' Refresh the patient details panel 
            If (SelectedPatientDetail = PatientDetails.PatientAppointments) Then
                Call Fill_Appointments()
            End If

        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
        End Try

    End Sub

    Private Sub FillCheckInCheckOutMenu(Optional ByVal AppointmentID As Int64 = 0)

        If IsAccess(True) = False Then
            Exit Sub
        End If

        '27-Jul-16 Aniket: Resolving Incident 64287 8071 - CHECK-IN TEMPLATES MISSING FROM APPOINTMENT LIST MENU
        'FillMenus()
        Dim odtAppointment As DataTable ''Slr new not needed 
        Dim odtTracking As New DataTable()

        Try
            'cmnuPatientItem_CheckIn.Visible = False
            'cmnuPatientItem_CheckOut.Visible = False

            If IsNothing(cMnuPatient) = False Then
                For i As Integer = cMnuPatient.Items.Count - 1 To 0 Step -1
                    Dim oToolStripItemCheckOut As ToolStripItem = cMnuPatient.Items(i)
                    If Convert.ToString(oToolStripItemCheckOut.Name) = "Check In" OrElse Convert.ToString(oToolStripItemCheckOut.Name) = "Check Out" Then

                        Try
                            RemoveHandler oToolStripItemCheckOut.Click, AddressOf cmnuPatientItem_CheckOut_Click
                        Catch ex As Exception

                        End Try
                        cMnuPatient.Items.RemoveAt(i)
                        Try
                            oToolStripItemCheckOut.Dispose()
                            oToolStripItemCheckOut = Nothing
                        Catch ex As Exception

                        End Try
                    End If
                Next
            End If
           

            'Removed querry and added SP by Amit 23/04/2012

            odtAppointment = GetAppointmentCheckOutLines(gnPatientID, AppointmentID)

            If IsNothing(cMnuPatient) = False Then
                If odtAppointment IsNot Nothing AndAlso odtAppointment.Rows.Count > 0 Then
                    For i As Integer = 0 To odtAppointment.Rows.Count - 1
                        Dim oToolStripItemCheckOut As ToolStripItem = New ToolStripMenuItem()
                        oToolStripItemCheckOut.Text = ("Check Out : (" & gloDateMaster.gloTime.TimeAsDateTime(DateTime.Now, Convert.ToInt32(odtAppointment.Rows(i)("dtStartTime"))).ToShortTimeString() & " ") + Convert.ToString(odtAppointment.Rows(i)("sAppointmentType")) & ")"
                        oToolStripItemCheckOut.Name = "Check Out"
                        oToolStripItemCheckOut.Image = imgList_Common.Images(29)
                        oToolStripItemCheckOut.Tag = (Convert.ToString(odtAppointment.Rows(i)("nMSTAppointmentID")) & ",") & Convert.ToString(odtAppointment.Rows(i)("nDTLAppointmentID")) & "," & Convert.ToString(odtAppointment.Rows(i)("dtStartDate"))
                        AddHandler oToolStripItemCheckOut.Click, AddressOf cmnuPatientItem_CheckOut_Click
                        cMnuPatient.Items.Add(oToolStripItemCheckOut)
                    Next
                End If
            End If
           

            ''  odtAppointment = New DataTable()  ''slr new not needed 
            If Not IsNothing(odtAppointment) Then ''slr free odtAppointment 
                odtAppointment.Dispose()
                odtAppointment = Nothing
            End If
            odtAppointment = GetAppointmentCheckInLines(gnPatientID, AppointmentID)

            If IsNothing(cMnuPatient) = False Then
                If odtAppointment IsNot Nothing AndAlso odtAppointment.Rows.Count > 0 Then
                    For i As Integer = 0 To odtAppointment.Rows.Count - 1
                        Dim oToolStripItemCheckIn As ToolStripItem = New ToolStripMenuItem()
                        oToolStripItemCheckIn.Text = ("Check In : (" & gloDateMaster.gloTime.TimeAsDateTime(DateTime.Now, Convert.ToInt32(odtAppointment.Rows(i)("dtStartTime"))).ToShortTimeString() & " ") + Convert.ToString(odtAppointment.Rows(i)("sAppointmentType")) & ")"
                        oToolStripItemCheckIn.Name = "Check In"
                        oToolStripItemCheckIn.Image = imgList_Common.Images(28)
                        oToolStripItemCheckIn.Tag = (Convert.ToString(odtAppointment.Rows(i)("nMSTAppointmentID")) & ",") + Convert.ToString(odtAppointment.Rows(i)("nDTLAppointmentID"))
                        AddHandler oToolStripItemCheckIn.Click, AddressOf cmnuPatientItem_CheckIn_Click
                        cMnuPatient.Items.Add(oToolStripItemCheckIn)
                    Next
                End If
            End If
            
            If Not IsNothing(odtAppointment) Then ''slr free dt 
                odtAppointment.Dispose()
                odtAppointment = Nothing
            End If

        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.[Error])
        End Try

    End Sub

    Private Function GetAppointmentCheckOutLines(ByVal PatientID As Long, ByVal AppointmentID As Long) As DataTable
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParam As gloDatabaseLayer.DBParameters
        Dim dtAppointment As New DataTable()

        Try
            oDB.Connect(False)
            oParam = New gloDatabaseLayer.DBParameters
            oParam.Add("@PatientID", PatientID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@MSTAppointmentID", AppointmentID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@ClinicID", gnClinicID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@fromDate", gloDateMaster.gloDate.DateAsNumber(DateTime.Now.Date.ToShortDateString()), ParameterDirection.Input, SqlDbType.Text)
            oParam.Add("@ToDate", gloDateMaster.gloDate.DateAsNumber(DateTime.Now.Date.ToShortDateString()), ParameterDirection.Input, SqlDbType.Text)
            oDB.Retrive("GetAppointmentCheckOutLines", oParam, dtAppointment)

            oParam.Dispose()
            oParam = Nothing

            oDB.Disconnect()
            oDB.Dispose() ''Slr dispose oDB 
            oDB = Nothing

            Return dtAppointment

        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.[Error])
            Return Nothing
        Finally
            'If Not IsNothing(dtAppointment) Then  ''slr should not dispose here
            '    dtAppointment.Dispose()
            '    dtAppointment = Nothing
            'End If
        End Try

    End Function

    Private Function GetAppointmentCheckInLines(ByVal PatientID As Long, ByVal AppointmentID As Long) As DataTable
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParam As gloDatabaseLayer.DBParameters
        Dim dt As New DataTable()

        Try
            oDB.Connect(False)
            oParam = New gloDatabaseLayer.DBParameters
            oParam.Add("@PatientID", PatientID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@MSTAppointmentID", AppointmentID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@ClinicID", gnClinicID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@fromDate", gloDateMaster.gloDate.DateAsNumber(DateTime.Now.Date.ToShortDateString()), ParameterDirection.Input, SqlDbType.Text)
            oParam.Add("@ToDate", gloDateMaster.gloDate.DateAsNumber(DateTime.Now.Date.ToShortDateString()), ParameterDirection.Input, SqlDbType.Text)
            oDB.Retrive("GetAppointmentCheckInLines", oParam, dt)

            oParam.Dispose()
            oParam = Nothing

            oDB.Disconnect()
            If Not IsNothing(oDB) Then
                oDB.Dispose() ''slr dispose oDB 
            End If
            oDB = Nothing

            Return dt

        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.[Error])
            Return Nothing
        Finally
            'If Not IsNothing(dt) Then   ''slr dont dispose dt here
            '    dt.Dispose()
            '    dt = Nothing
            'End If
        End Try

    End Function

    Private Sub ShowPatientStatus()
        If IsAccess(True) = False Then
            '30-Apr-13 Aniket: Resolving issue Bug #50016 
            pnlPatientStatusGrid.Visible = False
            Exit Sub
        End If
        pnlPatientStatusGrid.Visible = False
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParam As gloDatabaseLayer.DBParameters = Nothing
        Dim dtPatientStatus As DataTable = Nothing
        '' Dim dtPatients As DataTable  slr not used
        Dim _strSQL As String = ""

        Const COL_nID As Integer = 0
        Const COL_Status As Integer = 1
        Const COL_Loacation As Integer = 2
        Const COL_appointmentID As Integer = 3
        Const COL_Time As Integer = 4
        Const COL_Count As Integer = 5


        Try
            'c1PatientStatus.Clear()
            c1PatientStatus.DataSource = Nothing
            c1PatientStatus.Rows.Fixed = 1
            c1PatientStatus.Rows.Count = 1
            c1PatientStatus.Cols.Count = COL_Count

            c1PatientStatus.AllowEditing = False

            c1PatientStatus.DrawMode = C1.Win.C1FlexGrid.DrawModeEnum.OwnerDraw
            c1PatientStatus.AllowResizing = C1.Win.C1FlexGrid.AllowResizingEnum.Both
            c1PatientStatus.Styles.Normal.WordWrap = True
            c1PatientStatus.Styles.Normal.ImageAlign = C1.Win.C1FlexGrid.ImageAlignEnum.Stretch


            c1PatientStatus.SetData(0, COL_nID, "nId")
            c1PatientStatus.SetData(0, COL_Loacation, "Location")
            c1PatientStatus.SetData(0, COL_appointmentID, "Master AppointmentID")
            c1PatientStatus.SetData(0, COL_Time, "Time")
            c1PatientStatus.SetData(0, COL_Status, "Patient Status")

            c1PatientStatus.Cols(COL_nID).Visible = False
            c1PatientStatus.Cols(COL_Loacation).Visible = False
            c1PatientStatus.Cols(COL_appointmentID).Visible = False
            c1PatientStatus.Cols(COL_Time).Visible = False
            c1PatientStatus.Cols(COL_Status).Visible = True

            Dim _cWidth As Integer = 250

            c1PatientStatus.Cols(COL_nID).Width = 0
            c1PatientStatus.Cols(COL_Loacation).Width = 0
            c1PatientStatus.Cols(COL_appointmentID).Width = 0
            c1PatientStatus.Cols(COL_Time).Width = 0
            c1PatientStatus.Cols(COL_Status).Width = _cWidth


            c1PatientStatus.Rows(0).Visible = False

            Dim csNormal As C1.Win.C1FlexGrid.CellStyle '= c1PatientStatus.Styles.Add("csNormal")
            Try
                If (c1PatientStatus.Styles.Contains("csNormal")) Then
                    csNormal = c1PatientStatus.Styles("csNormal")
                Else
                    csNormal = c1PatientStatus.Styles.Add("csNormal")
                    csNormal.ForeColor = Color.FromArgb(31, 73, 125)
                    csNormal.Font = gloGlobal.clsgloFont.gFont_SMALL 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CByte((0)))
                    csNormal.WordWrap = True
                End If
            Catch ex As Exception
                csNormal = c1PatientStatus.Styles.Add("csNormal")
                csNormal.ForeColor = Color.FromArgb(31, 73, 125)
                csNormal.Font = gloGlobal.clsgloFont.gFont_SMALL 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CByte((0)))
                csNormal.WordWrap = True
            End Try


            c1PatientStatus.BorderStyle = C1.Win.C1FlexGrid.Util.BaseControls.BorderStyleEnum.None

            oDB.Connect(False)
            oParam = New gloDatabaseLayer.DBParameters
            oParam.Add("@nPatientID", gnPatientID, ParameterDirection.Input, SqlDbType.BigInt)
            oParam.Add("@ClinicId", gnClinicID, ParameterDirection.Input, SqlDbType.BigInt)
            oDB.Retrive("gsp_GetAppointmentID", oParam, dtPatientStatus)

            'Dim _Ids As String = ""
            'For I As Int16 = 0 To dtPatientStatus.Rows.Count - 1
            '    If (I = 0) Then
            '        _Ids = Convert.ToString(dtPatientStatus.Rows(I)("nID"))
            '    Else
            '        _Ids += "," & Convert.ToString(dtPatientStatus.Rows(I)("nID"))
            '    End If
            'Next
            ' ''''

            'If (_Ids = "") Then
            '    Exit Sub
            'End If

            '_strSQL = "SELECT ISNULL(PatientTracking.nID,0) AS nID, ISNULL(PatientTracking.sTimeIn,'') AS sTimeIn, ISNULL(PatientTracking.sLocation,'') AS sLocation,  " _
            '            & " ISNULL(PatientTracking.sStatus,'') AS sStatus, ISNULL(PatientTracking.sTimeOut,'') AS sTimeOut, ISNULL(PatientTracking.nTrackingStatus,0) AS nTrackingStatus,  " _
            '            & " ISNULL(PatientTracking.nDTLAppointmentID,0) AS nDTLAppointmentID  , AS_Appointment_DTL.dtStartTime  as  StartTime ,AS_Appointment_DTL.dtEndTime as EndTime FROM   PatientTracking INNER JOIN " _
            '            & "AS_Appointment_DTL ON PatientTracking.nDTLAppointmentID = AS_Appointment_DTL.nDTLAppointmentID  WHERE nID in (" & _Ids & ") AND AS_Appointment_DTL.nUsedStatus <> 5 AND AS_Appointment_DTL.nUsedStatus <> 6 AND AS_Appointment_DTL.nUsedStatus <> 7 order by StartTime desc"


            'oDB.Connect(False)
            ' ''slr free dtpatientstatus
            'If Not IsNothing(dtPatientStatus) Then
            '    dtPatientStatus.Dispose()
            '    dtPatientStatus = Nothing
            'End If
            'oDB.Retrive_Query(_strSQL, dtPatientStatus)

            If dtPatientStatus IsNot Nothing Then
                For i As Integer = 0 To dtPatientStatus.Rows.Count - 1
                    ' Get Patients Appointment Status 

                    If dtPatientStatus IsNot Nothing AndAlso dtPatientStatus.Rows.Count > 0 Then
                        pnlPatientStatusGrid.Visible = True
                        Dim _appStartTime As String = Convert.ToString(dtPatientStatus.Rows(i)("StartTime"))
                        Dim dtappStartTime As DateTime = gloDateMaster.gloTime.TimeAsDateTime(Now, _appStartTime)
                        _appStartTime = Convert.ToString(dtappStartTime.ToShortTimeString)

                        Dim _appEndTime As String = Convert.ToString(dtPatientStatus.Rows(i)("EndTime"))
                        Dim dtappEndTime As DateTime = gloDateMaster.gloTime.TimeAsDateTime(Now, _appEndTime)
                        _appEndTime = Convert.ToString(dtappEndTime.ToShortTimeString)
                        ''Condition added for selected patient

                        If (dtPatientStatus.Rows(i)("nTrackingStatus").ToString() <> "4") Then '' 
                            'Check In 
                            Dim r As C1.Win.C1FlexGrid.Row
                            r = c1PatientStatus.Rows.Add()

                            c1PatientStatus.SetData(r.Index, COL_nID, dtPatientStatus.Rows(i)("nID").ToString())
                            c1PatientStatus.SetData(r.Index, COL_Loacation, dtPatientStatus.Rows(i)("sLocation").ToString())
                            c1PatientStatus.SetData(r.Index, COL_appointmentID, dtPatientStatus.Rows(i)("nDTLAppointmentID").ToString())
                            c1PatientStatus.SetData(r.Index, COL_Time, dtPatientStatus.Rows(i)("sTimeIn").ToString())
                            c1PatientStatus.SetData(r.Index, COL_Status, dtPatientStatus.Rows(i)("sStatus").ToString())

                            Dim _StatusString As String = ""
                            _StatusString = (" Appointment Time  : " & _appStartTime & " - " & _appEndTime & "") + Environment.NewLine & _
    ((" Location : " & Convert.ToString(dtPatientStatus.Rows(i)("sLocation")) & "") + Environment.NewLine & "" & "  Time In : ") + Convert.ToString(dtPatientStatus.Rows(i)("sTimeIn")) & ""

                            If (Convert.ToString(dtPatientStatus.Rows(i)("sStatus")) = "") Then

                                _StatusString += Environment.NewLine & "   Status : Check In "

                            Else

                                _StatusString += Environment.NewLine & "    Status : " & Convert.ToString(dtPatientStatus.Rows(i)("sStatus")) & ""

                            End If

                            c1PatientStatus.SetData(r.Index, COL_Status, _StatusString)
                            c1PatientStatus.SetCellStyle(r.Index, COL_Status, csNormal)
                            c1PatientStatus.Rows(r.Index).Height = 65

                            r = c1PatientStatus.Rows.Add()
                            c1PatientStatus.Rows(r.Index).Height = 1
                        ElseIf dtPatientStatus.Rows(i)("nTrackingStatus").ToString() = "4" Then

                            Dim r As C1.Win.C1FlexGrid.Row
                            r = c1PatientStatus.Rows.Add()

                            c1PatientStatus.SetData(r.Index, COL_nID, dtPatientStatus.Rows(i)("nID").ToString())
                            c1PatientStatus.SetData(r.Index, COL_Loacation, dtPatientStatus.Rows(i)("sLocation").ToString())
                            c1PatientStatus.SetData(r.Index, COL_appointmentID, dtPatientStatus.Rows(i)("nDTLAppointmentID").ToString())
                            c1PatientStatus.SetData(r.Index, COL_Time, dtPatientStatus.Rows(i)("sTimeOut").ToString())
                            c1PatientStatus.SetData(r.Index, COL_Status, dtPatientStatus.Rows(i)("sTimeIn").ToString())

                            Dim _StatusString As String = ""

                            _StatusString = (" Appointment Time  : " & _appStartTime & " - " & _appEndTime & "") + Environment.NewLine & ("   Time Out : ") + Convert.ToString(dtPatientStatus.Rows(i)("sTimeOut")) & ""

                            _StatusString += Environment.NewLine & "       Status : Check Out "

                            c1PatientStatus.SetData(r.Index, COL_Status, _StatusString)
                            c1PatientStatus.SetCellStyle(r.Index, COL_Status, csNormal)
                            c1PatientStatus.Rows(r.Index).Height = 65

                            r = c1PatientStatus.Rows.Add()
                            c1PatientStatus.Rows(r.Index).Height = 1
                        End If
                    End If
                Next
            End If

        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString, _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Return
        Finally
            If Not IsNothing(dtPatientStatus) Then  ''slr free dtpatientstatus
                dtPatientStatus.Dispose()
                dtPatientStatus = Nothing
            End If
            If oDB IsNot Nothing Then
                oDB.Disconnect()
                oDB.Dispose()
            End If
            If oParam IsNot Nothing Then
                oParam.Dispose()
                oParam = Nothing
            End If

        End Try
    End Sub

    Private Sub c1PatientStatus_DoubleClick(ByVal sender As Object, ByVal e As System.EventArgs) Handles c1PatientStatus.DoubleClick
        'Added If Condition by Pranit on 8 feb 2012 
        If (c1PatientStatus.RowSel >= 0) Then
            If (Convert.ToString(c1PatientStatus.GetData(c1PatientStatus.RowSel, 1)).Contains(" Status : Check Out ") = True) Then
                Exit Sub
            End If
            Dim nAppointmentID As Int64 = 0
            nAppointmentID = Convert.ToInt64(c1PatientStatus.GetData(c1PatientStatus.RowSel, 3)) ''appointmentID
            Dim frm As New frmLocationStatus(nAppointmentID, gnPatientID)
            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            frm.Dispose()
            ShowPatientStatus()
            ShowTasks()
            If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
                Call ShowDefaultPatientDetails(False)
            End If
        End If
    End Sub

    Private Sub c1PatientStatus_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles c1PatientStatus.MouseDown
        If e.Button = MouseButtons.Right Then
            'Try

            '    ''slr dispose dispose omenu item before clear
            '    While CmnuPatientstatus.Items.Count <> 0
            '        Dim Item As ToolStripMenuItem = CmnuPatientstatus.Items(0)
            '        If Not IsNothing(Item) Then
            '            While Item.DropDownItems.Count <> 0
            '                Dim childitem As ToolStripDropDownItem = Item.DropDownItems(0)
            '                If Not IsNothing(childitem) Then
            '                    childitem.Dispose()
            '                    childitem = Nothing
            '                End If
            '            End While
            '            Item.Dispose()
            '            Item = Nothing
            '        End If

            '    End While
            'Catch ex As Exception

            'End Try
            'CmnuPatientstatus.Items.Clear()
            ClearContextMenuStrip(c1PatientStatus.ContextMenuStrip)
            ClearContextMenuStrip(CmnuPatientstatus)

            Dim _nRow As Integer = c1PatientStatus.HitTest(e.X, e.Y).Row
            If _nRow >= 0 Then
                c1PatientStatus.RowSel = _nRow
            Else
                Exit Sub
            End If

            Dim oMenuItem As ToolStripMenuItem
            'Try
            '    If (IsNothing(c1PatientStatus.ContextMenuStrip) = False) Then
            '        c1PatientStatus.ContextMenuStrip.Dispose()
            '        c1PatientStatus.ContextMenuStrip = Nothing
            '    End If
            'Catch ex As Exception

            'End Try

            'c1PatientStatus.ContextMenuStrip = CmnuPatientstatus
            AssignContextMenuStrip(c1PatientStatus.ContextMenuStrip, CmnuPatientstatus)

            Dim nRow As Integer
            nRow = _nRow
            oMenuItem = New ToolStripMenuItem
            oMenuItem.Text = "Patient Status History"
            oMenuItem.Tag = "Patient Status History"
            oMenuItem.ForeColor = Color.FromArgb(31, 73, 125)
            oMenuItem.Image = Imgts_PatientDetails.Images(33)
            CmnuPatientstatus.Items.Add(oMenuItem)
            AddHandler oMenuItem.Click, AddressOf ShowPatientHistory
        End If
    End Sub

    Private Sub ShowPatientHistory(ByVal sender As Object, ByVal e As EventArgs)
        Dim nAppointmentID As Int64 = 0
        nAppointmentID = Convert.ToInt64(c1PatientStatus.GetData(c1PatientStatus.RowSel, 3)) ''appointmentID
        Dim frm As New frmPatientStatusHistory(nAppointmentID)
        frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
        frm.Dispose()
    End Sub
#End Region

#Region "Pull Charts"

    Enum enmPullChartsCriteria
        Today
        Tomorrow
        Customize
    End Enum

    Private Sub Fill_PullCharts(ByVal enmCriteria As enmPullChartsCriteria)

        'To Check Restricted Appointment
        CheckrestrictedSettings()

        If (_RegAppUsingTemplateOnly = True) Then
            MessageBox.Show("New appointments can only be set during established template times. This setting can be changed. Please contact your administrator for more information.  ", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Return
        End If
        'End To Check Restricted Appointment




        Select Case enmCriteria
            Case enmPullChartsCriteria.Today

                Dim frmCustomize As New frmCustomizePullCharts(gnPatientID)
                frmCustomize.TypeofAppointment = "Today"
                frmCustomize.lblDoctorName.Text = gstrPatientProviderName
                frmCustomize.ProviderID = gnPatientProviderID
                frmCustomize.lblPatientCode.Text = gstrPatientCode
                frmCustomize.lblPatientName.Text = gstrPatientFirstName & "  " & gstrPatientLastName
                frmCustomize.ShowDialog(IIf(IsNothing(frmCustomize.Parent), Me, frmCustomize.Parent))
                ''  'SLR: Dispose frmCustomzie
                If Not IsNothing(frmCustomize) Then
                    frmCustomize.Dispose()
                    frmCustomize = Nothing
                End If
            Case enmPullChartsCriteria.Tomorrow


                Dim frmCustomize As New frmCustomizePullCharts(gnPatientID)
                frmCustomize.TypeofAppointment = "Tomorrow"
                frmCustomize.lblDoctorName.Text = gstrPatientProviderName
                frmCustomize.ProviderID = gnPatientProviderID
                frmCustomize.lblPatientCode.Text = gstrPatientCode
                frmCustomize.lblPatientName.Text = gstrPatientFirstName & " " & gstrPatientLastName
                frmCustomize.ShowDialog(frmCustomize.Parent)
                ''  'SLR: Dispose frmCustomzie
                If Not IsNothing(frmCustomize) Then
                    frmCustomize.Dispose()
                    frmCustomize = Nothing
                End If
            Case enmPullChartsCriteria.Customize

                Dim frmCustomize As New frmCustomizePullCharts(gnPatientID)
                frmCustomize.TypeofAppointment = "Customise"
                frmCustomize.lblDoctorName.Text = gstrPatientProviderName
                frmCustomize.ProviderID = gnPatientProviderID
                frmCustomize.lblPatientCode.Text = gstrPatientCode
                frmCustomize.lblPatientName.Text = gstrPatientFirstName & " " & gstrPatientLastName
                frmCustomize.ShowDialog(IIf(IsNothing(frmCustomize.Parent), Me, frmCustomize.Parent))
                ''  'SLR: Dispose frmCustomzie
                If Not IsNothing(frmCustomize) Then
                    frmCustomize.Dispose()
                    frmCustomize = Nothing
                End If
        End Select
        If IsNothing(pnlNavigator.SelectedPanel) = False Then
            ShowAppointments()
        End If
        If (SelectedPatientDetail = PatientDetails.PatientAppointments) Then
            Call Fill_Appointments()
        End If
        ''Added by Mayuri:20100617-To fix case No:0003868
        If (SelectedPatientDetail = PatientDetails.AuditTrail) Then
            Call Fill_AuditTrail()
        End If


    End Sub

#End Region


#Region "Show Graph"

    ''Show graph for labs for selected patient  from patient detail grid
    ''btnShowGraphClick handled 
    <HandleProcessCorruptedStateExceptions()>
    Private Sub GloUC_TransactionHistory_btnShowGraphClick(ByVal sender As Object, ByVal e As System.EventArgs) Handles GloUC_TransactionHistory1.btnShowGraphClick
        'Resolved bug: 41121
        Try

            Dim dt_selectedResult As DataTable ''slr new not needed 
            '''' Get selected Result From Grid
            dt_selectedResult = GloUC_TransactionHistory1.SelectResult()

            '''' If DataTable is empty then exit from Procedure.
            If IsNothing(dt_selectedResult) Then
                Exit Sub
            End If
            If dt_selectedResult.Rows.Count = 0 Then  ''slr is nothing condition added 
                Exit Sub
            End If

            For i As Int16 = 0 To dt_selectedResult.Rows.Count - 1
                If String.IsNullOrEmpty(dt_selectedResult.Rows(i)(0)) = True Then
                    MessageBox.Show("Graph cannot be generated as no Collected Date is present.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                End If
            Next
            'If String.IsNullOrEmpty(dt_selectedResult.Rows(dt_selectedResult.Rows.Count - 1)(0)) = True Then
            '    MessageBox.Show("Graph cannot be generated as no Collected Date is present.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            '    Exit Sub
            'End If
            ''''Get Min and Max Value from DataTable

            Dim dv As DataView
            dv = New DataView(dt_selectedResult)
            dv.Sort = "Value"

            Dim max As Integer = dv.Item(dv.Count - 1)("Value").ToString()
            Dim min As Integer = dv.Item(0)("Value").ToString() '' dv.Table.Rows.Count - 1)("Value")

            Dim dtSelectedResultToDate As DateTime = CType(dt_selectedResult.Rows(dt_selectedResult.Rows.Count - 1)(0), DateTime)

            ' lines for get the first results data and show it into the label as From-date
            Dim dtStartdate As DateTime
            dtStartdate = dt_selectedResult.Rows.Item(0)(0) ' Take from date for Display 
            dtStartdate = Format(dtStartdate, "MM/dd/yyyy")

            ' view the graphs for the provided values as a parameters provided
            Dim oGraphResult As New frmLab_GraphsResult(dtStartdate, dtSelectedResultToDate, 0, 0, gnPatientID, dt_selectedResult.Rows(0)(1), dt_selectedResult.Rows(0)(2), dt_selectedResult, , False, , min, max)
            With oGraphResult
                .MdiParent = Me.MdiParent
                .WindowState = FormWindowState.Maximized
                .ShowInTaskbar = False
                .TopMost = False
                .ShowDialog(IIf(IsNothing(oGraphResult.Parent), Me, oGraphResult.Parent))
            End With
            If Not IsNothing(oGraphResult) Then
                oGraphResult.Dispose()
                oGraphResult = Nothing
            End If
            If Not IsNothing(dv) Then  ''slr free dv
                dv.Dispose()
                dv = Nothing
            End If

            Exit Sub

        Catch ex As Exception
            If ex.Message <> "Attempted to read or write protected memory. This is often an indication that other memory is corrupt." Then
                MessageBox.Show(ex.Message)
            End If
        End Try

    End Sub

#End Region

    ''to show the patient detail information with accordance to the user rights
    Private Sub SelectPatientPanel()

        If (objUserRights.History = True) Then
            SelectedPatientDetail = PatientDetails.History
            Exit Sub
        End If
        If (objUserRights.Insurance = True) Then
            SelectedPatientDetail = PatientDetails.Insurance
            Exit Sub
        End If

        If (objUserRights.Billing = True) Then
            SelectedPatientDetail = PatientDetails.Billing
            Exit Sub
        End If
        If (objUserRights.Medications = True) Then
            SelectedPatientDetail = PatientDetails.Medication
            Exit Sub
        End If
        ''*
        If (objUserRights.Prescriptions = True) Then
            SelectedPatientDetail = PatientDetails.Prescription
            Exit Sub
        End If
        If (objUserRights.PatientProblemList = True) Then
            SelectedPatientDetail = PatientDetails.ProblemList
            Exit Sub
        End If
        If (objUserRights.ViewDocs = True) Then
            SelectedPatientDetail = PatientDetails.ViewDocs
            Exit Sub
        End If
        If (objUserRights.PatientOrders = True) Then
            SelectedPatientDetail = PatientDetails.OrderTemplates
            Exit Sub
        End If
        If (objUserRights.OrdersAndResultsSetup = True) Then
            SelectedPatientDetail = PatientDetails.Order
            Exit Sub
        End If
        If (objUserRights.Messages = True) Then
            SelectedPatientDetail = PatientDetails.Messages
            Exit Sub
        End If
        If (objUserRights.PastExams = True) Then
            SelectedPatientDetail = PatientDetails.PastExams
            Exit Sub
        End If
        If (objUserRights.PatientVitals = True) Then
            SelectedPatientDetail = PatientDetails.Vitals
            Exit Sub
        End If
        If (objUserRights.SentFaxes = True) Then
            SelectedPatientDetail = PatientDetails.FAX_Sent
            Exit Sub
        End If
        If (objUserRights.PendingFaxes = True) Then
            SelectedPatientDetail = PatientDetails.FAX_Pending
            Exit Sub
        End If
        If (objUserRights.AuditTrail = True) Then
            SelectedPatientDetail = PatientDetails.AuditTrail
            Exit Sub
        End If
        If (objUserRights.PatientHealthPlan = True) Then
            SelectedPatientDetail = PatientDetails.HealthPlan
            Exit Sub
        End If
        If (objUserRights.NurseNotes = True) Then
            SelectedPatientDetail = PatientDetails.NurseNotes
            Exit Sub
        End If
        If (objUserRights.OrdersAndResultsSetup = True) Then
            SelectedPatientDetail = PatientDetails.Orders
            Exit Sub
        End If
        If (objUserRights.PatientConcent = True) Then
            SelectedPatientDetail = PatientDetails.PatientConsent
            Exit Sub
        End If
        If (objUserRights.DislocureMgmt = True) Then
            SelectedPatientDetail = PatientDetails.DisclosureManagement
            Exit Sub
        End If
        If (objUserRights.PatientLetters = True) Then
            SelectedPatientDetail = PatientDetails.PatientLetters
            Exit Sub
        End If
    End Sub

    Private Sub tlbbtn_MyDay_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) ' Handles tlbbtn_MyDay.Click 'Comment by sudhir 20090410
        Try
            Dim frm As New frmMyDay()
            frm.MdiParent = Me
            'AddHandler frm.EvntGenerateCDAFromMyDay, AddressOf openCDA
            frm.Show()
            frm.WindowState = FormWindowState.Maximized
            pnlMainToolBar.Visible = False
            ShowHideMainMenu(False, False)
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            ShowHideMainMenu(True, True)
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try
    End Sub

    Private Sub mnuViewCCDFiles_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuViewCCDFiles.Click
        Try

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim ofrm As New frmCCD_ViewFiles



            'Added by kanchan on 20101020 for view Selected patient CCD/CCR files
            ofrm.SelectedPatientID = gnPatientID

            ofrm.MdiParent = Me
            ofrm.ShowInTaskbar = False
            ofrm.WindowState = FormWindowState.Maximized

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

            ofrm.BringToFront()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try
    End Sub

    Private Sub C1AlertMessages_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1AlertMessages.MouseMove
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub

    Private Sub c1PatientStatus_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles c1PatientStatus.MouseMove
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub

    Private Sub C1dgPatientDetails_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1dgPatientDetails.MouseMove
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub

    Private Sub C1Appointments_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1Appointments.MouseMove
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub

    Private Sub C1Mesages_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1Mesages.MouseMove
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub

    Private Sub C1UserTasks_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1UserTasks.MouseMove
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub

    Private Sub C1Triage_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles C1Triage.MouseMove
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub


    Public Sub SendHL7PatientDetails(ByVal patientID As Int64, ByVal blnIsUpdate As Boolean)

        Try

            blnIsInvalidHL7FilePath = False
            If gblnHL7SENDOUTBOUNDGLOEMR = True AndAlso gblnAddModPatient = True Then
                oGeneralInterface = New clsGeneralInterface()
                oGeneralInterface.SendHL7PatientDetails(patientID, blnIsUpdate)
            End If

        Catch ex As Exception
            MessageBox.Show("Unable to generate HL7 ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            UpdateLog(ex.ToString())
        Finally
            If Not IsNothing(oGeneralInterface) Then
                oGeneralInterface.Dispose()
                oGeneralInterface = Nothing
            End If
        End Try
    End Sub

    ''Open patinet later to Update
    Private Sub NewOrUpdateLetters(ByVal IsModify As Boolean)

        Dim LetterID As Long
        Dim TemplateID As Long
        Dim objfrmPatientLetter As frmPatientLetter
        Try
            If IsModify = False Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = True Then
                        oPatientListControl.FillPatients()
                    End If
                End If

                '  dtWord = New DataTable   slr new not needed 
                objWord = New clsWordDocument
                dtWord = objWord.FillTemplates(enumTemplateFlag.PatientLetters)
                objWord = Nothing

                If IsNothing(dtWord) Then  ''slr  if condition
                    ''''If not present then exit from sub
                    MessageBox.Show("No template is associated for patient letter. Associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    objWord = Nothing
                    dtWord = Nothing
                    Exit Sub
                End If

                If dtWord.Rows.Count = 0 Then  ''slr if condition
                    ''''If not present then exit from sub
                    MessageBox.Show("No template is associated for patient letter. Associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    objWord = Nothing
                    If Not IsNothing(dtWord) Then
                        dtWord.Dispose()
                    End If
                    dtWord = Nothing
                    Exit Sub
                Else
                    Try
                        objfrmPatientLetter = New frmPatientLetter(gnPatientID)
                        With objfrmPatientLetter
                            .MdiParent = Me

                            .WindowState = FormWindowState.Maximized
                            .BringToFront()
                            .Show()
                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False

                        End With


                    Catch ex As Exception
                        MessageBox.Show(ex.ToString, "Patient Letters", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        ShowHideMainMenu(True, True)
                        pnlMainToolBar.Visible = True

                    Finally
                        objfrmPatientLetter = Nothing
                    End Try


                End If
            Else ''if letter to be opened to modify

                If C1dgPatientDetails.Rows.Count >= 1 Then


                    LetterID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                    TemplateID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 2), Int64)

                    Dim blnRecordLock As Boolean = False
                    If gblnRecordLocking = True Then
                        Dim mydt As mytable ''slr new not needed 
                        mydt = Scan_n_Lock_Transaction(TrnType.Letters, LetterID, 0, Now)
                        If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                            If MessageBox.Show("This Patient Letter is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                blnRecordLock = True
                            Else
                                If Not IsNothing(mydt) Then ''slr free mydt
                                    mydt.Dispose()
                                End If
                                mydt = Nothing
                                Exit Sub
                            End If
                        End If
                        If Not IsNothing(mydt) Then ''slr free mydt
                            mydt.Dispose()
                        End If
                        mydt = Nothing
                    End If

                    ''IF Letter is displayed as unfinished Letter on the loacal mc  but is finished from 
                    ''other machine then read the finished status of the Letter from database   
                    Dim IsFinished As String = "False"
                    Try
                        Dim oDB As New gloStream.gloDataBase.gloDataBase
                        Dim strSQL As String

                        strSQL = " SELECT  ISNULL(bIsFinished , 'False' ) AS bIsFinished FROM  PatientLetters " _
                                & " WHERE nLetterID = " & LetterID & " AND nPatientID = " & gnPatientID & " " 'AND dtLetterdate =''"
                        oDB.Connect(GetConnectionString)
                        IsFinished = oDB.ExecuteQueryScaler(strSQL)
                        oDB.Disconnect()
                        oDB.Dispose()
                        oDB = Nothing
                    Catch ex As Exception

                    End Try
                    '20090827
                    'code Added by Mayuri
                    ''Record Level Locking

                    If objUserRights.PatientLetters = False Then
                        blnRecordLock = True
                    End If
                    'end code

                    'Commented  by Sandip Darade as now we have read the finished status of the Letter 
                    'from database in above code as string 'IsFinished' 

                    'If CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 4), String) = "Yes" Then
                    If (IsFinished = "True") Then
                        ''if Letter's Sataus is 'Finished' IsFinished=Yes
                        objfrmPatientLetter = New frmPatientLetter(LetterID, TemplateID, True, blnRecordLock, gnPatientID)
                    Else
                        ''if Letter's Sataus is 'NOT Finished' IsFinished=No and Record is not lock 
                        objfrmPatientLetter = New frmPatientLetter(LetterID, TemplateID, False, blnRecordLock, gnPatientID)
                    End If


                    With objfrmPatientLetter
                        .Text = "Modify Patient Letters"
                        .MdiParent = Me
                        .IsModify = True
                        .WindowState = FormWindowState.Maximized
                        .BringToFront()
                        .Show()

                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False


                    End With
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Letters, gloAuditTrail.ActivityCategory.PatientLetters, gloAuditTrail.ActivityType.View, "Patient Letter viewed", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success)

                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, "Patient Letters", MessageBoxButtons.OK, MessageBoxIcon.Information)
            ShowHideMainMenu(True, True)
            pnlMainToolBar.Visible = True

        Finally
            'If Not IsNothing(objfrmPatientLetter) Then
            '    objfrmPatientLetter.Dispose()
            '    objfrmPatientLetter = Nothing
            'End If
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
        End Try
    End Sub

    ''Open patinet consent to Update
    Private Sub NewOrUpdateConsent(ByVal IsModify As Boolean)
        Dim LetterID As Long
        Dim TemplateID As Long
        Dim objfrmPatientConsent As frmPatientConsent
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            If IsModify = False Then

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = True Then
                        oPatientListControl.FillPatients()
                    End If
                End If

                ' dtWord = New DataTable  slr new not needed
                objWord = New clsWordDocument
                dtWord = objWord.FillTemplates(enumTemplateFlag.PatientConsent)

                If IsNothing(dtWord) Then
                    ''''If not present then exit from sub
                    MessageBox.Show("No template is associated for patient consent. Associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    objWord = Nothing
                    dtWord = Nothing
                    Exit Sub
                End If

                If dtWord.Rows.Count = 0 Then
                    ''''If not present then exit from sub
                    MessageBox.Show("No template is associated for patient consent. Associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    objWord = Nothing
                    dtWord = Nothing
                    Exit Sub
                Else
                    Try
                        objfrmPatientConsent = New frmPatientConsent(gnPatientID)
                        With objfrmPatientConsent
                            .MdiParent = Me
                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False
                            .WindowState = FormWindowState.Maximized
                            .BringToFront()
                            .Show()
                        End With


                    Catch ex As Exception
                        MessageBox.Show(ex.ToString, "Patient Consent", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        ShowHideMainMenu(True, True)
                        pnlMainToolBar.Visible = True

                    Finally
                        objfrmPatientConsent = Nothing
                    End Try
                End If
            Else

                If C1dgPatientDetails.Rows.Count >= 1 Then

                    LetterID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                    TemplateID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 2), Int64)

                    Dim blnRecordLock As Boolean = False
                    If gblnRecordLocking = True Then
                        Dim mydt As mytable ''slr new not needed
                        ''GLO2011-0015182 : Nurse Note
                        ''wrong trntype was set to retrive patientconsent
                        mydt = Scan_n_Lock_Transaction(TrnType.PatientConsent, LetterID, 0, Now)
                        If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                            If MessageBox.Show("This Patient Consent is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                blnRecordLock = True
                            Else
                                Exit Sub
                            End If
                        End If
                    End If

                    ''IF Letter is displayed as unfinished Letter on the local mc  but is finished from 
                    ''other machine then read the finished status of the Letter from database   
                    Dim IsFinished As String = "False"
                    Try
                        Dim oDB As New gloStream.gloDataBase.gloDataBase
                        Dim strSQL As String

                        strSQL = " SELECT  ISNULL(bIsFinished , 'False' ) AS bIsFinished FROM  PatientConsent " _
                                & " WHERE nConsentId = " & LetterID & " AND nPatientId = " & gnPatientID & " "
                        oDB.Connect(GetConnectionString)
                        IsFinished = oDB.ExecuteQueryScaler(strSQL)
                        oDB.Disconnect()
                        oDB.Dispose()
                        oDB = Nothing
                    Catch ex As Exception

                    End Try
                    If objUserRights.PatientConcent = False Then
                        blnRecordLock = True
                    End If

                    'Commented  by Sandip Darade as now we have read the finished status of the Letter 
                    'from database in above code as string 'IsFinished' 
                    'If CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 4), String) = "Yes" Then
                    If (IsFinished = "True") Then
                        ''if consent's status is 'Finished' IsFinished=Yes
                        objfrmPatientConsent = New frmPatientConsent(LetterID, TemplateID, True, blnRecordLock, gnPatientID)
                    Else
                        ''if consent's status is 'NOT Finished' IsFinished=No and Record is not lock 
                        objfrmPatientConsent = New frmPatientConsent(LetterID, TemplateID, False, blnRecordLock, gnPatientID)
                    End If

                    With objfrmPatientConsent
                        .Text = "Modify Patient Consent"
                        .MdiParent = Me
                        .IsModify = True
                        .WindowState = FormWindowState.Maximized
                        .BringToFront()
                        .Show()

                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False


                        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.PatientConsent, gloAuditTrail.ActivityCategory.PatientConsent, gloAuditTrail.ActivityType.View, "Patient Consent viewed", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success)
                    End With

                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, "Patient Consent", MessageBoxButtons.OK, MessageBoxIcon.Information)
            ShowHideMainMenu(True, True)
            pnlMainToolBar.Visible = True

        Finally
            objWord = Nothing
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
            objfrmPatientConsent = Nothing
        End Try
    End Sub

    'Open disclosure to Update
    Private Sub NewOrUpdateDisclosureDetrails(ByVal IsModify As Boolean)
        Dim DisclosureID As Long
        Dim TemplateID As Long
        Dim objfrmDisclosureMgmt As frmDisclosureMgmt

        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            If IsModify = False Then

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = True Then
                        oPatientListControl.FillPatients()
                    End If
                End If

                '' dtWord = New DataTable  slr new not needed 
                objWord = New clsWordDocument
                dtWord = objWord.FillTemplates(enumTemplateFlag.DisclosureMangement)
                If IsNothing(dtWord) Then
                    MessageBox.Show("No template is associated for disclosure management. Associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    objWord = Nothing
                    dtWord = Nothing
                    Exit Sub
                End If
                If dtWord.Rows.Count = 0 Then
                    'If not present then exit from sub
                    MessageBox.Show("No template is associated for disclosure management. Associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    objWord = Nothing
                    dtWord = Nothing
                    Exit Sub
                Else
                    Try
                        objfrmDisclosureMgmt = New frmDisclosureMgmt(gnPatientID)
                        'AddHandler objfrmDisclosureMgmt.EvntGenerateCDAFromDisclosureManagement, AddressOf openCDA
                        With objfrmDisclosureMgmt
                            .Text = "Add Disclosure Management"
                            .MdiParent = Me
                            .Icon = My.Resources.Discloser_mgt

                            .WindowState = FormWindowState.Maximized
                            .BringToFront()
                            .Show()
                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False

                        End With


                    Catch ex As Exception
                        MessageBox.Show(ex.ToString, "Disclosure", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        ShowHideMainMenu(True, True)
                        pnlMainToolBar.Visible = True

                    Finally
                        objfrmDisclosureMgmt = Nothing
                    End Try
                End If
            Else ''if disclosure details to be opened to modify

                If C1dgPatientDetails.Rows.Count >= 1 Then


                    DisclosureID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                    TemplateID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 2), Int64)

                    Dim blnRecordLock As Boolean = False
                    If gblnRecordLocking = True Then
                        Dim mydt As mytable ''slr new not needed 
                        ''GLO2011-0015182 : Nurse Note
                        ''wrong trntype was set to retrive patientconsent
                        mydt = Scan_n_Lock_Transaction(TrnType.DisclosureManagement, DisclosureID, 0, Now)
                        If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                            If MessageBox.Show("This Disclosure is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                blnRecordLock = True
                            Else
                                If Not IsNothing(mydt) Then  ''slr free mydt
                                    mydt.Dispose()
                                    mydt = Nothing
                                End If
                                Exit Sub
                            End If
                        End If
                    End If

                    ''IF Disclosure is displayed as unfinished Disclosure on the loacal mc  but is finished from 
                    ''other machine then read the finished status of the Disclosure from database   
                    Dim IsFinished As String = "False"
                    Try
                        Dim oDB As New gloStream.gloDataBase.gloDataBase
                        Dim strSQL As String
                        strSQL = "  SELECT ISNULL(bIsFinished,'False') AS bIsFinished FROM DisclosureMgmt WHERE " _
                                & " nDisclosureId = " & DisclosureID & " AND  nTemplateID = " & TemplateID & "  AND  nPatientId = " & gnPatientID & " "
                        oDB.Connect(GetConnectionString)
                        IsFinished = oDB.ExecuteQueryScaler(strSQL)
                        oDB.Disconnect()
                        oDB.Dispose()
                        oDB = Nothing
                    Catch ex As Exception

                    End Try

                    If objUserRights.DislocureMgmt = False Then
                        blnRecordLock = True
                    End If


                    'Commented  by Sandip Darade as now we have read the finished status of the Disclosure 
                    'from database in above code as string 'IsFinished' 
                    'If CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 4), String) = "Yes" Then
                    If (IsFinished = "True") Then
                        ''if Disclosure's Status is 'Finished' IsFinished=Yes
                        objfrmDisclosureMgmt = New frmDisclosureMgmt(DisclosureID, TemplateID, True, blnRecordLock, gnPatientID)
                    Else

                        ''GLO2011-0015182 : Nurse Note 
                        ''Code is commented only because it has been handled Through isFinished Query.
                        'If blnRecordLock Then
                        '    ''if Disclosure's Status is 'NOT Finished' IsFinished=No and Record is lock then send it as a finish
                        '    objfrmDisclosureMgmt = New frmDisclosureMgmt(DisclosureID, TemplateID, True, blnRecordLock, gnPatientID)
                        'Else
                        '    ''if Disclosure's Statusis 'NOT Finished' IsFinished=No and Record is not lock 
                        objfrmDisclosureMgmt = New frmDisclosureMgmt(DisclosureID, TemplateID, False, blnRecordLock, gnPatientID)
                        ' End If

                    End If

                    'AddHandler objfrmDisclosureMgmt.EvntGenerateCDAFromDisclosureManagement, AddressOf openCDA
                    With objfrmDisclosureMgmt
                        .Text = "Modify Disclosure"
                        .MdiParent = Me
                        .IsModify = True
                        .WindowState = FormWindowState.Maximized
                        .BringToFront()
                        .Show()
                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False


                    End With


                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, "Patient Disclosure", MessageBoxButtons.OK, MessageBoxIcon.Information)
            ShowHideMainMenu(True, True)
            pnlMainToolBar.Visible = True

        Finally
            objWord = Nothing
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
            objfrmDisclosureMgmt = Nothing
        End Try
    End Sub

    ''Open disclosure to Update
    Private Sub NewOrUpdateNursesNotes(ByVal IsModify As Boolean)
        ''If IsModify has a value of true then open the selected info to modify
        ''If IsModify has a value of fale then open to add new info

        Dim DisclosureID As Long
        Dim TemplateID As Long
        Dim objfrmNurseNotes As frmNurseNotes

        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            'To check exception related to word
            If CheckWordForException() = False Then
                Exit Sub
            End If
            'End

            If IsModify = False Then ''Add new nurses notes

                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = True Then
                        oPatientListControl.FillPatients()
                    End If
                End If

                '   dtWord = New DataTable  slr new not needed 
                objWord = New clsWordDocument
                dtWord = objWord.FillTemplates(enumTemplateFlag.NurseNotes)

                If IsNothing(dtWord) Then
                    ''''If not present then exit from sub
                    MessageBox.Show("No template is associated for nurses notes. Associate any template first.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    objWord = Nothing
                    dtWord = Nothing
                    Exit Sub
                End If

                If dtWord.Rows.Count = 0 Then
                    ''''If not present then exit from sub
                    MessageBox.Show("No template is associated for nurses notes. Associate any template first.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    objWord = Nothing
                    If Not IsNothing(dtWord) Then
                        dtWord.Dispose()
                    End If
                    dtWord = Nothing
                    Exit Sub
                Else
                    Try
                        objfrmNurseNotes = New frmNurseNotes(gnPatientID)

                        With objfrmNurseNotes
                            .NurseNoteTemplates = dtWord.Copy
                            .MdiParent = Me

                            .WindowState = FormWindowState.Maximized
                            .BringToFront()
                            .Show()

                            ShowHideMainMenu(False, False)
                            pnlMainToolBar.Visible = False


                        End With


                    Catch ex As Exception
                        MessageBox.Show(ex.ToString, "nurses notes", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        ShowHideMainMenu(True, True)
                        pnlMainToolBar.Visible = True

                    Finally
                        objfrmNurseNotes = Nothing
                    End Try
                End If
            Else ''if nurses notes to be opened to modify

                If C1dgPatientDetails.Rows.Count >= 1 Then


                    DisclosureID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
                    TemplateID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 2), Int64)

                    ' '' <><><> Record Level Locking <><><><> 
                    ' '' Mahesh - 20070718 
                    Dim blnRecordLock As Boolean = False
                    If gblnRecordLocking = True Then
                        Dim mydt As mytable  ''slr new not needed 
                        ''GLO2011-0015182 : Nurse Note
                        ''wrong trntype was set to retrive patientconsent
                        mydt = Scan_n_Lock_Transaction(TrnType.NurseNotes, DisclosureID, 0, Now)
                        If mydt.Code <> gstrLoginName OrElse mydt.Description <> gstrClientMachineName Then
                            If MessageBox.Show("This nurses notes is being modified by " & mydt.Code & " on " & mydt.Description & ". You cannot modify it now. Do you want to open it?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.Yes Then
                                blnRecordLock = True
                            Else
                                If Not IsNothing(mydt) Then  ''slr free mydt
                                    mydt.Dispose()
                                    mydt = Nothing
                                End If
                                Exit Sub
                            End If
                        End If
                    End If
                    '''' <><><> Record Level Locking <><><><> 

                    ''IF NurseNote  is displayed as unfinished NurseNote on the loacal mc  but is finished from 
                    ''other machine then read the finished status of the NurseNote from database   
                    Dim IsFinished As String = "False"
                    Try
                        Dim oDB As New gloStream.gloDataBase.gloDataBase
                        Dim strSQL As String

                        strSQL = " SELECT ISNULL(bIsFinished,'False') AS bIsFinished FROM NurseNotes  WHERE nNurseNotesId = " & DisclosureID & "" _
                                 & " AND nPatientId =  " & gnPatientID & " AND nTemplateID=" & TemplateID & "  "
                        oDB.Connect(GetConnectionString)
                        IsFinished = oDB.ExecuteQueryScaler(strSQL)
                        oDB.Disconnect()
                        oDB.Dispose()
                        oDB = Nothing
                    Catch ex As Exception

                    End Try

                    If objUserRights.NurseNotes = False Then
                        blnRecordLock = True
                    End If

                    If (IsFinished = "True") Then
                        objfrmNurseNotes = New frmNurseNotes(DisclosureID, TemplateID, True, blnRecordLock, gnPatientID)
                    Else
                        objfrmNurseNotes = New frmNurseNotes(DisclosureID, TemplateID, False, blnRecordLock, gnPatientID)
                    End If

                    With objfrmNurseNotes
                        .Text = "Modify nurses notes"
                        .MdiParent = Me
                        .IsModify = True
                        .WindowState = FormWindowState.Maximized
                        .BringToFront()
                        .Show()
                        ShowHideMainMenu(False, False)
                        pnlMainToolBar.Visible = False


                    End With
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, "nurses notes", MessageBoxButtons.OK, MessageBoxIcon.Information)
            ShowHideMainMenu(True, True)
            pnlMainToolBar.Visible = True

        Finally
            objWord = Nothing
            If Not IsNothing(dtWord) Then
                dtWord.Dispose()
                dtWord = Nothing
            End If
            objfrmNurseNotes = Nothing
        End Try
    End Sub

    ' It will Clear all Documents of Selected Patient from DMSV3
    Private Sub mnu_ClearPatientDocuments_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_ClearPatientDocuments.Click
        Try
            Dim _DMSRunning As Boolean = False
            For Each f As Form In System.Windows.Forms.Application.OpenForms
                If f.Name = "frmEDocumentViewer" Then
                    _DMSRunning = True
                End If
            Next

            If _DMSRunning = False Then
                If gnPatientID <> 0 Then
                    'Dim oDb As New gloStream.gloDataBase.gloDataBase
                    gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV3TempPath, Convert.ToInt64(gnLoginID), gClinicID, System.Windows.Forms.Application.StartupPath)

                    Dim oDocManager As New gloEDocumentV3.gloEDocV3Management
                    oDocManager.ShowECleanDocument(gnPatientID)
                    oDocManager.Dispose()
                    If (SelectedPatientDetail = PatientDetails.ViewDocs) Then
                        ShowPatientDetails()
                    End If
                Else
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            Else
                MessageBox.Show("You can not clear patient while scan/view document is open.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_ScanDocs_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_ScanDocs.Click
        Try
            Call Scan_Documents()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub GetPatientDemographicsSettings()
        Dim ogloSettings As New gloSettings.GeneralSettings(GetConnectionString())
        Dim value As New Object()
        Try
            Pnl_Gender.Visible = False
            Pnl_Home.Visible = False
            Pnl_Mobile.Visible = False
            Pnl_Fax.Visible = False
            Pnl_Email.Visible = False
            Pnl_EmContact.Visible = False
            Pnl_EmPhone.Visible = False
            Pnl_EmMobile.Visible = False
            Pnl_Pharmacy.Visible = False
            Pnl_PCP.Visible = False
            Pnl_Status.Visible = False
            Pnl_PCPBusPhone.Visible = False
            Pnl_PCPPracPhone.Visible = False
            Pnl_PCPComPhone.Visible = False
            Pnl_PatPhone.Visible = False
            Pnl_PharmacyPhone.Visible = False
            pnl_LabStatus.Visible = False
            pnl_Race.Visible = False
            pnl_Ethinicity.Visible = False
            pnl_Language.Visible = False
            pnl_MedicalCategory.Visible = False
            pnl_Occupation.Visible = False
            pnl_workphone.Visible = False
            pnl_Businesscenter.Visible = False
            Pnl_PharmacyAddress.Visible = False
            pnl_Provider.Visible = False
            pnl_PrimaryInsurance.Visible = False
            pnl_SecondaryInsurance.Visible = False
            pnl_TertiaryInsurance.Visible = False
            'Retrieve Demographics setting from current user
            ogloSettings.GetSetting("Patient Demographics", gnLoginID, gnClinicID, value)

            If value IsNot Nothing Then
                If Convert.ToString(value).Trim() <> "" Then
                    Dim PatientDemographics As String() = Convert.ToString(value).Trim().Split(",")
                    For i As Integer = 0 To PatientDemographics.Length - 1
                        If True Then
                            ' Gender,Mobile,Home,Fax,Email,Emergency Contact,Emergency Phone,Emergency Mobile,Pharmacy,PCP,Status

                            If PatientDemographics(i).Trim() = "Race" Then
                                pnl_Race.Visible = True
                                pnl_Race.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Ethnicity" Then
                                pnl_Ethinicity.Visible = True
                                pnl_Ethinicity.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Language" Then
                                pnl_Language.Visible = True
                                pnl_Language.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Medical Category" Then
                                pnl_MedicalCategory.Visible = True
                                pnl_MedicalCategory.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Gender" Then
                                Pnl_Gender.Visible = True
                                Pnl_Gender.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Mobile" Then
                                Pnl_Mobile.Visible = True
                                Pnl_Mobile.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Fax" Then
                                Pnl_Fax.Visible = True
                                Pnl_Fax.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Email" Then
                                Pnl_Email.Visible = True
                                Pnl_Email.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Emergency Contact" Then
                                Pnl_EmContact.Visible = True
                                Pnl_EmContact.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Emergency Phone" Then
                                Pnl_EmPhone.Visible = True
                                Pnl_EmPhone.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Emergency Mobile" Then
                                Pnl_EmMobile.Visible = True
                                Pnl_EmMobile.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Pharmacy" Then
                                Pnl_Pharmacy.Visible = True
                                Pnl_Pharmacy.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Pharmacy Address" Then
                                Pnl_PharmacyAddress.Visible = True
                                Pnl_PharmacyAddress.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Pharmacy Phone" Then
                                Pnl_PharmacyPhone.Visible = True
                                Pnl_PharmacyPhone.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Lab Status" Then
                                pnl_LabStatus.Visible = True
                                pnl_LabStatus.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "PCP" Then
                                Pnl_PCP.Visible = True
                                Pnl_PCP.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "PCPPh" Then
                                Pnl_PCPBusPhone.Visible = True
                                Pnl_PCPBusPhone.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "Status" Then
                                Pnl_Status.Visible = True
                                Pnl_Status.BringToFront()
                            End If

                            If PatientDemographics(i).Trim() = "PatientPhone" Then
                                Pnl_PatPhone.Visible = True
                                Pnl_PatPhone.BringToFront()
                            End If

                            '' added for 8070 prd workphone,occupation,business center
                            If PatientDemographics(i).Trim() = "Business Center" Then
                                pnl_Businesscenter.Visible = True
                                pnl_Businesscenter.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Work Phone" Then
                                pnl_workphone.Visible = True
                                pnl_workphone.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Occupation" Then
                                pnl_Occupation.Visible = True
                                pnl_Occupation.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Provider" Then
                                pnl_Provider.Visible = True
                                pnl_Provider.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Primary Insurance" Then
                                pnl_PrimaryInsurance.Visible = True
                                pnl_PrimaryInsurance.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Secondary Insurance" Then
                                pnl_SecondaryInsurance.Visible = True
                                pnl_SecondaryInsurance.BringToFront()
                            End If
                            If PatientDemographics(i).Trim() = "Tertiary Insurance" Then
                                pnl_TertiaryInsurance.Visible = True
                                pnl_TertiaryInsurance.BringToFront()
                            End If
                        End If
                    Next
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(Me, ex.Message, _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
        Finally
            ogloSettings.Dispose()
            ogloSettings = Nothing
            If Not IsNothing(value) Then
                value = Nothing
            End If
        End Try
    End Sub

    'Modify patient appointments
    Private Sub ModifyAppointment()
        GetControlSelection()

        Dim oAppParameters As New gloAppointmentScheduling.SetAppointmentParameter()
        Dim oSetupAppointment As New gloAppointmentScheduling.frmSetupAppointment(GetConnectionString())


        Dim _AppStatus As gloAppointmentScheduling.ASUsedStatus = gloAppointmentScheduling.ASUsedStatus.Unknown3
        _AppStatus = CType(Convert.ToInt32(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_USEDSTATUS)), gloAppointmentScheduling.ASUsedStatus)


        'GLO2011-0011959 - Multiple days appointment
        'Patient Details - Changed below condition to open appointment in modify mode in case of multiple day's appointment

        If Convert.ToDateTime(gloDateMaster.gloDate.DateAsDate(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_EndDate))).[Date] < DateTime.Now.[Date] Then
            MessageBox.Show("Cannot modify past appointment. ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Exit Sub
        End If

        If _AppStatus = gloAppointmentScheduling.ASUsedStatus.CheckOut Then
            If Convert.ToDateTime(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_DATE1)).[Date] < DateTime.Now.[Date] Then
                MessageBox.Show("Cannot modify past appointment. ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                ''slr free first two variables
                If Not IsNothing(oAppParameters) Then
                    oAppParameters.Dispose()
                    oAppParameters = Nothing
                End If
                If Not IsNothing(oSetupAppointment) Then
                    oSetupAppointment.Dispose()
                    oSetupAppointment = Nothing
                End If

                Exit Sub

            Else
                If MessageBox.Show("Patient '" & gstrPatientFirstName + " " + gstrPatientMiddleName + " " + gstrPatientLastName & "' is already checked out.  Are you sure you wish to modify this appointment?", _MessageBoxCaption, MessageBoxButtons.YesNoCancel, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2) = DialogResult.Yes Then
                Else
                    ''slr free first two variables
                    If Not IsNothing(oAppParameters) Then
                        oAppParameters.Dispose()
                        oAppParameters = Nothing
                    End If
                    If Not IsNothing(oSetupAppointment) Then
                        oSetupAppointment.Dispose()
                        oSetupAppointment = Nothing
                    End If
                    Exit Sub
                End If

            End If

        ElseIf _AppStatus = gloAppointmentScheduling.ASUsedStatus.CheckIn Then
            If Convert.ToDateTime(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_DATE1)).[Date] < DateTime.Now.[Date] Then
                MessageBox.Show("Cannot modify past appointment. ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                ''slr free first two variables
                If Not IsNothing(oAppParameters) Then
                    oAppParameters.Dispose()
                    oAppParameters = Nothing
                End If
                If Not IsNothing(oSetupAppointment) Then
                    oSetupAppointment.Dispose()
                    oSetupAppointment = Nothing
                End If
                Exit Sub
            Else
            End If
        ElseIf _AppStatus = gloAppointmentScheduling.ASUsedStatus.Delete Then
            MessageBox.Show("Cannot modify deleted appointment. ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            ''slr free first two variables
            If Not IsNothing(oAppParameters) Then
                oAppParameters.Dispose()
                oAppParameters = Nothing
            End If
            If Not IsNothing(oSetupAppointment) Then
                oSetupAppointment.Dispose()
                oSetupAppointment = Nothing
            End If
            Exit Sub

        ElseIf _AppStatus = gloAppointmentScheduling.ASUsedStatus.Cancel Then

            If MessageBox.Show("This appointment is cancelled. Do you want to modify the appointment note?", _MessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.No Then
                ''slr free first two variables
                If Not IsNothing(oAppParameters) Then
                    oAppParameters.Dispose()
                    oAppParameters = Nothing
                End If
                If Not IsNothing(oSetupAppointment) Then
                    oSetupAppointment.Dispose()
                    oSetupAppointment = Nothing
                End If
                Exit Sub
            End If

        ElseIf _AppStatus = gloAppointmentScheduling.ASUsedStatus.NoShow Then

            If MessageBox.Show("The status of this appointment is 'No Show'. Do you want to modify the appointment note?", _MessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.No Then
                ''slr free first two variables
                If Not IsNothing(oAppParameters) Then
                    oAppParameters.Dispose()
                    oAppParameters = Nothing
                End If
                If Not IsNothing(oSetupAppointment) Then
                    oSetupAppointment.Dispose()
                    oSetupAppointment = Nothing
                    ' SetControlSelection()

                End If
                Exit Sub
            End If

        End If



        Dim dt As DataTable ''slr new not needed 
        Dim _resourceID As Int64
        Dim Starttime As DateTime
        Dim Endtime As DateTime
        Dim StartDate As DateTime
        Dim ogloAppointment As gloAppointmentScheduling.gloAppointment = New gloAppointmentScheduling.gloAppointment(GetConnectionString())
        _resourceID = C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_ASBASEID)
        Starttime = C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_STARTTIME)
        StartDate = gloDateMaster.gloDate.DateAsDate(Convert.ToDouble(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_DATE))).ToShortDateString()
        Endtime = C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_ENDTIME)
        dt = ogloAppointment.ResourseName(_resourceID, Starttime, Endtime, StartDate)
        If Not IsNothing(dt) Then  ''slr nothing condition checked
            If (dt.Rows.Count > 0) Then

                If (DialogResult.No = MessageBox.Show("Schedule for " + dt.Rows(0)("sASBaseDesc") + " is blocked from " & dt.Rows(0)("dtStarttime") + " to " + dt.Rows(0)("dtEndtime") + "." + vbCrLf + "Modify this " + Starttime.ToShortTimeString() + " - " + Endtime.ToShortTimeString() + " appointment? ", _MessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2)) Then
                    Exit Sub
                End If
            End If
        End If

        '#Region "Find for Single/Recurrence Option" 
        Dim _SinRecCriteria As gloAppointmentScheduling.SingleRecurrence = gloAppointmentScheduling.SingleRecurrence.[Single]
        _SinRecCriteria = DirectCast(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_APPMETHOD), gloAppointmentScheduling.SingleRecurrence)
        'SelectedForModDel 

        oAppParameters.AddTrue_ModifyFalse_Flag = False
        If _SinRecCriteria = gloAppointmentScheduling.SingleRecurrence.[Single] Then
            oAppParameters.ModifyAppointmentMethod = gloAppointmentScheduling.SingleRecurrence.[Single]
            oAppParameters.ModifyMasterAppointmentMethod = gloAppointmentScheduling.SingleRecurrence.[Single]
            oAppParameters.ModifySingleAppointmentFromReccurence = False
        Else

            oAppParameters.ModifyAppointmentMethod = gloAppointmentScheduling.SingleRecurrence.[Single]
            oAppParameters.ModifyMasterAppointmentMethod = gloAppointmentScheduling.SingleRecurrence.Recurrence

            oAppParameters.ModifySingleAppointmentFromReccurence = True
        End If
        '#End Region 

        '#Region "Set Appointment Parameter" 
        oAppParameters.MasterAppointmentID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_MSTAPTID))
        oAppParameters.AppointmentID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_APTDTL))
        oAppParameters.AppointmentFlag = gloAppointmentScheduling.AppointmentScheduleFlag.Appointment
        oAppParameters.AppointmentTypeID = 0
        oAppParameters.AppointmentTypeCode = ""
        oAppParameters.AppointmentTypeDesc = ""
        oAppParameters.ProviderID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_ASBASEID))
        oAppParameters.ProviderName = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_PROVIDER))
        oAppParameters.ProblemTypes = Nothing
        oAppParameters.Resources = Nothing
        oAppParameters.PatientID = 0

        oAppParameters.Location = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_LOCATION))
        oAppParameters.Department = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_DEPARTMENT))

        oAppParameters.StartTime = Convert.ToDateTime(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_STARTTIME))
        oAppParameters.Duration = 0

        oAppParameters.ClinicID = gnClinicID
        oAppParameters.LineNumber = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, COL_LINENUMBER))

        oAppParameters.LoadParameters = False
        oAppParameters.Usedstatus = _AppStatus
        oSetupAppointment.SetAppointmentParameters = oAppParameters
        oSetupAppointment.MasterAppointmentId = oAppParameters.MasterAppointmentID
        oSetupAppointment.DetailAppointmentId = oAppParameters.AppointmentID
        oSetupAppointment.ShowDialog(IIf(IsNothing(oSetupAppointment.Parent), Me, oSetupAppointment.Parent))
        'INTEGRATED BY SHUBHANGI 20110321
        Fill_Appointments()
        ShowAppointments()


        ''slr free first two variables
        If Not IsNothing(oAppParameters) Then
            oAppParameters.Dispose()
            oAppParameters = Nothing
        End If
        If Not IsNothing(oSetupAppointment) Then
            oSetupAppointment.Dispose()
            oSetupAppointment = Nothing


        End If

        SetControlSelection()

    End Sub

    ''Add new appointment for patient
    Private Sub AddAppointment()
        'Check Patient Status
        ''''' code added by 20091024 - to fix bug #3548 :-Appointment > Able to create appointment against 'Deceased' patient
        If IsAccess(False) = False Then
            Exit Sub
        End If

        'To Check Restricted Appointment
        CheckrestrictedSettings()

        If (_RegAppUsingTemplateOnly = True) Then
            MessageBox.Show("New appointments can only be set during established template times. This setting can be changed. Please contact your administrator for more information.  ", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Return
        End If
        'End To Check Restricted Appointment




        'Check Patient Status
        Dim oAppointment As gloAppointmentScheduling.gloAppointment = New gloAppointmentScheduling.gloAppointment(GetConnectionString())
        oAppointment.ShowAppointment(gnPatientID, Me)
        oAppointment.Dispose()
        Fill_Appointments()
        ShowAppointments()
    End Sub


    Private Sub FillAppointmentStatusCombo()

        cmbStatus.DataSource = Nothing
        cmbStatus.Items.Clear()
        Dim dtStatus As New DataTable
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Try
            oDB.Connect(False)
            Dim _strSQL As String = "SELECT ISNULL(nAppointmentStatusID,0) AS  nAppointmentStatusID  ,ISNULL(sAppointmentStatus,'') AS sAppointmentStatus  from AB_AppointmentStatus WHERE bIsBlocked ='False'"
            oDB.Retrive_Query(_strSQL, dtStatus)

            _strSQL = Nothing

            Dim r As DataRow
            r = dtStatus.NewRow
            r.Item("sAppointmentStatus") = "All"
            r.Item("nAppointmentStatusID") = 0
            dtStatus.Rows.InsertAt(r, 0)

            r = Nothing

            cmbStatus.DataSource = dtStatus
            cmbStatus.DisplayMember = dtStatus.Columns("sAppointmentStatus").ToString()
            cmbStatus.ValueMember = dtStatus.Columns("nAppointmentStatusID").ToString()
        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
        Finally
            If IsNothing(oDB) = False Then
                oDB.Dispose()
                oDB = Nothing
            End If
        End Try
    End Sub

    Private Sub mnu_Appointment_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_Appointment.Click
        AddAppointment()
        ShowPatientDetails()
    End Sub

    Private Sub mnu_Schedule_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_Schedule.Click

        'By Pranit on 20111206 to check admin setting (new schedule)
        Try
            Dim _isResult As Boolean = checkSchedule()
            If (_isResult = True) Then
                Dim oSchedule As gloAppointmentScheduling.gloSchedule = New gloAppointmentScheduling.gloSchedule(GetConnectionString())
                oSchedule.ShowSchedule()
                oSchedule.Dispose()
            Else
                MessageBox.Show("You don't have rights to access schedule. Please contact your administrator for more information.  ", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If



        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
        End Try
    End Sub



    ' By Pranit on 20111206 to check admin setting (new schedule)
    Private Function checkSchedule() As Boolean
        Dim _isResult As Boolean = False
        Dim _UserName As String = Nothing
        Dim _databaseconnectionstring As String = Nothing
        Try
            'Get User Name
            If Not IsNothing(appSettings("UserName")) Then
                If appSettings("UserName") <> "" Then
                    _UserName = Convert.ToString(appSettings("UserName").Trim())
                Else
                    _UserName = ""
                End If
            Else
                _UserName = ""
            End If

            ''user rights
            _databaseconnectionstring = GetConnectionString()
            Dim oClsgloUserRights As New gloUserRights.ClsgloUserRights(_databaseconnectionstring)
            Try
                If Not IsNothing(oClsgloUserRights) Then
                    oClsgloUserRights.CheckForUserRights(_UserName)
                    If (oClsgloUserRights.NewSchedule) Then
                        _isResult = True
                    End If
                End If
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            Finally
                If Not IsNothing(_UserName) Then
                    _UserName = Nothing
                End If
            End Try
            If Not IsNothing(oClsgloUserRights) Then  ''slr free oClsgloUserRights
                oClsgloUserRights.Dispose()
                oClsgloUserRights = Nothing
            End If

        Catch ex1 As Exception
            MessageBox.Show(ex1.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try


        Return _isResult
    End Function

#Region "Automate Rx Eligibility Request"
    'Private Sub RxElgRequest(ByVal sender As Object, ByVal e As System.EventArgs)

    '    Dim nPatientID As Long = 0
    '    Try
    '        If c1PatientCheckInStatus.Rows.Count > 0 Then
    '            For i As Integer = 1 To c1PatientCheckInStatus.Rows.Count - 1
    '                nPatientID = c1PatientCheckInStatus.GetData(i, col_CheckInStatus_PatientID)
    '                If PerformRxElgRequestforPatient(nPatientID) = True Then
    '                    'update log request sent successfully
    '                    UpdateLogForRx("Rx Eligibility Request sent successfully for Patient: " & c1PatientCheckInStatus.GetData(i, col_CheckInStatus_CheckInDetail))
    '                Else
    '                    UpdateLogForRx("Rx Eligibility Request failed for Patient: " & c1PatientCheckInStatus.GetData(i, col_CheckInStatus_CheckInDetail))
    '                End If
    '            Next
    '        End If
    '    Catch ex As Exception
    '        UpdateLogForRx(ex.ToString())
    '    End Try
    'End Sub

    'Private Function PerformRxElgRequestforPatient(ByVal PatientID As Long)
    '    Dim _result As Boolean = False

    '    Try
    '        Dim oClsRxHubInterface As New ClsRxHubInterface(PatientID)
    '        Dim oEligibilityCheck As New clsEligibilityCheckDBLayer()

    '        'IsEligibilitygGenerated_validation
    '        If oEligibilityCheck.IsEligibilitygGenerated_validation(PatientID) = True Then


    '            oEligibilityCheck.GetEligibilityCheck(PatientID)
    '            Dim strFileName As String = ""
    '            If Not IsNothing(oEligibilityCheck.Patient) Then
    '                ofrmEDIGeneration.Patient = oEligibilityCheck.Patient
    '                If oClsRxHubInterface.CheckOutboxFolder(ClsgloRxHubGeneral.gnstrApplicationFilePath) Then
    '                    strFileName = ofrmEDIGeneration.Generate270SingleCoveragePharmacyBenefitEDI(gstrRxHubParticipantId, gstrRxHubPassword)
    '                    Try
    '                        Dim ofrmPostSample As New gloRxHub.frmSamplePost
    '                        If strFileName <> "" Then
    '                            ofrmPostSample.strFileName = strFileName
    '                            ofrmPostSample.blnIsAutomated = True
    '                            ofrmPostSample.Button3_Click(Nothing, Nothing)
    '                            Dim gnInsuranceId As Long = 0
    '                            Dim EDI271FilePath As String = ofrmPostSample.strOutputFile
    '                            Dim ofrmEligibilityResponse_new As frmEligiblityResponse_new
    '                            Try
    '                                FillEligibilityResponse1(EDI271FilePath, ofrmEDIGeneration.Patient)
    '                            Catch ex As Exception
    '                                _result = False
    '                                Throw ex
    '                            End Try
    '                        End If

    '                    Catch ex As Exception
    '                        _result = False
    '                        Throw ex
    '                    End Try

    '                Else
    '                    UpdateLogForRx("The 270 EDI Request cannot be generated since there is no Outbox folder.")
    '                End If
    '            End If
    '        Else
    '            UpdateLogForRx("270 Request is already generated for this patient. You cannot sent 270 for this patient for next 24 Hours!")
    '        End If
    '        _result = True
    '    Catch ex As Exception
    '        _result = False
    '        Throw ex
    '    End Try
    '    Return _result
    'End Function


    Public Sub FillEligibilityResponse1(ByVal FilePath As String, ByVal objPatient As gloRxHub.ClsPatient)
        Dim oClsRxHubInterface As New ClsRxHubInterface(gnPatientID)
        oClsRxHubInterface.Patient = objPatient
        '  Dim oClsRxH_271Master As New ClsRxH_271Master()   ''slr not used
        ' Dim oCls271Information As New Cls271Information()  ''slr not used
        ''in case of NAK first check the file is NAK otherwise it will not be loaded in EDI framework
        If oClsRxHubInterface.LoadEDIObject_271(FilePath) = False Then
            'means file is not valid EDI file and is not able to get loaded in the EDI doc object.
            'therefore this must be the NAK file
            UpdateLogForRx("NAK : TRANSACTION CANNOT BE IDENTIFIED NOR PROCESSED ")
            Exit Sub
        Else
            '//file is valid edi file and has got loaded in the ediDOC object
        End If

        oClsRxHubInterface.Translate271Response_auto()

        'SLR: Free oclsRxHubInterface
        oClsRxHubInterface.Dispose()
        oClsRxHubInterface = Nothing


    End Sub

#End Region

    Private Sub mnu_TemplateAssociation_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_TemplateAssociation.Click
        Dim oSTGA As gloOffice.frmSetupTemplateGalleryAssociation = New gloOffice.frmSetupTemplateGalleryAssociation(GetConnectionString())
        Try
            oSTGA.ShowDialog(IIf(IsNothing(oSTGA.Parent), Me, oSTGA.Parent))
            oSTGA.Dispose()
            oSTGA = Nothing
        Catch ex As Exception
            MessageBox.Show(ex.ToString(), _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try
    End Sub

    Public Sub mnu_DashBoard_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_DashBoard.Click
        Me.pnlMainToolBar.Visible = True
        ShowHideMainMenu(True, True)


        'Bug #39460
        'Hide all call out split screen
        HideCallOutSplitScreen()
        'End Bug #39460

        'Incident 00005646 : System Hangs-up in exam opens from Dashboard PatientDetails Panel.
        If (gnPatientID = oPatientListControl.SelectedPatientID) OrElse (gnPatientID <> 0 AndAlso oPatientListControl.SelectedPatientID = 0) Then
            Try
                Call ShowPatientAllDetails(gnPatientID, , True, True)
            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.None, "Error at MainMenu_MdiChildActivate - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
            End Try
        End If
    End Sub

    Private Sub oGeneralInterface_InvalidFilePath() Handles oGeneralInterface.InvalidFilePath
        blnIsInvalidHL7FilePath = True
    End Sub


    Private Sub mnu_ViewDocument_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_ViewDocument.Click
        Try
            'Enable all buttons except Scan, Import  & Delete 
            If IsAccess(False) = False Then
                Exit Sub
            End If

            Call Scan_Documents(False, False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub tlsMenuitem_AdvancePayment_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If
            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            'Dim ofrmAdvancePayment As New gloBilling.frmAdvancePayment(GetConnectionString(), gnPatientID, gloBilling.PaymentOtherType.AdvancePayment)
            'ofrmAdvancePayment.ShowDialog(Me)
            'ofrmAdvancePayment.Dispose()

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_BillingAdvPayment_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_BillingAdvPayment.Click
        Try

            If IsAccess(False) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            'Dim ofrmAdvancePayment As New gloBilling.frmAdvancePayment(GetConnectionString(), gnPatientID, gloBilling.PaymentOtherType.AdvancePayment)
            'ofrmAdvancePayment.ShowDialog(Me)
            'ofrmAdvancePayment.Dispose()

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub cmnuPatientDetails_ItemClicked(ByVal sender As Object, ByVal e As System.Windows.Forms.ToolStripItemClickedEventArgs) Handles cmnuPatientDetails.ItemClicked
        Try
            If e.ClickedItem.Text = "Prior Authorization" Then
                Dim ofrmPriorAuthorization As New gloPMGeneral.frmPriorAuthorization(gnPatientID, tempInsName, tempInsId, GetConnectionString())
                ofrmPriorAuthorization.ShowDialog(IIf(IsNothing(ofrmPriorAuthorization.Parent), Me, ofrmPriorAuthorization.Parent))
                ofrmPriorAuthorization.Dispose()
                Exit Sub

            ElseIf e.ClickedItem.Text = "Eligibility Check" Then
                Dim ofrmEligibilityForm As gloBilling.frmEligibilityForm = New frmEligibilityForm(GetConnectionString(), gnPatientID, tempInsId)
                ofrmEligibilityForm.ShowDialog(IIf(IsNothing(ofrmEligibilityForm.Parent), Me, ofrmEligibilityForm.Parent))
                ofrmEligibilityForm.Dispose()
                Exit Sub

            ElseIf e.ClickedItem.Text = "Copay" Then
                'Dim ofrmAdvancePayment As gloBilling.frmAdvancePayment = New frmAdvancePayment(GetConnectionString(), gnPatientID, tempInsName, tempInsId, copayAmount, PaymentOtherType.Copay)
                'ofrmAdvancePayment.StartPosition = FormStartPosition.CenterScreen
                'ofrmAdvancePayment.ShowDialog(Me)
                'ofrmAdvancePayment.Dispose()
                'Exit Sub

            ElseIf e.ClickedItem.Text = "Coverage" Then
                'Dim ofrmAdvancePayment As gloBilling.frmAdvancePayment = New frmAdvancePayment(GetConnectionString(), gnPatientID, tempInsName, tempInsId, coveragePercent, PaymentOtherType.InsuranceCoverage)
                'ofrmAdvancePayment.StartPosition = FormStartPosition.CenterScreen
                'ofrmAdvancePayment.ShowDialog(Me)
                'ofrmAdvancePayment.Dispose()
                'Exit Sub

            ElseIf e.ClickedItem.Text = "Modify Insurance" Then
                Dim oPatient As New gloPatient.gloPatient(GetConnectionString)
                oPatient.ShowPatientRegistration(gnPatientID, gloPatient.ModifyPatientDetailType.Insurance, gnPatientID, Me)
                oPatient.Dispose()
                oPatient = Nothing
                Fill_Insurances()
                Exit Sub

            ElseIf e.ClickedItem.Text = "Ledger" Then
                'If IsAccess(False) = False Then
                '    Exit Sub
                'End If
                'ShowHideMainMenu(False, False)
                'Dim oBilling As New gloBilling.gloBilling(GetConnectionString, GetConnectionString)
                'oBilling.ShowPatientLedger(gnPatientID, Me)
                Exit Sub

            ElseIf e.ClickedItem.Text = "Payment" Then
                ShowHideMainMenu(False, False)
                Dim _ClaimNo As Int64 = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 2))
                Dim oBilling As New gloBilling.gloBilling(GetConnectionString, GetConnectionString)
                oBilling.ShowBillingPayment(gnPatientID, 0, _ClaimNo, Me)
                'SLR: Dispose oBilling
                If Not IsNothing(oBilling) Then
                    oBilling.Dispose()
                    oBilling = Nothing
                End If
                Exit Sub

            ElseIf e.ClickedItem.Text = "Add Referral" Then

            ElseIf e.ClickedItem.Text = "Remove Referral" Then

            ElseIf e.ClickedItem.Text = "Modify Referral" Then
                GetControlSelection()
                GridSelect_RowCount = C1dgPatientDetails.Rows.Count
                Dim _ContactID As Int64 = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 9))
                If _ContactID > 0 Then
                    Dim ofrmContact As New gloContacts.frmSetupPhysician(_ContactID, GetConnectionString)
                    ofrmContact.Text = "Modify Referral"
                    ofrmContact.Icon = My.Resources.Patient_Referral
                    ofrmContact.ShowDialog(IIf(IsNothing(ofrmContact.Parent), Me, ofrmContact.Parent))
                    If SelectedPatientDetail = PatientDetails.Referrals Then
                        Fill_Referrals()
                        SetControlSelection_EMR()

                    End If
                    'SLR: free ofrmContact
                    If Not IsNothing(ofrmContact) Then
                        ofrmContact.Dispose()
                        ofrmContact = Nothing
                    End If
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnu_TaskMailConfiguration_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_TaskMailConfiguration.Click
        Try

            '''''''''''''''''
            If IsAccess(False) = False Then
                Exit Sub
            End If
            '''''''''''''''''

            Dim oTaskMail As New gloTasksMails.gloTaskMail(GetConnectionString())
            ''added Handler for calling gloCommunityViewDataform for BillingConfig Download form.
            AddHandler oTaskMail.EvntTaskmailHandler, AddressOf ViewTaskmail
            ''end
            oTaskMail.ShowTaskMailBook(Me)
            ShowHideMainMenu(False, False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_ViewSchedule_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_ViewSchedule.Click
        Try

            Dim oSchedule As New gloAppointmentScheduling.gloSchedule(GetConnectionString())
            oSchedule.ShowScheduleView(Me)
            oSchedule.Dispose()
            pnlMainToolBar.Visible = False
            ShowHideMainMenu(False, False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    'Private Sub Fill_Templates()

    '    Dim oMenuItem As New ToolStripMenuItem
    '    oMenuItem.Text = "Templates"
    '    oMenuItem.Image = imgList_Common.Images(10)

    '    Dim ogloTemplate As New gloOffice.gloTemplate(GetConnectionString())
    '    Dim dtCategories As New DataTable()
    '    Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
    '    Dim dtTemplates As New DataTable()
    '    Dim CategoryName As String = ""
    '    Try
    '        oDB.Connect(False)
    '        dtCategories = ogloTemplate.GetTemplateCategoryList()

    '        If dtCategories IsNot Nothing Then
    '            If dtCategories.Rows.Count > 0 Then
    '                For i As Integer = 0 To dtCategories.Rows.Count - 1
    '                    Dim oCatMenuItem As New ToolStripMenuItem()

    '                    CategoryName = dtCategories.Rows(i)("CategoryName").ToString()
    '                    oCatMenuItem.Text = CategoryName

    '                    Dim _sqlQuery As String = (" SELECT  TemplateGallery_MST.nTemplateID, ISNULL(TemplateGallery_MST.sTemplateName, '') AS sTemplateName, TemplateGallery_MST.nCategoryID, " & "  TemplateGallery_MST.nProviderID, ISNULL(Provider_MST.sFirstName, '') + SPACE(1) + ISNULL(Provider_MST.sLastName, '') + SPACE(1)  " & " + ISNULL(Provider_MST.sMiddleName, '') AS sProviderName " & " FROM  TemplateGallery_MST LEFT OUTER JOIN " & " Provider_MST ON TemplateGallery_MST.nProviderID = Provider_MST.nProviderID " & " WHERE  TemplateGallery_MST.sCategoryName = '") + CategoryName.Replace("'", "''") & "' "
    '                    oDB.Retrive_Query(_sqlQuery, dtTemplates)

    '                    If dtTemplates IsNot Nothing AndAlso dtTemplates.Rows.Count > 0 Then
    '                        For j As Integer = 0 To dtTemplates.Rows.Count - 1
    '                            Dim oTemplateItem As New ToolStripMenuItem()
    '                            oTemplateItem.Text = dtTemplates.Rows(j)("sTemplateName").ToString()
    '                            oTemplateItem.Tag = dtTemplates.Rows(j)("nTemplateID").ToString()
    '                            oCatMenuItem.DropDownItems.Add(oTemplateItem)
    '                            AddHandler oTemplateItem.Click, AddressOf cmnuTemplateItem_Click
    '                        Next
    '                    End If

    '                    If dtTemplates IsNot Nothing Then
    '                        dtTemplates.Dispose()
    '                    End If

    '                    oMenuItem.DropDownItems.Add(oCatMenuItem)
    '                Next
    '                cMnuPatient.Items.Add(oMenuItem)
    '            End If
    '        End If
    '    Catch ex As Exception
    '        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
    '    Finally
    '        If oDB IsNot Nothing Then
    '            oDB.Disconnect()
    '            oDB.Dispose()
    '        End If

    '        If IsNothing(ogloTemplate) Then
    '            ogloTemplate.Dispose()
    '            ogloTemplate = Nothing
    '        End If
    '    End Try
    'End Sub

    Private Sub cmnuTemplateItem_Click(ByVal sender As Object, ByVal e As EventArgs)
        Try
            If CheckWordForException() = False Then
                Exit Sub
            End If
            If sender IsNot Nothing Then
                Dim cmnuTemplateItem As New ToolStripMenuItem()
                cmnuTemplateItem = DirectCast(sender, ToolStripMenuItem)
                Dim ogloTemplate As New gloOffice.gloTemplate(GetConnectionString())
                ogloTemplate.CategoryID = Convert.ToInt64(cmnuTemplateItem.OwnerItem.Tag)
                ogloTemplate.CategoryName = cmnuTemplateItem.OwnerItem.Text
                ogloTemplate.TemplateID = Convert.ToInt64(cmnuTemplateItem.Tag)
                ogloTemplate.PrimeryID = Convert.ToInt64(cmnuTemplateItem.Tag)
                ogloTemplate.TemplateName = cmnuTemplateItem.Text
                ogloTemplate.PatientID = Convert.ToInt64(gnPatientID)
                ogloTemplate.ClinicID = gnClinicID

                Dim frm As New gloOffice.frmWd_PatientTemplate(GetConnectionString(), ogloTemplate)
                frm.Text = cmnuTemplateItem.Text
                frm.MdiParent = Me
                frm.Show()
                frm.WindowState = FormWindowState.Maximized
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#Region " Auto Refresh Task, Messages, Triage, UnfinishedExams, Appointments"

    ''' <summary>
    ''' Auto Refresh Task, Messages, Triage, UnfinishedExams, Appointments
    ''' To set the timer interval go to Tools > Settings > Other Settings 
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks></remarks>
    Private Sub tmrMessages_Tick(ByVal sender As Object, ByVal e As System.EventArgs) Handles tmrMessages.Tick
        Try
            nRowCount = 100
            nShowTaskRowCount = 100
            _isTasksFullyLoaded = False
            tmrMessages.Stop()
            If ((BackgroundWorker_MessageTimer.IsBusy = False) AndAlso Me.CanFocus) Then
                BackgroundWorker_MessageTimer.RunWorkerAsync()
            ElseIf (Me.CanFocus = False) Then
                ShowMessages_New()
            Else
            End If
            'Try
            '    ogloReminder.GiveReminder()
            'Catch ex As Exception
            '    gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.None, ex.ToString(), gloAuditTrail.ActivityOutCome.Failure)
            'End Try

            tmrMessages.Start()
        Catch ex As Exception
            tmrMessages.Stop()
        Finally  ''code change problem 00000591
            'GC.Collect()
            'GC.WaitForPendingFinalizers()
        End Try
    End Sub

#End Region

    Private Sub mnuVwHL7MessageQueue_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuVwHL7MessageQueue.Click
        If IsAccess(False) = False Then
            Exit Sub
        End If
        Dim frm As New frmHL7_MessageQueue(1000)
        Try

            frm.MdiParent = Me
            frm.Show()
            frm.WindowState = FormWindowState.Maximized
            frm.BringToFront()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub mnuView_PatientTemplates_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_PatientTemplates.Click
        If IsAccess(False) = False Then
            Exit Sub
        End If
        Try
            Dim frm As gloOffice.frmWd_ViewPatientTemplates = gloOffice.frmWd_ViewPatientTemplates.GetInstance(gnPatientID, GetConnectionString())

            frm.MdiParent = Me
            frm.ShowInTaskbar = False
            frm.StartPosition = FormStartPosition.CenterParent
            frm.WindowState = FormWindowState.Maximized
            frm.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuVwDeniedRefillReq_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuVwDeniedRefillReq.Click
        Dim odatatable As DataTable  ''slr new not needed 
        Try

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim ofrmDeniedrefReqRpt As New frmDeniedRefReqReport
            odatatable = ofrmDeniedrefReqRpt.GetDeniedReportAllPatient()
            ''''''if there are no values in the data table then don't load the form
            If Not IsNothing(odatatable) Then
                If odatatable.Rows.Count <= 0 Then '''''if no values are populated the show the message and exit
                    MessageBox.Show("No refill requests were denied for this patient", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    ofrmDeniedrefReqRpt.Dispose()
                    Exit Sub
                End If
            End If

            ofrmDeniedrefReqRpt.ShowDialog(IIf(IsNothing(ofrmDeniedrefReqRpt.Parent), Me, ofrmDeniedrefReqRpt.Parent))
            If Not IsNothing(ofrmDeniedrefReqRpt) Then  ''slr free ofrmDeniedrefReqRpt
                ofrmDeniedrefReqRpt.Dispose()
                ofrmDeniedrefReqRpt = Nothing
            End If
            If Not IsNothing(odatatable) Then  ''slr free odatatable
                odatatable.Dispose()
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            odatatable = Nothing
        Finally
            odatatable = Nothing
        End Try
    End Sub

#Region "MIS REPORTS"


    Private Sub mnu_MISReports_PatientPaymentHistory_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_PatientPaymentHistory.Click
        Try
            Dim ofrmRpt_PatientPaymentHistory As New gloReports.frmRpt_PatientPaymentHistory(GetConnectionString(), gnPatientID)
            ofrmRpt_PatientPaymentHistory.MdiParent = Me
            ofrmRpt_PatientPaymentHistory.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_PatientTransactionHistory_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_PatientTransactionHistory.Click
        Try
            Dim ofrmRpt_PatientTransactionHistory As New gloReports.frmRpt_PatientTransactionHistory(GetConnectionString(), gnPatientID)

            ofrmRpt_PatientTransactionHistory.MdiParent = Me
            ofrmRpt_PatientTransactionHistory.WindowState = FormWindowState.Maximized
            ofrmRpt_PatientTransactionHistory.ShowInTaskbar = False
            ofrmRpt_PatientTransactionHistory.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_PatientTransactionHistory.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_Patientstatement_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_Patientstatement.Click
        Try
            Dim ofrmRpt_PatientStatementForGateWayEDI As New gloReports.frmRpt_PatientStatementForGateWayEDI(GetConnectionString(), gnPatientID)
            ofrmRpt_PatientStatementForGateWayEDI.MdiParent = Me
            ofrmRpt_PatientStatementForGateWayEDI.WindowState = FormWindowState.Maximized
            ofrmRpt_PatientStatementForGateWayEDI.ShowInTaskbar = False
            ofrmRpt_PatientStatementForGateWayEDI.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_PatientStatementForGateWayEDI.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByDoctor_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByDoctor.Click
        Try
            Dim ofrmRpt_ProductionByDoctor As New gloReports.frmRpt_ProductionByDoctor(GetConnectionString())
            ofrmRpt_ProductionByDoctor.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByDoctor.MdiParent = Me
            ofrmRpt_ProductionByDoctor.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByDoctor.ShowInTaskbar = False
            ofrmRpt_ProductionByDoctor.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByFacility_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByFacility.Click
        Try
            Dim ofrmRpt_ProductionByFacility As New gloReports.frmRpt_ProductionByFacility(GetConnectionString())
            ofrmRpt_ProductionByFacility.MdiParent = Me
            ofrmRpt_ProductionByFacility.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByFacility.ShowInTaskbar = False
            ofrmRpt_ProductionByFacility.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByFacility.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByDate_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByDate.Click
        Try
            Dim ofrmRpt_ProductionByDate As New gloReports.frmRpt_ProductionByDate(GetConnectionString())
            ofrmRpt_ProductionByDate.MdiParent = Me
            ofrmRpt_ProductionByDate.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByDate.ShowInTaskbar = False
            ofrmRpt_ProductionByDate.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByDate.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByMonth_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByMonth.Click
        Try
            Dim ofrmRpt_ProductionByMonth As New gloReports.frmRpt_ProductionByMonth(GetConnectionString())
            ofrmRpt_ProductionByMonth.MdiParent = Me
            ofrmRpt_ProductionByMonth.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByMonth.ShowInTaskbar = False
            ofrmRpt_ProductionByMonth.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByMonth.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByProcedureGroup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByProcedureGroup.Click
        Try
            Dim ofrmRpt_ProductionByProcedureGroup As New gloReports.frmRpt_ProductionByProcedureGroup(GetConnectionString())
            ofrmRpt_ProductionByProcedureGroup.MdiParent = Me
            ofrmRpt_ProductionByProcedureGroup.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByProcedureGroup.ShowInTaskbar = False
            ofrmRpt_ProductionByProcedureGroup.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByProcedureGroup.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByProcedureCode_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByProcedureCode.Click
        Try
            Dim ofrmRpt_ProductionByProcedureCode As New gloReports.frmRpt_ProductionByProcedureCode(GetConnectionString())
            ofrmRpt_ProductionByProcedureCode.MdiParent = Me
            ofrmRpt_ProductionByProcedureCode.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByProcedureCode.ShowInTaskbar = False
            ofrmRpt_ProductionByProcedureCode.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByProcedureCode.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByInsuranceCarrier_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByInsuranceCarrier.Click
        Try
            Dim ofrmRpt_ProductionByInsuranceCarrier As New gloReports.frmRpt_ProductionByInsuranceCarrier(GetConnectionString())
            ofrmRpt_ProductionByInsuranceCarrier.MdiParent = Me
            ofrmRpt_ProductionByInsuranceCarrier.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByInsuranceCarrier.ShowInTaskbar = False
            ofrmRpt_ProductionByInsuranceCarrier.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByInsuranceCarrier.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByFacilityByPatientDetail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByFacilityByPatientDetail.Click
        Try
            Dim ofrmRpt_ProductionByFacilityByPatient_Details As New gloReports.frmRpt_ProductionByFacilityByPatient_Details(GetConnectionString())
            ofrmRpt_ProductionByFacilityByPatient_Details.MdiParent = Me
            ofrmRpt_ProductionByFacilityByPatient_Details.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByFacilityByPatient_Details.ShowInTaskbar = False
            ofrmRpt_ProductionByFacilityByPatient_Details.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByFacilityByPatient_Details.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionByFacilityByPatient_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByFacilityByPatient.Click
        Try
            Dim ofrmRpt_ProductionByFacilityByPatient As New gloReports.frmRpt_ProductionByFacilityByPatient(GetConnectionString())
            ofrmRpt_ProductionByFacilityByPatient.MdiParent = Me
            ofrmRpt_ProductionByFacilityByPatient.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByFacilityByPatient.ShowInTaskbar = False
            ofrmRpt_ProductionByFacilityByPatient.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByFacilityByPatient.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ReimbursementByMonth_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ReimbursementByMonth.Click
        Try
            Dim ofrmRpt_ReimbursementByMonth As New gloReports.frmRpt_ReimbursementByMonth(GetConnectionString())
            ofrmRpt_ReimbursementByMonth.MdiParent = Me
            ofrmRpt_ReimbursementByMonth.WindowState = FormWindowState.Maximized
            ofrmRpt_ReimbursementByMonth.ShowInTaskbar = False
            ofrmRpt_ReimbursementByMonth.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ReimbursementByMonth.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ReimbursementByMonthDetail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ReimbursementByMonthDetail.Click
        Try
            Dim ofrmRpt_ReimbursementByMonthByAccount As New gloReports.frmRpt_ReimbursementByMonthByAccount(GetConnectionString())
            ofrmRpt_ReimbursementByMonthByAccount.MdiParent = Me
            ofrmRpt_ReimbursementByMonthByAccount.WindowState = FormWindowState.Maximized
            ofrmRpt_ReimbursementByMonthByAccount.ShowInTaskbar = False
            ofrmRpt_ReimbursementByMonthByAccount.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ReimbursementByMonthByAccount.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ReimbursementByInsuranceCarrier_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ReimbursementByInsuranceCarrier.Click
        Try
            Dim ofrmRptReimbursementByInsuranceCarrier As New gloReports.frmRptReimbursementByInsuranceCarrier(GetConnectionString())
            ofrmRptReimbursementByInsuranceCarrier.MdiParent = Me
            ofrmRptReimbursementByInsuranceCarrier.WindowState = FormWindowState.Maximized
            ofrmRptReimbursementByInsuranceCarrier.ShowInTaskbar = False
            ofrmRptReimbursementByInsuranceCarrier.StartPosition = FormStartPosition.CenterParent
            ofrmRptReimbursementByInsuranceCarrier.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ReimbursementByInsuranceByCPT_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ReimbursementByInsuranceByCPT.Click
        Try
            Dim ofrmRpt_ReimbursementByCarrierByCPT As New gloReports.frmRpt_ReimbursementByCarrierByCPT(GetConnectionString())
            ofrmRpt_ReimbursementByCarrierByCPT.MdiParent = Me
            ofrmRpt_ReimbursementByCarrierByCPT.WindowState = FormWindowState.Maximized
            ofrmRpt_ReimbursementByCarrierByCPT.ShowInTaskbar = False
            ofrmRpt_ReimbursementByCarrierByCPT.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ReimbursementByCarrierByCPT.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ReimbursementByCPTByInsurance_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ReimbursementByCPTByInsurance.Click
        Try
            Dim ofrmRpt_ReimbursementByCPTByCarrier As New gloReports.frmRpt_ReimbursementByCPTByCarrier(GetConnectionString())
            ofrmRpt_ReimbursementByCPTByCarrier.MdiParent = Me
            ofrmRpt_ReimbursementByCPTByCarrier.WindowState = FormWindowState.Maximized
            ofrmRpt_ReimbursementByCPTByCarrier.ShowInTaskbar = False
            ofrmRpt_ReimbursementByCPTByCarrier.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ReimbursementByCPTByCarrier.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ReimbursementByDoctorByInsurance_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ReimbursementByDoctorByInsurance.Click
        Try
            Dim ofrmRpt_ReimbursementByDoctorByInsurance As New gloReports.frmRpt_ReimbursementByDoctorByInsurance(GetConnectionString())
            ofrmRpt_ReimbursementByDoctorByInsurance.MdiParent = Me
            ofrmRpt_ReimbursementByDoctorByInsurance.WindowState = FormWindowState.Maximized
            ofrmRpt_ReimbursementByDoctorByInsurance.ShowInTaskbar = False
            ofrmRpt_ReimbursementByDoctorByInsurance.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ReimbursementByDoctorByInsurance.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ReimbursementByInsuranceForCPT_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ReimbursementByInsuranceForCPT.Click
        Try
            Dim ofrmRpt_ReimbursementByInsuranceForParticularCPT As New gloReports.frmRpt_ReimbursementByInsuranceForParticularCPT(GetConnectionString())
            ofrmRpt_ReimbursementByInsuranceForParticularCPT.MdiParent = Me
            ofrmRpt_ReimbursementByInsuranceForParticularCPT.WindowState = FormWindowState.Maximized
            ofrmRpt_ReimbursementByInsuranceForParticularCPT.ShowInTaskbar = False
            ofrmRpt_ReimbursementByInsuranceForParticularCPT.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ReimbursementByInsuranceForParticularCPT.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ReimbursementDetailsByAccount_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ReimbursementDetailsByAccount.Click
        Try
            Dim ofrmRpt_ReimbursementDetailByAccount As New gloReports.frmRpt_ReimbursementDetailByAccount(GetConnectionString())
            ofrmRpt_ReimbursementDetailByAccount.MdiParent = Me
            ofrmRpt_ReimbursementDetailByAccount.WindowState = FormWindowState.Maximized
            ofrmRpt_ReimbursementDetailByAccount.ShowInTaskbar = False
            ofrmRpt_ReimbursementDetailByAccount.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ReimbursementDetailByAccount.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_AgingAnalysis_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_AgingAnalysis.Click
        Try
            Dim ofrmRpt_AgingAnalysis As New gloReports.frmRpt_AgingAnalysis(GetConnectionString())
            ofrmRpt_AgingAnalysis.MdiParent = Me
            ofrmRpt_AgingAnalysis.WindowState = FormWindowState.Maximized
            ofrmRpt_AgingAnalysis.ShowInTaskbar = False
            ofrmRpt_AgingAnalysis.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_AgingAnalysis.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_AgingSummaryByPatient_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_AgingSummaryByPatient.Click
        Try
            Dim ofrmRpt_AgingSummaryByPatient As New gloReports.frmRpt_AgingSummaryByPatient(GetConnectionString(), gnPatientID)
            ofrmRpt_AgingSummaryByPatient.MdiParent = Me
            ofrmRpt_AgingSummaryByPatient.WindowState = FormWindowState.Maximized
            ofrmRpt_AgingSummaryByPatient.ShowInTaskbar = False
            ofrmRpt_AgingSummaryByPatient.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_AgingSummaryByPatient.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_AgingSummaryByInsuranceCarrier_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_AgingSummaryByInsuranceCarrier.Click
        Dim ofrmRpt_AgingSummaryByInsuranceCarrier As New gloReports.frmRpt_AgingSummaryByInsuranceCarrier(GetConnectionString())
        ofrmRpt_AgingSummaryByInsuranceCarrier.MdiParent = Me
        ofrmRpt_AgingSummaryByInsuranceCarrier.WindowState = FormWindowState.Maximized
        ofrmRpt_AgingSummaryByInsuranceCarrier.ShowInTaskbar = False
        ofrmRpt_AgingSummaryByInsuranceCarrier.StartPosition = FormStartPosition.CenterParent
        ofrmRpt_AgingSummaryByInsuranceCarrier.Show()
        ShowHideMainMenu(False, False)
    End Sub

    Private Sub mnu_MISReports_ProductionByPhysicianGroup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionByPhysicianGroup.Click
        Try
            Dim ofrmRpt_ProductionByPhysicianGroup As New gloReports.frmRpt_ProductionByPhysicianGroup(GetConnectionString())
            ofrmRpt_ProductionByPhysicianGroup.MdiParent = Me
            ofrmRpt_ProductionByPhysicianGroup.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionByPhysicianGroup.ShowInTaskbar = False
            ofrmRpt_ProductionByPhysicianGroup.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionByPhysicianGroup.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionAnalysisByFacility_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionAnalysisByFacility.Click
        Try
            Dim ofrmRpt_ProductionAnalysisByFacility As New gloReports.frmRpt_ProductionAnalysisByFacility(GetConnectionString())
            ofrmRpt_ProductionAnalysisByFacility.MdiParent = Me
            ofrmRpt_ProductionAnalysisByFacility.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionAnalysisByFacility.ShowInTaskbar = False
            ofrmRpt_ProductionAnalysisByFacility.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionAnalysisByFacility.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionAnalysisByprocedureGroup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionAnalysisByprocedureGroup.Click
        Try
            Dim ofrmRpt_ProductionAnalysisByProcedureGroup As New gloReports.frmRpt_ProductionAnalysisByProcedureGroup(GetConnectionString())
            ofrmRpt_ProductionAnalysisByProcedureGroup.MdiParent = Me
            ofrmRpt_ProductionAnalysisByProcedureGroup.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionAnalysisByProcedureGroup.ShowInTaskbar = False
            ofrmRpt_ProductionAnalysisByProcedureGroup.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionAnalysisByProcedureGroup.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionAnalysisandTrendsByMonth_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionAnalysisandTrendsByMonth.Click
        Try
            Dim ofrmRpt_ProductionAnalysisAndTrendsByMonth As New gloReports.frmRpt_ProductionAnalysisAndTrendsByMonth(GetConnectionString())
            ofrmRpt_ProductionAnalysisAndTrendsByMonth.MdiParent = Me
            ofrmRpt_ProductionAnalysisAndTrendsByMonth.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionAnalysisAndTrendsByMonth.ShowInTaskbar = False
            ofrmRpt_ProductionAnalysisAndTrendsByMonth.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionAnalysisAndTrendsByMonth.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub

    Private Sub mnu_MISReports_ProductionTrendsByProcedureGrop_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_MISReports_ProductionTrendsByProcedureGrop.Click
        Try
            Dim ofrmRpt_ProductionTrendsByProcedureGroup As New gloReports.frmRpt_ProductionTrendsByProcedureGroup(GetConnectionString())
            ofrmRpt_ProductionTrendsByProcedureGroup.MdiParent = Me
            ofrmRpt_ProductionTrendsByProcedureGroup.WindowState = FormWindowState.Maximized
            ofrmRpt_ProductionTrendsByProcedureGroup.ShowInTaskbar = False
            ofrmRpt_ProductionTrendsByProcedureGroup.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_ProductionTrendsByProcedureGroup.Show()
            ShowHideMainMenu(False, False)
        Catch ex As Exception
        End Try
    End Sub
#End Region

#Region "EMR Reports"

    Private Sub PatientInformationReportToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim ofrmRpt_PatientInfo As New gloEMRReports.frmRpt_PatientInfo(GetConnectionString())
            ofrmRpt_PatientInfo.MdiParent = Me
            ofrmRpt_PatientInfo.WindowState = FormWindowState.Maximized
            ofrmRpt_PatientInfo.ShowInTaskbar = False
            ofrmRpt_PatientInfo.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_PatientInfo.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            pnlMainToolBar.Visible = True
        End Try
    End Sub

    Private Sub PatientAgeReportToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim ofrmRpt_PatientAge As New gloEMRReports.frmRpt_PatientAge(GetConnectionString())
            ofrmRpt_PatientAge.MdiParent = Me
            ofrmRpt_PatientAge.WindowState = FormWindowState.Maximized
            ofrmRpt_PatientAge.ShowInTaskbar = False
            ofrmRpt_PatientAge.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_PatientAge.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            pnlMainToolBar.Visible = True
        End Try
    End Sub

    Private Sub MedicationReportToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim ofrmRpt_Medication As New gloEMRReports.frmRpt_Medication(GetConnectionString())
            ofrmRpt_Medication.MdiParent = Me
            ofrmRpt_Medication.WindowState = FormWindowState.Maximized
            ofrmRpt_Medication.ShowInTaskbar = False
            ofrmRpt_Medication.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_Medication.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            pnlMainToolBar.Visible = True
        End Try
    End Sub

    Private Sub RecentVisitReportToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            Dim ofrmRpt_RecentVisit As New gloEMRReports.frmRpt_RecentVisit(GetConnectionString())
            ofrmRpt_RecentVisit.MdiParent = Me
            ofrmRpt_RecentVisit.WindowState = FormWindowState.Maximized
            ofrmRpt_RecentVisit.ShowInTaskbar = False
            ofrmRpt_RecentVisit.StartPosition = FormStartPosition.CenterParent
            ofrmRpt_RecentVisit.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            pnlMainToolBar.Visible = True
        End Try
    End Sub
#End Region

    Private Function GetExamfinishedStatus(ByVal nExamID As Long) As String
        Dim oDB As New gloStream.gloDataBase.gloDataBase
        'Dim strSQL As String
        Dim PatCode As String
        oDB.Connect(GetConnectionString)
        PatCode = oDB.ExecuteQueryScaler("")
        oDB.Disconnect()
        oDB.Dispose()
        oDB = Nothing
        Return PatCode
    End Function

    Private Sub tlbbtn_NewExam_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tlbbtn_NewExam.Click
    End Sub

    Private Sub Label1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Label1.Click
    End Sub

    Private Sub oPatientListControl_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles oPatientListControl.Load
        oPatientListControl.ChkIsAccess = True
    End Sub

    Private Sub mnuView_Triage1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuView_Triage1.Click
        Try
            If gnPatientID > 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If
                If gblnProviderDisable = True Then
                    If ShowAssociateProvider(gnPatientID, Me) = True Then
                        '07-Nov-14 Aniket: Resolving Bug #75239 ( Modified): gloEMR: Triage- Application gives exception

                        If IsNothing(Me.ParentForm) Then
                            Me.oPatientListControl.FillPatients()
                        Else
                            CType(Me.ParentForm, MainMenu).oPatientListControl.FillPatients()
                        End If

                    End If
                End If

                'To check exception related to word
                If CheckWordForException() = False Then
                    Exit Sub
                End If
                'End

                Dim oTriage As New gloStream.gloEMR.Triage.clsTriage
                Dim dtTemplate As DataTable  ''slr new not needed 
                dtTemplate = oTriage.FillTemplates()
                If (IsNothing(dtTemplate)) Then
                    MessageBox.Show("No Template is associated for Triage. Please associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    If Not IsNothing(oTriage) Then  ''slr free otriage
                        oTriage = Nothing
                    End If

                    dtTemplate = Nothing
                    Exit Sub
                End If

                If (dtTemplate.Rows.Count <= 0) Then
                    MessageBox.Show("No Template is associated for Triage. Please associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    If Not IsNothing(oTriage) Then  ''slr free otriage
                        oTriage = Nothing
                    End If
                    If Not IsNothing(dtTemplate) Then ''slr free dtTemplate
                        dtTemplate.Dispose()
                    End If
                    dtTemplate = Nothing
                    Exit Sub
                End If


                Dim frm As frmTriage

                frm = frmTriage.GetInstance(0, gnPatientID)
                'AddHandler frm.EvntGenerateCDAFromTriage, AddressOf openCDA
                If IsNothing(frm) = True Then
                    Exit Sub
                End If


                frm.MdiParent = Me
                frm.WindowState = FormWindowState.Maximized
                frm.Show()

                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

                If Not IsNothing(oTriage) Then  ''slr free otriage
                    oTriage = Nothing
                End If
                If Not IsNothing(dtTemplate) Then ''slr free dtTemplate
                    dtTemplate.Dispose()
                End If
                dtTemplate = Nothing

            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            ShowHideMainMenu(True, True)
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ZipToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ZipToolStripMenuItem.Click
        'Add the Zip View Form
        Try
            Dim frm As New frmVWZip


            frm.MdiParent = Me

            frm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frm.WindowState = FormWindowState.Maximized
            frm.BringToFront()
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuTableTemplate_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuTableTemplate.Click
        'code added by dipak 20090827 to show Table Template form
        Try
            Dim ofrm As New frmMSTTableTemplate
            ofrm.ShowDialog(IIf(IsNothing(ofrm.Parent), Me, ofrm.Parent))
            ofrm.Dispose()
            ofrm = Nothing
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuVitalNorms_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuVitalNorms.Click
        'code added by dipak 20090827 to show VitalNorms Form
        Try
            Dim oFrm As New frmVitalNorms()
            oFrm.ShowDialog(IIf(IsNothing(oFrm.Parent), Me, oFrm.Parent))
            oFrm.Dispose()
            oFrm = Nothing
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Error on Opening Vital Norm - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub
    'Added Code Changes for OBVital Comments
    Private Sub mnuOBVital_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuOBVital.Click
        Try
            If gnPatientID <> 0 Then

                If IsAccess(False) = False Then
                    Exit Sub
                End If

                Dim frm As frmOBVitalComments_View
                frm = frmOBVitalComments_View.GetInstance(gnPatientID)
                If IsNothing(frm) = True Then
                    Exit Sub


                End If

                With frm
                    .MdiParent = Me
                    .ShowInTaskbar = False
                    .StartPosition = FormStartPosition.CenterParent
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False

                End With
            Else

                If oPatientListControl.PatientCount > 0 Then

                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub mnuTools_PrescriptionProviderAssociation_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuTools_PrescriptionProviderAssociation.Click
        Dim frmRx As New frmRxProviderAssociation(gnPatientID)
        frmRx.ShowDialog(IIf(IsNothing(frmRx.Parent), Me, frmRx.Parent))
        ''slr free frmRX
        If Not IsNothing(frmRx) Then
            frmRx.Dispose()
            frmRx = Nothing
        End If
    End Sub

    Private Sub mnu_ClosedJournals_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_ClosedJournals.Click
        Try
            Dim frm As gloBilling.frmBillingClosedJournals
            frm = gloBilling.frmBillingClosedJournals.GetInstance(GetConnectionString(), gnLoginID, gstrLoginName)
            If IsNothing(frm) = False Then

                frm.MdiParent = Me
                frm.Show()
                ShowHideMainMenu(False, False)
                frm.WindowState = FormWindowState.Maximized
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuRights_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuRights.Click
    End Sub

    Private Sub tsbtn_Appointments_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles tsbtn_Appointments.Click
    End Sub

    Private Sub sslbl_MessagePriority_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles sslbl_MessagePriority.Click
        Try
            'Form High Priority Message Click, We have to show 'Received Messages to login user'
            mnuView_PatientMessages(False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuWindow_DropDownItemClicked(ByVal sender As Object, ByVal e As System.Windows.Forms.ToolStripItemClickedEventArgs) Handles mnuWindow.DropDownItemClicked
        Try
            If DirectCast(DirectCast(e.ClickedItem, System.Windows.Forms.ToolStripItem), System.Windows.Forms.ToolStripMenuItem).Checked = True Then

                Dim oFrm As Object
                oFrm = Me.ActiveMdiChild
                If oFrm.Name = "frmHistory" Then
                    If IsNothing(DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Parent) = False Then

                        If DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Parent.Text = "Split Screen" Then
                            DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Parent.Visible = True
                        Else
                            If DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Text = "Split Screen" Then
                                DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Visible = True
                            End If
                        End If
                    End If
                ElseIf oFrm.Name = "frmPatientLetter" Then
                    If IsNothing(DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent) = False Then

                        If DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent.Text = "Split Screen" Then
                            DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent.Visible = True
                        Else
                            If DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Text = "Split Screen" Then
                                DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Visible = True
                            End If
                        End If
                    End If
                ElseIf oFrm.Name = "frmPatientExam" Then
                    If IsNothing(DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Parent) = False Then

                        If DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Parent.Text = "Split Screen" Then
                            DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Parent.Visible = True
                        Else
                            If DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Text = "Split Screen" Then
                                DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Visible = True
                            End If
                        End If
                    End If
                ElseIf oFrm.Name = "frmMessages" Then
                    If IsNothing(DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Parent) = False Then

                        If DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Parent.Text = "Split Screen" Then
                            DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Parent.Visible = True
                        Else

                            If DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Text = "Split Screen" Then
                                DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Visible = True
                            End If
                        End If
                    End If
                ElseIf oFrm.Name = "frmPrescription" Then
                    If IsNothing(DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Parent) = False Then

                        If DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Parent.Text = "Split Screen" Then
                            DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Parent.Visible = True
                        Else

                            If DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Text = "Split Screen" Then
                                DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Visible = True
                            End If
                        End If
                    End If
                End If

                'If oFrm.Name = "frmHistory" Then
                '    oFrm.uiPanSplitScreen.Parent.Visible = True
                'ElseIf oFrm.Name = "frmPatientLetter" Then
                '    oFrm.uiPanSplitScreen_PatientLetters.Parent.Visible = True
                'End If
                'If Not IsNothing(Me.ActiveMdiChild) Then
                '    For Each _control As Control In Me.ActiveMdiChild.Controls
                '        If _control.Name = "uiPanSplitScreen" Then
                '            _control.Visible = True

                '        End If

                '    Next
                '   End If

                Dim ActiveMdiChild_PatientID As Int64 = 0
                Try
                    If (IsNothing(oFrm) = False) Then
                        If TypeOf oFrm Is IPatientContext Then
                            ActiveMdiChild_PatientID = oFrm.GetCurrentPatientID
                        ElseIf oFrm.Name = "frmViewgloLab" Then
                            ActiveMdiChild_PatientID = oFrm.GetCurrentPatientID
                        ElseIf oFrm.Name = "frmEDocEvent_ReceivedFax" Then
                            ActiveMdiChild_PatientID = oFrm.GetCurrentPatientID
                        End If
                    End If
                Catch ex As Exception
                    ActiveMdiChild_PatientID = 0
                    gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
                End Try
                If (ActiveMdiChild_PatientID > 0) Then
                    If (gnPatientID <> ActiveMdiChild_PatientID) Then
                        gnPatientID = ActiveMdiChild_PatientID
                    End If
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
        Finally
            ofrm = Nothing
        End Try
        Try
            pnlMainToolBar.Visible = False
            ShowHideMainMenu(False, False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Add Patient Education for Visit specific
    Private Sub mnuPatientEducation_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientEducation.Click
        OpenPatient_Education()
    End Sub

    Private Sub OpenPatient_Education()
        Try

            If gnPatientID <= 0 Then
                '''''This IF statement is added by Anil on 31/10/2007,This message will appear if patients are there in the grid i.e., if grid is not blank
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                    Exit Sub
                End If
                Exit Sub
            End If

            If IsAccess(False, gnPatientID) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            If CheckWordForException() = False Then
                Exit Sub
            End If


            Dim dtPtEducation As DataTable  ''slr new not needed 
            objWord = New clsWordDocument
            dtPtEducation = objWord.FillTemplates(enumTemplateFlag.PatientEducation)
            If IsNothing(dtPtEducation) OrElse dtPtEducation.Rows.Count = 0 Then
                ''''If not present then exit from sub
                MessageBox.Show("No template is associated for patient education. Associate any template first", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                If Not IsNothing(dtPtEducation) Then ''slr free dtPtEducation
                    dtPtEducation.Dispose()
                End If
                dtPtEducation = Nothing
                objWord = Nothing   ''slr free objWord
                Exit Sub
            Else
                If (dtPtEducation.Rows.Count > 0) Then

                    gnVisitID = GenerateVisitID(gnPatientID)

                    Dim ofrmPatientEducation As New frmPatientEducation(gnVisitID, gnPatientID, 0)
                    AddHandler ofrmPatientEducation.FormClosed, AddressOf On_PatientEducation_Closed
                    'Developer: Yatin N.Bhagat
                    'Date:12/26/2011
                    'Bug ID/PRD Name/Salesforce Case:Bug No. 17474:Exam >> If patient education form is open at back side, then access on exam form is getting block.
                    'Reason: Unwanted Flag(FormOpen_Info)
                    'frmPatientEducation.Formopen_Info = True


                    ofrmPatientEducation.WindowState = FormWindowState.Normal
                    ofrmPatientEducation.StartPosition = FormStartPosition.CenterScreen
                    ofrmPatientEducation.MdiParent = Me

                    ofrmPatientEducation.Text = "Patient Education"
                    ofrmPatientEducation.WindowState = FormWindowState.Maximized
                    ofrmPatientEducation.BringToFront()
                    ofrmPatientEducation.Show()
                    ShowHideMainMenu(False, False)
                    pnlMainToolBar.Visible = False
                End If
            End If
            dtPtEducation.Dispose()
            dtPtEducation = Nothing
            objWord = Nothing
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            ShowHideMainMenu(True, True)
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub On_PatientEducation_Closed(ByVal sender As Object, ByVal e As FormClosedEventArgs)

        Dim ofrmPatientEducation As frmPatientEducation = Nothing
        Try
            ofrmPatientEducation = DirectCast(sender, frmPatientEducation)
        Catch ex As Exception

        End Try

        Try
            If (IsNothing(ofrmPatientEducation) = False) Then
                RemoveHandler ofrmPatientEducation.FormClosed, AddressOf On_PatientEducation_Closed
            End If

        Catch ex As Exception

        End Try

        Try
            If (IsNothing(ofrmPatientEducation) = False) Then
                ofrmPatientEducation.Close()
            End If

        Catch ex As Exception

        End Try
        Try
            If (IsNothing(ofrmPatientEducation) = False) Then
                ofrmPatientEducation.Dispose()
                ofrmPatientEducation = Nothing
            End If
        Catch ex As Exception

        End Try

    End Sub
    Dim iCount As Int64 = 0
    Dim UniformSize As Boolean = False
    Private Sub btnPC_PrintCards_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPC_PrintCards.Click
        Dim ogloPatient As New gloPatient.gloPatient(GetConnectionString)
        UniformSize = ogloPatient.readCardPrintSetting()
        Try

            If Not (oPatientCards Is Nothing) Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If
                If oPatientCards.Count > 0 Then
                    If oPatientCards.Count = 1 Then
                        oPatientCards.Clear()
                        oPatientCards = ogloPatient.GetPatientCards(gnPatientID)
                    End If
                    If gloGlobal.gloTSPrint.isCopyPrint Then

                        Dim dictImages As Dictionary(Of [String], [Byte]()) = ogloPatient.PrintToBitmapsWithDPi(8.5F, 11.0F, 600, 600, oPatientCards)
                       
                        Dim fileName As String = gloGlobal.clsFileExtensions.NewDocumentName(gloGlobal.gloTSPrint.TempPath, ".zip", "MMddyyyyHHmmssffff")
                        Dim lstDocs As New List(Of gloPrintDialog.gloPrintProgressController.DocumentInfo)()
                        Dim ZipedFiles As List(Of String) = gloGlobal.gloTSPrint.ZipAllBytes(dictImages, fileName, gloGlobal.gloTSPrint.NoOfPages)
                        For i As Integer = 0 To ZipedFiles.Count - 1
                            Dim DocInfo As New gloPrintDialog.gloPrintProgressController.DocumentInfo()
                            DocInfo.PdfFileName = ZipedFiles(i)
                            DocInfo.SrcFileName = ZipedFiles(i)
                            DocInfo.footerInfo = Nothing
                            lstDocs.Add(DocInfo)
                        Next
                        gloPrintDialog.gloPrintProgressController.SendForPrint(lstDocs, True)
                    Else
                        If gblnUseDefaultPrinter Then
                            'Bug #79213: 00000851:While Printing Scandocs from Demograhpics and Printer is set to default then all documents do not print.
                            iCount = 0
                            printDoc.Print()
                        Else
                            If PrintDialog1.ShowDialog(System.Windows.Forms.Form.ActiveForm) = DialogResult.OK Then
                                printDoc.PrinterSettings = PrintDialog1.PrinterSettings
                                iCount = 0
                                printDoc.Print()
                            End If
                        End If
                    End If

                    
                End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            'Object Disposed By Mitesh
            If Not IsNothing(ogloPatient) Then
                ogloPatient.Dispose()
                ogloPatient = Nothing
            End If
        End Try
    End Sub

    'Private Sub SendForPrint(lstDocs As List(Of gloPrintDialog.gloPrintProgressController.DocumentInfo))
    '    Dim ogloPrintProgressController As gloPrintDialog.gloPrintProgressController = Nothing

    '    Try
    '        Dim extendedPrinterSettings As New gloPrintDialog.gloExtendedPrinterSettings()
    '        extendedPrinterSettings.IsShowProgress = False
    '        extendedPrinterSettings.IsBackGroundPrint = True
    '        ogloPrintProgressController = New gloPrintDialog.gloPrintProgressController(lstDocs, Nothing, extendedPrinterSettings, blnUseEMFForSSRS:=True)
    '        ogloPrintProgressController.ShowProgress(Nothing)
    '    Catch ex As Exception
    '        MessageBox.Show(ex.Message, gloGlobal.gloTSPrint.getMessageCaption(), MessageBoxButtons.OK, MessageBoxIcon.[Error])
    '        ex = Nothing

    '    Finally
    '    End Try
    'End Sub

    Private Sub printDoc_PrintPage(ByVal sender As System.Object, ByVal e As System.Drawing.Printing.PrintPageEventArgs) Handles printDoc.PrintPage
        Try
            Dim cardHeight As Double
            Dim cardWidth As Double

            Dim exitfor As Boolean = False
            Dim MyBounds As Rectangle = e.MarginBounds

            Dim MySize As New Size(e.Graphics.DpiX, e.Graphics.DpiY)

            Dim MarginRect As New Rectangle(2, 2, 108, 72)
            'Changed margin width to increase card size
            If UniformSize Then
                MarginRect.Width = 57
            End If

            MarginRect.Y = MarginRect.Y * MySize.Height / 72
            MarginRect.X = MarginRect.X * MySize.Width / 72
            MarginRect.Height = MarginRect.Height * MySize.Height / 72
            MarginRect.Width = MarginRect.Width * MySize.Width / 72

            MyBounds.Y = MyBounds.Y + MarginRect.Top
            MyBounds.X = MyBounds.X + MarginRect.Left
            MyBounds.Height = MyBounds.Height * MySize.Height / 72 - (2 * MarginRect.Height)
            MyBounds.Width = MyBounds.Width * MySize.Width / 72 - (2 * MarginRect.Width)
            Dim _NewHorzDivision As Integer = 0
            Dim _NewVertDivision As Integer = 0
            If (UniformSize) Then
                _NewHorzDivision = (MyBounds.Width - MarginRect.X) / 2
                _NewVertDivision = (MyBounds.Height - (3 * MarginRect.Y)) / 4
            End If
            Dim y As Int64 = MyBounds.Top

            If Not (oPatientCards Is Nothing) Then
                Dim jCount As Integer = -1
                For i As Int64 = iCount To oPatientCards.Count - 1
                    If oPatientCards(i).CardImage IsNot Nothing Then
                        jCount += 1
                        Dim thisImage As System.Drawing.Image = oPatientCards(i).CardImage
                        Dim thisImageBound As RectangleF = thisImage.GetBounds(e.Graphics.PageUnit)

                        cardHeight = thisImageBound.Height * MySize.Height / thisImage.VerticalResolution
                        cardWidth = thisImageBound.Width * MySize.Width / thisImage.HorizontalResolution
                        Dim x_Page As Int64 = MyBounds.X
                        Dim y_addition As Int64 = _NewVertDivision

                        If (UniformSize) Then
                            Dim ScaleX As Double = _NewHorzDivision / cardWidth
                            Dim ScaleY As Double = _NewVertDivision / cardHeight
                            If (ScaleX > ScaleY) Then
                                cardHeight = _NewVertDivision
                                cardWidth = cardWidth * ScaleY
                            Else
                                cardWidth = _NewHorzDivision
                                cardHeight = cardHeight * ScaleX
                            End If
                            If ((jCount Mod 2) = 1) Then
                                x_Page += MarginRect.X + _NewHorzDivision
                            Else
                                y_addition = -MarginRect.Top
                            End If

                        Else
                            If (cardWidth > MyBounds.Width) Or (cardHeight > MyBounds.Height) Then
                                Dim ScaleX As Double = MyBounds.Width / cardWidth
                                Dim ScaleY As Double = MyBounds.Height / cardHeight
                                If (ScaleX > ScaleY) Then
                                    cardHeight = MyBounds.Height
                                    cardWidth = cardWidth * ScaleY
                                Else
                                    cardWidth = MyBounds.Width
                                    cardHeight = cardHeight * ScaleX
                                End If
                            End If
                            y_addition = cardHeight
                        End If
                        If (((cardHeight + y) >= MyBounds.Bottom) OrElse (jCount = 8)) Then
                            If (y = MyBounds.Top) Then
                            Else
                                e.HasMorePages = True
                                iCount = i
                                exitfor = True
                                Exit For
                            End If

                        End If

                        e.Graphics.DrawImage(thisImage, x_Page, y, Convert.ToInt64(cardWidth), Convert.ToInt64(cardHeight))
                        y += y_addition + MarginRect.Top
                    End If
                Next

            End If
            If (exitfor = False) Then
                e.HasMorePages = False
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
        End Try
    End Sub

    'Private Function PrintToBitmaps(ByVal pageWidth As Double, ByVal pageHeight As Double, ByVal DpiX As Double, ByVal DpiY As Double) As Dictionary(Of [String], [Byte]())
    '    Dim myList As Dictionary(Of [String], [Byte]()) = New Dictionary(Of [String], [Byte]())
    '    Try
    '        Dim cardHeight As Double
    '        Dim cardWidth As Double

    '        Dim exitfor As Boolean = False
    '        Dim MyBounds As Rectangle = New Rectangle(0, 0, Convert.ToInt32(pageWidth * DpiX), Convert.ToInt32(pageHeight * DpiY))

    '        Dim MySize As New Size(DpiX, DpiY)

    '        Dim MarginRect As New Rectangle(2, 2, 108, 72)

    '        MarginRect.Y = MarginRect.Y * MySize.Height / 72
    '        MarginRect.X = MarginRect.X * MySize.Width / 72
    '        MarginRect.Height = MarginRect.Height * MySize.Height / 72
    '        MarginRect.Width = MarginRect.Width * MySize.Width / 72

    '        Dim NewTop As Integer = MarginRect.Top
    '        Dim NewHeight As Integer = MyBounds.Height - (2 * MarginRect.Height)
    '        Dim NewLeft As Integer = MarginRect.Left
    '        Dim NewWidth As Integer = MyBounds.Width - (2 * MarginRect.Width)
    '        Dim hasMorePages As Boolean = True
    '        Dim iCount As Integer = 0
    '        Dim pCount As Integer = 0
    '        Do While hasMorePages
    '            exitfor = False
    '            Dim NewBitmap As Bitmap = New Bitmap(MyBounds.Width, MyBounds.Height)
    '            NewBitmap.SetResolution(DpiX, DpiY)
    '            Dim NewGraphics As Graphics = Graphics.FromImage(NewBitmap)

    '            Dim y As Int64 = NewTop

    '            If Not (oPatientCards Is Nothing) Then
    '                For i As Int64 = iCount To oPatientCards.Count - 1
    '                    If oPatientCards(i).CardImage IsNot Nothing Then
    '                        Dim thisImage As System.Drawing.Image = oPatientCards(i).CardImage
    '                        Dim thisImageBound As RectangleF = thisImage.GetBounds(NewGraphics.PageUnit)

    '                        cardHeight = thisImageBound.Height * MySize.Height / thisImage.VerticalResolution
    '                        cardWidth = thisImageBound.Width * MySize.Width / thisImage.HorizontalResolution

    '                        If (cardWidth > NewWidth) Or (cardHeight > NewHeight) Then
    '                            Dim ScaleX As Double = NewWidth / cardWidth
    '                            Dim ScaleY As Double = NewHeight / cardHeight
    '                            If (ScaleX > ScaleY) Then
    '                                cardHeight = NewHeight
    '                                cardWidth = cardWidth * ScaleY
    '                            Else
    '                                cardWidth = NewWidth
    '                                cardHeight = cardHeight * ScaleX
    '                            End If
    '                        End If

    '                        If ((cardHeight + y) >= NewHeight) Then
    '                            If (y = NewTop) Then
    '                            Else
    '                                hasMorePages = True
    '                                iCount = i
    '                                exitfor = True
    '                                Exit For
    '                            End If

    '                        End If

    '                        NewGraphics.DrawImage(thisImage, NewLeft, y, Convert.ToInt64(cardWidth), Convert.ToInt64(cardHeight))
    '                        y += cardHeight + NewTop
    '                    End If
    '                Next

    '            End If
    '            If (exitfor = False) Then
    '                hasMorePages = False
    '            End If
    '            pCount += 1
    '            Dim ms As New MemoryStream()
    '            NewBitmap.Save(ms, System.Drawing.Imaging.ImageFormat.Png)
    '            myList.Add((pCount).ToString(), ms.ToArray())

    '            If (IsNothing(NewGraphics) = False) Then
    '                NewGraphics.Dispose()
    '                NewGraphics = Nothing
    '            End If
    '            If (IsNothing(NewBitmap) = False) Then
    '                NewBitmap.Dispose()
    '                NewBitmap = Nothing
    '            End If
    '        Loop

    '    Catch ex As Exception
    '        gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
    '    End Try
    '    Return myList
    'End Function

    Private Sub GloUC_TransactionHistory1_On_SearchCriteria_Changed() Handles GloUC_TransactionHistory1.On_SearchCriteria_Changed
        _SeachFlag = True
    End Sub

    Private Sub ts_PatientDetails_MouseEnter(sender As Object, e As System.EventArgs) Handles ts_PatientDetails.MouseEnter
        If gblnSecurityUser = False Then  ''added for bugid 78617
            If Not IsNothing(cmnuToolStripCustomize) Then
                cmnuToolStripCustomize.Tag = "ts_PatientDetails"
            End If
        End If
    End Sub

    '' SUDHIR 20100120 '' TO SET BACKGROUND IMAGE FOR OVERFLOWED PANEL ''
    Private Sub ts_PatientDetails_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles ts_PatientDetails.Paint
        Try
            Dim _ToolStrip As ToolStrip = CType(sender, ToolStrip)
            Dim _e As New ToolStripItemRenderEventArgs(e.Graphics, _ToolStrip.Items(_ToolStrip.Items.Count - 1))
            If _OverFlowToolStripPainted = False OrElse _e.ToolStrip.BackgroundImage Is Nothing Then
                _OverFlowToolStripPainted = True
                _e.ToolStrip.BackgroundImage = Global.gloEMR.My.Resources.Resources.Img_ToolStrip_Small
            End If
        Catch ex As Exception
        End Try
    End Sub

    Private Sub pnlPatientDetail_MouseDoubleClick(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles pnlPatientDetail.MouseDoubleClick
        SecurityUserSettings()
    End Sub

    Private Sub pnlNav_UnfinishedExam_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Try
            ShowUnfinishedExams()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnurpt_PatientICD9CPT_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnurpt_PatientICD9CPT.Click
        Try
            Dim frm As frmRpt_PatientICD9CPT
            frm = frmRpt_PatientICD9CPT.GetInstance()
            If IsNothing(frm) = True Then
                Exit Sub
            End If

            With frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
        End Try
    End Sub

    ''' <summary>
    ''' Dhruv 
    ''' To set it to the applicationsetting 
    ''' the field name is the 'Location'
    ''' </summary>
    ''' <remarks></remarks>
    Public Sub SetSettingUsingAppSetting()
        Dim appSettngs As System.Collections.Specialized.NameValueCollection = System.Configuration.ConfigurationManager.AppSettings()
        Dim i As Integer
        Dim oLocation As gloAppointmentBook.Books.Location = New gloAppointmentBook.Books.Location()
        Dim dt As DataTable = Nothing ''slr new not needed
        Try
            dt = oLocation.GetDefaultLocation()
            If Not IsNothing(dt) Then
                For i = 0 To dt.Rows.Count - 1
                    appSettngs("DefaultLocationID") = dt.Rows(i)("nLocationID")
                    appSettngs("DefaultLocation") = dt.Rows(i)("sLocation")

                    gloLocationLog("Location ID = " & dt.Rows(i)("nLocationID").ToString)
                    gloLocationLog("Location Name = " & dt.Rows(i)("sLocation").ToString)

                Next
            End If
        Catch ex As Exception
            '11-Nov-14 Aniket: Handling Bug #75621: gloEMR:Getting random exception while logging to EMR
            'MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

            appSettngs = Nothing

            i = Nothing

            If Not IsNothing(dt) Then
                dt.Dispose()
                dt = Nothing
            End If
            If Not IsNothing(oLocation) Then
                oLocation.Dispose()
                oLocation = Nothing
            End If
        End Try
    End Sub

    Public Shared Sub gloLocationLog(ByVal strLogMessage As [String])
        Dim objFile As StreamWriter = Nothing
        Dim strgloServerLogPath As String = String.Empty
        Try
            strgloServerLogPath = System.Windows.Forms.Application.StartupPath + "\Location"
            If CreateFolder(strgloServerLogPath) Then
            End If
            objFile = New StreamWriter(strgloServerLogPath & "\Location.log", True)
            objFile.WriteLine(System.DateTime.Now.ToString() & System.DateTime.Now.Millisecond.ToString() & ": " & Convert.ToString(strLogMessage))

            objFile.Close()

        Catch generatedExceptionName As Exception
        Finally
            objFile.Dispose()  ''slr dispose  
            objFile = Nothing
        End Try
    End Sub

    Public Shared Function CreateFolder(ByVal strPath As String) As Boolean
        Dim success As Boolean = False
        Try
            If Not Directory.Exists(strPath) Then
                Directory.CreateDirectory(strPath)
                success = Directory.Exists(strPath)
            Else
                success = True
            End If

        Catch generatedExceptionName As System.AccessViolationException

        Catch generatedExceptionName As System.ArgumentException

        Catch generatedExceptionName As System.Exception
        End Try
        Return success
    End Function



    Private Sub C1Appointments_RowColChange(ByVal sender As Object, ByVal e As System.EventArgs) Handles C1Appointments.RowColChange
        Try
            If C1Appointments.Cols.Count <> col_Count Then
                Exit Sub
            End If

            If C1Appointments.Col >= col_color0 AndAlso C1Appointments.Col <= col_color5 Then
                C1Appointments.Col = col_PatientName
            End If

            If C1Appointments.Row >= 1 Then

                If (CType(C1Appointments.GetData(C1Appointments.Row, col_AppPatientID), Int64) <> gnPatientID AndAlso CType(C1Appointments.GetData(C1Appointments.Row, col_AppPatientID), Int64) <> 0) Then
                    If (pnlPatientList.Visible) Then
                        gnPatientID = CType(C1Appointments.GetData(C1Appointments.Row, col_AppPatientID), Int64)
                        oPatientListControl.SelectPatient(gnPatientID)
                    End If
                End If
                C1Appointments.Row = C1Appointments.Row
                Try
                    _IsFromAppointment = True
                    'Call FillMenus()
                    'C1Appointments.ContextMenuStrip = cMnuPatient
                    If C1Appointments.Row >= 1 Then
                        If (CType(C1Appointments.GetData(C1Appointments.Row, col_AppDate), Date) = Date.Today) Then
                            Dim _appointmentID As Int64 = CType(C1Appointments.GetData(C1Appointments.Row, col_AppId), Int64)
                            FillCheckInCheckOutMenu(_appointmentID)
                        End If
                    End If
                Catch ex As Exception
                    MessageBox.Show(ex.ToString)
                End Try
            Else
                ClearContextMenuStrip(oPatientListControl.ContextMenuStrip)

                ClearContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip)

                ClearContextMenuStrip(C1Appointments.ContextMenuStrip)

                ClearContextMenuStrip(pnlRightFill.ContextMenuStrip)

                ClearContextMenuStrip(pnlLeft.ContextMenuStrip)

                ClearContextMenuStrip(cMnuPatient)

                'Try
                '    If (IsNothing(C1Appointments.ContextMenuStrip) = False) Then
                '        C1Appointments.ContextMenuStrip.Dispose()
                '        C1Appointments.ContextMenuStrip = Nothing
                '    End If
                'Catch ex As Exception

                'End Try

                'Try
                '    If (IsNothing(C1Appointments.ContextMenuStrip) = False) Then
                '        C1Appointments.ContextMenuStrip.Dispose()
                '        C1Appointments.ContextMenuStrip = Nothing
                '    End If
                'Catch ex As Exception

                'End Try
                'C1Appointments.ContextMenuStrip = Nothing
                'cMnuPatient.Hide()

                AssignContextMenuStrip(oPatientListControl.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(C1Appointments.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(pnlRightFill.ContextMenuStrip, cMnuPatient)

                AssignContextMenuStrip(pnlLeft.ContextMenuStrip, cMnuPatient)

            End If
        Catch ex As Exception
        End Try
    End Sub

    Private Sub btnModifyPatientAlert_MouseHover(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnModifyPatientAlert.MouseHover
        btnModifyPatientAlert.BackgroundImage = Global.gloEMR.My.Resources.Img_LongOrange
        btnModifyPatientAlert.BackgroundImageLayout = ImageLayout.Stretch
    End Sub

    Private Sub btnModifyPatientAlert_MouseLeave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnModifyPatientAlert.MouseLeave
        btnModifyPatientAlert.BackgroundImage = Global.gloEMR.My.Resources.Img_Button
        btnModifyPatientAlert.BackgroundImageLayout = ImageLayout.Stretch
    End Sub

    Private Sub btnClosePatientAlert_MouseHover(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnClosePatientAlert.MouseHover
        btnClosePatientAlert.BackgroundImage = Global.gloEMR.My.Resources.Img_LongOrange
        btnClosePatientAlert.BackgroundImageLayout = ImageLayout.Stretch
    End Sub

    Private Sub btnClosePatientAlert_MouseLeave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnClosePatientAlert.MouseLeave
        btnClosePatientAlert.BackgroundImage = Global.gloEMR.My.Resources.Img_Button
        btnClosePatientAlert.BackgroundImageLayout = ImageLayout.Stretch
    End Sub

    Private Sub C1Mesages_AfterScroll(ByVal sender As System.Object, ByVal e As C1.Win.C1FlexGrid.RangeEventArgs) Handles C1Mesages.AfterScroll
        If (e.NewRange.BottomRow = C1Mesages.Rows.Count - 1) AndAlso e.NewRange.BottomRow <> -1 AndAlso _isMessageFullyLoaded = False Then
            C1Mesages.SuspendLayout()
            Dim _ScrollPosition As Point
            _ScrollPosition = C1Mesages.ScrollPosition
            nRowCount = nRowCount + nRowCount
            ShowMessages_New()

            C1Mesages.ResumeLayout()
        End If
    End Sub

    Private Sub mnuReportICD9Rx_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuReportICD9Rx.Click
        Try
            ShowSSRSReport("rptPatientList", "Patient List", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ''Added on 20100506-DM Report
    Private Sub mnuReportClinicalDecision_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuReportClinicalDecision.Click
        Try
            Dim ofrmShowReport As New gloEMRReports.frmReports(GetConnectionString(), "dm")
            ofrmShowReport.MdiParent = Me
            ofrmShowReport.WindowState = FormWindowState.Maximized
            ofrmShowReport.ShowInTaskbar = False
            ofrmShowReport.StartPosition = FormStartPosition.CenterParent
            ofrmShowReport.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuReportBPMeasurement_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuReportBPMeasurement.Click
        Try
            Dim ofrmShowReport As New gloEMRReports.frmReports(GetConnectionString(), "bp")
            ofrmShowReport.MdiParent = Me
            ofrmShowReport.ICD10Transition = gblnIcd10Transition ''property added for ICD9,10 filter bugid 67217
            ofrmShowReport.WindowState = FormWindowState.Maximized
            ofrmShowReport.ShowInTaskbar = False
            ofrmShowReport.StartPosition = FormStartPosition.CenterParent
            ofrmShowReport.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuReportPatientHistory_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuReportPatientHistory.Click
        Try
            Dim ofrmShowReport As New gloEMRReports.frmReports(GetConnectionString(), "history")
            ofrmShowReport.MdiParent = Me
            ofrmShowReport.WindowState = FormWindowState.Maximized
            ofrmShowReport.ShowInTaskbar = False
            ofrmShowReport.StartPosition = FormStartPosition.CenterParent
            ofrmShowReport.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPatientRxReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientRxReport.Click
        Try
            ShowSSRSReport("rptPatientPrescriptions", "Patient Prescriptions", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        'Try
        '    Dim ofrmShowReport As New gloEMRReports.frmReports(GetConnectionString(), "rx")
        '    ofrmShowReport.MdiParent = Me
        '    ofrmShowReport.WindowState = FormWindowState.Maximized
        '    ofrmShowReport.ShowInTaskbar = False
        '    ofrmShowReport.StartPosition = FormStartPosition.CenterParent
        '    ofrmShowReport.Show()
        '    pnlMainToolBar.Visible = False
        '    ShowHideMainMenu(False, False)
        'Catch objErr As Exception
        '    pnlMainToolBar.Visible = True
        '    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'End Try
    End Sub

    Private Sub mnuPatientBMIReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientBMIReport.Click
        Try
            Dim ofrmShowReport As New gloEMRReports.frmReports(GetConnectionString(), "bmi")
            ofrmShowReport.MdiParent = Me
            ofrmShowReport.WindowState = FormWindowState.Maximized
            ofrmShowReport.ShowInTaskbar = False
            ofrmShowReport.StartPosition = FormStartPosition.CenterParent
            ofrmShowReport.Show()
            pnlMainToolBar.Visible = False
            ShowHideMainMenu(False, False)
        Catch objErr As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Developer:Mitesh Patel
    'Date:04 May 2012 
    'Problem # 100 
    Public Sub openCCD(ByVal PatientID As Int64)
        'Code Start - Added by sanjog on 20100707 for CCD
        Try
            'Developer:Mitesh Patel
            'Date:24 May 2012 
            'Bug # 26421 
            'Dim frmlab As frmViewgloLab
            'frmlab = frmViewgloLab.GetInstance()
            'If IsNothing(frmlab) = False Then
            '    If IsNothing(frmlab.LabPatientID) = False Then
            '        If frmlab.LabPatientID <> 0 Then
            '            SelectPatientOnDashboard(frmlab.LabPatientID)
            '        End If
            '    End If
            'End If
            Dim objfrm As New frmCCDGenerateList(gnPatientID)
            objfrm.ChkResults.Checked = True

            With objfrm
                .WindowState = FormWindowState.Normal
                .BringToFront()
                .StartPosition = FormStartPosition.CenterParent
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With
            'SLR: Dispose
            If Not IsNothing(objfrm) Then
                objfrm.Dispose()
                objfrm = Nothing
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub OpenPlanofTreatment(ByVal PatientID As Int64, ByVal CallingForm As String, Optional ByVal oNode As TreeNode = Nothing, Optional ByVal TestType As String = "", Optional ByVal SearchString As String = "")
        Dim oPlanOfTreatment As frmTreatmentPlan

        If Not IsNothing(oNode) Then
            oPlanOfTreatment = New frmTreatmentPlan(PatientID, CallingForm, oNode, TestType, SearchString)
        Else
            oPlanOfTreatment = New frmTreatmentPlan(PatientID, CallingForm)
        End If

        oPlanOfTreatment.ShowInTaskbar = False
        oPlanOfTreatment.ShowDialog(Me)
    End Sub

    'Public Sub OpenPlanofTreatment(ByVal PatientID As Int64, ByVal CallingForm As String)
    '    Dim oPlanOfTreatment As New frmTreatmentPlan(PatientID, CallingForm)
    '    oPlanOfTreatment.ShowInTaskbar = False
    '    oPlanOfTreatment.ShowDialog(Me)
    'End Sub

    ''Added on 20140613-To add clinical chart button on orders and results screen
    Public Sub OpenClinicalChart(ByVal PatientID As Int64)
        Try
            Dim ofrmCC As frmClinicalChart = New frmClinicalChart(gnPatientID)
            'AddHandler ofrmCC.EvntGenerateCDAFromClinicalChart, AddressOf openCDA
            ofrmCC.Visible = False
            ofrmCC.ShowInTaskbar = False
            ofrmCC.StartPosition = FormStartPosition.CenterScreen
            ofrmCC.WindowState = FormWindowState.Maximized
            AddHandler ofrmCC.EvnMsgQueue, AddressOf EnableThreadQueue
            AddHandler ofrmCC.EvnMsgQueueforPrint, AddressOf EnableThreadQueueForPrint
            ofrmCC.ShowDialog(IIf(IsNothing(ofrmCC.Parent), Me, ofrmCC.Parent))
            ofrmCC.Dispose()
            ofrmCC = Nothing
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.ClinicalChart, gloAuditTrail.ActivityType.Open, "Error while opening clinical charts.", gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub
    Private Function GetClinicalChartQueueData(QueueID As Long, Optional ByVal isForPrint As Boolean = False) As DataSet

        Dim connMain As New SqlConnection
        Dim dsMain As DataSet
        Dim cmd As SqlCommand
        Dim da As SqlDataAdapter
        Dim strCmd As String
        If isForPrint = True Then
            strCmd = "gsp_GetClinicalChartQueueData_ForPrint"
        Else
            strCmd = "gsp_GetClinicalChartQueueData"
        End If

        connMain.ConnectionString = GetConnectionString()

        cmd = New SqlCommand(strCmd, connMain)
        cmd.CommandType = CommandType.StoredProcedure
        cmd.Parameters.AddWithValue("@QueueID", QueueID)


        da = New SqlDataAdapter
        da.SelectCommand = cmd
        dsMain = New DataSet

        Try

            connMain.Open()
            da.Fill(dsMain)
            connMain.Close()

            dsMain.Tables(0).TableName = "ClinicalChartQueueMst"
            dsMain.Tables(1).TableName = "ClinicalChartQueueDetails"
            dsMain.Tables(2).TableName = "ClinicalChartQueueNotes"
            dsMain.Tables(3).TableName = "ExportSettings"
            dsMain.Tables(4).TableName = "ClinicDetails"
            If (dsMain.Tables.Count > 5) Then
                dsMain.Tables(5).TableName = "ClinicalChartDetails"
            End If
            If isForPrint = True Then
                If dsMain.Tables(3).Rows.Count = 0 Then
                    dsMain.Tables(3).Rows.Add()
                End If
                dsMain.Tables(3).Rows(0)("ExportPath") = gloSettings.FolderSettings.AppTempFolderPath
            End If

            

        Catch ex As Exception

        Finally

            If IsNothing(cmd) = False Then
                cmd.Parameters.Clear()
                cmd.Dispose()
                cmd = Nothing
            End If

            If IsNothing(da) = False Then
                da.Dispose()
                da = Nothing
            End If



            If IsNothing(connMain) = False Then
                connMain.Dispose()
                connMain = Nothing
            End If


        End Try

        Return dsMain

    End Function


    Private Function GenerateClinicalChartFileName(dsMain As DataSet, RowPointer As Integer, Optional ByVal IsQueueName As Boolean = False, Optional ByVal BackGroundProcessType As gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue) As String

        Dim strFileName As String = ""
        Dim strSiteID As String = ""
        Dim strQueueNo As String = ""
        Dim strFileType As String = ""
        Dim strFilePath As String = "" 'dsMain.Tables("ExportSettings").Rows(0)("ExportPath")
        Dim _dtCurrentDateTime As DateTime = System.DateTime.Now
        Dim intCount As Integer = 0

        Try
            If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then
                strFilePath = dsMain.Tables("ExportSettings").Rows(0)("ExportPath")
            Else
                strFilePath = gloSettings.FolderSettings.AppTempFolderPath
            End If

            If IsNothing(dsMain.Tables("ClinicalChartQueueMST")) = False AndAlso dsMain.Tables("ClinicalChartQueueMST").Rows.Count > 0 AndAlso IsDBNull(dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nQueueNo")) = False Then
                strQueueNo = dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nQueueNo")
            Else
                strQueueNo = "QueueNo"
            End If

            If IsNothing(dsMain.Tables("ClinicDetails")) = False AndAlso dsMain.Tables("ClinicDetails").Rows.Count > 0 AndAlso IsDBNull(dsMain.Tables("ClinicDetails").Rows(0)("SiteID")) = False Then
                strSiteID = dsMain.Tables("ClinicDetails").Rows(0)("SiteID")
            Else
                strSiteID = "SiteID"
            End If

            If IsQueueName = False Then
                If IsNothing(dsMain.Tables("ClinicalChartQueueDetails")) = False AndAlso dsMain.Tables("ClinicalChartQueueDetails").Rows.Count > 0 AndAlso IsDBNull(dsMain.Tables("ClinicalChartQueueDetails").Rows(RowPointer)("sEnum")) = False Then
                    strFileType = dsMain.Tables("ClinicalChartQueueDetails").Rows(RowPointer)("sEnum")
                Else
                    strFileType = "ClinicalChart"
                End If
            End If

            If IsQueueName Then
                strFileName = strSiteID & strQueueNo & Format(_dtCurrentDateTime, "_MMddyyyy_hhmmsstt") & _dtCurrentDateTime.Millisecond & ".xml"
                dsMain.Tables("ClinicalChartQueueMst").Rows(RowPointer)("QueueName") = strFileName
            Else
                strFileName = strSiteID & strQueueNo & strFileType & Format(_dtCurrentDateTime, "_MMddyyyy_hhmmsstt") & _dtCurrentDateTime.Millisecond '& ".pdfPartial"
                While File.Exists(strFilePath & "\" & strFileName) = True
                    intCount = intCount + 1
                    strFileName = strSiteID & strQueueNo & strFileType & Format(_dtCurrentDateTime, "_MMddyyyy_hhmmsstt") & _dtCurrentDateTime.Millisecond & intCount '& ".pdfPartial"
                End While

                dsMain.Tables("ClinicalChartQueueDetails").Rows(RowPointer)("PhysicalFileName") = strFileName & ".pdf"
                If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then
                    strFileName = strFileName & ".pdfPartial"
                Else
                    strFileName = strFileName & ".pdf"
                End If

            End If

        Catch extr As ThreadAbortException
            Thread.ResetAbort()

        Catch ex As Exception
            If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then
                strFileName = System.Guid.NewGuid.ToString & ".pdfPartial"
            Else
                strFileName = System.Guid.NewGuid.ToString & ".pdf"
            End If
        End Try

        Return strFilePath & "\" & strFileName

    End Function

    Public Function ChangePDFExtension(PDFFileName As String, NEWExtension As String) As String

        Dim strFileName As String = ""

        Try
            strFileName = Path.ChangeExtension(PDFFileName, NEWExtension)
            Rename(PDFFileName, strFileName)

            Return strFileName

        Catch ex As Exception
            Throw ex

        End Try

    End Function
    Public Function GetPatientInformation(ByVal nPatinetId As Int64, ByVal strConnection As String) As DataTable

        Dim oDbLayer As New gloDatabaseLayer.DBLayer(GetConnectionString())

        Try

            oDbLayer.Connect(False)
            Dim oPatientDataTable As DataTable = Nothing

            oDbLayer.Retrive_Query("SELECT dbo.GET_NAME(Patient.sFirstName, Patient.sMiddleName, Patient.sLastName) As 'Patient Name',Convert(Datetime,Patient.dtDOB,101)As DOB, datediff(yy,Patient.dtDOB,dbo.gloGetDate()) AS 'Age',Patient.sGender As Gender,  Clinic_MST.sClinicName 'Practice Name' FROM Clinic_MST INNER JOIN Patient ON Clinic_MST.nClinicID = Patient.nClinicID Where Patient.nPatientId=" + nPatinetId.ToString(), oPatientDataTable)

            Return oPatientDataTable

        Catch ex As Exception
            Return Nothing

        Finally

            If Not IsNothing(oDbLayer) Then
                oDbLayer.Disconnect()
                oDbLayer.Dispose()
            End If

        End Try

    End Function

    Private Sub SaveDMSFile(FilePath As String)

        If (IO.File.Exists(FilePath)) Then
            Dim dmsDoc1 As pdftron.PDF.PDFDoc = New pdftron.PDF.PDFDoc(FilePath)

            dmsDoc1.InitSecurityHandler()
            dmsDoc1.PageCreate()
            dmsDoc1.Save(FilePath, 0)
            dmsDoc1.Close()
            dmsDoc1.Dispose()
            dmsDoc1 = Nothing
        Else
            Throw New FileNotFoundException
        End If

    End Sub

    'Dim blnquethrdaborted As Boolean = False
    Private Function ExportClinicalChartsToFolder(QueueID As Long, Optional ByVal isForPrint As Boolean = False, Optional ByVal BackGroundProcessType As gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue) As DataSet

        Dim dtFax As DataTable = Nothing
        Dim strMedicationID As String = ""
        'Dim in_DocBlank As pdftron.PDF.PDFDoc = Nothing
        Dim oCurDoc1 As Wd.Document = Nothing
        Dim dsMain As DataSet = Nothing
        Dim myLoadWord As gloWord.LoadAndCloseWord = New gloWord.LoadAndCloseWord()
        Dim notestype As Integer = 2
        Dim strModuleName As String
        Dim nAssociContactID As Int64 = 0
        Dim strPDFFilePath As String = String.Empty
        Dim MergeFaxFilePath As String = String.Empty
        Dim intFullFilePageCount As Integer = 0
        Dim intDMSFilePageCount As Integer = 0
        Dim OrderIDList As String = Nothing
        Dim claimNoteID As ClaimNoteIDs = Nothing
        Dim ClaimDataType As Int16 = 0
        Dim nFooterStart As Integer = 1
        Dim FooterIndex As ArrayList = New ArrayList()

        Dim QDocumentStore_UserName As String = ""
        Dim QDocumentStore_Password As String = ""
        Dim QDocumentStore_Domain As String = ""
        Dim admin_token As IntPtr
        Dim wid_current As WindowsIdentity = WindowsIdentity.GetCurrent()
        Dim wid_admin As WindowsIdentity = Nothing
        Dim wic As WindowsImpersonationContext = Nothing

        Try

            If IsNothing(strClinicalChartErrorNotes) = True Then
                strClinicalChartErrorNotes = New StringBuilder
            Else
                strClinicalChartErrorNotes.Clear()
                strClinicalChartErrorNotes = Nothing
                strClinicalChartErrorNotes = New StringBuilder
            End If



            dsMain = GetClinicalChartQueueData(QueueID, isForPrint)
            dsMain.Tables("ClinicalChartQueueMst").Columns.Add("QueueName", System.Type.GetType("System.String"))
            dsMain.Tables("ClinicalChartQueueDetails").Columns.Add("PhysicalFileName", System.Type.GetType("System.String"))
            dsMain.Tables("ClinicalChartQueueDetails").Columns.Add("footr_StartingPage", System.Type.GetType("System.Int32"))
            dsMain.Tables("ClinicalChartQueueDetails").Columns.Add("footr_TotalPage", System.Type.GetType("System.Int32"))

            If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.FAX OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Print OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Export) Then

                strPDFFilePath = gloSettings.FolderSettings.AppTempFolderPath & System.Guid.NewGuid.ToString() & ".pdf" 'gloGlobal.clsFileExtensions.NewDocumentName(gloSettings.FolderSettings.AppTempFolderPath, ".pdf", "MMddyyyyHHmmssffff") 'GenerateClinicalChartFileName(dsMain, 0, , BackGroundProcessType)
                MergeFaxFilePath = gloSettings.FolderSettings.AppTempFolderPath & System.Guid.NewGuid.ToString() & ".pdf" ' gloGlobal.clsFileExtensions.NewDocumentName(gloSettings.FolderSettings.AppTempFolderPath, ".pdf", "MMddyyyyHHmmssffff") 'GenerateClinicalChartFileName(dsMain, 1, , BackGroundProcessType) 



            End If

            Try
                If (dsMain.Tables("ClinicalChartQueueNotes").Rows.Count > 0) Then
                    nAssociContactID = Convert.ToInt64(dsMain.Tables("ClinicalChartQueueNotes").Rows(0)("nAssociatedContactID"))
                End If
            Catch ex As Exception

            End Try
            Try

                '17-Aug-2016 Aniket: Export Path not required for FAX, Export or Local Print
                If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then

                    If dsMain.Tables("ExportSettings").Rows(0)("ExportPath") = "" OrElse IsNothing(dsMain.Tables("ExportSettings")) = True OrElse dsMain.Tables("ExportSettings").Rows.Count = 0 OrElse IsDBNull(dsMain.Tables("ExportSettings").Rows(0)("ExportPath")) = True Then
                        strClinicalChartErrorNotes.AppendLine("Clinical Documents Export Path is not set in gloEMR Admin. Files cannot be exported.")
                        notestype = 5
                        Return Nothing
                    End If
                End If
            Catch ex As Exception
                strClinicalChartErrorNotes.AppendLine("Clinical Documents Export Path is not set in gloEMR Admin.")
            End Try
            ''dsMain.Tables("ExportSettings").Rows(0)("ExportPath") = "C:\gloData\Queue"
            'dsMain.Tables("ClinicalChartQueueMst").Columns.Add("QueueName", System.Type.GetType("System.String"))
            ''dsMain.Tables("ClinicalChartQueueMst").Columns.Add("FootersEnabled", System.Type.GetType("System.Boolean"))
            'dsMain.Tables("ClinicalChartQueueDetails").Columns.Add("PhysicalFileName", System.Type.GetType("System.String"))
            ''dsMain.Tables("ClinicalChartQueueDetails").Columns.Add("IncludeFooter", System.Type.GetType("System.Boolean"))



            strClinicalChartErrorNotes.AppendLine("Following files are not processed:")

            For intCount As Int64 = 0 To dsMain.Tables("ClinicalChartQueueDetails").Rows.Count - 1 ' C1ClinicalChart.Rows.Count - 1

                strModuleName = ""

                Try

                    strModuleName = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sEnum")  'C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), 4).ToString()

                    'Medications
                    If (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.CurrentMedication.ToString) Then 'Medications
                        Try
                            Dim strParameter As String
                            Dim blnSqlAuthentication As String
                            '  Dim strPDFFilePath As String = ""

                            If (strMedicationID.Trim() = "") Then
                                strMedicationID = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I")
                            Else
                                strMedicationID = strMedicationID & "~" & dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I")
                            End If


                            If dsMain.Tables("ClinicalChartQueueDetails").Rows.Count - 1 > intCount Then
                                If dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount + 1)("sEnum") = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.CurrentMedication.ToString Then
                                    Continue For
                                End If
                            End If


                            strParameter = dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nPatientID").ToString & "," & dsMain.Tables("ClinicalChartQueueMST").Rows(0)("dtStartDate").ToShortDateString() & "," & dsMain.Tables("ClinicalChartQueueMST").Rows(0)("dtEndDate").ToShortDateString() & "," & strMedicationID
                            If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then
                                strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount)
                            End If
                            blnSqlAuthentication = appSettings("WindowAuthentication")

                            If blnSqlAuthentication = True Then
                                blnSqlAuthentication = False
                            Else
                                blnSqlAuthentication = True
                            End If


                            Dim ocls As New gloSSRSApplication.clsSSRSRender(gstrSQLServerName, gstrDatabaseName, blnSqlAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR)

                            ocls.SSRSGeneratePDF("rptMedicalChart", "PatientID,sFromDate,sToDate,MedicationID", strParameter, strPDFFilePath) ' "398297737939314001,01/01/2010,12/31/2010,4018495897290401~4018495897290402"


                            strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")
                            SaveDMSFile(strPDFFilePath)
                            If (IO.File.Exists(strPDFFilePath) = False) Then
                                Throw New FileNotFoundException
                            End If

                            AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType)



                            ocls = Nothing

                            'dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = False
                            'dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = False

                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                        End Try
                        'End If



                        'Patient Information
                    ElseIf (strModuleName = "Patient Information") Then

                        Try
                            If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then
                                strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount) 'ExamNewDocumentName.ToString.Replace(".docx", ".pdf")
                            End If
                            strPDFFilePath = GenratePatientInfoPDF(dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nPatientID"), strPDFFilePath)

                            strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")
                            If (IO.File.Exists(strPDFFilePath) = False) Then
                                Throw New FileNotFoundException
                            End If
                            AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType)
                            '  dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = True
                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine("Patient Information")
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                        End Try

                        'Exam
                    ElseIf (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientExam.ToString) Then 'Exam

                        Dim ObjWord As clsWordDocument = Nothing
                        Dim objCriteria As DocCriteria = Nothing
                        Dim nPastExamID As Long
                        Dim strFileName As String
                        Dim objPrintFAX As New clsPrintFAX()
                        '  Dim strPDFFilePath As String = ""
                        Dim strAllExamsDoc As String = ""

                        Try

                            nPastExamID = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I") 'C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), 0)

                            ObjWord = New clsWordDocument
                            objCriteria = New DocCriteria

                            If (IsNothing(ObjWord) = True) Then
                                Return Nothing
                            End If

                            If (IsNothing(objCriteria) = True) Then
                                Return Nothing
                            End If

                            objCriteria.DocCategory = enumDocCategory.Exam
                            objCriteria.PrimaryID = nPastExamID
                            ObjWord.DocumentCriteria = objCriteria
                            strFileName = ObjWord.RetrieveDocumentFile()
                            strAllExamsDoc = strFileName

                            If (IsNothing(strFileName) = False) Then
                                If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then

                                    strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount) 'ExamNewDocumentName.ToString.Replace(".docx", ".pdf")
                                End If
                                Try
                                    'mayuri
                                    'myLoadWord = Nothing
                                    oCurDoc1 = myLoadWord.LoadWordApplication(strAllExamsDoc)

                                Catch ex As Exception
                                    ' strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                                    notestype = 5
                                    gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                                    dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                                    'Return Nothing

                                End Try




                                If System.Convert.ToBoolean(System.Configuration.ConfigurationManager.AppSettings("USE_BUILDING_BLOCKS_IN_WORD_TEMPLATES")) Then
                                    objPrintFAX.InsertNamePageNo(oCurDoc1, objPrintFAX.GetPatientDetails(dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nPatientID")))
                                Else
                                    objPrintFAX.InsertPageFooterWithoutMSWBuildingBlock(oCurDoc1, objPrintFAX.GetPatientDetails(dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nPatientID")))
                                End If

                                objPrintFAX.Dispose()
                                objPrintFAX = Nothing
                                gloWord.LoadAndCloseWord.CleanupDoc(oCurDoc1)
                                'mayuri
                                ' oCurDoc1 = Nothing
                                oCurDoc1.Application.DisplayAlerts = Microsoft.Office.Interop.Word.WdAlertLevel.wdAlertsNone
                                oCurDoc1.SaveAs(strPDFFilePath, Wd.WdSaveFormat.wdFormatPDF, False, "", False)

                                myLoadWord.CloseWordOnly(oCurDoc1)

                                If (IO.File.Exists(strAllExamsDoc)) Then
                                    IO.File.Delete(strAllExamsDoc)
                                End If

                                strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")
                                SaveDMSFile(strPDFFilePath)
                                AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType)


                                'dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = False
                            End If

                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                        Finally
                            ObjWord = Nothing

                            If Not IsNothing(objCriteria) Then
                                objCriteria.Dispose()
                                objCriteria = Nothing
                            End If

                        End Try

                        'Orders
                    ElseIf (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Orders.ToString) AndAlso dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_II") <> "" Then 'Orders

                        Dim oLabOrderRequest As New gloEMRLabOrder
                        Dim OrderId As Long = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I") 'System.Convert.ToInt64(C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), 0))

                        Try

                            Dim OrderStatus As Int16 = oLabOrderRequest.GetOrderStatus(OrderId)

                            If OrderStatus = 1001 Then
                                If OrderIDList = "" Then
                                    OrderIDList = System.Convert.ToString(OrderId)
                                Else
                                    OrderIDList = OrderIDList + "," + System.Convert.ToString(OrderId)
                                End If


                            End If
                            Dim bnSqlAuthentication As Boolean = Not System.Convert.ToBoolean(appSettings("WindowAuthentication"))
                            If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then

                                strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount) 'ExamNewDocumentName.ToString.Replace(".docx", ".pdf")
                            End If
                            Dim ocls As New gloSSRSApplication.clsSSRSRender(gstrSQLServerName, gstrDatabaseName, bnSqlAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR)
                            'mayuri
                            'ocls = Nothing
                            ocls.SSRSGeneratePDF("LabOrderReport_SSRS", "OrderID,PatientID", System.Convert.ToString(OrderId) + "," & System.Convert.ToString(dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nPatientID")), strPDFFilePath)


                            ocls = Nothing

                            oLabOrderRequest.Dispose()
                            oLabOrderRequest = Nothing

                            strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")
                            SaveDMSFile(strPDFFilePath)
                            AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType)

                            '  dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = True

                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                        End Try




                        'DMS
                    ElseIf (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.ScannedDocument.ToString) Then 'DMS

                        Dim _DocID As Long = 0

                        Try
                            _DocID = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I") 'System.Convert.ToInt64(C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), 0))

                            Dim myDMSConnectionString As String = gloEDocumentV3.gloEDocV3Admin.GetDMSConnectionString(GetConnectionString())
                            Dim myDMSObj As gloEDocumentV3.eDocManager.eDocGetList = Nothing
                            Dim mySqlQuery As String = "Select Distinct eContainerID from eDocument_Container_V3 where eDocumentID = " + _DocID.ToString()
                            Dim myDataAdapter As New SqlClient.SqlDataAdapter(mySqlQuery, myDMSConnectionString)
                            Dim myDatatable As New DataTable
                            Dim myContainerID As Long
                            '   Dim strPDFFilePath As String = ""
                            Dim docDMSFile As pdftron.PDF.PDFDoc = Nothing
                            Dim docFullFile As pdftron.PDF.PDFDoc = Nothing
                            myDataAdapter.SelectCommand.CommandTimeout = 0
                            myDataAdapter.Fill(myDatatable)
                            myDataAdapter.Dispose()
                            myDataAdapter = Nothing

                            If Not IsNothing(myDatatable) Then
                                If (myDatatable.Rows.Count > 0) Then
                                    If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then

                                        strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount) 'ExamNewDocumentName.ToString.Replace(".docx", ".pdf")
                                    End If
                                    'mayuri
                                    ' myDatatable = Nothing
                                    For j As Integer = 0 To myDatatable.Rows.Count - 1
                                        myContainerID = myDatatable.Rows(j)(0)
                                        myDMSObj = New gloEDocumentV3.eDocManager.eDocGetList()
                                        myDMSObj.GetContainerStream(_DocID, myContainerID, 1, strPDFFilePath)

                                        myDMSObj.Dispose()
                                        myDMSObj = Nothing
                                    Next
                                Else
                                    mySqlQuery = "select FileFullPath from eDocument_Archive where eDocumentID = " + _DocID.ToString()

                                    Dim mySqlCon As SqlConnection = New SqlConnection(myDMSConnectionString)
                                    Dim mySqlCmd As SqlCommand = New SqlCommand(mySqlQuery, mySqlCon)

                                    mySqlCon.Open()
                                    Dim sFilePath As String = mySqlCmd.ExecuteScalar()
                                    mySqlCon.Close()

                                    mySqlCmd.Dispose()
                                    mySqlCmd = Nothing
                                    mySqlCon.Dispose()
                                    mySqlCon = Nothing

                                    If Not String.IsNullOrEmpty(sFilePath) Then
                                        Dim oBytes As Byte() = Nothing

                                        Try
                                            If String.IsNullOrEmpty(QDocumentStore_UserName) Or String.IsNullOrEmpty(QDocumentStore_Password) Or String.IsNullOrEmpty(QDocumentStore_Domain) Then
                                                Dim oSettings As gloSettings.GeneralSettings = New gloSettings.GeneralSettings(GetConnectionString())

                                                oSettings.GetSetting("QDocumentStore_UserName", QDocumentStore_UserName)
                                                oSettings.GetSetting("QDocumentStore_Password", QDocumentStore_Password)
                                                oSettings.GetSetting("QDocumentStore_Domain", QDocumentStore_Domain)

                                                oSettings.Dispose()
                                                oSettings = Nothing

                                                If Not String.IsNullOrEmpty(QDocumentStore_Password) Then
                                                    Dim oEncrypt As clsencryption = New clsencryption()

                                                    QDocumentStore_Password = oEncrypt.DecryptFromBase64String(QDocumentStore_Password, constEncryptDecryptKey)

                                                    oEncrypt.Dispose()
                                                    oEncrypt = Nothing
                                                End If
                                            End If

                                            If Not String.IsNullOrEmpty(QDocumentStore_UserName) And Not String.IsNullOrEmpty(QDocumentStore_Password) And Not String.IsNullOrEmpty(QDocumentStore_Domain) Then
                                                If LogonUser(QDocumentStore_UserName, QDocumentStore_Domain, QDocumentStore_Password, 2, 0, admin_token) <> 0 Then
                                                    wid_admin = New WindowsIdentity(admin_token)
                                                    wic = wid_admin.Impersonate()

                                                    If (File.Exists(sFilePath)) Then
                                                        oBytes = File.ReadAllBytes(sFilePath)
                                                    End If
                                                End If
                                            End If
                                        Catch ex As Exception
                                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                                            ex = Nothing
                                        Finally
                                            If wic IsNot Nothing Then
                                                wic.Undo()
                                            End If
                                        End Try

                                        If Not IsNothing(oBytes) AndAlso oBytes.Length > 0 Then
                                            File.WriteAllBytes(strPDFFilePath, oBytes)
                                            oBytes = Nothing
                                        End If
                                    End If

                                End If
                                myDatatable.Dispose()
                                myDatatable = Nothing
                            End If

                            strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")
                            If (IO.File.Exists(MergeFaxFilePath) = False) Then
                                docDMSFile = New pdftron.PDF.PDFDoc(strPDFFilePath)
                                docDMSFile.InitSecurityHandler()
                                If (intDMSFilePageCount <= 0) Then
                                    intDMSFilePageCount = docDMSFile.GetPageCount() + intFullFilePageCount
                                    intFullFilePageCount = 1
                                End If

                                If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then
                                    dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("footr_StartingPage") = nFooterStart
                                    nFooterStart = nFooterStart + docDMSFile.GetPageCount()
                                    FooterIndex.Add(intCount)
                                End If
                                docDMSFile.Close()
                            Else
                                docDMSFile = New pdftron.PDF.PDFDoc(strPDFFilePath)
                                docFullFile = New pdftron.PDF.PDFDoc(MergeFaxFilePath)

                                If (intFullFilePageCount <= 0) Then
                                    docFullFile.InitSecurityHandler()
                                    intFullFilePageCount = docFullFile.GetPageCount()
                                    intFullFilePageCount += 1
                                    docFullFile.Close()
                                End If

                                docDMSFile.InitSecurityHandler()
                                If (intDMSFilePageCount <= 0) Then
                                    intDMSFilePageCount = docDMSFile.GetPageCount() + (intFullFilePageCount - 1)
                                Else
                                    intDMSFilePageCount = docDMSFile.GetPageCount() + intDMSFilePageCount
                                End If
                                docDMSFile.Close()

                            End If

                            'Aniket New Code


                            AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType, True)




                            'If (IO.File.Exists(strPDFFilePath) = False) Then
                            '    Throw New FileNotFoundException
                            'End If
                            'dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = False
                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                        End Try

                        'ElseIf (strModuleName = "") Then

                        ' Done
                    ElseIf (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.ClaimDetails.ToString) Then 'Claim

                        Try

                            Dim TransactionId As Long = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I") 'System.Convert.ToInt64(C1ClinicalChart.GetData(System.Convert.ToInt32(intCount), COL_Seven))
                            Dim MasterTransactionID As Long = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_II") 'System.Convert.ToInt64(C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), 0).ToString())
                            Dim sClaimType As String = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_III") 'System.Convert.ToString(C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), COL_Five))
                            Dim bIsInstitutional As Boolean = False
                            '  Dim strPDFFilePath As String = String.Empty
                            Dim nContactID As Int64 = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_IV") 'System.Convert.ToInt64(C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), COL_Six))
                            Dim sClaimNumber As String = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_V") 'System.Convert.ToString(C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), COL_Category))
                            Dim _nQueueID As Long = dsMain.Tables("ClinicalChartQueueDetails").Rows(0)("nQueueID")
                            Dim strImageFileName As String = ""
                            If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then

                                strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount)
                            End If
                            If Boolean.TryParse(sClaimType, bIsInstitutional) Then
                                If bIsInstitutional Then
                                    Using objPrintUB As New gloCMSEDI.UB04(GetConnectionString())
                                        objPrintUB.FillUB04Form(TransactionId, MasterTransactionID)

                                        'Aniket: This is pending
                                        'With Claim Form
                                        'mayuri
                                        '  objPrintUB.Dispose()
                                        If dsMain.Tables("ClinicalChartQueueMST").Rows(0)("ClaimPrintType") = False Then
                                            strImageFileName = objPrintUB.Print(True, strPDFFilePath, isForPrint:=isForPrint)

                                        Else 'Only Claim Data
                                            strImageFileName = objPrintUB.Print(False, strPDFFilePath, GetQueuedPrinterName(_nQueueID, isForPrint), isForPrint:=isForPrint)
                                            ClaimDataType = 1
                                        End If

                                        'If rbPrintOnForm.Checked Then

                                        'ElseIf rbPrintData.Checked Then
                                        '    sFilePath = objPrintUB.Print(False)
                                        'End If

                                    End Using
                                Else
                                    Using objPrintClaim As New gloCMSEDI.HCFA1500New(GetConnectionString())
                                        objPrintClaim.PatientID = dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nPatientID")

                                        objPrintClaim.FillTransactionOnForm(TransactionId, MasterTransactionID)

                                        'With Claim Form
                                        'mayuri
                                        ' objPrintClaim.Dispose()
                                        If dsMain.Tables("ClinicalChartQueueMST").Rows(0)("ClaimPrintType") = False Then
                                            strImageFileName = objPrintClaim.Print(True, strPDFFilePath, isForPrint:=isForPrint)

                                        Else 'Only Claim Data
                                            strImageFileName = objPrintClaim.Print(False, strPDFFilePath, GetQueuedPrinterName(_nQueueID, isForPrint), isForPrint:=isForPrint)
                                            ClaimDataType = 2
                                        End If

                                        'Aniket: This is pending
                                        'If rbPrintOnForm.Checked Then
                                        'sFilePath = objPrintClaim.Print(True)
                                        'ElseIf rbPrintData.Checked Then
                                        '    sFilePath = objPrintClaim.Print(False)
                                        'End If

                                    End Using
                                End If
                            End If

                            If (IO.File.Exists(strImageFileName)) Then
                                Dim isPdf As Boolean = True
                                If isForPrint Then
                                    If ((gloGlobal.gloTSPrint.isCopyPrint AndAlso gloGlobal.gloTSPrint.UseEMFForClaims)) Then
                                        Dim strPDFFile As String = Path.GetFileName(strImageFileName)
                                        strPDFFilePath = gloGlobal.gloTSPrint.TempPath + strPDFFile
                                        File.Move(strImageFileName, strPDFFilePath)
                                        dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = strPDFFile
                                        isPdf = False
                                    End If
                                End If
                                If isPdf Then
                                    If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then

                                        strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount) 'ExamNewDocumentName.ToString.Replace(".docx", ".pdf")
                                    End If
                                    File.Copy(strImageFileName, strPDFFilePath, True)
                                    strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")

                                    If File.Exists(strImageFileName) Then
                                        File.Delete(strImageFileName)
                                    End If
                                End If



                                If (IO.File.Exists(strPDFFilePath) = False) Then
                                    Throw New FileNotFoundException
                                End If

                                claimNoteID = New ClaimNoteIDs()
                                With claimNoteID
                                    .MasterTransactionID = MasterTransactionID
                                    .ContactID = nContactID
                                    .ClaimID = sClaimNumber
                                End With

                                '' claimNoteID = Nothing
                            Else
                                Throw New FileNotFoundException
                            End If
                            AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType)
                            ' dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = True

                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                        End Try

                        'Done
                    ElseIf (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PaymentDetails.ToString) Then 'Claim Remittance
                        Try

                            Dim bnSqlAuthentication As Boolean = Not System.Convert.ToBoolean(appSettings("WindowAuthentication"))
                            Dim nCreditID As Int64 = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I") ' System.Convert.ToInt64(C1ClinicalChart.GetData(System.Convert.ToInt32(intCount), 0))
                            Dim nEOBID As Int64 = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_II") 'System.Convert.ToInt64(C1ClinicalChart.GetData(System.Convert.ToInt32(intCount), COL_Five))
                            If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then

                                strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount) 'ExamNewDocumentName.ToString.Replace(".docx", ".pdf")
                            End If
                            Dim ocls As New gloSSRSApplication.clsSSRSRender(gstrSQLServerName, gstrDatabaseName, bnSqlAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR)
                            'mayuri
                            '  ocls = Nothing
                            ocls.SSRSGeneratePDF("rptClaimRemittance", "nCreditID,nEOBID,nEOBType,UserName", System.Convert.ToString(nCreditID) + "," + System.Convert.ToString(nEOBID) + "," & 4 & "," + gloGlobal.gloPMGlobal.UserName, strPDFFilePath)
                            ocls = Nothing

                            strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")
                            SaveDMSFile(strPDFFilePath)
                            AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType)


                            'Aniket: Need to check the below code
                            'dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = False
                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                        End Try
                    ElseIf (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.ClaimHistory.ToString) Then 'View Claim History
                        Try
                            Dim bnSqlAuthentication As Boolean = Not System.Convert.ToBoolean(appSettings("WindowAuthentication"))

                            Dim TransactionId As Long = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I")
                            Dim MasterTransactionID As Long = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_II")
                            Dim strTempExamfilepath As String = ExamNewDocumentName.ToString.Replace(".docx", ".pdf")
                            Dim ocls As New gloSSRSApplication.clsSSRSRender(gstrSQLServerName, gstrDatabaseName, bnSqlAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR)
                            If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then
                                strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount)
                            End If
                            ocls.SSRSGeneratePDF("rptAgingClaimHistory", "nMasterTransactionID,nTransactionID,suser,nPatientID", System.Convert.ToString(MasterTransactionID) + "," + System.Convert.ToString(TransactionId) + "," + System.Convert.ToString(gstrLoginName) + "," & gnPatientID, strPDFFilePath)

                            ocls = Nothing


                            strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")
                            SaveDMSFile(strPDFFilePath)
                            AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType)

                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                        End Try
                        'Word Modules
                    ElseIf (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientForms.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.OrderTemplates.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.RefferalDocument.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Messages.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.NursesNotes.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Triage.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PTProtocol.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientConsent.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.DisclosureManagement.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientLetters.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.FormGallery.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Orders.ToString) Or (strModuleName.Contains(gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.OrdersTestResult.ToString) Or (strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Patient_Education.ToString)) Then


                        Dim oDB As DataBaseLayer = Nothing
                        Dim oParamater As DBParameter = Nothing
                        Dim dt As DataTable = Nothing
                        Dim strWordFileName As String
                        Dim nID As String
                        Dim rIndex As Integer = 0
                        Dim OrderID As Int64 = 0
                        Dim oLabOrderRequest As New gloEMRLabOrder

                        Try

                            nID = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_I") 'C1ClinicalChart.GetData(System.Convert.ToInt16(intCount), 0).ToString()

                            If IsNumeric(nID) = False Then
                                Continue For
                            End If

                            strWordFileName = ExamNewDocumentName


                            If strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.OrderTemplates.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.OrderTemplates

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.RefferalDocument.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.RefferalDocument

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Messages.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Messages

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.NursesNotes.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.NursesNotes

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Triage.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Triage

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PTProtocol.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PTProtocol

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientConsent.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientConsent

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.DisclosureManagement.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.DisclosureManagement

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientLetters.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientLetters

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientConsent.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientConsent

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.FormGallery.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.FormGallery

                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Orders.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Orders

                                'Aniket: To change this
                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientForms.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.PatientForms
                            ElseIf strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Patient_Education.ToString Then
                                strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.Patient_Education

                            End If


                            objWord = New clsWordDocument
                            oDB = New DataBaseLayer


                            If strModuleName = gloUIControlLibrary.Classes.ClinicalChartQueue.enumDocType.OrdersTestResult.ToString Then
                                strModuleName = 3
                                rIndex = intCount
                                OrderID = dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("sTranID_II")
                            End If

                            If IsNothing(oLabOrderRequest) = False Then
                                oLabOrderRequest.Dispose()
                                oLabOrderRequest = Nothing
                            End If

                            oParamater = New DBParameter
                            oParamater.DataType = SqlDbType.BigInt
                            oParamater.Direction = ParameterDirection.Input
                            oParamater.Name = "@ID"
                            oParamater.Value = System.Convert.ToInt64(nID)
                            oDB.DBParametersCol.Add(oParamater)
                            oParamater = Nothing

                            oParamater = New DBParameter
                            oParamater.DataType = SqlDbType.BigInt
                            oParamater.Direction = ParameterDirection.Input
                            oParamater.Name = "@sFlag"
                            oParamater.Value = strModuleName
                            oDB.DBParametersCol.Add(oParamater)
                            oParamater = Nothing

                            If (strModuleName = 3) Then
                                oParamater = New DBParameter
                                oParamater.DataType = SqlDbType.BigInt
                                oParamater.Direction = ParameterDirection.Input
                                oParamater.Name = "@OrderID"
                                oParamater.Value = OrderID
                                oDB.DBParametersCol.Add(oParamater)
                                oParamater = Nothing
                            End If

                            dt = oDB.GetDataTable("gsp_GetClinicalChartTemplate")

                            If (dt.Rows.Count >= 1) Then
                                If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint) Then

                                    strPDFFilePath = GenerateClinicalChartFileName(dsMain, intCount) 'ExamNewDocumentName.Replace(".docx", ".pdf")
                                End If

                                strWordFileName = objWord.GenerateFile(dt.Rows(0)(0), strWordFileName)

                                oCurDoc1 = myLoadWord.LoadWordApplication(strWordFileName)


                                Dim objPrintFAX As New clsPrintFAX()

                                If System.Convert.ToBoolean(System.Configuration.ConfigurationManager.AppSettings("USE_BUILDING_BLOCKS_IN_WORD_TEMPLATES")) Then
                                    objPrintFAX.InsertNamePageNo(oCurDoc1, objPrintFAX.GetPatientDetails(dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nPatientID")))
                                Else
                                    objPrintFAX.InsertPageFooterWithoutMSWBuildingBlock(oCurDoc1, objPrintFAX.GetPatientDetails(dsMain.Tables("ClinicalChartQueueMST").Rows(0)("nPatientID")))
                                End If

                                objPrintFAX.Dispose()
                                objPrintFAX = Nothing

                                gloWord.LoadAndCloseWord.CleanupDoc(oCurDoc1)
                                oCurDoc1.Application.DisplayAlerts = Microsoft.Office.Interop.Word.WdAlertLevel.wdAlertsNone
                                oCurDoc1.SaveAs(strPDFFilePath, Wd.WdSaveFormat.wdFormatPDF, False, "", False)
                                myLoadWord.CloseWordOnly(oCurDoc1)

                                strPDFFilePath = ChangePDFExtension(strPDFFilePath, "pdf")
                                SaveDMSFile(strPDFFilePath)
                                AppendToFile(strPDFFilePath, MergeFaxFilePath, BackGroundProcessType)
                                If (IO.File.Exists(strWordFileName)) Then
                                    IO.File.Delete(strWordFileName)
                                End If

                            End If

                            'dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("IncludeFooter") = False

                        Catch ex As Exception
                            strClinicalChartErrorNotes.AppendLine(dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("DocumentName"))
                            notestype = 5
                            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                            dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""

                        Finally
                            objWord = Nothing
                            oParamater = Nothing

                            If Not IsNothing(oDB) Then
                                oDB.Dispose()
                                oDB = Nothing
                            End If

                            If Not IsNothing(dt) Then
                                dt.Dispose()
                                dt = Nothing
                            End If

                        End Try
                    End If

                Catch extr As ThreadAbortException
                    ' blnquethrdaborted = True
                    Thread.ResetAbort()
                    Return Nothing

                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                    dsMain.Tables("ClinicalChartQueueDetails").Rows(intCount)("PhysicalFileName") = ""
                End Try



            Next
            If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then
                nFooterStart = nFooterStart - 1
                For Each i As Int32 In FooterIndex
                    dsMain.Tables("ClinicalChartQueueDetails").Rows(i)("footr_TotalPage") = nFooterStart
                Next i
            End If

            If Convert.ToString(OrderIDList) <> "" Then
                UpdateManualOrderStatus(1005, Convert.ToString(OrderIDList))
            End If

            If Not IsNothing(myLoadWord) Then
                myLoadWord.CloseApplicationOnly()
            End If
            ''Clinical chart Background Fax implementation-20160811


            Dim oFile As FileStream = Nothing
            If (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.FAX) Then
                Dim oclsClinicalChartDBLayer As New gloUIControlLibrary.Classes.ClinicalChartQueue.clsClinicalChartDBLayer(GetConnectionString())
                Try

                    If (dsMain.Tables.Contains("ClinicalChartDetails")) Then

                        dtFax = dsMain.Tables("ClinicalChartDetails")

                        Dim FaxCoverFilePath As String = String.Empty
                        Dim nFaxID As Int64 = 0
                        Dim nPatientID As Int64 = 0
                        Dim _Result As String = String.Empty

                        Dim cls As New gloEDocumentV3.SDKInteraction.eDocV3SDKInteraction()
                        If dtFax.Rows.Count > 0 Then

                            For k As Integer = 0 To dtFax.Rows.Count - 1
                                nFaxID = Convert.ToInt64(dtFax.Rows(k)("nFaxID"))
                                nPatientID = Convert.ToInt64(dtFax.Rows(k)("nPatientID"))
                                If Convert.ToString(dtFax.Rows(k)("FaxCoverPageBinary")).Trim() <> "" Then
                                    FaxCoverFilePath = gloGlobal.clsFileExtensions.NewDocumentName(gloSettings.FolderSettings.AppTempFolderPath, ".pdf", "MMddyyyyHHmmssffff")
                                    Dim bytesRead As Byte() = Convert.FromBase64String(dtFax.Rows(k)("FaxCoverPageBinary"))
                                    System.IO.File.WriteAllBytes(FaxCoverFilePath, bytesRead)

                                    AppendToFile(MergeFaxFilePath, FaxCoverFilePath, BackGroundProcessType)

                                    'If (IO.File.Exists(MergeFaxFilePath)) Then

                                    '    IO.File.Delete(MergeFaxFilePath)
                                    'End If
                                    MergeFaxFilePath = FaxCoverFilePath
                                End If
                                ''
                                'If (MergeFaxFilePath = "WORDEXCEPTION" OrElse MergeFaxFilePath = "ERROR") Then
                                '    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Reports, gloAuditTrail.ActivityCategory.ClinicalChart, gloAuditTrail.ActivityType.Export, "Fax using clinical chart is aborted.", _PatientID, 0, 0, gloAuditTrail.ActivityOutCome.Failure, gloAuditTrail.SoftwareComponent.gloEMR)
                                '    oclsClinicalChartDBLayer.InsertQueueNotes(QueueID, "Fax using clinical chart is aborted.", _nAssociatedContactID, username, UserID, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed)

                                '    Continue For
                                'End If
                                '  MergeFaxFilePath = ""
                                If MergeFaxFilePath.Trim = "" Then

                                    ' MessageBox.Show("Can not create document for fax.", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                                    oclsClinicalChartDBLayer.InsertQueueNotes(QueueID, "Can not create document for fax.", 0, gstrLoginName, _UserID, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed)
                                    notestype = 5
                                    DeleteUpdateClinicalChartFax(nFaxID, QueueID, "", 0, 0, "DeleteFax", nPatientID)
                                    Continue For
                                End If
                                ''
                                oFile = New FileStream(MergeFaxFilePath, FileMode.Open, FileAccess.Read)
                                If (oFile.Length > 2147483645) Then


                                    oclsClinicalChartDBLayer.InsertQueueNotes(QueueID, "File exceeded limit of 2 GB", 0, gstrLoginName, _UserID, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed)
                                    notestype = 5
                                    DeleteUpdateClinicalChartFax(nFaxID, QueueID, "", 0, 0, "DeleteFax", nPatientID)
                                    If Not IsNothing(oFile) Then
                                        oFile.Close()
                                        oFile.Dispose()
                                        oFile = Nothing
                                    End If
                                    Continue For
                                End If


                                If ValidatePageLimit(MergeFaxFilePath, _Result, QueueID) = False Then
                                    ''Validate Page limit of Fax data and delete fax
                                    notestype = 5
                                    DeleteUpdateClinicalChartFax(nFaxID, QueueID, "", 0, 0, "DeleteFax", nPatientID)
                                    Continue For
                                End If

                                If gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = False Then

                                    Dim _TifFileName As String = gloGlobal.clsFileExtensions.NewDocumentName(gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory, ".tif", "MMddyyyyHHmmssffff")
                                    cls.PDFToTIFF(MergeFaxFilePath, _TifFileName)
                                    Dim _TiffName As String = Path.GetFileNameWithoutExtension(_TifFileName)
                                    DeleteUpdateClinicalChartFax(nFaxID, QueueID, "", 0, 0, "UpdateTiff", nPatientID, , _TiffName)
                                Else

                                    AddFax(nFaxID, MergeFaxFilePath, nPatientID, QueueID, notestype)
                                End If
                            Next
                        End If
                        If Not IsNothing(oclsClinicalChartDBLayer) Then
                            oclsClinicalChartDBLayer = Nothing
                        End If
                        If Not IsNothing(cls) Then
                            cls.Dispose()
                            cls = Nothing
                        End If

                    End If
                Catch ex As Exception
                Finally
                    dtFax.Columns.Remove("ClincalChartDetailsID")
                    dtFax.Columns.Remove("nQueueID")
                    dtFax.Columns.Remove("nPatientID")
                    DeleteUpdateClinicalChartFax(0, QueueID, "", 0, 0, "DeleteErrorFaxes", 0, dtFax)
                End Try
            ElseIf BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Print Then
                PrintDocumentInBackground(dsMain.Tables("ClinicalChartDetails").Rows(0)("PrinterSettingsID"), MergeFaxFilePath, intFullFilePageCount, intDMSFilePageCount, dsMain.Tables("ClinicalChartDetails").Rows(0)("nPatientID"), dsMain.Tables("ClinicalChartDetails").Rows(0)("PrintData"), dsMain.Tables("ClinicalChartDetails").Rows(0)("IsClaimSelected"))

            ElseIf BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Export Then
                File.Copy(MergeFaxFilePath, dsMain.Tables("ClinicalChartDetails").Rows(0)("ExportPath"), True)
                'MessageBox.Show("Clinical Chart file exported at the following location:" & vbCrLf & dsMain.Tables("ClinicalChartDetails").Rows(0)("ExportPath"), "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                ExportPath = dsMain.Tables("ClinicalChartDetails").Rows(0)("ExportPath")
                Me.Invoke(New Action(AddressOf CallExportMessage))
                'MessageBox.Show("DMS category for advance directive has not been set, Set the category", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If


            Return dsMain

        Catch extr As ThreadAbortException

            Thread.ResetAbort()
            Return Nothing
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
            Return Nothing
        Finally
            If Not IsNothing(oCurDoc1) Then
                If (Not IsNothing(myLoadWord)) Then
                    myLoadWord.CloseWordOnly(oCurDoc1)
                    myLoadWord.CloseApplicationOnly()
                End If

            End If
            myLoadWord = Nothing
            oCurDoc1 = Nothing
            'C1ClinicalChart.Enabled = True
            If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then
                Dim popUpDetails As gloClinicalQueueGeneral.QueueDocumentDocumentDetails = Nothing
                If Not gloGlobal.gloTSPrint.IsDefaultPrinterOn(chkTSPrintSetting:=False) AndAlso BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then
                    If _isTSPrinterSelectionOpen Then
                        notestype = 3
                    End If
                    _isTSPrinterSelectionOpen = True
                    Dim tsPrintDialog As New gloPrintDialog.frmTSPrintDialog()
                    If ClaimDataType = 1 Then
                        tsPrintDialog.PrinterModule = gloClinicalQueueGeneral.Classes.clsSettings.ModulePrintType.UB04Claimprinter.ToString()
                    ElseIf ClaimDataType = 2 Then
                        tsPrintDialog.PrinterModule = gloClinicalQueueGeneral.Classes.clsSettings.ModulePrintType.CMS1500Claimprinter.ToString()
                    Else
                        tsPrintDialog.PrinterModule = gloClinicalQueueGeneral.Classes.clsSettings.ModulePrintType.Documentprinter.ToString()
                    End If
                    tsPrintDialog.ShowDialog()
                    _isTSPrinterSelectionOpen = False
                    If tsPrintDialog.cancelPirnt = True Then
                        notestype = 3
                    End If
                    popUpDetails = New gloClinicalQueueGeneral.QueueDocumentDocumentDetails()
                    popUpDetails.PrintFrom = tsPrintDialog.pageFrom
                    popUpDetails.PrintTo = tsPrintDialog.pageTo
                    popUpDetails.Printer = tsPrintDialog.currPrinterFile
                    popUpDetails.Copies = tsPrintDialog.NoOfCopies
                    popUpDetails.Landscape = tsPrintDialog.isLandscape
                    popUpDetails.Duplex = tsPrintDialog.duplex
                    popUpDetails.Size = tsPrintDialog.currSize
                    popUpDetails.Tray = tsPrintDialog.currTray
                    popUpDetails.isCollete = tsPrintDialog.isCollete

                    tsPrintDialog.Dispose()
                    tsPrintDialog = Nothing
                End If
                If notestype <> 3 Then
                    GenerateMetaDataFile(dsMain, notestype, isForPrint, popUpDetails)
                End If
            End If
            If (notestype = 2) Or (notestype = 3) Then
                strClinicalChartErrorNotes.Clear()
                If (notestype = 2) Then
                    strClinicalChartErrorNotes.Append("Queue was auto processed by the application.")
                Else
                    strClinicalChartErrorNotes.Append("Print was cancelled.")
                End If
                UpdateClinicalChartNotes(QueueID, strClinicalChartErrorNotes.ToString(), nAssociContactID, gstrLoginName, _UserID, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.Processed, isForPrint)
            Else
                UpdateClinicalChartNotes(QueueID, strClinicalChartErrorNotes.ToString(), nAssociContactID, gstrLoginName, _UserID, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed, isForPrint)
            End If
            strClinicalChartErrorNotes.Clear()
            strClinicalChartErrorNotes = Nothing
            If (Not IsNothing(claimNoteID)) Then ''added for bugid 99467 added claim notes for printing faxing and exporting
                Dim sNoteDescription As String = String.Empty
                If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Print OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.TsPrint Then
                    sNoteDescription = "printed."
                    If (notestype = 5) Then
                        sNoteDescription = "Error While Printing."
                    End If
                End If
                If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Export Then
                    sNoteDescription = "exported."
                    If (notestype = 5) Then
                        sNoteDescription = "Error while exporting."
                    End If
                End If
                If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.FAX Then
                    sNoteDescription = "faxed."
                    If (notestype = 5) Then
                        sNoteDescription = "Error while faxing."
                    End If
                End If

                If sNoteDescription <> String.Empty Then

                    Dim oNote As New gloBilling.Common.GeneralNote()
                    With oNote
                        .TransactionID = claimNoteID.MasterTransactionID
                        .TransactionLineId = 0
                        .TransactionDetailID = 0
                        .NoteType = gloBilling.NoteType.Claim_Note
                        .NoteID = 0
                        .NoteDate = gloDateMaster.gloDate.DateAsNumber(System.Convert.ToString(Date.Today))
                        .UserID = gnLoginID
                        .NoteDescription = claimNoteID.ClaimID + sNoteDescription
                        .ClinicID = gnClinicID
                    End With

                    Dim oNotes As New gloBilling.Common.GeneralNotes()
                    oNotes.Add(oNote)

                    gloCharges.SaveClaimNotes(oNotes)
                    oNotes.Dispose()
                    oNotes = Nothing
                End If

            End If
        End Try

    End Function
    Private Sub CallExportMessage()
        MessageBox.Show("Clinical Chart file exported at the following location:" & vbCrLf & ExportPath, "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
    End Sub
    Private Sub UpdateManualOrderStatus(ByVal intOrderStatus As Int16, ByVal OrderIDList As String)
        Dim oDBLayer As gloDatabaseLayer.DBLayer = Nothing
        Dim oDBparams As gloDatabaseLayer.DBParameters = Nothing

        Try
            'Create parameters for SP to update the Manual Order status.
            oDBparams = New gloDatabaseLayer.DBParameters()
            oDBparams.Add("@intOrderStatus", intOrderStatus, ParameterDirection.Input, SqlDbType.Int)
            oDBparams.Add("@OrderList", OrderIDList, ParameterDirection.Input, SqlDbType.VarChar)

            'Execution for the stored procedures
            oDBLayer = New gloDatabaseLayer.DBLayer(GetConnectionString())
            oDBLayer.Connect(False)
            oDBLayer.Execute("gsp_UpdateClinicalChartOrderStatus", oDBparams)

            oDBLayer.Disconnect()
        Catch ex As Exception
            'Log if any exception;

            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString(), False)
            ex = Nothing
        Finally
            'Cleanup for internal objects utilized in the method.

            If oDBLayer IsNot Nothing Then
                oDBLayer.Dispose()
                oDBLayer = Nothing
            End If

            If oDBparams IsNot Nothing Then

                oDBparams.Clear()
                oDBparams.Dispose()

                oDBparams = Nothing

            End If
        End Try

    End Sub

    Public Sub AddFax(nFaxID As Int64, faxfilepath As String, nPatientID As Int64, nQueueID As Int64, ByRef notestype As Integer)

        Dim oFile As FileStream = Nothing
        Dim myMaxLength As Integer = ((CInt(gloEDocumentV3.gloEDocV3Admin.GetMemoryBuferSetting() / 7) * 3) / 10)
        Dim oReader As BinaryReader = Nothing
        Dim myIndex As Long = 0
        Dim myOutputString As [String] = ""
        Dim bytesRead As Byte() = Nothing
        Dim myBytesRead As Integer = 0
        Dim _ErrorMessage As String = ""
        Dim connMain As SqlConnection = Nothing
        Dim trnMain As SqlTransaction = Nothing

        myMaxLength = (CInt(myMaxLength / 12) * 12)

        Try

            'For the Multiples of 3
            If File.Exists(faxfilepath) Then
                oFile = New FileStream(faxfilepath, FileMode.Open, FileAccess.Read)

                oReader = New BinaryReader(oFile)
                bytesRead = New Byte(myMaxLength - 1) {}
                myBytesRead = oReader.Read(bytesRead, CInt(myIndex), myMaxLength)

                myOutputString = Convert.ToBase64String(bytesRead, 0, myBytesRead)

                connMain = New SqlConnection(GetConnectionString())
                connMain.Open()
                trnMain = connMain.BeginTransaction

                DeleteUpdateClinicalChartFax(nFaxID, nQueueID, myOutputString, 0, 0, "UpdateFax", nPatientID, , , connMain, trnMain)

                'IF MBYTES IS LESS THEN 
                While myBytesRead = myMaxLength AndAlso oReader IsNot Nothing
                    myIndex += CLng(myOutputString.Length)
                    myBytesRead = oReader.Read(bytesRead, 0, myMaxLength)
                    myOutputString = Convert.ToBase64String(bytesRead, 0, myBytesRead)
                    DeleteUpdateClinicalChartFax(nFaxID, nQueueID, myOutputString, myOutputString.Length, myIndex, "UpdateOffset", nPatientID, , , connMain, trnMain)
                End While

                trnMain.Commit()
            Else
                notestype = 5
            End If

        Catch ex As Exception
            trnMain.Rollback()
            notestype = 5
            _ErrorMessage = ex.Message
            gloAuditTrail.gloAuditTrail.ExceptionLog(_ErrorMessage, False)

        Finally

            If IsNothing(trnMain) = False Then
                trnMain.Dispose()
                trnMain = Nothing
            End If

            If IsNothing(connMain) = False Then
                connMain.Close()
                connMain.Dispose()
                connMain = Nothing
            End If

            If oFile IsNot Nothing Then
                oFile.Close()
                oFile.Dispose()
                oFile = Nothing
            End If
        End Try

    End Sub

    Private Function ADDCoverpagetoFile(ByVal dtbinarydata As DataTable, ByVal MergeFaxFilePath As String, Optional ByVal BackGroundProcessType As gloUIControlLibrary.Classes.ClinicalChartQueue.enumBackgroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Queue) As DataTable

        Dim binaryDatatable As New DataTable()
        Try


            Dim FaxCoverFilePath = gloSettings.FolderSettings.AppTempFolderPath + "faxcoverfilepath.pdf"

            binaryDatatable.Columns.Add("nFaxID", GetType(Int64))
            binaryDatatable.Columns.Add("FaxCoverPageBinary", GetType(Byte()))

            For Each dr As DataRow In dtbinarydata.Rows
                Dim binarydatarow As DataRow = binaryDatatable.NewRow()
                binarydatarow(0) = dr("nFaxID")
                If Not IsNothing(dr("FaxCoverPageBinary")) Then

                    If (Convert.ToString(dr("FaxCoverPageBinary"))).Trim() <> "" Then
                        Dim binarydata As Byte() = DirectCast(dr("FaxCoverPageBinary"), Byte())
                        System.IO.File.WriteAllBytes(FaxCoverFilePath, binarydata)
                        AppendToFile(MergeFaxFilePath, FaxCoverFilePath, BackGroundProcessType)
                        If (IO.File.Exists(FaxCoverFilePath)) Then
                            IO.File.Delete(FaxCoverFilePath)
                        End If
                    Else
                        Dim binarydata As Byte() = Nothing
                        binarydata = System.IO.File.ReadAllBytes(MergeFaxFilePath)
                        'AppendtoFile(MergeFaxFilePath, FaxCoverFilePath, False)
                        binarydatarow(1) = binarydata
                        'If (IO.File.Exists(MergeFaxFilePath)) Then
                        '    IO.File.Delete(MergeFaxFilePath)
                        'End If
                    End If
                    binaryDatatable.Rows.Add(binarydatarow)
                End If
            Next
            If (IO.File.Exists(MergeFaxFilePath)) Then
                IO.File.Delete(MergeFaxFilePath)
            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString(), False)
        End Try
        Return binaryDatatable
    End Function

    Private Sub AppendToFile(ByRef FileToMerge As String, ByVal Mergedfile As String, ByVal BackGroundProcessType As Classes.ClinicalChartQueue.enumBackgroundProcessType, Optional ByVal bToResize As Boolean = False)

        If BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.FAX OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Print OrElse BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Export Then

            Dim in_Doc1 As pdftron.PDF.PDFDoc = Nothing
            Dim in_Doc2 As pdftron.PDF.PDFDoc = Nothing

            Try

                in_Doc1 = New pdftron.PDF.PDFDoc(FileToMerge)

                If (IsNothing(in_Doc1) = True) Then
                    Return
                End If

                Try
                    If File.Exists(Mergedfile) = True Then
                        in_Doc2 = New pdftron.PDF.PDFDoc(Mergedfile)
                    Else
                        in_Doc2 = New pdftron.PDF.PDFDoc()
                    End If

                Catch ex As Exception
                    in_Doc2 = New pdftron.PDF.PDFDoc()
                End Try

                If (IsNothing(in_Doc2) = True) Then
                    in_Doc1.Dispose()
                    in_Doc1 = Nothing
                    Return
                End If

                Try
                    in_Doc1.InitSecurityHandler()
                    in_Doc2.InitSecurityHandler()
                Catch ex As Exception
                    in_Doc1.Dispose()
                    in_Doc1 = Nothing
                    in_Doc2.Dispose()
                    in_Doc2 = Nothing
                    gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                    Return
                End Try

                Dim myInteger As Integer = in_Doc1.GetPageCount()
                Dim bForPrint As Boolean = (BackGroundProcessType = Classes.ClinicalChartQueue.enumBackgroundProcessType.Print)
                If myInteger > 0 Then
                    For i As Integer = 1 To myInteger

                        Dim src_Page As pdftron.PDF.Page = in_Doc1.GetPage(i)
                        Dim new_DocPageCount As Integer = in_Doc2.GetPageCount()
                        Dim myNewPageItr As pdftron.PDF.PageIterator = in_Doc2.GetPageIterator(new_DocPageCount + 1)
                        If (bToResize) Then
                            'Dim pageWidth As Integer = src_Page.GetPageWidth() - 1
                            'Dim pageHeight = src_Page.GetPageHeight() - 1
                            'Dim pageScale As Single = 1.0F
                            'If (pageWidth > pageHeight) Then
                            '    If (pageWidth > USLetterHeight) Or (pageHeight > USLetterWidth) Then
                            '        Dim pageScaleW As Single = USLetterHeight / pageWidth
                            '        Dim pageScaleH As Single = USLetterWidth / pageHeight
                            '        pageScale = Math.Min(pageScaleW, pageScaleH)
                            '    End If
                            'Else
                            '    If (pageWidth > USLetterWidth) Or (pageHeight > USLetterHeight) Then
                            '        Dim pageScaleW As Single = USLetterWidth / pageWidth
                            '        Dim pageScaleH As Single = USLetterHeight / pageHeight
                            '        pageScale = Math.Min(pageScaleW, pageScaleH)
                            '    End If
                            'End If
                            'If (pageScale < 1.0F) Then
                            '    src_Page.Scale(pageScale)
                            'End If
                            gloEDocumentV3.SDKInteraction.eDocV3SDKInteraction.PDFPageResize(src_Page, bForPrint)
                        End If

                        in_Doc2.PageInsert(myNewPageItr, src_Page)
                        myNewPageItr.Dispose()
                        myNewPageItr = Nothing
                        src_Page = Nothing

                    Next i
                End If

                Try
                    in_Doc2.PageCreate()
                    in_Doc2.Save(Mergedfile, 0)
                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog("Not able to save: " & ex.ToString, False)
                    Return
                End Try

                in_Doc2.Close()
                in_Doc1.Close()
                in_Doc1.Dispose()
                in_Doc1 = Nothing
                in_Doc2.Dispose()
                in_Doc2 = Nothing
                ''Resolved issue#99468-gloEMR(8071) : Clinical Chart : Application showing message when user click on print button.
                Dim FiletoMergeNew As String = String.Empty
                Try

                    'If (IO.File.Exists(FileToMerge)) Then
                    '    IO.File.Delete(FileToMerge)
                    'End If
                    FiletoMergeNew = gloSettings.FolderSettings.AppTempFolderPath & System.Guid.NewGuid.ToString() & ".pdf" 'gloGlobal.clsFileExtensions.NewDocumentName(gloSettings.FolderSettings.AppTempFolderPath, ".pdf", "MMddyyyyHHmmssffff") 'GenerateClinicalChartFileName(dsMain, 0, , BackGroundProcessType)
                    FileToMerge = FiletoMergeNew

                Catch ex As Exception
                    FiletoMergeNew = gloGlobal.clsFileExtensions.NewDocumentName(gloSettings.FolderSettings.AppTempFolderPath, ".pdf", "MMddyyyyHHmmssffff") 'GenerateClinicalChartFileName(dsMain, 0, , BackGroundProcessType)
                    FileToMerge = FiletoMergeNew
                    gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                    Return
                End Try

            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                Return
            End Try

        End If

    End Sub
    ''Added by Mayuri : 20160810-To Clinical chart Background Fax
    Private Sub UpdateClinicalChartFaxDetails(ByVal dtFax As DataTable, ByVal nQueueID As Int64)

       

    End Sub
    Private Sub UpdateClinicalChartNotes(ByVal QueueID As Int64, ByVal strClinicalNotes As String, ByVal nAssoContactid As Int64, ByVal strUserName As String, ByVal userID As Int64, ByVal Processed As Int32, Optional ByVal isForPrint As Boolean = False)
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim strCmd As String
        If isForPrint = True Then
            strCmd = "ClinicalCharts_InsertQueueNotes_ForPrint"
        Else
            strCmd = "ClinicalCharts_InsertQueueNotes"
        End If

        If oDB IsNot Nothing Then
            If oDB.Connect(False) Then
                Dim oParamater As New gloDatabaseLayer.DBParameters()
                Try
                    oParamater.Add("@nQueueID", QueueID, System.Data.ParameterDirection.Input, System.Data.SqlDbType.BigInt)
                    oParamater.Add("@sNotes", strClinicalNotes, System.Data.ParameterDirection.Input, System.Data.SqlDbType.VarChar)
                    oParamater.Add("@nAssociatedContactID", nAssoContactid, System.Data.ParameterDirection.Input, System.Data.SqlDbType.BigInt)

                    oParamater.Add("@sUserName", strUserName, ParameterDirection.Input, System.Data.SqlDbType.VarChar)
                    oParamater.Add("@sUserID", userID, System.Data.ParameterDirection.Input, System.Data.SqlDbType.BigInt)

                    oParamater.Add("@nNoteType", Processed, ParameterDirection.Input, System.Data.SqlDbType.Int)

                    oParamater.Add("@nQueueStatus", Processed, ParameterDirection.Input, System.Data.SqlDbType.Int)

                    oDB.Execute(strCmd, oParamater)


                Catch ex As gloDatabaseLayer.DBException
                    ex.ERROR_Log(ex.ToString())
                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
                Finally

                    If oParamater IsNot Nothing Then
                        oParamater.Dispose()
                        oParamater = Nothing
                    End If
                    If oDB IsNot Nothing Then
                        oDB.Disconnect()
                        oDB.Dispose()
                        oDB = Nothing
                    End If
                End Try
            Else
                If oDB IsNot Nothing Then
                    oDB.Disconnect()
                    oDB.Dispose()
                    oDB = Nothing
                End If
            End If
        End If
    End Sub

    Private Sub DeleteUpdateClinicalChartFax(ByVal nFaxID As Int64, ByVal nQueueID As Int64, ByVal FaxBinaryData As String, ByVal length As Int64, ByVal offset As Int64, ByVal sAction As String, ByVal nPatientID As Int64, Optional ByVal dtFax As DataTable = Nothing, Optional TiffFilename As String = "", Optional ByRef connMain As SqlConnection = Nothing, Optional ByRef trnMain As SqlTransaction = Nothing)

        Dim cmd As SqlCommand = Nothing
        Dim sqlParam As SqlParameter = Nothing
        Dim Con As SqlConnection = Nothing

        Try

            If IsNothing(connMain) = True Then
                Con = New SqlConnection(GetConnectionString())
            Else
                Con = connMain
            End If

            cmd = New SqlCommand("ClinicalCharts_UpdatePendigFaxFile", Con)
            cmd.CommandType = CommandType.StoredProcedure

            If IsNothing(trnMain) = False Then
                cmd.Transaction = trnMain
            End If

            sqlParam = cmd.Parameters.Add("@nFaxID", SqlDbType.BigInt)
            sqlParam.Direction = ParameterDirection.Input
            sqlParam.Value = nFaxID

            sqlParam = cmd.Parameters.Add("@FaxBinaryData", SqlDbType.VarChar)
            sqlParam.Direction = ParameterDirection.Input
            sqlParam.Value = FaxBinaryData


            sqlParam = cmd.Parameters.Add("@nPatientID", SqlDbType.BigInt)
            sqlParam.Direction = ParameterDirection.Input
            sqlParam.Value = nPatientID

            If sAction = "UpdateFax" Then
                sqlParam = cmd.Parameters.Add("@isUpdatebinary", SqlDbType.Bit)
                sqlParam.Direction = ParameterDirection.Input
                sqlParam.Value = 1
            ElseIf sAction = "UpdateOffset" Then
                sqlParam = cmd.Parameters.Add("@length", SqlDbType.BigInt)
                sqlParam.Direction = ParameterDirection.Input
                sqlParam.Value = length

                sqlParam = cmd.Parameters.Add("@offset", SqlDbType.BigInt)
                sqlParam.Direction = ParameterDirection.Input
                sqlParam.Value = offset

                sqlParam = cmd.Parameters.Add("@isUpdateoffset", SqlDbType.Bit)
                sqlParam.Direction = ParameterDirection.Input
                sqlParam.Value = 1
            ElseIf sAction = "DeleteFax" Then
                sqlParam = cmd.Parameters.Add("@isDelete", SqlDbType.Bit)
                sqlParam.Direction = ParameterDirection.Input
                sqlParam.Value = 1
            ElseIf sAction = "DeleteErrorFaxes" Then
                sqlParam = cmd.Parameters.Add("@isDeleteErrorFaxes", SqlDbType.Bit)
                sqlParam.Direction = ParameterDirection.Input
                sqlParam.Value = 1

                sqlParam = cmd.Parameters.Add("@TVPFax", SqlDbType.Structured)
                sqlParam.Direction = ParameterDirection.Input
                sqlParam.Value = dtFax
            ElseIf sAction = "UpdateTiff" Then
                sqlParam = cmd.Parameters.Add("@TiffFilName", SqlDbType.VarChar)
                sqlParam.Direction = ParameterDirection.Input
                sqlParam.Value = TiffFilename
            End If

            If IsNothing(connMain) = True Then
                Con.Open()
            End If

            cmd.ExecuteNonQuery()

        Catch ex As SqlException
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString(), False)
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString(), False)

        Finally
            If IsNothing(connMain) = True Then
                If Not IsNothing(Con) Then
                    Con.Close()
                    Con.Dispose()
                    Con = Nothing
                End If
            End If
            
            If cmd IsNot Nothing Then
                cmd.Parameters.Clear()
                cmd.Dispose()
                cmd = Nothing
            End If

            sqlParam = Nothing
        End Try


    End Sub
    Private Function ValidatePageLimit(ByVal ActualFileData As String, ByRef _Result As String, ByVal nQueueID As Int64) As Boolean
        Dim _smessage() As String
        Dim oclsClinicalChartDBLayer As New gloUIControlLibrary.Classes.ClinicalChartQueue.clsClinicalChartDBLayer(GetConnectionString())
        Try


            ' Dim oclsClinicalChartDBLayer As New gloUIControlLibrary.Classes.ClinicalChartQueue.clsClinicalChartDBLayer(GetConnectionString())
            ValidFilePDFDocumentAfterMerging(ActualFileData, _Result)
            _smessage = _Result.Trim().Split("-")
            If Not IsNothing(_smessage) Then
                If Convert.ToString(_smessage).Trim <> "" Then
                    If _smessage.Length > 1 Then
                        If _smessage(0) <> "" Then

                            If Convert.ToString(_smessage(1)) = "warning" Then
                                oclsClinicalChartDBLayer.InsertQueueNotes(nQueueID, "The fax you sent was " & _smessage(0).ToString() & " pages long.", 0, gstrLoginName, _UserID, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.Processed, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.Processed)

                                Return True
                            ElseIf Convert.ToString(_smessage(1)) = "error" Then

                                oclsClinicalChartDBLayer.InsertQueueNotes(nQueueID, "You were attemped to send a fax that was  " & _smessage(2).ToString() & " pages long." & Environment.NewLine & "That exceeded the maximum page limit for faxes," & Environment.NewLine & "which was set to " + _smessage(0).ToString() & " pages in gloEMR Admin." & Environment.NewLine & "BECAUSE THE PAGE LIMIT WAS EXCEEDED, THIS FAX WAS NOT SENT.", 0, gstrLoginName, _UserID, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed, gloUIControlLibrary.Classes.ClinicalChartQueue.enumPrintStatus.ErrorProcessed)
                                Return False
                            End If


                        End If

                    End If
                End If

            End If
            If Not IsNothing(oclsClinicalChartDBLayer) Then
                oclsClinicalChartDBLayer = Nothing
            End If
        Catch ex As Exception
            gloEDocumentV3.eDocManager.eDocValidator.UpdateExceptionLog("Validate Page limit :" + ex.ToString())
        End Try
        Return True
    End Function

    Private Sub PrintDocumentInBackground(PrinterSettingsDetailsID As Long, FilePath As String, intFullFilePageCount As Integer, intDMSFilePageCount As Integer, _PatientID As Long, PrintData As Boolean, IsClaimSelected As Boolean)


        Dim docDMS As pdftron.PDF.PDFDoc = Nothing
        Dim _pdfdocDMS As pdftron.PDF.PDFDoc = Nothing



        Try


            If (IO.File.Exists(FilePath) = False) Then
                Throw New FileNotFoundException
            End If


            Using oDialog As gloPrintDialog.gloPrintDialog = New gloPrintDialog.gloPrintDialog()

                oDialog.PrinterSettingsDetailsID = PrinterSettingsDetailsID
                oDialog.ConnectionString = GetConnectionString()
                oDialog.ShowPrinterProfileDialog = False
                oDialog.TopMost = True
                oDialog.AllowSomePages = False
                oDialog.ModuleName = "PrintClinicalCharts"
                oDialog.RegistryModuleName = "ClinicalCharts"
                oDialog.bUseDefaultPrinter = True

                If Not IsNothing(oDialog) Then

                    If IsNothing(_pdfdocDMS) Then
                        _pdfdocDMS = New pdftron.PDF.PDFDoc(FilePath)
                    End If

                    docDMS = _pdfdocDMS
                    docDMS.Lock()

                    Dim maxpage As Integer = _pdfdocDMS.GetPageCount()

                    oDialog.PrinterSettings = New PrinterSettings
                    'oDialog.PrinterSettings.Copies = 1

                    'oDialog.AllowSomePages = True
                    'oDialog.PrinterSettings.ToPage = maxpage
                    'oDialog.PrinterSettings.FromPage = 1
                    'oDialog.PrinterSettings.MaximumPage = maxpage
                    'oDialog.PrinterSettings.MinimumPage = 1

                    'PrintDialog1.AllowSomePages = True
                    'PrintDialog1.PrinterSettings.ToPage = maxpage
                    'PrintDialog1.PrinterSettings.FromPage = 1
                    'PrintDialog1.PrinterSettings.MaximumPage = maxpage
                    'PrintDialog1.PrinterSettings.MinimumPage = 1


                    If (oDialog.ShowDialog(Me) = System.Windows.Forms.DialogResult.OK) Then

                        '18-Aug-16 Aniket: Resolving Bug #99507: (8071)gloEMR : Clinical Chart : Number of Copies option of print dialogue box is not working properly. 
                        'oDialog.PrinterSettings.Copies = 1

                        oDialog.AllowSomePages = True
                        oDialog.PrinterSettings.ToPage = maxpage
                        oDialog.PrinterSettings.FromPage = 1
                        oDialog.PrinterSettings.MaximumPage = maxpage
                        oDialog.PrinterSettings.MinimumPage = 1


                        Dim footer As gloPrintDialog.gloPrintProgressController.FooterInfo = New gloPrintDialog.gloPrintProgressController.FooterInfo
                        Dim footerList As List(Of gloPrintDialog.gloPrintProgressController.FooterInfo) = New List(Of gloPrintDialog.gloPrintProgressController.FooterInfo)
                        Dim dtPatientTable As DataTable = GetPatientInformation(_PatientID, GetConnectionString())
                        Dim StrPatientName As String = ""

                        StrPatientName = dtPatientTable.Rows(0).Item("Patient Name") + ", DOB : " + dtPatientTable.Rows(0).Item("DOB")

                        'If (intFullFilePageCount > 1) Then
                        '    intFullFilePageCount = intFullFilePageCount + 1 ''if with scandocs other category docs printed 

                        'End If
                        footer.FromPage = intFullFilePageCount
                        footer.ToPage = intDMSFilePageCount
                        footer.StartingPage = 1
                        'footer.TotalPages = intDMSFilePageCount - (intFullFilePageCount - 1)
                        footer.TotalPages = intDMSFilePageCount - (intFullFilePageCount - 1)
                        footer.CenterText = ""
                        footer.RightText = "[{PAGE()}] of [{TOTAL()}]"
                        footer.LeftText = StrPatientName
                        If (intDMSFilePageCount > 0) Then
                            footerList.Add(footer)
                        End If

                        If PrintData = True AndAlso IsClaimSelected = True Then
                            oDialog.CustomPrinterExtendedSettings.CurrentPageSize = gloPrintDialog.gloExtendedPrinterSettings.PageSize.ActualPageSize
                            oDialog.CustomPrinterExtendedSettings.AdjustActualPageHorizontalPageWidthMargin = 50.9
                            oDialog.CustomPrinterExtendedSettings.AdjustActualPageVerticalPageHeightMargin = 50.9
                            oDialog.CustomPrinterExtendedSettings.AdjustFitToPageHorizontalPageWidthMargin = 0
                            oDialog.CustomPrinterExtendedSettings.AdjustFitToPageVerticalPageHeightMargin = 0
                            oDialog.CustomPrinterExtendedSettings.FooterBottom = 0
                            oDialog.CustomPrinterExtendedSettings.FooterColor = Color.Black
                            oDialog.CustomPrinterExtendedSettings.FooterFont = Nothing
                            oDialog.CustomPrinterExtendedSettings.FooterLeft = 0
                            oDialog.CustomPrinterExtendedSettings.FooterRight = 0
                            oDialog.CustomPrinterExtendedSettings.FooterTop = 0
                            oDialog.CustomPrinterExtendedSettings.HorizontalGutter = 0
                            oDialog.CustomPrinterExtendedSettings.HorizontalOverlap = 0
                            oDialog.CustomPrinterExtendedSettings.IsCustomDPI = False
                            oDialog.CustomPrinterExtendedSettings.PrinterMarginsBottom = 0
                            oDialog.CustomPrinterExtendedSettings.PrinterMarginsLeft = 0
                            oDialog.CustomPrinterExtendedSettings.PrinterMarginsRight = 0
                            oDialog.CustomPrinterExtendedSettings.PrinterMarginsTop = 0
                            oDialog.CustomPrinterExtendedSettings.VerticalGutter = 0
                            oDialog.CustomPrinterExtendedSettings.VerticalOverlap = 0

                        End If

                        'Aniket: To check the following
                        oDialog.CustomPrinterExtendedSettings.IsBackGroundPrint = True
                        oDialog.CustomPrinterExtendedSettings.IsShowProgress = False

                        Dim ogloPrintProgressController As gloPrintDialog.gloPrintProgressController = New gloPrintDialog.gloPrintProgressController(docDMS, docDMS.GetFileName(), oDialog.PrinterSettings, oDialog.CustomPrinterExtendedSettings, Nothing, footerList, blnIsFromClinicalChart:=True)
                        ogloPrintProgressController.ShowProgress(Me)



                    End If

                    '_pdfdocDMS.Unlock()
                    '_pdfdocDMS.Close()

                    'If IsNothing(_pdfdocDMS) = False Then
                    '    _pdfdocDMS.Dispose()
                    '    _pdfdocDMS = Nothing
                    'End If

                    docDMS.Unlock()
                    docDMS.Close()

                    If IsNothing(docDMS) = False Then
                        docDMS.Dispose()
                        docDMS = Nothing
                    End If



                End If

            End Using

        Catch ex As Exception

            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
        End Try





    End Sub


    Public Sub ValidFilePDFDocumentAfterMerging(PDFFilePath As String, ByRef _Result As String)
        Try
            Dim _FaxExceeds As String = getFaxPagesSetting("FAXEXCEEDSPAGES")
            Dim _Allowfaxes As String = getFaxPagesSetting("ALLOWFAXESPAGES")
            _Result = String.Empty

            Using myPDFDoc As New pdftron.PDF.PDFDoc(PDFFilePath)
                Dim cnt As Int32 = myPDFDoc.GetPageCount()
                If _FaxExceeds <> "" Then
                    If cnt > Convert.ToInt32(_FaxExceeds) Then
                        _Result = (_FaxExceeds & Convert.ToString("-")) + "warning"

                    End If
                Else
                    _Result = String.Empty
                End If

                If _Allowfaxes <> "" Then
                    If cnt > Convert.ToInt32(_Allowfaxes) Then
                        _Result = (_Allowfaxes & Convert.ToString("-")) + "error" + "-" + cnt.ToString()

                    End If


                End If

            End Using
        Catch ex As Exception

            gloEDocumentV3.eDocManager.eDocValidator.UpdateExceptionLog("Add CoverPage :" + ex.ToString())
        End Try

    End Sub

    Public Function getFaxPagesSetting(sSettingName As String) As String
        Dim result As String = String.Empty
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim dt As DataTable = Nothing
        Try
            oDB.Connect(False)
            Dim _strSQL As String = (Convert.ToString("SELECT ISNULL(sSettingsValue,'') AS sSettingsValue FROM Settings where sSettingsName='") & sSettingName) + "'"

            oDB.Retrive_Query(_strSQL, dt)

            If dt IsNot Nothing Then
                If dt.Rows.Count > 0 Then
                    result = dt.Rows(0)("sSettingsValue").ToString()
                End If

            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString(), True)
        Finally
            If oDB IsNot Nothing Then
                oDB.Disconnect()
                oDB.Dispose()
                oDB = Nothing
            End If
            If dt IsNot Nothing Then
                dt.Dispose()
                dt = Nothing
            End If
        End Try

        Return result

    End Function
    'Public Sub openCDA(ByVal PatientID As Int64)

    '    Try
    '        Dim objfrm As New frmCCDAGenerateList(PatientID)
    '        With objfrm
    '            .nCDAFileType = CDAFileTypeEnum.CareRecordSummary
    '            .nOrderId = 0
    '            .sDetail = "Order"
    '        End With
    '        'objfrm()

    '        With objfrm
    '            .WindowState = FormWindowState.Normal
    '            .ChkAll.Checked = True
    '            .CallFromSecureInbox = True
    '            ' .TopMost = True
    '            .ShowInTaskbar = False
    '            .BringToFront()
    '            .ShowDialog(Me)
    '        End With
    '        If Not IsNothing(objfrm) Then
    '            objfrm.Dispose()
    '            objfrm = Nothing
    '        End If
    '    Catch ex As Exception
    '        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
    '    End Try
    'End Sub

    Public Sub openCDA(ByVal OrderID As Int64, ByVal Details As String, Optional ByVal nContactID As Long = 0, Optional ByVal DisablePreferredProvider As Boolean = False, Optional ByVal PatientID As Int64 = 0)

        Try

            Dim objfrm As New frmCCDAGenerateList(gnPatientID)

            objfrm.nCDAFileType = CDAFileTypeEnum.CareRecordSummary
            objfrm.nOrderId = OrderID
            objfrm.sDetail = Details
            objfrm.ContactID = nContactID
            objfrm.DisablePreferredProvider = DisablePreferredProvider

            With objfrm
                .WindowState = FormWindowState.Normal
                ''.ChkAll.Checked = True
                .rbSelectAllNormal.Checked = True
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With
            If Not IsNothing(objfrm) Then
                objfrm.Dispose()
                objfrm = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub ModifyOrder(ByVal sender As String, ByVal OrderID As Int64)

        Try

            If gblnProviderDisable = True Then  ''added for bugid 74932 to solve providerid 0 problem
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            If sender = "View Order" Then ''''''''''


                Dim frm As New frmViewgloLab(OrderID, gnPatientID)
                'Code added for Already lab order Is open
                If (frm.CheckInstance() = True) Then   ''added for bugid 70331
                    MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    frm.Close()
                    If (IsNothing(frm) = False) Then
                        frm.Dispose()
                        frm = Nothing
                    End If

                    Exit Sub
                End If

                frm.MdiParent = Me
                frm.SelectOrderTab = True
                frm.WindowState = FormWindowState.Maximized

                AddHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD

                'Reason: To Open the Patient Letter & Referral Letter
                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                AddHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                AddHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                AddHandler frm.Activated, AddressOf frmViewgloLab_Activated
                AddHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                AddHandler frm.EntOpenEducation, AddressOf OpenEducation
                AddHandler frm.FormClosed, AddressOf ofrmViewgloLab_openEducationFormClosed
                frm.objgloLabPatientExam = New clsPatientExams

                frm.objgloLabPatientMessages = New clsMessage
                frm.objgloLabPatientLetters = New clsPatientLetters
                frm.objgloLabNurseNotes = New clsNurseNotes
                frm.objgloLabHistory = New clsPatientHistory
                frm.objgloLabLabs = New clsLabs
                frm.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                frm.objgloLabRxmed = New clsPatientDetails
                frm.objgloLabOrders = New clsPatientDetails
                frm.objgloLabProblemList = New clsPatientProblemList

                frm.objgloLabCriteria = New DocCriteria
                frm.objgloLabWord = New clsWordDocument

                frm.LoginProviderID = gnLoginProviderID
                ''added for Bug #68475:  
                With frm.LabOrderParameter
                    .IsEditMode = False
                    .OrderID = OrderID
                    .OrderNumberID = 0
                    .OrderNumberPrefix = "ORD"
                    .PatientID = gnPatientID
                    .VisitID = GenerateVisitID(gnPatientID)
                    .TransactionDate = Now
                    .CloseAfterSave = True

                End With
                Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
                objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn
                frm.VisitID = gnVisitID
                frm.clsSplit_Laborder = objclsSplit_Laborder

                frm.Show()

                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False



            ElseIf sender = "Modify Order" Then  ''added to modify order

                

                Dim frm As New frmViewgloLab(OrderID, gnPatientID)
                GetControlSelection()
                GridSelect_RowCount = C1dgPatientDetails.Rows.Count
                'Code added for Already lab order Is open
                If (frm.CheckInstance() = True) Then   ''added for bugid 70331
                    MessageBox.Show("A Lab Order screen is already open. Please close that to continue", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    frm.Close()
                    If (IsNothing(frm) = False) Then
                        frm.Dispose()
                        frm = Nothing
                    End If

                    Exit Sub
                End If

                frm.MdiParent = Me
                frm.SelectOrderTab = True
                frm.WindowState = FormWindowState.Maximized

                AddHandler frm.EventCDA, AddressOf mdlGeneral.OpenCDA

                AddHandler frm.EvntGenerateCCDHandler, AddressOf openCCD

                'Reason: To Open the Patient Letter & Referral Letter
                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                AddHandler frm.EvntOpenClinicalChart, AddressOf OpenClinicalChart
                AddHandler frm.EvntOpenPlanOfTreatment, AddressOf OpenPlanofTreatment
                AddHandler frm.Activated, AddressOf frmViewgloLab_Activated
                AddHandler frm.EvntGenerateCDAHandler, AddressOf openCDA
                ''Bug No 57350::Patient InfoButton - Applicatipn not able to open Patient spacific & Provider Spacific Document
                AddHandler frm.EntOpenEducation, AddressOf OpenEducation
                AddHandler frm.FormClosed, AddressOf ofrmViewgloLab_openEducationFormClosed
                frm.objgloLabPatientExam = New clsPatientExams

                frm.objgloLabPatientMessages = New clsMessage
                frm.objgloLabPatientLetters = New clsPatientLetters
                frm.objgloLabNurseNotes = New clsNurseNotes
                frm.objgloLabHistory = New clsPatientHistory
                frm.objgloLabLabs = New clsLabs
                frm.objgloLabDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                frm.objgloLabRxmed = New clsPatientDetails
                frm.objgloLabOrders = New clsPatientDetails
                frm.objgloLabProblemList = New clsPatientProblemList

                frm.objgloLabCriteria = New DocCriteria
                frm.objgloLabWord = New clsWordDocument

                frm.LoginProviderID = gnLoginProviderID
                ''added for Bug #68475:  
                With frm.LabOrderParameter
                    .IsEditMode = False
                    .OrderID = OrderID
                    .OrderNumberID = 0
                    .OrderNumberPrefix = "ORD"
                    .PatientID = gnPatientID
                    .VisitID = GenerateVisitID(gnPatientID)
                    .TransactionDate = Now
                    .CloseAfterSave = True

                End With
                ''changes added for split control functionality in orders&results
                Dim objclsSplit_Laborder As New gloEMRGeneralLibrary.clsSplitScreen()
                objclsSplit_Laborder.blnShowSmokingStatusCol = gblnShowSmokingColumn
                frm.VisitID = gnVisitID
                frm.clsSplit_Laborder = objclsSplit_Laborder

                frm.Show()
                frm.ShowModifyOrderFromDashboard()

                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False


            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub







    Private Sub cmnuItem_CompleteTask_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmnuItem_CompleteTask.Click
        'Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        'Try
        '    Dim TaskId As Int64 = Convert.ToInt64(C1UserTasks.GetData(C1UserTasks.Row, Col_Task_TaskID))
        '    Dim Percentage As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
        '    If TaskId > 0 Then
        '        Dim rowsel As Integer = 0
        '        Dim rowcnt As Integer = 0
        '        rowcnt = C1UserTasks.Rows.Count ''added for problem 00000315 to show selected task v8020 
        '        rowsel = C1UserTasks.RowSel

        '        ogloTask.ModifyTaskComplete(TaskId, 100)
        '        ShowTasks()
        '        If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
        '            Call Fill_PatientTasks(gnPatientID)
        '        End If

        '        If rowcnt <> C1UserTasks.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
        '            rowsel -= 1
        '        End If

        '        If C1UserTasks.Rows.Count > rowsel Then ''added condition for problem 00000315 to show selected task v8020 
        '            C1UserTasks.Select(rowsel, 0)
        '        End If

        '    End If
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'Finally
        '    ogloTask.Dispose()
        'End Try

        Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        Try
            Dim SelectedFilter As String = ""
            SelectedFilter = cmbFilters.Text
            TaskGroupBeforeRightClick = True
            Dim TaskId As Int64 = Convert.ToInt64(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"))
            Dim Percentage As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
            If TaskId > 0 Then
                Dim rowsel As Integer = 0
                Dim rowcnt As Integer = 0
                rowcnt = _flexGroup.Grid.Rows.Count ''added for problem 00000315 to show selected task v8020 
                rowsel = _flexGroup.Grid.RowSel

                If ogloTask.ModifyTaskComplete(TaskId, 100) = True Then
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Task, gloAuditTrail.ActivityCategory.Task, gloAuditTrail.ActivityType.Modify, "Patient Task Completed", Convert.ToInt64(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "PatientId")), TaskId, Convert.ToInt64(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "nProviderId")), gloAuditTrail.ActivityOutCome.Success)
                End If
                ShowTasks()
                If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
                    Call Fill_PatientTasks(gnPatientID)
                End If

                'If rowcnt <> _flexGroup.Grid.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
                '    rowsel -= 1
                'End If
                'If _flexGroup.Grid.Rows.Count > rowsel And rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                '    If _flexGroup.Grid.Rows(rowsel).IsNode Then
                '        rowsel = rowsel + 1
                '    End If
                '    _flexGroup.Grid.Select(rowsel, 0)
                'Else
                '    _flexGroup.Grid.Select(_flexGroup.Grid.Rows.Count - 1, 0)
                'End If
                Dim _taskPatientId As Int64 = 0
                If Not IsNothing(_flexGroup.Grid.DataSource) Then
                    If _flexGroup.Grid.Rows.Count > 2 Then
                        If _flexGroup.Grid.Row > 0 Then
                            _taskPatientId = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "PatientID"), Int64)
                            If (_taskPatientId <> gnPatientID) AndAlso _taskPatientId > 0 Then
                                If (pnlPatientList.Visible) Then
                                    gnPatientID = _taskPatientId
                                    Call SelectPatientOnDashboard(gnPatientID)
                                End If
                            End If
                        End If
                    End If
                End If
                '_flexGroup.Groups = SelectedFilter
                'cmbFilters.Text = SelectedFilter
                TaskGroupBeforeRightClick = False
                'If _flexGroup.Grid.Rows.Count > rowsel And rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                '    If _flexGroup.Grid.Rows(rowsel).IsNode Then
                '        rowsel = rowsel + 1
                '    End If
                '    _flexGroup.Grid.Select(rowsel, 0)
                'Else
                '    _flexGroup.Grid.Select(_flexGroup.Grid.Rows.Count - 1, 0)
                'End If
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ogloTask.Dispose()
        End Try
    End Sub

    Private Sub cmnuItem_RejectTask_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmnuItem_RejectTask.Click
        'If MessageBox.Show("Decline selected task request?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.No Then
        '    Exit Sub
        'End If
        'Dim ogloTask As New gloTaskMail.gloTask(GetConnectionString)
        'Dim tempTaskID As Int64
        'Try
        '    tempTaskID = CType(C1UserTasks.GetData(C1UserTasks.Row, Col_Task_TaskID), Int64)
        '    Dim rowsel As Integer = 0
        '    Dim rowcnt As Integer = 0
        '    rowcnt = C1UserTasks.Rows.Count ''added for problem 00000315 to show selected task v8020 
        '    rowsel = C1UserTasks.RowSel

        '    'Decline Task Request if selected for decline
        '    If ogloTask.DeclineTask(tempTaskID, gnLoginID) = False Then
        '        MessageBox.Show("Error : Decline unsuccessful.  ", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        '        Exit Sub
        '    End If
        '    ShowTasks()
        '    If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
        '        Call Fill_PatientTasks(gnPatientID)
        '    End If
        '    If rowcnt <> C1UserTasks.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
        '        rowsel -= 1
        '    End If

        '    If C1UserTasks.Rows.Count > rowsel Then ''added condition for problem 00000315 to show selected task v8020 
        '        C1UserTasks.Select(rowsel, 0)
        '    End If


        '    If Not IsNothing(ogloTask) Then  ''slr free ogloTask
        '        ogloTask.Dispose()
        '        ogloTask = Nothing
        '    End If
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'End Try

        If MessageBox.Show("Decline selected task request?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.No Then
            Exit Sub
        End If
        Dim ogloTask As New gloTaskMail.gloTask(GetConnectionString)
        Dim tempTaskID As Int64
        Try
            tempTaskID = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"), Int64)
            Dim rowsel As Integer = 0
            Dim rowcnt As Integer = 0
            rowcnt = _flexGroup.Grid.Rows.Count ''added for problem 00000315 to show selected task v8020 
            rowsel = _flexGroup.Grid.RowSel

            'Decline Task Request if selected for decline
            If ogloTask.DeclineTask(tempTaskID, gnLoginID) = False Then
                MessageBox.Show("Error : Decline unsuccessful.  ", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                Exit Sub
            End If
            ShowTasks()
            If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
                Call Fill_PatientTasks(gnPatientID)
            End If
            'If rowcnt <> _flexGroup.Grid.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
            '    rowsel -= 1
            'End If

            If _flexGroup.Grid.Rows.Count > rowsel AndAlso rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                If _flexGroup.Grid.Rows(rowsel).IsNode Then
                    rowsel = rowsel + 1
                End If
                _flexGroup.Grid.Select(rowsel, 0)
            Else
                _flexGroup.Grid.Select(_flexGroup.Grid.Rows.Count - 1, 0)
            End If

            If Not IsNothing(ogloTask) Then  ''slr free ogloTask
                ogloTask.Dispose()
                ogloTask = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub cmnuItem_TrackTasks_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmnuItem_TrackTasks.Click
        Try
            Dim ofrmTrackTask As New gloTaskMail.frmTrackTask()
            ofrmTrackTask.ShowDialog(IIf(IsNothing(ofrmTrackTask.Parent), Me, ofrmTrackTask.Parent))
            'SLR: Dispsoe
            If Not IsNothing(ofrmTrackTask) Then
                ofrmTrackTask.Dispose()
            End If
            ofrmTrackTask = Nothing
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub mnuPatientVitalUsageReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientVitalUsageReport.Click
        Try
            ShowSSRSReport("rptPatientVitalUsage", "Patient Vital Usage Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Dim frmSSRS As gloEMRReports.frmSSRSViewer

    Private Sub ShowSSRSReport(ByVal ReportName As String, ByVal ReportTitle As String, ByVal blnIsgloStreamReport As Boolean)
        Try
            If Not IsNothing(frmSSRS) Then  ''slr free frmssrs before allocating
                Try
                    RemoveHandler frmSSRS.SendReminder_Letter, AddressOf SendReminder_Click
                Catch ex As Exception

                End Try

                frmSSRS.Dispose()
                frmSSRS = Nothing
            End If
            frmSSRS = New gloEMRReports.frmSSRSViewer(gstrSQLServerName, gstrDatabaseName, gblnSQLAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR)

            ''8020 Code Review: delegate commented as suggested
            ''Dummy events written gloEMRReports.frmSSRSViewer.GenerateReport_Click, email dt: 05-05-2014 Sub: Please update 
            ''AddHandler frmSSRS.GenerateReport_Click, AddressOf GenerateReport_Click
            ''8020 Code Review: 

            AddHandler frmSSRS.SendReminder_Letter, AddressOf SendReminder_Click
            frmSSRS.reportName = ReportName
            frmSSRS.gstrProblemtype = gstrSMProblem
            frmSSRS.Conn = GetConnectionString()
            frmSSRS.StrSnoConnstring = GetHybridConnectionString(gstrSMDBServerName, gstrSMDBDatabaseName, gblnSMDBAuthen, gstrSMDBUserID, gstrSMDBPassWord)
            frmSSRS.reportTitle = ReportTitle
            frmSSRS.ICD10Transition = gblnIcd10Transition  '' added for ICD10 implementation
            frmSSRS.IsgloStreamReport = blnIsgloStreamReport
            frmSSRS.DefaultProviderID = gnLoginProviderID
            If gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
                frmSSRS.gblnPatientPortalEnabled = True
                frmSSRS.gblnIntuitCommunication = True
            End If
            frmSSRS.MdiParent = Me
            frmSSRS.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub SendReminder_Click(ByVal sender As Object, ByVal e As EventArgs, ByVal _ePat As gloEMRReports.PatientArgs)
        If (CheckReminderPrintProcessRunning() = False) Then
            Dim ofrmREminder As New frmRpt_ReminderPatientLetter(Me)
            ofrmREminder._dtPat = _ePat.dtPatients


            ' AddHandler ofrmREminder.onPrintMenuEventclick, AddressOf PrintMenuEventclick
            ofrmREminder.ShowDialog(IIf(IsNothing(ofrmREminder.Parent), Me, ofrmREminder.Parent))

            'Try
            '    RemoveHandler ofrmREminder.onPrintMenuEventclick, AddressOf PrintMenuEventclick
            'Catch ex As Exception

            'End Try
            'SLR: Dispsoe
            If Not IsNothing(ofrmREminder) Then
                ofrmREminder.Dispose()
                ofrmREminder = Nothing
            End If
        End If
    End Sub
    Private Function CheckReminderPrintProcessRunning() As Boolean
        Try


            For Each oFrm As Form In System.Windows.Forms.Application.OpenForms

                If oFrm.Name = "frmgloPrintWordReminderProgressController" Then

                    MessageBox.Show("There is already a print job in progress. Please cancel the job in progress if another print needs to be sent.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    oFrm.Visible = True
                    oFrm.BringToFront()

                    Return True
                    Exit For


                End If
            Next
            Return False
        Catch ex As Exception
            ex = Nothing
            Return False
        End Try
    End Function
    Private Sub GenerateReport_Click(ByVal sender As Object, ByVal e As EventArgs, ByVal eSSRS As gloEMRReports.SSRSArgs)
        frmSSRS.sPatientIDs = frmdmsetuprpt.getlistcode(eSSRS.sCriteriaID)
    End Sub

    Private Sub mnuAllergyUsageReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuAllergyUsageReport.Click
        Try
            ShowSSRSReport("AllergyUsageReport", "Patient Allergy Usage Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuProblemUsageReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuProblemUsageReport.Click
        Try
            ShowSSRSReport("ProblemUsageReport", "Patient Problem Usage Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuDemographicUsageReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuDemographicUsageReport.Click
        Try
            ShowSSRSReport("DemographicUsageReport", "Patient Demographic Usage Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMedicationUsagereport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuMedicationUsagereport.Click
        Try
            ShowSSRSReport("rptMedicationMU", "Patient Medication Usage Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuEprescribingreport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuEprescribingreport.Click
        Try
            ShowSSRSReport("rpteRx", "Patient EPrescribing Usage Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuHistoryUsageReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuHistoryUsageReport.Click
        Try
            ShowSSRSReport("rptPatientHistoryUsage", "Patient History Usage Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub picPC_Cards_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles picPC_Cards.Click
    End Sub

    Private Sub tsbtn_Vital_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tsbtn_Vital.Click
    End Sub

    Private Sub pnlNav_UnfinishedExams_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles pnlNav_UnfinishedExams.Click
        ShowUnfinishedExams()
    End Sub

    Private Sub QualityMeasureDashboardToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles QualityMeasureDashboardToolStripMenuItem.Click
        Try
            Dim ofrm As New gloMU.frm_MU_Reports
            ofrm.MdiParent = Me

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Public ReadOnly Property SelectedPatientOnDashboard() As Long
        Get
            SelectedPatientOnDashboard = gnPatientID
        End Get
    End Property

    '27-Aug-13 Aniket: Creation of a new Dashboard for Stage 2
    Private Sub mnuMUDashboard2_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuMUDashboard_Stage2.Click
        Try
            Dim ofrm As New gloMU.frm_MU_ViewDashboard_Stage2
            ofrm.MdiParent = Me

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub mnuMUDashboard2_modified_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuMUDashboard_Stage2_Mod.Click
        Try
            Dim ofrm As New gloMU.frm_MU_ViewDashboard_Stage2_Modified
            ofrm.MdiParent = Me

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMUDashboard3_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuMUDashboard_Stage3.Click
        Try
            Dim ofrm As New gloMU.frm_ViewStage3
            ofrm.MdiParent = Me

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    '10-Sep-13 Aniket: Creation of a new Dashboard for Stage 1
    Private Sub mnuMUDashboard1_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuMUDashboard_Stage1.Click
        Try
            Dim ofrm As New gloMU.frm_MU_ViewDashboard_Stage1
            ofrm.MdiParent = Me

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuMUDashboard_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuMUDashboard.Click
        Try
            Dim ofrm As New gloMU.frm_MU_ViewDashboard
            ofrm.MdiParent = Me

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Added by kanchan on 20101020 for view patient CCD/CCR files Report
    Private Sub mnuViewAllCCDCCRFiles_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuViewAllCCDCCRFiles.Click
        Try
            Dim ofrm As New frmCCD_ViewFiles

            ofrm.SelectedPatientID = 0
            ofrm.MdiParent = Me
            ofrm.ShowInTaskbar = False
            ofrm.WindowState = FormWindowState.Maximized

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            ofrm.BringToFront()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try
    End Sub

    Public Sub GetUserSpeciality()

        Dim con As New SqlConnection(gloEMR.mdlGeneral.GetConnectionString())
        Dim query As String = " SELECT ISNULL(sSpeciality,'') AS Speciality from User_MST where sLoginName = '" & gstrLoginName.Replace("'", "''") & "'"
        Dim cmd1 As New SqlCommand(query, con)
        Dim adp As New SqlDataAdapter(cmd1)
        Dim dtProvider As New DataTable
        adp.Fill(dtProvider)
        If Not IsNothing(dtProvider) Then
            If dtProvider.Rows.Count > 0 Then
                gstrSpeciality = dtProvider.Rows(0)("Speciality").ToString()
            Else
                gstrSpeciality = ""
            End If
        Else
            gstrSpeciality = ""
        End If
        If Not IsNothing(dtProvider) Then
            dtProvider.Dispose()
            dtProvider = Nothing
        End If
        If Not IsNothing(adp) Then
            adp.Dispose()
            adp = Nothing
        End If
        If Not IsNothing(cmd1) Then
            cmd1.Parameters.Clear()
            cmd1.Dispose()
            cmd1 = Nothing
        End If
        If Not IsNothing(con) Then
            con.Dispose()
            con = Nothing
        End If
    End Sub

    Private Sub mnuPatientReminder_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuPatientReminder.Click
        ShowSSRSReport("rptPatientListDM", "Patient Reminder", True)
    End Sub

    Private Sub CustomizableReportsToolStripMenuItem_MouseHover(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CustomizableReportsToolStripMenuItem.MouseHover

        If CustomizableReportsToolStripMenuItem.DropDownItems.Count = 0 Then
            CustomizableReportsToolStripMenuItem.DropDownItems.Clear()
            subItemSSRS = New ToolStripMenuItem("Customize Reports", imgList_Common.Images(22), AddressOf CustomizableReportsMnuItemClicked)
            AddHandler subItemSSRS.MouseHover, AddressOf MnuSubItemMouseHover
            subItemSSRS.Tag = "Create Customizable Reports"
            CustomizableReportsToolStripMenuItem.DropDownItems.Add(subItemSSRS)
        End If
        If Not IsNothing(subItemSSRS) Then
            FillExistingSSRS(subItemSSRS)
        End If

    End Sub

    Private Sub MnuSubItemClickedSSRS(ByVal sender As Object, ByVal e As EventArgs)
        Dim oCurrentMenu As ToolStripMenuItem = CType(sender, ToolStripMenuItem)
        Try
            Dim sRptNm As String = ""
            sRptNm = oCurrentMenu.Tag.ToString()
            Dim ofrmShowReport As New gloReports.frmCustomReports(GetConnectionString(), sRptNm)
            ofrmShowReport.MdiParent = Me
            ofrmShowReport.WindowState = FormWindowState.Maximized
            ofrmShowReport.ShowInTaskbar = False
            ofrmShowReport.StartPosition = FormStartPosition.CenterParent
            ofrmShowReport.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.Message.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try
    End Sub

    Private Sub MnuSubItemMouseHover(ByVal sender As Object, ByVal e As EventArgs)
        Dim oCurrentMenu As ToolStripMenuItem = CType(sender, ToolStripMenuItem)
        Try
            If oCurrentMenu.Tag.ToString() = "Create Customizable Reports" Then
                'FillExistingSSRS(oCurrentMenu)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.Message.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try
    End Sub

    Private Sub CustomizableReportsMnuItemClicked(ByVal sender As Object, ByVal e As EventArgs)
        Dim oCurrentMenu As ToolStripMenuItem = CType(sender, ToolStripMenuItem)
        Try
            ''code commented in 8050, added ReportService2010 web reference....as per internal discussion with team, for checking report builder issue not working with sql 2012.
            ''Dim rs As New ReportingService2005
            ''Dim AddSplitter As Boolean = False
            ''Dim itemReports As CatalogItem() = Nothing
            ''Dim itm As CatalogItem = Nothing
            ''Dim cred As System.Net.ICredentials = Nothing

            Dim rs As New ReportService2010.ReportingService2010
            Dim AddSplitter As Boolean = False
            Dim itemReports As ReportService2010.CatalogItem() = Nothing
            Dim itm As ReportService2010.CatalogItem = Nothing
            Dim cred As System.Net.ICredentials = Nothing

            Dim _databaseconnectionstring As String = ""

            Dim sReportProtocol As String = String.Empty
            Dim sReportserver As String = String.Empty
            Dim sReportFolder As String = String.Empty
            Dim sVirtualDir As String = String.Empty

            _databaseconnectionstring = appSettings("DataBaseConnectionString").ToString()
            If ChkSettings() = False Then Return
            Dim oSetting As New gloSettings.GeneralSettings(_databaseconnectionstring)
            Dim oValue As New Object()

            oSetting.GetSetting("ReportProtocol", oValue)
            If oValue IsNot Nothing Then
                sReportProtocol = oValue.ToString()
                oValue = Nothing
            End If

            oSetting.GetSetting("ReportServer", oValue)
            If oValue IsNot Nothing Then
                sReportserver = oValue.ToString()
                oValue = Nothing
            End If

            oSetting.GetSetting("CustomizedReportFolder", oValue)
            If oValue IsNot Nothing Then
                sReportFolder = oValue.ToString()
                oValue = Nothing
            End If

            oSetting.GetSetting("ReportVirtualDirectory", oValue)
            If oValue IsNot Nothing Then
                sVirtualDir = oValue.ToString()
                oValue = Nothing
            End If


            sReportFolder = "/" & sReportFolder
            rs.Credentials = System.Net.CredentialCache.DefaultCredentials

            ''code commented in 8050, added ReportService2010 web reference....as per internal discussion with team, for checking report builder issue not working with sql 2012.
            ''Dim lnk As String = sReportProtocol + "://" + sReportserver + "/" + sVirtualDir + "/ReportService2005.asmx"
            Dim lnk As String = sReportProtocol + "://" + sReportserver + "/" + sVirtualDir + "/ReportService2010.asmx"

            rs.Url = lnk
            itemReports = rs.ListChildren(sReportFolder, True)
            If itemReports.Count() = 0 Then
                Return
            End If
            Dim IsModelExists As Boolean = False

            ''code commented in 8050, added ReportService2010 web reference....as per internal discussion with team, for checking report builder issue not working with sql 2012.
            ''For Each itms As CatalogItem In itemReports
            ''    If itms.Type.ToString() = "Model" Then
            ''        If itms.Name = "DataDictionary" Then
            ''            IsModelExists = True
            ''            Exit For
            ''        End If
            ''    End If
            ''Next

            For Each itms As ReportService2010.CatalogItem In itemReports
                If itms.TypeName.ToString() = "Model" Then
                    If itms.Name = "DataDictionary" Then
                        IsModelExists = True
                        Exit For
                    End If
                End If
            Next

            If IsModelExists = False Then
                MessageBox.Show("Customized Report Folder Path not set OR " & vbCrLf & """DataDictionary"" does not exist in the Customized Report Folder.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                Return
            End If
            itemReports = Nothing
            Dim ofrmShowReport As New gloReports.frmCustomReports(GetConnectionString(), "", gstrSQLServerName, gstrDatabaseName, gblnSQLAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR)
            ofrmShowReport.WindowState = FormWindowState.Normal
            ofrmShowReport.StartPosition = FormStartPosition.CenterScreen
            ofrmShowReport.BringToFront()
            ofrmShowReport.ShowDialog(IIf(IsNothing(ofrmShowReport.Parent), Me, ofrmShowReport.Parent))
            ofrmShowReport.Close()
            ''slr dispose ofrmshowreport
            If Not IsNothing(ofrmShowReport) Then
                ofrmShowReport.Dispose()
            End If
            ofrmShowReport = Nothing
            ShowHideMainMenu(True, True)
            If Not IsNothing(oSetting) Then  ''slr free oSetting
                oSetting.Dispose()
                oSetting = Nothing
            End If
            If Not IsNothing(rs) Then  ''Slr free rs
                rs.Dispose()
                rs = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.Message.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try
    End Sub

    Private Sub FillExistingSSRS(ByVal oCurrentMenu As ToolStripMenuItem)
        Try
            Dim rs As New ReportingService2005
            Dim AddSplitter As Boolean = False
            Dim itemReports As CatalogItem() = Nothing
            Dim itm As CatalogItem = Nothing
            Dim cred As System.Net.ICredentials = Nothing


            Dim _databaseconnectionstring As String = ""

            Dim sReportProtocol As String = String.Empty
            Dim sReportserver As String = String.Empty
            Dim sReportFolder As String = String.Empty
            Dim sVirtualDir As String = String.Empty

            _databaseconnectionstring = appSettings("DataBaseConnectionString").ToString()

            If ChkSettings() = False Then Return

            Dim oSetting As New gloSettings.GeneralSettings(_databaseconnectionstring)

            Dim oValue As New Object()

            oSetting.GetSetting("ReportProtocol", oValue)
            If oValue IsNot Nothing Then
                sReportProtocol = oValue.ToString()
                oValue = Nothing
            End If

            oSetting.GetSetting("ReportServer", oValue)
            If oValue IsNot Nothing Then
                sReportserver = oValue.ToString()
                oValue = Nothing
            End If

            oSetting.GetSetting("CustomizedReportFolder", oValue)
            If oValue IsNot Nothing Then
                sReportFolder = oValue.ToString()
                oValue = Nothing
            End If

            oSetting.GetSetting("ReportVirtualDirectory", oValue)
            If oValue IsNot Nothing Then
                sVirtualDir = oValue.ToString()
                oValue = Nothing
            End If

            sReportFolder = "/" & sReportFolder
            rs.Credentials = System.Net.CredentialCache.DefaultCredentials
            Dim lnk As String = sReportProtocol + "://" + sReportserver + "/" + sVirtualDir + "/ReportService2005.asmx"
            rs.Url = lnk
            itemReports = rs.ListChildren(sReportFolder, True)

            If itemReports.Count() = 0 Then
                Return
            End If

            Dim Toolitems As ToolStripMenuItem = Nothing
            oCurrentMenu.DropDownItems.Clear()

            For Each itms As CatalogItem In itemReports
                If itms.Type.ToString() = "Report" Then
                    Toolitems = New ToolStripMenuItem()
                    Dim srnm As String = itms.Name.ToString()
                    If srnm.Substring(0, 3).ToLower() = "rpt" Then
                        srnm = srnm.Replace("Rpt", "Report")
                    Else
                        srnm = srnm  ''"CCHIT - " &
                    End If

                    Dim sReportName As String = srnm
                    Toolitems.Name = itms.Name.ToString()
                    Toolitems.Tag = itms.Name.ToString()
                    Dim subItemSSRS As New ToolStripMenuItem(itms.Name.ToString(), imgList_Common.Images(21), AddressOf MnuSubItemClickedSSRS)
                    subItemSSRS.Tag = itms.Name.ToString()
                    subItemSSRS.Image = imgList_Common.Images(23)
                    oCurrentMenu.DropDownItems.Add(subItemSSRS)
                End If
            Next

            If Not IsNothing(oSetting) Then  ''slr free oSetting
                oSetting.Dispose()
                oSetting = Nothing
            End If
            If Not IsNothing(rs) Then  ''Slr free rs
                rs.Dispose()
                rs = Nothing
            End If
        Catch ex As Exception
            MessageBox.Show(ex.Message.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK)
        End Try
    End Sub

    Private Function ChkSettings() As Boolean
        Dim _dbconnectionstring As String = ""
        _dbconnectionstring = appSettings("DataBaseConnectionString").ToString()
        Dim oSetting As New gloSettings.GeneralSettings(_dbconnectionstring)
        Try

            Dim sReportserver As String = String.Empty
            Dim sReportFolder As String = String.Empty

            Dim oValue As New Object()
            oSetting.GetSetting("ReportServer", oValue)
            If oValue IsNot Nothing Then
                sReportserver = oValue.ToString()
                oValue = Nothing
            End If

            oSetting.GetSetting("CustomizedReportFolder", oValue)
            If oValue IsNot Nothing Then
                sReportFolder = oValue.ToString()
                oValue = Nothing
            End If

            If sReportserver = "" Or sReportFolder = "" Then
                MessageBox.Show("SSRS Settings not set OR Customized Report Folder Path not set.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Warning)
                Return False
            End If
            Return True
        Catch

            If Not IsNothing(oSetting) Then  ''slr free oSetting
                oSetting.Dispose()
                oSetting = Nothing
            End If

            Return False
        Finally
            If Not IsNothing(oSetting) Then  ''slr free oSetting
                oSetting.Dispose()
                oSetting = Nothing
            End If
        End Try
    End Function

    Private Sub mnuChangePass_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuChangePass.Click
        Dim objchpass As New frm_changepass(gnPatientID)
        objchpass.StartPosition = FormStartPosition.CenterScreen
        objchpass.ShowInTaskbar = False
        If objchpass.ShowDialog(IIf(IsNothing(objchpass.Parent), Me, objchpass.Parent)) = Windows.Forms.DialogResult.OK Then
            LogOut()
        End If
        objchpass.Dispose()
        objchpass = Nothing
    End Sub

    Private Sub mnu_Patient_list_report_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnu_Patient_list_report.Click
        Try
            ShowSSRSReport("rptPatientList", "Patient List", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ''Added by madan for healthvault menu on 20101025
    Private Sub HealthVaultToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles HealthVaultToolStripMenuItem.Click
        Try
            Dim ofrm_gloVaultMenu As New frm_gloVaultMenu(gnPatientID)
            ofrm_gloVaultMenu.ShowInTaskbar = False
            ofrm_gloVaultMenu.BringToFront()
            ofrm_gloVaultMenu.ShowDialog(IIf(IsNothing(ofrm_gloVaultMenu.Parent), Me, ofrm_gloVaultMenu.Parent))
            ofrm_gloVaultMenu.Dispose()
        Catch ex As Exception
            MessageBox.Show("gloValut:" & ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Call Batch Print Template functionality 
    Private Sub mnuBatchPrintTemplates_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuBatchPrintTemplates.Click
        Try
            Dim ofrm As New gloOffice.frmBatchPrinting(GetConnectionString)
            With ofrm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .ShowInTaskbar = False
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub btnYesClose_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnYesClose.Click
        pnlMainPatientCardButton.BringToFront()
        pnlYESLAB.SendToBack()
        pnlPatientCard.Text = "Patient Cards"
        FillCardInformation()
    End Sub

#Region "Medication CheckBox"
#Region "Global variable"
    Dim _isSearchFlagFromShowPatientDetails As Boolean = False
    Dim _Semaphore As Boolean = False
    Dim textSemaphore As Boolean = False
    Dim _isTextchanged As Boolean = False
    Dim _isReset As Boolean = False
    Dim sToolStripClicked As String = ""
    Dim _cmbStatusToActive As Boolean = False

#End Region

#Region "Public Function"

    Private Sub btnReset_MouseHover(ByVal sender As System.Object, ByVal e As System.EventArgs) 'Handles btnReset.MouseHover
        btnReset.BackgroundImage = Global.gloEMR.My.Resources.Resources.Img_LongYellow
        btnReset.BackgroundImageLayout = ImageLayout.Stretch

    End Sub

    Private Sub btnReset_MouseLeave(ByVal sender As Object, ByVal e As System.EventArgs) 'Handles btnReset.MouseLeave
        btnReset.BackgroundImage = Global.gloEMR.My.Resources.Resources.Img_LongButton
        btnReset.BackgroundImageLayout = ImageLayout.Stretch
    End Sub

    Private Sub btnReset_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) 'Handles btnReset.Click
        '' This function will Reset the Filter criteria & load the list as per default filters
        Call ShowPatientDetails(True)
    End Sub


    ''to Set the reset button on the on the Medication
    Public Sub ResetButton(ByVal SelectedPatientDetail As PatientDetails)
        If SelectedPatientDetail = PatientDetails.Medication Then
            btnReset.Visible = True
        Else
            btnReset.Visible = False
            textSemaphore = False            ''start :: Dated :: 10/18/2010 (On others PatientDetail (tab) not able to search
        End If
    End Sub


    Private Sub dtpToDate_TextChanged(ByVal sender As Object, ByVal e As System.EventArgs) ''Handles dtpToDate.TextChanged
        RaiseEvent SearchFilterChanged(enumFilterCriteria.ToDate)
    End Sub

    ''To check the status of the if is is check or not
    Public Sub IsDPTCheckedChanged()
        AddHandler dtpToDate.TextChanged, AddressOf dtpToDate_TextChanged
        AddHandler dtpFromDate.TextChanged, AddressOf dtpFromDate_TextChanged
    End Sub


    Private Sub dtpToDate_ValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) 'Handles dtpToDate.ValueChanged
    End Sub

    Private Sub SearchFilter_Changed(ByVal UpdatedFilter As enumFilterCriteria)
        ShowPatientDetails(False)
    End Sub

    Private Sub dtpFromDate_TextChanged(ByVal sender As Object, ByVal e As System.EventArgs) '' Handles dtpFromDate.TextChanged
        RaiseEvent SearchFilterChanged(enumFilterCriteria.FromDate)
    End Sub

    'Added by Mayuri:20101118-DropDown was getting closed after changing month:dtformdate:#6125

    Dim _blnFromDate_MouseClicked As Boolean = False

    Private Sub dtpFromDate_CloseUp(ByVal sender As Object, ByVal e As System.EventArgs) 'Handles dtpFromDate.CloseUp
    End Sub

    Dim bln_IsDropDown As Boolean = False

    Private Sub dtpFromDate_DropDown(ByVal sender As Object, ByVal e As System.EventArgs) 'Handles dtpFromDate.DropDown
    End Sub

    Private Sub dtpFromDate_ValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) 'Handles dtpFromDate.ValueChanged
    End Sub


    Private Sub FromDateChanged()
        Try
            ShowPatientDetails(False)
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Exam, gloAuditTrail.ActivityCategory.Notes, gloAuditTrail.ActivityType.General, ex, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show(ex.Message.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Public Sub MedicationDateTimeCheckBox(ByVal sType As String)
        If sType = "Medication" Then
            dtpFromDate.ResetText()
            dtpFromDate.ShowCheckBox = True
            dtpFromDate.Width = 108
            dtpFromDate.Checked = False
            dtpFromDate.Size = New System.Drawing.Size(98, 21)

            dtpToDate.ResetText()
            dtpToDate.ShowCheckBox = True
            dtpToDate.Checked = False
            dtpToDate.Size = New System.Drawing.Size(98, 21)
            _ischkGetLatestActiveMedication = False

        Else
            dtpFromDate.ShowCheckBox = False
            dtpToDate.ShowCheckBox = False
            dtpFromDate.Size = New System.Drawing.Size(87, 21)
            textSemaphore = False
        End If
    End Sub

    Public Sub Search(ByVal dt As DataTable)
        Dim dr As DataRow()
        Try

            Dim _strExpr As String = ""
            Dim _strSort As String = "dtMedicationDate desc"
            If Not IsNothing(dt) Then
                If dt.Rows.Count > 0 Then
                    If Not IsNothing(dt) Then
                        dr = dt.Select("", _strSort)
                        If dr.Length > 0 Then
                            Dim strFirst As String = dr(0)(0)
                            dtpToDate.Text = strFirst
                            Dim strlast As String = dr(dt.Rows.Count - 1)(0)
                            dtpFromDate.Text = strlast
                            dtpToDate.Checked = False
                            dtpFromDate.Checked = False
                        End If
                    End If
                Else
                    dtpToDate.Text = DateTime.Now
                    dtpFromDate.Text = DateTime.Now
                    dtpToDate.Checked = False
                    dtpFromDate.Checked = False
                End If
            End If
        Catch ex As Exception
        Finally
            If Not IsNothing(dt) Then
                dt.Dispose()
                dt = Nothing
            End If
        End Try
    End Sub


#End Region

#End Region

    Private Sub pnlRightFill_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles pnlRightFill.MouseDown
        Try
            Call FillMenus()
            'Try
            '    If (IsNothing(pnlRightFill.ContextMenuStrip) = False) Then
            '        pnlRightFill.ContextMenuStrip.Dispose()
            '        pnlRightFill.ContextMenuStrip = Nothing
            '    End If
            'Catch ex As Exception

            'End Try
           
            pnlRightFill.ContextMenuStrip = cMnuPatient
            FillCheckInCheckOutMenu()
        Catch ex As Exception
            MessageBox.Show(ex.ToString)
        End Try
    End Sub

    Private Sub pnlLeft_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles pnlLeft.MouseDown
        Try
            Call FillMenus()
            'Try
            '    If (IsNothing(pnlLeft.ContextMenuStrip) = False) Then
            '        pnlLeft.ContextMenuStrip.Dispose()
            '        pnlLeft.ContextMenuStrip = Nothing
            '    End If
            'Catch ex As Exception

            'End Try
            
            pnlLeft.ContextMenuStrip = cMnuPatient
            FillCheckInCheckOutMenu()

        Catch ex As Exception
            MessageBox.Show(ex.ToString)
        End Try
    End Sub

    Private Sub AddpnlRightFillMouseHandler(ByVal MainControl As Control)
        Dim Ctrl As Control
        For Each Ctrl In MainControl.Controls
            If Ctrl.Controls.Count = 0 Then
                AddHandler Ctrl.MouseDown, AddressOf pnlRightFill_MouseDown
                Debug.Print(Ctrl.Name)
            Else
                AddpnlRightFillMouseHandler(Ctrl)
            End If
        Next
    End Sub

    Private Sub AddpnlLeftMouseHandler(ByVal MainControl As Control)
        Dim Ctrl As Control
        For Each Ctrl In MainControl.Controls

            If Ctrl.Controls.Count = 0 Then
                AddHandler Ctrl.MouseDown, AddressOf pnlLeft_MouseDown
                Debug.Print(Ctrl.Name)
            Else
                AddpnlLeftMouseHandler(Ctrl)
            End If
        Next
    End Sub

    'Added by madan for RequestAccess
    Private Sub HealthVaultSendRequestAccess_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles HealthVaultSendRequestAccess.Click
        Try
            Dim ofrm_gloVaultMenu As New frm_gloVaultMenu(gnPatientID, True)
            ofrm_gloVaultMenu.ShowInTaskbar = False
            ofrm_gloVaultMenu.BringToFront()
            ofrm_gloVaultMenu.ShowDialog(IIf(IsNothing(ofrm_gloVaultMenu.Parent), Me, ofrm_gloVaultMenu.Parent))
            ofrm_gloVaultMenu.Dispose()
        Catch ex As Exception
            MessageBox.Show("gloValut:" & ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Added by madan for generalmessage queue
    Private Sub mnuGeneralMessageQueue_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuGeneralMessageQueue.Click
        If IsAccess(False) = False Then
            Exit Sub
        End If
        Dim frm As New frmHL7_MessageQueue(1000)
        Try

            frm.MdiParent = Me
            frm.Show()
            frm.WindowState = FormWindowState.Maximized
            frm.BringToFront()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Dim _ischkGetLatestActiveMedication As Boolean = False

    Private Sub chkGetLatestActive_CheckStateChanged(ByVal sender As Object, ByVal e As System.EventArgs) 'Handles chkGetLatestActive.CheckStateChanged
        Try
            If sToolStripClicked = "Medication" Then
                If _isTextchanged = True Then           'Start'Added the Code for the on 20101129
                    If _isTextchanged = True AndAlso chkGetLatestActive.Checked = False Then
                        _ischkGetLatestActiveMedication = True
                        fill_medication()
                    End If
                    Return
                End If
                _ischkGetLatestActiveMedication = True   'End'Added the Code for the on 20101129
                fill_medication()
            End If
        Catch ex As Exception
        End Try
    End Sub

    Private Sub chkenbdate_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) 'Handles chkenbdate.CheckedChanged
        If chkenbdate.Checked = True Then
            dtpFromDate.Enabled = True
            dtpToDate.Enabled = True
            Try


                If (SelectedPatientDetail = PatientDetails.IntuitCommunication) Then
                    dtpToDate.Value = Now.Date
                    Dim sDate As String = ""

                    If Now.Date.Month <= 6 Then
                        sDate = (Now.Date.Month + 6).ToString() + "/" + Now.Date.Day.ToString() + "/" + (Now.Date.Year - 1).ToString()
                    ElseIf Now.Date.Month >= 7 Then
                        sDate = (Now.Date.Month - 6).ToString() + "/" + Now.Date.Day.ToString() + "/" + Now.Date.Year.ToString()
                    End If

                    dtpFromDate.Value = Convert.ToDateTime(sDate).Date

                    cmbStatus.Visible = False
                    txtSearchIntuit.Visible = True
                    Panel14.Width = 295
                    txtSearchIntuit.Focus()

                End If
            Catch ex As Exception

            End Try


        Else
            dtpFromDate.Enabled = False
            dtpToDate.Enabled = False

            RemoveHandler dtpFromDate.TextChanged, AddressOf dtpFromDate_TextChanged
            RemoveHandler dtpToDate.TextChanged, AddressOf dtpToDate_TextChanged

            If (SelectedPatientDetail <> PatientDetails.Medication) Then
                dtpFromDate.Value = Now.Date
                dtpToDate.Value = Now.Date
            End If
            If (SelectedPatientDetail = PatientDetails.IntuitCommunication) Then
                txtSearchIntuit.Visible = True
                Panel14.Width = 295
                cmbStatus.Visible = False
            End If


            AddHandler dtpFromDate.TextChanged, AddressOf dtpFromDate_TextChanged
            AddHandler dtpToDate.TextChanged, AddressOf dtpToDate_TextChanged

        End If
        RaiseEvent SearchFilterChanged(enumFilterCriteria.DateFilterEnable)
    End Sub

    Private Sub C1Appointments_AfterRowColChange(ByVal sender As System.Object, ByVal e As C1.Win.C1FlexGrid.RangeEventArgs) Handles C1Appointments.AfterRowColChange
        If Not e.NewRange.BottomRow.Equals(e.OldRange.BottomRow) Then
            Try

                '' 20110127 - Bug #7715: Test Party issue -Error when clicked on Patient Status color buttons 
                If C1Appointments.Cols.Count <> col_Count Then
                    Exit Sub
                End If

                If C1Appointments.Col >= col_color0 AndAlso C1Appointments.Col <= col_color5 Then
                    C1Appointments.Col = col_PatientName
                End If

                If C1Appointments.Row >= 1 Then
                    If (CType(C1Appointments.GetData(C1Appointments.Row, col_AppPatientID), Int64) <> gnPatientID AndAlso CType(C1Appointments.GetData(C1Appointments.Row, col_AppPatientID), Int64) <> 0) Then
                        If (pnlPatientList.Visible) Then
                            gnPatientID = CType(C1Appointments.GetData(C1Appointments.Row, col_AppPatientID), Int64)
                            Call SelectPatientOnDashboard(gnPatientID)
                        End If
                    End If
                Else
                    'Try
                    '    If (IsNothing(C1Appointments.ContextMenuStrip) = False) Then
                    '        C1Appointments.ContextMenuStrip.Dispose()
                    '        C1Appointments.ContextMenuStrip = Nothing
                    '    End If
                    'Catch ex As Exception

                    'End Try
                    'C1Appointments.ContextMenuStrip = Nothing
                    ClearContextMenuStrip(oPatientListControl.ContextMenuStrip)

                    ClearContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip)

                    ClearContextMenuStrip(C1Appointments.ContextMenuStrip)

                    ClearContextMenuStrip(pnlRightFill.ContextMenuStrip)

                    ClearContextMenuStrip(pnlLeft.ContextMenuStrip)

                    ClearContextMenuStrip(cMnuPatient)

                    AssignContextMenuStrip(oPatientListControl.ContextMenuStrip, cMnuPatient)

                    AssignContextMenuStrip(c1PatientCheckInStatus.ContextMenuStrip, cMnuPatient)

                    AssignContextMenuStrip(C1Appointments.ContextMenuStrip, cMnuPatient)

                    AssignContextMenuStrip(pnlRightFill.ContextMenuStrip, cMnuPatient)

                    AssignContextMenuStrip(pnlLeft.ContextMenuStrip, cMnuPatient)
                End If
            Catch ex As Exception
            End Try
        End If
    End Sub

    ''Added by madan for Lab manifest functionality on 20101215
    Private Sub mnuRpt_LabManifest_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuRpt_LabManifest.Click
        Dim objclsgeneral As New gloEmdeonInterface.Classes.clsGeneral()

        Try
            'The below code is to prevent the form loading more than one time.
            If System.Windows.Forms.Application.OpenForms.Count > 0 Then
                For Each oform As System.Windows.Forms.Form In System.Windows.Forms.Application.OpenForms
                    If oform.Name = "frmEmdeonPrintRequisition" Then
                        oform.BringToFront()
                        oform.Focus()
                        Exit Sub
                    End If
                Next
            End If
            ' Check if connected to Emdeon/ Emdeon setup is availavble for selected database.
            If Not gloEmdeonInterface.Classes.clsEmdeonGeneral.CheckConnectionParameters(GetConnectionString) Then
                MessageBox.Show("Lab Settings have not been configured in gloEMR Admin." + vbCrLf + "Please complete Lab Settings before ordering.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Return
            End If

            Dim enmLabConnectionAvailable As gloEmdeonInterface.Classes.clsGeneral.InternetConnectivity

            enmLabConnectionAvailable = objclsgeneral.IsInternetConnectionAvailable()

            If enmLabConnectionAvailable = gloEmdeonInterface.Classes.clsGeneral.InternetConnectivity.Success Then

                Dim oFrmManifestScreen As New frmEmdeonPrintRequisition(True)
                oFrmManifestScreen.ShowInTaskbar = False
                oFrmManifestScreen.WindowState = FormWindowState.Maximized
                oFrmManifestScreen.BringToFront()
                oFrmManifestScreen.MdiParent = Me
                oFrmManifestScreen.Show()

                ShowHideMainMenu(False, False)
                Me.pnlMainToolBar.Visible = False

            Else
                If enmLabConnectionAvailable = gloEmdeonInterface.Classes.clsGeneral.InternetConnectivity.NoInternet Then
                    Dim objFrmConnectionConfirm As New gloEmdeonInterface.Forms.frmConfirmInternetConnection(True)
                    objFrmConnectionConfirm.ShowInTaskbar = False
                    objFrmConnectionConfirm.ShowDialog(IIf(IsNothing(objFrmConnectionConfirm.Parent), Me, objFrmConnectionConfirm.Parent))
                    objFrmConnectionConfirm.Dispose()
                ElseIf enmLabConnectionAvailable = gloEmdeonInterface.Classes.clsGeneral.InternetConnectivity.ServerNotresponding Then
                    Dim objFrmConnectionConfirm As New gloEmdeonInterface.Forms.frmConfirmInternetConnection(False)
                    objFrmConnectionConfirm.ShowInTaskbar = False
                    objFrmConnectionConfirm.ShowDialog(IIf(IsNothing(objFrmConnectionConfirm.Parent), Me, objFrmConnectionConfirm.Parent))
                    objFrmConnectionConfirm.Dispose()
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.Settings, gloAuditTrail.ActivityType.Initialize, "Error while opening lab manifest", gloAuditTrail.ActivityOutCome.Failure)
        Finally
            ''slr free objclsgeneral
            If Not IsNothing(objclsgeneral) Then
                objclsgeneral.Dispose()
                objclsgeneral = Nothing
            End If
        End Try
        'End madan changes on 20101215
    End Sub

#Region " Not in use functions "

    Private Function GetAppointments_OLD() As DataTable
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim dtAppointment As New DataTable()
        Try

            oDB.Connect(False)
            Dim strSQL As String = ""


            If (gnSelectedProviderID <> 0) Then
                ''
                ''Modified by Mayuri:20100105-To hide Canceled,Deleted and no show appointments 
                strSQL = "  SELECT	ISNULL(AS_Appointment_DTL.nMSTAppointmentID, 0) AS nMSTAppointmentID, ISNULL(AS_Appointment_DTL.nDTLAppointmentID, 0) AS nDTLAppointmentID, " _
                            & " ISNULL(AS_Appointment_MST.sAppointmentTypeDesc,'')  AS sAppointmentType,ISNULL(AS_Appointment_MST.sLocationName,'')  AS sLocationName, AS_Appointment_DTL.dtStartDate,  AS_Appointment_DTL.dtEndDate,AS_Appointment_MST.nPatientID AS  nPatientID,AS_Appointment_DTL.dtStartTime as dtStartTime , AS_Appointment_DTL.dtEndTime AS dtEndTime , " _
                            & "  (ISNULL(Provider_MST.sFirstName,'')+ SPACE(1) + " _
                            & " ISNULL(Provider_MST.sMiddleName,'') + SPACE(1) + " _
                            & " CASE Provider_MST.sMiddleName WHEN  '' THEN '' When Provider_MST.sMiddleName then Provider_MST.sMiddleName + SPACE(1) END " _
                            & " + ISNULL(Provider_MST.sLastName,'')) AS ProviderName, Provider_MST.nProviderID" _
                            & " FROM AS_Appointment_DTL INNER JOIN AS_Appointment_MST ON AS_Appointment_DTL.nMSTAppointmentID = AS_Appointment_MST.nMSTAppointmentID INNER JOIN " _
                            & " Provider_MST ON AS_Appointment_MST.nASBaseID = Provider_MST.nProviderID " _
                            & " WHERE AS_Appointment_DTL.nClinicID = 1 And AS_Appointment_DTL.nASBaseID = " & gnSelectedProviderID & " " _
                            & " AND AS_Appointment_DTL.nASBaseFlag = 1 AND AS_Appointment_DTL.nUsedStatus <> 6 AND AS_Appointment_DTL.nUsedStatus <> 7 AND AS_Appointment_DTL.nUsedStatus <> 5 AND AS_Appointment_DTL.dtStartdate = " & gloDate.DateAsNumber(dtPatientOnDate.ToString) & " ORDER BY AS_Appointment_DTL.dtStartDate " _
                            & " , dtStartTime " ''Sandip Darade 20100311 Ge by appointment start time 

            Else
                ''Modified by Mayuri:20100105-To hide Canceled,Deleted and no show appointments 
                strSQL = "  SELECT	ISNULL(AS_Appointment_DTL.nMSTAppointmentID, 0) AS nMSTAppointmentID, ISNULL(AS_Appointment_DTL.nDTLAppointmentID, 0) AS nDTLAppointmentID, " _
                        & " ISNULL(AS_Appointment_MST.sAppointmentTypeDesc,'')  AS sAppointmentType,ISNULL(AS_Appointment_MST.sLocationName,'')  AS sLocationName, AS_Appointment_DTL.dtStartDate,  AS_Appointment_DTL.dtEndDate,AS_Appointment_MST.nPatientID AS  nPatientID,AS_Appointment_DTL.dtStartTime as dtStartTime , AS_Appointment_DTL.dtEndTime AS dtEndTime , " _
                        & "  (ISNULL(Provider_MST.sFirstName,'')+ SPACE(1) + " _
                        & " CASE Provider_MST.sMiddleName WHEN  '' THEN '' When Provider_MST.sMiddleName then Provider_MST.sMiddleName + SPACE(1) END " _
                        & " + ISNULL(Provider_MST.sLastName,'')) AS ProviderName, Provider_MST.nProviderID" _
                        & " FROM AS_Appointment_DTL INNER JOIN AS_Appointment_MST ON AS_Appointment_DTL.nMSTAppointmentID = AS_Appointment_MST.nMSTAppointmentID INNER JOIN " _
                        & " Provider_MST ON AS_Appointment_MST.nASBaseID = Provider_MST.nProviderID " _
                        & " WHERE AS_Appointment_DTL.nClinicID = 1 " _
                        & " AND AS_Appointment_DTL.nASBaseFlag = 1 AND AS_Appointment_DTL.nUsedStatus <> 6 AND AS_Appointment_DTL.nUsedStatus <> 7 AND AS_Appointment_DTL.nUsedStatus <> 5 AND AS_Appointment_DTL.dtStartdate = " & gloDate.DateAsNumber(dtPatientOnDate.ToString) & " ORDER BY AS_Appointment_DTL.dtStartDate " _
                        & " , dtStartTime " ''Sandip Darade 20100311 Ge by appointment start time 
            End If

            If (gblnShowCheckedOutAppointment = False) Then
                ''Sandip Darade 20100506
                ''Checked out appointments will not be pulled
                strSQL = strSQL.Replace("AS_Appointment_DTL.nUsedStatus <> 5", "AS_Appointment_DTL.nUsedStatus <> 5 AND AS_Appointment_DTL.nUsedStatus <> 4")
            End If

            oDB.Retrive_Query(strSQL, dtAppointment)
            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing
            Return dtAppointment

        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.[Error])
            Return Nothing
        End Try
    End Function

    Public Sub ResetDTPFromTo()
        If SelectedPatientDetail = PatientDetails.Medication Then
            _SeachFlag = True
            dtpToDate.Text = DateTime.Now
            dtpFromDate.Text = DateTime.Now

            dtpFromDate.Checked = False
            dtpToDate.Checked = False
            cmbStatus.Text = "Active" ''"All"
            _isReset = False  ''On reset if it is set to true then need to cllick 2 times
            chkGetLatestActive.Enabled = True
            chkGetLatestActive.Checked = True
            fill_medication()
            _isTextchanged = False
            _SeachFlag = False
        Else

            textSemaphore = True

            textSemaphore = False

            dtpFromDate.Checked = False
            dtpToDate.Checked = False
            cmbStatus.Text = "All"
            textSemaphore = False
            chkGetLatestActive.Enabled = False
            chkGetLatestActive.Checked = False

        End If
    End Sub

#End Region

    Private Sub MnuClinicalChart_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MnuClinicalChart.Click
        OpenClinicalChart(gnPatientID)
        'Try
        '    Dim ofrmCC As frmClinicalChart = New frmClinicalChart(gnPatientID)
        '    'AddHandler ofrmCC.EvntGenerateCDAFromClinicalChart, AddressOf openCDA
        '    ofrmCC.Visible = False
        '    ofrmCC.ShowInTaskbar = False
        '    ofrmCC.StartPosition = FormStartPosition.CenterScreen
        '    ofrmCC.WindowState = FormWindowState.Maximized
        '    ofrmCC.ShowDialog(IIf(IsNothing(ofrmCC.Parent), Me, ofrmCC.Parent))
        '    ofrmCC.Dispose()
        '    ofrmCC = Nothing
        'Catch ex As Exception
        '    gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.ClinicalChart, gloAuditTrail.ActivityType.Open, "Error while opening clinical charts.", gloAuditTrail.ActivityOutCome.Failure)
        'End Try
    End Sub

    Private Sub BackgroundWorker_MessageTimer_DoWork(ByVal sender As System.Object, ByVal e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker_MessageTimer.DoWork
        Try
            If (pnlMainToolBar.Visible) Then
                LoadLeftPanel()
            Else
                ShowMessages_New()
            End If
        Catch ex As Exception
        Finally   ''code added for problem 00000591
            'GC.Collect()
            'GC.WaitForPendingFinalizers()
        End Try
    End Sub

    Private Sub BackgroundWorker_InitiliseFaxSetting_DoWork(ByVal sender As System.Object, ByVal e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker_InitiliseFaxSetting.DoWork
        InitiliseFaxSetting()
    End Sub

    Public WriteOnly Property SetGnPatientID() As Int64
        Set(ByVal Value As Int64)
            If (gnPatientID <> Value AndAlso Value <> 0) Then
                gnPatientID = Value
                gnVisitID = GetVisitID(Now, gnPatientID)
            End If
        End Set
    End Property

    Private Sub mnuTools_RecoverExam_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuTools_RecoverExam.Click
        Dim frmVWRecoverExam As frmRecoverExam
        Try

            frmVWRecoverExam = New frmRecoverExam()
            frmVWRecoverExam.MdiParent = Me
            frmVWRecoverExam.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

        End Try
    End Sub

    Private Sub mnuWindow_DropDownOpening(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuWindow.DropDownOpening
        ''Added by MAYURI:20110518-To refresh window list manually
        RefreshWindowList()
    End Sub

    Public Sub RefreshWindowList()
        Dim mdiWindowCount As Integer = Me.MdiChildren.Count
        Dim menuItemWindowCount As Integer = Me.mnuWindow.DropDownItems.Count

        ' Remove all WINDOW MenuItems from the Window menu, but don't remove the
        ' extra items such as Close and the separator (first two) and the last item
        Dim item As ToolStripItem
        For i As Integer = menuItemWindowCount - 1 To 0 Step -1
            item = Me.mnuWindow.DropDownItems(i)
            If Not (item Is CloseToolStripMenuItem) Then

                Me.mnuWindow.DropDownItems.RemoveAt(i)
            End If
        Next
        If mdiWindowCount > 0 Then
            Dim menuItem As ToolStripMenuItem
            Dim counter As Integer = 1
            ' Add the new window items
            For Each window As Form In Me.MdiChildren
                'Create new menuitem
                menuItem = New ToolStripMenuItem

                'Set the text to for example "2. Windowtext"
                menuItem.Text = counter.ToString & " " & window.Text
                menuItem.Visible = window.Visible
                ' If menuItem.Text.Contains("Received Faxes") Then
                'Set the tag to the current window so we can retrieve it later
                menuItem.Tag = window
                'Check the menuitem if this is the currently active window
                If window Is Me.ActiveMdiChild Then
                    menuItem.Checked = True
                End If
                'Add a Click EventHandler to be able to click it
                AddHandler menuItem.Click, AddressOf WindowMenuItemClicked

                Me.mnuWindow.DropDownItems.Insert(Me.mnuWindow.DropDownItems.Count - 1, menuItem)
                'Raise the counter by 1
                counter += 1

            Next
        End If

    End Sub

    Private Sub WindowMenuItemClicked(ByVal sender As Object, ByVal e As EventArgs)
        'Retrieve the clicked MenuItem from the sender object
        Dim menuItem As ToolStripMenuItem = TryCast(sender, ToolStripMenuItem)
        Dim frm As Form = TryCast(menuItem.Tag, Form)
        If frm IsNot Nothing Then
            'Bug #39460
            frm.WindowState = FormWindowState.Maximized
            'End Bug #39460
            frm.Activate()
        End If
    End Sub

    Private Function IsPatientGuidelineOrPatientEducationOpen(ByVal StrForModule As String) As Boolean
        Dim Frm1 As System.Windows.Forms.Form
        For Each Frm1 In System.Windows.Forms.Application.OpenForms
            If (Frm1.Name = "frmPatientEducation") Then
                If (IsNothing(CType(Frm1, frmPatientEducation).myCaller) = False) Then
                    If (CType(Frm1, frmPatientEducation).myCaller.Name = "frmPatientExam") Then
                        MessageBox.Show("Please close the Patient Education screen before opening " & StrForModule & ". ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Return True
                    Else
                    End If

                End If
            End If
            If (Frm1.Name = "frmPatientGuideline") Then
                If (IsNothing(CType(Frm1, frmPatientGuideline).myCaller) = False) Then
                    If (CType(Frm1, frmPatientGuideline).myCaller.Name = "frmPatientExam") Then
                        If (CType(Frm1, frmPatientGuideline).GetTypeOfForm = frmPatientGuideline.MaterialType.GuideLine) Then
                            MessageBox.Show("Please close the Patient Guidelines screen before opening Patient Exam.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Else
                            MessageBox.Show("Please close the Disease Management screen before opening Patient Exam.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        End If
                        Return True
                    Else
                    End If

                End If
                IsPatientGuidelineOrPatientEducationOpen = Nothing
                Exit Function
            End If
        Next
        Return False
    End Function
    ''' <summary>
    ''' GetDashboardUpdateMst Function fetch data table for get flag required updating left pannels 
    ''' </summary>
    ''' <returns></returns>
    ''' <remarks></remarks>
    Private Function GetDashboardUpdateMst() As DataTable
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParam As gloDatabaseLayer.DBParameters
        Dim dtMstDashboardUpdate As New DataTable()
        Try
            oDB.Connect(False)
            oParam = New gloDatabaseLayer.DBParameters
            oDB.Retrive("GSP_GetMstDashboardUpdate", oParam, dtMstDashboardUpdate)
            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing
            oParam.Dispose()
            oParam = Nothing
            Return dtMstDashboardUpdate
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.None, ex, gloAuditTrail.ActivityOutCome.Failure)
            Return Nothing
        Finally
            'If IsNothing(dtMstDashboardUpdate) = False Then  ''slr it should not be free
            '    dtMstDashboardUpdate.Dispose()
            '    dtMstDashboardUpdate = Nothing
            'End If
        End Try
    End Function
    Private Sub InsertRecordsIntoDashboardUpdateMst() 'As DataTable
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oParam As gloDatabaseLayer.DBParameters
        ' Dim dtInsertRecordsIntoDashboardUpdateMst As New DataTable()
        Try
            oDB.Connect(False)
            oParam = New gloDatabaseLayer.DBParameters
            oDB.Execute("GSP_InsertRecordsIntoDashboardUpdateMst")
            oDB.Disconnect()
            oDB.Dispose()
            oDB = Nothing
            oParam.Dispose()
            oParam = Nothing
            ' Return dtInsertRecordsIntoDashboardUpdateMst
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.None, ex, gloAuditTrail.ActivityOutCome.Failure)
        Finally
            'If IsNothing(dtInsertRecordsIntoDashboardUpdateMst) = False Then
            '    dtInsertRecordsIntoDashboardUpdateMst.Dispose()
            '    dtInsertRecordsIntoDashboardUpdateMst = Nothing
            'End If
            If IsNothing(oDB) = False Then
                oDB.Dispose()
                oDB = Nothing
            End If
        End Try
    End Sub

    Private Sub C1UserTasks_OwnerDrawCell(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.OwnerDrawCellEventArgs) Handles C1UserTasks.OwnerDrawCell
        If IsNothing(C1UserTasks.GetCellImage(e.Row, Col_Task_Priority)) = False Then
            Exit Sub
        End If
        If (e.Col = Col_Task_Priority) Then
            If IsNothing(C1UserTasks.GetData(e.Row, Col_Task_Priority)) = False Then
                If C1UserTasks.GetData(e.Row, Col_Task_Priority).ToString() = "High Priority" Then

                    C1UserTasks.SetCellImage(e.Row, Col_Task_Priority, imgList_Common.Images(18))
                ElseIf C1UserTasks.GetData(e.Row, Col_Task_Priority).ToString() = "Normal Priority" Then
                    C1UserTasks.SetData(e.Row, Col_Task_Priority, " ")
                ElseIf C1UserTasks.GetData(e.Row, Col_Task_Priority).ToString() = " " Then
                    C1UserTasks.SetData(e.Row, Col_Task_Priority, " ")
                ElseIf C1UserTasks.GetData(e.Row, Col_Task_Priority).ToString() = "Low Priority" Then
                    C1UserTasks.SetCellImage(e.Row, Col_Task_Priority, imgList_Common.Images(19))
                Else
                    C1UserTasks.SetCellImage(e.Row, Col_Task_Priority, imgList_Common.Images(1))
                End If
                imgsetcount = imgsetcount + 1
                If C1UserTasks.GetData(e.Row, Col_Task_Status) = "Not Yet Accepted" Then
                    Dim asgTask As C1.Win.C1FlexGrid.CellStyle '= C1UserTasks.Styles.Add("asgTask")
                    Try
                        If (C1UserTasks.Styles.Contains("asgTask")) Then
                            asgTask = C1UserTasks.Styles("asgTask")
                        Else
                            asgTask = C1UserTasks.Styles.Add("asgTask")
                            asgTask.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte(0))

                        End If
                    Catch ex As Exception
                        asgTask = C1UserTasks.Styles.Add("asgTask")
                        asgTask.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte(0))

                    End Try

                    C1UserTasks.SetCellStyle(e.Row, Col_Task_Subject, asgTask)
                End If
            End If
        End If
        'If (e.Col = Col_Task_Resp) And e.Row > 0 Then
        '    If (Convert.ToString(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)(Col_Task_GroupID)) = "0") Then
        '        C1UserTasks.SetCellImage(e.Row, Col_Task_Resp, imgList_Common.Images(39))
        '    End If
        '    If (Convert.ToString(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)(Col_Task_OwnerAssigned)) = "True") And (_flexGroup.Grid.Rows(_flexGroup.Grid.Row)(Col_Task_TAKEID) = "True") Then
        '        C1UserTasks.SetCellImage(e.Row, Col_Task_Resp, imgList_Common.Images(38))
        '    End If
        '    If (Convert.ToString(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)(Col_Task_OwnerAssigned)) = "True") And (_flexGroup.Grid.Rows(_flexGroup.Grid.Row)(Col_Task_TAKEID) = "False") Then
        '        C1UserTasks.SetCellImage(e.Row, Col_Task_Resp, imgList_Common.Images(37))
        '    End If
        '    If (Convert.ToString(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)(Col_Task_OwnerAssigned)) = "True") And (_flexGroup.Grid.Rows(_flexGroup.Grid.Row)(Col_Task_TAKEID) = "False") And (Convert.ToString(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)(Col_Task_GroupID)) <> "0") Then
        '        C1UserTasks.SetCellImage(e.Row, Col_Task_Resp, imgList_Common.Images(36))
        '    End If
        'End If
    End Sub

    'Problem: 68
    'commented this event as it is not catching the sort action on grid and appointment status color not changing as per new sort order.
    'Private Sub C1Appointments_OwnerDrawCell(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.OwnerDrawCellEventArgs) Handles C1Appointments.OwnerDrawCell

    '    If (e.Col >= 0 And e.Col <= 5) Then
    '        Dim i As Integer
    '        If IsNothing(C1Appointments.GetData(e.Row, col_styletext)) = False Then
    '            If Convert.ToString(C1Appointments.GetData(e.Row, col_styletext)) <> "" Then
    '                Exit Sub
    '            End If
    '        Else
    '            Exit Sub
    '        End If
    '        UpdateAppointmentStatus(e.Row, False)
    '        C1Appointments.SetData(e.Row, col_styletext, e.Row)
    '    End If


    'End Sub

    Private Sub C1Mesages_OwnerDrawCell(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.OwnerDrawCellEventArgs) Handles C1Mesages.OwnerDrawCell
        If IsNothing(C1Mesages.GetCellImage(e.Row, col_MessagePriority)) = False Then
            Exit Sub
        End If

        If (e.Col = col_MessagePriority) Then
            If IsNothing(C1Mesages.GetData(e.Row, col_MessagePriority)) = False Then
                If C1Mesages.GetData(e.Row, col_MessagePriority).ToString() = "High" Then

                    C1Mesages.SetCellImage(e.Row, col_MessagePriority, imgList_Common.Images(0))
                    C1Mesages.SetData(e.Row, col_MessagePriority, "High Priority")
                ElseIf C1Mesages.GetData(e.Row, col_MessagePriority).ToString() = "Normal" Then

                    C1Mesages.SetCellImage(e.Row, col_MessagePriority, imgList_Common.Images(1))
                    C1Mesages.SetData(e.Row, col_MessagePriority, "Normal Priority")
                ElseIf C1Mesages.GetData(e.Row, col_MessagePriority).ToString() = "Low" Then
                    C1Mesages.SetCellImage(e.Row, col_MessagePriority, imgList_Common.Images(2))
                    C1Mesages.SetData(e.Row, col_MessagePriority, "Low Priority")
                Else
                    C1Mesages.SetCellImage(e.Row, col_MessagePriority, imgList_Common.Images(2))
                    C1Mesages.SetData(e.Row, col_MessagePriority, "Low Priority")
                End If

            End If
        End If

    End Sub



    Private Sub pnlPatientPhoto_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles pnlPatientPhoto.MouseDown
        Try
            Call FillMenus()
            'Try
            '    If (IsNothing(pnlLeft.ContextMenuStrip) = False) Then
            '        pnlLeft.ContextMenuStrip.Dispose()
            '        pnlLeft.ContextMenuStrip = Nothing
            '    End If
            'Catch ex As Exception

            'End Try
           
            pnlLeft.ContextMenuStrip = cMnuPatient
            FillCheckInCheckOutMenu()

        Catch ex As Exception
            MessageBox.Show(ex.ToString)
        End Try
    End Sub

    Private Sub mnuUserGuide_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuUserGuide.Click
        Try
            Dim helpFileName As String = System.IO.Path.Combine(System.Windows.Forms.Application.StartupPath, "help\gloEMR_User_Manual.chm")
            If System.IO.File.Exists(helpFileName) Then
                System.Windows.Forms.Help.ShowHelp(Me, "file://" & helpFileName, "Welcome.htm")
                System.Windows.Forms.Help.ShowHelp(Me, "file://" & helpFileName, HelpNavigator.TableOfContents, "Welcome.htm")
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub mnuSearch_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuSearch.Click
        Try
            Dim helpFileName As String = System.IO.Path.Combine(System.Windows.Forms.Application.StartupPath, "help\gloEMR_User_Manual.chm")
            If System.IO.File.Exists(helpFileName) Then
                System.Windows.Forms.Help.ShowHelp(Me, "file://" & helpFileName, "Welcome.htm")
                System.Windows.Forms.Help.ShowHelp(Me, "file://" & helpFileName, HelpNavigator.Find, "Welcome.htm")
            End If
        Catch ex As Exception

        End Try
    End Sub

    Private Sub ContentsToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ContentsToolStripMenuItem.Click
        Try
            Dim helpFileName As String = System.IO.Path.Combine(System.Windows.Forms.Application.StartupPath, "help\gloEMR_User_Manual.chm")
            If System.IO.File.Exists(helpFileName) Then
                System.Windows.Forms.Help.ShowHelp(Me, "file://" & helpFileName, "Welcome.htm")
                System.Windows.Forms.Help.ShowHelp(Me, "file://" & helpFileName, HelpNavigator.TableOfContents, "Welcome.htm")
                'Me.ShowHelp()
            End If
        Catch ex As Exception

        End Try

    End Sub
    'added in 6050
#Region "Patient detail panel task methods"
    Private Sub AcceptTask()
        If MessageBox.Show("Accept selected task request?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.No Then
            Exit Sub
        End If

        Dim ogloTask As New gloTaskMail.gloTask(GetConnectionString)
        Dim tempTaskID As Int64
        Dim oTask As gloTaskMail.Task = Nothing  ''slr new not needed 
        Dim oTaskAssign As gloTaskMail.TaskAssign = Nothing ''slr new not needed 
        Try
            tempTaskID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID), Int64)

            oTask = ogloTask.GetTask(tempTaskID)
            'If the User Accepts the Task -New Entry for the Task is made against the user.
            'So we get the assigned Task first & then set its TaskID = 0,
            'also change the OwnerID to current userID & some other fields as done below

            Dim _nAssignFromId As Int64 = 0
            oTaskAssign = ogloTask.GetTaskAssign(tempTaskID, gnLoginID)
            If Not IsNothing(oTaskAssign) Then
                _nAssignFromId = oTaskAssign.AssignFromID
            End If

            If IsNothing(oTask) = False Then
                'Clear the previous assignments for this Task
                oTask.Assignment.Clear()
                oTask.TaskID = 0
                oTask.UserID = gnLoginID
                'Also set the Current User who is accepting this task
                'as the owner of the task.
                oTask.OwnerID = gnLoginID
                oTaskAssign.TaskID = 0
                oTaskAssign.AssignToID = gnLoginID
                oTaskAssign.AssignFromID = _nAssignFromId  ''Sandip Darade 20100503
                oTaskAssign.SelfAssigned = gloTasksMails.Common.SelfAssigned.Self
                oTaskAssign.AcceptRejectHold = gloTasksMails.Common.AcceptRejectHold.Accept
                oTask.Assignment.Add(oTaskAssign)
            End If

            ''New Entry for Task.
            Dim _result As Int64 = ogloTask.Add(oTask)

            ''To Tell Task Sender That Task Has Accepted.
            If _result > 0 Then
                If ogloTask.AcceptTask(tempTaskID, gnLoginID) Then

                    'Activate Reminder for this Task if reminder is present
                    Dim oReminder As New gloReminder.Reminder()
                    oReminder.ActivateTaskReminder(gnLoginID, tempTaskID, _result)
                    oReminder.Dispose()
                    oReminder = Nothing
                    '-------------
                End If

                'Code commented for Bug #86221: Unmatched Patient task (Problem 00000942) : Updated patient details of task to previously opened Unmatched Patient Task 
                'changes : Update new task ID in glolab unmatched table for an Un match patient task
                'If oTask.TaskType = gloTaskMail.TaskType.UnmatchedPatient Then
                '    Try
                '        Dim oDB As New gloStream.gloDataBase.gloDataBase
                '        Dim query As String
                '        oDB.Connect(GetConnectionString)

                '        query = "UPDATE PatientsUnmatchedInLab set nTaskId=" & _result.ToString() & " where nTaskId= " & tempTaskID
                '        oDB.ExecuteNonSQLQuery(query)
                '        oDB.Disconnect()
                '        oDB.Dispose()
                '        oDB = Nothing
                '    Catch ex As Exception
                '        gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString, False)
                '    End Try
                'End If
            Else
                MessageBox.Show("ERROR : Record not added. ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
                Return
            End If
            ShowTasks()
            ShowDefaultPatientDetails(gnPatientID)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(ogloTask) Then  ''slr free oglotask
                ogloTask.Dispose()
            End If
            ogloTask = Nothing
            If Not IsNothing(oTask) Then   ''slr free otask
                oTask.Dispose()
            End If
            oTask = Nothing
            If Not IsNothing(oTaskAssign) Then  ''slr free oTaskAssign
                oTaskAssign.Dispose()
            End If
            oTaskAssign = Nothing
        End Try
    End Sub
    Private Sub DeclineTask()
        If MessageBox.Show("Decline selected task request?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = Windows.Forms.DialogResult.No Then
            Exit Sub
        End If
        Dim ogloTask As New gloTaskMail.gloTask(GetConnectionString)
        Dim tempTaskID As Int64
        Try
            tempTaskID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID), Int64)
            'Decline Task Request if selected for decline
            If ogloTask.DeclineTask(tempTaskID, gnLoginID) = False Then
                MessageBox.Show("Error : Decline unsuccessful.  ", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                Exit Sub
            End If
            ShowTasks()
            ShowDefaultPatientDetails(False)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        If Not IsNothing(ogloTask) Then  ''slr dispose oglotask
            ogloTask.Dispose()
            ogloTask = Nothing
        End If
    End Sub
    Private Sub CompleteTask(ByVal sender As Object, ByVal e As EventArgs)
        Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        Try
            Dim TaskId As Int64 = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID))
            Dim Percentage As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
            If TaskId > 0 Then
                ogloTask.ModifyTaskComplete(TaskId, Percentage)
                ShowTasks()
                ShowPatientDetails(False)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ogloTask.Dispose()
        End Try
    End Sub
    Private Sub Change_Priority(ByVal sender As Object, ByVal e As EventArgs)
        Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        Try

            Dim TaskId As Int64 = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID))
            Dim PriorityID As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
            If TaskId > 0 Then
                GetControlSelection()
                GridSelect_RowCount = C1dgPatientDetails.Rows.Count
                ogloTask.ModifyTaskPriority(TaskId, PriorityID)
                ShowTasks()
                ShowPatientDetails(False, True)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ogloTask.Dispose()
        End Try
    End Sub
    Private Sub Change_Followup(ByVal sender As Object, ByVal e As EventArgs)
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim _taskId As Int64 = 0
        Dim _sqlquery As String = ""
        Dim _followupId As String = ""
        Try
            _taskId = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID))
            _followupId = Convert.ToString((CType(sender, ToolStripMenuItem)).Tag)
            If _taskId > 0 Then
                GetControlSelection()
                GridSelect_RowCount = C1dgPatientDetails.Rows.Count
                oDB.Connect(False)
                Dim oCurrentMenu As ToolStripMenuItem = CType(sender, ToolStripMenuItem)
                _sqlquery = "UPDATE TM_TaskMST SET nFollowUpID = " & _followupId & " WHERE nTaskID = " & _taskId & " "
                oDB.Execute_Query(_sqlquery)
                oDB.Disconnect()
                ShowTasks()
                ShowPatientDetails(False, True)
            End If
        Catch ex As Exception

        End Try
        If Not IsNothing(oDB) Then         'slr : Odb,dispose
            oDB.Dispose()
            oDB = Nothing
        End If
    End Sub
    Private Sub Delete_Task()
        Dim ogloTask As New gloTaskMail.gloTask(GetConnectionString())
        Dim dt As DataTable ''slr new not needed 
        Try
            Dim dr As DialogResult = MessageBox.Show("Are you sure you want to delete task ?", _MessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2)
            If dr = DialogResult.Yes Then
                Dim tempTaskId As Int64 = 0
                tempTaskId = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID))
                If ogloTask.CanDeleteTask(tempTaskId) = True Then
                    ogloTask.DeleteRequestedTask(tempTaskId, gnLoginID)
                    dt = ogloTask.get_multiTask(tempTaskId)
                    If IsNothing(dt) OrElse dt.Rows.Count = 0 Then ''slr isnothing condition added on if condition
                        ogloTask.DeleteTask(tempTaskId)
                    End If
                    ShowTasks()
                    ShowPatientDetails(False)
                Else
                    MessageBox.Show("Cannot delete message . The message is assigned and is on hold", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            End If
            If Not IsNothing(ogloTask) Then  ''slr free ogloTask
                ogloTask.Dispose()
                ogloTask = Nothing
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub
    Private Sub ShowDMSTask()
        Try
            If (gblnAutoCloseDMSWindow = True) Then
                If Not IsNothing(_objfrmtask) Then
                    _objfrmtask.Close()
                    _objfrmtask = Nothing
                End If
            Else

                If Not IsNothing(_objfrmtask) Then
                    If gblnAutoCompDMSTask Then
                        _objfrmtask.LoadTaskAfterDMS()
                    End If
                End If
            End If
        Catch ex As Exception
        Finally
            If Not IsNothing(_objfrmtask) Then ''added for bugid 90297
                _objfrmtask.Enabled = True
            End If
        End Try
    End Sub

    Private Sub Edit_Task()
        Try
            GetControlSelection()
            GridSelect_RowCount = C1dgPatientDetails.Rows.Count
            Dim _taskId As Int64 = 0
            _taskId = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID), Int64)
            ofrmTask = New gloTaskMail.frmTask(GetConnectionString, _taskId)
            'Bug #82464: 00000909: Task screen not opening respective screen
            AddHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange
            ofrmTask.IsEMREnable = True
            nTaskId = _taskId
            ofrmTask.ShowDialog(IIf(IsNothing(ofrmTask.Parent), Me, ofrmTask.Parent))

            HandlesTaskChange(Nothing, Nothing, ofrmTask.e2Task)
            ofrmTask.Dispose()
            ofrmTask = Nothing
            _objfrmtask = Nothing
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        End Try
    End Sub
#End Region
#Region "Cases"
    Private Sub AddCases()


        '30-Mar-17 Aniket: Resolving Bug #104866 ( Modified): gloEMR: Patient status: The application is opening and saving the cases for Lock Chart patient
        If IsAccess(False) = False Then
            Exit Sub
        End If

        Dim ofrmSetupCases As gloBilling.frmSetupCases = New gloBilling.frmSetupCases(gnPatientID)

        ofrmSetupCases.BringToFront() 'SLR: this should be before shodialog
        ofrmSetupCases.ShowDialog(IIf(IsNothing(ofrmSetupCases.Parent), Me, ofrmSetupCases.Parent))

        'SLR: free ofrmSetuCases
        If Not IsNothing(ofrmSetupCases) Then
            ofrmSetupCases.Dispose()
            ofrmSetupCases = Nothing
        End If

        FillCases(gnPatientID)

    End Sub

    Private Sub ModifyCases()
        Dim _SelectedCaseID As Int64
        GetControlSelection()
        GridSelect_RowCount = C1dgPatientDetails.Rows.Count
        _SelectedCaseID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, Col_View_taskID), Int64)
        Dim ofrmSetupCases As gloBilling.frmSetupCases = New gloBilling.frmSetupCases(gnPatientID, _SelectedCaseID)
        ofrmSetupCases.BringToFront()  'SLR: this should be before shodialog
        ofrmSetupCases.ShowDialog(IIf(IsNothing(ofrmSetupCases.Parent), Me, ofrmSetupCases.Parent))
        'SLR: free ofrmSetupCases
        If Not IsNothing(ofrmSetupCases) Then
            ofrmSetupCases.Dispose()
            ofrmSetupCases = Nothing
        End If
        If (SelectedPatientDetail = PatientDetails.patientCases) Then
            FillCases(gnPatientID)
            SetControlSelection_EMR()

        End If
    End Sub
#End Region

    'Code added by Rohit not to call Message queue & interface Report on dashboard on 20110929
    Private Sub InterfaceReportsToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles InterfaceReportsToolStripMenuItem.Click
        If IsAccess(False) = False Then
            Exit Sub
        End If
        For Each oform As System.Windows.Forms.Form In System.Windows.Forms.Application.OpenForms
            If oform.Name = "frmInterfacesMessageErrorReport" Then
                oform.MdiParent = Me
                oform.WindowState = FormWindowState.Maximized
                oform.Show()
                oform.BringToFront()
                oform.Focus()
                ShowHideMainMenu(False, False)
                Me.pnlMainToolBar.Visible = False
                Exit Sub
            End If
        Next
        Dim frm As New frmInterfacesMessageErrorReport()
        Try

            frm.MdiParent = Me
            frm.Show()
            frm.WindowState = FormWindowState.Maximized
            frm.BringToFront()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub PatientActivationReportsToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PatientActivationReportsToolStripMenuItem.Click
        Try
            'If IsAccess(False) = False Then
            '    Exit Sub
            'End If
            ''Task #68533: gloEMR Admin - User Management - User Rights - Change "Intuit" to "Patient Portal"
            ''if portal enable and user not have right then report is not show.
            If gblnPatientPortalEnabled Then
                If objUserRights.Intuit = False Then
                    System.Windows.MessageBox.Show("This user does not have the rights to view the Patient Activation Report. Please contact your system administrator for the same.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                End If
            End If

            For Each oform As System.Windows.Forms.Form In System.Windows.Forms.Application.OpenForms
                If oform.Name = "frmPatientActivationReport" Then
                    oform.MdiParent = Me
                    oform.WindowState = FormWindowState.Maximized
                    oform.Show()
                    oform.BringToFront()
                    oform.Focus()
                    ShowHideMainMenu(False, False)
                    Me.pnlMainToolBar.Visible = False
                    Exit Sub
                End If
            Next
            Dim frm As New frmPatientActivationReport(GetConnectionString, mdlGeneral.gnLoginID)
            Try

                frm.MdiParent = Me
                frm.Show()
                frm.WindowState = FormWindowState.Maximized
                frm.BringToFront()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub MessageQueueToolStripMenuItem1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MessageQueueToolStripMenuItem1.Click
        If IsAccess(False) = False Then
            Exit Sub
        End If
        For Each oform As System.Windows.Forms.Form In System.Windows.Forms.Application.OpenForms
            If oform.Name = "frmInterfacesMessageQueueViewReport" Then
                oform.MdiParent = Me
                oform.WindowState = FormWindowState.Maximized
                oform.Show()
                oform.BringToFront()
                oform.Focus()
                ShowHideMainMenu(False, False)
                Me.pnlMainToolBar.Visible = False
                Exit Sub
            End If
        Next
        Dim frm As New frmInterfacesMessageQueueViewReport(1000)
        Try

            frm.MdiParent = Me
            frm.Show()
            frm.WindowState = FormWindowState.Maximized
            frm.BringToFront()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    'End of Code added by Rohit not to call Message queue & interface Report on dashboard on 20110929
    Private Sub cmnuItem_CompleteAll_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmnuItem_CompleteAll.Click
        'Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        'Try
        '    Dim TaskId As Int64 = Convert.ToInt64(C1UserTasks.GetData(C1UserTasks.Row, Col_Task_TaskID))
        '    ' Dim Percentage As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
        '    If TaskId > 0 Then

        '        Dim rowsel As Integer = 0
        '        Dim rowcnt As Integer = 0
        '        rowcnt = C1UserTasks.Rows.Count ''added for problem 00000315 to show selected task v8020 
        '        rowsel = C1UserTasks.RowSel
        '        ogloTask.CompleteAll(TaskId)
        '        ShowTasks()
        '        If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
        '            Call Fill_PatientTasks(gnPatientID)
        '        End If

        '        If rowcnt <> C1UserTasks.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
        '            rowsel -= 1
        '        End If

        '        If C1UserTasks.Rows.Count > rowsel Then ''added condition for problem 00000315 to show selected task v8020 
        '            C1UserTasks.Select(rowsel, 0)
        '        End If

        '    End If
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'Finally
        '    ogloTask.Dispose()
        'End Try

        Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        Try
            Dim TaskId As Int64 = Convert.ToInt64(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"))
            ' Dim Percentage As Int64 = Convert.ToInt64((CType(sender, ToolStripMenuItem)).Tag)
            If TaskId > 0 Then

                Dim rowsel As Integer = 0
                Dim rowcnt As Integer = 0
                rowcnt = _flexGroup.Grid.Rows.Count ''added for problem 00000315 to show selected task v8020 
                rowsel = _flexGroup.Grid.RowSel
                ogloTask.CompleteAll(TaskId)
                ShowTasks()
                If (SelectedPatientDetail = PatientDetails.PatientTasks) Then
                    Call Fill_PatientTasks(gnPatientID)
                End If

                'If rowcnt <> _flexGroup.Grid.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
                '    rowsel -= 1
                'End If

                If _flexGroup.Grid.Rows.Count > rowsel AndAlso rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                    If _flexGroup.Grid.Rows(rowsel).IsNode Then
                        rowsel = rowsel + 1
                    End If
                    _flexGroup.Grid.Select(rowsel, 0)
                Else
                    _flexGroup.Grid.Select(_flexGroup.Grid.Rows.Count - 1, 0)
                End If

            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            ogloTask.Dispose()
        End Try
    End Sub



    Private Sub GetRegisterAppointmentSettingsUserSpecific()
        Dim ogloSettings As New gloSettings.GeneralSettings(_databaseconnectionstring)
        Dim value As Boolean = False

        Try
            value = ogloSettings.GetSettingUserSpecific("RegisterTemplateAppointmentOnly", _UserID, _ClinicID)
            If value = True Then
                _RegAppUsingTemplateOnly = True
            Else
                _RegAppUsingTemplateOnly = False
            End If


        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
        Finally

            If Not IsNothing(ogloSettings) Then
                ogloSettings.Dispose()
            End If

        End Try


    End Sub


    Private Sub CheckrestrictedSettings()

        _databaseconnectionstring = appSettings("DataBaseConnectionString").ToString()


        ' Check ClinicID
        If Not IsNothing(appSettings("ClinicID")) Then

            If (appSettings("ClinicID") <> "") Then
                _ClinicID = Convert.ToInt64(appSettings("ClinicID"))
            Else
                _ClinicID = 0
            End If

        Else
            _ClinicID = 0
        End If


        ' Check UserID
        If Not IsNothing(appSettings("UserID")) Then
            If (appSettings("UserID") <> "") Then
                _UserID = Convert.ToInt64(appSettings("UserID"))
            Else
                _UserID = 1
            End If
        Else
            _UserID = 1
        End If


        GetRegisterAppointmentSettingsUserSpecific()

    End Sub

    'Developer:Sanjog Dhamke
    'Date: 12/07/2011
    'Bug ID/PRD Name/Sales force Case: Issue is TaskId is took the globalTaskid from Dashboard n shows the place the order against that patient on which task is generated. 
    'Reason: ntaskID get value of global taskid from dashboard to avoid this we make the parameter to take TaskID and against it find the patient and place lab order for him/her.
    Private Sub OpenEmdeon(ByVal TaskId As Int64)

        Try

            Dim oclsDB As New gloStream.gloDataBase.gloDataBase
            Dim nPatientID As Int64
            Dim nProviderID As Int64
            Dim query As String
            Dim nDrugVisitID As Int64 = 0 'added by kanchan on 20100622

            oclsDB.Connect(GetConnectionString)
            query = "SELECT nPatientID FROM TM_TaskMST WHERE nTaskID = " & TaskId
            nPatientID = oclsDB.ExecuteQueryScaler(query)
            query = "Select nProviderID FROM Patient where nPatientID= " & nPatientID
            oclsDB.Connect(GetConnectionString)
            Dim strprovid As String = Convert.ToString(oclsDB.ExecuteQueryScaler(query)).Trim()
            If (strprovid.Trim().Length > 0) Then  ''added condition for bugid 106930
                nProviderID = Convert.ToInt64(strprovid)
            Else
                nProviderID = 0
            End If
            Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString)
            Dim objclsgeneral As New gloEmdeonInterface.Classes.clsGeneral()
            Dim _LoginUserProviderID As Long = 0
            Dim _PatientProviderID As Long = 0

            Dim loopcnt As Int16 = 0
            Dim objClsgloLabPatientLayer As gloEmdeonInterface.Classes.clsgloLabPatientLayer = New gloEmdeonInterface.Classes.clsgloLabPatientLayer()
            Dim objpatient As gloPatient.Patient  'SLR: new is not needed
            Dim objgloPatient As New gloPatient.gloPatient(GetConnectionString)

            objpatient = objgloPatient.GetPatient(nPatientID)
            ' _LoginUserProviderID = GetProviderIDForUser(_LoginUserID)
            _LoginUserProviderID = GetProviderIDForUser(gnLoginID)
            _PatientProviderID = objpatient.DemographicsDetail.PatientProviderID

            If Not gloEmdeonInterface.Classes.clsEmdeonGeneral.CheckConnectionParameters(GetConnectionString) Then
                MessageBox.Show("Lab Settings have not been configured in gloEMR Admin." + vbCrLf + "Please complete Lab Settings before ordering.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Return
            End If

            Dim LabConnectionAvailable As gloEmdeonInterface.Classes.clsGeneral.InternetConnectivity
            LabConnectionAvailable = objclsgeneral.IsInternetConnectionAvailable()
            If LabConnectionAvailable = gloEmdeonInterface.Classes.clsGeneral.InternetConnectivity.Success Then

                If Not compareProvider(_PatientProviderID, _LoginUserProviderID, nPatientID) Then
                    Return
                End If

                Dim _billingStatus As Boolean = False

                ' Dim objGloPatientLayer = New gloEmdeonInterface.Classes.clsgloLabPatientLayer() ''slr not used
                _billingStatus = objClsgloLabPatientLayer.CheckBillingType(objpatient)

                If _billingStatus = True Then

                    If (gloEmdeonInterface.Classes.clsEmdeonGeneral.IsDemoLab) Then
                        Dim frmLabDemo As New gloEmdeonInterface.Forms.frmLabDemonstration(nPatientID)

                        'Developer: Sanjog(Dhamke)
                        'Date:10 Dec 2011
                        'Bug ID/PRD Name/Salesforce Case: Lab Usability PRD Show Task Information on Emdeon Lab 
                        'Reason: To show task info

                        frmLabDemo.nTaskId = TaskId
                        frmLabDemo.WindowState = FormWindowState.Maximized
                        frmLabDemo.BringToFront()
                        frmLabDemo.ShowDialog(IIf(IsNothing(frmLabDemo.Parent), Me, frmLabDemo.Parent))
                        frmLabDemo.Dispose()
                    Else
                        Dim strQry As String = String.Empty
                        Dim boolPatientReg As [Boolean] = False
                        If ConfirmNull(objpatient.DemographicsDetail.PatientCode.ToString()) Then
                            strQry = "SELECT COUNT(*) FROM PatientExternalCodes INNER JOIN Patient ON PatientExternalCodes.nPatientId = Patient.nPatientID  where PatientExternalCodes.sExternalType = 'EMDEON' AND    Patient.sPatientCode='" & objpatient.DemographicsDetail.PatientCode.ToString().Trim() & "'"
                        End If
                        oDB.Connect(False)

                        For loopcnt = 1 To 3

                            Dim cnt As Int32 = 0
                            cnt = Convert.ToInt32(oDB.ExecuteScalar_Query(strQry))
                            If cnt < 1 Then
                                ' if cnt is greater than zero means patient registered

                                System.Windows.Forms.Application.DoEvents()

                                gloEmdeonInterface.Classes.clsEmdeonGeneral.gloLab_patID = nPatientID

                                boolPatientReg = objClsgloLabPatientLayer.RegisterGloPatient(objpatient, GetConnectionString)

                                If boolPatientReg Then
                                    Exit For
                                End If
                            Else
                                boolPatientReg = True
                                Exit For
                            End If
                        Next

                        If boolPatientReg = True Then
                            Dim objfrmEmdonInterface As New gloEmdeonInterface.Forms.frmEmdeonInterface(nPatientID)
                            objfrmEmdonInterface.LoginProviderID = gnLoginProviderID
                            objfrmEmdonInterface.nTaskID = TaskId
                            objfrmEmdonInterface.WindowState = FormWindowState.Maximized
                            objfrmEmdonInterface.ShowDialog(IIf(IsNothing(objfrmEmdonInterface.Parent), Me, objfrmEmdonInterface.Parent))
                            If Not IsNothing(objfrmEmdonInterface) Then
                                objfrmEmdonInterface.Dispose()
                                objfrmEmdonInterface = Nothing
                            End If
                        Else

                            If ConfirmNull(gloEmdeonInterface.Classes.clsEmdeonGeneral.gloLab_Identifier.ToString()) Then
                                MessageBox.Show(gloEmdeonInterface.Classes.clsEmdeonGeneral.gloLab_Identifier.ToString().Trim(), "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                            Else
                                MessageBox.Show("Patient is not registered With Emdeon,please try again.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                            End If
                        End If

                    End If
                End If
            Else

                If LabConnectionAvailable = gloEmdeonInterface.Classes.clsGeneral.InternetConnectivity.NoInternet Then

                    Dim objFrmConnectionConfirm As New gloEmdeonInterface.Forms.frmConfirmInternetConnection(True)
                    objFrmConnectionConfirm.ShowInTaskbar = False
                    objFrmConnectionConfirm.ShowDialog(IIf(IsNothing(objFrmConnectionConfirm.Parent), Me, objFrmConnectionConfirm.Parent))
                    objFrmConnectionConfirm.Dispose()

                ElseIf LabConnectionAvailable = gloEmdeonInterface.Classes.clsGeneral.InternetConnectivity.ServerNotresponding Then
                    Dim objFrmConnectionConfirm As New gloEmdeonInterface.Forms.frmConfirmInternetConnection(False)
                    objFrmConnectionConfirm.ShowInTaskbar = False
                    objFrmConnectionConfirm.ShowDialog(IIf(IsNothing(objFrmConnectionConfirm.Parent), Me, objFrmConnectionConfirm.Parent))
                    objFrmConnectionConfirm.Dispose()

                End If
            End If
            If Not IsNothing(objpatient) Then  ''slr free objpatient
                objpatient.Dispose()
                objpatient = Nothing
            End If
            If Not IsNothing(oclsDB) Then   ''slr free oclsDB
                oclsDB.Dispose()
                oclsDB = Nothing
            End If
            If Not IsNothing(oDB) Then   ''slr free oDB
                oDB.Dispose()
                oDB = Nothing
            End If
            If Not IsNothing(objClsgloLabPatientLayer) Then
                objClsgloLabPatientLayer.Dispose()
                objClsgloLabPatientLayer = Nothing
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
      

    End Sub

    Public Function GetProviderIDForUser(ByVal UserID As Int64) As Int64
        Try

            Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString)
            Dim ProID As Int64 = 0
            Try
                oDB.Connect(False)
                ProID = Convert.ToInt64(oDB.ExecuteScalar_Query("SELECT nProviderID from user_mst where nUserID = " & UserID & ""))
                oDB.Disconnect()
            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
                ProID = 0
            Finally
                oDB.Dispose()
            End Try
            Return ProID

        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            Return 0
        End Try
    End Function

    Protected Function ConfirmNull(ByVal strValue As String) As Boolean
        Dim blnCheck As Boolean = False
        Try
            If strValue IsNot Nothing AndAlso strValue.ToString().Trim().Length <> 0 AndAlso strValue.ToString() <> "" Then

                blnCheck = True
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        Return blnCheck
    End Function

    Private Function compareProvider(ByVal _PatientProviderID As Int64, ByVal _LoginUserProviderID As Int64, ByVal PatID As Int64) As Boolean
        Dim objClsGeneral As New gloEmdeonInterface.Classes.clsGeneral()
        Dim strProviderName As String = String.Empty
        Dim strLoginUserName As String = String.Empty
        Dim strLabID As String = String.Empty
        Try
            If _PatientProviderID <> 0 Then
                strProviderName = objClsGeneral.GetProviderName(_PatientProviderID, gnClinicID)
            End If
            If _LoginUserProviderID <> 0 Then
                strLoginUserName = objClsGeneral.GetProviderName(_LoginUserProviderID, gnClinicID)
            End If
            If _LoginUserProviderID = 0 Then

                Dim drMesgResult As DialogResult = MessageBox.Show(("The user you are using is not set up as a provider. If you proceed, the lab order " & vbCr & vbLf & "provider will be defaulted to the current patients provider '") + strProviderName & "'." & vbCr & vbLf & vbCr & vbLf & "Would you like to proceed with creating a new order?", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                If drMesgResult = DialogResult.Yes Then
                    strLabID = objClsGeneral.GetProvidergloLabId(_PatientProviderID)
                    If ConfirmNull(strLabID.ToString()) Then
                        Return True
                    Else
                        If MessageBox.Show("The current provider '" & strProviderName & " ' does not have a lab ID set up." & vbCr & vbLf & "If you place a lab order, you will have to select a provider in the labs interface." & vbCr & vbLf & "Would you like to proceed with the lab order? " & vbCr & vbLf & vbCr & vbLf & "To set up a lab ID, go to provider settings.", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                            Return True
                        Else
                            Return False
                        End If
                    End If
                Else
                    Return False
                End If
            End If

            If _LoginUserProviderID <> _PatientProviderID Then
                Dim dgResult As DialogResult = MessageBox.Show((("This patient is currently assigned to the provider '" & strProviderName & "'.Would " & vbCr & vbLf & "you like to change the patient provider to '") + strLoginUserName & "' ? " & vbCr & vbLf & vbCr & vbLf & "If you select 'No', the lab order will be created for '") + strProviderName & "'.", gstrMessageBoxCaption, MessageBoxButtons.YesNoCancel, MessageBoxIcon.Question)

                If dgResult = DialogResult.Yes Then
                    If objClsGeneral.changePatientProvider(_LoginUserProviderID, PatID) Then
                        strLabID = objClsGeneral.GetProvidergloLabId(_LoginUserProviderID)
                        If ConfirmNull(strLabID.ToString()) Then
                            Return True
                        Else
                            If MessageBox.Show("The current provider '" & strLoginUserName & " ' does not have a lab ID set up." & vbCr & vbLf & "If you place a lab order, you will have to select a provider in the labs interface." & vbCr & vbLf & "Would you like to proceed with the lab order? " & vbCr & vbLf & vbCr & vbLf & "To set up a lab ID, go to provider settings.", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                                Return True
                            Else
                                Return False
                            End If
                        End If
                    Else
                        Return False
                    End If
                ElseIf dgResult = DialogResult.No Then
                    strLabID = objClsGeneral.GetProvidergloLabId(_PatientProviderID)
                    If ConfirmNull(strLabID.ToString()) Then
                        Return True
                    Else
                        If MessageBox.Show("The current provider '" & strProviderName & " ' does not have a lab ID set up." & vbCr & vbLf & "If you place a lab order, you will have to select a provider in the labs interface." & vbCr & vbLf & "Would you like to proceed with the lab order? " & vbCr & vbLf & vbCr & vbLf & "To set up a lab ID, go to provider settings.", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                            Return True
                        Else
                            Return False
                        End If
                    End If
                ElseIf dgResult = DialogResult.Cancel Then
                    Return False

                End If
            End If

            If _LoginUserProviderID = _PatientProviderID Then
                strLabID = objClsGeneral.GetProvidergloLabId(_LoginUserProviderID)
                If ConfirmNull(strLabID.ToString()) Then
                    Return True
                Else
                    If MessageBox.Show("The current provider '" & strLoginUserName & " ' does not have a lab ID set up." & vbCr & vbLf & "If you place a lab order, you will have to select a provider in the labs interface." & vbCr & vbLf & "Would you like to proceed with the lab order? " & vbCr & vbLf & vbCr & vbLf & "To set up a lab ID, go to provider settings.", gstrMessageBoxCaption, MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                        Return True
                    Else
                        Return False
                    End If
                End If
            Else
                Return False
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
            Return False
        End Try
        If Not IsNothing(objClsGeneral) Then  ''slr free objClsGeneral
            objClsGeneral.Dispose()
            objClsGeneral = Nothing
        End If
    End Function
    'Developer:Sanjog Dhamke
    'Date:21 Dec 2011 
    'Bug ID/PRD Name/Sales force Case: PRD Lab Usability 
    'Reason: need to open patient messages window from task for lab task.
    Public Sub OpenMessage()
        Try
            'Developer:Mitesh Patel
            'Date:04 May 2012 
            'Problem # 100 


            ' _nLabPatientId = nLabPatientId
            mnuPatientMessages_Click(Nothing, Nothing)
            '_nLabPatientId = 0
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            Me.pnlMainToolBar.Visible = True
        Finally
        End Try
    End Sub

    Public Sub OpenEducation(ByVal nTemplateID As Int64, ByVal nPatientID As Int64, ByVal sTemplateName As String, ByVal oType As gloEMRGeneralLibrary.clsInfobutton.enumSource, ByVal OpenFor As String, ByVal sResoureType As String)
        Dim ofrmPatientEducation As New frmPatientEducationPreview()
        Try
            ofrmPatientEducation.Text = OpenFor
            'ShowHideMainMenu(True, True)
            'pnlMainToolBar.Visible = False
            'ofrmPatientEducation.MdiParent = Me.ParentForm
            'ofrmPatientEducation.Show()
            'ShowHideMainMenu(False, False)
            ofrmPatientEducation.PATID = nPatientID
            ofrmPatientEducation.TempName = sTemplateName
            ofrmPatientEducation.Sourc = oType.GetHashCode()
            ofrmPatientEducation.ResourcCat = gloEMRGeneralLibrary.clsInfobutton.enumResourceCategory.InternalLibrary
            If sResoureType = "Provider Reference Material" Then
                ofrmPatientEducation.ResourcTyp = gloEMRGeneralLibrary.clsInfobutton.enumResourceType.ProviderReferenceMaterial
            Else
                ofrmPatientEducation.ResourcTyp = gloEMRGeneralLibrary.clsInfobutton.enumResourceType.PatientReferenceMaterial
            End If

            ofrmPatientEducation.TMPID = nTemplateID
            ofrmPatientEducation.ISGRID = False
            ofrmPatientEducation.ShowDialog()
            ofrmPatientEducation.WindowState = FormWindowState.Maximized

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            'ShowHideMainMenu(True, True)
            'pnlMainToolBar.Visible = True



        Finally
            If (IsNothing(ofrmPatientEducation) = False) Then
                ofrmPatientEducation.Close()
            End If
            If (IsNothing(ofrmPatientEducation) = False) Then
                ofrmPatientEducation.Dispose()
                ofrmPatientEducation = Nothing
            End If

        End Try
    End Sub
    Private Sub mnuViewCDSFiles_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuViewCDSFiles.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If
            Dim oVW_CCDDiagnosisOneFiles As New frmVW_CCDDiagnosisOneFiles(gnPatientID)
            oVW_CCDDiagnosisOneFiles.MdiParent = Me
            oVW_CCDDiagnosisOneFiles.ShowInTaskbar = False
            oVW_CCDDiagnosisOneFiles.WindowState = FormWindowState.Maximized
            oVW_CCDDiagnosisOneFiles.Show()
            ShowHideMainMenu(False, False)
            oVW_CCDDiagnosisOneFiles.BringToFront()

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        End Try
    End Sub

    'Developer:Sanjog Dhamke
    'Date: 21 Dec 2011
    'PRD Name: Lab Usability (6060)
    'Reason: To Open the Patient Letter & Referral Letter
    Public Sub OpenPatientLetter()
        Try
            'Developer:Mitesh Patel
            'Date:04 May 2012 
            'Problem # 100 

            ' _nLabPatientId = nLabPatientId
            mnuPatientLetters_Click(Nothing, Nothing)
            '_nLabPatientId = 0
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub OpenReferralLetters()
        Try
            'Developer:Mitesh Patel
            'Date:04 May 2012 
            'Problem # 100 
            ' _nLabPatientId = nLabPatientId
            mnuView_Referrals_Click(Nothing, Nothing)
            '_nLabPatientId = 0
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ReviewIntuitPatientsToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ReviewIntuitPatientsToolStripMenuItem.Click
        Dim ofrmPatientReview As gloEmdeonInterface.Forms.frmIntuitPatientReview = Nothing
        Try
            ofrmPatientReview = New gloEmdeonInterface.Forms.frmIntuitPatientReview(mdlGeneral.globlnEnableMultipleRaceFeatures, mdlGeneral.gblnUSEINTUITINTERFACE)
            ofrmPatientReview.WindowState = FormWindowState.Normal
            ofrmPatientReview.ShowDialog(IIf(IsNothing(ofrmPatientReview.Parent), Me, ofrmPatientReview.Parent))
            ofrmPatientReview.Dispose()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(ofrmPatientReview) Then
                ofrmPatientReview.Dispose()
                ofrmPatientReview = Nothing
            End If
        End Try
    End Sub

    'Developer:Sanjog Dhamke
    'Date: 21 March 2012
    'Bug PRD Name:Copy Exam Functionality
    'Reason: To implement new functionality
    Private Sub CopyPastExam()

        'Modify Code
        Dim nPastExamID As Long
        Dim nVisitID As Long
        Dim dtDOS As DateTime
        Dim strExamName As String
        'Dim bIsReviewed As Boolean
        Dim strTemplateName As String
        Dim strTemplateSpecilty As String = ""

        nPastExamID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Int64)
        nVisitID = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 1), Int64)
        dtDOS = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 2), Date)
        strExamName = CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 3), String)

        ''20121220::AuditTrail Entry Added Whenever the Copy Exam menu is clicked:: Email Dated 12/20/2012:: Subject-copy forward
        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Open, "Past Exam copied forward using Copy Exam.", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        ''

        'Aniket
        '10-Apr-12 Commented to resolve the Template Specilty NULL error. Need to check it later 
        
        strTemplateSpecilty = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 5))
        strTemplateName = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 4))
        
        Dim blnFinished As Boolean

        If CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 6), String) = "Yes" Then
            blnFinished = True
        Else
            blnFinished = False
        End If


        Dim frm As frmPatientExam = Nothing
        Dim NewExamId As Int64
        Dim NewVisitID As Int64


        Try
            GetControlSelection()

            oPatientListControl.PatientID = gnPatientID
            If gstrPatientCode = "" Then
                gstrPatientCode = GetPatientCodefromID(gnPatientID)
            End If
            ' ShowPatientAllDetails(PatientId)
            If Trim(gstrPatientFirstName) <> "" Then
                'If IsAccess(False) = False Then
                '    Exit Sub
                'End If
                'If CheckWordForException() = False Then
                '    Exit Sub
                'End If
                Me.Cursor = Cursors.WaitCursor
                frm = New frmPatientExam(gnPatientID, gnVisitID)

                AddHandler frm.EntOpenMessage, AddressOf OpenMessage
                AddHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                AddHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters
                'AddHandler frm.EvntGenerateCDAFromPatientExam, AddressOf openCDA
                frm.IsCopyExam = True

                frm.OpenExam(nPastExamID)

                NewExamId = frm.examid
                NewVisitID = frm.mgnVisitID

                'If Not blnFinished Then
                Dim objclsExam As New clsPatientExams
                objclsExam.SetProviderExam(NewExamId)

                With frm
                    .Hide()
                    .IsNewExam = True
                    .blnModify = False
                    .Text = "Copy Exams"
                    .PatientID = gnPatientID

                    '' IF CONDITION BY SUDHIR 20090701 ''
                    If .OpenPastExam(nPastExamID, nVisitID, dtDOS, strExamName.Trim(), False, strTemplateName) = True Then
                        .MdiParent = Me
                        .Show()

                        Me.pnlMainToolBar.Visible = False
                        ShowHideMainMenu(False, False)


                        If .ExamViewMode Then
                            .ViewExam(nPastExamID)
                        Else
                            .OpenPastExamContents(nPastExamID, False)
                            .GetdataFromOtherForms(enumDocType.None)
                            objclsExam.UnLock_Exam(nPastExamID, gstrClientMachineName)
                        End If
                        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.Open, "Exam Opened for Copy.", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

                        frm.examid = NewExamId
                        frm.mgnVisitID = NewVisitID

                        frm.lblExamName.Text = strExamName.Trim()
                        frm.cmbTemplateSpecility.Text = strTemplateSpecilty
                        frm.SwitchOffSavingFlags = True
                        frm.SaveExam(0, True)
                        frm.SwitchOffSavingFlags = False
                        'objclsExam.SaveExam(frm.examid, frm.mgnVisitID, gnPatientID, strExamName.Trim(), "", 0, Date.Now, 0, Date.Now, False, strTemplateName)

                        If Not IsNothing(objclsExam) Then
                            objclsExam.Dispose()
                            objclsExam = Nothing
                        End If
                    Else
                        objclsExam.DeleteExam(NewExamId, strExamName, True)

                        RemoveHandler frm.EntOpenMessage, AddressOf OpenMessage
                        RemoveHandler frm.EvntOpenPatientLetter, AddressOf OpenPatientLetter
                        RemoveHandler frm.EvntOpenReferralLetter, AddressOf OpenReferralLetters

                        frm.Dispose()
                        frm = Nothing
                    End If

                End With

                If Not IsNothing(objclsExam) Then
                    objclsExam.Dispose()
                    objclsExam = Nothing
                End If
                Me.Cursor = Cursors.Default
            Else
                Me.Cursor = Cursors.Default
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        Finally
            '16-Aug-13 Aniket: Reset the variable to resolve the Copy Forward exam overwritting issue.
            If Not IsNothing(frm) Then
                frm.examid = NewExamId
                frm.mgnVisitID = NewVisitID


            End If

        End Try

        Me.Cursor = Cursors.Default



    End Sub

#Region "gloCommunity"
    Private Sub mnuShareTemplateUpload_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareTemplateUpload.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("Template", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub
    Private Sub mnuShareTemplateDownload_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareTemplateDownload.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("Template", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareUploadSmartDx_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareUploadSmartDx.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("SmartDx", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub
    Private Sub mnuShareDownloadSmartDx_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareDownloadSmartDx.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("SmartDx", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareLiquidDataUplaod_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareLiquidDataUplaod.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("LiquidData", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub
    Private Sub mnuShareLiquidDataDownload_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareLiquidDataDownload.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("LiquidData", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareUploadSmTreatment_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareUploadSmTreatment.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("CPT", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub
    Private Sub mnuShareDownloadSmTreatment_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareDownloadSmTreatment.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("CPT", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub ConnectCommunityToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ConnectCommunityToolStripMenuItem.Click
        If _blnCheckUser = True Then
            Dim gloCommunityDashBoard As New gloCommunity.Forms.FrmgloCommunityDashboard(ConnectCommunityToolStripMenuItem.Tag)
            If gloCommunity.Classes.clsGeneral.getInstance(gloCommunityDashBoard.Name, gloCommunityDashBoard.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With gloCommunityDashBoard
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub
    Private Sub MyCommunityToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyCommunityToolStripMenuItem.Click
        If _blnCheckUser = True Then
            Dim gloCommunityDashBoard As New gloCommunity.Forms.FrmgloCommunityDashboard(MyCommunityToolStripMenuItem.Tag)
            If gloCommunity.Classes.clsGeneral.getInstance(gloCommunityDashBoard.Name, gloCommunityDashBoard.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With gloCommunityDashBoard
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If

    End Sub

    Private Sub mnushtaskmail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnushtaskmail.Click

    End Sub
    Private Sub mnushdntaskmail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnushdntaskmail.Click

        ViewTaskmail()
    End Sub

    Private Function ViewTaskmail()
        If Not CheckUser() Then ''Added for fixed Bug # : 35658 on 20120904
            Dim Frmtskml As New gloCommunity.Forms.gloCommunityViewData("TaskMail", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(Frmtskml.Name, Frmtskml.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With Frmtskml
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
        Return Nothing
    End Function

    Private Sub mnushuptaskmail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnushuptaskmail.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim Frmtskml As New gloCommunity.Forms.gloCommunityViewData("TaskMail", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(Frmtskml.Name, Frmtskml.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With Frmtskml
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With
                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnushdlblconf_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnushdlblconf.Click
        ViewBillingConfig()
    End Sub

    Private Function ViewBillingConfig()
        If CheckUser() = False Then ''Added for fixed Bug # : 35658 on 20120904
            Dim Frmtskml As New gloCommunity.Forms.gloCommunityViewData("BillingConf", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(Frmtskml.Name, Frmtskml.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With Frmtskml
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
        Return Nothing
    End Function

    Private Sub mnushupblconf_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnushupblconf.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim Frmtskml As New gloCommunity.Forms.gloCommunityViewData("BillingConf", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(Frmtskml.Name, Frmtskml.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With Frmtskml
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareUploadIMSetup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareUploadIMSetup.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmIMSetup As New gloCommunity.Forms.gloCommunityViewData("IMSetup", "Upload")
            Try
                System.Windows.Forms.Application.DoEvents()
                With FrmIMSetup
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                End With

            Catch objErr As Exception
                ShowHideMainMenu(True, True)
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        End If
    End Sub
    Private Sub mnuShareDownloadIMSetup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareDownloadIMSetup.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmIMSetupDown As New gloCommunity.Forms.gloCommunityViewData("IMSetup", "Download")
            Try
                System.Windows.Forms.Application.DoEvents()
                With FrmIMSetupDown
                    .MdiParent = Me
                    .WindowState = FormWindowState.Maximized
                    .Show()
                    ShowHideMainMenu(False, False)
                End With

            Catch objErr As Exception
                ShowHideMainMenu(True, True)
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        End If
    End Sub

    Private Sub mnuShareUploadCVSetup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareUploadCVSetup.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmCVSetup As New gloCommunity.Forms.gloCommunityViewData("CVSetup", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmCVSetup.Name, FrmCVSetup.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmCVSetup
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try

            End If
        End If
    End Sub
    Private Sub mnuShareDownloadCVSetup_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareDownloadCVSetup.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmCVSetupDown As New gloCommunity.Forms.gloCommunityViewData("CVSetup", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmCVSetupDown.Name, FrmCVSetupDown.Text) = False Then

                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmCVSetupDown
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareUploadSmOrder_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareUploadSmOrder.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("Order", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub
    Private Sub mnuShareDownloadSmOrder_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareDownloadSmOrder.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("Order", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnushdlappconf_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnushdlappconf.Click
        ViewAppConfig()
    End Sub

    Private Sub ViewAppConfig()
        If CheckUser() = False Then ''Added for fixed Bug # : 35658 on 20120904
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("AppointmentConfigure", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
        Return
    End Sub
    ''Added for fixed Bug # : 35658 on 20120904
    Private Function CheckUser() As Boolean
        Dim oCommunity As gloCommunity.Classes.clsgloCommunityUsers = Nothing
        Dim _blnUserCheck As Boolean = False
        Try
            oCommunity = New gloCommunity.Classes.clsgloCommunityUsers()
            _blnUserCheck = oCommunity.CheckAuthentication()
        Catch ex As Exception
        Finally
            If Not IsNothing(oCommunity) Then
                oCommunity = Nothing
            End If
        End Try
        Return _blnUserCheck
    End Function
    ''End

    Private Sub mnushupappconf_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnushupappconf.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("AppointmentConfigure", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareHistoryUpload_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareHistoryUpload.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("History", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    FrmgloCommunityViewData.MdiParent = Me
                    FrmgloCommunityViewData.WindowState = FormWindowState.Maximized
                    FrmgloCommunityViewData.Show()
                    ShowHideMainMenu(False, False)
                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                    objErr = Nothing
                End Try
            End If
        End If
    End Sub
    Private Sub mnuShareHistoryDownload_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareHistoryDownload.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("History", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareddlFlowsheet_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareddlFlowsheet.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("Flowsheet", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub
    Private Sub mnuShareUploadFlowsheet_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareUploadFlowsheet.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("Flowsheet", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareDmSetupUpload_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareDmSetupUpload.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("DmSetUp", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub
    Private Sub mnuShareDmSetupDownload_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareDmSetupDownload.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("DmSetUp", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub


    Private Sub mnuShareUploadformglry_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareUploadformglry.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("Formgallery", "Upload")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With
                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    Private Sub mnuShareDlformglry_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuShareDlformglry.Click
        ''Added for fixed bug # : 38195 on 20121004
        CheckUserExist()
        ''End
        If _blnCheckUser = True Then
            Dim FrmgloCommunityViewData As New gloCommunity.Forms.gloCommunityViewData("Formgallery", "Download")
            If gloCommunity.Forms.gloCommunityViewData.getInstance(FrmgloCommunityViewData.Name, FrmgloCommunityViewData.Text) = False Then
                Try
                    System.Windows.Forms.Application.DoEvents()
                    With FrmgloCommunityViewData
                        .MdiParent = Me
                        .WindowState = FormWindowState.Maximized
                        .Show()
                        ShowHideMainMenu(False, False)
                    End With

                Catch objErr As Exception
                    ShowHideMainMenu(True, True)
                    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End If
    End Sub

    'Private Sub mnuSharepoint_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuSharepoint.Click
    '    Dim oclsgloCommunity As New clsgloCommunity()
    '    Dim oclsencryption As New clsencryption
    '    Try
    '        ''Added for check Login user available on SharePoint server if not then add on 20120727
    '        If gstrgloCommunityAuthentication.ToLower() = "form" Then
    '            Dim clsGCUSer As New gloCommunity.Classes.clsgloCommunityUsers()

    '            Dim dtUSer As DataTable = clsGCUSer.getGCUser(gnLoginID, gblnIscommunityStaging)
    '            If Not IsNothing(dtUSer) And dtUSer.Rows.Count > 0 Then
    '                ''get gloCommunity username & password as per login id
    '                Dim _encryptionKey As String = "12345678"
    '                Dim _strEncryptPWD As String = oclsencryption.DecryptFromBase64String(dtUSer.Rows(0)("gc_sPassword").ToString(), _encryptionKey)
    '                gloCommunity.Classes.clsGeneral.gstrGCUserName = dtUSer.Rows(0)("gc_sUserName").ToString()
    '                gloCommunity.Classes.clsGeneral.gstrGCPassword = _strEncryptPWD
    '            Else
    '                ''add gloCommunity user
    '                mnuSharepoint.HideDropDown()
    '                Dim frmAddUser As New gloCommunity.Forms.frmAddGCUser()
    '                frmAddUser.ShowDialog()
    '                ''mnuSharepoint.ShowDropDown()
    '            End If
    '        Else
    '            If oclsgloCommunity.CheckADUserEmail() = False Then
    '                mnuSharepoint.HideDropDown()
    '            End If
    '        End If
    '        ''End

    '    Catch ex As Exception
    '    Finally
    '        oclsgloCommunity = Nothing
    '        oclsencryption = Nothing
    '    End Try
    'End Sub

    Private Sub mnuChangePwd_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuChangePwd.Click
        ''Added for fixed bug # : 38195 on 20121004
        If _blnCheckUser = True Then
            Dim frmChangePwd As New gloCommunity.Forms.frmChangePassword()
            frmChangePwd.ShowDialog(IIf(IsNothing(frmChangePwd.Parent), Me, frmChangePwd.Parent))
            ''slr dispose frmChangePwd
            If Not IsNothing(frmChangePwd) Then
                frmChangePwd.Dispose()
                frmChangePwd = Nothing
            End If
        End If
        ''End
    End Sub

#Region "gloCommunity-Skypy"
    'skype
    'Private Sub But_closeSkype_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles But_closeSkype.Click
    '    '' commented on 19-0ct-2011
    '    '' PanelSkypeMessages.Visible = False
    '    '' commented on 19-0ct-2011
    'End Sub

    'Private Sub PanelSkypeMessages_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PanelSkypeMessages.Click
    '    '' commented on 19-0ct-2011
    '    ' '' ''Try 


    '    ' '' ''    Dim ofrmgloSkypeChat1 As gloCommunity.Forms.frmgloSkypeChat = New gloCommunity.Forms.frmgloSkypeChat(skypercdnm, True, False)
    '    ' '' ''    With ofrmgloSkypeChat1
    '    ' '' ''        .Show()
    '    ' '' ''        .StartPosition = FormStartPosition.CenterScreen
    '    ' '' ''        .BringToFront()

    '    ' '' ''    End With

    '    ' '' ''Catch ex As Exception

    '    ' '' ''End Try
    '    '' commented on 19-0ct-2011
    'End Sub
    '' commented on 19-0ct-2011
    ' Private Sub SkypeMessageStatusChanged(ByVal message As SKYPE4COMLib.ChatMessage, ByVal status As SKYPE4COMLib.TChatMessageStatus)

    ' '' '' ''Try
    ' '' '' ''    If status = SKYPE4COMLib.TChatMessageStatus.cmsReceived Then
    ' '' '' ''        PanelSkypeMessages.Top = Me.Height
    ' '' '' ''        PanelSkypeMessages.Visible = True
    ' '' '' ''        tmrSkpeMessages.Enabled = True
    ' '' '' ''        LblrcdMessages.ResetText()
    ' '' '' ''        'LblrcdMessages.Text = "Skype Message Received From :" & vbLf
    ' '' '' ''        skypercdnm = vbNullString
    ' '' '' ''        skypercdnm = message.FromHandle.ToString()
    ' '' '' ''        LblrcdMessages.Text += vbLf + (message.FromHandle & vbLf)
    ' '' '' ''        Label67.ResetText()
    ' '' '' ''        Label67.Text = " Last message received at " & message.Timestamp.TimeOfDay.ToString()
    ' '' '' ''        'ElseIf status = TChatMessageStatus.cmsSent Then
    ' '' '' ''        '    txtChat.Text += vbLf + (message.FromHandle & " :   " & vbLf) + message.Body
    ' '' '' ''        'End If
    ' '' '' ''        'If txtChat.Text.Length > 0 Then
    ' '' '' ''        '    txtChat.Focus()
    ' '' '' ''        '    txtChat.SelectionStart = txtChat.Text.Length
    ' '' '' ''    End If
    ' '' '' ''Catch objErr As Exception
    ' '' '' ''    MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
    ' '' '' ''End Try

    'End Sub
    '' commented on 19-0ct-2011
    Private Sub VoiceCallToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles VoiceCallToolStripMenuItem.Click
        '' commented on 19-0ct-2011
        'Try

        '    oskype.Attach(8, True)
        '    Dim skypefrmvc As New gloCommunity.Forms.frmgloSkypeChat(skypercdnm, False, True)
        '    skypefrmvc.Show()
        'Catch objErr As Exception
        '    If objErr.Message.ToString().Equals("Not attached.") Then

        '        MessageBox.Show("Please Login into Skype : It is currently " & objErr.Message.ToString(), gloCommunity.Classes.clsGeneral.gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)

        '    Else

        '        MessageBox.Show(objErr.Message.ToString(), gloCommunity.Classes.clsGeneral.gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        '    End If

        'End Try
        '' commented on 19-0ct-2011
    End Sub



    'Private Sub tmrSkpeMessages_Tick(ByVal sender As Object, ByVal e As System.EventArgs) Handles tmrSkpeMessages.Tick
    '    '' commented on 19-0ct-2011
    '    'Try
    '    '    If checkexistingskypeform() Then
    '    '        Exit Sub
    '    '    End If
    '    '    If PanelSkypeMessages.Top > Me.Height - (PanelSkypeMessages.Height + 50) Then
    '    '        PanelSkypeMessages.Top = PanelSkypeMessages.Top - 10
    '    '    Else
    '    '        tmrSkpeMessages.Enabled = False
    '    '    End If
    '    'Catch objErr As Exception
    '    '    MessageBox.Show(objErr.Message.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
    '    'End Try
    '    '' commented on 19-0ct-2011
    'End Sub
    '' commented on 19-0ct-2011
    'Public Function checkexistingskypeform() As Boolean
    '    Dim f As Integer = 0
    '    Try
    '        For Each frm As Form In My.Application.OpenForms
    '            If frm.Name = "frmgloSkypeChat" Then
    '                f = 1
    '            Else
    '                f = 0
    '            End If

    '        Next
    '    Catch ex As Exception

    '    End Try


    '    If f = 1 Then
    '        Return True
    '    Else
    '        Return False
    '    End If
    'End Function
    '' commented on 19-0ct-2011
    Private Sub TextMessageToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TextMessageToolStripMenuItem.Click
        '' commented on 19-0ct-2011
        'Try
        '    oskype.Attach(8, True)
        '    Dim ofrmgloSkypeChat As gloCommunity.Forms.frmgloSkypeChat = New gloCommunity.Forms.frmgloSkypeChat(skypercdnm, False, False)
        '    With ofrmgloSkypeChat
        '        .Show()
        '        .StartPosition = FormStartPosition.CenterScreen
        '        .BringToFront()

        '    End With
        'Catch objErr As Exception
        '    If objErr.Message.ToString().Equals("Not attached.") Then

        '        MessageBox.Show("Please Login into Skype : It is currently " & objErr.Message.ToString(), gloCommunity.Classes.clsGeneral.gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)

        '    Else

        '        MessageBox.Show(objErr.Message.ToString(), gloCommunity.Classes.clsGeneral.gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
        '    End If
        'End Try
        '' commented on 19-0ct-2011
    End Sub
#End Region

#Region "gloCommunity-Biztalk"
    'code start-added by kanchan on 20110826 for biztalk
    Private Sub ToolStripMenuItem22_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles ToolStripMenuItem22.Click
        'Dim frmSendDoc As New gloCommunity.Forms.FrmSendDocs(gnPatientID, GetConnectionString(), GetDMSConnectionString())
        'frmSendDoc.Show()
    End Sub
    'Code Start-Added by kanchan on 20110916 to view incoming messages from biztalk
    'Private Sub ViewIncomingDocumentsToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ViewIncomingDocumentsToolStripMenuItem.Click
    '    'Dim ofrm As New frmBizTalkIncomingMsg

    '    'ofrm.WindowState = FormWindowState.Maximized

    '    'ofrm.ShowDialog()
    '    'ofrm.BringToFront()
    'End Sub
#End Region

#End Region

    Private Sub mnuShareTemplateUpload_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub username()
        Throw New NotImplementedException
    End Sub
#Region "NY WC Forms"

    Public Sub NewWCForm()

        If IsAccess(False) = False Then
            Exit Sub
        End If

        Try
            Using ofrmWCFormViewer As New frmWorkerCompFormViewer(gnPatientID, 0, 0, GetConnectionString(), 0)
                ofrmWCFormViewer.ClaimNo = ""
                ofrmWCFormViewer.ShowDialog(IIf(IsNothing(ofrmWCFormViewer.Parent), Me, ofrmWCFormViewer.Parent))
            End Using

            FillPatientWorkerCompForms()

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            ex = Nothing
        End Try
    End Sub

    Public Sub ModifyWCForm()

        If IsAccess(False) = False Then
            Exit Sub
        End If

        Dim _SelectedTransactionID As Int64 = 0
        Dim _SelectedTransactionmasterID As Int64 = 0
        Dim _SelectedFormID As Int64 = 0
        Dim _SelectedFormType As Int64 = 0

        If C1dgPatientDetails.RowSel > 0 Then
            _SelectedTransactionID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 13))
            _SelectedTransactionmasterID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 12))
            _SelectedFormID = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0))
            _SelectedFormType = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 15))

            If (_SelectedFormType = Convert.ToInt64(WorkersCompFormTypes.C4)) Then
                Dim frmWorkerComp As frmWorkerCompFormViewer = Nothing
                frmWorkerComp = New frmWorkerCompFormViewer(gnPatientID, _SelectedTransactionID, _SelectedTransactionmasterID, GetConnectionString(), _SelectedFormID)
                frmWorkerComp.ClaimNo = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 4))
                frmWorkerComp.ShowDialog(Me)

                frmWorkerComp.Dispose()
                frmWorkerComp = Nothing
            End If
            If (_SelectedFormType = Convert.ToInt64(WorkersCompFormTypes.C42)) Then
                Dim frmWorkerCompC42 As frmWorkerCompFormViewer_C42 = Nothing
                frmWorkerCompC42 = New frmWorkerCompFormViewer_C42(gnPatientID, _SelectedTransactionID, _SelectedTransactionmasterID, GetConnectionString(), _SelectedFormID)
                frmWorkerCompC42.ClaimNo = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 4))
                frmWorkerCompC42.ShowDialog(Me)

                frmWorkerCompC42.Dispose()
                frmWorkerCompC42 = Nothing
            End If
            If (_SelectedFormType = Convert.ToInt64(WorkersCompFormTypes.C4Auth)) Then
                Dim frmWorkerComp_C4Auth As frmWorkerCompFormViewer_C4Auth = Nothing
                frmWorkerComp_C4Auth = New frmWorkerCompFormViewer_C4Auth(gnPatientID, _SelectedTransactionID, _SelectedTransactionmasterID, GetConnectionString(), _SelectedFormID)
                frmWorkerComp_C4Auth.ClaimNo = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 4))
                frmWorkerComp_C4Auth.ShowDialog(Me)

                frmWorkerComp_C4Auth.Dispose()
                frmWorkerComp_C4Auth = Nothing
            End If

            If (_SelectedFormType = Convert.ToInt64(WorkersCompFormTypes.MG2)) Then
                Dim frmWorkerComp_MG2 As frmWorkerCompFormViewer_MG2 = Nothing
                frmWorkerComp_MG2 = New frmWorkerCompFormViewer_MG2(gnPatientID, _SelectedTransactionID, _SelectedTransactionmasterID, GetConnectionString(), _SelectedFormID)
                frmWorkerComp_MG2.ClaimNo = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 4))
                frmWorkerComp_MG2.ShowDialog(Me)

                frmWorkerComp_MG2.Dispose()
                frmWorkerComp_MG2 = Nothing

            End If
            If (_SelectedFormType = Convert.ToInt64(WorkersCompFormTypes.MG21)) Then
                Dim frmWorkerCompFormViewer_MG21 As frmWorkerCompFormViewer_MG21 = Nothing
                frmWorkerCompFormViewer_MG21 = New frmWorkerCompFormViewer_MG21(gnPatientID, _SelectedTransactionID, _SelectedTransactionmasterID, GetConnectionString(), _SelectedFormID)
                frmWorkerCompFormViewer_MG21.ClaimNo = Convert.ToString(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 4))
                frmWorkerCompFormViewer_MG21.ShowDialog(Me)

                frmWorkerCompFormViewer_MG21.Dispose()
                frmWorkerCompFormViewer_MG21 = Nothing

            End If
            

            FillPatientWorkerCompForms()
        End If

    End Sub

#End Region

#Region "Insurance MenuItem"
    'Bug #66982: 00000214 : Questions
    Private Sub PriorAuthorization(ByVal sender As Object, ByVal e As EventArgs)
        Dim ofrmPriorAuthorization As New gloPMGeneral.frmSetupAuthorization(gnPatientID)
        ofrmPriorAuthorization.StartPosition = FormStartPosition.CenterParent
        ofrmPriorAuthorization.ShowDialog(IIf(IsNothing(ofrmPriorAuthorization.Parent), Me, ofrmPriorAuthorization.Parent))
        If ofrmPriorAuthorization IsNot Nothing Then
            ofrmPriorAuthorization.Dispose()
        End If
    End Sub
    Public Sub ModifyInsurance()

        Try
            GetControlSelection()
            GridSelect_RowCount = C1dgPatientDetails.Rows.Count
            Dim oPatient As New gloPatient.gloPatient(GetConnectionString)
            oPatient.ShowPatientRegistration(gnPatientID, gloPatient.ModifyPatientDetailType.Insurance, gnPatientID, Me)
            '' 
            _bIsPatientModify = True
            If gloPatient.gloPatient.SendHL7Details = True Then
                PatientRegSaveClose(gnPatientID)
            End If
            _bIsPatientModify = False
            oPatient.Dispose()
            oPatient = Nothing
            Fill_Insurances()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            SetControlSelection_EMR()

        End Try

    End Sub

    Private Sub eligibilityCheck(ByVal sender As Object, ByVal e As EventArgs)

        'frmEligibilityForm ofrmEligibilityForm = new frmEligibilityForm(gloPMGlobal.DatabaseConnectionString, _CurrentPatientId, tempInsId);
        'ofrmEligibilityForm.ShowDialog();
        'ofrmEligibilityForm.Dispose();

        Dim ogloEiligibility As gloPatient.gloPatientEiligibility = Nothing
        Dim EData As gloPatient.EiligiblityData = Nothing
        Dim _patientProviderid As Int64 = 0
        Dim _insuranceContactid As Int64 = 0
        Dim oSettings As gloSettings.GeneralSettings = Nothing
        Dim _objResult As [Object] = Nothing
        Dim _result As String = ""
        Dim nANSIVersion As Integer = 0

        Try


            ogloEiligibility = New gloPatient.gloPatientEiligibility(GetConnectionString())
            _patientProviderid = ogloEiligibility.GetPatientProviderID(oPatientListControl.PatientID)
            _insuranceContactid = ogloEiligibility.GetInsuranceContactID(tempInsId, oPatientListControl.PatientID)


            Me.Cursor = Cursors.WaitCursor
            If Convert.ToString(gnPatientID).Trim() <> "" AndAlso Convert.ToString(_patientProviderid).Trim() <> "" AndAlso Convert.ToString(tempInsId).Trim() <> "" AndAlso Convert.ToString(_insuranceContactid).Trim() <> "" Then
                EData = ogloEiligibility.GetEiligibilityData(oPatientListControl.PatientID, _patientProviderid, tempInsId, _insuranceContactid)

                oSettings = New gloSettings.GeneralSettings(GetConnectionString())
                oSettings.GetSetting("INSURANCEELIGIBILITY", _objResult)
                _result = Convert.ToString(_objResult)

                nANSIVersion = oSettings.getANSIVersion(_insuranceContactid, "ELIGIBILITY", Convert.ToInt64(appSettings("ClinicID")))

                If EData IsNot Nothing Then
                    If _result = "" OrElse _result = "BYCODE" Then
                        If nANSIVersion = 0 Then
                            MessageBox.Show("Eligibility Requests ANSI Version has not been set. Eligibility may not proceed. Please review in gloPM Admin.", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        ElseIf nANSIVersion = CInt(ANSIVersions.ANSI_4010) Then
                            ogloEiligibility.EDIGeneration_270(EData)
                        ElseIf nANSIVersion = CInt(ANSIVersions.ANSI_5010) Then
                            ogloEiligibility.EDI5010Generation_270(EData, ANSIVersions.ANSI_5010)
                        End If
                    ElseIf _result = "BYSERVICE" Then

                        If nANSIVersion = 0 Then
                            MessageBox.Show("Eligibility Requests ANSI Version has not been set.Eligibility may not proceed.Please review in gloPM Admin.", _MessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        ElseIf nANSIVersion = CInt(ANSIVersions.ANSI_4010) Then
                            ogloEiligibility.EDIGeneration_270(EData, tempInsId, _patientProviderid)
                        End If
                    End If
                End If

            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
        Finally

            Me.Cursor = Cursors.[Default]
            If ogloEiligibility IsNot Nothing Then
                ogloEiligibility.Dispose()
            End If
            If EData IsNot Nothing Then
                EData.Dispose()
            End If
            If Not IsNothing(oSettings) Then ''slr free oSettings
                oSettings.Dispose()
                oSettings = Nothing
            End If
        End Try
    End Sub

    Private Sub ViewBenefits(ByVal sender As Object, ByVal e As EventArgs)
        GetControlSelection()
        Dim nCurrentInsuranceID As Int64 = Convert.ToInt64(C1dgPatientDetails.GetData(C1dgPatientDetails.RowSel, 0))
        Dim ofrm As New frmViewBenefit(gnPatientID, nCurrentInsuranceID, GetConnectionString())
        ofrm.StartPosition = FormStartPosition.CenterParent
        ofrm.ShowDialog(IIf(IsNothing(ofrm.Parent), Me, ofrm.Parent))
        Fill_Insurances()
        SetControlSelection()

    End Sub
#End Region

    Private Sub pnlMainToolBar_VisibleChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles pnlMainToolBar.VisibleChanged
        mnuToolsToolbar.Checked = pnlMainToolBar.Visible
    End Sub

    Private Sub mnuTools_SendSecureMessage_Click(sender As System.Object, e As System.EventArgs) Handles mnuTools_SendSecureMessage.Click

        Dim clsIntuit As New gloPatientPortalCommon.ClsIntuitSecureMessage(GetConnectionString(), gnPatientID, gnClientMachineID, gstrClientMachineName, gstrLoginName)
        Dim PatientStatus As Int16
        clsIntuit.PatientAge = gstrPatientAge
        Dim clsPatientPortal As New clsgloPatientPortalEmail(GetConnectionString())
        Try
            ''Added for MU2 Patient Portal - If Intuit setting is turn on then send secure message to Intuit Portal else gloStream Patient Portal on 20130823
            If gblnUSEINTUITINTERFACE = True AndAlso gblnIntuitCommunication = True Then
                PatientStatus = clsIntuit.CheckValidUser()
                If PatientStatus > 0 Then
                    ShowSecureMessage(PatientStatus)
                End If
            ElseIf gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
                Dim dtPortalValidUser As DataTable = clsPatientPortal.ToCheckPatientRegisterOrNotOnPortal(gnPatientID)
                If dtPortalValidUser IsNot Nothing AndAlso dtPortalValidUser.Rows.Count > 0 Then
                    ShowSecureMessage(1, "", PortalType)
                Else
                    MessageBox.Show("Only registered patients may receive messages on the portal. Patient is not currently registered on the practice portal. If you proceed, a request will be sent to the patient to register and the patient will receive your message after their registration has been accepted. Would you like to proceed? " + System.Environment.NewLine + " " + System.Environment.NewLine + "Note: If the patient has already registered and you are getting this message, please check that there is no pending unaccepted task for the patients registration. ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
                If Not IsNothing(dtPortalValidUser) Then  ''slr free dtPortalValidUser
                    dtPortalValidUser.Dispose()
                End If
                dtPortalValidUser = Nothing
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        Finally
            If Not IsNothing(clsIntuit) Then ''slr dispose clsintuit
                clsIntuit.Dispose()
            End If

            clsIntuit = Nothing
            clsPatientPortal = Nothing
        End Try
    End Sub

    Private Function ShowSecureMessage(ByVal PatientStatus As Int16, Optional ByVal IntuitSearch As String = "", Optional ByVal IsFrom As String = "", Optional ByVal nPatEducationID As Long = 0)

        Dim frmIntuitGlobal As gloIntuitSecureMessage.frmSendSecureMsg = Nothing
        Dim strServiceURI = gstrPatientPortalEmailService


        frmIntuitGlobal = New gloIntuitSecureMessage.frmSendSecureMsg(gnPatientID, GetConnectionString(), gnClientMachineID, gstrClientMachineName, PatientStatus, IsFrom, Convert.ToString(strServiceURI), gstrPatientPortalSiteNm, gnClinicID, gblnIntuitCommunication, nPatEducationID)
    
        'setting value for split screen
        frmIntuitGlobal.objPatientExam = New clsPatientExams
        frmIntuitGlobal.objPatientMessages = New clsMessage
        frmIntuitGlobal.objPatientLetters = New clsPatientLetters
        frmIntuitGlobal.objNurseNotes = New clsNurseNotes
        frmIntuitGlobal.objHistory = New clsPatientHistory
        frmIntuitGlobal.objLabs = New clsLabs
        frmIntuitGlobal.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
        frmIntuitGlobal.objRxmed = New clsPatientDetails
        frmIntuitGlobal.objOrders = New clsPatientDetails
        frmIntuitGlobal.objProblemList = New clsPatientProblemList
        frmIntuitGlobal.objCriteria = New DocCriteria
        frmIntuitGlobal.objWord = New clsWordDocument

        ' frmIntuitGlobal.Owner = Me
        Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frmIntuitGlobal)
        _interophelper.Owner = Me.Handle
        ''
        frmIntuitGlobal.WindowStartupLocation = Windows.WindowStartupLocation.Manual
        Dim boundWidth As Int16 = Screen.PrimaryScreen.Bounds.Width
        Dim boundHeight As Int16 = Screen.PrimaryScreen.Bounds.Height
        Dim x As Int16 = boundWidth - Me.Width
        Dim y As Int16 = boundHeight - Me.Height
        frmIntuitGlobal.Left = Convert.ToInt16(boundHeight / 4)
        frmIntuitGlobal.Top = 25
        ''
        frmIntuitGlobal.Topmost = True
        frmIntuitGlobal.ShowInTaskbar = False
        frmIntuitGlobal.ShowDialog()
        If IsNothing(_interophelper) = False Then
            _interophelper = Nothing
        End If
        If Not IsNothing(frmIntuitGlobal) Then  ''slr close frmIntuitGlobal
            If IsNothing(frmIntuitGlobal.objProblemList) = False Then
                DirectCast(frmIntuitGlobal.objProblemList, clsPatientProblemList).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objCriteria) = False Then
                DirectCast(frmIntuitGlobal.objCriteria, DocCriteria).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objPatientMessages) = False Then
                DirectCast(frmIntuitGlobal.objPatientMessages, clsMessage).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objPatientLetters) = False Then
                DirectCast(frmIntuitGlobal.objPatientLetters, clsPatientLetters).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objNurseNotes) = False Then

                DirectCast(frmIntuitGlobal.objNurseNotes, clsNurseNotes).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objHistory) = False Then

                DirectCast(frmIntuitGlobal.objHistory, clsPatientHistory).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objLabs) = False Then

                DirectCast(frmIntuitGlobal.objLabs, clsLabs).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objDMS) = False Then

                DirectCast(frmIntuitGlobal.objDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objRxmed) = False Then

                DirectCast(frmIntuitGlobal.objRxmed, clsPatientDetails).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objOrders) = False Then

                DirectCast(frmIntuitGlobal.objOrders, clsPatientDetails).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objCriteria) = False Then

                DirectCast(frmIntuitGlobal.objCriteria, DocCriteria).Dispose()
            End If
            If IsNothing(frmIntuitGlobal.objPatientExam) = False Then

                DirectCast(frmIntuitGlobal.objPatientExam, clsPatientExams).Dispose()
            End If

            frmIntuitGlobal.Close()

        End If
        frmIntuitGlobal = Nothing
        If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
            Fill_IntuitMessages(gnPatientID, IntuitSearch)
        End If
        Return Nothing
    End Function


#Region "Patient detail panel Intuit Methods"
    ''Bug #71619: Blocked patient is allowed to reply on message
    ''Added to restrict to reply or send new message to block user.
    Public Function IsPatientBlockOnPortal() As Boolean
        Dim bIsPatientBlock As Boolean = False
        If gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
            Dim clsPatientPortal As New clsgloPatientPortalEmail(GetConnectionString())
            Try

                Dim dtPortalValidUser As DataTable = clsPatientPortal.ToCheckPatientRegisterOrNotOnPortal(gnPatientID)
                If dtPortalValidUser IsNot Nothing AndAlso dtPortalValidUser.Rows.Count > 0 Then
                    bIsPatientBlock = False
                Else
                    bIsPatientBlock = True
                    'MessageBox.Show("Only registered patients may receive messages on the portal. Patient is not currently registered on the practice portal. If you proceed, a request will be sent to the patient to register and the patient will receive your message after their registration has been accepted. Would you like to proceed? " + System.Environment.NewLine + " " + System.Environment.NewLine + "Note: If the patient has already registered and you are getting this message, please check that there is no pending unaccepted task for the patients registration. ", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    MessageBox.Show("Patient does not have an active portal account. No portal messages may be sent to this patient.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
                If Not IsNothing(dtPortalValidUser) Then  ''slr free dtPortalValidUser
                    dtPortalValidUser.Dispose()
                    dtPortalValidUser = Nothing
                End If
            Catch ex As Exception
                gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
            Finally
                clsPatientPortal = Nothing
            End Try
        End If
        Return bIsPatientBlock
    End Function

    Private Sub OpenIntuitMessage()
        'Open Screen For Read Intuit Message
        Try
            If Not IsNothing(IntuitMessageType) Then
                If IntuitMessageType Then
                    'Received Message
                    'Open read Message Screen
                    ''Added Portal Type for MU2 Patient Portal on 20130827
                    Dim strServiceURI = gstrPatientPortalEmailService
                    Dim frmintuit As New gloIntuitSecureMessage.frmReadSecureMsg(gnPatientID, IntuitCommDetailId, GetConnectionString(), gloSettings.FolderSettings.AppTempFolderPath, gnClientMachineID, gstrClientMachineName, PortalType, Convert.ToString(strServiceURI), gstrPatientPortalSiteNm, gnClinicID, gblnIntuitCommunication)
                    frmintuit.IncludeMessageInReply = gblnIncludeMessageInReply
                    frmintuit.IntuitUserRight = objUserRights.Intuit
                    Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frmintuit)
                    _interophelper.Owner = Me.Handle
                    frmintuit.ShowInTaskbar = False

                    'setting value for split screen
                    frmintuit.objPatientExam = New clsPatientExams
                    frmintuit.objPatientMessages = New clsMessage
                    frmintuit.objPatientLetters = New clsPatientLetters
                    frmintuit.objNurseNotes = New clsNurseNotes
                    frmintuit.objHistory = New clsPatientHistory
                    frmintuit.objLabs = New clsLabs
                    frmintuit.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                    frmintuit.objRxmed = New clsPatientDetails
                    frmintuit.objOrders = New clsPatientDetails
                    frmintuit.objProblemList = New clsPatientProblemList
                    frmintuit.objCriteria = New DocCriteria
                    frmintuit.objWord = New clsWordDocument

                    frmintuit.ShowDialog()
                    If IsNothing(_interophelper) = False Then
                        _interophelper = Nothing
                    End If
                    If IsNothing(frmintuit.objProblemList) = False Then
                        DirectCast(frmintuit.objProblemList, clsPatientProblemList).Dispose()
                    End If
                    If IsNothing(frmintuit.objCriteria) = False Then
                        DirectCast(frmintuit.objCriteria, DocCriteria).Dispose()
                    End If
                    If IsNothing(frmintuit.objPatientMessages) = False Then
                        DirectCast(frmintuit.objPatientMessages, clsMessage).Dispose()
                    End If
                    If IsNothing(frmintuit.objPatientLetters) = False Then
                        DirectCast(frmintuit.objPatientLetters, clsPatientLetters).Dispose()
                    End If
                    If IsNothing(frmintuit.objNurseNotes) = False Then

                        DirectCast(frmintuit.objNurseNotes, clsNurseNotes).Dispose()
                    End If
                    If IsNothing(frmintuit.objHistory) = False Then

                        DirectCast(frmintuit.objHistory, clsPatientHistory).Dispose()
                    End If
                    If IsNothing(frmintuit.objLabs) = False Then

                        DirectCast(frmintuit.objLabs, clsLabs).Dispose()
                    End If
                    If IsNothing(frmintuit.objDMS) = False Then

                        DirectCast(frmintuit.objDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                    End If
                    If IsNothing(frmintuit.objRxmed) = False Then

                        DirectCast(frmintuit.objRxmed, clsPatientDetails).Dispose()
                    End If
                    If IsNothing(frmintuit.objOrders) = False Then

                        DirectCast(frmintuit.objOrders, clsPatientDetails).Dispose()
                    End If
                    If IsNothing(frmintuit.objCriteria) = False Then

                        DirectCast(frmintuit.objCriteria, DocCriteria).Dispose()
                    End If
                    If IsNothing(frmintuit.objPatientExam) = False Then

                        DirectCast(frmintuit.objPatientExam, clsPatientExams).Dispose()
                    End If
                    frmintuit.Dispose()
                    frmintuit = Nothing
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Messages Read Screen Opened from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                Else
                    'Sent Message
                    'Open Send Secure Message Screen
                    ''Added Portal Type for MU2 Patient Portal on 20130827
                    Dim frmIntuitSent As New gloIntuitSecureMessage.frmSendSecureMsg(gnPatientID, GetConnectionString(), gnClientMachineID, gstrClientMachineName, IntuitCommDetailId, PortalType)

                    'setting value for split screen
                    frmIntuitSent.objPatientExam = New clsPatientExams
                    frmIntuitSent.objPatientMessages = New clsMessage
                    frmIntuitSent.objPatientLetters = New clsPatientLetters
                    frmIntuitSent.objNurseNotes = New clsNurseNotes
                    frmIntuitSent.objHistory = New clsPatientHistory
                    frmIntuitSent.objLabs = New clsLabs
                    frmIntuitSent.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
                    frmIntuitSent.objRxmed = New clsPatientDetails
                    frmIntuitSent.objOrders = New clsPatientDetails
                    frmIntuitSent.objProblemList = New clsPatientProblemList
                    frmIntuitSent.objCriteria = New DocCriteria
                    frmIntuitSent.objWord = New clsWordDocument


                    ''
                    frmIntuitSent.WindowStartupLocation = Windows.WindowStartupLocation.Manual
                    Dim boundWidth As Int16 = Screen.PrimaryScreen.Bounds.Width
                    Dim boundHeight As Int16 = Screen.PrimaryScreen.Bounds.Height
                    Dim x As Int16 = boundWidth - Me.Width
                    Dim y As Int16 = boundHeight - Me.Height
                    frmIntuitSent.Left = Convert.ToInt16(boundHeight / 4)
                    frmIntuitSent.Top = 25
                    ''
                    Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frmIntuitSent)
                    _interophelper.Owner = Me.Handle
                    frmIntuitSent.ShowInTaskbar = False
                    frmIntuitSent.ShowDialog()
                    If IsNothing(_interophelper) = False Then
                        _interophelper = Nothing
                    End If
                    If Not IsNothing(frmIntuitSent) Then  ''slr close frmintuitsent
                        If IsNothing(frmIntuitSent.objProblemList) = False Then
                            DirectCast(frmIntuitSent.objProblemList, clsPatientProblemList).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objCriteria) = False Then
                            DirectCast(frmIntuitSent.objCriteria, DocCriteria).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objPatientMessages) = False Then
                            DirectCast(frmIntuitSent.objPatientMessages, clsMessage).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objPatientLetters) = False Then
                            DirectCast(frmIntuitSent.objPatientLetters, clsPatientLetters).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objNurseNotes) = False Then

                            DirectCast(frmIntuitSent.objNurseNotes, clsNurseNotes).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objHistory) = False Then

                            DirectCast(frmIntuitSent.objHistory, clsPatientHistory).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objLabs) = False Then

                            DirectCast(frmIntuitSent.objLabs, clsLabs).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objDMS) = False Then

                            DirectCast(frmIntuitSent.objDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objRxmed) = False Then

                            DirectCast(frmIntuitSent.objRxmed, clsPatientDetails).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objOrders) = False Then

                            DirectCast(frmIntuitSent.objOrders, clsPatientDetails).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objCriteria) = False Then

                            DirectCast(frmIntuitSent.objCriteria, DocCriteria).Dispose()
                        End If
                        If IsNothing(frmIntuitSent.objPatientExam) = False Then

                            DirectCast(frmIntuitSent.objPatientExam, clsPatientExams).Dispose()
                        End If
                        frmIntuitSent.Close()

                    End If
                    frmIntuitSent = Nothing
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Messages Send Screen Opened from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                End If
                If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                    Fill_IntuitMessages(gnPatientID, txtSearchIntuit.Text)
                    C1dgPatientDetails.Select(PatientDetailsRowClickIndex, 1)
                End If


            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try

    End Sub

    Private Sub ReplyIntuitMessage()
        ''Bug #71619: Blocked patient is allowed to reply on message
        ''Added to restrict to reply or send new message to block user.
        If gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
            If IsPatientBlockOnPortal() Then
                Exit Sub
            End If
        End If

        If objUserRights.Intuit = False Then
            ''Task #68533: gloEMR Admin - User Management - User Rights - Change "Intuit" to "Patient Portal"
            ''change message text.
            System.Windows.MessageBox.Show("This user does not have the rights to reply a secure message. Please contact your system administrator for the same.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Exit Sub
        End If
        ''Added Portal Type for MU2 Patient Portal on 20130827
        Dim strServiceURI = gstrPatientPortalEmailService
        Dim frmIntuitReply As New gloIntuitSecureMessage.frmSendSecureMsg(gnPatientID, GetConnectionString(), gnClientMachineID, gstrClientMachineName, IntuitCommDetailId, Convert.ToString(strServiceURI), gstrPatientPortalSiteNm, gnClinicID, gblnIntuitCommunication, PortalType)
        Dim _oClsIntuitSecureMessage As gloPatientPortalCommon.ClsIntuitSecureMessage = Nothing
        Dim _msgFlag As Int16 = 0
        Try
            _oClsIntuitSecureMessage = New gloPatientPortalCommon.ClsIntuitSecureMessage(GetConnectionString(), gnPatientID, IntuitCommDetailId)
            _msgFlag = _oClsIntuitSecureMessage.IntuitCheckIsReplied(IntuitCommDetailId)
            If (_msgFlag = 1) Then
                System.Windows.MessageBox.Show("Your practice has already responded to the appointment request. It is not possible to respond a second time. If there are any changes in the appointment request, please send the patient a new message.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub
            End If
            If (_msgFlag = 2) Then
                System.Windows.MessageBox.Show("Your practice has already responded to the prescription renewal request. It is not possible to respond a second time. If there are any changes in the prescription renewal request, please send the patient a new message.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub
            End If

            frmIntuitReply.IsReplyMessage = True
            frmIntuitReply.IncludeMessageInReply = gblnIncludeMessageInReply
            Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frmIntuitReply)
            _interophelper.Owner = Me.Handle
            ''
            frmIntuitReply.WindowStartupLocation = Windows.WindowStartupLocation.Manual
            Dim boundWidth As Int16 = Screen.PrimaryScreen.Bounds.Width
            Dim boundHeight As Int16 = Screen.PrimaryScreen.Bounds.Height
            Dim x As Int16 = boundWidth - Me.Width
            Dim y As Int16 = boundHeight - Me.Height
            frmIntuitReply.Left = Convert.ToInt16(boundHeight / 4)
            frmIntuitReply.Top = 25
            ''
            frmIntuitReply.ShowInTaskbar = False

            'setting value for split screen
            frmIntuitReply.objPatientExam = New clsPatientExams
            frmIntuitReply.objPatientMessages = New clsMessage
            frmIntuitReply.objPatientLetters = New clsPatientLetters
            frmIntuitReply.objNurseNotes = New clsNurseNotes
            frmIntuitReply.objHistory = New clsPatientHistory
            frmIntuitReply.objLabs = New clsLabs
            frmIntuitReply.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
            frmIntuitReply.objRxmed = New clsPatientDetails
            frmIntuitReply.objOrders = New clsPatientDetails
            frmIntuitReply.objProblemList = New clsPatientProblemList
            frmIntuitReply.objCriteria = New DocCriteria
            frmIntuitReply.objWord = New clsWordDocument


            frmIntuitReply.ShowDialog()
            If IsNothing(_interophelper) = False Then
                _interophelper = Nothing
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        Finally
            If IsNothing(_oClsIntuitSecureMessage) = False Then
                _oClsIntuitSecureMessage.Dispose()
                _oClsIntuitSecureMessage = Nothing
            End If

            If IsNothing(frmIntuitReply) = False Then
                If IsNothing(frmIntuitReply.objProblemList) = False Then
                    DirectCast(frmIntuitReply.objProblemList, clsPatientProblemList).Dispose()
                End If
                If IsNothing(frmIntuitReply.objCriteria) = False Then
                    DirectCast(frmIntuitReply.objCriteria, DocCriteria).Dispose()
                End If
                If IsNothing(frmIntuitReply.objPatientMessages) = False Then
                    DirectCast(frmIntuitReply.objPatientMessages, clsMessage).Dispose()
                End If
                If IsNothing(frmIntuitReply.objPatientLetters) = False Then
                    DirectCast(frmIntuitReply.objPatientLetters, clsPatientLetters).Dispose()
                End If
                If IsNothing(frmIntuitReply.objNurseNotes) = False Then

                    DirectCast(frmIntuitReply.objNurseNotes, clsNurseNotes).Dispose()
                End If
                If IsNothing(frmIntuitReply.objHistory) = False Then

                    DirectCast(frmIntuitReply.objHistory, clsPatientHistory).Dispose()
                End If
                If IsNothing(frmIntuitReply.objLabs) = False Then

                    DirectCast(frmIntuitReply.objLabs, clsLabs).Dispose()
                End If
                If IsNothing(frmIntuitReply.objDMS) = False Then

                    DirectCast(frmIntuitReply.objDMS, gloEDocumentV3.eDocManager.eDocGetList).Dispose()
                End If
                If IsNothing(frmIntuitReply.objRxmed) = False Then

                    DirectCast(frmIntuitReply.objRxmed, clsPatientDetails).Dispose()
                End If
                If IsNothing(frmIntuitReply.objOrders) = False Then

                    DirectCast(frmIntuitReply.objOrders, clsPatientDetails).Dispose()
                End If
                If IsNothing(frmIntuitReply.objCriteria) = False Then

                    DirectCast(frmIntuitReply.objCriteria, DocCriteria).Dispose()
                End If
                If IsNothing(frmIntuitReply.objPatientExam) = False Then

                    DirectCast(frmIntuitReply.objPatientExam, clsPatientExams).Dispose()
                End If
                frmIntuitReply.Close()    ''slr close frmintuitreply
                frmIntuitReply = Nothing
            End If
            If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                Fill_IntuitMessages(gnPatientID, txtSearchIntuit.Text)
                C1dgPatientDetails.Select(PatientDetailsRowClickIndex, 1)
            End If

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Messages Reply Screen Opened from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        End Try
    End Sub
    Private Sub CreateIntuitTask()
        Try
            ofrmTask = New gloTaskMail.frmTask(GetConnectionString, 0, IntuitCommDetailId, IntuitMessageSubject, IntuitMessageBody, IntuitAttachmentcount, True)
            'Bug #82464: 00000909: Task screen not opening respective screen
            AddHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange
            ofrmTask.Text = "Tasks"
            ofrmTask.PatientID = gnPatientID
            ofrmTask.ShowDialog(IIf(IsNothing(ofrmTask.Parent), Me, ofrmTask.Parent))
            HandlesTaskChange(Nothing, Nothing, ofrmTask.e2Task)
            RemoveHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange ''slr removehandler
            ofrmTask.Dispose()
            ofrmTask = Nothing
            _objfrmtask = Nothing
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub
    Private Sub MarkReadUnread()
        Dim objIntuit As New clsIntuit
        Dim Success As Boolean
        Try
            If IntuitMessageStatus = "Mark as Read" Then '"Mark As Read"
                Success = objIntuit.ReadUnreadIntuitMessage(gnPatientID, IntuitCommDetailId, True)
            ElseIf IntuitMessageStatus = "Mark as Unread" Then '"Mark As Unread"
                Success = objIntuit.ReadUnreadIntuitMessage(gnPatientID, IntuitCommDetailId, False)
            End If
            If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                Fill_IntuitMessages(gnPatientID, txtSearchIntuit.Text)
                C1dgPatientDetails.Select(PatientDetailsRowClickIndex, 1)
            End If

            objIntuit = Nothing  ''slr free objIntuit

            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Messages is set as Mark as Read/Unread from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try

    End Sub
    Private Sub DeleteIntuitMessage()
        ''Task #68533: gloEMR Admin - User Management - User Rights - Change "Intuit" to "Patient Portal"
        ''added right for delete message.
        If gblnPatientPortalEnabled Then
            If objUserRights.Intuit = False Then
                System.Windows.MessageBox.Show("This user does not have the rights to delete a secure message. Please contact your system administrator for the same.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub
            End If
        End If

        Dim objIntuit As New clsIntuit
        Dim Success As Boolean
        Try
            Dim message As String = ""
            message = Environment.NewLine + Environment.NewLine + "From     : " + IntuitMessageFrom
            message = message + Environment.NewLine
            message = message + "To          : " + IntuitMessageTo
            message = message + Environment.NewLine
            message = message + "Subject  : " + IntuitMessageSubject
            message = message + Environment.NewLine
            message = message + "Date       : " + IntuitMessageDate
            message = message + Environment.NewLine

            Dim dResult As DialogResult = MessageBox.Show("Are you sure you want to delete this secure message?" + message, "Delete Message", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If dResult.ToString() = "Yes" Then
                Success = objIntuit.DeleteMessage(gnPatientID, IntuitCommDetailId)
                If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                    Fill_IntuitMessages(gnPatientID, txtSearchIntuit.Text)
                End If
                gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Message Deleted from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)

            End If
            objIntuit = Nothing   ''slr free objIntuit
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try

    End Sub

    Private Sub SendNewIntuitSecureMessage()
        ''Task #68533: gloEMR Admin - User Management - User Rights - Change "Intuit" to "Patient Portal"
        ''added right for sending new message.
        If gblnPatientPortalEnabled Then
            If objUserRights.Intuit = False Then
                System.Windows.MessageBox.Show("This user does not have the rights to send a new secure message. Please contact your system administrator for the same.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub
            End If
        End If

        'Open Screen For Send New Intuit Secure Message
        Dim clsIntuit As New gloPatientPortalCommon.ClsIntuitSecureMessage(GetConnectionString(), gnPatientID, gnClientMachineID, gstrClientMachineName, gstrLoginName)
        Dim PatientStatus As Int16
        'Try

        '    PatientStatus = clsIntuit.CheckValidUser()
        '    If PatientStatus > 0 Then
        '        Dim frmintuit As New gloIntuitSecureMessage.frmSendSecureMsg(gnPatientID, GetConnectionString(), gnClientMachineID, gstrClientMachineName, PatientStatus)
        '        ' frmintuit.Owner = Me
        '        ''
        '        frmintuit.WindowStartupLocation = Windows.WindowStartupLocation.Manual
        '        Dim boundWidth As Int16 = Screen.PrimaryScreen.Bounds.Width
        '        Dim boundHeight As Int16 = Screen.PrimaryScreen.Bounds.Height
        '        Dim x As Int16 = boundWidth - Me.Width
        '        Dim y As Int16 = boundHeight - Me.Height
        '        frmintuit.Left = Convert.ToInt16(boundHeight / 4)
        '        frmintuit.Top = 25
        '        ''
        '        Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frmintuit)
        '        _interophelper.Owner = Me.Handle
        '        frmintuit.ShowInTaskbar = False

        '        'setting value for split screen
        '        frmintuit.objPatientExam = New clsPatientExams
        '        frmintuit.objPatientMessages = New clsMessage
        '        frmintuit.objPatientLetters = New clsPatientLetters
        '        frmintuit.objNurseNotes = New clsNurseNotes
        '        frmintuit.objHistory = New clsPatientHistory
        '        frmintuit.objLabs = New clsLabs
        '        frmintuit.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
        '        frmintuit.objRxmed = New clsPatientDetails
        '        frmintuit.objOrders = New clsPatientDetails
        '        frmintuit.objProblemList = New clsPatientProblemList
        '        frmintuit.objCriteria = New DocCriteria
        '        frmintuit.objWord = New clsWordDocument


        '        frmintuit.ShowDialog()
        '        If IsNothing(_interophelper) = False Then
        '            _interophelper = Nothing
        '        End If
        '        frmintuit = Nothing
        '        If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
        '            Fill_IntuitMessages(gnPatientID, txtSearchIntuit.Text)
        '        End If
        '        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Messages Send New Screen Opened from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        '    End If
        'Catch ex As Exception
        '    gloAuditTrail.gloAuditTrail.ExceptionLog(ex.Message, False)
        'End Try

        Dim clsPatientPortal As New clsgloPatientPortalEmail(GetConnectionString())
        Try
            ''Added for MU2 Patient Portal - If Intuit setting is turn on then send secure message to Intuit Portal else gloStream Patient Portal on 20130823
            If gblnUSEINTUITINTERFACE = True AndAlso gblnIntuitCommunication = True Then
                PatientStatus = clsIntuit.CheckValidUser()
                If PatientStatus > 0 Then
                    ShowSecureMessage(PatientStatus, txtSearchIntuit.Text)
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Messages Send New Screen Opened from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                End If
            ElseIf gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
                Dim dtPortalValidUser As DataTable = clsPatientPortal.ToCheckPatientRegisterOrNotOnPortal(gnPatientID)
                If dtPortalValidUser IsNot Nothing AndAlso dtPortalValidUser.Rows.Count > 0 Then
                    ShowSecureMessage(1, txtSearchIntuit.Text, PortalType)
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Messages Send New Screen Opened from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                Else
                    MessageBox.Show("Patient does not have an active portal account. No portal messages may be sent to this patient.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
                If Not IsNothing(dtPortalValidUser) Then  ''slr free dtPortalValidUser
                    dtPortalValidUser.Dispose()
                    dtPortalValidUser = Nothing
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        Finally
            If Not IsNothing(clsIntuit) Then  ''slr free clsintuit
                clsIntuit.Dispose()
            End If
            clsIntuit = Nothing
            clsPatientPortal = Nothing

        End Try

    End Sub
#End Region

    Private Sub txtSearchIntuit_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles txtSearchIntuit.TextChanged

        Try
            If txtSearchIntuit.Text = "" Then
                If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                    Fill_IntuitMessages(gnPatientID, txtSearchIntuit.Text)
                    ''Bug #84149: CR00000379: New exam enhancement
                ElseIf SelectedPatientDetail = PatientDetails.NewExam Then
                    Fill_NewExams()
                End If

            Else
                Dim dvFilter As New DataView
                dvFilter = C1dgPatientDetails.DataSource
                Dim strFilter As String = ""
                ''Bug #84149: CR00000379: New exam enhancement
                If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                    strFilter = "Sender  like '%" + txtSearchIntuit.Text + "%' or " +
                                "Receiver like '%" + txtSearchIntuit.Text + "%' or " +
                                "sCommSubject like '%" + txtSearchIntuit.Text + "%'"
                ElseIf SelectedPatientDetail = PatientDetails.NewExam Then
                    strFilter = "sTemplateName  like '%" + txtSearchIntuit.Text + "%'"
                End If
                If strFilter.Trim() <> "" Then
                    dvFilter.RowFilter = strFilter
                End If
            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

    Public Function IsPatientRegisteredOnPortal(ByVal nPatientId As Long, ByVal ShowMessage As String) As Boolean

        If gblnUSEINTUITINTERFACE = True AndAlso gblnIntuitCommunication = True Then
            Dim clsIntuit As New gloPatientPortalCommon.ClsIntuitSecureMessage(GetConnectionString(), gnPatientID, gnClientMachineID, gstrClientMachineName, gstrLoginName)
            Dim PatientStatus As Int16
            PatientStatus = clsIntuit.CheckValidUser(Convert.ToBoolean(ShowMessage))
            If PatientStatus > 0 Then
                Return True
            End If
        ElseIf gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
            Dim clsPatientPortal As New clsgloPatientPortalEmail(GetConnectionString())
            Dim dtPortalValidUser As DataTable = clsPatientPortal.ToCheckPatientRegisterOrNotOnPortal(gnPatientID)
            If dtPortalValidUser IsNot Nothing AndAlso dtPortalValidUser.Rows.Count > 0 Then
                Return True
            Else
                If Convert.ToBoolean(ShowMessage) = True Then
                    MessageBox.Show("Patient does not have an active portal account." + System.Environment.NewLine + "No portal message can be sent.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
                Return False

            End If
        Else
            Return False
        End If
        Return False



    End Function

    Public Sub btnIntuitMsg_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnIntuitMsg.Click
        OpenIntuitSendNewMessage(gstrPatientAge)
    End Sub

    ''06222012
    'Reflection Is implemented to Open Send Intuit Secure Message from Patient Banner
    'This Function Called Only From  gloUC_PatientStrip User Control
    Public Sub OpenIntuitSendNewMessage(ByVal age As String, Optional ByVal nPatEducationID As Long = 0)
        'Open Screen For Send New Intuit Secure Message
        'Try
        '    Dim clsIntuit As New gloIntuitSecureMessage.ClsIntuitSecureMessage(GetConnectionString(), gnPatientID, gnClientMachineID, gstrClientMachineName, gstrLoginName)
        '    Dim PatientStatus As Int16
        '    clsIntuit.PatientAge = age
        '    PatientStatus = clsIntuit.CheckValidUser()
        '    If PatientStatus > 0 Then
        '        Dim frmintuit As New gloIntuitSecureMessage.frmSendSecureMsg(gnPatientID, GetConnectionString(), gnClientMachineID, gstrClientMachineName, PatientStatus)
        '        ' frmintuit.Owner = Me
        '        ''
        '        frmintuit.WindowStartupLocation = Windows.WindowStartupLocation.Manual
        '        Dim boundWidth As Int16 = Screen.PrimaryScreen.Bounds.Width
        '        Dim boundHeight As Int16 = Screen.PrimaryScreen.Bounds.Height
        '        Dim x As Int16 = boundWidth - Me.Width
        '        Dim y As Int16 = boundHeight - Me.Height
        '        frmintuit.Left = Convert.ToInt16(boundHeight / 4)
        '        frmintuit.Top = 25
        '        ''
        '        Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frmintuit)
        '        _interophelper.Owner = Me.Handle
        '        frmintuit.ShowInTaskbar = False

        '        'setting value for split screen
        '        frmintuit.objPatientExam = New clsPatientExams
        '        frmintuit.objPatientMessages = New clsMessage
        '        frmintuit.objPatientLetters = New clsPatientLetters
        '        frmintuit.objNurseNotes = New clsNurseNotes
        '        frmintuit.objHistory = New clsPatientHistory
        '        frmintuit.objLabs = New clsLabs
        '        frmintuit.objDMS = New gloEDocumentV3.eDocManager.eDocGetList()
        '        frmintuit.objRxmed = New clsPatientDetails
        '        frmintuit.objOrders = New clsPatientDetails
        '        frmintuit.objProblemList = New clsPatientProblemList
        '        frmintuit.objCriteria = New DocCriteria
        '        frmintuit.objWord = New clsWordDocument


        '        frmintuit.ShowDialog()
        '        If IsNothing(_interophelper) = False Then
        '            _interophelper = Nothing
        '        End If
        '        frmintuit = Nothing
        '        If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
        '            Fill_IntuitMessages(gnPatientID, txtSearchIntuit.Text)
        '        End If
        '        gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Patient portal Secure Messages Send New Screen Opened from Patient Banner Send Message Button", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
        '    End If
        'Catch ex As Exception
        '    gloAuditTrail.gloAuditTrail.ExceptionLog(ex.Message, False)
        'End Try

        Dim clsIntuit As New gloPatientPortalCommon.ClsIntuitSecureMessage(GetConnectionString(), gnPatientID, gnClientMachineID, gstrClientMachineName, gstrLoginName)
        Dim PatientStatus As Int16

        Dim clsPatientPortal As New clsgloPatientPortalEmail(GetConnectionString())
        Try
            ''Added for MU2 Patient Portal - If Intuit setting is turn on then send secure message to Intuit Portal else gloStream Patient Portal on 20130823
            If gblnUSEINTUITINTERFACE = True AndAlso gblnIntuitCommunication = True Then
                PatientStatus = clsIntuit.CheckValidUser()
                If PatientStatus > 0 Then
                    ShowSecureMessage(PatientStatus, txtSearchIntuit.Text, nPatEducationID:=nPatEducationID)
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "New Screen for Patient Portal Secure Message Opened from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                End If
            ElseIf gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
                Dim dtPortalValidUser As DataTable = clsPatientPortal.ToCheckPatientRegisterOrNotOnPortal(gnPatientID)
                If dtPortalValidUser IsNot Nothing AndAlso dtPortalValidUser.Rows.Count > 0 Then
                    ShowSecureMessage(1, txtSearchIntuit.Text, "gloPatientPortal", nPatEducationID)
                    gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "New Screen for Patient Portal Secure Message Opened from DashBoard", gnPatientID, 0, 0, gloAuditTrail.ActivityOutCome.Success, gloAuditTrail.SoftwareComponent.gloEMR)
                Else
                    MessageBox.Show("Patient does not have an active portal account. No portal messages may be sent to this patient.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
                If Not IsNothing(dtPortalValidUser) Then  ''slr free dtPortalValidUser
                    dtPortalValidUser.Dispose()
                    dtPortalValidUser = Nothing
                End If

            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        Finally
            If Not IsNothing(clsIntuit) Then  ''slr free clsIntuit
                clsIntuit.Dispose()
            End If
            clsIntuit = Nothing
            clsPatientPortal = Nothing
        End Try
        'Return Nothing
    End Sub

    Private Sub C1dgPatientDetails_OwnerDrawCell(ByVal sender As Object, ByVal e As C1.Win.C1FlexGrid.OwnerDrawCellEventArgs) Handles C1dgPatientDetails.OwnerDrawCell
        Try

            If SelectedPatientDetail = PatientDetails.IntuitCommunication AndAlso e.Row > 0 Then

                If IsNothing(C1dgPatientDetails.GetCellImage(e.Row, 0)) = False Then
                    If isPatientDetailsGridSorted Then
                        If (e.Col = 0) Then
                            If Convert.ToBoolean(C1dgPatientDetails.GetData(e.Row, "bCommMessageType")) = False Then
                                C1dgPatientDetails.SetCellImage(e.Row, 0, Imgts_PatientDetails.Images(69))
                            ElseIf Convert.ToBoolean(C1dgPatientDetails.GetData(e.Row, "bCommMessageType")) = True Then
                                C1dgPatientDetails.SetCellImage(e.Row, 0, Imgts_PatientDetails.Images(68))
                            End If

                            If Convert.ToBoolean(C1dgPatientDetails.GetData(e.Row, "bIsReadFlag")) = False Then
                                Dim asgTask As C1.Win.C1FlexGrid.CellStyle '= C1dgPatientDetails.Styles.Add("asgTask")
                                Try
                                    If (C1dgPatientDetails.Styles.Contains("asgTask")) Then
                                        asgTask = C1dgPatientDetails.Styles("asgTask")
                                    Else
                                        asgTask = C1dgPatientDetails.Styles.Add("asgTask")
                                        asgTask.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte(0))

                                    End If
                                Catch ex As Exception
                                    asgTask = C1dgPatientDetails.Styles.Add("asgTask")
                                    asgTask.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte(0))

                                End Try
                                C1dgPatientDetails.SetCellStyle(e.Row, 1, asgTask)
                                C1dgPatientDetails.SetCellStyle(e.Row, 2, asgTask)
                                C1dgPatientDetails.SetCellStyle(e.Row, 3, asgTask)
                                C1dgPatientDetails.SetCellStyle(e.Row, 5, asgTask)
                                C1dgPatientDetails.SetCellStyle(e.Row, 16, asgTask)
                            End If
                        End If
                    End If
                    Exit Sub
                End If
                If (e.Col = 0) Then
                    If Convert.ToBoolean(C1dgPatientDetails.GetData(e.Row, "bCommMessageType")) = False Then
                        C1dgPatientDetails.SetCellImage(e.Row, 0, Imgts_PatientDetails.Images(69))
                    ElseIf Convert.ToBoolean(C1dgPatientDetails.GetData(e.Row, "bCommMessageType")) = True Then
                        C1dgPatientDetails.SetCellImage(e.Row, 0, Imgts_PatientDetails.Images(68))
                    End If

                    If Convert.ToBoolean(C1dgPatientDetails.GetData(e.Row, "bIsReadFlag")) = False Then
                        Dim asgTask As C1.Win.C1FlexGrid.CellStyle '= C1dgPatientDetails.Styles.Add("asgTask")
                        Try
                            If (C1dgPatientDetails.Styles.Contains("asgTask")) Then
                                asgTask = C1dgPatientDetails.Styles("asgTask")
                            Else
                                asgTask = C1dgPatientDetails.Styles.Add("asgTask")
                                asgTask.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD ' New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte(0))

                            End If
                        Catch ex As Exception
                            asgTask = C1dgPatientDetails.Styles.Add("asgTask")
                            asgTask.Font = gloGlobal.clsgloFont.gFont_SMALL_BOLD 'New System.Drawing.Font("Tahoma", 8.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CByte(0))

                        End Try
                        C1dgPatientDetails.SetCellStyle(e.Row, 1, asgTask)
                        C1dgPatientDetails.SetCellStyle(e.Row, 2, asgTask)
                        C1dgPatientDetails.SetCellStyle(e.Row, 3, asgTask)
                        C1dgPatientDetails.SetCellStyle(e.Row, 5, asgTask)
                        C1dgPatientDetails.SetCellStyle(e.Row, 16, asgTask)
                    End If
                End If
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

    Private Sub C1dgPatientDetails_AfterSort(ByVal sender As System.Object, ByVal e As C1.Win.C1FlexGrid.SortColEventArgs) Handles C1dgPatientDetails.AfterSort
        Try
            If SelectedPatientDetail = PatientDetails.IntuitCommunication Then
                isPatientDetailsGridSorted = True
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

    '20120824-Template Speciallity
    'Private Sub cmbTemplateSpecility_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbTemplateSpeciality.SelectedIndexChanged
    '    Fill_PastExams()
    'End Sub

    Private Sub cmbTemplateSpecility_SelectionChangeCommitted(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbTemplateSpeciality.SelectionChangeCommitted
        'Changes for new Template Category parameter in New Exam tab in Patient Details
        If Label64.Text = "Speciality:" Then
            Fill_PastExams()
        Else
            Fill_NewExams()
        End If
    End Sub
    ''Fixed bug id 37063.
    Private Sub mnuSharepoint_DropDownItemClicked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ToolStripItemClickedEventArgs) Handles mnuSharepoint.DropDownItemClicked
        If _blnCheckUser = False Then
            CheckUserExist()
        End If
    End Sub
    ''End

    Private Sub mnuSharepoint_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuSharepoint.Click
        CheckUserExist()
    End Sub

    Private Sub CheckUserExist()
        Dim oclsgloCommunity As New clsgloCommunity()
        Dim oclsencryption As New clsencryption
        Try
            ''Added for check Login user available on SharePoint server if not then add on 20120727
            If gstrgloCommunityAuthentication.ToLower() = "form" Then
                Dim clsGCUSer As New gloCommunity.Classes.clsgloCommunityUsers()

                Dim dtUSer As DataTable = clsGCUSer.getGCUser(gnLoginID, gblnIscommunityStaging)
                If Not IsNothing(dtUSer) AndAlso dtUSer.Rows.Count > 0 Then
                    ''get gloCommunity username & password as per login id
                    Dim _encryptionKey As String = "12345678"
                    Dim _strEncryptPWD As String = oclsencryption.DecryptFromBase64String(dtUSer.Rows(0)("gc_sPassword").ToString(), _encryptionKey)
                    gloCommunity.Classes.clsGeneral.gstrGCUserName = dtUSer.Rows(0)("gc_sUserName").ToString()
                    gloCommunity.Classes.clsGeneral.gstrGCPassword = _strEncryptPWD
                    _blnCheckUser = True
                Else
                    ''add gloCommunity user
                    mnuSharepoint.HideDropDown()
                    Dim frmAddUser As New gloCommunity.Forms.frmAddGCUser()
                    If frmAddUser.ShowDialog(IIf(IsNothing(frmAddUser.Parent), Me, frmAddUser.Parent)) = System.Windows.Forms.DialogResult.Cancel Then
                        If Not IsNothing(frmAddUser) Then  ''slr free frmAddUser
                            frmAddUser.Close()
                            frmAddUser.Dispose()
                            frmAddUser = Nothing
                        End If
                        Exit Sub
                    End If

                    If Not IsNothing(frmAddUser) Then  ''slr free frmAddUser
                        frmAddUser.Close()
                        frmAddUser.Dispose()
                        frmAddUser = Nothing
                    End If

                    If Not IsNothing(dtUSer) Then  ''slr free dtUSer
                        dtUSer.Dispose()
                        dtUSer = Nothing
                    End If
                    _blnCheckUser = True
                End If
            Else
                If oclsgloCommunity.CheckADUserEmail() = False Then
                    mnuSharepoint.HideDropDown()
                End If
            End If
            ''End

        Catch ex As Exception
        Finally

            oclsgloCommunity = Nothing
            oclsencryption = Nothing
        End Try
    End Sub

    ''Added by Mayuri:20121207-Split Screen changes
    Private Sub MainMenu_Activated(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Activated
        If System.Windows.Forms.Application.OpenForms.Count > 0 Then
            For Each ofrm As Form In System.Windows.Forms.Application.OpenForms
                If ofrm.Name = "frmEDocumentViewer" Then
                    If IsNothing(DirectCast(ofrm, gloEDocumentV3.Forms.frmEDocumentViewer).uiPanSplitScreen) = False Then

                        If IsNothing(DirectCast(ofrm, gloEDocumentV3.Forms.frmEDocumentViewer).uiPanSplitScreen.Parent) = False Then

                            If DirectCast(ofrm, gloEDocumentV3.Forms.frmEDocumentViewer).uiPanSplitScreen.Parent.Text = "Split Screen" Then
                                DirectCast(ofrm, gloEDocumentV3.Forms.frmEDocumentViewer).uiPanSplitScreen.Parent.Visible = False


                            End If

                        End If
                    End If
                End If

            Next

        End If
    End Sub

    Private Sub HideCallOutSplitScreen()

        If IsNothing(Me.MdiChildren) = False Then
            If Me.MdiChildren.Count > 0 Then
                For i As Int16 = 0 To Me.MdiChildren.Count - 1
                    Me.MdiChildren(i).WindowState = FormWindowState.Normal



                    If Me.MdiChildren(i).Name = "frmHistory" Then
                        If IsNothing(DirectCast(Me.MdiChildren(i), frmHistory).uiPanSplitScreen_History) = False Then

                            If IsNothing(DirectCast(Me.MdiChildren(i), frmHistory).uiPanSplitScreen_History.Parent) = False Then

                                If DirectCast(Me.MdiChildren(i), frmHistory).uiPanSplitScreen_History.Parent.Text = "Split Screen" Then
                                    DirectCast(Me.MdiChildren(i), frmHistory).uiPanSplitScreen_History.Parent.Visible = False
                                Else
                                    If DirectCast(Me.MdiChildren(i), frmHistory).uiPanSplitScreen_History.Text = "Split Screen" Then
                                        DirectCast(Me.MdiChildren(i), frmHistory).uiPanSplitScreen_History.Visible = False
                                    End If
                                End If

                            End If
                        End If
                    ElseIf Me.MdiChildren(i).Name = "frmPatientLetter" Then
                        If IsNothing(DirectCast(Me.MdiChildren(i), frmPatientLetter).uiPanSplitScreen_PatientLetters) = False Then
                            If IsNothing(DirectCast(Me.MdiChildren(i), frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent) = False Then

                                If DirectCast(Me.MdiChildren(i), frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent.Text = "Split Screen" Then
                                    DirectCast(Me.MdiChildren(i), frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent.Visible = False
                                Else
                                    If DirectCast(Me.MdiChildren(i), frmPatientLetter).uiPanSplitScreen_PatientLetters.Text = "Split Screen" Then
                                        DirectCast(Me.MdiChildren(i), frmPatientLetter).uiPanSplitScreen_PatientLetters.Visible = False
                                    End If
                                End If
                            End If
                        End If
                    ElseIf Me.MdiChildren(i).Name = "frmPatientExam" Then
                        If IsNothing(DirectCast(Me.MdiChildren(i), frmPatientExam).uiPanSplitScreen_PatientExams) = False Then


                            If IsNothing(DirectCast(Me.MdiChildren(i), frmPatientExam).uiPanSplitScreen_PatientExams.Parent) = False Then

                                If DirectCast(Me.MdiChildren(i), frmPatientExam).uiPanSplitScreen_PatientExams.Parent.Text = "Split Screen" Then
                                    DirectCast(Me.MdiChildren(i), frmPatientExam).uiPanSplitScreen_PatientExams.Parent.Visible = False
                                Else
                                    If DirectCast(Me.MdiChildren(i), frmPatientExam).uiPanSplitScreen_PatientExams.Text = "Split Screen" Then
                                        DirectCast(Me.MdiChildren(i), frmPatientExam).uiPanSplitScreen_PatientExams.Visible = False
                                    End If
                                End If
                            End If
                        End If
                    ElseIf Me.MdiChildren(i).Name = "frmMessages" Then
                        If IsNothing(DirectCast(Me.MdiChildren(i), frmMessages).uiPanSplitScreen_PatientMessages) = False Then


                            If IsNothing(DirectCast(Me.MdiChildren(i), frmMessages).uiPanSplitScreen_PatientMessages.Parent) = False Then

                                If DirectCast(Me.MdiChildren(i), frmMessages).uiPanSplitScreen_PatientMessages.Parent.Text = "Split Screen" Then
                                    DirectCast(Me.MdiChildren(i), frmMessages).uiPanSplitScreen_PatientMessages.Parent.Visible = False
                                Else
                                    If DirectCast(Me.MdiChildren(i), frmMessages).uiPanSplitScreen_PatientMessages.Text = "Split Screen" Then
                                        DirectCast(Me.MdiChildren(i), frmMessages).uiPanSplitScreen_PatientMessages.Visible = False
                                    End If
                                End If
                            End If
                        End If
                    ElseIf Me.MdiChildren(i).Name = "frmPrescription" Then
                        If IsNothing(DirectCast(Me.MdiChildren(i), frmPrescription).uiPanSplitScreen_PatientPrescription) = False Then


                            If IsNothing(DirectCast(Me.MdiChildren(i), frmPrescription).uiPanSplitScreen_PatientPrescription.Parent) = False Then

                                If DirectCast(Me.MdiChildren(i), frmPrescription).uiPanSplitScreen_PatientPrescription.Parent.Text = "Split Screen" Then
                                    DirectCast(Me.MdiChildren(i), frmPrescription).uiPanSplitScreen_PatientPrescription.Parent.Visible = False
                                Else
                                    If DirectCast(Me.MdiChildren(i), frmPrescription).uiPanSplitScreen_PatientPrescription.Text = "Split Screen" Then
                                        DirectCast(Me.MdiChildren(i), frmPrescription).uiPanSplitScreen_PatientPrescription.Visible = False
                                    End If
                                End If
                            End If
                        End If
                    End If



                Next
            End If
        End If
    End Sub


    Private Sub ShowSplitScreenOfActiveForm()

        Dim oFrm As Object

        Try

            oFrm = Me.ActiveMdiChild
            If oFrm.Name = "frmHistory" Then
                If IsNothing(DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Parent) = False Then

                    If DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Parent.Text = "Split Screen" Then
                        DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Parent.Visible = True
                    Else
                        If DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Text = "Split Screen" Then
                            DirectCast(oFrm, frmHistory).uiPanSplitScreen_History.Visible = True
                        End If
                    End If
                End If
            ElseIf oFrm.Name = "frmPatientLetter" Then
                If IsNothing(DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent) = False Then

                    If DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent.Text = "Split Screen" Then
                        DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Parent.Visible = True
                    Else
                        If DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Text = "Split Screen" Then
                            DirectCast(oFrm, frmPatientLetter).uiPanSplitScreen_PatientLetters.Visible = True
                        End If
                    End If
                End If
            ElseIf oFrm.Name = "frmPatientExam" Then
                If IsNothing(DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Parent) = False Then

                    If DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Parent.Text = "Split Screen" Then
                        DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Parent.Visible = True
                    Else
                        If DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Text = "Split Screen" Then
                            DirectCast(oFrm, frmPatientExam).uiPanSplitScreen_PatientExams.Visible = True
                        End If
                    End If
                End If
            ElseIf oFrm.Name = "frmMessages" Then
                If IsNothing(DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Parent) = False Then

                    If DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Parent.Text = "Split Screen" Then
                        DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Parent.Visible = True
                    Else

                        If DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Text = "Split Screen" Then
                            DirectCast(oFrm, frmMessages).uiPanSplitScreen_PatientMessages.Visible = True
                        End If
                    End If
                End If
            ElseIf oFrm.Name = "frmPrescription" Then
                If IsNothing(DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Parent) = False Then

                    If DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Parent.Text = "Split Screen" Then
                        DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Parent.Visible = True
                    Else

                        If DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Text = "Split Screen" Then
                            DirectCast(oFrm, frmPrescription).uiPanSplitScreen_PatientPrescription.Visible = True
                        End If
                    End If
                End If
            End If

            '19-Mar-15 Aniket: Handling Bug #80057 ( Modified): gloMedication: Rx-Med- application gives exception on lock screen
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try

    End Sub



    Private Sub mnuVwRECList_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuVwRECList.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim frmReconcilation As frmReconcileList
            frmReconcilation = New frmReconcileList(gnPatientID)
            frmReconcilation.LoginUser = gstrLoginName
            frmReconcilation.LoginID = gnLoginID
            frmReconcilation.ShowDialog(IIf(IsNothing(frmReconcilation.Parent), Me, frmReconcilation.Parent))

            frmReconcilation.Dispose()
            frmReconcilation = Nothing

            ShowReconciliationAlert()
        Catch ex As Exception
            MessageBox.Show(Me, ex.ToString(), gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.[Error])
        End Try
    End Sub


    Private Function GetDMAlert(ByVal nPatientID As Int64)

        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())

        Dim oDataTable As DataTable = Nothing
        Dim _dmalert As String
        _dmalert = ""
        If oDB IsNot Nothing Then
            If oDB.Connect(False) Then
                Dim oParamater As New gloDatabaseLayer.DBParameters()
                Try
                    oParamater.Add("@nPatientID", nPatientID, System.Data.ParameterDirection.Input, System.Data.SqlDbType.BigInt)
                    oParamater.Add("@nClinicID", _ClinicID, System.Data.ParameterDirection.Input, System.Data.SqlDbType.VarChar)
                    oParamater.Add("@sVersion", gstrVersion, System.Data.ParameterDirection.Input, System.Data.SqlDbType.VarChar)
                    'Parameter Added By Sameer on 20 Sep 2013 For Special Alert Rights for Rules
                    oParamater.Add("@nUserID", gnLoginID, ParameterDirection.Input, System.Data.SqlDbType.BigInt)

                    oDB.Retrive("GETDMAlert", oParamater, oDataTable)

                    If oDataTable IsNot Nothing Then
                        If oDataTable.Rows.Count > 0 Then
                            _dmalert = oDataTable(0)(0)
                        End If
                    End If
                Catch ex As gloDatabaseLayer.DBException
                    ex.ERROR_Log(ex.ToString())
                Catch ex As Exception
                    gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
                Finally
                    If oDataTable IsNot Nothing Then
                        oDataTable.Dispose()
                        oDataTable = Nothing
                    End If
                    If oParamater IsNot Nothing Then
                        oParamater.Dispose()
                        oParamater = Nothing
                    End If
                    If oDB IsNot Nothing Then
                        oDB.Disconnect()
                        oDB.Dispose()
                        oDB = Nothing
                    End If
                End Try
            Else
                If oDB IsNot Nothing Then
                    oDB.Disconnect()
                    oDB.Dispose()
                    oDB = Nothing
                End If
            End If
        End If
        Return _dmalert
    End Function

    Private Sub mnuUnfinishedReconciliationLists_Click(sender As System.Object, e As System.EventArgs) Handles mnuUnfinishedReconciliationLists.Click
        Try
            ShowSSRSReport("rptReconciliationFile", "Unextracted Clinical Files", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuUnfinishedFiles_Click(sender As System.Object, e As System.EventArgs) Handles mnuUnfinishedFiles.Click
        Try
            ShowSSRSReport("rptReconciliationList", "Incomplete Clinical Reconciliation", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub MedicaidCensusReportDashboardToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles MedicaidCensusReportDashboardToolStripMenuItem.Click
        Try
            ShowSSRSReport("rptMedicaidCensus", "Medicaid Census Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_rpt_CensusAppointments_Click(sender As System.Object, e As System.EventArgs) Handles mnu_rpt_CensusAppointments.Click
        Try
            ShowSSRSReport("rptAppCensusReport", "Appointment Census Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub mnu_rpt_Appointments_Click(sender As System.Object, e As System.EventArgs) Handles mnu_rpt_Appointments.Click
        Try
            ''   Dim oAppointments As gloReports.C1Reports.frmRpt_Appointments = New gloReports.C1Reports.frmRpt_Appointments(mdlGeneral.GetConnectionString())
            Dim oAppointments As gloReports.frmRPT_AppointmentView = New gloReports.frmRPT_AppointmentView(mdlGeneral.GetConnectionString(), "rptAppointmentList", gstrSQLServerName, gstrDatabaseName, gblnSQLAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR, "gloEMR")

            oAppointments.MdiParent = Me
            oAppointments.ShowInTaskbar = False
            oAppointments.WindowState = FormWindowState.Maximized
            oAppointments.StartPosition = FormStartPosition.CenterParent
            oAppointments.Show()
            ShowHideMainMenu(False, False)


        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Private Sub mnu_rpt_NoShowAppointments_Click(sender As System.Object, e As System.EventArgs) Handles mnu_rpt_NoShowAppointments.Click
        Try
            '' Dim oAppointments As gloReports.C1Reports.frmRpt_CancelledAppointments = gloReports.C1Reports.frmRpt_CancelledAppointments.GetInstance(mdlGeneral.GetConnectionString())
            Dim oAppointments As gloReports.frmRPT_AppointmentView = New gloReports.frmRPT_AppointmentView(mdlGeneral.GetConnectionString(), "rptCancelAppointments", gstrSQLServerName, gstrDatabaseName, gblnSQLAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR, "gloEMR")

            oAppointments.MdiParent = Me
            oAppointments.ShowInTaskbar = False
            oAppointments.WindowState = FormWindowState.Maximized
            oAppointments.StartPosition = FormStartPosition.CenterParent
            oAppointments.Show()
            ShowHideMainMenu(False, False)

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
#Region "Show Reconcile Alert"
    Private Sub PicReconciliationAlert_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PicReconciliationAlert.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            If _IsReadyListPresent Then
                Dim objfrmReconcilation As New frmReconcileList(gnPatientID, _ListType)
                objfrmReconcilation.LoginUser = gstrLoginName
                objfrmReconcilation.LoginID = gnLoginID
                'Me is added only to show form on windows 8
                objfrmReconcilation.ShowDialog(IIf(IsNothing(objfrmReconcilation.Parent), Me, objfrmReconcilation.Parent))

                ShowReconciliationAlert()
                objfrmReconcilation.Dispose()
                objfrmReconcilation = Nothing
            ElseIf _IsImportedFilePresent Then
                Dim ofrmCCDFiles As New frmCCD_ViewFiles()


                ofrmCCDFiles.SelectedPatientID = gnPatientID
                ofrmCCDFiles.ShowInTaskbar = False
                ofrmCCDFiles.WindowState = FormWindowState.Maximized
                'Me is added only to show form on windows 8
                ofrmCCDFiles.ShowDialog(IIf(IsNothing(ofrmCCDFiles.Parent), Me, ofrmCCDFiles.Parent))
                ShowReconciliationAlert()
                ofrmCCDFiles.Dispose()
                ofrmCCDFiles = Nothing
            End If
            ShowPatientDetails()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Public Sub ShowReconciliationAlert(Optional ByVal nPatientID As Int64 = 0)
        Try
            ''
            Dim _objReconciliation As New gloCCDLibrary.gloCCDReconcilation

            Dim _dtUnfinishedReconcile As DataTable

            _IsImportedFilePresent = False
            _IsReadyListPresent = False
            gloCCDLibrary.gloLibCCDGeneral.Connectionstring = GetConnectionString()
            If nPatientID <> 0 Then
                _dtUnfinishedReconcile = _objReconciliation.GetUnFinishedReconcileList(nPatientID)
            Else
                _dtUnfinishedReconcile = _objReconciliation.GetUnFinishedReconcileList(gnPatientID)
            End If

            If IsNothing(_dtUnfinishedReconcile) = False Then
                If _dtUnfinishedReconcile.Rows.Count > 0 Then
                    pnlReconciliationAlert.Visible = True

                    _ListType = Convert.ToString(_dtUnfinishedReconcile.Rows(0)("sListType"))
                    _IsReadyListPresent = True
                Else
                    _IsReadyListPresent = False
                    pnlReconciliationAlert.Visible = False
                End If
            End If

            If _IsReadyListPresent = True Then
                pnlReconciliationAlert.Visible = True
            Else
                pnlReconciliationAlert.Visible = False
                If nPatientID <> 0 Then
                    _IsImportedFilePresent = _objReconciliation.IsImportedFilePresent(nPatientID)
                Else
                    _IsImportedFilePresent = _objReconciliation.IsImportedFilePresent(gnPatientID)
                End If

                If _IsImportedFilePresent = True Then
                    pnlReconciliationAlert.Visible = True
                Else
                    _IsImportedFilePresent = False
                    pnlReconciliationAlert.Visible = False
                End If
            End If
            If IsNothing(_objReconciliation) = False Then
                _objReconciliation = Nothing
            End If
            If IsNothing(_dtUnfinishedReconcile) = False Then
                _dtUnfinishedReconcile.Dispose()
                _dtUnfinishedReconcile = Nothing
            End If
            ''
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub
#End Region


    Private Sub mnuTools_SecureMsg_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mnuTools_SecureMsg.Click
        Try
            If strProviderDirectAddress <> "" OrElse (listDirectUserProviderAssociation IsNot Nothing AndAlso listDirectUserProviderAssociation.Count > 0) Then
                Dim ofrmInbox As gloSurescriptSecureMessage_InBox.Inbox
                ofrmInbox = gloSurescriptSecureMessage_InBox.Inbox.GetInstance()
                If IsNothing(ofrmInbox) = False Then
                    Try
                        RemoveHandler ofrmInbox.tlbCDAImport, AddressOf ShowCDAImportForm
                        RemoveHandler ofrmInbox.tlbDMSImport, AddressOf ShowDMSImportForm
                    Catch ex As Exception

                    End Try

                    AddHandler ofrmInbox.tlbCDAImport, AddressOf ShowCDAImportForm
                    AddHandler ofrmInbox.tlbDMSImport, AddressOf ShowDMSImportForm
                    Try
                        RemoveHandler ofrmInbox.EvntGenerateCDAFromInbox, AddressOf mdlGeneral.OpenCDA
                    Catch ex As Exception

                    End Try

                    If notifyInbox IsNot Nothing AndAlso notifyInbox.Visible Then
                        notifyInbox.Visible = False
                    End If

                    AddHandler ofrmInbox.EvntGenerateCDAFromInbox, AddressOf mdlGeneral.OpenCDA
                    System.Windows.Forms.Integration.ElementHost.EnableModelessKeyboardInterop(ofrmInbox)
                    ofrmInbox.Show()
                    ofrmInbox.Activate()
                End If
            Else
                MessageBox.Show(gstrDirectWarningMessage, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub ShowCDAImportForm(ByVal FilePath As String)
        Dim ofrmAttachment As New frmAttachment(0)
        ofrmAttachment.txtClinicalPath.Text = FilePath
        ofrmAttachment.btnOpenFile.Enabled = False
        ofrmAttachment.txtClinicalPath.ReadOnly = True
        ofrmAttachment.IsInboxForm = True
        ofrmAttachment.ShowDialog()
        ofrmAttachment.Dispose()
        ofrmAttachment = Nothing
    End Sub
    ''Added by Mayuri : 20151103-To Import Attachement to DMS from Direct Message.
    Private Sub ShowDMSImportForm(ByVal FilePath As String)
        Try

        
        gloEDocumentV3.gloEDocV3Admin.Connect(GetConnectionString(), GetDMSConnectionString(), gDMSV2TempPath, Convert.ToInt64(gnLoginID), gClinicID, System.Windows.Forms.Application.StartupPath)

        If IsNothing(oEDocumentV3) Then
            oEDocumentV3 = New gloEDocumentV3.gloEDocV3Management
        End If

            oEDocumentV3.ShowEDMSFromDirect(FilePath, gloEDocumentV3.Enumeration.enum_OpenExternalSource.DirectMessage, 0)
        oEDocumentV3.Dispose()
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    ''Patient Portal
    'Private Sub GetMessageQueue(ByVal PatientID As Int64)

    '    Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
    '    Dim oParamater As New gloDatabaseLayer.DBParameters()
    '    Dim oDataTable As DataTable
    '    Dim nPatientID As Int64
    '    Dim nMessageID As Int64
    '    Dim str As String = ""
    '    Dim sEmail As String = ""
    '    Dim sZip As String = ""

    '    If oDB IsNot Nothing Then
    '        If oDB.Connect(False) Then
    '            Try
    '                oDB.Retrive_Query("SELECT gl_MessageQueue.nMessageID,gl_MessageQueue.npatientID,isnull(patient.sEmail,'') sEmail,isnull(patient.sZip,'') sZip   FROM gl_MessageQueue inner join patient on gl_MessageQueue.npatientID = patient.npatientID WHERE (smessagename='PATIENTINVITATION' or smessagename='PATIENTINVITATION - Resent') and sservicename = 'PatientPortal' and (nStatus = 1) and gl_MessageQueue.npatientid = " + PatientID.ToString(), oDataTable)

    '                If oDataTable IsNot Nothing Then
    '                    For i As Integer = 0 To oDataTable.Rows.Count - 1

    '                        nMessageID = oDataTable(i)("nMessageID")
    '                        nPatientID = oDataTable(i)("npatientID")
    '                        sEmail = oDataTable(i)("sEmail").Trim
    '                        sZip = oDataTable(i)("sZip").Trim

    '                        If (sEmail = "" Or sZip = "") Then
    '                            str = " update gl_MessageQueue set nstatus = 2  WHERE nMessageID=  " + nMessageID.ToString()
    '                        Else
    '                            Dim clsgloPatientPortalEmail As New clsgloPatientPortalEmail(GetConnectionString()) ''Convert.ToString(System.Configuration.ConfigurationManager.AppSettings.Get("EmailSeviceUri"))

    '                            Dim strServiceURI = gstrPatientPortalEmailService

    '                            If clsgloPatientPortalEmail.CreateMail(sEmail, nPatientID, "Patient Activation", strServiceURI, gstrPatientPortalSiteNm + "/PatientActivation.html", gnClinicID) Then
    '                                str = " update gl_MessageQueue set nstatus = 0  WHERE nMessageID=  " + nMessageID.ToString()
    '                            Else
    '                                str = " update gl_MessageQueue set nstatus = 2  WHERE nMessageID=  " + nMessageID.ToString()
    '                            End If
    '                        End If

    '                        oDB.Execute_Query(str)

    '                    Next

    '                End If

    '            Catch ex As gloDatabaseLayer.DBException
    '                ex.ERROR_Log(ex.ToString())
    '            Catch ex As Exception
    '                gloAuditTrail.gloAuditTrail.ExceptionLog(ex.ToString(), True)
    '            Finally
    '                If oDataTable IsNot Nothing Then
    '                    oDataTable.Dispose()
    '                    oDataTable = Nothing
    '                End If
    '                If oParamater IsNot Nothing Then
    '                    oParamater.Dispose()
    '                    oParamater = Nothing
    '                End If
    '                If oDB IsNot Nothing Then
    '                    oDB.Disconnect()
    '                    oDB.Dispose()
    '                    oDB = Nothing
    '                End If
    '            End Try
    '        End If
    '    End If

    'End Sub
    ''Patient Portal
    Private Sub timerEmail_Tick(sender As Object, e As System.EventArgs)
        'If gblnPatientPortalEnabled Then
        '    GetMessageQueue()
        'End If
    End Sub

    Private Sub mnuClinicalInstruction_Click(sender As System.Object, e As System.EventArgs) Handles mnuClinicalInstruction.Click
        Try
            If gnPatientID > 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If
                Dim ofrm As New frmViewClinicalInstruction(gnPatientID)

                ofrm.MdiParent = Me
                ofrm.ShowInTaskbar = False
                ofrm.WindowState = FormWindowState.Maximized
                ofrm.Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuCarePlan_Click(sender As System.Object, e As System.EventArgs) Handles mnuCarePlan.Click
        Try
            If gnPatientID > 0 Then
                If IsAccess(False) = False Then
                    Exit Sub
                End If
                'Dim ofrm As New frmViewCarePlan(gnPatientID)
                Dim ofrm As New frmViewCarePlan_V2(gnPatientID)

                ofrm.MdiParent = Me
                ofrm.ShowInTaskbar = False
                ofrm.WindowState = FormWindowState.Maximized
                ofrm.Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False

            Else
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuEducationMapping_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuEducationMapping.Click

        Try
            Dim frmEducationAssociation As frmEducationAssociation = frmEducationAssociation.GetInstance()
            If IsNothing(frmEducationAssociation) = True Then
                Exit Sub
            End If
            With frmEducationAssociation
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
            End With
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuGenerateCDA_Click(sender As System.Object, e As System.EventArgs) Handles mnuGenerateCDA.Click
        Try
            If gnPatientID <= 0 Then
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If
            If IsAccess(False) = False Then
                Exit Sub
            End If
            Dim objfrm As New frmCCDAGenerateList(gnPatientID)
            objfrm.sDetail = "Exam"
            objfrm.nCDAFileType = CDAFileTypeEnum.ClinicalSummary
            With objfrm
                .WindowState = FormWindowState.Normal
                ''.ChkAll.Checked = True
                .rbSelectAllNormal.Checked = True
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With
            If Not IsNothing(objfrm) Then
                objfrm.Dispose()
                objfrm = Nothing
            End If
        Catch ex As gloCCDLibrary.gloCCDException
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Sub tlbbtn_GenerateCDA_Click(sender As System.Object, e As System.EventArgs) Handles tlbbtn_GenerateCDA.Click
        Try
            _isShowDialogueForm = True
            RegisterMyHotKey()
            If gnPatientID <= 0 Then
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If
            If IsAccess(False) = False Then
                Exit Sub
            End If
            ''added for Bugid #74001 fax cover page setting and other setting  set
            gloEDocumentV3.gloEDocV3Admin.gstrFaxOutputDirectory = gstrFAXOutputDirectory
            gloEDocumentV3.gloEDocV3Admin.blnIsInternetFaxEnabled = gblnInternetFax
            gloEDocumentV3.gloEDocV3Admin.gblnAddFaxCoverpage = gblnFAXCoverPage
            gloEDocumentV3.gloEDocV3Admin.gblnAssociatedProvider = gblnAssociatedProviderSignature

            Dim objfrm As New frmCCDAGenerateList(gnPatientID)
            objfrm.sDetail = "Exam"
            objfrm.nCDAFileType = CDAFileTypeEnum.AmbulatorySummary
            With objfrm
                .WindowState = FormWindowState.Normal
                ''.ChkAll.Checked = True
                .rbSelectAllNormal.Checked = True
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With
            If Not IsNothing(objfrm) Then
                objfrm.Dispose()
                objfrm = Nothing
            End If
        Catch ex As gloCCDLibrary.gloCCDException
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            _isShowDialogueForm = False
        End Try
    End Sub


    Private Sub mnuViewAmendments_Click(sender As System.Object, e As System.EventArgs) Handles mnuViewAmendments.Click
        Try
            Try
                If gnPatientID <= 0 Then
                    If oPatientListControl.VisiblePatientCount > 0 Then
                        MessageBox.Show("Select the Patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Exit Sub
                    Else
                        Exit Sub
                    End If
                End If

                'If gblnProviderDisable = True Then
                '    If ShowAssociateProvider(gnPatientID, Me) = False Then
                '        Exit Sub
                '    Else
                '        oPatientListControl.FillPatients()
                '    End If
                'End If

                Dim ofrmViewAmendments As New frmViewAmendments(0)

                ofrmViewAmendments.MdiParent = Me
                ofrmViewAmendments.Show()
                ofrmViewAmendments.WindowState = FormWindowState.Maximized
                ShowHideMainMenu(False, False)
                Me.pnlMainToolBar.Visible = False

            Catch objErr As Exception
                MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    Public Sub ShowPendingAmedmentsAlert(Optional ByVal nPatientID As Int64 = 0)
        Dim _dt As DataTable = Nothing
        Dim oClsAmendments As New ClsAmendments(nPatientID, 0)
        Dim _alertString As String = ""
        Try
            ''
            lnklblAmendmentsAlert.Text = ""
            lnklblAmendmentsAlert.Visible = False
            If nPatientID <> 0 Then
                _dt = oClsAmendments.GetPatientAmedments(nPatientID)
                If _dt IsNot Nothing AndAlso _dt.Rows.Count > 0 Then
                    Dim _dv As DataView = Nothing
                    Dim _dt1 As DataTable = Nothing
                    Try
                        _dt1 = _dt.Copy()
                        _dv = _dt1.DefaultView
                        _dv.RowFilter = "[" & _dv.Table.Columns(5).ColumnName & "]" & " Like '%Pending%'"
                        _dt = _dv.ToTable()

                        If _dt.Rows.Count > 0 Then
                            _alertString = "Health Record Amendment " + Environment.NewLine + "Requests(" + _dt.Rows.Count.ToString() + " pending)"
                        Else
                            _alertString = "Health Record Amendment " + Environment.NewLine + "Requests(0 pending)"
                        End If
                        lnklblAmendmentsAlert.Visible = True

                    Catch ex As Exception
                        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                    Finally
                        If _dt1 IsNot Nothing Then
                            _dt1.Dispose()
                        End If

                        If _dv IsNot Nothing Then
                            _dv = Nothing
                        End If
                    End Try


                End If
            End If
            lnklblAmendmentsAlert.Text = _alertString

            ''
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If _dt IsNot Nothing Then
                _dt.Dispose()
            End If

            If oClsAmendments IsNot Nothing Then
                oClsAmendments = Nothing
            End If
        End Try

    End Sub
    Private Sub lnklblAmendmentsAlert_LinkClicked(sender As System.Object, e As System.Windows.Forms.LinkLabelLinkClickedEventArgs) Handles lnklblAmendmentsAlert.LinkClicked

        Dim _dt As DataTable = Nothing
        Dim oClsAmendments As New ClsAmendments(gnPatientID, 0)
        Dim _alertString As String = ""
        Try
            If e.Button = Windows.Forms.MouseButtons.Right Then
                Exit Sub
            End If
            If gnPatientID <= 0 Then
                If oPatientListControl.VisiblePatientCount > 0 Then
                    MessageBox.Show("Select the Patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If

            'If gblnProviderDisable = True Then
            '    If ShowAssociateProvider(gnPatientID, Me) = False Then
            '        Exit Sub
            '    Else
            '        oPatientListControl.FillPatients()
            '    End If
            'End If

            Dim ofrmViewAmendments As New frmViewAmendments(gnPatientID)
            Dim sPatientFirstName As String = ""
            Dim sPatientMiddleName As String = ""

            ofrmViewAmendments.MdiParent = Me
            ofrmViewAmendments.gstrPatientCode = gstrPatientCode
            sPatientFirstName = gstrPatientFirstName.First().ToString().ToUpper() + String.Join("", gstrPatientFirstName.Skip(1))

            If gstrPatientMiddleName.Length > 0 Then
                sPatientMiddleName = gstrPatientMiddleName.First().ToString().ToUpper()
                ofrmViewAmendments.gstrPatientName = gstrPatientLastName.ToUpper() & ", " & sPatientFirstName & " " & sPatientMiddleName & "."
            Else
                ofrmViewAmendments.gstrPatientName = gstrPatientLastName.ToUpper() & ", " & sPatientFirstName
            End If

            ofrmViewAmendments.Show()
            ofrmViewAmendments.WindowState = FormWindowState.Maximized
            ShowHideMainMenu(False, False)
            Me.pnlMainToolBar.Visible = False


            lnklblAmendmentsAlert.Text = ""
            lnklblAmendmentsAlert.Visible = False

            If gnPatientID <> 0 Then
                _dt = oClsAmendments.GetPatientAmedments(gnPatientID)
                If _dt IsNot Nothing AndAlso _dt.Rows.Count > 0 Then
                    Dim _dv As DataView = Nothing
                    Dim _dt1 As DataTable = Nothing
                    Try
                        _dt1 = _dt.Copy()
                        _dv = _dt1.DefaultView
                        _dv.RowFilter = "[" & _dv.Table.Columns(5).ColumnName & "]" & " Like '%Pending%'"
                        _dt = _dv.ToTable()

                        If _dt.Rows.Count > 0 Then
                            If _dt.Rows.Count > 0 Then
                                _alertString = "Health Record Amendment " + Environment.NewLine + "Requests(" + _dt.Rows.Count.ToString() + " pending)"
                            Else
                                _alertString = "Health Record Amendment " + Environment.NewLine + "Requests"
                            End If
                            lnklblAmendmentsAlert.Visible = True
                        End If
                    Catch ex As Exception
                        MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
                    Finally
                        If _dt1 IsNot Nothing Then
                            _dt1.Dispose()
                        End If

                        If _dv IsNot Nothing Then
                            _dv = Nothing
                        End If
                    End Try

                End If
            End If
            lnklblAmendmentsAlert.Text = _alertString

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If _dt IsNot Nothing Then
                _dt.Dispose()
            End If

            If oClsAmendments IsNot Nothing Then
                oClsAmendments = Nothing
            End If
        End Try

    End Sub

    Private Sub mnuTools_ExportSummary_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuTools_ExportSummary.Click

        Try
            If gnPatientID <= 0 Then
                If oPatientListControl.PatientCount > 0 Then
                    MessageBox.Show("Select patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim objfrm As New frmCCDAExportSummary()

            With objfrm
                .AllowUserConfiguration = objUserRights.CCDASchedule
                .WindowState = FormWindowState.Normal
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With

            If Not IsNothing(objfrm) Then
                objfrm.Dispose()
                objfrm = Nothing
            End If

        Catch ex As gloCCDLibrary.gloCCDException
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        End Try
    End Sub

    Private Sub mnuTools_CCDASchedule_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuTools_CCDASchedule.Click

        Try

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim objfrm As New frmCCDASchedule()

            With objfrm
                .WindowState = FormWindowState.Normal
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With

            If Not IsNothing(objfrm) Then
                objfrm.Dispose()
                objfrm = Nothing
            End If

        Catch ex As gloCCDLibrary.gloCCDException
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        End Try

    End Sub
    'Added by manoj jadhav on 20140526 to review intuit Health screen
    Private Sub mnuTools_IntuitPatient_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles mnuTools_IntuitPatient.Click
        Try
            Dim objfrmIntuitPatient_View As gloEmdeonInterface.Forms.frmIntuitPatient_View = Nothing
            objfrmIntuitPatient_View = (From Result As Form In Application.OpenForms
                                        Where Result.Name = "frmIntuitPatient_View"
                                        Select Result).FirstOrDefault()
            If IsNothing(objfrmIntuitPatient_View) Then
                objfrmIntuitPatient_View = New gloEmdeonInterface.Forms.frmIntuitPatient_View(mdlGeneral.GetConnectionString())
            End If

            objfrmIntuitPatient_View.MdiParent = Me
            objfrmIntuitPatient_View.WindowState = FormWindowState.Maximized
            objfrmIntuitPatient_View.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Incident #55315: 00016572 : Carry forward issue
    Private Sub EditPrescription(sender As Object, e As EventArgs)
        Try
            GetControlSelection()
            GridSelect_RowCount = C1dgPatientDetails.Rows.Count
            Dim nVisitID As Long = 0
            Try
                nVisitID = GenerateVisitID(CType(C1dgPatientDetails.GetData(C1dgPatientDetails.Row, 0), Date), gnPatientID)
            Catch ex As Exception

            End Try
            Dim frmRxMeds As frmPrescription
            frmRxMeds = frmPrescription.GetInstance(nVisitID, gnPatientID)
            If IsNothing(frmRxMeds) = True Then
                Exit Sub
            End If
            If frmPrescription.IsOpen = False Then
                frmRxMeds.ShowMedication()
            End If
            If frmRxMeds.blncancel = True Then
                frmRxMeds.WindowState = FormWindowState.Maximized
                frmRxMeds.MdiParent = Me
                frmRxMeds.Show()

                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        Finally
            ' SetControlSelection()

        End Try
    End Sub
    Public Sub ShowPatientSavingAlert(ByVal nPatientID As Int64)
        Dim objProcessLayer As gloPatientSavingMessage.clsProcessLayer
        Try
            objProcessLayer = New gloPatientSavingMessage.clsProcessLayer
            gloRxPatientSaving.PatSavGeneral.ConnectionString = mdlGeneral.GetConnectionString()
            If objProcessLayer.ISPatientSavingMessageExist(nPatientID) Then
                pnlPatientSavings.Visible = True
            Else
                pnlPatientSavings.Visible = False
            End If

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            objProcessLayer = Nothing
        End Try
    End Sub

    Private Sub picPatientSavings_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles picPatientSavings.Click
        OpenRxSavingWindow()
    End Sub

    Private Sub OpenRxSavingWindow()
        Dim objProcessLayer As gloPatientSavingMessage.clsProcessLayer
        Dim objwindow As gloPatientSavingMessage.UC_RxSaving = Nothing
        Try

            objProcessLayer = New gloPatientSavingMessage.clsProcessLayer
            gloRxPatientSaving.PatSavGeneral.ConnectionString = mdlGeneral.GetConnectionString()
            gloRxPatientSaving.PatSavGeneral.FilePath = gloSettings.FolderSettings.AppTempFolderPath
            AddHandler objProcessLayer.EntOpenPrescription, AddressOf OpenPrescription
            objwindow = objProcessLayer.ShowPatientSavingMessageForm(gnPatientID)
            If objwindow IsNot Nothing Then
                Dim objForm As New frmRxSave(objwindow)

                objForm.MdiParent = Me
                objForm.Show()
                objForm.WindowState = FormWindowState.Maximized
                ShowHideMainMenu(False, False)
                Me.pnlMainToolBar.Visible = False
            Else
                pnlPatientSavings.Visible = False
            End If

        Catch ex As Exception
        Finally
            objProcessLayer = Nothing
            objwindow = Nothing
        End Try


    End Sub

    Public Sub OpenPrescription(ByVal arrdrug As ArrayList, ByVal ProviderId As Int64, Optional ByVal m_Visitid As Int64 = 0, Optional ByVal m_Patientid As Int64 = 0, Optional ByVal ShowCarryForwardMessage As Boolean = True)
        Dim frmRxMeds As New frmPrescription(arrdrug, ProviderId, m_Visitid, m_Patientid, ShowCarryForwardMessage)
        Try
            frmRxMeds.IsfrmPatientSavings = True
            frmRxMeds.WindowState = FormWindowState.Maximized
            frmRxMeds.ShowDialog(IIf(IsNothing(frmRxMeds.Parent), Me, frmRxMeds.Parent))

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If Not IsNothing(frmRxMeds) Then
                frmRxMeds.Dispose()
                frmRxMeds = Nothing
            End If

        End Try

    End Sub

    Private Sub lblPatientSavings_Click(sender As System.Object, e As System.EventArgs) Handles lblPatientSavings.Click
        OpenRxSavingWindow()
    End Sub
    Private Sub getICD10TransitionSettings()
        Dim objSettings As New clsSettings
        objSettings.GetICD10TransitionSettings()
        objSettings.Dispose()
        objSettings = Nothing
    End Sub

    Private Sub mnuMaster_ICD9Gallery_Click(sender As Object, e As System.EventArgs) Handles mnuMaster_ICD9Gallery.Click
        Try
            Me.Cursor = Cursors.WaitCursor
            Dim frm As New gloGallery.frmICD9CPTGallery(GetConnectionString(), clsGallery.GalleryType.ICD9)
            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            frm.Dispose()
            frm = Nothing
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Me.Cursor = Cursors.Default
        End Try
    End Sub

    Private Sub mnuMaster_CPTGallery_Click(sender As Object, e As System.EventArgs) Handles mnuMaster_CPTGallery.Click
        Try
            Me.Cursor = Cursors.WaitCursor
            Dim frm As New gloGallery.frmICD9CPTGallery(GetConnectionString(), clsGallery.GalleryType.CPT)
            frm.ShowDialog(IIf(IsNothing(frm.Parent), Me, frm.Parent))
            frm.Dispose()
            frm = Nothing
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Me.Cursor = Cursors.Default
        End Try
    End Sub
    Private Sub LoadPatientCards(ByRef ogloPatient As gloPatient.gloPatient)
        If Not IsNothing(oPatientCards) Then
            oPatientCards.Clear()
            oPatientCards.Dispose()

        End If
        oPatientCards = ogloPatient.GetPatientCards(gnPatientID)
        'Dim pict As Image = Nothing
        'For Len As Integer = 0 To oPatientCards.Count - 1
        '    If Not IsNothing(oPatientCards(Len).CardImage) Then
        '        pict = CType(oPatientCards(Len).CardImage, Image)
        '        pict.Tag = Len
        '    End If


        'Next


    End Sub
    Private Sub ClearAllCardInformation()
        Dim patCard As gloPatient.PatientCard = Nothing
        Try
            For Len As Integer = oPatientCards.Count - 1 To 0 Step -1
                patCard = CType(oPatientCards(Len), gloPatient.PatientCard)
                If Not IsNothing(patCard) Then
                    If (Not IsNothing(patCard.CardImage)) Then
                        patCard.CardImage.Dispose()
                        patCard.CardImage = Nothing
                    End If
                    patCard.Dispose()
                    patCard = Nothing
                End If
            Next
        Catch ex As Exception

        End Try
    End Sub
    Private Sub mnuMaster_ICD10Gallery_Click(sender As Object, e As System.EventArgs) Handles mnuMaster_ICD10Gallery.Click
        Try
            Me.Cursor = Cursors.WaitCursor

            Dim ClinicID As Int64 = 0

            If (appSettings("ClinicID") <> Nothing) Then
                If (appSettings("ClinicID") <> "") Then
                    ClinicID = Convert.ToInt64(appSettings("ClinicID"))
                End If
            End If

            Dim frm As gloUIControlLibrary.WPFForms.frmICDCodeGallery = gloUIControlLibrary.WPFForms.frmICDCodeGallery.CheckFormOpen()

            If frm Is Nothing Then
                frm = gloUIControlLibrary.WPFForms.frmICDCodeGallery.GetInstance(GetConnectionString())

                'Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(frm)
                '_interophelper.Owner = Me.Handle

                System.Windows.Forms.Integration.ElementHost.EnableModelessKeyboardInterop(frm)
                frm.ClinicID = ClinicID
                frm.LoadIndexXMLData()
                frm.Show()
            Else
                frm.Visibility = Windows.Visibility.Visible
                frm.WindowState = Windows.WindowState.Maximized
                frm.Activate()
                frm.BringIntoView()
                frm = Nothing
            End If

            'If frm IsNot Nothing Then                
            '    frm.ClinicID = ClinicID
            '    frm.LoadIndexXMLData()
            '    frm.ShowInTaskbar = False
            '    frm.Show()
            '    'frm.Close()
            '    'frm.Dispose()                
            '    'frm = Nothing
            'End If

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Me.Cursor = Cursors.Default
        End Try
    End Sub

    'Private Sub mnuView_PatientFrom_Click(sender As System.Object, e As System.EventArgs) Handles mnuView_PatientFrom.Click

    'End Sub

    Private Sub mnuMaster_ClinicalInstructions_Click(sender As Object, e As System.EventArgs) Handles mnuMaster_ClinicalInstructions.Click
        Try

            Dim frm As New frmAdd_ClinicalInstruction()
            frm.MdiParent = Me
            frm.Show()
            ShowHideMainMenu(False, False)
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

        End Try
    End Sub

    Private Sub mnuMaster_CarePlan_Click(sender As Object, e As System.EventArgs) Handles mnuMaster_CarePlan.Click
        Try
            Me.Cursor = Cursors.WaitCursor
            Dim frm As New frmMSTCarePlan()

            frm.MdiParent = Me
            frm.ShowInTaskbar = False
            frm.WindowState = FormWindowState.Maximized
            frm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Me.Cursor = Cursors.Default
        End Try
    End Sub

    Private Sub MergeOperationEvent(sender As Object)
        Try
            Dim enumTaskForm As IEnumerable(Of Form) = Me.OwnedForms.Where(Function(p) p.Name = "frmTask")

            If enumTaskForm.Any(Function(p) p.Name = "frmTask") Then                
                enumTaskForm.FirstOrDefault(Function(p) p.Name = "frmTask").Close()
            End If

            enumTaskForm = Nothing
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        
    End Sub

    Private Sub mnuICDAnalysis_Click(sender As System.Object, e As System.EventArgs) Handles mnuICDAnalysis.Click
        Try
            'gstrSQLServerName, gstrDatabaseName, gblnSQLAuthentication, gstrSQLUserEMR, gstrSQLPasswordEMR
            Me.Cursor = Cursors.WaitCursor
            Dim objDBSetting As New gloICDAnalysis.ClassLib.DBSetting(gloICDAnalysis.ClassLib.DBSetting.ApplicationType.gloEMR)
            objDBSetting.SqlServerName = gstrSQLServerName
            objDBSetting.DatabaseName = gstrDatabaseName
            objDBSetting.SqlUserName = gstrSQLUserEMR
            objDBSetting.SqlPassword = gstrSQLPasswordEMR
            If gblnSQLAuthentication = True Then
                objDBSetting.IsWindowsAuthentication = False 'gblnSQLAuthentication
            Else
                objDBSetting.IsWindowsAuthentication = True
            End If


            Dim frm As New frmDashboard(gloICDAnalysis.ClassLib.DBSetting.ApplicationType.gloEMR, objDBSetting)

            frm.MdiParent = Me
            frm.ShowInTaskbar = False
            frm.WindowState = FormWindowState.Maximized
            frm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Me.Cursor = Cursors.Default
        End Try

    End Sub

    'Private Function oPatientListControl_Check_IsAccess(sender As System.Object, e As System.EventArgs, nPID As gloPatient.PatientListControl.PatientArgs) As System.Boolean Handles oPatientListControl.Check_IsAccess
    '    Return Nothing
    'End Function

    Private Sub pnlFormularyTransactionMessage_Paint(sender As System.Object, e As System.Windows.Forms.PaintEventArgs) Handles pnlFormularyTransactionMessage.Paint

    End Sub


    Public Function IsPortalEnabled(nObject As String) As Boolean

        If gblnUSEINTUITINTERFACE = True AndAlso gblnIntuitCommunication = True Then
            Return True

        ElseIf gblnPatientPortalEnabled = True AndAlso gblnIntuitCommunication = True Then
            Return True
        End If

        Return False

    End Function

    Private Sub mnuMedicalCategory_Click(sender As System.Object, e As System.EventArgs) Handles mnuMedicalCategory.Click
        Try
            Dim frmCategory As New frmVWMedicalCategory
            frmCategory.MdiParent = Me
            frmCategory.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    'Private Sub chkSearch_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs)
    '    _flexGroup.FilterRow = chkSearch.Checked
    '    If chkSearch.Checked = False Then
    '        _flexGroup.Groups = cmbFilters.Text
    '    End If
    'End Sub
    ''added function to take ownership of task or to put back ownership
    Private Sub cmnuItem_TaskTakeClicked(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmnuItem_TaskTake.Click
        If IsAccess(True) = False Then
            Exit Sub
        End If

        '     Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
        Try
            ' Dim TaskId As Int64 = Convert.ToInt64(C1UserTasks.GetData(C1UserTasks.Row, 1))
            Dim TaskId As Int64 = Convert.ToInt64(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"))

            If TaskId > 0 Then
                'ogloTask.ModifyTaskPriority(TaskId, PriorityID)
                UpdateTakePutTask(Convert.ToString(sender), TaskId)

                ShowTasks()
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            '  ogloTask.Dispose()
        End Try
    End Sub
    ''added function to take ownership of task or to put back ownership
    Private Sub UpdateTakePutTask(ByVal typetask As String, ByVal TaskId As Int64)
        Dim oDB As New gloDatabaseLayer.DBLayer(GetConnectionString())
        Dim oDBParams As gloDatabaseLayer.DBParameters = Nothing

        Try
            oDB.Connect(False)
            oDBParams = New gloDatabaseLayer.DBParameters()
            oDBParams.Add("@TakePuttaskType", typetask, ParameterDirection.Input, SqlDbType.VarChar)
            oDBParams.Add("@TaskId", TaskId, ParameterDirection.Input, SqlDbType.BigInt)
            oDBParams.Add("@LoginID", gnLoginID, ParameterDirection.Input, SqlDbType.BigInt)

            oDB.Execute("gsp_TaskTakePut", oDBParams)
            oDBParams.Clear()
            oDB.Disconnect()
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
        Finally
            If oDB IsNot Nothing Then
                oDB.Dispose()
                oDB = Nothing
            End If
            If oDBParams IsNot Nothing Then
                oDBParams.Clear()
                oDBParams.Dispose()
                oDBParams = Nothing
            End If
        End Try
    End Sub
    Dim blnIsGroupSetToBlankByUser As Boolean = False

    Private Sub cmbFilters_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbFilters.SelectedIndexChanged
        Try
            blnIsTaskGroupSorted = False
            Dim rowsel As Integer
            Dim _taskId As Int64 = 0
            Dim _taskPatientId As Int64 = 0
            If _flexGroup.Grid.Rows.Count > 0 Then
                If _flexGroup.Grid.Rows.Count > 2 Then
                    If _flexGroup.Grid.Row > 0 Then
                        _taskPatientId = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "PatientID"), Int64)
                        _taskId = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"), Int64)
                    End If
                End If
                If _flexGroup.Groups <> cmbFilters.Text Then
                    _flexGroup.Groups = cmbFilters.Text
                End If
                _flexGroup.setPriorityImage()
                _flexGroup.Grid.Focus()
                If blnsetGroupOnLoad = False Then
                    If Not IsNothing(_flexGroup.Grid.DataSource) Then
                        If (_taskPatientId <> gnPatientID) AndAlso _taskPatientId > 0 Then
                            If (pnlPatientList.Visible) Then
                                gnPatientID = _taskPatientId
                                Call SelectPatientOnDashboard(gnPatientID)
                            End If
                        End If
                    End If
                    Dim myrow As C1.Win.C1FlexGrid.Row = (From column In _flexGroup.Grid.Rows Where column("TaskID") = Convert.ToString(_taskId)).FirstOrDefault()
                    If Not IsNothing(myrow) Then
                        rowsel = myrow.Index
                    End If

                    If _flexGroup.Grid.Rows.Count > rowsel AndAlso rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                        If _flexGroup.Grid.Rows(rowsel).IsNode Then
                            rowsel = rowsel + 1
                        End If
                        _flexGroup.Grid.Select(rowsel, 0)
                    Else
                        _flexGroup.Grid.Select(_flexGroup.Grid.Rows.Count - 1, 0)
                    End If
                End If

            End If

            'If _flexGroup.FlexColumnWidthInfoCustom <> "" Then
            '    Dim flexColWidth() As String = _flexGroup.FlexColumnWidthInfoCustom.Split(":")
            '    If flexColWidth.Length > 0 Then
            '        _flexGroup.Grid.Cols("Due Date").Width = flexColWidth(0)
            '        _flexGroup.Grid.Cols("Subject").Width = flexColWidth(1)
            '        _flexGroup.Grid.Cols("Status").Width = flexColWidth(2)
            '        _flexGroup.Grid.Cols("Patient Name").Width = flexColWidth(3)
            '        _flexGroup.Grid.Cols("Priority").Width = flexColWidth(4)
            '        _flexGroup.Grid.Cols("SSN").Width = flexColWidth(5)
            '        _flexGroup.Grid.Cols("Date Of Birth").Width = flexColWidth(6)
            '        _flexGroup.Grid.Cols("Task Type").Width = flexColWidth(7)
            '    End If
            'End If
            If cmbFilters.Text = "" Then
                blnIsGroupSetToBlankByUser = True
            Else
                blnIsGroupSetToBlankByUser = False
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub
    Dim bnlIstaskOpened As Boolean = False
    Dim blntaskfrmopenfrmTaskgrd As Boolean = False
    Private Sub _flexGroupGrid_DoubleClick()
        Dim rowsel As Integer = 0
        Dim rowcnt As Integer = 0
        Dim SelectedFilter As String = ""
        Dim _taskId As Int64 = 0
        Dim _taskPatientId As Int64 = 0
        _isShowDialogueForm = True
        RegisterMyHotKey()
        Try
            SelectedFilter = cmbFilters.Text
            TaskGroupBeforeRightClick = True
            rowcnt = _flexGroup.Grid.Rows.Count
            blntaskfrmopenfrmTaskgrd = True
            If _flexGroup.Grid.Rows.Count > 2 Then
                _taskId = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"), Int64)
                _taskPatientId = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "PatientID"), Int64)
                If (_taskId = 0) Then
                    Exit Sub
                End If
                rowsel = _flexGroup.Grid.RowSel
                Dim _TaskType As String = CType(_flexGroup.Grid.GetData(rowsel, "Task Type"), String)

                If _TaskType = "Reconcile" Then

                End If

                ofrmTask = New gloTaskMail.frmTask(GetConnectionString, _taskId)
                ofrmTask.PatientID = _taskPatientId
                AddHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange
                ofrmTask.IsEMREnable = True
                'ofrmTask.EditTaskfromDashbaordTaskGrid = True
                nTaskId = _taskId
                bnlIstaskOpened = True
                ofrmTask.ShowDialog(IIf(IsNothing(ofrmTask.Parent), Me, ofrmTask.Parent))
                'Dim e2 As gloTaskMail.TaskChangeEventArg = ofrmTask.e2Task
                HandlesTaskChange(Nothing, Nothing, ofrmTask.e2Task)

                bnlIstaskOpened = False
                ShowTasks()
                RemoveHandler ofrmTask.OnTask_Change, AddressOf HandlesTaskChange
                ofrmTask.Dispose()
                ofrmTask = Nothing
                _objfrmtask = Nothing
                ''Added by Abhijeet on 20111123 to auto complete of task after viewing it
                Dim ogloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)
                Dim oTask As New gloTaskMail.Task()
                oTask = ogloTask.GetTask(_taskId)
                If Not IsNothing(oTask) Then
                    If _taskId > 0 AndAlso oTask.Progress.Complete <> 100 AndAlso (oTask.TaskType = gloTaskMail.TaskType.HL7LabInboundFailureNotifyTask) Then
                        ogloTask.CompleteAll(_taskId)
                        ShowTasks() '' Refresh Task panel Data
                    ElseIf _taskId > 0 AndAlso oTask.Progress.Complete <> 100 AndAlso (oTask.TaskType = gloTaskMail.TaskType.PatientPortalTask) AndAlso gblnPatientPortalEnabled = True AndAlso gblnPatientPortalAutoCompleteTaskEnabled = True Then
                        ogloTask.CompleteAll(_taskId)
                        ShowTasks()
                    ElseIf _taskId > 0 AndAlso oTask.Progress.Complete <> 100 AndAlso (oTask.TaskType = gloTaskMail.TaskType.PatientPortalPatientFormTask) AndAlso gblnPatientPortalEnabled = True AndAlso gblnPatientPortalPFAutoCompleteTaskEnabled = True Then
                        ogloTask.CompleteAll(_taskId)
                        ShowTasks()
                    End If
                End If

                If Not IsNothing(oTask) Then
                    oTask.Dispose()
                    oTask = Nothing
                End If
                If Not IsNothing(ogloTask) Then
                    ogloTask.Dispose()
                    ogloTask = Nothing
                End If
                ''End of changes Added by Abhijeet on 20111123 to auto complete of task after viewing it
                '_flexGroup.Groups = SelectedFilter
                'cmbFilters.Text = SelectedFilter
                'cmbFilters.Text = TaskGroupBeforeRightClick
                TaskGroupBeforeRightClick = False
            End If
            '_flexGroup.RemovePriorityImage()
            '' _flexGroup.setPriorityImage()
            'If rowcnt <> _flexGroup.Grid.Rows.Count Then ''added condition for problem 00000315 to show selected task v8020 
            '    rowsel -= 1
            'End If
            Dim myrow As C1.Win.C1FlexGrid.Row = (From column In _flexGroup.Grid.Rows Where column("TaskID") = Convert.ToString(_taskId)).FirstOrDefault()
            If Not IsNothing(myrow) Then
                rowsel = myrow.Index
            End If

            If _flexGroup.Grid.Rows.Count > rowsel AndAlso rowsel > 0 Then ''added condition for problem 00000315 to show selected task v8020 
                If _flexGroup.Grid.Rows(rowsel).IsNode Then
                    rowsel = rowsel + 1
                End If
                _flexGroup.Grid.Select(rowsel, 0)
            Else
                _flexGroup.Grid.Select(_flexGroup.Grid.Rows.Count - 1, 0)
            End If
            If (_taskPatientId <> gnPatientID) AndAlso _taskPatientId > 0 Then
                If (pnlPatientList.Visible) Then
                    gnPatientID = _taskPatientId
                    Call SelectPatientOnDashboard(gnPatientID)
                End If
            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        Finally
            _isShowDialogueForm = False
        End Try
    End Sub

    Private Sub _flexGroupGrid_MouseMove(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs)
        gloC1FlexStyle.ShowToolTip(C1SuperTooltip1, sender, e.Location)
    End Sub
    Dim blnIsTaskGroupSorted As Boolean = False

    Private Sub _flexGroupGrid_MouseUp()
        cmbFilters.Text = ""
        blnIsTaskGroupSorted = True
    End Sub
  
    Private Sub _flexGroupGrid_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs)
        Try
            If Not IsNothing(_flexGroup.Grid.DataSource) Then
                If _flexGroup.Grid.Rows.Count > 0 Then
                    If _flexGroup.Grid.HitTest(e.X, e.Y).Row > 1 Then
                        If ((_flexGroup.Grid.Rows.Count >= 1) AndAlso _flexGroup.Grid.Cols.Count >= 8) Then
                            If (CType(_flexGroup.Grid.GetData(_flexGroup.Grid.HitTest(e.X, e.Y).Row, "PatientID"), Int64) <> gnPatientID) AndAlso CType(_flexGroup.Grid.GetData(_flexGroup.Grid.HitTest(e.X, e.Y).Row, "PatientID"), Int64) > 0 Then
                                If (pnlPatientList.Visible) Then
                                    gnPatientID = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.HitTest(e.X, e.Y).Row, "PatientID"), Int64)
                                    Call SelectPatientOnDashboard(gnPatientID)
                                Else
                                    ''Fixed issue# 76236 -gloEMR-task -Patient context issue on 20141122
                                    If Not Me.ActiveMdiChild Is Nothing Then
                                        If Me.ActiveMdiChild.Name = "frmViewgloLab" Then
                                            If CType(_flexGroup.Grid.GetData(_flexGroup.Grid.HitTest(e.X, e.Y).Row, "Task Type"), String) = "LabOrder" Then
                                                SetGnPatientID = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.HitTest(e.X, e.Y).Row, "PatientID"), Int64)

                                            End If

                                        End If
                                    End If


                                End If
                                'ShowPatientAllDetails(gnPatientID)''COMMENT BY SUDHIR 20090418 '' AS THIS FUNCTION INVOKE IN ABOVE METHOD '' NO NEED TO CALL AGAIN
                            End If
                        End If
                    End If
                End If
            End If


            cmunItem_Completed.Visible = False
            cmnuItem_Priority.Visible = False
            cmnuItem_TaskSeparator.Visible = False
            cmnuItem_CompleteTask.Visible = False
            cmnuItem_RejectTask.Visible = False
            cmnuItem_AcceptTask.Visible = False
            cmnuItem_CompleteAll.Visible = False
            cmnuItem_TaskTake.Visible = False
            If e.Button = MouseButtons.Right Then
                If _flexGroup.Grid.HitTest(e.X, e.Y).Row >= 1 Then
                    _flexGroup.Grid.Row = _flexGroup.Grid.HitTest(e.X, e.Y).Row
                    _flexGroup.Grid.ContextMenuStrip = cmnu_Tasks
                    If Not (IsNothing(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("TaskID"))) Then
                        If _flexGroup.Grid.Row < 0 Then
                            cmunItem_Completed.Visible = False

                            cmnuItem_Priority.Visible = False
                            cmnuItem_TaskSeparator.Visible = False
                            cmnuItem_CompleteTask.Visible = False
                            cmnuItem_CompleteAll.Visible = False
                        Else
                            If ((Not IsNothing(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("bIsOwner"))) AndAlso (_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("Status") <> "Not Yet Accepted")) Then

                                If (_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("bIsOwner") = "False") And (Convert.ToString(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("TaskGroupID")) <> "0") And (Convert.ToString(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("bIsOwnerAssigned")) = "False") Then
                                    cmnuItem_TaskTake.Visible = True
                                    cmnuItem_TaskTake.Text = "Take"
                                    Me.cmnuItem_TaskTake.Image = My.Resources.Task_Owner.ToBitmap()
                                End If
                                If (_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("bIsOwner") = "True") And (Convert.ToString(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("TaskGroupID")) <> "0") Then
                                    cmnuItem_TaskTake.Visible = True
                                    cmnuItem_TaskTake.Text = "Put Back"
                                    Me.cmnuItem_TaskTake.Image = My.Resources.Task_NoOwner.ToBitmap()

                                End If
                            End If
                        End If
                    End If
                    If Not (IsNothing(_flexGroup.Grid.Rows(_flexGroup.Grid.Row)("TaskID"))) Then
                        If _flexGroup.Grid.Rows(_flexGroup.Grid.Row)("AssignStatus") <> gnLoginID Then
                            cmnuItem_AcceptTask.Visible = True
                            cmnuItem_RejectTask.Visible = True
                            cmunItem_Completed.Visible = False
                            cmnuItem_CompleteTask.Visible = False
                            cmnuItem_CompleteAll.Visible = False
                        Else
                            cmnuItem_AcceptTask.Visible = False
                            cmnuItem_RejectTask.Visible = False

                            Dim objTask As gloTaskMail.Task = New gloTaskMail.Task()
                            Dim objgloTask As gloTaskMail.gloTask = New gloTaskMail.gloTask(GetConnectionString)

                            objTask = objgloTask.GetTask(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskID"))
                            If objTask.TaskType = gloTaskMail.TaskType.UnmatchedPatient Then
                                cmunItem_Completed.Visible = False
                                cmnuItem_CompleteTask.Visible = False
                                cmnuItem_CompleteAll.Visible = False
                            Else
                                cmunItem_Completed.Visible = True
                                cmnuItem_CompleteTask.Visible = True
                                If _IsHasRighttoCompleteTaskforallUsers = True Then
                                    If _flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskGroupID") <> 0 Then
                                        If objgloTask.IsMultipleUserTask(_flexGroup.Grid.GetData(_flexGroup.Grid.Row, "TaskGroupID")) = True Then
                                            cmnuItem_CompleteAll.Visible = True
                                        End If
                                    Else
                                        cmnuItem_CompleteAll.Visible = False
                                    End If
                                End If
                            End If
                            objTask.Dispose()
                            objTask = Nothing
                            objgloTask.Dispose()
                            objgloTask = Nothing
                        End If
                    End If
                Else
                    _flexGroup.Grid.ContextMenuStrip = cmnu_Tasks
                    cmunItem_Completed.Visible = False
                    cmnuItem_Priority.Visible = False
                    cmnuItem_TaskSeparator.Visible = False
                    cmnuItem_AcceptTask.Visible = False
                End If
            Else
                If (pnlPatientList.Visible = False) Then
                    _flexGroup.Grid.ContextMenuStrip = Nothing
                    For Each frm As Form In Application.OpenForms.OfType(Of frmViewgloLab)()
                        If Not Me.ActiveMdiChild Is Nothing Then
                            If Me.ActiveMdiChild.Name <> frm.Name Then
                                Exit Sub
                            End If
                        End If
                        Dim Query As String
                        Dim nPatientID As Int64
                        Dim nSelectedTaskId As Int64
                        Dim nOrderID As Int64
                        Dim sTaskType As String
                        '       Dim sOrderDetail As String
                        '      Dim sLabs() As String
                        '     Dim sLabDetails() As String
                        Dim nTaskDate As Int64
                        Dim nVisitID As Int64
                        Dim strObjResult As String = String.Empty

                        nPatientID = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.HitTest(e.X, e.Y).Row, "PatientID"), Int64)
                        nSelectedTaskId = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.HitTest(e.X, e.Y).Row, "TaskID"), Int64)
                        sTaskType = CType(_flexGroup.Grid.GetData(_flexGroup.Grid.HitTest(e.X, e.Y).Row, "Task Type"), String)
                        If sTaskType = "LabOrder" Then

                            Dim oDBLayer As New gloDatabaseLayer.DBLayer(GetConnectionString)
                            oDBLayer.Connect(False)
                            Query = "SELECT nReferenceID1 FROM TM_TaskMST WHERE nTaskID = " & nTaskId
                            strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                            If strObjResult.ToString().Trim().Length > 0 Then
                                nOrderID = Convert.ToInt64(strObjResult.ToString().Trim())
                            End If

                            strObjResult = String.Empty

                            Query = "SELECT nDateCreated FROM TM_TaskMST WHERE nTaskID = " & nTaskId
                            strObjResult = oDBLayer.ExecuteScalar_Query(Query)

                            If strObjResult.ToString().Trim().Length > 0 Then
                                nTaskDate = Convert.ToInt64(strObjResult.ToString().Trim())
                            End If

                            strObjResult = String.Empty

                            'Added by madan on 20100612--- modified for functionality based on Assigntask form lab.
                            If nOrderID > 0 Then
                                Query = "SELECT labom_VisitID FROM Lab_Order_MST WHERE labom_OrderID = " & nOrderID
                                strObjResult = oDBLayer.ExecuteScalar_Query(Query)
                                If strObjResult.ToString().Trim().Length > 0 Then
                                    nVisitID = Convert.ToInt64(strObjResult.ToString().Trim())
                                End If
                            End If
                            strObjResult = String.Empty
                            oDBLayer.Disconnect()
                            oDBLayer.Dispose()
                            oDBLayer = Nothing
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntGenerateCCDHandler, AddressOf openCCD
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EntOpenMessage, AddressOf OpenMessage
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntOpenPatientLetter, AddressOf OpenPatientLetter
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntOpenReferralLetter, AddressOf OpenReferralLetters
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntOpenClinicalChart, AddressOf OpenClinicalChart
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).FormClosed, AddressOf ShowTasks
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).Activated, AddressOf frmViewgloLab_Activated
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EntOpenEducation, AddressOf OpenEducation
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntGenerateCDAHandler, AddressOf openCDA
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EventCDA, AddressOf mdlGeneral.OpenCDA
                            'RemoveHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).OnProviderChanged, AddressOf OnProviderChanged



                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntGenerateCCDHandler, AddressOf openCCD
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EntOpenMessage, AddressOf OpenMessage
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntOpenPatientLetter, AddressOf OpenPatientLetter
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntOpenReferralLetter, AddressOf OpenReferralLetters
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntOpenClinicalChart, AddressOf OpenClinicalChart
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).FormClosed, AddressOf ShowTasks
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).Activated, AddressOf frmViewgloLab_Activated
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EntOpenEducation, AddressOf OpenEducation
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EvntGenerateCDAHandler, AddressOf openCDA
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).EventCDA, AddressOf mdlGeneral.OpenCDA
                            'AddHandler DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).OnProviderChanged, AddressOf OnProviderChanged

                            If IsNothing(frm) = True Then
                                Exit Sub
                            End If

                            With DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).LabOrderParameter
                                .IsEditMode = False
                                .OrderID = nOrderID
                                .OrderNumberID = 0
                                .OrderNumberPrefix = "ORD"
                                .PatientID = nPatientID
                                .VisitID = nVisitID
                                .TransactionDate = gloDateMaster.gloDate.DateAsDate(nTaskDate)
                                .CloseAfterSave = True
                            End With
                            DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).LoginProviderID = gnLoginProviderID
                            DirectCast(frm, gloEmdeonInterface.Forms.frmViewgloLab).LoadLabForTask(nOrderID, nPatientID)
                            Exit For
                        Else
                            Exit For
                        End If
                    Next
                    Exit Sub
                End If
            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

    Private Sub _flexGroupGrid_AfterScroll(ByVal Sender As Object, ByVal e As C1.Win.C1FlexGrid.RangeEventArgs)
        Try
            If (e.NewRange.BottomRow = _flexGroup.Grid.Rows.Count - 1) AndAlso e.NewRange.BottomRow <> -1 And _isTasksFullyLoaded = False Then
                _flexGroup.Grid.SuspendLayout()
                Dim _ScrollPosition As Point
                _ScrollPosition = C1Mesages.ScrollPosition
                'Dim dtTask As DataTable  ''slr new not needed
                'Dim ogloTasks As New gloTaskMail.gloTask(GetConnectionString)
                'dtTask = ogloTasks.GetUnFinishedUserTasksList(gnLoginID, 0)
                'If dtTask.Rows.Count > 100 Then
                '    lblLinkViewMoreTask.Parent.Visible = True
                'End If
                _flexGroup.Grid.ResumeLayout()    'C1Mesages_AfterScroll(sender, e)
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

    Private Sub btnClear_Click(sender As System.Object, e As System.EventArgs) Handles btnClear.Click
        txtTaskSearch.ResetText()
        txtTaskSearch.Focus()
    End Sub


    Private Sub Panel9_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles Panel9.MouseDown
        Try
          
            If e.Button = Windows.Forms.MouseButtons.Right Then
                If gblnSecurityUser = False Then
                    Panel9.ContextMenuStrip = cmnuToolStripCustomize
                    cmnuToolStripCustomize.Tag = "pnlTask"
                    If e.X > (pnlPatientDetail.Width) - 500 Then
                        cmnuToolStripCustomize.DefaultDropDownDirection = ToolStripDropDownDirection.BelowLeft
                    End If
                End If
            Else
                Panel9.ContextMenuStrip = Nothing
                cmnuToolStripCustomize.Tag = Nothing
            End If
            If gblnSecurityUser = False Then ''added condition for bugid 78617
                cmnuToolStripCustomize.Tag = "pnlTask"
            End If
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

    Private Sub lblLinkViewMoreTask_LinkClicked(sender As System.Object, e As System.Windows.Forms.LinkLabelLinkClickedEventArgs) Handles lblLinkViewMoreTask.LinkClicked
        Try
            If txtTaskSearch.Text = "" Then
                ShowTasks(1)
                _flexGroup.Grid.Focus()
                _flexGroup.Grid.ScrollBars = ScrollBars.Both
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try

    End Sub

    Private Sub txtTaskSearch_SearchFired() Handles txtTaskSearch.SearchFired
        If txtTaskSearch.Text = "" Then
            ShowTasks(2, True)
        Else
            ShowTasks(2)
        End If

        If cmbFilters.Items.Count = 0 Then
            cmbFilters.Items.Clear()
            For Each col As C1.Win.C1FlexGrid.Column In _flexGroup.Grid.Cols
                If col.Visible Then
                    cmbFilters.Items.Add(col.Name)
                Else
                    If col.Name = "" Then
                        cmbFilters.Items.Add(col.Name)
                    End If
                End If
            Next
            _flexGroup.FilterRow = False
        End If

    End Sub
    Private _ActiveDSO As AxDSOFramer.AxFramerControl = Nothing
    Private _ActiveDSOParent As Control = Nothing
    Private _ActiveDSOBounds As Rectangle = Nothing
    Public Property ActiveDSO As AxDSOFramer.AxFramerControl
        Get
            Return _ActiveDSO
        End Get
        Set(value As AxDSOFramer.AxFramerControl)
            _ActiveDSO = value
            If (IsNothing(_ActiveDSO) = False) Then
                _ActiveDSOParent = _ActiveDSO.Parent
                _ActiveDSOBounds = _ActiveDSO.Bounds
            Else
                _ActiveDSOParent = Nothing
                _ActiveDSOBounds = Nothing
            End If
        End Set
    End Property
    Shared strRefernce As String = ""
    Private IsUtteranceProgress As Boolean = False
    Private IsDectaionInProgress As Boolean = False
    Private IsHoKeyPressed As Boolean = False
    Private strHotKey As String = ""
    Private intPanelProgressCounter As Integer = 0
    Private Sub TimerWrittingClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Try
            If Not IsNothing(Me.ActiveMdiChild) Then
                If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                    If IsUtteranceProgress = False Then
                        Dim str As String = gloWord.WordDialogBoxBackgroundCloser.GetNatSpeakWindowcontent()
                        If strRefernce = str Or str = "<???>" Or str = "" Then
                            IsDectaionInProgress = False
                            If IsNothing(TimerWritting) = False Then
                                TimerWritting.Stop()
                            End If
                            If IsHoKeyPressed Then
                                Dim I As IHotKey = Nothing
                                I = CType(Me.ActiveMdiChild, IHotKey)
                                I.Navigate(strHotKey)
                                IsHoKeyPressed = False
                            End If
                        Else
                            IsDectaionInProgress = True
                            strRefernce = str
                        End If
                    Else
                        IsDectaionInProgress = True
                    End If
                End If
            End If
        Catch ex As Exception

        End Try
    End Sub
    Private Sub TimerpnlUtteranceProgressClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Try
            If Not IsNothing(Me.ActiveMdiChild) Then
                If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                    If IsNothing(TimerpnlUtteranceProgress) = False Then
                        TimerpnlUtteranceProgress.Stop()
                    End If

                    If gblnShowDragonWaitProcess = True Then
                        CType(Me.ActiveMdiChild, frmPatientExam).pnlUtteranceProgress.Visible = False
                    End If
                End If
            End If
        Catch ex As Exception

        End Try
    End Sub

    Private Sub DgnEngineControl1_UtteranceBegin(sender As Object, e As System.EventArgs) Handles DgnEngineControl1.UtteranceBegin
        If Not IsNothing(Me.ActiveMdiChild) Then
            If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                IsUtteranceProgress = True
                IsDectaionInProgress = True
                If IsNothing(TimerWritting) = False Then
                    TimerWritting.Stop()
                End If
            End If
        End If
        globalLastInputInfo = DateTime.Now
        gloWord.WordDialogBoxBackgroundCloser.EnableDialogCloser = False
        If IsActivated = False Then
            Dim myDSO As AxDSOFramer.AxFramerControl = Nothing
            For Each myForm As Form In Application.OpenForms
                If (myForm.ContainsFocus) Then
                    gloWord.WordDialogBoxBackgroundCloser.SetFocusToEditableWordWindow(myForm, True, myDSO)
                    ActiveDSO = myDSO
                    Exit Sub
                End If
            Next
            gloWord.WordDialogBoxBackgroundCloser.SetFocusToEditableWordWindow(ActiveMdiChild, False, myDSO)
            ActiveDSO = myDSO
        Else
            Try
                If (IsNothing(_ActiveDSO) = False) Then
                    If IsNothing(_ActiveDSOParent) = False Then 'SLR: added on 11/23/2015: if cursor is not part of winword bring it to winword else leave as it is..
                        If (Not _ActiveDSOBounds.Contains(_ActiveDSOParent.PointToClient(MousePosition))) Then
                            _ActiveDSO.Activate()
                        End If
                    Else
                        _ActiveDSO.Activate()
                    End If
                End If
            Catch ex As Exception
                ActiveDSO = Nothing
            End Try
        End If



    End Sub

    Private Sub DgnEngineControl1_UtteranceEnd(sender As Object, e As System.EventArgs) Handles DgnEngineControl1.UtteranceEnd
        If Not IsNothing(Me.ActiveMdiChild) Then
            If Me.ActiveMdiChild.Name = "frmPatientExam" Then
                IsUtteranceProgress = False
                If IsNothing(TimerWritting) = False Then
                    TimerWritting.Start()
                End If
            End If
        End If
        gloWord.WordDialogBoxBackgroundCloser.EnableDialogCloser = True
        Try
            If (IsNothing(_ActiveDSO) = False) Then
                _ActiveDSO.Update()
            End If
        Catch ex As Exception
            ActiveDSO = Nothing
        End Try

    End Sub

    Private Sub tlbStripMain_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles tlbStripMain.MouseEnter
        If gblnSecurityUser = False Then ''added for bugid 78617
            If Not IsNothing(cmnuToolStripCustomize) Then
                cmnuToolStripCustomize.Tag = "tlbStripMain"
            End If
        End If
    End Sub

    Private Sub Panel9_MouseEnter(ByVal sender As Object, ByVal e As System.EventArgs) Handles Panel9.MouseEnter
        If gblnSecurityUser = False Then  ''added for bugid 78617
            If Not IsNothing(cmnuToolStripCustomize) Then
                cmnuToolStripCustomize.Tag = "pnlTask"
            End If
        End If
    End Sub

    Private Sub mnuConsentTracking_Click(sender As System.Object, e As System.EventArgs) Handles mnuConsentTracking.Click
        Try
            If gnPatientID <= 0 Then
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
                Exit Sub
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim oIMTran As New frmvwPatientConsentTracking(gnPatientID)

            With oIMTran
                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Private Function IsEnableWorkersCompForms() As Boolean
        Dim _blnIsNYWorkersCompFormsEnabled As Boolean = False
        Try
            _blnIsNYWorkersCompFormsEnabled = False

            If IsNothing(dvAllSettings) = False Then
                dvAllSettings.RowFilter = "sName = 'EnableWorkersCompForms'"
                For iCount As Int32 = 0 To dvAllSettings.Count - 1
                    If String.Compare(dvAllSettings(iCount)("sValue").ToString, "True", True) = 0 Then
                        _blnIsNYWorkersCompFormsEnabled = True
                    End If
                Next
            End If
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.None, ex, gloAuditTrail.ActivityOutCome.Failure)
            ex = Nothing
            _blnIsNYWorkersCompFormsEnabled = False
        Finally

        End Try

        Return _blnIsNYWorkersCompFormsEnabled
    End Function
    Private Sub cmnuNYWC_C4Item_Click(ByVal sender As Object, ByVal e As EventArgs)
        If IsAccess(False) = False Then
            Exit Sub
        End If

        Try
            Using ofrmWCFormViewer As New frmWorkerCompFormViewer(gnPatientID, 0, 0, GetConnectionString(), 0)
                ofrmWCFormViewer.ClaimNo = ""
                ofrmWCFormViewer.ShowDialog(IIf(IsNothing(ofrmWCFormViewer.Parent), Me, ofrmWCFormViewer.Parent))
            End Using

            FillPatientWorkerCompForms()

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            ex = Nothing
        End Try
    End Sub

    Private Sub cmnuNYWC_C42Item_Click(ByVal sender As Object, ByVal e As EventArgs)
        If IsAccess(False) = False Then
            Exit Sub
        End If

        Try
            Using ofrmWCFormViewer_C42 As New frmWorkerCompFormViewer_C42(gnPatientID, 0, 0, GetConnectionString(), 0)
                ofrmWCFormViewer_C42.ClaimNo = ""
                ofrmWCFormViewer_C42.ShowDialog(IIf(IsNothing(ofrmWCFormViewer_C42.Parent), Me, ofrmWCFormViewer_C42.Parent))
            End Using

            FillPatientWorkerCompForms()

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            ex = Nothing
        End Try
    End Sub

    Private Sub cmnuNYWC_C4AuthItem_Click(ByVal sender As Object, ByVal e As EventArgs)
        If IsAccess(False) = False Then
            Exit Sub
        End If

        Try
            Using ofrmWorkerCompFormViewer_C4Auth As New frmWorkerCompFormViewer_C4Auth(gnPatientID, 0, 0, GetConnectionString(), 0)
                ofrmWorkerCompFormViewer_C4Auth.ClaimNo = ""
                ofrmWorkerCompFormViewer_C4Auth.ShowDialog(IIf(IsNothing(ofrmWorkerCompFormViewer_C4Auth.Parent), Me, ofrmWorkerCompFormViewer_C4Auth.Parent))
            End Using

            FillPatientWorkerCompForms()

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            ex = Nothing
        End Try
    End Sub

    Private Sub cmnuNYWC_MG2Item_Click(ByVal sender As Object, ByVal e As EventArgs)
        If IsAccess(False) = False Then
            Exit Sub
        End If

        Try
            Using ofrmWorkerCompFormViewer_MG2 As New frmWorkerCompFormViewer_MG2(gnPatientID, 0, 0, GetConnectionString(), 0)
                ofrmWorkerCompFormViewer_MG2.ClaimNo = ""
                ofrmWorkerCompFormViewer_MG2.ShowDialog(IIf(IsNothing(ofrmWorkerCompFormViewer_MG2.Parent), Me, ofrmWorkerCompFormViewer_MG2.Parent))
            End Using

            FillPatientWorkerCompForms()

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            ex = Nothing
        End Try
    End Sub
    Private Sub cmnuNYWC_MG21Item_Click(ByVal sender As Object, ByVal e As EventArgs)
        If IsAccess(False) = False Then
            Exit Sub
        End If
        Try
            Using frmWorkerCompFormViewer_MG21 As New frmWorkerCompFormViewer_MG21(gnPatientID, 0, 0, GetConnectionString(), 0)
                frmWorkerCompFormViewer_MG21.ClaimNo = ""
                frmWorkerCompFormViewer_MG21.ShowDialog(IIf(IsNothing(frmWorkerCompFormViewer_MG21.Parent), Me, frmWorkerCompFormViewer_MG21.Parent))
            End Using

            FillPatientWorkerCompForms()

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
            ex = Nothing
        End Try
    End Sub
    
    Private Sub mnuOBReport_Click(sender As System.Object, e As System.EventArgs) Handles mnuOBReport.Click
        ShowSSRSReport("rptPatientOB", "OB Report", True)
    End Sub

    Private Sub checkActiveOBCases()
        Dim cmd As SqlCommand = Nothing
        Dim da As SqlDataAdapter = Nothing
        Dim dt As DataTable = Nothing
        Dim con As SqlConnection = Nothing
        Dim _result As Boolean = False
        Try
            con = New SqlConnection(GetConnectionString)
            cmd = New SqlCommand("gsp_CheckActiveOBCases", con)
            cmd.CommandType = CommandType.StoredProcedure

            con.Open()

            da = New SqlDataAdapter
            da.SelectCommand = cmd
            dt = New DataTable
            da.Fill(dt)
            con.Close()
            If dt.Rows.Count > 0 Then
                If dt.Rows(0)(0).ToString() <> "0" Then
                    _result = True
                Else
                    _result = False
                End If
            End If
            dt.Dispose()
            dt = Nothing

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.None, gloAuditTrail.ActivityType.Open, ex, gloAuditTrail.ActivityOutCome.Failure)
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally

            If con.State = ConnectionState.Open Then
                con.Close()

            End If
            con.Dispose()
            con = Nothing
            If Not IsNothing(dt) Then
                dt.Dispose()
                dt = Nothing
            End If
            If Not IsNothing(da) Then
                da.Dispose()
                da = Nothing
            End If
            If IsNothing(cmd) = False Then
                cmd.Parameters.Clear()
                cmd.Dispose()
                cmd = Nothing
            End If
        End Try
    End Sub
    Private Sub MenuStrip1_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles MenuStrip1.Click
        _isShowDialogueForm = True
        RegisterMyHotKey()
    End Sub

    Private Sub C1Appointments_Click(sender As Object, e As System.EventArgs) Handles C1Appointments.Click
        C1Appointments_RowColChange(sender, e)
    End Sub


    Private Sub tls_CodeGuide_Click(sender As System.Object, e As System.EventArgs) Handles tls_CodeGuide.Click
        Dim ofrmCodeGuide As gloUIControlLibrary.WPFForms.frmCodeGuide = Nothing

        Try
            ofrmCodeGuide = gloUIControlLibrary.WPFForms.frmCodeGuide.CheckInstance


            If ofrmCodeGuide Is Nothing Then
                ofrmCodeGuide = gloUIControlLibrary.WPFForms.frmCodeGuide.GetCodeGuideInstance(GetConnectionString(), "")
                Dim _interophelper As New System.Windows.Interop.WindowInteropHelper(ofrmCodeGuide)
                _interophelper.Owner = Me.Handle
                System.Windows.Forms.Integration.ElementHost.EnableModelessKeyboardInterop(ofrmCodeGuide)

            End If
            ofrmCodeGuide.WindowState = Windows.WindowState.Maximized
            ofrmCodeGuide.WindowStartupLocation = Windows.WindowStartupLocation.CenterScreen
            ofrmCodeGuide.Show()
            ofrmCodeGuide.Focus()

        Catch ex As Exception
            MessageBox.Show("Error loading code guide screen.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, False)
        End Try
    End Sub

    
 
    
    Private Sub MnuExamFinishReport_Click(sender As System.Object, e As System.EventArgs) Handles MnuExamFinishReport.Click
        Try
            ShowSSRSReport("rptExamFinishRateReport", "Exam Finish Rate Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuReports_InactiveCPTSReport_Click(sender As System.Object, e As System.EventArgs) Handles mnuReports_InactiveCPTSReport.Click
        ShowSSRSReport("rptCPTActiveDates", "Inactive CPT Usage Report", True)
    End Sub
    Public Sub OpenSetupCases(ByVal nPatientID As Long, ByVal nCaseID As Long, Optional ByVal frmParent As Form = Nothing)

        clsCaseSetup.OpenSetupCasesDialog(nPatientID, nCaseID, IIf(IsNothing(frmParent), Me, frmParent))

    End Sub
    Public Sub OpenPMAlert(ByVal strConnection As String, ByVal nPatientID As Long, ByVal strAppName As String)
        Dim frmPatAlerts As Form = New gloPatientStripControl.frmPatientAlerts(strConnection, nPatientID, strAppName)
        frmPatAlerts.ShowDialog(Me)
        frmPatAlerts.Dispose()
        frmPatAlerts = Nothing
    End Sub
    Public Function GetUserRightsArrayForPatientStrip() As ArrayList
        Return clsLoginUserRights.GetUserRightsArrayForPatientStrip()
    End Function
    Public Sub OpenEMRAlert(ByVal nPatientID As Long)
        Dim frmPatAlerts As Form = New frmPatientAlerts(nPatientID)
        frmPatAlerts.ShowDialog(Me)
        frmPatAlerts.Dispose()
        frmPatAlerts = Nothing
    End Sub

    Private Sub mnuReports_DrugMigrationReport_Click(sender As System.Object, e As System.EventArgs) Handles mnuReports_DrugMigrationReport.Click
        ShowSSRSReport("rpt_gsdd_migration", "Drug Migration Report", True)
    End Sub

  
    Private Sub mnu_rpt_ConfirmAppointments_Click(sender As System.Object, e As System.EventArgs) Handles mnu_rpt_ConfirmAppointments.Click
        Try            
            Dim ofrm As New gloAppointmentScheduling.frmRpt_AppointmentStatus(GetConnectionString)
            With ofrm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .ShowInTaskbar = False
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub    

#Region "EPA"

    Private Sub mnuePARequests_Click(sender As System.Object, e As System.EventArgs) Handles mnuePARequests.Click
        Try
            Dim frmViewEPA As Form = New frmViewEPA(GetConnectionString(), gnLoginID)
            frmViewEPA.MdiParent = Me
            frmViewEPA.WindowState = FormWindowState.Maximized
            frmViewEPA.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub CheckEPAUserIsInRole(gnLoginID As Long)

        Dim dtRoles As DataTable = Nothing

        Try
            mnuePARequests.Visible = False

            Using ePABusinessLayer As New gloEMRGeneralLibrary.gloGeneral.EPABusinesslayer()
                dtRoles = ePABusinessLayer.CheckEPAUserIsInRole(gnLoginID)
            End Using

            If dtRoles IsNot Nothing AndAlso dtRoles.Rows.Count > 0 Then
                mnuePARequests.Visible = True
            End If
        Catch ex As Exception
            pnlMainToolBar.Visible = True
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If dtRoles IsNot Nothing Then
                dtRoles.Dispose()
                dtRoles = Nothing
            End If
        End Try
    End Sub

#End Region

    Private Sub mnu_MIPS_Quality_Click_2019(sender As System.Object, e As System.EventArgs) Handles mnu_MIPS_Quality_2019.Click
        Try
            Dim ofrm As New gloMU.frm_MIPSQuality_Reports_2019
            ofrm.MdiParent = Me
            ofrm.UserName = gstrLoginName
            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

            'Dim frm As New gloMU.QppReport()
            'frm.ShowDialog()
            'frm.Dispose()
            'frm = Nothing

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_MIPS_Quality_Click_2017(sender As System.Object, e As System.EventArgs) Handles mnu_MIPS_Quality_2017.Click
        Try
            Dim ofrm As New gloMU.frm_MIPSQuality_Reports_2017
            ofrm.MdiParent = Me
            ofrm.UserName = gstrLoginName
            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

            'Dim frm As New gloMU.QppReport()
            'frm.ShowDialog()
            'frm.Dispose()
            'frm = Nothing

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_MIPS_Quality_Click(sender As System.Object, e As System.EventArgs) Handles mnu_MIPS_Quality.Click
        Try
            Dim ofrm As New gloMU.frm_MIPSQuality_Reports
            ofrm.MdiParent = Me
            ofrm.UserName = gstrLoginName
            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_MIPS_ACI_Click(sender As System.Object, e As System.EventArgs) Handles mnu_MIPS_ACI.Click
        Try
            Dim ofrm As New gloMU.frm_ViewMIPS_ACI
            ofrm.MdiParent = Me

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuEPCSAuditTrail_Click(sender As System.Object, e As System.EventArgs) Handles mnuEPCSAuditTrail.Click
        Try
            ShowSSRSReport("rptBDOAudit", "EPCS Audit Report", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuControlledSubstanceERX_Click(sender As System.Object, e As System.EventArgs) Handles mnuControlledSubstanceERX.Click
        Try
            ShowSSRSReport("rptERXControlledSubstance", "EPrescribing Report(EPCS)", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuTools_QRDAImport_Click(sender As Object, e As System.EventArgs) Handles mnuTools_QRDAImport.Click
        Try
            'If gnPatientID <= 0 Then
            '    If oPatientListControl.PatientCount > 0 Then
            '        MessageBox.Show("Select patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            '        Exit Sub
            '    Else
            '        Exit Sub
            '    End If
            'End If
            'If IsAccess(False) = False Then
            '    Exit Sub
            'End If
            Dim objfrm As New gloQRDAImport.frmQRDAImport(GetConnectionString())
            With objfrm
                .WindowState = FormWindowState.Normal
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
            End With
            If Not IsNothing(objfrm) Then
                objfrm.Dispose()
                objfrm = Nothing
            End If
      
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)

        End Try
    End Sub

    Private Sub mnuMUDashboard_2017_ACI_Click(sender As Object, e As System.EventArgs) Handles mnuMUDashboard_2017_ACI.Click
        Try
            Dim ofrm As New gloMU.frm_View2017_ACI()
            ofrm.MdiParent = Me

            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPDRPrograms_Click(sender As System.Object, e As System.EventArgs) Handles mnuPDRPrograms.Click
        Try
            Using frmViewPDRPrograms As New frmViewPDR(gnPatientID)
                frmViewPDRPrograms.ShowDialog()
            End Using
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPDMPPrograms_Click(sender As System.Object, e As System.EventArgs) Handles mnuPDMPPrograms.Click
        Try


            Dim frmViewpdmpprograms As New frmViewpdmpprograms(gnPatientID)
            frmViewpdmpprograms.ShowInTaskbar = False
            frmViewpdmpprograms.MdiParent = Me
            frmViewpdmpprograms.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmViewpdmpprograms.WindowState = FormWindowState.Maximized
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuPDRProgramsReports_Click(sender As System.Object, e As System.EventArgs) Handles mnuPDRProgramsReports.Click
        Try
            ShowSSRSReport("rptPDRPrograms", "PDR Programs", True)
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Function GetClearDashboardSearchSetting() As Boolean
        Dim ogloSettings As New gloSettings.GeneralSettings(GetConnectionString())
        Dim value As Boolean = False
        Dim objResult As Object = Nothing

        Try
            ogloSettings.GetSetting("ClearDashboardSearch", gnLoginID, gnClinicID, objResult)

            If Not String.IsNullOrEmpty(Convert.ToString(objResult)) Then
                If String.Compare(objResult, "True", True) = 0 Then
                    value = True
                End If
            End If

        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(ex, True)
        Finally
            If Not IsNothing(ogloSettings) Then
                ogloSettings.Dispose()
            End If
        End Try

        Return value
    End Function

#Region "Inbox new mails notification"

    Private Sub GetMessageCount()
        Dim dsUnreadMailCount As DataSet = Nothing
        Dim dtMails As DataTable = Nothing
        Dim MailCount As gloSurescriptSecureMessage.clsSecureMessageDB = Nothing        
        Dim sBuilder As StringBuilder = Nothing
        Try
            sBuilder = New StringBuilder()
            MailCount = New gloSurescriptSecureMessage.clsSecureMessageDB()
            dsUnreadMailCount = MailCount.GetNewMail(gnLoginID, Convert.ToDecimal(gMessageUpdateTime))            

            notifyInbox.Tag = Nothing

            If dsUnreadMailCount.Tables.Count > 0 Then
                dtMails = dsUnreadMailCount.Tables(0)

                sBuilder.AppendLine()
                If dtMails IsNot Nothing AndAlso dtMails.Rows.Count > 0 Then
                    For Each Row As DataRow In dsUnreadMailCount.Tables(0).Rows
                        sBuilder.AppendLine(Row("sProviderName") + " " + Convert.ToString(Row("CountMails")))

                        If dtMails.Columns.Contains("nMessageID") Then
                            notifyInbox.Tag = Convert.ToString(Row("sDirectAddress")) + "|" + Convert.ToString(Row("nMessageID"))
                        End If

                    Next

                    sBuilder.AppendLine(Environment.NewLine + "Click to open Inbox")

                    notifyInbox.Visible = True
                    notifyInbox.BalloonTipText = sBuilder.ToString()
                    notifyInbox.ShowBalloonTip(8000)
                End If
            End If

           

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            If dsUnreadMailCount IsNot Nothing Then
                dsUnreadMailCount.Dispose()
                dsUnreadMailCount = Nothing
            End If

            If MailCount IsNot Nothing Then
                MailCount.Dispose()
                MailCount = Nothing
            End If

            If sBuilder IsNot Nothing Then
                sBuilder.Clear()
                sBuilder = Nothing
            End If

        End Try

    End Sub

    Private Sub notifyInbox_BalloonTipClicked(sender As System.Object, e As System.EventArgs) Handles notifyInbox.BalloonTipClicked, notifyInbox.Click
        Try
            Try
                If strProviderDirectAddress <> "" OrElse (listDirectUserProviderAssociation IsNot Nothing AndAlso listDirectUserProviderAssociation.Count > 0) Then
                    Dim ofrmInbox As gloSurescriptSecureMessage_InBox.Inbox
                    ofrmInbox = gloSurescriptSecureMessage_InBox.Inbox.GetInstance()
                    If IsNothing(ofrmInbox) = False Then

                        Try
                            RemoveHandler ofrmInbox.tlbCDAImport, AddressOf ShowCDAImportForm
                            RemoveHandler ofrmInbox.tlbDMSImport, AddressOf ShowDMSImportForm
                        Catch ex As Exception

                        End Try

                        AddHandler ofrmInbox.tlbCDAImport, AddressOf ShowCDAImportForm
                        AddHandler ofrmInbox.tlbDMSImport, AddressOf ShowDMSImportForm
                        Try
                            RemoveHandler ofrmInbox.EvntGenerateCDAFromInbox, AddressOf mdlGeneral.OpenCDA
                        Catch ex As Exception

                        End Try

                        AddHandler ofrmInbox.EvntGenerateCDAFromInbox, AddressOf mdlGeneral.OpenCDA
                        System.Windows.Forms.Integration.ElementHost.EnableModelessKeyboardInterop(ofrmInbox)

                        If notifyInbox.Tag IsNot Nothing AndAlso Convert.ToString(notifyInbox.Tag).Contains("|") Then
                            Dim sValue As String() = Convert.ToString(notifyInbox.Tag).Split("|")

                            Dim sDirectAddress As String = sValue(0)
                            Dim sMessageID As String = sValue(1)

                            ofrmInbox.NavigateToMessage(Convert.ToInt64(sMessageID), sDirectAddress)
                            ofrmInbox.PreventLoading = True
                        End If

                        ofrmInbox.Show()
                        ofrmInbox.Activate()
                    End If
                Else
                    MessageBox.Show(gstrDirectWarningMessage, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
            notifyInbox.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

#End Region

    Private Sub mnu_ImplantableDevice_Setup_Click(sender As System.Object, e As System.EventArgs) Handles mnu_ImplantableDevice_Setup.Click
        Dim frmImplantableDeviceSetup As New frmVWImplantable_Device_Setup
        frmImplantableDeviceSetup.MdiParent = Me
        frmImplantableDeviceSetup.Show()
        ShowHideMainMenu(False, False)
        pnlMainToolBar.Visible = False
    End Sub

    Private Sub mnu_ImplantableDevices_Click(sender As System.Object, e As System.EventArgs) Handles mnu_ImplantableDevices.Click
        Try
            If gnPatientID <= 0 Then               
                MessageBox.Show("Select the patient", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Exclamation)                
                Exit Sub
            End If

            If IsAccess(False) = False Then
                Exit Sub
            End If

            If gblnProviderDisable = True Then
                If ShowAssociateProvider(gnPatientID, Me) = False Then
                    Exit Sub
                Else
                    oPatientListControl.FillPatients()
                End If
            End If

            Dim ofrm As New frmVWImplantableDevices(gnPatientID)

            With ofrm
                .MdiParent = Me
                .ShowInTaskbar = False
                .WindowState = FormWindowState.Maximized
                .Show()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub mnuPendingRxChangeRequest_Click(sender As System.Object, e As System.EventArgs) Handles mnuPendingRxChangeRequest.Click
        Try
            'Dim enumFormType As frmViewRxRequests.RxFormType = frmViewRxRequests.RxFormType.RxChangeRequest
            Dim frmViewRxRequest As frmViewRxRequests = frmViewRxRequests.GetInstance(0, 0)

            If frmViewRxRequest IsNot Nothing Then
                frmViewRxRequest.ShowInTaskbar = False
                frmViewRxRequest.MdiParent = Me
                frmViewRxRequest.Show()

                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
                frmViewRxRequest.WindowState = FormWindowState.Maximized
            End If

        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub


    Private Sub mnuRxFillNotifications_Click(sender As System.Object, e As System.EventArgs) Handles mnuRxFillNotifications.Click
        Try
            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim frmRxFillNotifications As New frmRxFillNotifications()
            frmRxFillNotifications.WindowState = FormWindowState.Maximized
            frmRxFillNotifications.ShowDialog(IIf(IsNothing(frmRxFillNotifications.Parent), Me, frmRxFillNotifications.Parent))

            ShowPatientDetails(, True)

            If Not IsNothing(frmRxFillNotifications) Then
                frmRxFillNotifications.Dispose()
                frmRxFillNotifications = Nothing
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuVwDeniedChangeReq_Click(sender As System.Object, e As System.EventArgs) Handles mnuVwDeniedChangeReq.Click
        Dim dtDeniedRequests As DataTable
        Try

            If IsAccess(False) = False Then
                Exit Sub
            End If

            Dim frmChangeRxRequest As New frmDeniedRxChange
            dtDeniedRequests = frmChangeRxRequest.GetDeniedReportAllPatient()

            If Not IsNothing(dtDeniedRequests) Then
                If dtDeniedRequests.Rows.Count <= 0 Then
                    MessageBox.Show("No Rx change requests were denied for this patient", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    frmChangeRxRequest.Dispose()
                    Exit Sub
                End If
            End If

            frmChangeRxRequest.ShowDialog(IIf(IsNothing(frmChangeRxRequest.Parent), Me, frmChangeRxRequest.Parent))
            If Not IsNothing(frmChangeRxRequest) Then
                frmChangeRxRequest.Dispose()
                frmChangeRxRequest = Nothing
            End If
            If Not IsNothing(dtDeniedRequests) Then
                dtDeniedRequests.Dispose()
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            dtDeniedRequests = Nothing
        Finally
            dtDeniedRequests = Nothing
        End Try
    End Sub

    Private Sub mnuReports_PortalPHIReview_Click(sender As System.Object, e As System.EventArgs) Handles mnuReports_PortalPHIReview.Click
        Dim blnProviderDisable_ROS As Boolean = False
        blnProviderDisable_ROS = IsPatientProviderDisabled(gnPatientID)
        ShowReviewPHI("", blnProviderDisable_ROS, gnPatientID, bCallForLatestStatus:=True, bIsReviewMode:=True)
    End Sub

    Private Sub mnu_PortalPHI_Click(sender As System.Object, e As System.EventArgs) Handles mnu_PortalPHI.Click
        Dim blnProviderDisable_ROS As Boolean = False
        blnProviderDisable_ROS = IsPatientProviderDisabled(gnPatientID)
        ShowReviewPHI("", blnProviderDisable_ROS, gnPatientID, bCallForLatestStatus:=True, bIsReviewMode:=False)

    End Sub

    Private Sub mnuToolsCDAPatientInfoStatus_Click(sender As System.Object, e As System.EventArgs) Handles mnuToolsCDAPatientInfoStatus.Click
        Dim PatspecCDAspc As gloCCDLibrary.frmPatspecCDAspc
        PatspecCDAspc = New gloCCDLibrary.frmPatspecCDAspc()
        PatspecCDAspc.patientID = gnPatientID
        PatspecCDAspc.ShowDialog(Me)
    End Sub

    Private Sub mnuPlanOfTreatment_Click(sender As System.Object, e As System.EventArgs) Handles mnuPlanOfTreatment.Click
        Try
            Dim frmTreatmentPlan_View As New frmTreatmentPlan_View(gnPatientID)  ''frmCV_Criteria

            frmTreatmentPlan_View.MdiParent = Me
            frmTreatmentPlan_View.ShowInTaskbar = False
            frmTreatmentPlan_View.WindowState = FormWindowState.Maximized
            frmTreatmentPlan_View.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
        'Dim frm As New frmTreatmentPlan(gnPatientID)
        'frm.MdiParent = Me
        'frm.ShowInTaskbar = False
        'frm.WindowState = FormWindowState.Maximized
        'frm.Show()

        'pnlMainToolBar.Visible = False
        'ShowHideMainMenu(False, False)

    End Sub

    Private Sub mnu_CCDAPatientConsent_Click(sender As System.Object, e As System.EventArgs) Handles mnu_CCDAPatientConsent.Click
        Try
            Dim objfrm As New FrmPatientCCDAConsent(gnPatientID)
            With objfrm
                .WindowState = FormWindowState.Normal
                .BringToFront()
                .StartPosition = FormStartPosition.CenterParent
                .ShowDialog(IIf(IsNothing(objfrm.Parent), Me, objfrm.Parent))
                .Dispose()
            End With

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_APIHarness_Roles_Click(sender As System.Object, e As System.EventArgs) Handles mnu_APIHarness_Roles.Click
      
    End Sub

    Private Sub mnu_APIHarness_Users_Click(sender As System.Object, e As System.EventArgs) Handles mnu_APIHarness_Users.Click
      
    End Sub

    Private Sub mnu_APIHarness_Reports_Click(sender As System.Object, e As System.EventArgs) Handles mnu_APIHarness_Reports.Click
        Try
            'If IsAccess(False) = False Then
            '    Exit Sub
            'End If
            ''Task #68533: gloEMR Admin - User Management - User Rights - Change "Intuit" to "Patient Portal"
            ' ''if portal enable and user not have right then report is not show.
            'If gblnPatientPortalEnabled Then
            '    If objUserRights.Intuit = False Then
            '        System.Windows.MessageBox.Show("This user does not have the rights to view the Patient Activation Report. Please contact your system administrator for the same.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
            '        Exit Sub
            '    End If
            'End If


            If objUserRights.APIAccess = False Then
                System.Windows.MessageBox.Show("This user does not have the rights to view the Patient Activation Report. Please contact your system administrator for the same.", "gloEMR", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Exit Sub
            End If

            For Each oform As System.Windows.Forms.Form In System.Windows.Forms.Application.OpenForms
                If oform.Name = "frmAPIAccessActivationReport" Then
                    oform.MdiParent = Me
                    oform.WindowState = FormWindowState.Maximized
                    oform.Show()
                    oform.BringToFront()
                    oform.Focus()
                    ShowHideMainMenu(False, False)
                    Me.pnlMainToolBar.Visible = False
                    Exit Sub
                End If
            Next
            Dim frm As New frmAPIAccessActivationReport(GetConnectionString, mdlGeneral.gnLoginID)
            Try

                frm.MdiParent = Me
                frm.Show()
                frm.WindowState = FormWindowState.Maximized
                frm.BringToFront()
                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            Catch ex As Exception
                MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try

        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

 
    Private Sub mnuViewPrescriptions_Click(sender As System.Object, e As System.EventArgs) Handles mnuViewPrescriptions.Click
        Try
            Dim frmViewPrescriptions As frmViewPrescriptions = Nothing

            If frmViewPrescriptions Is Nothing Then
                frmViewPrescriptions = frmViewPrescriptions.GetInstance(gnLoginProviderID, 0)
                frmViewPrescriptions.ShowInTaskbar = False
                frmViewPrescriptions.MdiParent = Me
                frmViewPrescriptions.Show()

                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
                frmViewPrescriptions.WindowState = FormWindowState.Maximized
            Else
                frmViewPrescriptions.BringToFront()
            End If
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnuVwSummaryCareRecord_Click(sender As System.Object, e As System.EventArgs) Handles mnuVwSummaryCareRecord.Click
       

        Try
            Dim Frm As New frmViewSummaryCareRecord()
            Frm.patientID = gnPatientID
            If IsNothing(Frm) = True Then
                Exit Sub
            End If
            With Frm
                .MdiParent = Me
                .WindowState = FormWindowState.Maximized
                .StartPosition = FormStartPosition.CenterParent
                .BringToFront()
                .Show()
                pnlMainToolBar.Visible = True

                ShowHideMainMenu(False, False)
                pnlMainToolBar.Visible = False
            End With
        Catch ex As Exception
            gloAuditTrail.gloAuditTrail.ExceptionLog(gloAuditTrail.ActivityModule.Dashboard, gloAuditTrail.ActivityCategory.PatientDetail, gloAuditTrail.ActivityType.View, "Error on Opening Summary Care Records - " & ex.ToString, gloAuditTrail.ActivityOutCome.Failure)
        End Try
    End Sub

    Private Sub mnuTools_ProviderEducation_Click(sender As System.Object, e As System.EventArgs) Handles mnuTools_ProviderEducation.Click
        'Try
        '    Dim oProviderEducation As New frmProviderEducation_View()
        '    oProviderEducation.MdiParent = Me
        '    oProviderEducation.ShowInTaskbar = False
        '    oProviderEducation.WindowState = FormWindowState.Maximized
        '    oProviderEducation.Show()
        '    ShowHideMainMenu(False, False)
        '    pnlMainToolBar.Visible = False
        'Catch ex As Exception
        '    MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        'End Try
    End Sub

    Private Sub lblLinkUnfinishedAll_LinkClicked(sender As System.Object, e As System.Windows.Forms.LinkLabelLinkClickedEventArgs) Handles lblLinkUnfinishedAll.LinkClicked
        bIsShowAllUnfinishedexams = True
        ShowUnfinishedExams()
        pnllblLinkUnfinishedexam.Visible = False
    End Sub

    Dim bInSideRefreshDevices As Boolean = False
    Private Sub mnuTools_RefreshDevicesPrinters_Click(sender As System.Object, e As System.EventArgs) Handles mnuTools_RefreshDevicesPrinters.Click
        If bInSideRefreshDevices Then
            Return
        End If

        bInSideRefreshDevices = True
        Dim bisMsgShown As Boolean = False
        Dim oRemoteScanCommon As gloEDocumentV3.Common.RemoteScanCommon = New gloEDocumentV3.Common.RemoteScanCommon
        Dim oTSDialog As gloPrintDialog.frmTSPrintDialog = New gloPrintDialog.frmTSPrintDialog
        Try
            If (gloGlobal.gloTSPrint.isCopyPrint OrElse gloGlobal.gloRemoteScanSettings.EnableRemoteScan) Then
                If Not gloGlobal.gloTSPrint.isMapped Then
                    MessageBox.Show("Unable to find mapped drive. Please check whether gloLDSSniffer Service is running. Looks like you have not enabled mapping while connecting to RDP.", gloGlobal.gloTSPrint.getMessageCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Return
                End If

                If gloGlobal.gloTSPrint.isCopyPrint Then
                    If Not oTSDialog.RefreshPrinters Then
                        MessageBox.Show("Unable to refresh priter list, Please try after some time.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        bisMsgShown = True
                    End If

                End If

                If gloGlobal.gloRemoteScanSettings.EnableRemoteScan Then
                    gloGlobal.gloRemoteScanSettings.AssignReEvaluate()
                    gloGlobal.gloRemoteScanSettings.DoesNetworkDirExist()
                    If Not gloGlobal.gloRemoteScanSettings.isScanServiceWorking(True) Then
                        Return
                        ' TODO: Labeled Arguments not supported. Argument: 1 := 'showMsg'
                    End If

                    If (gloRemoteScanGeneral.RemoteScanSettings.RefreshScanners = True) Then
                        Dim sRetVal As String = Nothing
                        sRetVal = oRemoteScanCommon.SetRemoteScannerCurrentSettings(Nothing, Nothing, Nothing)
                        If Not String.IsNullOrEmpty(sRetVal) Then
                            gloAuditTrail.gloAuditTrail.CreateAuditLog(gloAuditTrail.ActivityModule.Security, gloAuditTrail.ActivityCategory.LoginScreen, gloAuditTrail.ActivityType.Login, sRetVal, gloAuditTrail.ActivityOutCome.Failure)
                        End If

                        gloRemoteScanGeneral.RemoteScanSettings.SetScannerSettingsObject()
                    Else
                        MessageBox.Show("Unable to update scanner list, Please try after some time.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                        bisMsgShown = True
                    End If

                End If

                If Not bisMsgShown Then
                    MessageBox.Show("Local devices and printer list refreshed.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If

            Else
                MessageBox.Show("Devices not refreshed because Local Print/Scan not enabled.", gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If
            'Update clients machine name
            Dim myRemoteMachine As gloAuditTrail.MachineDetails.MachineInfo = gloAuditTrail.MachineDetails.RemoteMachineDetails(True)
            gloGlobal.gloTSPrint.sClientLocalMachineName = myRemoteMachine.MachineName

            gloWord.LoadAndCloseWord.CurrentSessionID = System.Diagnostics.Process.GetCurrentProcess().SessionId
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            oRemoteScanCommon = Nothing
            oTSDialog = Nothing
            bInSideRefreshDevices = False
        End Try
    End Sub

    Public Sub HOOSTotalAssesmentToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles HOOSTotalAssesmentToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.HoosHip, gstrHoosKoosSurveyUrl) _
            With {.ConnectionString = GetConnectionString()}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)
        
        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try

    End Sub

    Public Sub KOOSKNEESurveyToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles KOOSKNEESurveyToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.KoosKnee, gstrHoosKoosSurveyUrl) _
           With {.ConnectionString = GetConnectionString()}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)

        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub KOOSJRKNEESurveyToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles KOOSJRKNEESurveyToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.KoosJRKnee, gstrHoosKoosSurveyUrl) _
           With {.ConnectionString = GetConnectionString()}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)

        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub HOOSJRToolStripMenuItem_Click(Sender As System.Object, e As System.EventArgs) Handles HOOSJRToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.HoosJRHip, gstrHoosKoosSurveyUrl) _
         With {.ConnectionString = GetConnectionString()}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)

        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub PROMIS29ToolStripMenuItem_Click(Sender As System.Object, e As System.EventArgs) Handles PROMIS29ToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.Promis29, gstrHoosKoosSurveyUrl) _
         With {.ConnectionString = GetConnectionString()}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)

        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub PROMIS10ToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles PROMIS10ToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.Promis10, gstrHoosKoosSurveyUrl) _
        With {.ConnectionString = GetConnectionString()}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)

        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub VETERANSRAND12ToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles VETERANSRAND12ToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.VR12, gstrHoosKoosSurveyUrl) _
        With {.ConnectionString = GetConnectionString()}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)

        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub VETERANSRAND36SurveyToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles VETERANSRAND36SurveyToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.VR36, gstrHoosKoosSurveyUrl) _
        With {.ConnectionString = GetConnectionString()}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)

        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub PHQ2ToolStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles PHQ2ToolStripMenuItem.Click
        Dim frmHoosKoos As New gloMU.frmMUScreeningForm(gnPatientID, gloMU.ScreeningEnum.PHQ2, gstrHoosKoosSurveyUrl) _
        With {.ConnectionString = GetConnectionString(), .PatientAge = Patientage.Years}
        frmHoosKoos.VisitID = GenerateVisitID(DateTime.Now, gnPatientID)

        Try
            frmHoosKoos.ShowInTaskbar = False
            frmHoosKoos.MdiParent = Me
            frmHoosKoos.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmHoosKoos.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Public Sub ViewScreeningsStripMenuItem_Click(sender As System.Object, e As System.EventArgs) Handles ViewScreenings.Click
        Dim frmViewScreenings As New frmViewScreenings(gnPatientID)

        Try
            frmViewScreenings.ShowInTaskbar = False
            frmViewScreenings.MdiParent = Me
            frmViewScreenings.Show()

            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
            frmViewScreenings.WindowState = FormWindowState.Maximized
        Catch objErr As Exception
            MessageBox.Show(objErr.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

    Private Sub mnu_MIPSACI_2019_Click(sender As System.Object, e As System.EventArgs) Handles mnu_MIPSACI_2019.Click
        Try
            Dim ofrm As New gloMU.frm_View_MIPS_2019()
            ofrm.MdiParent = Me
            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub

   
    Private Sub mnu_Stage3_2019_Click(sender As System.Object, e As System.EventArgs) Handles mnu_Stage3_2019.Click
        Try
            Dim ofrm As New gloMU.frm_ViewStage3_2019()
            ofrm.MdiParent = Me
            ofrm.Show()
            ShowHideMainMenu(False, False)
            pnlMainToolBar.Visible = False
        Catch ex As Exception
            MessageBox.Show(ex.ToString, gstrMessageBoxCaption, MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
End Class

